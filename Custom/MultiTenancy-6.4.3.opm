<?xml version="1.0" encoding="utf-8" ?>
<otrs_package version="1.1">
    <Name>MultiTenancy</Name>
    <Version>6.4.4</Version>
    <Vendor>terreActive AG</Vendor>
    <URL>http://www.terreactive.ch/</URL>
    <License>GNU AFFERO GENERAL PUBLIC LICENSE Version 3, November 2007</License>
    <Description>Dedicated queues for groups of agents and customers.</Description>
    <Framework>6.2.x</Framework>
    <Framework>6.3.x</Framework>
    <Framework>6.4.x</Framework>
    <BuildDate>2022-12-02 08:25:37</BuildDate>
    <BuildHost>yourhost.example.com</BuildHost>
    <Filelist>
        <File Location="doc/en/MultiTenancy.pod" Permission="660" Encode="Base64">PXBvZAoKPWVuY29kaW5nIHV0Zi04Cgo9aGVhZDEgTkFNRQoKTXVsdGlUZW5hbmN5IC0gZ3JvdXAgYWdlbnRzIGFuZCBjdXN0b21lciB1c2VycwoKPWhlYWQxIERFU0NSSVBUSU9OCgpEZWRpY2F0ZWQgcmVzb3VyY2VzIGZvciBncm91cHMgb2YgYWdlbnRzIGFuZCBjdXN0b21lcnMuCgo9aGVhZDEgVERCCgpUQkQKCj1oZWFkMSBDT1BZUklHSFQgQU5EIExJQ0VOQ0UKCkNvcHlyaWdodCAoYykgMjAyMiBieSBPdGhtYXIgV2lnZ2VyIDxvdGhtYXIud2lnZ2VyQHRlcnJlYWN0aXZlLmNoPgoKVGhpcyBpcyBmcmVlIHNvZnR3YXJlOyB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5IGl0IHVuZGVyCnRoZSBHbnUgQWZmZXJvIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgdmVyc2lvbiAzLgoKVGhpcyBwYWNrYWdlIGlzIHByb3ZpZGVkICJhcyBpcyIgYW5kIHdpdGhvdXQgYW55IGV4cHJlc3Mgb3IgaW1wbGllZAp3YXJyYW50aWVzLCBpbmNsdWRpbmcsIHdpdGhvdXQgbGltaXRhdGlvbiwgdGhlIGltcGxpZWQgd2FycmFudGllcyBvZgptZXJjaGFudGliaWxpdHkgYW5kIGZpdG5lc3MgZm9yIGEgcGFydGljdWxhciBwdXJwb3NlLgoKPWN1dAoK</File>
        <File Location="Custom/Kernel/GenericInterface/Operation/Ticket/TicketCreate.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxLTIwMjIgWm51bnkgR21iSCwgaHR0cHM6Ly96bnVueS5vcmcvCiMgQ29weXJpZ2h0IChDKSAyMDIxIG1heGVuY2UgYnVzaW5lc3MgY29uc3VsdGluZyBHbWJILCBodHRwOi8vd3d3Lm1heGVuY2UuZGUKIyAtLQojIFRoaXMgc29mdHdhcmUgY29tZXMgd2l0aCBBQlNPTFVURUxZIE5PIFdBUlJBTlRZLiBGb3IgZGV0YWlscywgc2VlCiMgdGhlIGVuY2xvc2VkIGZpbGUgQ09QWUlORyBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbiAoR1BMKS4gSWYgeW91CiMgZGlkIG5vdCByZWNlaXZlIHRoaXMgZmlsZSwgc2VlIGh0dHBzOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvZ3BsLTMuMC50eHQuCiMgLS0KCnBhY2thZ2UgS2VybmVsOjpHZW5lcmljSW50ZXJmYWNlOjpPcGVyYXRpb246OlRpY2tldDo6VGlja2V0Q3JlYXRlOwoKdXNlIHN0cmljdDsKdXNlIHdhcm5pbmdzOwoKdXNlIE1JTUU6OkJhc2U2NCgpOwoKdXNlIEtlcm5lbDo6U3lzdGVtOjpWYXJpYWJsZUNoZWNrIHF3KElzQXJyYXlSZWZXaXRoRGF0YSBJc0hhc2hSZWZXaXRoRGF0YSBJc1N0cmluZyBJc1N0cmluZ1dpdGhEYXRhKTsKCnVzZSBwYXJlbnQgcXcoCiAgICBLZXJuZWw6OkdlbmVyaWNJbnRlcmZhY2U6Ok9wZXJhdGlvbjo6Q29tbW9uCiAgICBLZXJuZWw6OkdlbmVyaWNJbnRlcmZhY2U6Ok9wZXJhdGlvbjo6VGlja2V0OjpDb21tb24KKTsKCm91ciAkT2JqZWN0TWFuYWdlckRpc2FibGVkID0gMTsKCj1oZWFkMSBOQU1FCgpLZXJuZWw6OkdlbmVyaWNJbnRlcmZhY2U6Ok9wZXJhdGlvbjo6VGlja2V0OjpUaWNrZXRDcmVhdGUgLSBHZW5lcmljSW50ZXJmYWNlIFRpY2tldCBUaWNrZXRDcmVhdGUgT3BlcmF0aW9uIGJhY2tlbmQKCj1oZWFkMSBQVUJMSUMgSU5URVJGQUNFCgo9aGVhZDIgbmV3KCkKCnVzdWFsbHksIHlvdSB3YW50IHRvIGNyZWF0ZSBhbiBpbnN0YW5jZSBvZiB0aGlzCmJ5IHVzaW5nIEtlcm5lbDo6R2VuZXJpY0ludGVyZmFjZTo6T3BlcmF0aW9uLT5uZXcoKTsKCj1jdXQKCnN1YiBuZXcgewogICAgbXkgKCAkVHlwZSwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkU2VsZiA9IHt9OwogICAgYmxlc3MoICRTZWxmLCAkVHlwZSApOwoKICAgICMgY2hlY2sgbmVlZGVkIG9iamVjdHMKICAgIGZvciBteSAkTmVlZGVkIChxdyggRGVidWdnZXJPYmplY3QgV2Vic2VydmljZUlEICkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBTdWNjZXNzICAgICAgPT4gMCwKICAgICAgICAgICAgICAgIEVycm9yTWVzc2FnZSA9PiAiR290IG5vICROZWVkZWQhIiwKICAgICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgICRTZWxmLT57JE5lZWRlZH0gPSAkUGFyYW17JE5lZWRlZH07CiAgICB9CgogICAgJFNlbGYtPntDb25maWd9ICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKS0+R2V0KCdHZW5lcmljSW50ZXJmYWNlOjpPcGVyYXRpb246OlRpY2tldENyZWF0ZScpOwogICAgJFNlbGYtPntPcGVyYXRpb259ID0gJFBhcmFte09wZXJhdGlvbn07CgogICAgcmV0dXJuICRTZWxmOwp9Cgo9aGVhZDIgUnVuKCkKCnBlcmZvcm0gVGlja2V0Q3JlYXRlIE9wZXJhdGlvbi4gVGhpcyB3aWxsIHJldHVybiB0aGUgY3JlYXRlZCB0aWNrZXQgbnVtYmVyLgoKICAgIG15ICRSZXN1bHQgPSAkT3BlcmF0aW9uT2JqZWN0LT5SdW4oCiAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgIFVzZXJMb2dpbiAgICAgICAgID0+ICdzb21lIGFnZW50IGxvZ2luJywgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBVc2VyTG9naW4gb3IgQ3VzdG9tZXJVc2VyTG9naW4gb3IgU2Vzc2lvbklEIGlzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyAgIHJlcXVpcmVkCiAgICAgICAgICAgIEN1c3RvbWVyVXNlckxvZ2luID0+ICdzb21lIGN1c3RvbWVyIGxvZ2luJywKICAgICAgICAgICAgU2Vzc2lvbklEICAgICAgICAgPT4gMTIzLAoKICAgICAgICAgICAgUGFzc3dvcmQgID0+ICdzb21lIHBhc3N3b3JkJywgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGlmIFVzZXJMb2dpbiBvciBDdXN0b21lclVzZXJMb2dpbiBpcyBzZW50IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjICAgUGFzc3dvcmQgaXMgcmVxdWlyZWQKCiAgICAgICAgICAgIFRpY2tldCA9PiB7CiAgICAgICAgICAgICAgICBUaXRsZSAgICAgID0+ICdzb21lIHRpY2tldCB0aXRsZScsCgogICAgICAgICAgICAgICAgUXVldWVJRCAgICAgICA9PiAxMjMsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgUXVldWVJRCBvciBRdWV1ZSBpcyByZXF1aXJlZAogICAgICAgICAgICAgICAgUXVldWUgICAgICAgICA9PiAnc29tZSBxdWV1ZSBuYW1lJywKCiAgICAgICAgICAgICAgICBMb2NrSUQgICAgICAgID0+IDEyMywgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBvcHRpb25hbAogICAgICAgICAgICAgICAgTG9jayAgICAgICAgICA9PiAnc29tZSBsb2NrIG5hbWUnLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgb3B0aW9uYWwKICAgICAgICAgICAgICAgIFR5cGVJRCAgICAgICAgPT4gMTIzLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIG9wdGlvbmFsCiAgICAgICAgICAgICAgICBUeXBlICAgICAgICAgID0+ICdzb21lIHR5cGUgbmFtZScsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBvcHRpb25hbAogICAgICAgICAgICAgICAgU2VydmljZUlEICAgICA9PiAxMjMsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgb3B0aW9uYWwKICAgICAgICAgICAgICAgIFNlcnZpY2UgICAgICAgPT4gJ3NvbWUgc2VydmljZSBuYW1lJywgICAgICAgICAgICAgICAgICAgICAgICAgICAjIG9wdGlvbmFsCiAgICAgICAgICAgICAgICBTTEFJRCAgICAgICAgID0+IDEyMywgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBvcHRpb25hbAogICAgICAgICAgICAgICAgU0xBICAgICAgICAgICA9PiAnc29tZSBTTEEgbmFtZScsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgb3B0aW9uYWwKCiAgICAgICAgICAgICAgICBTdGF0ZUlEICAgICAgID0+IDEyMywgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBTdGF0ZUlEIG9yIFN0YXRlIGlzIHJlcXVpcmVkCiAgICAgICAgICAgICAgICBTdGF0ZSAgICAgICAgID0+ICdzb21lIHN0YXRlIG5hbWUnLAoKICAgICAgICAgICAgICAgIFByaW9yaXR5SUQgICAgPT4gMTIzLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFByaW9yaXR5SUQgb3IgUHJpb3JpdHkgaXMgcmVxdWlyZWQKICAgICAgICAgICAgICAgIFByaW9yaXR5ICAgICAgPT4gJ3NvbWUgcHJpb3JpdHkgbmFtZScsCgogICAgICAgICAgICAgICAgT3duZXJJRCAgICAgICA9PiAxMjMsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgb3B0aW9uYWwKICAgICAgICAgICAgICAgIE93bmVyICAgICAgICAgPT4gJ3NvbWUgdXNlciBsb2dpbicsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIG9wdGlvbmFsCiAgICAgICAgICAgICAgICBSZXNwb25zaWJsZUlEID0+IDEyMywgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBvcHRpb25hbAogICAgICAgICAgICAgICAgUmVzcG9uc2libGUgICA9PiAnc29tZSB1c2VyIGxvZ2luJywgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgb3B0aW9uYWwKICAgICAgICAgICAgICAgIEN1c3RvbWVyVXNlciAgPT4gJ3NvbWUgY3VzdG9tZXIgdXNlciBsb2dpbicsCgogICAgICAgICAgICAgICAgUGVuZGluZ1RpbWUgeyAgICAgICAjIG9wdGlvbmFsCiAgICAgICAgICAgICAgICAgICAgWWVhciAgID0+IDIwMTEsCiAgICAgICAgICAgICAgICAgICAgTW9udGggID0+IDEyCiAgICAgICAgICAgICAgICAgICAgRGF5ICAgID0+IDAzLAogICAgICAgICAgICAgICAgICAgIEhvdXIgICA9PiAyMywKICAgICAgICAgICAgICAgICAgICBNaW51dGUgPT4gMDUsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgIyBvcgogICAgICAgICAgICAgICAgIyBQZW5kaW5nVGltZSB7CiAgICAgICAgICAgICAgICAjICAgICBEaWZmID0+IDEwMDgwLCAjIFBlbmRpbmcgdGltZSBpbiBtaW51dGVzCiAgICAgICAgICAgICAgICAjfSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgQXJ0aWNsZSA9PiB7CiAgICAgICAgICAgICAgICBDb21tdW5pY2F0aW9uQ2hhbm5lbCAgICAgICAgICAgID0+ICdFbWFpbCcsICAgICAgICAgICAgICAgICAgICAjIG9wdGlvbmFsCiAgICAgICAgICAgICAgICBDb21tdW5pY2F0aW9uQ2hhbm5lbElEICAgICAgICAgID0+IDEsICAgICAgICAgICAgICAgICAgICAgICAgICAjIG9wdGlvbmFsCiAgICAgICAgICAgICAgICBJc1Zpc2libGVGb3JDdXN0b21lciAgICAgICAgICAgID0+IDEsICAgICAgICAgICAgICAgICAgICAgICAgICAjIG9wdGlvbmFsCiAgICAgICAgICAgICAgICBTZW5kZXJUeXBlSUQgICAgICAgICAgICAgICAgICAgID0+IDEyMywgICAgICAgICAgICAgICAgICAgICAgICAjIG9wdGlvbmFsCiAgICAgICAgICAgICAgICBTZW5kZXJUeXBlICAgICAgICAgICAgICAgICAgICAgID0+ICdzb21lIHNlbmRlciB0eXBlIG5hbWUnLCAgICAjIG9wdGlvbmFsCiAgICAgICAgICAgICAgICBBdXRvUmVzcG9uc2VUeXBlICAgICAgICAgICAgICAgID0+ICdzb21lIGF1dG8gcmVzcG9uc2UgdHlwZScsICAjIG9wdGlvbmFsCiAgICAgICAgICAgICAgICBBcnRpY2xlU2VuZCAgICAgICAgICAgICAgICAgICAgID0+IDEsICAgICAgICAgICAgICAgICAgICAgICAgICAjIG9wdGlvbmFsCiAgICAgICAgICAgICAgICBGcm9tICAgICAgICAgICAgICAgICAgICAgICAgICAgID0+ICdzb21lIGZyb20gc3RyaW5nJywgICAgICAgICAjIG9wdGlvbmFsCiAgICAgICAgICAgICAgICBUbyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID0+ICdzb21lIHRvIGFkZHJlc3MnLCAgICAgICAgICAjIG9wdGlvbmFsLCByZXF1aXJlZCBpZiBBcnRpY2xlU2VuZCA9PiAxCiAgICAgICAgICAgICAgICBDYyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID0+ICdzb21lIENjIGFkZHJlc3MnLCAgICAgICAgICAjIG9wdGlvbmFsCiAgICAgICAgICAgICAgICBCY2MgICAgICAgICAgICAgICAgICAgICAgICAgICAgID0+ICdzb21lIEJjYyBhZGRyZXNzJywgICAgICAgICAjIG9wdGlvbmFsCiAgICAgICAgICAgICAgICBTdWJqZWN0ICAgICAgICAgICAgICAgICAgICAgICAgID0+ICdzb21lIHN1YmplY3QnLAogICAgICAgICAgICAgICAgQm9keSAgICAgICAgICAgICAgICAgICAgICAgICAgICA9PiAnc29tZSBib2R5JywKICAgICAgICAgICAgICAgIENvbnRlbnRUeXBlICAgICAgICAgICAgICAgICAgICAgPT4gJ3NvbWUgY29udGVudCB0eXBlJywgICAgICAgICMgQ29udGVudFR5cGUgb3IgTWltZVR5cGUgYW5kIENoYXJzZXQgaXMgcmVxdWlyZWQKICAgICAgICAgICAgICAgIE1pbWVUeXBlICAgICAgICAgICAgICAgICAgICAgICAgPT4gJ3NvbWUgbWltZSB0eXBlJywKICAgICAgICAgICAgICAgIENoYXJzZXQgICAgICAgICAgICAgICAgICAgICAgICAgPT4gJ3NvbWUgY2hhcnNldCcsCiAgICAgICAgICAgICAgICBIaXN0b3J5VHlwZSAgICAgICAgICAgICAgICAgICAgID0+ICdzb21lIGhpc3RvcnkgdHlwZScsICAgICAgICAjIG9wdGlvbmFsCiAgICAgICAgICAgICAgICBIaXN0b3J5Q29tbWVudCAgICAgICAgICAgICAgICAgID0+ICdTb21lICBoaXN0b3J5IGNvbW1lbnQnLCAgICAjIG9wdGlvbmFsCiAgICAgICAgICAgICAgICBUaW1lVW5pdCAgICAgICAgICAgICAgICAgICAgICAgID0+IDEyMywgICAgICAgICAgICAgICAgICAgICAgICAjIG9wdGlvbmFsCiAgICAgICAgICAgICAgICBOb0FnZW50Tm90aWZ5ICAgICAgICAgICAgICAgICAgID0+IDEsICAgICAgICAgICAgICAgICAgICAgICAgICAjIG9wdGlvbmFsCiAgICAgICAgICAgICAgICBGb3JjZU5vdGlmaWNhdGlvblRvVXNlcklEICAgICAgID0+IFsxLCAyLCAzXSAgICAgICAgICAgICAgICAgICAjIG9wdGlvbmFsCiAgICAgICAgICAgICAgICBFeGNsdWRlTm90aWZpY2F0aW9uVG9Vc2VySUQgICAgID0+IFsxLCAyLCAzXSAgICAgICAgICAgICAgICAgICAjIG9wdGlvbmFsCiAgICAgICAgICAgICAgICBFeGNsdWRlTXV0ZU5vdGlmaWNhdGlvblRvVXNlcklEID0+IFsxLCAyLCAzXSAgICAgICAgICAgICAgICAgICAjIG9wdGlvbmFsCgogICAgICAgICAgICAgICAgIyBTaWduaW5nIGFuZCBlbmNyeXB0aW9uLCBvbmx5IHVzZWQgd2hlbiBBcnRpY2xlU2VuZCBpcyBzZXQgdG8gMQogICAgICAgICAgICAgICAgU2lnbiA9PiB7CiAgICAgICAgICAgICAgICAgICAgVHlwZSAgICA9PiAnUEdQJywKICAgICAgICAgICAgICAgICAgICBTdWJUeXBlID0+ICdJbmxpbmV8RGV0YWNoZWQnLAogICAgICAgICAgICAgICAgICAgIEtleSAgICAgPT4gJzgxODc3RjVFJywKICAgICAgICAgICAgICAgICAgICBUeXBlICAgID0+ICdTTUlNRScsCiAgICAgICAgICAgICAgICAgICAgS2V5ICAgICA9PiAnM2I2MzBjODAnLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIENyeXB0ID0+IHsKICAgICAgICAgICAgICAgICAgICBUeXBlICAgID0+ICdQR1AnLAogICAgICAgICAgICAgICAgICAgIFN1YlR5cGUgPT4gJ0lubGluZXxEZXRhY2hlZCcsCiAgICAgICAgICAgICAgICAgICAgS2V5ICAgICA9PiAnODE4NzdGNUUnLAogICAgICAgICAgICAgICAgICAgIFR5cGUgICAgPT4gJ1NNSU1FJywKICAgICAgICAgICAgICAgICAgICBLZXkgICAgID0+ICczYjYzMGM4MCcsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9LAoKICAgICAgICAgICAgIyBvciBhcnJheSBvZiBhcnRpY2xlczoKICAgICAgICAgICAgQXJ0aWNsZSA9PiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgQ29tbXVuaWNhdGlvbkNoYW5uZWwgICAgICAgICAgICA9PiAnRW1haWwnLCAgICAgICAgICAgICAgICAgICAgIyBvcHRpb25hbAogICAgICAgICAgICAgICAgICAgIENvbW11bmljYXRpb25DaGFubmVsSUQgICAgICAgICAgPT4gMSwgICAgICAgICAgICAgICAgICAgICAgICAgICMgb3B0aW9uYWwKICAgICAgICAgICAgICAgICAgICBJc1Zpc2libGVGb3JDdXN0b21lciAgICAgICAgICAgID0+IDEsICAgICAgICAgICAgICAgICAgICAgICAgICAjIG9wdGlvbmFsCiAgICAgICAgICAgICAgICAgICAgU2VuZGVyVHlwZUlEICAgICAgICAgICAgICAgICAgICA9PiAxMjMsICAgICAgICAgICAgICAgICAgICAgICAgIyBvcHRpb25hbAogICAgICAgICAgICAgICAgICAgIFNlbmRlclR5cGUgICAgICAgICAgICAgICAgICAgICAgPT4gJ3NvbWUgc2VuZGVyIHR5cGUgbmFtZScsICAgICMgb3B0aW9uYWwKICAgICAgICAgICAgICAgICAgICBBdXRvUmVzcG9uc2VUeXBlICAgICAgICAgICAgICAgID0+ICdzb21lIGF1dG8gcmVzcG9uc2UgdHlwZScsICAjIG9wdGlvbmFsCiAgICAgICAgICAgICAgICAgICAgRnJvbSAgICAgICAgICAgICAgICAgICAgICAgICAgICA9PiAnc29tZSBmcm9tIHN0cmluZycsICAgICAgICAgIyBvcHRpb25hbAogICAgICAgICAgICAgICAgICAgIFN1YmplY3QgICAgICAgICAgICAgICAgICAgICAgICAgPT4gJ3NvbWUgc3ViamVjdCcsCiAgICAgICAgICAgICAgICAgICAgQm9keSAgICAgICAgICAgICAgICAgICAgICAgICAgICA9PiAnc29tZSBib2R5JywKICAgICAgICAgICAgICAgICAgICBDb250ZW50VHlwZSAgICAgICAgICAgICAgICAgICAgID0+ICdzb21lIGNvbnRlbnQgdHlwZScsICAgICAgICAjIENvbnRlbnRUeXBlIG9yIE1pbWVUeXBlIGFuZCBDaGFyc2V0IGlzIHJlcXVpcmVkCiAgICAgICAgICAgICAgICAgICAgTWltZVR5cGUgICAgICAgICAgICAgICAgICAgICAgICA9PiAnc29tZSBtaW1lIHR5cGUnLAogICAgICAgICAgICAgICAgICAgIENoYXJzZXQgICAgICAgICAgICAgICAgICAgICAgICAgPT4gJ3NvbWUgY2hhcnNldCcsCiAgICAgICAgICAgICAgICAgICAgSGlzdG9yeVR5cGUgICAgICAgICAgICAgICAgICAgICA9PiAnc29tZSBoaXN0b3J5IHR5cGUnLCAgICAgICAgIyBvcHRpb25hbAogICAgICAgICAgICAgICAgICAgIEhpc3RvcnlDb21tZW50ICAgICAgICAgICAgICAgICAgPT4gJ1NvbWUgIGhpc3RvcnkgY29tbWVudCcsICAgICMgb3B0aW9uYWwKICAgICAgICAgICAgICAgICAgICBUaW1lVW5pdCAgICAgICAgICAgICAgICAgICAgICAgID0+IDEyMywgICAgICAgICAgICAgICAgICAgICAgICAjIG9wdGlvbmFsCiAgICAgICAgICAgICAgICAgICAgTm9BZ2VudE5vdGlmeSAgICAgICAgICAgICAgICAgICA9PiAxLCAgICAgICAgICAgICAgICAgICAgICAgICAgIyBvcHRpb25hbAogICAgICAgICAgICAgICAgICAgIEZvcmNlTm90aWZpY2F0aW9uVG9Vc2VySUQgICAgICAgPT4gWzEsIDIsIDNdICAgICAgICAgICAgICAgICAgICMgb3B0aW9uYWwKICAgICAgICAgICAgICAgICAgICBFeGNsdWRlTm90aWZpY2F0aW9uVG9Vc2VySUQgICAgID0+IFsxLCAyLCAzXSAgICAgICAgICAgICAgICAgICAjIG9wdGlvbmFsCiAgICAgICAgICAgICAgICAgICAgRXhjbHVkZU11dGVOb3RpZmljYXRpb25Ub1VzZXJJRCA9PiBbMSwgMiwgM10gICAgICAgICAgICAgICAgICAgIyBvcHRpb25hbAogICAgICAgICAgICAgICAgICAgIEF0dGFjaG1lbnQgPT4gWwogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb250ZW50ICAgICA9PiAnY29udGVudCcgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGJhc2U2NCBlbmNvZGVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb250ZW50VHlwZSA9PiAnc29tZSBjb250ZW50IHR5cGUnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGaWxlbmFtZSAgICA9PiAnc29tZSBmaW5lIG5hbWUnCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICMgLi4uCiAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAjIC4uLgogICAgICAgICAgICBdLAoKCiAgICAgICAgICAgIER5bmFtaWNGaWVsZCA9PiBbICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIG9wdGlvbmFsCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgTmFtZSAgID0+ICdzb21lIG5hbWUnLAogICAgICAgICAgICAgICAgICAgIFZhbHVlICA9PiAkVmFsdWUsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyB2YWx1ZSB0eXBlIGRlcGVuZHMgb24gdGhlIGR5bmFtaWMgZmllbGQKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAjIC4uLgogICAgICAgICAgICBdLAogICAgICAgICAgICAjIG9yCiAgICAgICAgICAgICMgRHluYW1pY0ZpZWxkID0+IHsKICAgICAgICAgICAgIyAgICBOYW1lICAgPT4gJ3NvbWUgbmFtZScsCiAgICAgICAgICAgICMgICAgVmFsdWUgID0+ICRWYWx1ZSwKICAgICAgICAgICAgI30sCgogICAgICAgICAgICBBdHRhY2htZW50ID0+IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBDb250ZW50ICAgICA9PiAnY29udGVudCcgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGJhc2U2NCBlbmNvZGVkCiAgICAgICAgICAgICAgICAgICAgQ29udGVudFR5cGUgPT4gJ3NvbWUgY29udGVudCB0eXBlJwogICAgICAgICAgICAgICAgICAgIEZpbGVuYW1lICAgID0+ICdzb21lIGZpbmUgbmFtZScKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAjIC4uLgogICAgICAgICAgICBdLAogICAgICAgICAgICAjb3IKICAgICAgICAgICAgI0F0dGFjaG1lbnQgPT4gewogICAgICAgICAgICAjICAgIENvbnRlbnQgICAgID0+ICdjb250ZW50JwogICAgICAgICAgICAjICAgIENvbnRlbnRUeXBlID0+ICdzb21lIGNvbnRlbnQgdHlwZScKICAgICAgICAgICAgIyAgICBGaWxlbmFtZSAgICA9PiAnc29tZSBmaW5lIG5hbWUnCiAgICAgICAgICAgICN9LAogICAgICAgIH0sCiAgICApOwoKICAgICRSZXN1bHQgPSB7CiAgICAgICAgU3VjY2VzcyAgICAgICAgID0+IDEsICAgICAgICAgICAgICAgICAgICAgICAjIDAgb3IgMQogICAgICAgIEVycm9yTWVzc2FnZSAgICA9PiAnJywgICAgICAgICAgICAgICAgICAgICAgIyBpbiBjYXNlIG9mIGVycm9yCiAgICAgICAgRGF0YSAgICAgICAgICAgID0+IHsgICAgICAgICAgICAgICAgICAgICAgICAjIHJlc3VsdCBkYXRhIHBheWxvYWQgYWZ0ZXIgT3BlcmF0aW9uCiAgICAgICAgICAgIFRpY2tldElEICAgID0+IDEyMywgICAgICAgICAgICAgICAgICAgICAjIFRpY2tldCBJRCBabnVueQogICAgICAgICAgICBUaWNrZXROdW1iZXIgPT4gMjMyNDQ1NDMyMzMyMiAgICAgICAgICAgIyBUaWNrZXQgbnVtYmVyIGluIFpudW55CiAgICAgICAgICAgIEFydGljbGVJRCAgID0+IDQzLCAgICAgICAgICAgICAgICAgICAgICAjIEFydGljbGUgSUQgaW4gWm51bnkKICAgICAgICAgICAgRXJyb3IgPT4geyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgc2hvdWxkIG5vdCByZXR1cm4gZXJyb3JzCiAgICAgICAgICAgICAgICAgICAgRXJyb3JDb2RlICAgID0+ICdUaWNrZXQuQ3JlYXRlLkVycm9yQ29kZScKICAgICAgICAgICAgICAgICAgICBFcnJvck1lc3NhZ2UgPT4gJ0Vycm9yIERlc2NyaXB0aW9uJwogICAgICAgICAgICB9LAoKICAgICAgICAgICAgIyBJZiBJbmNsdWRlVGlja2V0RGF0YSBpcyBlbmFibGVkCiAgICAgICAgICAgIFRpY2tldCA9PiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgVGlja2V0TnVtYmVyICAgICAgID0+ICcyMDEwMTAyNzAwMDAwMScsCiAgICAgICAgICAgICAgICAgICAgVGl0bGUgICAgICAgICAgICAgID0+ICdzb21lIHRpdGxlJywKICAgICAgICAgICAgICAgICAgICBUaWNrZXRJRCAgICAgICAgICAgPT4gMTIzLAogICAgICAgICAgICAgICAgICAgIFN0YXRlICAgICAgICAgICAgICA9PiAnc29tZSBzdGF0ZScsCiAgICAgICAgICAgICAgICAgICAgU3RhdGVJRCAgICAgICAgICAgID0+IDEyMywKICAgICAgICAgICAgICAgICAgICBTdGF0ZVR5cGUgICAgICAgICAgPT4gJ3NvbWUgc3RhdGUgdHlwZScsCiAgICAgICAgICAgICAgICAgICAgUHJpb3JpdHkgICAgICAgICAgID0+ICdzb21lIHByaW9yaXR5JywKICAgICAgICAgICAgICAgICAgICBQcmlvcml0eUlEICAgICAgICAgPT4gMTIzLAogICAgICAgICAgICAgICAgICAgIExvY2sgICAgICAgICAgICAgICA9PiAnbG9jaycsCiAgICAgICAgICAgICAgICAgICAgTG9ja0lEICAgICAgICAgICAgID0+IDEyMywKICAgICAgICAgICAgICAgICAgICBRdWV1ZSAgICAgICAgICAgICAgPT4gJ3NvbWUgcXVldWUnLAogICAgICAgICAgICAgICAgICAgIFF1ZXVlSUQgICAgICAgICAgICA9PiAxMjMsCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJJRCAgICAgICAgID0+ICdjdXN0b21lcl9pZF8xMjMnLAogICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyVXNlcklEICAgICA9PiAnY3VzdG9tZXJfdXNlcl9pZF8xMjMnLAogICAgICAgICAgICAgICAgICAgIE93bmVyICAgICAgICAgICAgICA9PiAnc29tZV9vd25lcl9sb2dpbicsCiAgICAgICAgICAgICAgICAgICAgT3duZXJJRCAgICAgICAgICAgID0+IDEyMywKICAgICAgICAgICAgICAgICAgICBUeXBlICAgICAgICAgICAgICAgPT4gJ3NvbWUgdGlja2V0IHR5cGUnLAogICAgICAgICAgICAgICAgICAgIFR5cGVJRCAgICAgICAgICAgICA9PiAxMjMsCiAgICAgICAgICAgICAgICAgICAgU0xBICAgICAgICAgICAgICAgID0+ICdzb21lIHNsYScsCiAgICAgICAgICAgICAgICAgICAgU0xBSUQgICAgICAgICAgICAgID0+IDEyMywKICAgICAgICAgICAgICAgICAgICBTZXJ2aWNlICAgICAgICAgICAgPT4gJ3NvbWUgc2VydmljZScsCiAgICAgICAgICAgICAgICAgICAgU2VydmljZUlEICAgICAgICAgID0+IDEyMywKICAgICAgICAgICAgICAgICAgICBSZXNwb25zaWJsZSAgICAgICAgPT4gJ3NvbWVfcmVzcG9uc2libGVfbG9naW4nLAogICAgICAgICAgICAgICAgICAgIFJlc3BvbnNpYmxlSUQgICAgICA9PiAxMjMsCiAgICAgICAgICAgICAgICAgICAgQWdlICAgICAgICAgICAgICAgID0+IDM0NTYsCiAgICAgICAgICAgICAgICAgICAgQ3JlYXRlZCAgICAgICAgICAgID0+ICcyMDEwLTEwLTI3IDIwOjE1OjAwJwogICAgICAgICAgICAgICAgICAgIENyZWF0ZUJ5ICAgICAgICAgICA9PiAxMjMsCiAgICAgICAgICAgICAgICAgICAgQ2hhbmdlZCAgICAgICAgICAgID0+ICcyMDEwLTEwLTI3IDIwOjE1OjE1JywKICAgICAgICAgICAgICAgICAgICBDaGFuZ2VCeSAgICAgICAgICAgPT4gMTIzLAogICAgICAgICAgICAgICAgICAgIEFyY2hpdmVGbGFnICAgICAgICA9PiAneScsCgogICAgICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZCA9PiBbCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgID0+ICdzb21lIG5hbWUnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWUgPT4gJ3NvbWUgdmFsdWUnLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIF0sCgogICAgICAgICAgICAgICAgICAgICMgKHRpbWUgc3RhbXBzIG9mIGV4cGVjdGVkIGVzY2FsYXRpb25zKQogICAgICAgICAgICAgICAgICAgIEVzY2FsYXRpb25SZXNwb25zZVRpbWUgICAgICAgICAgICh1bml4IHRpbWUgc3RhbXAgb2YgcmVzcG9uc2UgdGltZSBlc2NhbGF0aW9uKQogICAgICAgICAgICAgICAgICAgIEVzY2FsYXRpb25VcGRhdGVUaW1lICAgICAgICAgICAgICh1bml4IHRpbWUgc3RhbXAgb2YgdXBkYXRlIHRpbWUgZXNjYWxhdGlvbikKICAgICAgICAgICAgICAgICAgICBFc2NhbGF0aW9uU29sdXRpb25UaW1lICAgICAgICAgICAodW5peCB0aW1lIHN0YW1wIG9mIHNvbHV0aW9uIHRpbWUgZXNjYWxhdGlvbikKCiAgICAgICAgICAgICAgICAgICAgIyAoZ2VuZXJhbCBlc2NhbGF0aW9uIGluZm8gb2YgbmVhcmVzdCBlc2NhbGF0aW9uIHR5cGUpCiAgICAgICAgICAgICAgICAgICAgRXNjYWxhdGlvbkRlc3RpbmF0aW9uSW4gICAgICAgICAgKGVzY2FsYXRpb24gaW4gZS4gZy4gMWggNG0pCiAgICAgICAgICAgICAgICAgICAgRXNjYWxhdGlvbkRlc3RpbmF0aW9uVGltZSAgICAgICAgKGRhdGUgb2YgZXNjYWxhdGlvbiBpbiB1bml4IHRpbWUsIGUuIGcuIDcyMTkzMjkyKQogICAgICAgICAgICAgICAgICAgIEVzY2FsYXRpb25EZXN0aW5hdGlvbkRhdGUgICAgICAgIChkYXRlIG9mIGVzY2FsYXRpb24sIGUuIGcuICIyMDA5LTAyLTE0IDE4OjAwOjAwIikKICAgICAgICAgICAgICAgICAgICBFc2NhbGF0aW9uVGltZVdvcmtpbmdUaW1lICAgICAgICAoc2Vjb25kcyBvZiB3b3JraW5nL3NlcnZpY2UgdGltZSB0aWxsIGVzY2FsYXRpb24sIGUuIGcuICIxODAwIikKICAgICAgICAgICAgICAgICAgICBFc2NhbGF0aW9uVGltZSAgICAgICAgICAgICAgICAgICAoc2Vjb25kcyB0b3RhbCB0aWxsIGVzY2FsYXRpb24gb2YgbmVhcmVzdCBlc2NhbGF0aW9uIHRpbWUgdHlwZSAtIHJlc3BvbnNlLCB1cGRhdGUgb3Igc29sdXRpb24gdGltZSwgZS4gZy4gIjM2MDAiKQoKICAgICAgICAgICAgICAgICAgICAjIChkZXRhaWxlZCBlc2NhbGF0aW9uIGluZm8gYWJvdXQgZmlyc3QgcmVzcG9uc2UsIHVwZGF0ZSBhbmQgc29sdXRpb24gdGltZSkKICAgICAgICAgICAgICAgICAgICBGaXJzdFJlc3BvbnNlVGltZUVzY2FsYXRpb24gICAgICAoaWYgdHJ1ZSwgdGlja2V0IGlzIGVzY2FsYXRlZCkKICAgICAgICAgICAgICAgICAgICBGaXJzdFJlc3BvbnNlVGltZU5vdGlmaWNhdGlvbiAgICAoaWYgdHJ1ZSwgbm90aWZ5IC0geCUgb2YgZXNjYWxhdGlvbiBoYXMgcmVhY2hlZCkKICAgICAgICAgICAgICAgICAgICBGaXJzdFJlc3BvbnNlVGltZURlc3RpbmF0aW9uVGltZSAoZGF0ZSBvZiBlc2NhbGF0aW9uIGluIHVuaXggdGltZSwgZS4gZy4gNzIxOTMyOTIpCiAgICAgICAgICAgICAgICAgICAgRmlyc3RSZXNwb25zZVRpbWVEZXN0aW5hdGlvbkRhdGUgKGRhdGUgb2YgZXNjYWxhdGlvbiwgZS4gZy4gIjIwMDktMDItMTQgMTg6MDA6MDAiKQogICAgICAgICAgICAgICAgICAgIEZpcnN0UmVzcG9uc2VUaW1lV29ya2luZ1RpbWUgICAgIChzZWNvbmRzIG9mIHdvcmtpbmcvc2VydmljZSB0aW1lIHRpbGwgZXNjYWxhdGlvbiwgZS4gZy4gIjE4MDAiKQogICAgICAgICAgICAgICAgICAgIEZpcnN0UmVzcG9uc2VUaW1lICAgICAgICAgICAgICAgIChzZWNvbmRzIHRvdGFsIHRpbGwgZXNjYWxhdGlvbiwgZS4gZy4gIjM2MDAiKQoKICAgICAgICAgICAgICAgICAgICBVcGRhdGVUaW1lRXNjYWxhdGlvbiAgICAgICAgICAgICAoaWYgdHJ1ZSwgdGlja2V0IGlzIGVzY2FsYXRlZCkKICAgICAgICAgICAgICAgICAgICBVcGRhdGVUaW1lTm90aWZpY2F0aW9uICAgICAgICAgICAoaWYgdHJ1ZSwgbm90aWZ5IC0geCUgb2YgZXNjYWxhdGlvbiBoYXMgcmVhY2hlZCkKICAgICAgICAgICAgICAgICAgICBVcGRhdGVUaW1lRGVzdGluYXRpb25UaW1lICAgICAgICAoZGF0ZSBvZiBlc2NhbGF0aW9uIGluIHVuaXggdGltZSwgZS4gZy4gNzIxOTMyOTIpCiAgICAgICAgICAgICAgICAgICAgVXBkYXRlVGltZURlc3RpbmF0aW9uRGF0ZSAgICAgICAgKGRhdGUgb2YgZXNjYWxhdGlvbiwgZS4gZy4gIjIwMDktMDItMTQgMTg6MDA6MDAiKQogICAgICAgICAgICAgICAgICAgIFVwZGF0ZVRpbWVXb3JraW5nVGltZSAgICAgICAgICAgIChzZWNvbmRzIG9mIHdvcmtpbmcvc2VydmljZSB0aW1lIHRpbGwgZXNjYWxhdGlvbiwgZS4gZy4gIjE4MDAiKQogICAgICAgICAgICAgICAgICAgIFVwZGF0ZVRpbWUgICAgICAgICAgICAgICAgICAgICAgIChzZWNvbmRzIHRvdGFsIHRpbGwgZXNjYWxhdGlvbiwgZS4gZy4gIjM2MDAiKQoKICAgICAgICAgICAgICAgICAgICBTb2x1dGlvblRpbWVFc2NhbGF0aW9uICAgICAgICAgICAoaWYgdHJ1ZSwgdGlja2V0IGlzIGVzY2FsYXRlZCkKICAgICAgICAgICAgICAgICAgICBTb2x1dGlvblRpbWVOb3RpZmljYXRpb24gICAgICAgICAoaWYgdHJ1ZSwgbm90aWZ5IC0geCUgb2YgZXNjYWxhdGlvbiBoYXMgcmVhY2hlZCkKICAgICAgICAgICAgICAgICAgICBTb2x1dGlvblRpbWVEZXN0aW5hdGlvblRpbWUgICAgICAoZGF0ZSBvZiBlc2NhbGF0aW9uIGluIHVuaXggdGltZSwgZS4gZy4gNzIxOTMyOTIpCiAgICAgICAgICAgICAgICAgICAgU29sdXRpb25UaW1lRGVzdGluYXRpb25EYXRlICAgICAgKGRhdGUgb2YgZXNjYWxhdGlvbiwgZS4gZy4gIjIwMDktMDItMTQgMTg6MDA6MDAiKQogICAgICAgICAgICAgICAgICAgIFNvbHV0aW9uVGltZVdvcmtpbmdUaW1lICAgICAgICAgIChzZWNvbmRzIG9mIHdvcmtpbmcvc2VydmljZSB0aW1lIHRpbGwgZXNjYWxhdGlvbiwgZS4gZy4gIjE4MDAiKQogICAgICAgICAgICAgICAgICAgIFNvbHV0aW9uVGltZSAgICAgICAgICAgICAgICAgICAgIChzZWNvbmRzIHRvdGFsIHRpbGwgZXNjYWxhdGlvbiwgZS4gZy4gIjM2MDAiKQoKICAgICAgICAgICAgICAgICAgICBBcnRpY2xlID0+IFsKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXJ0aWNsZUlECiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGcm9tCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2MKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN1YmplY3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvZHkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlcGx5VG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VJRAogICAgICAgICAgICAgICAgICAgICAgICAgICAgSW5SZXBseVRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWZlcmVuY2VzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZW5kZXJUeXBlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZW5kZXJUeXBlSUQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbW11bmljYXRpb25DaGFubmVsSUQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIElzVmlzaWJsZUZvckN1c3RvbWVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb250ZW50VHlwZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2hhcnNldAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTWltZVR5cGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEluY29taW5nVGltZQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZCA9PiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOYW1lICA9PiAnc29tZSBuYW1lJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWUgPT4gJ3NvbWUgdmFsdWUnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEF0dGFjaG1lbnQgPT4gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29udGVudCAgICAgICAgICAgID0+ICJ4eHh4IiwgICAgICMgYWN0dWFsIGF0dGFjaG1lbnQgY29udGVudHMsIGJhc2U2NCBlbmNvZGVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbnRlbnRBbHRlcm5hdGl2ZSA9PiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29udGVudElEICAgICAgICAgID0+ICIiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb250ZW50VHlwZSAgICAgICAgPT4gImFwcGxpY2F0aW9uL3BkZiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZpbGVuYW1lICAgICAgICAgICA9PiAiU3RkQXR0YWNobWVudC1UZXN0MS5wZGYiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGaWxlc2l6ZSAgICAgICAgICAgPT4gIjQuNiBLQnl0ZXMiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGaWxlc2l6ZVJhdyAgICAgICAgPT4gNDcyMiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgXSwKICAgICAgICB9LAogICAgfTsKCj1jdXQKCnN1YiBSdW4gewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkUmVzdWx0ID0gJFNlbGYtPkluaXQoCiAgICAgICAgV2Vic2VydmljZUlEID0+ICRTZWxmLT57V2Vic2VydmljZUlEfSwKICAgICk7CgogICAgaWYgKCAhJFJlc3VsdC0+e1N1Y2Nlc3N9ICkgewogICAgICAgICRTZWxmLT5SZXR1cm5FcnJvcigKICAgICAgICAgICAgRXJyb3JDb2RlICAgID0+ICdXZWJzZXJ2aWNlLkludmFsaWRDb25maWd1cmF0aW9uJywKICAgICAgICAgICAgRXJyb3JNZXNzYWdlID0+ICRSZXN1bHQtPntFcnJvck1lc3NhZ2V9LAogICAgICAgICk7CiAgICB9CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIGlmICgKICAgICAgICAhJFBhcmFte0RhdGF9LT57VXNlckxvZ2lufQogICAgICAgICYmICEkUGFyYW17RGF0YX0tPntDdXN0b21lclVzZXJMb2dpbn0KICAgICAgICAmJiAhJFBhcmFte0RhdGF9LT57U2Vzc2lvbklEfQogICAgICAgICkKICAgIHsKICAgICAgICByZXR1cm4gJFNlbGYtPlJldHVybkVycm9yKAogICAgICAgICAgICBFcnJvckNvZGUgICAgPT4gJ1RpY2tldENyZWF0ZS5NaXNzaW5nUGFyYW1ldGVyJywKICAgICAgICAgICAgRXJyb3JNZXNzYWdlID0+ICJUaWNrZXRDcmVhdGU6IFVzZXJMb2dpbiwgQ3VzdG9tZXJVc2VyTG9naW4gb3IgU2Vzc2lvbklEIGlzIHJlcXVpcmVkISIsCiAgICAgICAgKTsKICAgIH0KCiAgICBpZiAoICRQYXJhbXtEYXRhfS0+e1VzZXJMb2dpbn0gfHwgJFBhcmFte0RhdGF9LT57Q3VzdG9tZXJVc2VyTG9naW59ICkgewoKICAgICAgICBpZiAoICEkUGFyYW17RGF0YX0tPntQYXNzd29yZH0gKQogICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuICRTZWxmLT5SZXR1cm5FcnJvcigKICAgICAgICAgICAgICAgIEVycm9yQ29kZSAgICA9PiAnVGlja2V0Q3JlYXRlLk1pc3NpbmdQYXJhbWV0ZXInLAogICAgICAgICAgICAgICAgRXJyb3JNZXNzYWdlID0+ICJUaWNrZXRDcmVhdGU6IFBhc3N3b3JkIG9yIFNlc3Npb25JRCBpcyByZXF1aXJlZCEiLAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICAjIGF1dGhlbnRpY2F0ZSB1c2VyCiAgICBteSAoICRVc2VySUQsICRVc2VyVHlwZSApID0gJFNlbGYtPkF1dGgoCiAgICAgICAgJVBhcmFtLAogICAgKTsKCiAgICBpZiAoICEkVXNlcklEICkgewogICAgICAgIHJldHVybiAkU2VsZi0+UmV0dXJuRXJyb3IoCiAgICAgICAgICAgIEVycm9yQ29kZSAgICA9PiAnVGlja2V0Q3JlYXRlLkF1dGhGYWlsJywKICAgICAgICAgICAgRXJyb3JNZXNzYWdlID0+ICJUaWNrZXRDcmVhdGU6IFVzZXIgY291bGQgbm90IGJlIGF1dGhlbnRpY2F0ZWQhIiwKICAgICAgICApOwogICAgfQoKICAgIG15ICRQZXJtaXNzaW9uVXNlcklEID0gJFVzZXJJRDsKICAgIGlmICggJFVzZXJUeXBlIGVxICdDdXN0b21lcicgKSB7CiAgICAgICAgJFVzZXJJRCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnQ3VzdG9tZXJQYW5lbFVzZXJJRCcpOwogICAgfQoKICAgICMgY2hlY2sgbmVlZGVkIGhhc2hlcwogICAgaWYgKCAhSXNIYXNoUmVmV2l0aERhdGEoICRQYXJhbXtEYXRhfS0+e0FydGljbGV9ICkgJiYgIUlzQXJyYXlSZWZXaXRoRGF0YSggJFBhcmFte0RhdGF9LT57QXJ0aWNsZX0gKSApIHsKICAgICAgICByZXR1cm4gJFNlbGYtPlJldHVybkVycm9yKAogICAgICAgICAgICBFcnJvckNvZGUgICAgPT4gJ1RpY2tldENyZWF0ZS5NaXNzaW5nUGFyYW1ldGVyJywKICAgICAgICAgICAgRXJyb3JNZXNzYWdlID0+ICJUaWNrZXRDcmVhdGU6IEFydGljbGUgcGFyYW1ldGVyIGlzIG1pc3Npbmcgb3Igbm90IHZhbGlkISIsCiAgICAgICAgKTsKICAgIH0KCiAgICBmb3IgbXkgJE5lZWRlZCAocXcoVGlja2V0KSkgewogICAgICAgIGlmICggIUlzSGFzaFJlZldpdGhEYXRhKCAkUGFyYW17RGF0YX0tPnskTmVlZGVkfSApICkgewogICAgICAgICAgICByZXR1cm4gJFNlbGYtPlJldHVybkVycm9yKAogICAgICAgICAgICAgICAgRXJyb3JDb2RlICAgID0+ICdUaWNrZXRDcmVhdGUuTWlzc2luZ1BhcmFtZXRlcicsCiAgICAgICAgICAgICAgICBFcnJvck1lc3NhZ2UgPT4gIlRpY2tldENyZWF0ZTogJE5lZWRlZCBwYXJhbWV0ZXIgaXMgbWlzc2luZyBvciBub3QgdmFsaWQhIiwKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CgogICAgIyBjaGVjayBvcHRpb25hbCBhcnJheS9oYXNoZXMKICAgIGZvciBteSAkT3B0aW9uYWwgKHF3KER5bmFtaWNGaWVsZCBBdHRhY2htZW50KSkgewogICAgICAgIGlmICgKICAgICAgICAgICAgZGVmaW5lZCAkUGFyYW17RGF0YX0tPnskT3B0aW9uYWx9CiAgICAgICAgICAgICYmICFJc0hhc2hSZWZXaXRoRGF0YSggJFBhcmFte0RhdGF9LT57JE9wdGlvbmFsfSApCiAgICAgICAgICAgICYmICFJc0FycmF5UmVmV2l0aERhdGEoICRQYXJhbXtEYXRhfS0+eyRPcHRpb25hbH0gKQogICAgICAgICAgICApCiAgICAgICAgewogICAgICAgICAgICByZXR1cm4gJFNlbGYtPlJldHVybkVycm9yKAogICAgICAgICAgICAgICAgRXJyb3JDb2RlICAgID0+ICdUaWNrZXRDcmVhdGUuTWlzc2luZ1BhcmFtZXRlcicsCiAgICAgICAgICAgICAgICBFcnJvck1lc3NhZ2UgPT4gIlRpY2tldENyZWF0ZTogJE9wdGlvbmFsIHBhcmFtZXRlciBpcyBtaXNzaW5nIG9yIG5vdCB2YWxpZCEiLAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICAjIGlzb2xhdGUgdGlja2V0IHBhcmFtZXRlcgogICAgbXkgJFRpY2tldCA9ICRQYXJhbXtEYXRhfS0+e1RpY2tldH07CgogICAgIyByZW1vdmUgbGVhZGluZyBhbmQgdHJhaWxpbmcgc3BhY2VzCiAgICBmb3IgbXkgJEF0dHJpYnV0ZSAoIHNvcnQga2V5cyAleyRUaWNrZXR9ICkgewogICAgICAgIGlmICggcmVmICRBdHRyaWJ1dGUgbmUgJ0hBU0gnICYmIHJlZiAkQXR0cmlidXRlIG5lICdBUlJBWScgKSB7CgogICAgICAgICAgICAjcmVtb3ZlIGxlYWRpbmcgc3BhY2VzCiAgICAgICAgICAgICRUaWNrZXQtPnskQXR0cmlidXRlfSA9fiBze1xBXHMrfXt9OwoKICAgICAgICAgICAgI3JlbW92ZSB0cmFpbGluZyBzcGFjZXMKICAgICAgICAgICAgJFRpY2tldC0+eyRBdHRyaWJ1dGV9ID1+IHN7XHMrXHp9e307CiAgICAgICAgfQogICAgfQogICAgaWYgKCBJc0hhc2hSZWZXaXRoRGF0YSggJFRpY2tldC0+e1BlbmRpbmdUaW1lfSApICkgewogICAgICAgIGZvciBteSAkQXR0cmlidXRlICggc29ydCBrZXlzICV7ICRUaWNrZXQtPntQZW5kaW5nVGltZX0gfSApIHsKICAgICAgICAgICAgaWYgKCByZWYgJEF0dHJpYnV0ZSBuZSAnSEFTSCcgJiYgcmVmICRBdHRyaWJ1dGUgbmUgJ0FSUkFZJyApIHsKCiAgICAgICAgICAgICAgICAjcmVtb3ZlIGxlYWRpbmcgc3BhY2VzCiAgICAgICAgICAgICAgICAkVGlja2V0LT57UGVuZGluZ1RpbWV9LT57JEF0dHJpYnV0ZX0gPX4gc3tcQVxzK317fTsKCiAgICAgICAgICAgICAgICAjcmVtb3ZlIHRyYWlsaW5nIHNwYWNlcwogICAgICAgICAgICAgICAgJFRpY2tldC0+e1BlbmRpbmdUaW1lfS0+eyRBdHRyaWJ1dGV9ID1+IHN7XHMrXHp9e307CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgIyBjaGVjayBUaWNrZXQgYXR0cmlidXRlIHZhbHVlcwogICAgbXkgJFRpY2tldENoZWNrID0gJFNlbGYtPl9DaGVja1RpY2tldCggVGlja2V0ID0+ICRUaWNrZXQgKTsKCiAgICBpZiAoICEkVGlja2V0Q2hlY2stPntTdWNjZXNzfSApIHsKICAgICAgICByZXR1cm4gJFNlbGYtPlJldHVybkVycm9yKCAleyRUaWNrZXRDaGVja30gKTsKICAgIH0KCiAgICAjIGNoZWNrIGNyZWF0ZSBwZXJtaXNzaW9ucwogICAgbXkgJFBlcm1pc3Npb24gPSAkU2VsZi0+Q2hlY2tDcmVhdGVQZXJtaXNzaW9ucygKICAgICAgICBUaWNrZXQgICA9PiAkVGlja2V0LAogICAgICAgIFVzZXJJRCAgID0+ICRQZXJtaXNzaW9uVXNlcklELAogICAgICAgIFVzZXJUeXBlID0+ICRVc2VyVHlwZSwKICAgICk7CgogICAgaWYgKCAhJFBlcm1pc3Npb24gKSB7CiAgICAgICAgcmV0dXJuICRTZWxmLT5SZXR1cm5FcnJvcigKICAgICAgICAgICAgRXJyb3JDb2RlICAgID0+ICdUaWNrZXRDcmVhdGUuQWNjZXNzRGVuaWVkJywKICAgICAgICAgICAgRXJyb3JNZXNzYWdlID0+ICJUaWNrZXRDcmVhdGU6IENhbiBub3QgY3JlYXRlIHRpY2tldHMgaW4gZ2l2ZW4gUXVldWUgb3IgUXVldWVJRCEiLAogICAgICAgICk7CiAgICB9CgogICAgIyBpc29sYXRlIEFydGljbGUgcGFyYW1ldGVyCiAgICBteSBAQXJ0aWNsZTsKICAgIGlmICggSXNIYXNoUmVmV2l0aERhdGEoICRQYXJhbXtEYXRhfS0+e0FydGljbGV9ICkgKSB7CiAgICAgICAgcHVzaCBAQXJ0aWNsZSwgJFBhcmFte0RhdGF9LT57QXJ0aWNsZX07CiAgICB9CiAgICBpZiAoIElzQXJyYXlSZWZXaXRoRGF0YSggJFBhcmFte0RhdGF9LT57QXJ0aWNsZX0gKSApIHsKICAgICAgICBAQXJ0aWNsZSA9IEB7ICRQYXJhbXtEYXRhfS0+e0FydGljbGV9IH07CiAgICB9CgogICAgZm9yIG15ICRBcnRpY2xlIChAQXJ0aWNsZSkgewogICAgICAgICRBcnRpY2xlLT57VXNlclR5cGV9ID0gJFVzZXJUeXBlOwoKICAgICAgICAjIHJlbW92ZSBsZWFkaW5nIGFuZCB0cmFpbGluZyBzcGFjZXMKICAgICAgICBmb3IgbXkgJEF0dHJpYnV0ZSAoIHNvcnQga2V5cyAleyRBcnRpY2xlfSApIHsKICAgICAgICAgICAgaWYgKCByZWYgJEF0dHJpYnV0ZSBuZSAnSEFTSCcgJiYgcmVmICRBdHRyaWJ1dGUgbmUgJ0FSUkFZJyApIHsKCiAgICAgICAgICAgICAgICAjcmVtb3ZlIGxlYWRpbmcgc3BhY2VzCiAgICAgICAgICAgICAgICAkQXJ0aWNsZS0+eyRBdHRyaWJ1dGV9ID1+IHN7XEFccyt9e307CgogICAgICAgICAgICAgICAgI3JlbW92ZSB0cmFpbGluZyBzcGFjZXMKICAgICAgICAgICAgICAgICRBcnRpY2xlLT57JEF0dHJpYnV0ZX0gPX4gc3tccytcen17fTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIElzSGFzaFJlZldpdGhEYXRhKCAkQXJ0aWNsZS0+e09yaWdIZWFkZXJ9ICkgKSB7CiAgICAgICAgICAgIGZvciBteSAkQXR0cmlidXRlICggc29ydCBrZXlzICV7ICRBcnRpY2xlLT57T3JpZ0hlYWRlcn0gfSApIHsKICAgICAgICAgICAgICAgIGlmICggcmVmICRBdHRyaWJ1dGUgbmUgJ0hBU0gnICYmIHJlZiAkQXR0cmlidXRlIG5lICdBUlJBWScgKSB7CgogICAgICAgICAgICAgICAgICAgICNyZW1vdmUgbGVhZGluZyBzcGFjZXMKICAgICAgICAgICAgICAgICAgICAkQXJ0aWNsZS0+e09yaWdIZWFkZXJ9LT57JEF0dHJpYnV0ZX0gPX4gc3tcQVxzK317fTsKCiAgICAgICAgICAgICAgICAgICAgI3JlbW92ZSB0cmFpbGluZyBzcGFjZXMKICAgICAgICAgICAgICAgICAgICAkQXJ0aWNsZS0+e09yaWdIZWFkZXJ9LT57JEF0dHJpYnV0ZX0gPX4gc3tccytcen17fTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBDaGVjayBhdHRyaWJ1dGVzIHRoYXQgY2FuIGJlIHNldCBieSBzeXNjb25maWcuCiAgICAgICAgaWYgKCAhJEFydGljbGUtPntBdXRvUmVzcG9uc2VUeXBlfSApIHsKICAgICAgICAgICAgJEFydGljbGUtPntBdXRvUmVzcG9uc2VUeXBlfSA9ICRTZWxmLT57Q29uZmlnfS0+e0F1dG9SZXNwb25zZVR5cGV9IHx8ICcnOwogICAgICAgIH0KCiAgICAgICAgIyBUT0RPOiBHZW5lcmljSW50ZXJmYWNlOjpPcGVyYXRpb246OlRpY2tldENyZWF0ZSMjI0NvbW11bmljYXRpb25DaGFubmVsCiAgICAgICAgaWYgKCAhJEFydGljbGUtPntDb21tdW5pY2F0aW9uQ2hhbm5lbElEfSAmJiAhJEFydGljbGUtPntDb21tdW5pY2F0aW9uQ2hhbm5lbH0gKSB7CiAgICAgICAgICAgICRBcnRpY2xlLT57Q29tbXVuaWNhdGlvbkNoYW5uZWx9ID0gJ0ludGVybmFsJzsKICAgICAgICB9CiAgICAgICAgaWYgKCAhZGVmaW5lZCAkQXJ0aWNsZS0+e0lzVmlzaWJsZUZvckN1c3RvbWVyfSApIHsKICAgICAgICAgICAgJEFydGljbGUtPntJc1Zpc2libGVGb3JDdXN0b21lcn0gPSAkU2VsZi0+e0NvbmZpZ30tPntJc1Zpc2libGVGb3JDdXN0b21lcn0gLy8gMTsKICAgICAgICB9CiAgICAgICAgaWYgKCAhJEFydGljbGUtPntTZW5kZXJUeXBlSUR9ICYmICEkQXJ0aWNsZS0+e1NlbmRlclR5cGV9ICkgewogICAgICAgICAgICAkQXJ0aWNsZS0+e1NlbmRlclR5cGV9ID0gJFVzZXJUeXBlIGVxICdVc2VyJyA/ICdhZ2VudCcgOiAnY3VzdG9tZXInOwogICAgICAgIH0KICAgICAgICBpZiAoICEkQXJ0aWNsZS0+e0hpc3RvcnlUeXBlfSApIHsKICAgICAgICAgICAgJEFydGljbGUtPntIaXN0b3J5VHlwZX0gPSAkU2VsZi0+e0NvbmZpZ30tPntIaXN0b3J5VHlwZX0gfHwgJyc7CiAgICAgICAgfQogICAgICAgIGlmICggISRBcnRpY2xlLT57SGlzdG9yeUNvbW1lbnR9ICkgewogICAgICAgICAgICAkQXJ0aWNsZS0+e0hpc3RvcnlDb21tZW50fSA9ICRTZWxmLT57Q29uZmlnfS0+e0hpc3RvcnlDb21tZW50fSB8fCAnJzsKICAgICAgICB9CgogICAgICAgICMgY2hlY2sgQXJ0aWNsZSBhdHRyaWJ1dGUgdmFsdWVzCiAgICAgICAgbXkgJEFydGljbGVDaGVjayA9ICRTZWxmLT5fQ2hlY2tBcnRpY2xlKCBBcnRpY2xlID0+ICRBcnRpY2xlICk7CgogICAgICAgIGlmICggISRBcnRpY2xlQ2hlY2stPntTdWNjZXNzfSApIHsKICAgICAgICAgICAgaWYgKCAhJEFydGljbGVDaGVjay0+e0Vycm9yQ29kZX0gKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIFN1Y2Nlc3MgPT4gMCwKICAgICAgICAgICAgICAgICAgICAleyRBcnRpY2xlQ2hlY2t9LAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJFNlbGYtPlJldHVybkVycm9yKCAleyRBcnRpY2xlQ2hlY2t9ICk7CiAgICAgICAgfQogICAgfQoKICAgIG15ICREeW5hbWljRmllbGQ7CiAgICBteSBARHluYW1pY0ZpZWxkTGlzdDsKCiAgICBpZiAoIGRlZmluZWQgJFBhcmFte0RhdGF9LT57RHluYW1pY0ZpZWxkfSApIHsKCiAgICAgICAgIyBpc29sYXRlIER5bmFtaWNGaWVsZCBwYXJhbWV0ZXIKICAgICAgICAkRHluYW1pY0ZpZWxkID0gJFBhcmFte0RhdGF9LT57RHluYW1pY0ZpZWxkfTsKCiAgICAgICAgIyBob21vZ2VuYXRlIGlucHV0IHRvIGFycmF5CiAgICAgICAgaWYgKCByZWYgJER5bmFtaWNGaWVsZCBlcSAnSEFTSCcgKSB7CiAgICAgICAgICAgIHB1c2ggQER5bmFtaWNGaWVsZExpc3QsICREeW5hbWljRmllbGQ7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBARHluYW1pY0ZpZWxkTGlzdCA9IEB7JER5bmFtaWNGaWVsZH07CiAgICAgICAgfQoKICAgICAgICAjIGNoZWNrIER5bmFtaWNGaWVsZCBpbnRlcm5hbCBzdHJ1Y3R1cmUKICAgICAgICBmb3IgbXkgJER5bmFtaWNGaWVsZEl0ZW0gKEBEeW5hbWljRmllbGRMaXN0KSB7CiAgICAgICAgICAgIGlmICggIUlzSGFzaFJlZldpdGhEYXRhKCREeW5hbWljRmllbGRJdGVtKSApIHsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgRXJyb3JDb2RlID0+ICdUaWNrZXRDcmVhdGUuSW52YWxpZFBhcmFtZXRlcicsCiAgICAgICAgICAgICAgICAgICAgRXJyb3JNZXNzYWdlID0+CiAgICAgICAgICAgICAgICAgICAgICAgICJUaWNrZXRDcmVhdGU6IFRpY2tldC0+RHluYW1pY0ZpZWxkIHBhcmFtZXRlciBpcyBpbnZhbGlkISIsCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIHJlbW92ZSBsZWFkaW5nIGFuZCB0cmFpbGluZyBzcGFjZXMKICAgICAgICAgICAgZm9yIG15ICRBdHRyaWJ1dGUgKCBzb3J0IGtleXMgJXskRHluYW1pY0ZpZWxkSXRlbX0gKSB7CiAgICAgICAgICAgICAgICBpZiAoIHJlZiAkQXR0cmlidXRlIG5lICdIQVNIJyAmJiByZWYgJEF0dHJpYnV0ZSBuZSAnQVJSQVknICkgewoKICAgICAgICAgICAgICAgICAgICAjcmVtb3ZlIGxlYWRpbmcgc3BhY2VzCiAgICAgICAgICAgICAgICAgICAgJER5bmFtaWNGaWVsZEl0ZW0tPnskQXR0cmlidXRlfSA9fiBze1xBXHMrfXt9OwoKICAgICAgICAgICAgICAgICAgICAjcmVtb3ZlIHRyYWlsaW5nIHNwYWNlcwogICAgICAgICAgICAgICAgICAgICREeW5hbWljRmllbGRJdGVtLT57JEF0dHJpYnV0ZX0gPX4gc3tccytcen17fTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBjaGVjayBEeW5hbWljRmllbGQgYXR0cmlidXRlIHZhbHVlcwogICAgICAgICAgICBteSAkRHluYW1pY0ZpZWxkQ2hlY2sgPSAkU2VsZi0+X0NoZWNrRHluYW1pY0ZpZWxkKCBEeW5hbWljRmllbGQgPT4gJER5bmFtaWNGaWVsZEl0ZW0gKTsKCiAgICAgICAgICAgIGlmICggISREeW5hbWljRmllbGRDaGVjay0+e1N1Y2Nlc3N9ICkgewogICAgICAgICAgICAgICAgcmV0dXJuICRTZWxmLT5SZXR1cm5FcnJvciggJXskRHluYW1pY0ZpZWxkQ2hlY2t9ICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgbXkgJEF0dGFjaG1lbnQ7CiAgICBteSBAQXR0YWNobWVudExpc3Q7CgogICAgaWYgKCBkZWZpbmVkICRQYXJhbXtEYXRhfS0+e0F0dGFjaG1lbnR9ICkgewoKICAgICAgICAjIGlzb2xhdGUgQXR0YWNobWVudCBwYXJhbWV0ZXIKICAgICAgICAkQXR0YWNobWVudCA9ICRQYXJhbXtEYXRhfS0+e0F0dGFjaG1lbnR9OwoKICAgICAgICAjIGhvbW9nZW5hdGUgaW5wdXQgdG8gYXJyYXkKICAgICAgICBpZiAoIHJlZiAkQXR0YWNobWVudCBlcSAnSEFTSCcgKSB7CiAgICAgICAgICAgIHB1c2ggQEF0dGFjaG1lbnRMaXN0LCAkQXR0YWNobWVudDsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIEBBdHRhY2htZW50TGlzdCA9IEB7JEF0dGFjaG1lbnR9OwogICAgICAgIH0KCiAgICAgICAgIyBjaGVjayBBdHRhY2htZW50IGludGVybmFsIHN0cnVjdHVyZQogICAgICAgIGZvciBteSAkQXR0YWNobWVudEl0ZW0gKEBBdHRhY2htZW50TGlzdCkgewogICAgICAgICAgICBpZiAoICFJc0hhc2hSZWZXaXRoRGF0YSgkQXR0YWNobWVudEl0ZW0pICkgewogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICBFcnJvckNvZGUgPT4gJ1RpY2tldENyZWF0ZS5JbnZhbGlkUGFyYW1ldGVyJywKICAgICAgICAgICAgICAgICAgICBFcnJvck1lc3NhZ2UgPT4KICAgICAgICAgICAgICAgICAgICAgICAgIlRpY2tldENyZWF0ZTogVGlja2V0LT5BdHRhY2htZW50IHBhcmFtZXRlciBpcyBpbnZhbGlkISIsCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIHJlbW92ZSBsZWFkaW5nIGFuZCB0cmFpbGluZyBzcGFjZXMKICAgICAgICAgICAgZm9yIG15ICRBdHRyaWJ1dGUgKCBzb3J0IGtleXMgJXskQXR0YWNobWVudEl0ZW19ICkgewogICAgICAgICAgICAgICAgaWYgKCByZWYgJEF0dHJpYnV0ZSBuZSAnSEFTSCcgJiYgcmVmICRBdHRyaWJ1dGUgbmUgJ0FSUkFZJyApIHsKCiAgICAgICAgICAgICAgICAgICAgI3JlbW92ZSBsZWFkaW5nIHNwYWNlcwogICAgICAgICAgICAgICAgICAgICRBdHRhY2htZW50SXRlbS0+eyRBdHRyaWJ1dGV9ID1+IHN7XEFccyt9e307CgogICAgICAgICAgICAgICAgICAgICNyZW1vdmUgdHJhaWxpbmcgc3BhY2VzCiAgICAgICAgICAgICAgICAgICAgJEF0dGFjaG1lbnRJdGVtLT57JEF0dHJpYnV0ZX0gPX4gc3tccytcen17fTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBjaGVjayBBdHRhY2htZW50IGF0dHJpYnV0ZSB2YWx1ZXMKICAgICAgICAgICAgbXkgJEF0dGFjaG1lbnRDaGVjayA9ICRTZWxmLT5fQ2hlY2tBdHRhY2htZW50KCBBdHRhY2htZW50ID0+ICRBdHRhY2htZW50SXRlbSApOwoKICAgICAgICAgICAgaWYgKCAhJEF0dGFjaG1lbnRDaGVjay0+e1N1Y2Nlc3N9ICkgewogICAgICAgICAgICAgICAgcmV0dXJuICRTZWxmLT5SZXR1cm5FcnJvciggJXskQXR0YWNobWVudENoZWNrfSApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiAkU2VsZi0+X1RpY2tldENyZWF0ZSgKICAgICAgICBUaWNrZXQgICAgICAgICAgID0+ICRUaWNrZXQsCiAgICAgICAgQXJ0aWNsZSAgICAgICAgICA9PiBcQEFydGljbGUsCiAgICAgICAgRHluYW1pY0ZpZWxkTGlzdCA9PiBcQER5bmFtaWNGaWVsZExpc3QsCiAgICAgICAgQXR0YWNobWVudExpc3QgICA9PiBcQEF0dGFjaG1lbnRMaXN0LAogICAgICAgIFVzZXJJRCAgICAgICAgICAgPT4gJFVzZXJJRCwKICAgICk7Cn0KCj1iZWdpbiBJbnRlcm5hbDoKCj1oZWFkMiBfQ2hlY2tUaWNrZXQoKQoKY2hlY2tzIGlmIHRoZSBnaXZlbiB0aWNrZXQgcGFyYW1ldGVycyBhcmUgdmFsaWQuCgogICAgbXkgJFRpY2tldENoZWNrID0gJE9wZXJhdGlvbk9iamVjdC0+X0NoZWNrVGlja2V0KAogICAgICAgIFRpY2tldCA9PiAkVGlja2V0LCAgICAgICAgICAgICAgICAgICAgICAgICAgIyBhbGwgdGlja2V0IHBhcmFtZXRlcnMKICAgICk7CgogICAgcmV0dXJuczoKCiAgICAkVGlja2V0Q2hlY2sgPSB7CiAgICAgICAgU3VjY2VzcyA9PiAxLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGlmIGV2ZXJ5dGhpbmcgaXMgT0sKICAgIH0KCiAgICAkVGlja2V0Q2hlY2sgPSB7CiAgICAgICAgRXJyb3JDb2RlICAgID0+ICdGdW5jdGlvbi5FcnJvcicsICAgICAgICAgICAjIGlmIGVycm9yCiAgICAgICAgRXJyb3JNZXNzYWdlID0+ICdFcnJvciBkZXNjcmlwdGlvbicsCiAgICB9Cgo9Y3V0CgpzdWIgX0NoZWNrVGlja2V0IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJFRpY2tldCA9ICRQYXJhbXtUaWNrZXR9OwoKICAgICMgY2hlY2sgdGlja2V0IGludGVybmFsbHkKICAgIGZvciBteSAkTmVlZGVkIChxdyhUaXRsZSBDdXN0b21lclVzZXIpKSB7CiAgICAgICAgaWYgKCAhJFRpY2tldC0+eyROZWVkZWR9ICkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgRXJyb3JDb2RlICAgID0+ICdUaWNrZXRDcmVhdGUuTWlzc2luZ1BhcmFtZXRlcicsCiAgICAgICAgICAgICAgICBFcnJvck1lc3NhZ2UgPT4gIlRpY2tldENyZWF0ZTogVGlja2V0LT4kTmVlZGVkIHBhcmFtZXRlciBpcyBtaXNzaW5nISIsCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgfQoKICAgIGlmICggISRTZWxmLT5WYWxpZGF0ZUN1c3RvbWVyKCAleyRUaWNrZXR9ICkgKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgRXJyb3JDb2RlID0+ICdUaWNrZXRDcmVhdGUuSW52YWxpZFBhcmFtZXRlcicsCiAgICAgICAgICAgIEVycm9yTWVzc2FnZSA9PgogICAgICAgICAgICAgICAgIlRpY2tldENyZWF0ZTogVGlja2V0LT5DdXN0b21lclVzZXIgcGFyYW1ldGVyIGlzIGludmFsaWQhIiwKICAgICAgICB9OwogICAgfQoKICAgICMgY2hlY2sgVGlja2V0LT5RdWV1ZQogICAgaWYgKCAhJFRpY2tldC0+e1F1ZXVlSUR9ICYmICEkVGlja2V0LT57UXVldWV9ICkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIEVycm9yQ29kZSAgICA9PiAnVGlja2V0Q3JlYXRlLk1pc3NpbmdQYXJhbWV0ZXInLAogICAgICAgICAgICBFcnJvck1lc3NhZ2UgPT4gIlRpY2tldENyZWF0ZTogVGlja2V0LT5RdWV1ZUlEIG9yIFRpY2tldC0+UXVldWUgcGFyYW1ldGVyIGlzIHJlcXVpcmVkISIsCiAgICAgICAgfTsKICAgIH0KCiAgICBpZiAoICEkU2VsZi0+VmFsaWRhdGVRdWV1ZSggJXskVGlja2V0fSApICkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIEVycm9yQ29kZSAgICA9PiAnVGlja2V0Q3JlYXRlLkludmFsaWRQYXJhbWV0ZXInLAogICAgICAgICAgICBFcnJvck1lc3NhZ2UgPT4gIlRpY2tldENyZWF0ZTogVGlja2V0LT5RdWV1ZUlEIG9yIFRpY2tldC0+UXVldWUgcGFyYW1ldGVyIGlzIGludmFsaWQhIiwKICAgICAgICB9OwogICAgfQoKICAgICMgY2hlY2sgVGlja2V0LT5Mb2NrCiAgICBpZiAoICRUaWNrZXQtPntMb2NrSUR9IHx8ICRUaWNrZXQtPntMb2NrfSApIHsKICAgICAgICBpZiAoICEkU2VsZi0+VmFsaWRhdGVMb2NrKCAleyRUaWNrZXR9ICkgKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBFcnJvckNvZGUgICAgPT4gJ1RpY2tldENyZWF0ZS5JbnZhbGlkUGFyYW1ldGVyJywKICAgICAgICAgICAgICAgIEVycm9yTWVzc2FnZSA9PiAiVGlja2V0Q3JlYXRlOiBUaWNrZXQtPkxvY2tJRCBvciBUaWNrZXQtPkxvY2sgcGFyYW1ldGVyIGlzIgogICAgICAgICAgICAgICAgICAgIC4gIiBpbnZhbGlkISIsCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgfQoKICAgICMgY2hlY2sgVGlja2V0LT5UeXBlCiAgICAjIFRpY2tldCB0eXBlIGNvdWxkIGJlIHJlcXVpcmVkIG9yIG5vdCBkZXBlbmRpbmcgb24gc3lzY29uZmlnIG9wdGlvbgogICAgaWYgKAogICAgICAgICEkVGlja2V0LT57VHlwZUlEfQogICAgICAgICYmICEkVGlja2V0LT57VHlwZX0KICAgICAgICAmJiAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpLT5HZXQoJ1RpY2tldDo6VHlwZScpCiAgICAgICAgKQogICAgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIEVycm9yQ29kZSAgICA9PiAnVGlja2V0Q3JlYXRlLk1pc3NpbmdQYXJhbWV0ZXInLAogICAgICAgICAgICBFcnJvck1lc3NhZ2UgPT4gIlRpY2tldENyZWF0ZTogVGlja2V0LT5UeXBlSUQgb3IgVGlja2V0LT5UeXBlIHBhcmFtZXRlciBpcyByZXF1aXJlZCIKICAgICAgICAgICAgICAgIC4gIiBieSBzeXNjb25maWcgb3B0aW9uISIsCiAgICAgICAgfTsKICAgIH0KICAgIGlmICggJFRpY2tldC0+e1R5cGVJRH0gfHwgJFRpY2tldC0+e1R5cGV9ICkgewogICAgICAgIGlmICggISRTZWxmLT5WYWxpZGF0ZVR5cGUoICV7JFRpY2tldH0gKSApIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIEVycm9yQ29kZSA9PiAnVGlja2V0Q3JlYXRlLkludmFsaWRQYXJhbWV0ZXInLAogICAgICAgICAgICAgICAgRXJyb3JNZXNzYWdlID0+CiAgICAgICAgICAgICAgICAgICAgIlRpY2tldENyZWF0ZTogVGlja2V0LT5UeXBlSUQgb3IgVGlja2V0LT5UeXBlIHBhcmFtZXRlciBpcyBpbnZhbGlkISIsCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgfQoKICAgICMgY2hlY2sgVGlja2V0LT5TZXJ2aWNlCiAgICBpZiAoICRUaWNrZXQtPntTZXJ2aWNlSUR9IHx8ICRUaWNrZXQtPntTZXJ2aWNlfSApIHsKCiAgICAgICAgaWYgKCAhJFNlbGYtPlZhbGlkYXRlU2VydmljZSggJXskVGlja2V0fSApICkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgRXJyb3JDb2RlID0+ICdUaWNrZXRDcmVhdGUuSW52YWxpZFBhcmFtZXRlcicsCiAgICAgICAgICAgICAgICBFcnJvck1lc3NhZ2UgPT4KICAgICAgICAgICAgICAgICAgICAiVGlja2V0Q3JlYXRlOiBUaWNrZXQtPlNlcnZpY2VJRCBvciBUaWNrZXQtPlNlcnZpY2UgcGFyYW1ldGVyIGlzIGludmFsaWQhIiwKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICB9CgogICAgIyBjaGVjayBUaWNrZXQtPlNMQQogICAgaWYgKCAkVGlja2V0LT57U0xBSUR9IHx8ICRUaWNrZXQtPntTTEF9ICkgewogICAgICAgIGlmICggISRTZWxmLT5WYWxpZGF0ZVNMQSggJXskVGlja2V0fSApICkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgRXJyb3JDb2RlID0+ICdUaWNrZXRDcmVhdGUuSW52YWxpZFBhcmFtZXRlcicsCiAgICAgICAgICAgICAgICBFcnJvck1lc3NhZ2UgPT4KICAgICAgICAgICAgICAgICAgICAiVGlja2V0Q3JlYXRlOiBUaWNrZXQtPlNMQUlEIG9yIFRpY2tldC0+U0xBIHBhcmFtZXRlciBpcyBpbnZhbGlkISIsCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgfQoKICAgICMgY2hlY2sgVGlja2V0LT5TdGF0ZQogICAgaWYgKCAhJFRpY2tldC0+e1N0YXRlSUR9ICYmICEkVGlja2V0LT57U3RhdGV9ICkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIEVycm9yQ29kZSAgICA9PiAnVGlja2V0Q3JlYXRlLk1pc3NpbmdQYXJhbWV0ZXInLAogICAgICAgICAgICBFcnJvck1lc3NhZ2UgPT4gIlRpY2tldENyZWF0ZTogVGlja2V0LT5TdGF0ZUlEIG9yIFRpY2tldC0+U3RhdGUgcGFyYW1ldGVyIGlzIHJlcXVpcmVkISIsCiAgICAgICAgfTsKICAgIH0KICAgIGlmICggISRTZWxmLT5WYWxpZGF0ZVN0YXRlKCAleyRUaWNrZXR9ICkgKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgRXJyb3JDb2RlICAgID0+ICdUaWNrZXRDcmVhdGUuSW52YWxpZFBhcmFtZXRlcicsCiAgICAgICAgICAgIEVycm9yTWVzc2FnZSA9PiAiVGlja2V0Q3JlYXRlOiBUaWNrZXQtPlN0YXRlSUQgb3IgVGlja2V0LT5TdGF0ZSBwYXJhbWV0ZXIgaXMgaW52YWxpZCEiLAogICAgICAgIH07CiAgICB9CgogICAgIyBjaGVjayBUaWNrZXQtPlByaW9yaXR5CiAgICBpZiAoICEkVGlja2V0LT57UHJpb3JpdHlJRH0gJiYgISRUaWNrZXQtPntQcmlvcml0eX0gKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgRXJyb3JDb2RlICAgID0+ICdUaWNrZXRDcmVhdGUuTWlzc2luZ1BhcmFtZXRlcicsCiAgICAgICAgICAgIEVycm9yTWVzc2FnZSA9PiAiVGlja2V0Q3JlYXRlOiBUaWNrZXQtPlByaW9yaXR5SUQgb3IgVGlja2V0LT5Qcmlvcml0eSBwYXJhbWV0ZXIgaXMiCiAgICAgICAgICAgICAgICAuICIgcmVxdWlyZWQhIiwKICAgICAgICB9OwogICAgfQogICAgaWYgKCAhJFNlbGYtPlZhbGlkYXRlUHJpb3JpdHkoICV7JFRpY2tldH0gKSApIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBFcnJvckNvZGUgICAgPT4gJ1RpY2tldENyZWF0ZS5JbnZhbGlkUGFyYW1ldGVyJywKICAgICAgICAgICAgRXJyb3JNZXNzYWdlID0+ICJUaWNrZXRDcmVhdGU6IFRpY2tldC0+UHJpb3JpdHlJRCBvciBUaWNrZXQtPlByaW9yaXR5IHBhcmFtZXRlciBpcyIKICAgICAgICAgICAgICAgIC4gIiBpbnZhbGlkISIsCiAgICAgICAgfTsKICAgIH0KCiAgICAjIGNoZWNrIFRpY2tldC0+T3duZXIKICAgIGlmICggJFRpY2tldC0+e093bmVySUR9IHx8ICRUaWNrZXQtPntPd25lcn0gKSB7CiAgICAgICAgaWYgKCAhJFNlbGYtPlZhbGlkYXRlT3duZXIoICV7JFRpY2tldH0gKSApIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIEVycm9yQ29kZSA9PiAnVGlja2V0Q3JlYXRlLkludmFsaWRQYXJhbWV0ZXInLAogICAgICAgICAgICAgICAgRXJyb3JNZXNzYWdlID0+CiAgICAgICAgICAgICAgICAgICAgIlRpY2tldENyZWF0ZTogVGlja2V0LT5Pd25lcklEIG9yIFRpY2tldC0+T3duZXIgcGFyYW1ldGVyIGlzIGludmFsaWQhIiwKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICB9CgogICAgIyBjaGVjayBUaWNrZXQtPlJlc3BvbnNpYmxlCiAgICBpZiAoICRUaWNrZXQtPntSZXNwb25zaWJsZUlEfSB8fCAkVGlja2V0LT57UmVzcG9uc2libGV9ICkgewogICAgICAgIGlmICggISRTZWxmLT5WYWxpZGF0ZVJlc3BvbnNpYmxlKCAleyRUaWNrZXR9ICkgKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBFcnJvckNvZGUgICAgPT4gJ1RpY2tldENyZWF0ZS5JbnZhbGlkUGFyYW1ldGVyJywKICAgICAgICAgICAgICAgIEVycm9yTWVzc2FnZSA9PiAiVGlja2V0Q3JlYXRlOiBUaWNrZXQtPlJlc3BvbnNpYmxlSUQgb3IgVGlja2V0LT5SZXNwb25zaWJsZSIKICAgICAgICAgICAgICAgICAgICAuICIgcGFyYW1ldGVyIGlzIGludmFsaWQhIiwKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICB9CgogICAgIyBjaGVjayBUaWNrZXQtPlBlbmRpbmdUaW1lCiAgICBpZiAoICRUaWNrZXQtPntQZW5kaW5nVGltZX0gKSB7CiAgICAgICAgaWYgKCAhJFNlbGYtPlZhbGlkYXRlUGVuZGluZ1RpbWUoICV7JFRpY2tldH0gKSApIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIEVycm9yQ29kZSAgICA9PiAnVGlja2V0Q3JlYXRlLkludmFsaWRQYXJhbWV0ZXInLAogICAgICAgICAgICAgICAgRXJyb3JNZXNzYWdlID0+ICJUaWNrZXRDcmVhdGU6IFRpY2tldC0+UGVuZGluZ1RpbWUgcGFyYW1ldGVyIGlzIGludmFsaWQhIiwKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICB9CgogICAgIyBpZiBldmVyeXRoaW5nIGlzIE9LIHRoZW4gcmV0dXJuIFN1Y2Nlc3MKICAgIHJldHVybiB7CiAgICAgICAgU3VjY2VzcyA9PiAxLAogICAgfTsKfQoKPWhlYWQyIF9DaGVja0FydGljbGUoKQoKY2hlY2tzIGlmIHRoZSBnaXZlbiBhcnRpY2xlIHBhcmFtZXRlciBpcyB2YWxpZC4KCiAgICBteSAkQXJ0aWNsZUNoZWNrID0gJE9wZXJhdGlvbk9iamVjdC0+X0NoZWNrQXJ0aWNsZSgKICAgICAgICBBcnRpY2xlID0+ICRBcnRpY2xlLCAgICAgICAgICAgICAgICAgICAgICAgICMgYWxsIGFydGljbGUgcGFyYW1ldGVycwogICAgKTsKCiAgICByZXR1cm5zOgoKICAgICRBcnRpY2xlQ2hlY2sgPSB7CiAgICAgICAgU3VjY2VzcyA9PiAxLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGlmIGV2ZXJ5dGhpbmcgaXMgT0sKICAgIH0KCiAgICAkQXJ0aWNsZUNoZWNrID0gewogICAgICAgIEVycm9yQ29kZSAgICA9PiAnRnVuY3Rpb24uRXJyb3InLCAgICAgICAgICAgIyBpZiBlcnJvcgogICAgICAgIEVycm9yTWVzc2FnZSA9PiAnRXJyb3IgZGVzY3JpcHRpb24nLAogICAgfQoKPWN1dAoKc3ViIF9DaGVja0FydGljbGUgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkQXJ0aWNsZSA9ICRQYXJhbXtBcnRpY2xlfTsKCiAgICAjIGNoZWNrIHRpY2tldCBpbnRlcm5hbGx5CiAgICBmb3IgbXkgJE5lZWRlZCAocXcoU3ViamVjdCBCb2R5IEF1dG9SZXNwb25zZVR5cGUpKSB7CiAgICAgICAgaWYgKCAhJEFydGljbGUtPnskTmVlZGVkfSApIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIEVycm9yQ29kZSAgICA9PiAnVGlja2V0Q3JlYXRlLk1pc3NpbmdQYXJhbWV0ZXInLAogICAgICAgICAgICAgICAgRXJyb3JNZXNzYWdlID0+ICJUaWNrZXRDcmVhdGU6IEFydGljbGUtPiROZWVkZWQgcGFyYW1ldGVyIGlzIG1pc3NpbmchIiwKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICB9CgogICAgIyBjaGVjayBBcnRpY2xlLT5BdXRvUmVzcG9uc2VUeXBlCiAgICBpZiAoICEkQXJ0aWNsZS0+e0F1dG9SZXNwb25zZVR5cGV9ICkgewoKICAgICAgICAjIHJldHVybiBpbnRlcm5hbCBzZXJ2ZXIgZXJyb3IKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBFcnJvck1lc3NhZ2UgPT4gIlRpY2tldENyZWF0ZTogQXJ0aWNsZS0+QXV0b1Jlc3BvbnNlVHlwZSBwYXJhbWV0ZXIgaXMgcmVxdWlyZWQhIgogICAgICAgIH07CiAgICB9CgogICAgaWYgKCAhJFNlbGYtPlZhbGlkYXRlQXV0b1Jlc3BvbnNlVHlwZSggJXskQXJ0aWNsZX0gKSApIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBFcnJvckNvZGUgICAgPT4gJ1RpY2tldENyZWF0ZS5JbnZhbGlkUGFyYW1ldGVyJywKICAgICAgICAgICAgRXJyb3JNZXNzYWdlID0+ICJUaWNrZXRDcmVhdGU6IEFydGljbGUtPkF1dG9SZXNwb25zZVR5cGUgcGFyYW1ldGVyIGlzIGludmFsaWQhIiwKICAgICAgICB9OwogICAgfQoKICAgICMgY2hlY2sgQXJ0aWNsZS0+Q29tbXVuaWNhdGlvbkNoYW5uZWwKICAgIGlmICggISRTZWxmLT5WYWxpZGF0ZUFydGljbGVDb21tdW5pY2F0aW9uQ2hhbm5lbCggJXskQXJ0aWNsZX0gKSApIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBFcnJvckNvZGUgICAgPT4gJ1RpY2tldENyZWF0ZS5JbnZhbGlkUGFyYW1ldGVyJywKICAgICAgICAgICAgRXJyb3JNZXNzYWdlID0+ICJUaWNrZXRDcmVhdGU6IEFydGljbGUtPkNvbW11bmljYXRpb25DaGFubmVsIG9yIEFydGljbGUtPkNvbW11bmljYXRpb25DaGFubmVsSUQgcGFyYW1ldGVyIgogICAgICAgICAgICAgICAgLiAiIGlzIGludmFsaWQgb3Igbm90IHN1cHBvcnRlZCEiLAogICAgICAgIH07CiAgICB9CgogICAgIyBjaGVjayBBcnRpY2xlLT5TZW5kZXJUeXBlCiAgICBpZiAoICEkQXJ0aWNsZS0+e1NlbmRlclR5cGVJRH0gJiYgISRBcnRpY2xlLT57U2VuZGVyVHlwZX0gKSB7CgogICAgICAgICMgcmV0dXJuIGludGVybmFsIHNlcnZlciBlcnJvcgogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIEVycm9yTWVzc2FnZSA9PiAiVGlja2V0Q3JlYXRlOiBBcnRpY2xlLT5TZW5kZXJUeXBlSUQgb3IgQXJ0aWNsZS0+U2VuZGVyVHlwZSBwYXJhbWV0ZXIiCiAgICAgICAgICAgICAgICAuICIgaXMgcmVxdWlyZWQgYW5kIFN5c2NvbmZpZyBTZW5kZXJUeXBlSUQgc2V0dGluZyBjb3VsZCBub3QgYmUgcmVhZCEiCiAgICAgICAgfTsKICAgIH0KICAgIGlmICggISRTZWxmLT5WYWxpZGF0ZVNlbmRlclR5cGUoICV7JEFydGljbGV9ICkgKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgRXJyb3JDb2RlICAgID0+ICdUaWNrZXRDcmVhdGUuSW52YWxpZFBhcmFtZXRlcicsCiAgICAgICAgICAgIEVycm9yTWVzc2FnZSA9PiAiVGlja2V0Q3JlYXRlOiBBcnRpY2xlLT5TZW5kZXJUeXBlSUQgb3IgVGlja2V0LT5TZW5kZXJUeXBlIHBhcmFtZXRlciIKICAgICAgICAgICAgICAgIC4gIiBpcyBpbnZhbGlkISIsCiAgICAgICAgfTsKICAgIH0KCiAgICAjIGNoZWNrIEFydGljbGUtPkZyb20KICAgIGlmICggJEFydGljbGUtPntGcm9tfSApIHsKICAgICAgICBpZiAoICEkU2VsZi0+VmFsaWRhdGVGcm9tKCAleyRBcnRpY2xlfSApICkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgRXJyb3JDb2RlICAgID0+ICdUaWNrZXRDcmVhdGUuSW52YWxpZFBhcmFtZXRlcicsCiAgICAgICAgICAgICAgICBFcnJvck1lc3NhZ2UgPT4gIlRpY2tldENyZWF0ZTogQXJ0aWNsZS0+RnJvbSBwYXJhbWV0ZXIgaXMgaW52YWxpZCEiLAogICAgICAgICAgICB9OwogICAgICAgIH0KICAgIH0KCiAgICAjIGNoZWNrIHRoYXQgQXJ0aWNsZS0+VG8gaXMgc2V0IHdoZW4gQXJ0aWNsZS0+QXJ0aWNsZVNlbmQgaXMgc2V0LgogICAgaWYgKAogICAgICAgICRBcnRpY2xlLT57QXJ0aWNsZVNlbmR9CiAgICAgICAgJiYgISRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDaGVja0l0ZW0nKS0+QXJlRW1haWxBZGRyZXNzZXNWYWxpZCggRW1haWxBZGRyZXNzZXMgPT4gJEFydGljbGUtPntUb30gKQogICAgICAgICkKICAgIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBFcnJvckNvZGUgPT4gJ1RpY2tldENyZWF0ZS5JbnZhbGlkUGFyYW1ldGVyJywKICAgICAgICAgICAgRXJyb3JNZXNzYWdlID0+CiAgICAgICAgICAgICAgICAiVGlja2V0Q3JlYXRlOiBBcnRpY2xlLT5UbyBwYXJhbWV0ZXIgbXVzdCBiZSBhIHZhbGlkIGVtYWlsIGFkZHJlc3Mgd2hlbiBBcnRpY2xlLT5BcnRpY2xlU2VuZCBpcyBzZXQhIiwKICAgICAgICB9OwogICAgfQoKICAgICMgY2hlY2sgQXJ0aWNsZS0+Q29udGVudFR5cGUgdnMgQXJ0aWNsZS0+TWltZVR5cGUgYW5kIEFydGljbGUtPkNoYXJzZXQKICAgIGlmICggISRBcnRpY2xlLT57Q29udGVudFR5cGV9ICYmICEkQXJ0aWNsZS0+e01pbWVUeXBlfSAmJiAhJEFydGljbGUtPntDaGFyc2V0fSApIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBFcnJvckNvZGUgICAgPT4gJ1RpY2tldENyZWF0ZS5NaXNzaW5nUGFyYW1ldGVyJywKICAgICAgICAgICAgRXJyb3JNZXNzYWdlID0+ICJUaWNrZXRDcmVhdGU6IEFydGljbGUtPkNvbnRlbnRUeXBlIG9yIFRpY2tldC0+TWltZVR5cGUgYW5kIgogICAgICAgICAgICAgICAgLiAiIEFydGljbGUtPkNoYXJzZXQgcGFyYW1ldGVycyBhcmUgcmVxdWlyZWQhIiwKICAgICAgICB9OwogICAgfQoKICAgIGlmICggJEFydGljbGUtPntNaW1lVHlwZX0gJiYgISRBcnRpY2xlLT57Q2hhcnNldH0gKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgRXJyb3JDb2RlICAgID0+ICdUaWNrZXRDcmVhdGUuTWlzc2luZ1BhcmFtZXRlcicsCiAgICAgICAgICAgIEVycm9yTWVzc2FnZSA9PiAiVGlja2V0Q3JlYXRlOiBBcnRpY2xlLT5DaGFyc2V0IGlzIHJlcXVpcmVkISIsCiAgICAgICAgfTsKICAgIH0KCiAgICBpZiAoICRBcnRpY2xlLT57Q2hhcnNldH0gJiYgISRBcnRpY2xlLT57TWltZVR5cGV9ICkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIEVycm9yQ29kZSAgICA9PiAnVGlja2V0Q3JlYXRlLk1pc3NpbmdQYXJhbWV0ZXInLAogICAgICAgICAgICBFcnJvck1lc3NhZ2UgPT4gIlRpY2tldENyZWF0ZTogQXJ0aWNsZS0+TWltZVR5cGUgaXMgcmVxdWlyZWQhIiwKICAgICAgICB9OwogICAgfQoKICAgICMgY2hlY2sgQXJ0aWNsZS0+TWltZVR5cGUKICAgIGlmICggJEFydGljbGUtPntNaW1lVHlwZX0gKSB7CgogICAgICAgICRBcnRpY2xlLT57TWltZVR5cGV9ID0gbGMgJEFydGljbGUtPntNaW1lVHlwZX07CgogICAgICAgIGlmICggISRTZWxmLT5WYWxpZGF0ZU1pbWVUeXBlKCAleyRBcnRpY2xlfSApICkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgRXJyb3JDb2RlICAgID0+ICdUaWNrZXRDcmVhdGUuSW52YWxpZFBhcmFtZXRlcicsCiAgICAgICAgICAgICAgICBFcnJvck1lc3NhZ2UgPT4gIlRpY2tldENyZWF0ZTogQXJ0aWNsZS0+TWltZVR5cGUgaXMgaW52YWxpZCEiLAogICAgICAgICAgICB9OwogICAgICAgIH0KICAgIH0KCiAgICAjIGNoZWNrIEFydGljbGUtPk1pbWVUeXBlCiAgICBpZiAoICRBcnRpY2xlLT57Q2hhcnNldH0gKSB7CgogICAgICAgICRBcnRpY2xlLT57Q2hhcnNldH0gPSBsYyAkQXJ0aWNsZS0+e0NoYXJzZXR9OwoKICAgICAgICBpZiAoICEkU2VsZi0+VmFsaWRhdGVDaGFyc2V0KCAleyRBcnRpY2xlfSApICkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgRXJyb3JDb2RlICAgID0+ICdUaWNrZXRDcmVhdGUuSW52YWxpZFBhcmFtZXRlcicsCiAgICAgICAgICAgICAgICBFcnJvck1lc3NhZ2UgPT4gIlRpY2tldENyZWF0ZTogQXJ0aWNsZS0+Q2hhcnNldCBpcyBpbnZhbGlkISIsCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgfQoKICAgICMgY2hlY2sgQXJ0aWNsZS0+Q29udGVudFR5cGUKICAgIGlmICggJEFydGljbGUtPntDb250ZW50VHlwZX0gKSB7CgogICAgICAgICRBcnRpY2xlLT57Q29udGVudFR5cGV9ID0gbGMgJEFydGljbGUtPntDb250ZW50VHlwZX07CgogICAgICAgICMgY2hlY2sgQ2hhcnNldCBwYXJ0CiAgICAgICAgbXkgJENoYXJzZXQgPSAnJzsKICAgICAgICBpZiAoICRBcnRpY2xlLT57Q29udGVudFR5cGV9ID1+IC9jaGFyc2V0PS9pICkgewogICAgICAgICAgICAkQ2hhcnNldCA9ICRBcnRpY2xlLT57Q29udGVudFR5cGV9OwogICAgICAgICAgICAkQ2hhcnNldCA9fiBzLy4rP2NoYXJzZXQ9KCJ8J3wpKFx3KykvJDIvZ2k7CiAgICAgICAgICAgICRDaGFyc2V0ID1+IHMvInwnLy9nOwogICAgICAgICAgICAkQ2hhcnNldCA9fiBzLyguKz8pOy4qLyQxL2c7CiAgICAgICAgfQoKICAgICAgICBpZiAoICEkU2VsZi0+VmFsaWRhdGVDaGFyc2V0KCBDaGFyc2V0ID0+ICRDaGFyc2V0ICkgKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBFcnJvckNvZGUgICAgPT4gJ1RpY2tldENyZWF0ZS5JbnZhbGlkUGFyYW1ldGVyJywKICAgICAgICAgICAgICAgIEVycm9yTWVzc2FnZSA9PiAiVGlja2V0Q3JlYXRlOiBBcnRpY2xlLT5Db250ZW50VHlwZSBpcyBpbnZhbGlkISIsCiAgICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICAjIGNoZWNrIE1pbWVUeXBlIHBhcnQKICAgICAgICBteSAkTWltZVR5cGUgPSAnJzsKICAgICAgICBpZiAoICRBcnRpY2xlLT57Q29udGVudFR5cGV9ID1+IC9eKFx3K1wvXHcrKS9pICkgewogICAgICAgICAgICAkTWltZVR5cGUgPSAkMTsKICAgICAgICAgICAgJE1pbWVUeXBlID1+IHMvInwnLy9nOwogICAgICAgIH0KCiAgICAgICAgaWYgKCAhJFNlbGYtPlZhbGlkYXRlTWltZVR5cGUoIE1pbWVUeXBlID0+ICRNaW1lVHlwZSApICkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgRXJyb3JDb2RlICAgID0+ICdUaWNrZXRDcmVhdGUuSW52YWxpZFBhcmFtZXRlcicsCiAgICAgICAgICAgICAgICBFcnJvck1lc3NhZ2UgPT4gIlRpY2tldENyZWF0ZTogQXJ0aWNsZS0+Q29udGVudFR5cGUgaXMgaW52YWxpZCEiLAogICAgICAgICAgICB9OwogICAgICAgIH0KICAgIH0KCiAgICAjIGNoZWNrIEFydGljbGUtPkhpc3RvcnlUeXBlCiAgICBpZiAoICEkQXJ0aWNsZS0+e0hpc3RvcnlUeXBlfSApIHsKCiAgICAgICAgIyByZXR1cm4gaW50ZXJuYWwgc2VydmVyIGVycm9yCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgRXJyb3JNZXNzYWdlID0+ICJUaWNrZXRDcmVhdGU6IEFydGljbGUtPiBIaXN0b3J5VHlwZSBpcyByZXF1aXJlZCBhbmQgU3lzY29uZmlnIgogICAgICAgICAgICAgICAgLiAiIEhpc3RvcnlUeXBlIHNldHRpbmcgY291bGQgbm90IGJlIHJlYWQhIgogICAgICAgIH07CiAgICB9CiAgICBpZiAoICEkU2VsZi0+VmFsaWRhdGVIaXN0b3J5VHlwZSggJXskQXJ0aWNsZX0gKSApIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBFcnJvckNvZGUgICAgPT4gJ1RpY2tldENyZWF0ZS5JbnZhbGlkUGFyYW1ldGVyJywKICAgICAgICAgICAgRXJyb3JNZXNzYWdlID0+ICJUaWNrZXRDcmVhdGU6IEFydGljbGUtPkhpc3RvcnlUeXBlIHBhcmFtZXRlciBpcyBpbnZhbGlkISIsCiAgICAgICAgfTsKICAgIH0KCiAgICAjIGNoZWNrIEFydGljbGUtPkhpc3RvcnlDb21tZW50CiAgICBpZiAoICEkQXJ0aWNsZS0+e0hpc3RvcnlDb21tZW50fSApIHsKCiAgICAgICAgIyByZXR1cm4gaW50ZXJuYWwgc2VydmVyIGVycm9yCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgRXJyb3JNZXNzYWdlID0+ICJUaWNrZXRDcmVhdGU6IEFydGljbGUtPkhpc3RvcnlDb21tZW50IGlzIHJlcXVpcmVkIGFuZCBTeXNjb25maWciCiAgICAgICAgICAgICAgICAuICIgSGlzdG9yeUNvbW1lbnQgc2V0dGluZyBjb3VsZCBub3QgYmUgcmVhZCEiCiAgICAgICAgfTsKICAgIH0KCiAgICAjIGdldCBjb25maWcgb2JqZWN0CiAgICBteSAkQ29uZmlnT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKTsKCiAgICAjIGNoZWNrIEFydGljbGUtPlRpbWVVbml0CiAgICAjIFRpbWVVbml0IGNvdWxkIGJlIHJlcXVpcmVkIG9yIG5vdCBkZXBlbmRpbmcgb24gc3lzY29uZmlnIG9wdGlvbgogICAgaWYgKAogICAgICAgICggIWRlZmluZWQgJEFydGljbGUtPntUaW1lVW5pdH0gfHwgIUlzU3RyaW5nV2l0aERhdGEoICRBcnRpY2xlLT57VGltZVVuaXR9ICkgKQogICAgICAgICYmICRDb25maWdPYmplY3QtPnsnVGlja2V0OjpGcm9udGVuZDo6QWNjb3VudFRpbWUnfQogICAgICAgICYmICRDb25maWdPYmplY3QtPnsnVGlja2V0OjpGcm9udGVuZDo6TmVlZEFjY291bnRlZFRpbWUnfQogICAgICAgICkKICAgIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBFcnJvckNvZGUgICAgPT4gJ1RpY2tldENyZWF0ZS5NaXNzaW5nUGFyYW1ldGVyJywKICAgICAgICAgICAgRXJyb3JNZXNzYWdlID0+ICJUaWNrZXRDcmVhdGU6IEFydGljbGUtPlRpbWVVbml0IGlzIHJlcXVpcmVkIGJ5IHN5c2NvbmZpZyBvcHRpb24hIiwKICAgICAgICB9OwogICAgfQogICAgaWYgKCAkQXJ0aWNsZS0+e1RpbWVVbml0fSApIHsKICAgICAgICBpZiAoICEkU2VsZi0+VmFsaWRhdGVUaW1lVW5pdCggJXskQXJ0aWNsZX0gKSApIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIEVycm9yQ29kZSAgICA9PiAnVGlja2V0Q3JlYXRlLkludmFsaWRQYXJhbWV0ZXInLAogICAgICAgICAgICAgICAgRXJyb3JNZXNzYWdlID0+ICJUaWNrZXRDcmVhdGU6IEFydGljbGUtPlRpbWVVbml0IHBhcmFtZXRlciBpcyBpbnZhbGlkISIsCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgfQoKICAgICMgY2hlY2sgQXJ0aWNsZS0+Tm9BZ2VudE5vdGlmeQogICAgaWYgKCAkQXJ0aWNsZS0+e05vQWdlbnROb3RpZnl9ICYmICRBcnRpY2xlLT57Tm9BZ2VudE5vdGlmeX0gbmUgJzEnICkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIEVycm9yQ29kZSAgICA9PiAnVGlja2V0Q3JlYXRlLkludmFsaWRQYXJhbWV0ZXInLAogICAgICAgICAgICBFcnJvck1lc3NhZ2UgPT4gIlRpY2tldENyZWF0ZTogQXJ0aWNsZS0+Tm9BZ2VudCBwYXJhbWV0ZXIgaXMgaW52YWxpZCEiLAogICAgICAgIH07CiAgICB9CgogICAgIyBjaGVjayBBcnRpY2xlIGFycmF5IHBhcmFtZXRlcnMKICAgIGZvciBteSAkQXR0cmlidXRlICgKICAgICAgICBxdyggRm9yY2VOb3RpZmljYXRpb25Ub1VzZXJJRCBFeGNsdWRlTm90aWZpY2F0aW9uVG9Vc2VySUQgRXhjbHVkZU11dGVOb3RpZmljYXRpb25Ub1VzZXJJRCApCiAgICAgICAgKQogICAgewogICAgICAgIGlmICggZGVmaW5lZCAkQXJ0aWNsZS0+eyRBdHRyaWJ1dGV9ICkgewoKICAgICAgICAgICAgIyBjaGVjayBzdHJ1Y3R1cmUKICAgICAgICAgICAgaWYgKCBJc0hhc2hSZWZXaXRoRGF0YSggJEFydGljbGUtPnskQXR0cmlidXRlfSApICkgewogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICBFcnJvckNvZGUgICAgPT4gJ1RpY2tldENyZWF0ZS5JbnZhbGlkUGFyYW1ldGVyJywKICAgICAgICAgICAgICAgICAgICBFcnJvck1lc3NhZ2UgPT4gIlRpY2tldENyZWF0ZTogQXJ0aWNsZS0+JEF0dHJpYnV0ZSBwYXJhbWV0ZXIgaXMgaW52YWxpZCEiLAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGlmICggIUlzQXJyYXlSZWZXaXRoRGF0YSggJEFydGljbGUtPnskQXR0cmlidXRlfSApICkgewogICAgICAgICAgICAgICAgICAgICRBcnRpY2xlLT57JEF0dHJpYnV0ZX0gPSBbICRBcnRpY2xlLT57JEF0dHJpYnV0ZX0gXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZvciBteSAkVXNlcklEICggQHsgJEFydGljbGUtPnskQXR0cmlidXRlfSB9ICkgewogICAgICAgICAgICAgICAgICAgIGlmICggISRTZWxmLT5WYWxpZGF0ZVVzZXJJRCggVXNlcklEID0+ICRVc2VySUQgKSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVycm9yQ29kZSAgICA9PiAnVGlja2V0Q3JlYXRlLkludmFsaWRQYXJhbWV0ZXInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgRXJyb3JNZXNzYWdlID0+ICJUaWNrZXRDcmVhdGU6IEFydGljbGUtPiRBdHRyaWJ1dGUgVXNlcklEPSRVc2VySUQiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLiAiIHBhcmFtZXRlciBpcyBpbnZhbGlkISIsCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGlmICggJEFydGljbGUtPntBdHRhY2htZW50fSAmJiBJc0FycmF5UmVmV2l0aERhdGEoICRBcnRpY2xlLT57QXR0YWNobWVudH0gKSApIHsKICAgICAgICBmb3IgbXkgJEF0dGFjaG1lbnQgKCBAeyAkQXJ0aWNsZS0+e0F0dGFjaG1lbnR9IH0gKSB7CiAgICAgICAgICAgIG15ICRBdHRhY2htZW50Q2hlY2sgPSAkU2VsZi0+X0NoZWNrQXR0YWNobWVudCggQXR0YWNobWVudCA9PiAkQXR0YWNobWVudCApOwogICAgICAgICAgICBpZiAoICEkQXR0YWNobWVudENoZWNrLT57U3VjY2Vzc30gKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJFNlbGYtPlJldHVybkVycm9yKCAleyRBdHRhY2htZW50Q2hlY2t9ICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgIyBpZiBldmVyeXRoaW5nIGlzIE9LIHRoZW4gcmV0dXJuIFN1Y2Nlc3MKICAgIHJldHVybiB7CiAgICAgICAgU3VjY2VzcyA9PiAxLAogICAgfTsKfQoKPWhlYWQyIF9DaGVja0R5bmFtaWNGaWVsZCgpCgpjaGVja3MgaWYgdGhlIGdpdmVuIGR5bmFtaWMgZmllbGQgcGFyYW1ldGVyIGlzIHZhbGlkLgoKICAgIG15ICREeW5hbWljRmllbGRDaGVjayA9ICRPcGVyYXRpb25PYmplY3QtPl9DaGVja0R5bmFtaWNGaWVsZCgKICAgICAgICBEeW5hbWljRmllbGQgPT4gJER5bmFtaWNGaWVsZCwgICAgICAgICAgICAgICMgYWxsIGR5bmFtaWMgZmllbGQgcGFyYW1ldGVycwogICAgKTsKCiAgICByZXR1cm5zOgoKICAgICREeW5hbWljRmllbGRDaGVjayA9IHsKICAgICAgICBTdWNjZXNzID0+IDEsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgaWYgZXZlcnl0aGluZyBpcyBPSwogICAgfQoKICAgICREeW5hbWljRmllbGRDaGVjayA9IHsKICAgICAgICBFcnJvckNvZGUgICAgPT4gJ0Z1bmN0aW9uLkVycm9yJywgICAgICAgICAgICMgaWYgZXJyb3IKICAgICAgICBFcnJvck1lc3NhZ2UgPT4gJ0Vycm9yIGRlc2NyaXB0aW9uJywKICAgIH0KCj1jdXQKCnN1YiBfQ2hlY2tEeW5hbWljRmllbGQgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkRHluYW1pY0ZpZWxkID0gJFBhcmFte0R5bmFtaWNGaWVsZH07CgogICAgIyBjaGVjayBEeW5hbWljRmllbGQgaXRlbSBpbnRlcm5hbGx5CiAgICBmb3IgbXkgJE5lZWRlZCAocXcoTmFtZSBWYWx1ZSkpIHsKICAgICAgICBpZiAoCiAgICAgICAgICAgICFkZWZpbmVkICREeW5hbWljRmllbGQtPnskTmVlZGVkfQogICAgICAgICAgICB8fCAoICFJc1N0cmluZyggJER5bmFtaWNGaWVsZC0+eyROZWVkZWR9ICkgJiYgcmVmICREeW5hbWljRmllbGQtPnskTmVlZGVkfSBuZSAnQVJSQVknICkKICAgICAgICAgICAgKQogICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIEVycm9yQ29kZSAgICA9PiAnVGlja2V0Q3JlYXRlLk1pc3NpbmdQYXJhbWV0ZXInLAogICAgICAgICAgICAgICAgRXJyb3JNZXNzYWdlID0+ICJUaWNrZXRDcmVhdGU6IER5bmFtaWNGaWVsZC0+JE5lZWRlZCAgcGFyYW1ldGVyIGlzIG1pc3NpbmchIiwKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICB9CgogICAgIyBjaGVjayBEeW5hbWljRmllbGQtPk5hbWUKICAgIGlmICggISRTZWxmLT5WYWxpZGF0ZUR5bmFtaWNGaWVsZE5hbWUoICV7JER5bmFtaWNGaWVsZH0gKSApIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBFcnJvckNvZGUgICAgPT4gJ1RpY2tldENyZWF0ZS5JbnZhbGlkUGFyYW1ldGVyJywKICAgICAgICAgICAgRXJyb3JNZXNzYWdlID0+ICJUaWNrZXRDcmVhdGU6IER5bmFtaWNGaWVsZC0+TmFtZSBwYXJhbWV0ZXIgaXMgaW52YWxpZCEiLAogICAgICAgIH07CiAgICB9CgogICAgIyBjaGVjayBEeW5hbWljRmllbGQtPlZhbHVlCiAgICBpZiAoICEkU2VsZi0+VmFsaWRhdGVEeW5hbWljRmllbGRWYWx1ZSggJXskRHluYW1pY0ZpZWxkfSApICkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIEVycm9yQ29kZSAgICA9PiAnVGlja2V0Q3JlYXRlLkludmFsaWRQYXJhbWV0ZXInLAogICAgICAgICAgICBFcnJvck1lc3NhZ2UgPT4gIlRpY2tldENyZWF0ZTogRHluYW1pY0ZpZWxkLT5WYWx1ZSBwYXJhbWV0ZXIgaXMgaW52YWxpZCEiLAogICAgICAgIH07CiAgICB9CgogICAgIyBpZiBldmVyeXRoaW5nIGlzIE9LIHRoZW4gcmV0dXJuIFN1Y2Nlc3MKICAgIHJldHVybiB7CiAgICAgICAgU3VjY2VzcyA9PiAxLAogICAgfTsKfQoKPWhlYWQyIF9DaGVja0F0dGFjaG1lbnQoKQoKY2hlY2tzIGlmIHRoZSBnaXZlbiBhdHRhY2htZW50IHBhcmFtZXRlciBpcyB2YWxpZC4KCiAgICBteSAkQXR0YWNobWVudENoZWNrID0gJE9wZXJhdGlvbk9iamVjdC0+X0NoZWNrQXR0YWNobWVudCgKICAgICAgICBBdHRhY2htZW50ID0+ICRBdHRhY2htZW50LCAgICAgICAgICAgICAgICAgICMgYWxsIGF0dGFjaG1lbnQgcGFyYW1ldGVycwogICAgKTsKCiAgICByZXR1cm5zOgoKICAgICRBdHRhY2htZW50Q2hlY2sgPSB7CiAgICAgICAgU3VjY2VzcyA9PiAxLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGlmIGV2ZXJ5dGhpbmcgaXMgT0sKICAgIH0KCiAgICAkQXR0YWNobWVudENoZWNrID0gewogICAgICAgIEVycm9yQ29kZSAgICA9PiAnRnVuY3Rpb24uRXJyb3InLCAgICAgICAgICAgIyBpZiBlcnJvcgogICAgICAgIEVycm9yTWVzc2FnZSA9PiAnRXJyb3IgZGVzY3JpcHRpb24nLAogICAgfQoKPWN1dAoKc3ViIF9DaGVja0F0dGFjaG1lbnQgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkQXR0YWNobWVudCA9ICRQYXJhbXtBdHRhY2htZW50fTsKCiAgICAjIGNoZWNrIGF0dGFjaG1lbnQgaXRlbSBpbnRlcm5hbGx5CiAgICBmb3IgbXkgJE5lZWRlZCAocXcoQ29udGVudCBDb250ZW50VHlwZSBGaWxlbmFtZSkpIHsKICAgICAgICBpZiAoICFJc1N0cmluZ1dpdGhEYXRhKCAkQXR0YWNobWVudC0+eyROZWVkZWR9ICkgKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBFcnJvckNvZGUgICAgPT4gJ1RpY2tldENyZWF0ZS5NaXNzaW5nUGFyYW1ldGVyJywKICAgICAgICAgICAgICAgIEVycm9yTWVzc2FnZSA9PiAiVGlja2V0Q3JlYXRlOiBBdHRhY2htZW50LT4kTmVlZGVkICBwYXJhbWV0ZXIgaXMgbWlzc2luZyEiLAogICAgICAgICAgICB9OwogICAgICAgIH0KICAgIH0KCiAgICAjIGNoZWNrIEFydGljbGUtPkNvbnRlbnRUeXBlCiAgICBpZiAoICRBdHRhY2htZW50LT57Q29udGVudFR5cGV9ICkgewoKICAgICAgICAkQXR0YWNobWVudC0+e0NvbnRlbnRUeXBlfSA9IGxjICRBdHRhY2htZW50LT57Q29udGVudFR5cGV9OwoKICAgICAgICAjIGNoZWNrIENoYXJzZXQgcGFydAogICAgICAgIG15ICRDaGFyc2V0ID0gJyc7CiAgICAgICAgaWYgKCAkQXR0YWNobWVudC0+e0NvbnRlbnRUeXBlfSA9fiAvY2hhcnNldD0vaSApIHsKICAgICAgICAgICAgJENoYXJzZXQgPSAkQXR0YWNobWVudC0+e0NvbnRlbnRUeXBlfTsKICAgICAgICAgICAgJENoYXJzZXQgPX4gcy8uKz9jaGFyc2V0PSgifCd8KShcdyspLyQyL2dpOwogICAgICAgICAgICAkQ2hhcnNldCA9fiBzLyJ8Jy8vZzsKICAgICAgICAgICAgJENoYXJzZXQgPX4gcy8oLis/KTsuKi8kMS9nOwogICAgICAgIH0KCiAgICAgICAgaWYgKCAkQ2hhcnNldCAmJiAhJFNlbGYtPlZhbGlkYXRlQ2hhcnNldCggQ2hhcnNldCA9PiAkQ2hhcnNldCApICkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgRXJyb3JDb2RlICAgID0+ICdUaWNrZXRDcmVhdGUuSW52YWxpZFBhcmFtZXRlcicsCiAgICAgICAgICAgICAgICBFcnJvck1lc3NhZ2UgPT4gIlRpY2tldENyZWF0ZTogQXR0YWNobWVudC0+Q29udGVudFR5cGUgaXMgaW52YWxpZCEiLAogICAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgIyBjaGVjayBNaW1lVHlwZSBwYXJ0CiAgICAgICAgbXkgJE1pbWVUeXBlID0gJyc7CiAgICAgICAgaWYgKCAkQXR0YWNobWVudC0+e0NvbnRlbnRUeXBlfSA9fiAvXihcdytcL1x3KykvaSApIHsKICAgICAgICAgICAgJE1pbWVUeXBlID0gJDE7CiAgICAgICAgICAgICRNaW1lVHlwZSA9fiBzLyJ8Jy8vZzsKICAgICAgICB9CgogICAgICAgIGlmICggISRTZWxmLT5WYWxpZGF0ZU1pbWVUeXBlKCBNaW1lVHlwZSA9PiAkTWltZVR5cGUgKSApIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIEVycm9yQ29kZSAgICA9PiAnVGlja2V0Q3JlYXRlLkludmFsaWRQYXJhbWV0ZXInLAogICAgICAgICAgICAgICAgRXJyb3JNZXNzYWdlID0+ICJUaWNrZXRDcmVhdGU6IEF0dGFjaG1lbnQtPkNvbnRlbnRUeXBlIGlzIGludmFsaWQhIiwKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICB9CgogICAgIyBpZiBldmVyeXRoaW5nIGlzIE9LIHRoZW4gcmV0dXJuIFN1Y2Nlc3MKICAgIHJldHVybiB7CiAgICAgICAgU3VjY2VzcyA9PiAxLAogICAgfTsKfQoKPWhlYWQyIF9UaWNrZXRDcmVhdGUoKQoKY3JlYXRlcyBhIHRpY2tldCB3aXRoIGl0cyBhcnRpY2xlIGFuZCBzZXRzIGR5bmFtaWMgZmllbGRzIGFuZCBhdHRhY2htZW50cyBpZiBzcGVjaWZpZWQuCgogICAgbXkgJFJlc3BvbnNlID0gJE9wZXJhdGlvbk9iamVjdC0+X1RpY2tldENyZWF0ZSgKICAgICAgICBUaWNrZXQgICAgICAgPT4gJFRpY2tldCwgICAgICAgICAgICAgICAgICAjIGFsbCB0aWNrZXQgcGFyYW1ldGVycwogICAgICAgIEFydGljbGUgICAgICA9PiBcQEFydGljbGUsICAgICAgICAgICAgICAgICMgYWxsIGFydGljbGUgcGFyYW1ldGVycwogICAgICAgIER5bmFtaWNGaWVsZCA9PiAkRHluYW1pY0ZpZWxkLCAgICAgICAgICAgICMgYWxsIGR5bmFtaWMgZmllbGQgcGFyYW1ldGVycwogICAgICAgIEF0dGFjaG1lbnQgICA9PiAkQXR0YWNobWVudCwgICAgICAgICAgICAgIyBhbGwgYXR0YWNobWVudCBwYXJhbWV0ZXJzCiAgICAgICAgVXNlcklEICAgICAgID0+IDEyMywKICAgICk7CgogICAgcmV0dXJuczoKCiAgICAkUmVzcG9uc2UgPSB7CiAgICAgICAgU3VjY2VzcyA9PiAxLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGlmIGV2ZXJ5dGhpbmcgd2FzIE9LCiAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgIFRpY2tldElEICAgICA9PiAxMjMsCiAgICAgICAgICAgIFRpY2tldE51bWJlciA9PiAnVE4zNDIyMzMyJywKICAgICAgICAgICAgQXJ0aWNsZUlEICAgID0+IDEyMywKICAgICAgICB9CiAgICB9CgogICAgJFJlc3BvbnNlID0gewogICAgICAgIFN1Y2Nlc3MgICAgICA9PiAwLCAgICAgICAgICAgICAgICAgICAgICAgICAjIGlmIHVuZXhwZWN0ZWQgZXJyb3IKICAgICAgICBFcnJvck1lc3NhZ2UgPT4gIiRQYXJhbXtFcnJvckNvZGV9OiAkUGFyYW17RXJyb3JNZXNzYWdlfSIsCiAgICB9Cgo9Y3V0CgpzdWIgX1RpY2tldENyZWF0ZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRUaWNrZXQgICAgICAgICAgID0gJFBhcmFte1RpY2tldH07CiAgICBteSBAQXJ0aWNsZSAgICAgICAgICA9IEB7ICRQYXJhbXtBcnRpY2xlfSB9OwogICAgbXkgJER5bmFtaWNGaWVsZExpc3QgPSAkUGFyYW17RHluYW1pY0ZpZWxkTGlzdH07CiAgICBteSAkQXR0YWNobWVudExpc3QgICA9ICRQYXJhbXtBdHRhY2htZW50TGlzdH07CiAgICBteSAkQ3VzdG9tZXJVc2VyICAgICA9ICRUaWNrZXQtPntDdXN0b21lclVzZXJ9IHx8ICcnOwoKICAgICMgR2V0IGN1c3RvbWVyIGluZm9ybWF0aW9uLCB0aGF0IHdpbGwgYmUgdXNlZCB0byBjcmVhdGUgdGhlIHRpY2tldC4KICAgICMgSWYgVGlja2V0Q3JlYXRlIEN1c3RvbWVyVXNlciBwYXJhbWV0ZXIgaXMgZGVmaW5lZCwKICAgICMgICBjaGVjayBpZiB0aGVyZSBpcyBDdXN0b21lclVzZXIgaW4gREIgd2l0aCBzdWNoIGFkZHJlc3MsCiAgICAjIElmIGFkZHJlc3MsIGRlZmluZWQgaW4gJFRpY2tldC0+e0N1c3RvbWVyVXNlcn0sCiAgICAjICAgIGlzIG5vdCB2YWxpZCwgVmFsaWRhdGVDdXN0b21lcigpIHdpbGwgbm90IGFsbG93ZWQgdG8gcnVuIFRpY2tldENyZWF0ZS4KICAgICMgU2VlIG1vcmUgaW5mb3JtYXRpb24gaW4gYnVnIzE0Mjg4LgogICAgbXkgJEN1c3RvbWVyVXNlck9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDdXN0b21lclVzZXInKTsKICAgIG15ICVDdXN0b21lclVzZXJEYXRhICAgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJEYXRhR2V0KAogICAgICAgIFVzZXIgPT4gJFRpY2tldC0+e0N1c3RvbWVyVXNlcn0sCiAgICApOwoKICAgIGlmICggIUlzSGFzaFJlZldpdGhEYXRhKCBcJUN1c3RvbWVyVXNlckRhdGEgKSApIHsKICAgICAgICBteSAlQ3VzdG9tZXJTZWFyY2ggPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclNlYXJjaCgKICAgICAgICAgICAgUG9zdE1hc3RlclNlYXJjaCA9PiAkQ3VzdG9tZXJVc2VyLAogICAgICAgICAgICBMaW1pdCAgICAgICAgICAgID0+IDEsCiAgICAgICAgICAgIFVzZXJJRCAgICAgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICk7CgogICAgICAgIGlmICggSXNIYXNoUmVmV2l0aERhdGEoIFwlQ3VzdG9tZXJTZWFyY2ggKSApIHsKICAgICAgICAgICAgbXkgQEN1c3RvbWVyU2VhcmNoUmVzdWx0cyA9IHNvcnQga2V5cyAlQ3VzdG9tZXJTZWFyY2g7CiAgICAgICAgICAgICRDdXN0b21lclVzZXIgPSAkQ3VzdG9tZXJTZWFyY2hSZXN1bHRzWzBdOwoKICAgICAgICAgICAgJUN1c3RvbWVyVXNlckRhdGEgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJEYXRhR2V0KAogICAgICAgICAgICAgICAgVXNlciA9PiAkQ3VzdG9tZXJVc2VyLAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkQ3VzdG9tZXJVc2VyID0gJEN1c3RvbWVyVXNlckRhdGF7VXNlckxvZ2lufTsKICAgIH0KCiAgICBteSAkQ3VzdG9tZXJJRCA9ICRDdXN0b21lclVzZXJEYXRhe1VzZXJDdXN0b21lcklEfSB8fCAnJzsKCiAgICAjIHVzZSB1c2VyIGRlZmluZWQgQ3VzdG9tZXJJRCBpZiBkZWZpbmVkCiAgICBpZiAoIGRlZmluZWQgJFRpY2tldC0+e0N1c3RvbWVySUR9ICYmICRUaWNrZXQtPntDdXN0b21lcklEfSBuZSAnJyApIHsKICAgICAgICAkQ3VzdG9tZXJJRCA9ICRUaWNrZXQtPntDdXN0b21lcklEfTsKICAgIH0KCiAgICAjIGdldCBkYXRhYmFzZSBvYmplY3QKICAgIG15ICRVc2VyT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlVzZXInKTsKCiAgICBteSAkT3duZXJJRDsKICAgIGlmICggJFRpY2tldC0+e093bmVyfSAmJiAhJFRpY2tldC0+e093bmVySUR9ICkgewogICAgICAgIG15ICVPd25lckRhdGEgPSAkVXNlck9iamVjdC0+R2V0VXNlckRhdGEoCiAgICAgICAgICAgIFVzZXIgPT4gJFRpY2tldC0+e093bmVyfSwKICAgICAgICApOwogICAgICAgICRPd25lcklEID0gJE93bmVyRGF0YXtVc2VySUR9OwogICAgfQogICAgZWxzaWYgKCBkZWZpbmVkICRUaWNrZXQtPntPd25lcklEfSApIHsKICAgICAgICAkT3duZXJJRCA9ICRUaWNrZXQtPntPd25lcklEfTsKICAgIH0KCiAgICBteSAkUmVzcG9uc2libGVJRDsKICAgIGlmICggJFRpY2tldC0+e1Jlc3BvbnNpYmxlfSAmJiAhJFRpY2tldC0+e1Jlc3BvbnNpYmxlSUR9ICkgewogICAgICAgIG15ICVSZXNwb25zaWJsZURhdGEgPSAkVXNlck9iamVjdC0+R2V0VXNlckRhdGEoCiAgICAgICAgICAgIFVzZXIgPT4gJFRpY2tldC0+e1Jlc3BvbnNpYmxlfSwKICAgICAgICApOwogICAgICAgICRSZXNwb25zaWJsZUlEID0gJFJlc3BvbnNpYmxlRGF0YXtVc2VySUR9OwogICAgfQogICAgZWxzaWYgKCBkZWZpbmVkICRUaWNrZXQtPntSZXNwb25zaWJsZUlEfSApIHsKICAgICAgICAkUmVzcG9uc2libGVJRCA9ICRUaWNrZXQtPntSZXNwb25zaWJsZUlEfTsKICAgIH0KCiAgICAjIGdldCB0aWNrZXQgb2JqZWN0CiAgICBteSAkVGlja2V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpY2tldCcpOwoKICAgICMgY3JlYXRlIG5ldyB0aWNrZXQKICAgIG15ICRUaWNrZXRJRCA9ICRUaWNrZXRPYmplY3QtPlRpY2tldENyZWF0ZSgKICAgICAgICBUaXRsZSAgICAgICAgPT4gJFRpY2tldC0+e1RpdGxlfSwKICAgICAgICBRdWV1ZUlEICAgICAgPT4gJFRpY2tldC0+e1F1ZXVlSUR9IHx8ICcnLAogICAgICAgIFF1ZXVlICAgICAgICA9PiAkVGlja2V0LT57UXVldWV9IHx8ICcnLAogICAgICAgIExvY2sgICAgICAgICA9PiAndW5sb2NrJywKICAgICAgICBUeXBlSUQgICAgICAgPT4gJFRpY2tldC0+e1R5cGVJRH0gfHwgJycsCiAgICAgICAgVHlwZSAgICAgICAgID0+ICRUaWNrZXQtPntUeXBlfSB8fCAnJywKICAgICAgICBTZXJ2aWNlSUQgICAgPT4gJFRpY2tldC0+e1NlcnZpY2VJRH0gfHwgJycsCiAgICAgICAgU2VydmljZSAgICAgID0+ICRUaWNrZXQtPntTZXJ2aWNlfSB8fCAnJywKICAgICAgICBTTEFJRCAgICAgICAgPT4gJFRpY2tldC0+e1NMQUlEfSB8fCAnJywKICAgICAgICBTTEEgICAgICAgICAgPT4gJFRpY2tldC0+e1NMQX0gfHwgJycsCiAgICAgICAgU3RhdGVJRCAgICAgID0+ICRUaWNrZXQtPntTdGF0ZUlEfSB8fCAnJywKICAgICAgICBTdGF0ZSAgICAgICAgPT4gJFRpY2tldC0+e1N0YXRlfSB8fCAnJywKICAgICAgICBQcmlvcml0eUlEICAgPT4gJFRpY2tldC0+e1ByaW9yaXR5SUR9IHx8ICcnLAogICAgICAgIFByaW9yaXR5ICAgICA9PiAkVGlja2V0LT57UHJpb3JpdHl9IHx8ICcnLAogICAgICAgIE93bmVySUQgICAgICA9PiAxLAogICAgICAgIEN1c3RvbWVyTm8gICA9PiAkQ3VzdG9tZXJJRCwKICAgICAgICBDdXN0b21lclVzZXIgPT4gJEN1c3RvbWVyVXNlciB8fCAnJywKICAgICAgICBVc2VySUQgICAgICAgPT4gJFBhcmFte1VzZXJJRH0sCiAgICApOwoKICAgIGlmICggISRUaWNrZXRJRCApIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBTdWNjZXNzICAgICAgPT4gMCwKICAgICAgICAgICAgRXJyb3JNZXNzYWdlID0+ICdUaWNrZXQgY291bGQgbm90IGJlIGNyZWF0ZWQsIHBsZWFzZSBjb250YWN0IHRoZSBzeXN0ZW0gYWRtaW5pc3RyYXRvcicsCiAgICAgICAgfTsKICAgIH0KCiAgICAjIHNldCBsb2NrIGlmIHNwZWNpZmllZAogICAgaWYgKCAkVGlja2V0LT57TG9ja30gfHwgJFRpY2tldC0+e0xvY2tJRH0gKSB7CiAgICAgICAgJFRpY2tldE9iamVjdC0+VGlja2V0TG9ja1NldCgKICAgICAgICAgICAgVGlja2V0SUQgPT4gJFRpY2tldElELAogICAgICAgICAgICBMb2NrSUQgICA9PiAkVGlja2V0LT57TG9ja0lEfSB8fCAnJywKICAgICAgICAgICAgTG9jayAgICAgPT4gJFRpY2tldC0+e0xvY2t9IHx8ICcnLAogICAgICAgICAgICBVc2VySUQgICA9PiAkUGFyYW17VXNlcklEfSwKICAgICAgICApOwogICAgfQoKICAgICMgZ2V0IFN0YXRlIERhdGEKICAgIG15ICVTdGF0ZURhdGE7CiAgICBteSAkU3RhdGVJRDsKCiAgICAjIGdldCBzdGF0ZSBvYmplY3QKICAgIG15ICRTdGF0ZU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpTdGF0ZScpOwoKICAgIGlmICggJFRpY2tldC0+e1N0YXRlSUR9ICkgewogICAgICAgICRTdGF0ZUlEID0gJFRpY2tldC0+e1N0YXRlSUR9OwogICAgfQogICAgZWxzZSB7CiAgICAgICAgJFN0YXRlSUQgPSAkU3RhdGVPYmplY3QtPlN0YXRlTG9va3VwKAogICAgICAgICAgICBTdGF0ZSA9PiAkVGlja2V0LT57U3RhdGV9LAogICAgICAgICk7CiAgICB9CgogICAgJVN0YXRlRGF0YSA9ICRTdGF0ZU9iamVjdC0+U3RhdGVHZXQoCiAgICAgICAgSUQgPT4gJFN0YXRlSUQsCiAgICApOwoKICAgICMgZm9yY2UgdW5sb2NrIGlmIHN0YXRlIHR5cGUgaXMgY2xvc2UKICAgIGlmICggJFN0YXRlRGF0YXtUeXBlTmFtZX0gPX4gL15jbG9zZS9pICkgewoKICAgICAgICAjIHNldCBsb2NrCiAgICAgICAgJFRpY2tldE9iamVjdC0+VGlja2V0TG9ja1NldCgKICAgICAgICAgICAgVGlja2V0SUQgPT4gJFRpY2tldElELAogICAgICAgICAgICBMb2NrICAgICA9PiAndW5sb2NrJywKICAgICAgICAgICAgVXNlcklEICAgPT4gJFBhcmFte1VzZXJJRH0sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIHNldCBwZW5kaW5nIHRpbWUKICAgIGVsc2lmICggJFN0YXRlRGF0YXtUeXBlTmFtZX0gPX4gL15wZW5kaW5nL2kgKSB7CgogICAgICAgICMgc2V0IHBlbmRpbmcgdGltZQogICAgICAgIGlmICggZGVmaW5lZCAkVGlja2V0LT57UGVuZGluZ1RpbWV9ICkgewogICAgICAgICAgICAkVGlja2V0T2JqZWN0LT5UaWNrZXRQZW5kaW5nVGltZVNldCgKICAgICAgICAgICAgICAgIFVzZXJJRCAgID0+ICRQYXJhbXtVc2VySUR9LAogICAgICAgICAgICAgICAgVGlja2V0SUQgPT4gJFRpY2tldElELAogICAgICAgICAgICAgICAgJXsgJFRpY2tldC0+e1BlbmRpbmdUaW1lfSB9LAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICAjIHNldCBkeW5hbWljIGZpZWxkcyAob25seSBmb3Igb2JqZWN0IHR5cGUgJ3RpY2tldCcpCiAgICBpZiAoIElzQXJyYXlSZWZXaXRoRGF0YSgkRHluYW1pY0ZpZWxkTGlzdCkgKSB7CgogICAgICAgIERZTkFNSUNGSUVMRDoKICAgICAgICBmb3IgbXkgJER5bmFtaWNGaWVsZCAoIEB7JER5bmFtaWNGaWVsZExpc3R9ICkgewogICAgICAgICAgICBuZXh0IERZTkFNSUNGSUVMRCBpZiAhJFNlbGYtPlZhbGlkYXRlRHluYW1pY0ZpZWxkT2JqZWN0VHlwZSggJXskRHluYW1pY0ZpZWxkfSApOwoKICAgICAgICAgICAgbXkgJFJlc3VsdCA9ICRTZWxmLT5TZXREeW5hbWljRmllbGRWYWx1ZSgKICAgICAgICAgICAgICAgICV7JER5bmFtaWNGaWVsZH0sCiAgICAgICAgICAgICAgICBUaWNrZXRJRCA9PiAkVGlja2V0SUQsCiAgICAgICAgICAgICAgICBVc2VySUQgICA9PiAkUGFyYW17VXNlcklEfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGlmICggISRSZXN1bHQtPntTdWNjZXNzfSApIHsKICAgICAgICAgICAgICAgIG15ICRFcnJvck1lc3NhZ2UgPQogICAgICAgICAgICAgICAgICAgICRSZXN1bHQtPntFcnJvck1lc3NhZ2V9IHx8ICJEeW5hbWljIEZpZWxkICREeW5hbWljRmllbGQtPntOYW1lfSBjb3VsZCBub3QgYmUiCiAgICAgICAgICAgICAgICAgICAgLiAiIHNldCwgcGxlYXNlIGNvbnRhY3QgdGhlIHN5c3RlbSBhZG1pbmlzdHJhdG9yIjsKCiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIFN1Y2Nlc3MgICAgICA9PiAwLAogICAgICAgICAgICAgICAgICAgIEVycm9yTWVzc2FnZSA9PiAkRXJyb3JNZXNzYWdlLAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBteSBAQXJ0aWNsZUlEczsKICAgIG15ICRBcnRpY2xlSUROZXc7CiAgICBmb3IgbXkgJEFydGljbGUgKEBBcnRpY2xlKSB7CiAgICAgICAgaWYgKCAhZGVmaW5lZCAkQXJ0aWNsZS0+e05vQWdlbnROb3RpZnl9ICkgewoKICAgICAgICAgICAgIyBjaGVjayBpZiBuZXcgb3duZXIgaXMgZ2l2ZW4gKHRoZW4gc2VuZCBubyBhZ2VudCBub3RpZnkpCiAgICAgICAgICAgICRBcnRpY2xlLT57Tm9BZ2VudE5vdGlmeX0gPSAwOwogICAgICAgICAgICBpZiAoJE93bmVySUQpIHsKICAgICAgICAgICAgICAgICRBcnRpY2xlLT57Tm9BZ2VudE5vdGlmeX0gPSAxOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIHNldCBBcnRpY2xlIEZyb20KICAgICAgICBteSAkRnJvbTsKCiAgICAgICAgIyBXaGVuIHdlIGFyZSBzZW5kaW5nIHRoZSBhcnRpY2xlIGFzIGFuIGVtYWlsLCBzZXQgdGhlIGZyb20gYWRkcmVzcyB0byB0aGUgdGlja2V0J3Mgc3lzdGVtIGFkZHJlc3MKICAgICAgICBpZiAoCiAgICAgICAgICAgICRBcnRpY2xlLT57QXJ0aWNsZVNlbmR9CiAgICAgICAgICAgICYmICEkQXJ0aWNsZS0+e0Zyb219CiAgICAgICAgICAgICkKICAgICAgICB7CiAgICAgICAgICAgIG15ICRRdWV1ZUlEID0gJFRpY2tldE9iamVjdC0+VGlja2V0UXVldWVJRCgKICAgICAgICAgICAgICAgIFRpY2tldElEID0+ICRUaWNrZXRJRCwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgbXkgJUFkZHJlc3MgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6UXVldWUnKS0+R2V0U3lzdGVtQWRkcmVzcygKICAgICAgICAgICAgICAgIFF1ZXVlSUQgPT4gJFF1ZXVlSUQsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgICRGcm9tID0gJEFkZHJlc3N7UmVhbE5hbWV9IC4gIiA8IiAuICRBZGRyZXNze0VtYWlsfSAuICI+IjsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmICggJEFydGljbGUtPntGcm9tfSApIHsKICAgICAgICAgICAgICAgICRGcm9tID0gJEFydGljbGUtPntGcm9tfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyB1c2UgZGF0YSBmcm9tIGN1c3RvbWVyIHVzZXIgKGlmIGN1c3RvbWVyIHVzZXIgaXMgaW4gZGF0YWJhc2UpCiAgICAgICAgICAgIGVsc2lmICggSXNIYXNoUmVmV2l0aERhdGEoIFwlQ3VzdG9tZXJVc2VyRGF0YSApICkgewogICAgICAgICAgICAgICAgJEZyb20gPSAnIicgLiAkQ3VzdG9tZXJVc2VyRGF0YXtVc2VyRnVsbG5hbWV9IC4gJyInCiAgICAgICAgICAgICAgICAgICAgLiAnIDwnIC4gJEN1c3RvbWVyVXNlckRhdGF7VXNlckVtYWlsfSAuICc+JzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBvdGhlcndpc2UgdXNlIGN1c3RvbWVyIHVzZXIgYXMgc2VudCBmcm9tIHRoZSByZXF1ZXN0IChpdCBzaG91bGQgYmUgYW4gZW1haWwpCiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJEZyb20gPSAkQ3VzdG9tZXJVc2VyOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIHNldCBBcnRpY2xlIFRvCiAgICAgICAgbXkgJFRvOwogICAgICAgIG15ICRDYzsKICAgICAgICBteSAkQmNjOwoKICAgICAgICBpZiAoICRBcnRpY2xlLT57QXJ0aWNsZVNlbmR9ICkgewogICAgICAgICAgICAkVG8gID0gJEFydGljbGUtPntUb307CiAgICAgICAgICAgICRDYyAgPSAkQXJ0aWNsZS0+e0NjfTsKICAgICAgICAgICAgJEJjYyA9ICRBcnRpY2xlLT57QmNjfTsKICAgICAgICB9CiAgICAgICAgZWxzaWYgKCAkVGlja2V0LT57UXVldWV9ICkgewogICAgICAgICAgICAkVG8gPSAkVGlja2V0LT57UXVldWV9OwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJFRvID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlF1ZXVlJyktPlF1ZXVlTG9va3VwKAogICAgICAgICAgICAgICAgUXVldWVJRCA9PiAkVGlja2V0LT57UXVldWVJRH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIEFydGljbGVTZW5kKCkgaXMgb25seSBwb3NzaWJsZSBmb3IgY2hhbm5lbCAnRW1haWwnLCBzbyBzZXQgaXQuCiAgICAgICAgaWYgKCAkQXJ0aWNsZS0+e0FydGljbGVTZW5kfSApIHsKICAgICAgICAgICAgJEFydGljbGUtPntDb21tdW5pY2F0aW9uQ2hhbm5lbH0gPSAnRW1haWwnOwogICAgICAgIH0KCiAgICAgICAgaWYgKCAhJEFydGljbGUtPntDb21tdW5pY2F0aW9uQ2hhbm5lbH0gKSB7CgogICAgICAgICAgICBteSAlQ29tbXVuaWNhdGlvbkNoYW5uZWwgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q29tbXVuaWNhdGlvbkNoYW5uZWwnKS0+Q2hhbm5lbEdldCgKICAgICAgICAgICAgICAgIENoYW5uZWxJRCA9PiAkQXJ0aWNsZS0+e0NvbW11bmljYXRpb25DaGFubmVsSUR9LAogICAgICAgICAgICApOwogICAgICAgICAgICAkQXJ0aWNsZS0+e0NvbW11bmljYXRpb25DaGFubmVsfSA9ICRDb21tdW5pY2F0aW9uQ2hhbm5lbHtDaGFubmVsTmFtZX07CiAgICAgICAgfQoKICAgICAgICBteSAkQXJ0aWNsZUJhY2tlbmRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGlja2V0OjpBcnRpY2xlJyktPkJhY2tlbmRGb3JDaGFubmVsKAogICAgICAgICAgICBDaGFubmVsTmFtZSA9PiAkQXJ0aWNsZS0+e0NvbW11bmljYXRpb25DaGFubmVsfSwKICAgICAgICApOwoKICAgICAgICBteSAkUGxhaW5Cb2R5ID0gJEFydGljbGUtPntCb2R5fTsKCiAgICAgICAgIyBDb252ZXJ0IGFydGljbGUgYm9keSB0byBwbGFpbiB0ZXh0LCBpZiBIVE1MIGNvbnRlbnQgd2FzIHN1cHBsaWVkLiBUaGlzIGlzIG5lY2Vzc2FyeSBzaW5jZSBhdXRvIHJlc3BvbnNlIGNvZGUKICAgICAgICAjICAgZXhwZWN0cyBwbGFpbiB0ZXh0IGNvbnRlbnQuIFBsZWFzZSBzZWUgYnVnIzEzMzk3IGZvciBtb3JlIGluZm9ybWF0aW9uLgogICAgICAgIGlmICgKICAgICAgICAgICAgKCAkQXJ0aWNsZS0+e0NvbnRlbnRUeXBlfSAmJiAkQXJ0aWNsZS0+e0NvbnRlbnRUeXBlfSA9fiAvdGV4dFwvaHRtbC9pICkKICAgICAgICAgICAgfHwgKCAkQXJ0aWNsZS0+e01pbWVUeXBlfSAmJiAkQXJ0aWNsZS0+e01pbWVUeXBlfSA9fiAvdGV4dFwvaHRtbC9pICkKICAgICAgICAgICAgKQogICAgICAgIHsKICAgICAgICAgICAgJFBsYWluQm9keSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpIVE1MVXRpbHMnKS0+VG9Bc2NpaSgKICAgICAgICAgICAgICAgIFN0cmluZyA9PiAkQXJ0aWNsZS0+e0JvZHl9LAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBDcmVhdGUgYXJ0aWNsZS4KICAgICAgICBteSAkU3ViamVjdCA9ICRBcnRpY2xlLT57U3ViamVjdH07CiAgICAgICAgaWYgKCAkQXJ0aWNsZS0+e0FydGljbGVTZW5kfSApIHsKCiAgICAgICAgICAgIG15ICRUaWNrZXROdW1iZXIgPSAkVGlja2V0T2JqZWN0LT5UaWNrZXROdW1iZXJMb29rdXAoCiAgICAgICAgICAgICAgICBUaWNrZXRJRCA9PiAkVGlja2V0SUQsCiAgICAgICAgICAgICAgICBVc2VySUQgICA9PiAkUGFyYW17VXNlcklEfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgQnVpbGQgYSBzdWJqZWN0CiAgICAgICAgICAgICRTdWJqZWN0ID0gJFRpY2tldE9iamVjdC0+VGlja2V0U3ViamVjdEJ1aWxkKAogICAgICAgICAgICAgICAgVGlja2V0TnVtYmVyID0+ICRUaWNrZXROdW1iZXIsCiAgICAgICAgICAgICAgICBTdWJqZWN0ICAgICAgPT4gJEFydGljbGUtPntTdWJqZWN0fSwKICAgICAgICAgICAgICAgIFR5cGUgICAgICAgICA9PiAnTmV3JywKICAgICAgICAgICAgICAgIEFjdGlvbiAgICAgICA9PiAnUmVwbHknLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKCAhJFN1YmplY3QgKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIFN1Y2Nlc3MgPT4gMCwKICAgICAgICAgICAgICAgICAgICBFcnJvck1lc3NhZ2UgPT4KICAgICAgICAgICAgICAgICAgICAgICAgJ1RoZSBzdWJqZWN0IGZvciB0aGUgZS1tYWlsIGNvdWxkIG5vdCBiZSBnZW5lcmF0ZWQuIFBsZWFzZSBjb250YWN0IHRoZSBzeXN0ZW0gYWRtaW5pc3RyYXRvcicKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG15ICRTaWduYXR1cmUgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGVtcGxhdGVHZW5lcmF0b3InKS0+U2lnbmF0dXJlKAogICAgICAgICAgICAgICAgVGlja2V0SUQgPT4gJFRpY2tldElELAogICAgICAgICAgICAgICAgVXNlcklEICAgPT4gJFBhcmFte1VzZXJJRH0sCiAgICAgICAgICAgICAgICBEYXRhICAgICA9PiAkQXJ0aWNsZSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGlmICgkU2lnbmF0dXJlKSB7CiAgICAgICAgICAgICAgICAkQXJ0aWNsZS0+e0JvZHl9ID0gJEFydGljbGUtPntCb2R5fSAuICRTaWduYXR1cmU7CgogICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICggJEFydGljbGUtPntDb250ZW50VHlwZX0gJiYgJEFydGljbGUtPntDb250ZW50VHlwZX0gPX4gL3RleHRcL2h0bWwvaSApCiAgICAgICAgICAgICAgICAgICAgfHwgKCAkQXJ0aWNsZS0+e01pbWVUeXBlfSAmJiAkQXJ0aWNsZS0+e01pbWVUeXBlfSA9fiAvdGV4dFwvaHRtbC9pICkKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJFBsYWluQm9keSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpIVE1MVXRpbHMnKS0+VG9Bc2NpaSgKICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nID0+ICRBcnRpY2xlLT57Qm9keX0sCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBCdWlsZCBDaGFyc2V0IGlmIG5lZWRlZCAoQXJ0aWNsZVNlbmQgZG9lc24ndCBhY2NlcHQgQ29udGVudFR5cGUpCiAgICAgICAgbXkgJENoYXJzZXQ7CiAgICAgICAgaWYgKAogICAgICAgICAgICAkQXJ0aWNsZS0+e0NvbnRlbnRUeXBlfQogICAgICAgICAgICAmJiAhJEFydGljbGUtPntDaGFyc2V0fQogICAgICAgICAgICAmJiAkQXJ0aWNsZS0+e0NvbnRlbnRUeXBlfSA9fiBte1xiY2hhcnNldD0oInwnfCkoW15ccyInO10rKX1pc20KICAgICAgICAgICAgKQogICAgICAgIHsKICAgICAgICAgICAgJENoYXJzZXQgPSAkMjsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRDaGFyc2V0ID0gJEFydGljbGUtPntDaGFyc2V0fTsKICAgICAgICB9CgogICAgICAgICMgQnVpbGQgTWltZVR5cGUgaWYgbmVlZGVkIChBcnRpY2xlU2VuZCBkb2Vzbid0IGFjY2VwdCBDb250ZW50VHlwZSkKICAgICAgICBteSAkTWltZVR5cGU7CiAgICAgICAgaWYgKAogICAgICAgICAgICAkQXJ0aWNsZS0+e0NvbnRlbnRUeXBlfQogICAgICAgICAgICAmJiAhJEFydGljbGUtPntNaW1lVHlwZX0KICAgICAgICAgICAgJiYgJEFydGljbGUtPntDb250ZW50VHlwZX0gPX4gbXtcQShbXjtdKyl9c20KICAgICAgICAgICAgKQogICAgICAgIHsKICAgICAgICAgICAgJE1pbWVUeXBlID0gJDE7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkTWltZVR5cGUgPSAkQXJ0aWNsZS0+e01pbWVUeXBlfTsKICAgICAgICB9CgogICAgICAgIG15ICVBcnRpY2xlUGFyYW1zID0gKAogICAgICAgICAgICBOb0FnZW50Tm90aWZ5ICAgICAgICA9PiAkQXJ0aWNsZS0+e05vQWdlbnROb3RpZnl9IHx8IDAsCiAgICAgICAgICAgIFRpY2tldElEICAgICAgICAgICAgID0+ICRUaWNrZXRJRCwKICAgICAgICAgICAgU2VuZGVyVHlwZUlEICAgICAgICAgPT4gJEFydGljbGUtPntTZW5kZXJUeXBlSUR9IHx8ICcnLAogICAgICAgICAgICBTZW5kZXJUeXBlICAgICAgICAgICA9PiAkQXJ0aWNsZS0+e1NlbmRlclR5cGV9IHx8ICcnLAogICAgICAgICAgICBJc1Zpc2libGVGb3JDdXN0b21lciA9PiAkQXJ0aWNsZS0+e0lzVmlzaWJsZUZvckN1c3RvbWVyfSwKICAgICAgICAgICAgRnJvbSAgICAgICAgICAgICAgICAgPT4gJEZyb20sCiAgICAgICAgICAgIFRvICAgICAgICAgICAgICAgICAgID0+ICRUbywKICAgICAgICAgICAgQ2MgICAgICAgICAgICAgICAgICAgPT4gJENjLAogICAgICAgICAgICBCY2MgICAgICAgICAgICAgICAgICA9PiAkQmNjLAogICAgICAgICAgICBTdWJqZWN0ICAgICAgICAgICAgICA9PiAkU3ViamVjdCwKICAgICAgICAgICAgQm9keSAgICAgICAgICAgICAgICAgPT4gJEFydGljbGUtPntCb2R5fSwKICAgICAgICAgICAgTWltZVR5cGUgICAgICAgICAgICAgPT4gJE1pbWVUeXBlIHx8ICcnLAogICAgICAgICAgICBDaGFyc2V0ICAgICAgICAgICAgICA9PiAkQ2hhcnNldCB8fCAnJywKICAgICAgICAgICAgQ29udGVudFR5cGUgICAgICAgICAgPT4gJEFydGljbGUtPntDb250ZW50VHlwZX0gfHwgJycsCiAgICAgICAgICAgIFVzZXJJRCAgICAgICAgICAgICAgID0+ICRQYXJhbXtVc2VySUR9LAogICAgICAgICAgICBIaXN0b3J5VHlwZSAgICAgICAgICA9PiAkQXJ0aWNsZS0+e0hpc3RvcnlUeXBlfSwKICAgICAgICAgICAgSGlzdG9yeUNvbW1lbnQgICAgICAgPT4gJEFydGljbGUtPntIaXN0b3J5Q29tbWVudH0gfHwgJyUlJywKICAgICAgICAgICAgQXV0b1Jlc3BvbnNlVHlwZSAgICAgPT4gJEFydGljbGUtPntBdXRvUmVzcG9uc2VUeXBlfSwKICAgICAgICAgICAgT3JpZ0hlYWRlciAgICAgICAgICAgPT4gewogICAgICAgICAgICAgICAgRnJvbSAgICA9PiAkRnJvbSwKICAgICAgICAgICAgICAgIFRvICAgICAgPT4gJFRvLAogICAgICAgICAgICAgICAgU3ViamVjdCA9PiAkU3ViamVjdCwKICAgICAgICAgICAgICAgIEJvZHkgICAgPT4gJFBsYWluQm9keSwKICAgICAgICAgICAgfSwKICAgICAgICApOwoKICAgICAgICAjIGNyZWF0ZSBhcnRpY2xlCiAgICAgICAgbXkgJEFydGljbGVJRDsKICAgICAgICBpZiAoICRBcnRpY2xlLT57QXJ0aWNsZVNlbmR9ICkgewoKICAgICAgICAgICAgIyBkZWNvZGUgYW5kIHNldCBhdHRhY2htZW50cwogICAgICAgICAgICBpZiAoIElzQXJyYXlSZWZXaXRoRGF0YSgkQXR0YWNobWVudExpc3QpICkgewoKICAgICAgICAgICAgICAgIG15IEBOZXdBdHRhY2htZW50czsKICAgICAgICAgICAgICAgIGZvciBteSAkQXR0YWNobWVudCAoIEB7JEF0dGFjaG1lbnRMaXN0fSApIHsKCiAgICAgICAgICAgICAgICAgICAgcHVzaCBATmV3QXR0YWNobWVudHMsIHsKICAgICAgICAgICAgICAgICAgICAgICAgJXskQXR0YWNobWVudH0sCiAgICAgICAgICAgICAgICAgICAgICAgIENvbnRlbnQgPT4gTUlNRTo6QmFzZTY0OjpkZWNvZGVfYmFzZTY0KCAkQXR0YWNobWVudC0+e0NvbnRlbnR9ICksCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRBcnRpY2xlUGFyYW1ze0F0dGFjaG1lbnR9ID0gXEBOZXdBdHRhY2htZW50czsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBzaWduaW5nIGFuZCBlbmNyeXB0aW9uCiAgICAgICAgICAgIGZvciBteSAkS2V5IChxdyggU2lnbiBDcnlwdCApKSB7CiAgICAgICAgICAgICAgICBpZiAoIElzSGFzaFJlZldpdGhEYXRhKCAkQXJ0aWNsZS0+eyRLZXl9ICkgKSB7CiAgICAgICAgICAgICAgICAgICAgJEFydGljbGVQYXJhbXN7JEtleX0gPSAkQXJ0aWNsZS0+eyRLZXl9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAkQXJ0aWNsZUlEID0gJEFydGljbGVCYWNrZW5kT2JqZWN0LT5BcnRpY2xlU2VuZCglQXJ0aWNsZVBhcmFtcyk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkQXJ0aWNsZUlEID0gJEFydGljbGVCYWNrZW5kT2JqZWN0LT5BcnRpY2xlQ3JlYXRlKCVBcnRpY2xlUGFyYW1zKTsKCiAgICAgICAgICAgICMgc2V0IGF0dGFjaG1lbnRzCiAgICAgICAgICAgIGlmICggSXNBcnJheVJlZldpdGhEYXRhKCRBdHRhY2htZW50TGlzdCkgKSB7CgogICAgICAgICAgICAgICAgZm9yIG15ICRBdHRhY2htZW50ICggQHskQXR0YWNobWVudExpc3R9ICkgewogICAgICAgICAgICAgICAgICAgIG15ICRSZXN1bHQgPSAkU2VsZi0+Q3JlYXRlQXR0YWNobWVudCgKICAgICAgICAgICAgICAgICAgICAgICAgVGlja2V0SUQgICA9PiAkVGlja2V0SUQsCiAgICAgICAgICAgICAgICAgICAgICAgIEF0dGFjaG1lbnQgPT4gJEF0dGFjaG1lbnQsCiAgICAgICAgICAgICAgICAgICAgICAgIEFydGljbGVJRCAgPT4gJEFydGljbGVJRCwKICAgICAgICAgICAgICAgICAgICAgICAgVXNlcklEICAgICA9PiAkUGFyYW17VXNlcklEfQogICAgICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgICAgIGlmICggISRSZXN1bHQtPntTdWNjZXNzfSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgbXkgJEVycm9yTWVzc2FnZSA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkUmVzdWx0LT57RXJyb3JNZXNzYWdlfSB8fCAiQXR0YWNobWVudCBjb3VsZCBub3QgYmUgY3JlYXRlZCwgcGxlYXNlIGNvbnRhY3QiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuICIgdGhlIHN5c3RlbSBhZG1pbmlzdHJhdG9yIjsKCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdWNjZXNzICAgICAgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVycm9yTWVzc2FnZSA9PiAkRXJyb3JNZXNzYWdlLAogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCAhJEFydGljbGVJRCApIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIFN1Y2Nlc3MgICAgICA9PiAwLAogICAgICAgICAgICAgICAgRXJyb3JNZXNzYWdlID0+ICdBcnRpY2xlIGNvdWxkIG5vdCBiZSBjcmVhdGVkLCBwbGVhc2UgY29udGFjdCB0aGUgc3lzdGVtIGFkbWluaXN0cmF0b3InLAogICAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgcHVzaCBAQXJ0aWNsZUlEcywgJEFydGljbGVJRDsKCiAgICAgICAgIyB0aW1lIGFjY291bnRpbmcKICAgICAgICBpZiAoICRBcnRpY2xlLT57VGltZVVuaXR9ICkgewogICAgICAgICAgICAkVGlja2V0T2JqZWN0LT5UaWNrZXRBY2NvdW50VGltZSgKICAgICAgICAgICAgICAgIFRpY2tldElEICA9PiAkVGlja2V0SUQsCiAgICAgICAgICAgICAgICBBcnRpY2xlSUQgPT4gJEFydGljbGVJRCwKICAgICAgICAgICAgICAgIFRpbWVVbml0ICA9PiAkQXJ0aWNsZS0+e1RpbWVVbml0fSwKICAgICAgICAgICAgICAgIFVzZXJJRCAgICA9PiAkUGFyYW17VXNlcklEfSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgc2V0IGR5bmFtaWMgZmllbGRzIChvbmx5IGZvciBvYmplY3QgdHlwZSAnYXJ0aWNsZScpCiAgICAgICAgaWYgKCBJc0FycmF5UmVmV2l0aERhdGEoJER5bmFtaWNGaWVsZExpc3QpICkgewoKICAgICAgICAgICAgRFlOQU1JQ0ZJRUxEOgogICAgICAgICAgICBmb3IgbXkgJER5bmFtaWNGaWVsZCAoIEB7JER5bmFtaWNGaWVsZExpc3R9ICkgewoKICAgICAgICAgICAgICAgIG15ICRJc0FydGljbGVEeW5hbWljRmllbGQgPSAkU2VsZi0+VmFsaWRhdGVEeW5hbWljRmllbGRPYmplY3RUeXBlKAogICAgICAgICAgICAgICAgICAgICV7JER5bmFtaWNGaWVsZH0sCiAgICAgICAgICAgICAgICAgICAgQXJ0aWNsZSA9PiAxLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIG5leHQgRFlOQU1JQ0ZJRUxEIGlmICEkSXNBcnRpY2xlRHluYW1pY0ZpZWxkOwoKICAgICAgICAgICAgICAgIG15ICRSZXN1bHQgPSAkU2VsZi0+U2V0RHluYW1pY0ZpZWxkVmFsdWUoCiAgICAgICAgICAgICAgICAgICAgJXskRHluYW1pY0ZpZWxkfSwKICAgICAgICAgICAgICAgICAgICBUaWNrZXRJRCAgPT4gJFRpY2tldElELAogICAgICAgICAgICAgICAgICAgIEFydGljbGVJRCA9PiAkQXJ0aWNsZUlELAogICAgICAgICAgICAgICAgICAgIFVzZXJJRCAgICA9PiAkUGFyYW17VXNlcklEfSwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgaWYgKCAhJFJlc3VsdC0+e1N1Y2Nlc3N9ICkgewogICAgICAgICAgICAgICAgICAgIG15ICRFcnJvck1lc3NhZ2UgPQogICAgICAgICAgICAgICAgICAgICAgICAkUmVzdWx0LT57RXJyb3JNZXNzYWdlfSB8fCAiRHluYW1pYyBGaWVsZCAkRHluYW1pY0ZpZWxkLT57TmFtZX0gY291bGQgbm90IGJlIgogICAgICAgICAgICAgICAgICAgICAgICAuICIgc2V0LCBwbGVhc2UgY29udGFjdCB0aGUgc3lzdGVtIGFkbWluaXN0cmF0b3IiOwoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICBTdWNjZXNzICAgICAgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgRXJyb3JNZXNzYWdlID0+ICRFcnJvck1lc3NhZ2UsCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAkQXJ0aWNsZUlETmV3ID0gXEBBcnRpY2xlSURzOwogICAgaWYgKCBzY2FsYXIgQEFydGljbGVJRHMgZXEgMSApIHsKICAgICAgICAkQXJ0aWNsZUlETmV3ID0gJEFydGljbGVJRE5ldy0+WzBdOwogICAgfQoKICAgICMgc2V0IG93bmVyIChpZiBvd25lciBvciBvd25lciBpZCBpcyBnaXZlbikKICAgIGlmICgkT3duZXJJRCkgewogICAgICAgICRUaWNrZXRPYmplY3QtPlRpY2tldE93bmVyU2V0KAogICAgICAgICAgICBUaWNrZXRJRCAgPT4gJFRpY2tldElELAogICAgICAgICAgICBOZXdVc2VySUQgPT4gJE93bmVySUQsCiAgICAgICAgICAgIFVzZXJJRCAgICA9PiAkUGFyYW17VXNlcklEfSwKICAgICAgICApOwoKICAgICAgICAjIHNldCBsb2NrIGlmIG5vIGxvY2sgd2FzIGRlZmluZWQKICAgICAgICBpZiAoICEkVGlja2V0LT57TG9ja30gJiYgISRUaWNrZXQtPntMb2NrSUR9ICkgewogICAgICAgICAgICAkVGlja2V0T2JqZWN0LT5UaWNrZXRMb2NrU2V0KAogICAgICAgICAgICAgICAgVGlja2V0SUQgPT4gJFRpY2tldElELAogICAgICAgICAgICAgICAgTG9jayAgICAgPT4gJ2xvY2snLAogICAgICAgICAgICAgICAgVXNlcklEICAgPT4gJFBhcmFte1VzZXJJRH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgICMgZWxzZSBzZXQgb3duZXIgdG8gY3VycmVudCBhZ2VudCBidXQgZG8gbm90IGxvY2sgaXQKICAgIGVsc2UgewogICAgICAgICRUaWNrZXRPYmplY3QtPlRpY2tldE93bmVyU2V0KAogICAgICAgICAgICBUaWNrZXRJRCAgICAgICAgICAgPT4gJFRpY2tldElELAogICAgICAgICAgICBOZXdVc2VySUQgICAgICAgICAgPT4gJFBhcmFte1VzZXJJRH0sCiAgICAgICAgICAgIFNlbmROb05vdGlmaWNhdGlvbiA9PiAxLAogICAgICAgICAgICBVc2VySUQgICAgICAgICAgICAgPT4gJFBhcmFte1VzZXJJRH0sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIHNldCByZXNwb25zaWJsZQogICAgaWYgKCRSZXNwb25zaWJsZUlEKSB7CiAgICAgICAgJFRpY2tldE9iamVjdC0+VGlja2V0UmVzcG9uc2libGVTZXQoCiAgICAgICAgICAgIFRpY2tldElEICA9PiAkVGlja2V0SUQsCiAgICAgICAgICAgIE5ld1VzZXJJRCA9PiAkUmVzcG9uc2libGVJRCwKICAgICAgICAgICAgVXNlcklEICAgID0+ICRQYXJhbXtVc2VySUR9LAogICAgICAgICk7CiAgICB9CgogICAgIyBnZXQgdGlja2V0IGRhdGEKICAgIG15ICVUaWNrZXREYXRhID0gJFRpY2tldE9iamVjdC0+VGlja2V0R2V0KAogICAgICAgIFRpY2tldElEICAgICAgPT4gJFRpY2tldElELAogICAgICAgIER5bmFtaWNGaWVsZHMgPT4gMSwKICAgICAgICBVc2VySUQgICAgICAgID0+ICRQYXJhbXtVc2VySUR9LAogICAgKTsKCiAgICBpZiAoICFJc0hhc2hSZWZXaXRoRGF0YSggXCVUaWNrZXREYXRhICkgKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgU3VjY2VzcyAgICAgID0+IDAsCiAgICAgICAgICAgIEVycm9yTWVzc2FnZSA9PiAnQ291bGQgbm90IGdldCBuZXcgdGlja2V0IGluZm9ybWF0aW9uLCBwbGVhc2UgY29udGFjdCB0aGUgc3lzdGVtJwogICAgICAgICAgICAgICAgLiAnIGFkbWluaXN0cmF0b3InLAogICAgICAgIH07CiAgICB9CgogICAgIyBnZXQgd2ViIHNlcnZpY2UgY29uZmlndXJhdGlvbgogICAgbXkgJFdlYnNlcnZpY2UgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6R2VuZXJpY0ludGVyZmFjZTo6V2Vic2VydmljZScpLT5XZWJzZXJ2aWNlR2V0KAogICAgICAgIElEID0+ICRTZWxmLT57V2Vic2VydmljZUlEfSwKICAgICk7CgogICAgbXkgJEluY2x1ZGVUaWNrZXREYXRhOwoKICAgICMgR2V0IG9wZXJhdGlvbiBjb25maWcsIGlmIG9wZXJhdGlvbiBuYW1lIHdhcyBzdXBwbGllZC4KICAgIGlmICggJFNlbGYtPntPcGVyYXRpb259ICkgewogICAgICAgIG15ICRPcGVyYXRpb25Db25maWcgPSAkV2Vic2VydmljZS0+e0NvbmZpZ30tPntQcm92aWRlcn0tPntPcGVyYXRpb259LT57ICRTZWxmLT57T3BlcmF0aW9ufSB9OwogICAgICAgICRJbmNsdWRlVGlja2V0RGF0YSA9ICRPcGVyYXRpb25Db25maWctPntJbmNsdWRlVGlja2V0RGF0YX07CiAgICB9CgogICAgaWYgKCAhJEluY2x1ZGVUaWNrZXREYXRhICkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIFN1Y2Nlc3MgPT4gMSwKICAgICAgICAgICAgRGF0YSAgICA9PiB7CiAgICAgICAgICAgICAgICBUaWNrZXRJRCAgICAgPT4gJFRpY2tldElELAogICAgICAgICAgICAgICAgVGlja2V0TnVtYmVyID0+ICRUaWNrZXREYXRhe1RpY2tldE51bWJlcn0sCiAgICAgICAgICAgICAgICBBcnRpY2xlSUQgICAgPT4gJEFydGljbGVJRE5ldywKICAgICAgICAgICAgfSwKICAgICAgICB9OwogICAgfQoKICAgICMgZXh0cmFjdCBhbGwgZHluYW1pYyBmaWVsZHMgZnJvbSBtYWluIHRpY2tldCBoYXNoLgogICAgbXkgJVRpY2tldER5bmFtaWNGaWVsZHM7CiAgICBUSUNLRVRBVFRSSUJVVEU6CiAgICBmb3IgbXkgJFRpY2tldEF0dHJpYnV0ZSAoIHNvcnQga2V5cyAlVGlja2V0RGF0YSApIHsKICAgICAgICBpZiAoICRUaWNrZXRBdHRyaWJ1dGUgPX4gbXtcQSBEeW5hbWljRmllbGRfKC4qKSBcen1tc3ggKSB7CiAgICAgICAgICAgICRUaWNrZXREeW5hbWljRmllbGRzeyQxfSA9IHsKICAgICAgICAgICAgICAgIE5hbWUgID0+ICQxLAogICAgICAgICAgICAgICAgVmFsdWUgPT4gJFRpY2tldERhdGF7JFRpY2tldEF0dHJpYnV0ZX0sCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGRlbGV0ZSAkVGlja2V0RGF0YXskVGlja2V0QXR0cmlidXRlfTsKICAgICAgICB9CiAgICB9CgogICAgIyBhZGQgZHluYW1pYyBmaWVsZHMgYXMgYXJyYXkgaW50byAnRHluYW1pY0ZpZWxkJyBoYXNoIGtleSBpZiBhbnkKICAgIGlmICglVGlja2V0RHluYW1pY0ZpZWxkcykgewogICAgICAgICRUaWNrZXREYXRhe0R5bmFtaWNGaWVsZH0gPSBbIHNvcnQgeyAkYS0+e05hbWV9IGNtcCAkYi0+e05hbWV9IH0gdmFsdWVzICVUaWNrZXREeW5hbWljRmllbGRzIF07CiAgICB9CgogICAgbXkgJEFydGljbGVPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGlja2V0OjpBcnRpY2xlJyk7CiAgICBmb3IgbXkgJEFydGljbGVJRCAoQEFydGljbGVJRHMpIHsKICAgICAgICBteSAkQXJ0aWNsZUJhY2tlbmRPYmplY3QgPSAkQXJ0aWNsZU9iamVjdC0+QmFja2VuZEZvckFydGljbGUoCiAgICAgICAgICAgIFRpY2tldElEICA9PiAkVGlja2V0SUQsCiAgICAgICAgICAgIEFydGljbGVJRCA9PiAkQXJ0aWNsZUlELAogICAgICAgICk7CgogICAgICAgICMgcHJlcGFyZSBUaWNrZXREYXRhIGFuZCBnZXQgQXJ0aWNsZQogICAgICAgIG15ICVBcnRpY2xlRGF0YSA9ICRBcnRpY2xlQmFja2VuZE9iamVjdC0+QXJ0aWNsZUdldCgKICAgICAgICAgICAgVGlja2V0SUQgICAgICA9PiAkVGlja2V0SUQsCiAgICAgICAgICAgIEFydGljbGVJRCAgICAgPT4gJEFydGljbGVJRCwKICAgICAgICAgICAgRHluYW1pY0ZpZWxkcyA9PiAxLAogICAgICAgICk7CgogICAgICAgICMgcHJlcGFyZSBBcnRpY2xlIER5bmFtaWNGaWVsZHMKICAgICAgICBteSBAQXJ0aWNsZUR5bmFtaWNGaWVsZHM7CgogICAgICAgICMgcmVtb3ZlIGFsbCBkeW5hbWljIGZpZWxkcyBmb3JtIG1haW4gdGlja2V0IGhhc2ggYW5kIHNldCB0aGVtIGludG8gYW4gYXJyYXkuCiAgICAgICAgQVJUSUNMRUFUVFJJQlVURToKICAgICAgICBmb3IgbXkgJEFydGljbGVBdHRyaWJ1dGUgKCBzb3J0IGtleXMgJUFydGljbGVEYXRhICkgewogICAgICAgICAgICBpZiAoICRBcnRpY2xlQXR0cmlidXRlID1+IG17XEEgRHluYW1pY0ZpZWxkXyguKikgXHp9bXN4ICkgewogICAgICAgICAgICAgICAgaWYgKCAhZXhpc3RzICRUaWNrZXREeW5hbWljRmllbGRzeyQxfSApIHsKICAgICAgICAgICAgICAgICAgICBwdXNoIEBBcnRpY2xlRHluYW1pY0ZpZWxkcywgewogICAgICAgICAgICAgICAgICAgICAgICBOYW1lICA9PiAkMSwKICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWUgPT4gJEFydGljbGVEYXRheyRBcnRpY2xlQXR0cmlidXRlfSwKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGRlbGV0ZSAkQXJ0aWNsZURhdGF7JEFydGljbGVBdHRyaWJ1dGV9OwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIGFkZCBkeW5hbWljIGZpZWxkcyBhcnJheSBpbnRvICdEeW5hbWljRmllbGQnIGhhc2gga2V5IGlmIGFueQogICAgICAgIGlmIChAQXJ0aWNsZUR5bmFtaWNGaWVsZHMpIHsKICAgICAgICAgICAgJEFydGljbGVEYXRhe0R5bmFtaWNGaWVsZH0gPSBcQEFydGljbGVEeW5hbWljRmllbGRzOwogICAgICAgIH0KCiAgICAgICAgIyBhZGQgYXR0YWNobWVudCBpZiB0aGUgcmVxdWVzdCBpbmNsdWRlcyBhdHRhY2htZW50cwogICAgICAgIGlmICggSXNBcnJheVJlZldpdGhEYXRhKCRBdHRhY2htZW50TGlzdCkgKSB7CiAgICAgICAgICAgIG15ICVBdHRhY2htZW50SW5kZXggPSAkQXJ0aWNsZUJhY2tlbmRPYmplY3QtPkFydGljbGVBdHRhY2htZW50SW5kZXgoCiAgICAgICAgICAgICAgICBBcnRpY2xlSUQgPT4gJEFydGljbGVJRCwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIG15IEBBdHRhY2htZW50czsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06Ok1haW4nKS0+UmVxdWlyZSgnTUlNRTo6QmFzZTY0Jyk7CiAgICAgICAgICAgIEFUVEFDSE1FTlQ6CiAgICAgICAgICAgIGZvciBteSAkRmlsZUlEICggc29ydCBrZXlzICVBdHRhY2htZW50SW5kZXggKSB7CiAgICAgICAgICAgICAgICBuZXh0IEFUVEFDSE1FTlQgaWYgISRGaWxlSUQ7CiAgICAgICAgICAgICAgICBteSAlQXR0YWNobWVudCA9ICRBcnRpY2xlQmFja2VuZE9iamVjdC0+QXJ0aWNsZUF0dGFjaG1lbnQoCiAgICAgICAgICAgICAgICAgICAgQXJ0aWNsZUlEID0+ICRBcnRpY2xlSUQsCiAgICAgICAgICAgICAgICAgICAgRmlsZUlEICAgID0+ICRGaWxlSUQsCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgIG5leHQgQVRUQUNITUVOVCBpZiAhSXNIYXNoUmVmV2l0aERhdGEoIFwlQXR0YWNobWVudCApOwoKICAgICAgICAgICAgICAgICMgY29udmVydCBjb250ZW50IHRvIGJhc2U2NCwgYnV0IHByZXZlbnQgNzYgY2hhcnMgYnJha2UsIHNlZSBidWcjMTQ1MDAuCiAgICAgICAgICAgICAgICAkQXR0YWNobWVudHtDb250ZW50fSA9IE1JTUU6OkJhc2U2NDo6ZW5jb2RlX2Jhc2U2NCggJEF0dGFjaG1lbnR7Q29udGVudH0sICcnICk7CiAgICAgICAgICAgICAgICBwdXNoIEBBdHRhY2htZW50cywgeyVBdHRhY2htZW50fTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBzZXQgQXR0YWNobWVudHMgZGF0YQogICAgICAgICAgICBpZiAoQEF0dGFjaG1lbnRzKSB7CiAgICAgICAgICAgICAgICAkQXJ0aWNsZURhdGF7QXR0YWNobWVudH0gPSBcQEF0dGFjaG1lbnRzOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwdXNoIEB7ICRUaWNrZXREYXRhe0FydGljbGV9IH0sIFwlQXJ0aWNsZURhdGE7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgICBTdWNjZXNzID0+IDEsCiAgICAgICAgRGF0YSAgICA9PiB7CiAgICAgICAgICAgIFRpY2tldElEICAgICA9PiAkVGlja2V0SUQsCiAgICAgICAgICAgIFRpY2tldE51bWJlciA9PiAkVGlja2V0RGF0YXtUaWNrZXROdW1iZXJ9LAogICAgICAgICAgICBBcnRpY2xlSUQgICAgPT4gJEFydGljbGVJRE5ldywKICAgICAgICAgICAgVGlja2V0ICAgICAgID0+IFwlVGlja2V0RGF0YSwKICAgICAgICB9LAogICAgfTsKfQoKMTsKCj1lbmQgSW50ZXJuYWw6Cgo9aGVhZDEgVEVSTVMgQU5EIENPTkRJVElPTlMKClRoaXMgc29mdHdhcmUgaXMgcGFydCBvZiB0aGUgT1RSUyBwcm9qZWN0IChMPGh0dHBzOi8vb3Rycy5vcmcvPikuCgpUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQp0aGUgZW5jbG9zZWQgZmlsZSBDT1BZSU5HIGZvciBsaWNlbnNlIGluZm9ybWF0aW9uIChHUEwpLiBJZiB5b3UKZGlkIG5vdCByZWNlaXZlIHRoaXMgZmlsZSwgc2VlIEw8aHR0cHM6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9ncGwtMy4wLnR4dD4uCgo9Y3V0Cg==</File>
        <File Location="Custom/Kernel/Modules/AdminCustomerCompany.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxLTIwMjIgWm51bnkgR21iSCwgaHR0cHM6Ly96bnVueS5vcmcvCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6TW9kdWxlczo6QWRtaW5DdXN0b21lckNvbXBhbnk7Cgp1c2Ugc3RyaWN0Owp1c2Ugd2FybmluZ3M7Cgp1c2UgS2VybmVsOjpMYW5ndWFnZSBxdyhUcmFuc2xhdGFibGUpOwoKb3VyICRPYmplY3RNYW5hZ2VyRGlzYWJsZWQgPSAxOwoKdXNlIEtlcm5lbDo6U3lzdGVtOjpWYXJpYWJsZUNoZWNrIHF3KDphbGwpOwoKc3ViIG5ldyB7CiAgICBteSAoICRUeXBlLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgYWxsb2NhdGUgbmV3IGhhc2ggZm9yIG9iamVjdAogICAgbXkgJFNlbGYgPSB7JVBhcmFtfTsKICAgIGJsZXNzKCAkU2VsZiwgJFR5cGUgKTsKCiAgICBteSAkRHluYW1pY0ZpZWxkQ29uZmlncyA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEeW5hbWljRmllbGQnKS0+RHluYW1pY0ZpZWxkTGlzdEdldCgKICAgICAgICBPYmplY3RUeXBlID0+ICdDdXN0b21lckNvbXBhbnknLAogICAgKTsKCiAgICAkU2VsZi0+e0R5bmFtaWNGaWVsZExvb2t1cH0gPSB7IG1hcCB7ICRfLT57TmFtZX0gPT4gJF8gfSBAeyREeW5hbWljRmllbGRDb25maWdzfSB9OwoKICAgIHJldHVybiAkU2VsZjsKfQoKc3ViIFJ1biB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRQYXJhbU9iamVjdCAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6V2ViOjpSZXF1ZXN0Jyk7CiAgICBteSAkQ29uZmlnT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKTsKCiAgICBteSAkTmF2ICAgICAgICAgICAgICAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnTmF2JyApIHx8IDA7CiAgICBteSAkTmF2aWdhdGlvbkJhclR5cGUgPSAkTmF2IGVxICdBZ2VudCcgPyAnQ3VzdG9tZXJzJyA6ICdBZG1pbic7CiAgICBteSAkU2VhcmNoICAgICAgICAgICAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnU2VhcmNoJyApOwogICAgJFNlYXJjaAogICAgICAgIHx8PSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0FkbWluQ3VzdG9tZXJDb21wYW55OjpSdW5Jbml0aWFsV2lsZGNhcmRTZWFyY2gnKSA/ICcqJyA6ICcnOwogICAgbXkgJExheW91dE9iamVjdCAgICAgICAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKICAgIG15ICRDdXN0b21lckNvbXBhbnlPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q3VzdG9tZXJDb21wYW55Jyk7CgogICAgbXkgJUdldFBhcmFtOwogICAgJEdldFBhcmFte1NvdXJjZX0gPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnU291cmNlJyApIHx8ICdDdXN0b21lckNvbXBhbnknOwoKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgICMgY2hhbmdlCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICBpZiAoICRTZWxmLT57U3ViYWN0aW9ufSBlcSAnQ2hhbmdlJyApIHsKICAgICAgICBteSAkQ3VzdG9tZXJJRAogICAgICAgICAgICA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdDdXN0b21lcklEJyApIHx8ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdJRCcgKSB8fCAnJzsKICAgICAgICBteSAkTm90aWZpY2F0aW9uID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ05vdGlmaWNhdGlvbicgKSB8fCAnJzsKICAgICAgICBteSAlRGF0YSAgICAgICAgID0gJEN1c3RvbWVyQ29tcGFueU9iamVjdC0+Q3VzdG9tZXJDb21wYW55R2V0KAogICAgICAgICAgICBDdXN0b21lcklEID0+ICRDdXN0b21lcklELAogICAgICAgICk7CiAgICAgICAgJERhdGF7Q3VzdG9tZXJDb21wYW55SUR9ID0gJEN1c3RvbWVySUQ7CiAgICAgICAgbXkgJE91dHB1dCA9ICRMYXlvdXRPYmplY3QtPkhlYWRlcigpOwogICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+TmF2aWdhdGlvbkJhcigKICAgICAgICAgICAgVHlwZSA9PiAkTmF2aWdhdGlvbkJhclR5cGUsCiAgICAgICAgKTsKICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk5vdGlmeSggSW5mbyA9PiBUcmFuc2xhdGFibGUoJ0N1c3RvbWVyIGNvbXBhbnkgdXBkYXRlZCEnKSApCiAgICAgICAgICAgIGlmICggJE5vdGlmaWNhdGlvbiAmJiAkTm90aWZpY2F0aW9uIGVxICdVcGRhdGUnICk7CiAgICAgICAgJFNlbGYtPl9FZGl0KAogICAgICAgICAgICBBY3Rpb24gPT4gJ0NoYW5nZScsCiAgICAgICAgICAgIE5hdiAgICA9PiAkTmF2LAogICAgICAgICAgICAlRGF0YSwKICAgICAgICApOwogICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+T3V0cHV0KAogICAgICAgICAgICBUZW1wbGF0ZUZpbGUgPT4gJ0FkbWluQ3VzdG9tZXJDb21wYW55JywKICAgICAgICAgICAgRGF0YSAgICAgICAgID0+IFwlUGFyYW0sCiAgICAgICAgKTsKICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPkZvb3RlcigpOwogICAgICAgIHJldHVybiAkT3V0cHV0OwogICAgfQoKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgICMgY2hhbmdlIGFjdGlvbgogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gIwogICAgZWxzaWYgKCAkU2VsZi0+e1N1YmFjdGlvbn0gZXEgJ0NoYW5nZUFjdGlvbicgKSB7CgogICAgICAgICMgY2hhbGxlbmdlIHRva2VuIGNoZWNrIGZvciB3cml0ZSBhY3Rpb24KICAgICAgICAkTGF5b3V0T2JqZWN0LT5DaGFsbGVuZ2VUb2tlbkNoZWNrKCk7CgogICAgICAgIG15ICROb3RlID0gJyc7CiAgICAgICAgbXkgJUVycm9yczsKICAgICAgICAkR2V0UGFyYW17Q3VzdG9tZXJDb21wYW55SUR9ID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0N1c3RvbWVyQ29tcGFueUlEJyApOwoKICAgICAgICAjIEdldCBkeW5hbWljIGZpZWxkIGJhY2tlbmQgb2JqZWN0LgogICAgICAgIG15ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkR5bmFtaWNGaWVsZDo6QmFja2VuZCcpOwoKICAgICAgICBFTlRSWToKICAgICAgICBmb3IgbXkgJEVudHJ5ICggQHsgJENvbmZpZ09iamVjdC0+R2V0KCAkR2V0UGFyYW17U291cmNlfSApLT57TWFwfSB9ICkgewoKICAgICAgICAgICAgIyBjaGVjayBkeW5hbWljIGZpZWxkcwogICAgICAgICAgICBpZiAoICRFbnRyeS0+WzVdIGVxICdkeW5hbWljX2ZpZWxkJyApIHsKCiAgICAgICAgICAgICAgICBteSAkRHluYW1pY0ZpZWxkQ29uZmlnID0gJFNlbGYtPntEeW5hbWljRmllbGRMb29rdXB9LT57ICRFbnRyeS0+WzJdIH07CgogICAgICAgICAgICAgICAgaWYgKCAhSXNIYXNoUmVmV2l0aERhdGEoJER5bmFtaWNGaWVsZENvbmZpZykgKSB7CiAgICAgICAgICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJEeW5hbWljRmllbGQgJEVudHJ5LT5bMl0gbm90IGZvdW5kISIsCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICBuZXh0IEVOVFJZOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG15ICRWYWxpZGF0aW9uUmVzdWx0ID0gJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QtPkVkaXRGaWVsZFZhbHVlVmFsaWRhdGUoCiAgICAgICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRDb25maWcsCiAgICAgICAgICAgICAgICAgICAgUGFyYW1PYmplY3QgICAgICAgID0+ICRQYXJhbU9iamVjdCwKICAgICAgICAgICAgICAgICAgICBNYW5kYXRvcnkgICAgICAgICAgPT4gJEVudHJ5LT5bNF0sCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgIGlmICggJFZhbGlkYXRpb25SZXN1bHQtPntTZXJ2ZXJFcnJvcn0gKSB7CiAgICAgICAgICAgICAgICAgICAgJEVycm9yc3sgJEVudHJ5LT5bMF0gfSA9ICRWYWxpZGF0aW9uUmVzdWx0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CgogICAgICAgICAgICAgICAgICAgICMgZ2VuZXJhdGUgc3RvcmFibGUgdmFsdWUgb2YgZHluYW1pYyBmaWVsZCBlZGl0IGZpZWxkCiAgICAgICAgICAgICAgICAgICAgJEdldFBhcmFteyAkRW50cnktPlswXSB9ID0gJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QtPkVkaXRGaWVsZFZhbHVlR2V0KAogICAgICAgICAgICAgICAgICAgICAgICBEeW5hbWljRmllbGRDb25maWcgPT4gJER5bmFtaWNGaWVsZENvbmZpZywKICAgICAgICAgICAgICAgICAgICAgICAgUGFyYW1PYmplY3QgICAgICAgID0+ICRQYXJhbU9iamVjdCwKICAgICAgICAgICAgICAgICAgICAgICAgTGF5b3V0T2JqZWN0ICAgICAgID0+ICRMYXlvdXRPYmplY3QsCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBjaGVjayByZW1haW5pbmcgbm9uLWR5bmFtaWMtZmllbGQgbWFuZGF0b3J5IGZpZWxkcwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRHZXRQYXJhbXsgJEVudHJ5LT5bMF0gfSA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICRFbnRyeS0+WzBdICkgLy8gJyc7CiAgICAgICAgICAgICAgICBpZiAoICEkR2V0UGFyYW17ICRFbnRyeS0+WzBdIH0gJiYgJEVudHJ5LT5bNF0gKSB7CiAgICAgICAgICAgICAgICAgICAgJEVycm9yc3sgJEVudHJ5LT5bMF0gLiAnSW52YWxpZCcgfSA9ICdTZXJ2ZXJFcnJvcic7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICggIWRlZmluZWQgJEdldFBhcmFte0N1c3RvbWVySUR9ICkgewogICAgICAgICAgICAkR2V0UGFyYW17Q3VzdG9tZXJJRH0gPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQ3VzdG9tZXJJRCcgKSB8fCAnJzsKICAgICAgICB9CgogICAgICAgICMgY2hlY2sgZm9yIGR1cGxpY2F0ZSBlbnRyaWVzCiAgICAgICAgaWYgKCAkR2V0UGFyYW17Q3VzdG9tZXJDb21wYW55SUR9IG5lICRHZXRQYXJhbXtDdXN0b21lcklEfSApIHsKCiAgICAgICAgICAgICMgZ2V0IEN1c3RvbWVyQ29tcGFueSBsaXN0CiAgICAgICAgICAgIG15ICVMaXN0ID0gJEN1c3RvbWVyQ29tcGFueU9iamVjdC0+Q3VzdG9tZXJDb21wYW55TGlzdCgKICAgICAgICAgICAgICAgIFNlYXJjaCA9PiAkUGFyYW17U2VhcmNofSwKICAgICAgICAgICAgICAgIFZhbGlkICA9PiAwLAogICAgICAgICAgICAgICAgVXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgY2hlY2sgZHVwbGljYXRlIGZpZWxkCiAgICAgICAgICAgIGlmICggJUxpc3QgJiYgJExpc3R7ICRHZXRQYXJhbXtDdXN0b21lcklEfSB9ICkgewogICAgICAgICAgICAgICAgJEVycm9yc3tEdXBsaWNhdGV9ID0gJ1NlcnZlckVycm9yJzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBpZiBubyBlcnJvcnMgb2NjdXJyZWQKICAgICAgICBpZiAoICElRXJyb3JzICkgewoKICAgICAgICAgICAgIyB1cGRhdGUgZ3JvdXAKICAgICAgICAgICAgbXkgJFVwZGF0ZSA9ICRDdXN0b21lckNvbXBhbnlPYmplY3QtPkN1c3RvbWVyQ29tcGFueVVwZGF0ZSggJUdldFBhcmFtLCBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9ICk7CgogICAgICAgICAgICBpZiAoJFVwZGF0ZSkgewoKICAgICAgICAgICAgICAgIG15ICRTZXRERkVycm9yOwoKICAgICAgICAgICAgICAgICMgc2V0IGR5bmFtaWMgZmllbGQgdmFsdWVzCiAgICAgICAgICAgICAgICBteSAkRHluYW1pY0ZpZWxkT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkR5bmFtaWNGaWVsZCcpOwoKICAgICAgICAgICAgICAgIEVOVFJZOgogICAgICAgICAgICAgICAgZm9yIG15ICRFbnRyeSAoIEB7ICRDb25maWdPYmplY3QtPkdldCggJEdldFBhcmFte1NvdXJjZX0gKS0+e01hcH0gfSApIHsKICAgICAgICAgICAgICAgICAgICBuZXh0IEVOVFJZIGlmICRFbnRyeS0+WzVdIG5lICdkeW5hbWljX2ZpZWxkJzsKCiAgICAgICAgICAgICAgICAgICAgbXkgJER5bmFtaWNGaWVsZENvbmZpZyA9ICRTZWxmLT57RHluYW1pY0ZpZWxkTG9va3VwfS0+eyAkRW50cnktPlsyXSB9OwoKICAgICAgICAgICAgICAgICAgICBpZiAoICFJc0hhc2hSZWZXaXRoRGF0YSgkRHluYW1pY0ZpZWxkQ29uZmlnKSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFNldERGRXJyb3IgLj0gJExheW91dE9iamVjdC0+Tm90aWZ5KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgSW5mbyA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0R5bmFtaWMgZmllbGQgJXMgbm90IGZvdW5kIScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEVudHJ5LT5bMl0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIG5leHQgRU5UUlk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBteSAkVmFsdWVTZXQgPSAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdC0+VmFsdWVTZXQoCiAgICAgICAgICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZENvbmZpZyA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnLAogICAgICAgICAgICAgICAgICAgICAgICBPYmplY3ROYW1lICAgICAgICAgPT4gJEdldFBhcmFte0N1c3RvbWVySUR9LAogICAgICAgICAgICAgICAgICAgICAgICBWYWx1ZSAgICAgICAgICAgICAgPT4gJEdldFBhcmFteyAkRW50cnktPlswXSB9LAogICAgICAgICAgICAgICAgICAgICAgICBVc2VySUQgICAgICAgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgICAgIGlmICggISRWYWx1ZVNldCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFNldERGRXJyb3IKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC49ICRMYXlvdXRPYmplY3QtPk5vdGlmeSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEluZm8gPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdVbmFibGUgdG8gc2V0IHZhbHVlIGZvciBkeW5hbWljIGZpZWxkICVzIScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEVudHJ5LT5bMl0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgbmV4dCBFTlRSWTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbXkgJENvbnRpbnVlQWZ0ZXJTYXZlID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0NvbnRpbnVlQWZ0ZXJTYXZlJyApIHx8IDA7CgogICAgICAgICAgICAgICAgIyBpZiBzZXQgREYgZXJyb3IgZXhpc3RzLCBjcmVhdGUgbm90aWZpY2F0aW9uCiAgICAgICAgICAgICAgICBpZiAoJFNldERGRXJyb3IpIHsKCiAgICAgICAgICAgICAgICAgICAgIyBpZiB0aGUgdXNlciB3b3VsZCBsaWtlIHRvIGNvbnRpbnVlIGVkaXRpbmcgdGhlIGN1c3RvbWVyIGNvbXBhbnksIGp1c3QgcmVkaXJlY3QgdG8gdGhlIGVkaXQgc2NyZWVuCiAgICAgICAgICAgICAgICAgICAgaWYgKCAkQ29udGludWVBZnRlclNhdmUgZXEgJzEnICkgewogICAgICAgICAgICAgICAgICAgICAgICAkU2VsZi0+X0VkaXQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBY3Rpb24gPT4gJ0NoYW5nZScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOYXYgICAgPT4gJE5hdiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVycm9ycyA9PiBcJUVycm9ycywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRTZWxmLT5fT3ZlcnZpZXcoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOYXYgICAgPT4gJE5hdiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlYXJjaCA9PiAkU2VhcmNoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJUdldFBhcmFtLAogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBteSAkT3V0cHV0ID0gJExheW91dE9iamVjdC0+SGVhZGVyKCk7CiAgICAgICAgICAgICAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5OYXZpZ2F0aW9uQmFyKAogICAgICAgICAgICAgICAgICAgICAgICBUeXBlID0+ICROYXZpZ2F0aW9uQmFyVHlwZSwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Tm90aWZ5KCBJbmZvID0+IFRyYW5zbGF0YWJsZSgnQ3VzdG9tZXIgY29tcGFueSB1cGRhdGVkIScpICk7CiAgICAgICAgICAgICAgICAgICAgJE91dHB1dCAuPSAkU2V0REZFcnJvcjsKICAgICAgICAgICAgICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk91dHB1dCgKICAgICAgICAgICAgICAgICAgICAgICAgVGVtcGxhdGVGaWxlID0+ICdBZG1pbkN1c3RvbWVyQ29tcGFueScsCiAgICAgICAgICAgICAgICAgICAgICAgIERhdGEgICAgICAgICA9PiBcJVBhcmFtLAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5Gb290ZXIoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJE91dHB1dDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIGlmIHRoZSB1c2VyIHdvdWxkIGxpa2UgdG8gY29udGludWUgZWRpdGluZyB0aGUgY3VzdG9tZXIgY29tcGFueSwganVzdCByZWRpcmVjdCB0byB0aGUgZWRpdCBzY3JlZW4KICAgICAgICAgICAgICAgIGlmICggJENvbnRpbnVlQWZ0ZXJTYXZlIGVxICcxJyApIHsKICAgICAgICAgICAgICAgICAgICBteSAkQ3VzdG9tZXJJRCA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdDdXN0b21lcklEJyApIHx8ICcnOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5SZWRpcmVjdCgKICAgICAgICAgICAgICAgICAgICAgICAgT1AgPT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJBY3Rpb249JFNlbGYtPntBY3Rpb259O1N1YmFjdGlvbj1DaGFuZ2U7Q3VzdG9tZXJJRD0kQ3VzdG9tZXJJRDtOYXY9JE5hdjtOb3RpZmljYXRpb249VXBkYXRlIgogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKCiAgICAgICAgICAgICAgICAgICAgIyBvdGhlcndpc2UgcmV0dXJuIHRvIG92ZXJ2aWV3CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPlJlZGlyZWN0KCBPUCA9PiAiQWN0aW9uPSRTZWxmLT57QWN0aW9ufTtOb3RpZmljYXRpb249VXBkYXRlIiApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIHNvbWV0aGluZyB3ZW50IHdyb25nCiAgICAgICAgbXkgJE91dHB1dCA9ICRMYXlvdXRPYmplY3QtPkhlYWRlcigpOwogICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+TmF2aWdhdGlvbkJhcigKICAgICAgICAgICAgVHlwZSA9PiAkTmF2aWdhdGlvbkJhclR5cGUsCiAgICAgICAgKTsKCiAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5Ob3RpZnkoIFByaW9yaXR5ID0+ICdFcnJvcicgKTsKCiAgICAgICAgIyBzZXQgbm90aWZpY2F0aW9uIGZvciBkdXBsaWNhdGUgZW50cnkKICAgICAgICBpZiAoICRFcnJvcnN7RHVwbGljYXRlfSApIHsKICAgICAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5Ob3RpZnkoCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnRXJyb3InLAogICAgICAgICAgICAgICAgSW5mbyAgICAgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKAogICAgICAgICAgICAgICAgICAgICdDdXN0b21lciBDb21wYW55ICVzIGFscmVhZHkgZXhpc3RzIScsCiAgICAgICAgICAgICAgICAgICAgJEdldFBhcmFte0N1c3RvbWVySUR9LAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICRTZWxmLT5fRWRpdCgKICAgICAgICAgICAgQWN0aW9uID0+ICdDaGFuZ2UnLAogICAgICAgICAgICBOYXYgICAgPT4gJE5hdiwKICAgICAgICAgICAgRXJyb3JzID0+IFwlRXJyb3JzLAogICAgICAgICAgICAlR2V0UGFyYW0sCiAgICAgICAgKTsKICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk91dHB1dCgKICAgICAgICAgICAgVGVtcGxhdGVGaWxlID0+ICdBZG1pbkN1c3RvbWVyQ29tcGFueScsCiAgICAgICAgICAgIERhdGEgICAgICAgICA9PiBcJVBhcmFtLAogICAgICAgICk7CiAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5Gb290ZXIoKTsKICAgICAgICByZXR1cm4gJE91dHB1dDsKICAgIH0KCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICAjIGFkZAogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gIwogICAgZWxzaWYgKCAkU2VsZi0+e1N1YmFjdGlvbn0gZXEgJ0FkZCcgKSB7CiAgICAgICAgJEdldFBhcmFte05hbWV9ID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ05hbWUnICk7CiAgICAgICAgbXkgJE91dHB1dCA9ICRMYXlvdXRPYmplY3QtPkhlYWRlcigpOwogICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+TmF2aWdhdGlvbkJhcigKICAgICAgICAgICAgVHlwZSA9PiAkTmF2aWdhdGlvbkJhclR5cGUsCiAgICAgICAgKTsKICAgICAgICAkU2VsZi0+X0VkaXQoCiAgICAgICAgICAgIEFjdGlvbiA9PiAnQWRkJywKICAgICAgICAgICAgTmF2ICAgID0+ICROYXYsCiAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICApOwogICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+T3V0cHV0KAogICAgICAgICAgICBUZW1wbGF0ZUZpbGUgPT4gJ0FkbWluQ3VzdG9tZXJDb21wYW55JywKICAgICAgICAgICAgRGF0YSAgICAgICAgID0+IFwlUGFyYW0sCiAgICAgICAgKTsKICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPkZvb3RlcigpOwogICAgICAgIHJldHVybiAkT3V0cHV0OwogICAgfQoKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgICMgYWRkIGFjdGlvbgogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gIwogICAgZWxzaWYgKCAkU2VsZi0+e1N1YmFjdGlvbn0gZXEgJ0FkZEFjdGlvbicgKSB7CgogICAgICAgICMgY2hhbGxlbmdlIHRva2VuIGNoZWNrIGZvciB3cml0ZSBhY3Rpb24KICAgICAgICAkTGF5b3V0T2JqZWN0LT5DaGFsbGVuZ2VUb2tlbkNoZWNrKCk7CgogICAgICAgIG15ICROb3RlID0gJyc7CiAgICAgICAgbXkgJUVycm9yczsKCiAgICAgICAgbXkgJEN1c3RvbWVyQ29tcGFueUtleSA9ICRDb25maWdPYmplY3QtPkdldCggJEdldFBhcmFte1NvdXJjZX0gKS0+e0N1c3RvbWVyQ29tcGFueUtleX07CiAgICAgICAgbXkgJEN1c3RvbWVyQ29tcGFueUlEOwoKICAgICAgICAjIEdldCBkeW5hbWljIGZpZWxkIGJhY2tlbmQgb2JqZWN0LgogICAgICAgIG15ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkR5bmFtaWNGaWVsZDo6QmFja2VuZCcpOwoKICAgICAgICBFTlRSWToKICAgICAgICBmb3IgbXkgJEVudHJ5ICggQHsgJENvbmZpZ09iamVjdC0+R2V0KCAkR2V0UGFyYW17U291cmNlfSApLT57TWFwfSB9ICkgewoKICAgICAgICAgICAgIyBjaGVjayBkeW5hbWljIGZpZWxkcwogICAgICAgICAgICBpZiAoICRFbnRyeS0+WzVdIGVxICdkeW5hbWljX2ZpZWxkJyApIHsKCiAgICAgICAgICAgICAgICBteSAkRHluYW1pY0ZpZWxkQ29uZmlnID0gJFNlbGYtPntEeW5hbWljRmllbGRMb29rdXB9LT57ICRFbnRyeS0+WzJdIH07CgogICAgICAgICAgICAgICAgaWYgKCAhSXNIYXNoUmVmV2l0aERhdGEoJER5bmFtaWNGaWVsZENvbmZpZykgKSB7CiAgICAgICAgICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJEeW5hbWljRmllbGQgJEVudHJ5LT5bMl0gbm90IGZvdW5kISIsCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICBuZXh0IEVOVFJZOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG15ICRWYWxpZGF0aW9uUmVzdWx0ID0gJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QtPkVkaXRGaWVsZFZhbHVlVmFsaWRhdGUoCiAgICAgICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRDb25maWcsCiAgICAgICAgICAgICAgICAgICAgUGFyYW1PYmplY3QgICAgICAgID0+ICRQYXJhbU9iamVjdCwKICAgICAgICAgICAgICAgICAgICBNYW5kYXRvcnkgICAgICAgICAgPT4gJEVudHJ5LT5bNF0sCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgIGlmICggJFZhbGlkYXRpb25SZXN1bHQtPntTZXJ2ZXJFcnJvcn0gKSB7CiAgICAgICAgICAgICAgICAgICAgJEVycm9yc3sgJEVudHJ5LT5bMF0gfSA9ICRWYWxpZGF0aW9uUmVzdWx0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CgogICAgICAgICAgICAgICAgICAgICMgZ2VuZXJhdGUgc3RvcmFibGUgdmFsdWUgb2YgZHluYW1pYyBmaWVsZCBlZGl0IGZpZWxkCiAgICAgICAgICAgICAgICAgICAgJEdldFBhcmFteyAkRW50cnktPlswXSB9ID0gJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QtPkVkaXRGaWVsZFZhbHVlR2V0KAogICAgICAgICAgICAgICAgICAgICAgICBEeW5hbWljRmllbGRDb25maWcgPT4gJER5bmFtaWNGaWVsZENvbmZpZywKICAgICAgICAgICAgICAgICAgICAgICAgUGFyYW1PYmplY3QgICAgICAgID0+ICRQYXJhbU9iamVjdCwKICAgICAgICAgICAgICAgICAgICAgICAgTGF5b3V0T2JqZWN0ICAgICAgID0+ICRMYXlvdXRPYmplY3QsCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBjaGVjayByZW1haW5pbmcgbm9uLWR5bmFtaWMtZmllbGQgbWFuZGF0b3J5IGZpZWxkcwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRHZXRQYXJhbXsgJEVudHJ5LT5bMF0gfSA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICRFbnRyeS0+WzBdICkgLy8gJyc7CiAgICAgICAgICAgICAgICBpZiAoICEkR2V0UGFyYW17ICRFbnRyeS0+WzBdIH0gJiYgJEVudHJ5LT5bNF0gKSB7CiAgICAgICAgICAgICAgICAgICAgJEVycm9yc3sgJEVudHJ5LT5bMF0gLiAnSW52YWxpZCcgfSA9ICdTZXJ2ZXJFcnJvcic7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgc2F2ZSBjdXN0b21lciBjb21wYW55IGtleSBmb3IgY2hlY2tpbmcgZHVwbGljYXRlCiAgICAgICAgICAgIGlmICggJEVudHJ5LT5bMl0gZXEgJEN1c3RvbWVyQ29tcGFueUtleSApIHsKICAgICAgICAgICAgICAgICRDdXN0b21lckNvbXBhbnlJRCA9ICRHZXRQYXJhbXsgJEVudHJ5LT5bMF0gfTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBnZXQgQ3VzdG9tZXJDb21wYW55IGxpc3QKICAgICAgICBteSAlTGlzdCA9ICRDdXN0b21lckNvbXBhbnlPYmplY3QtPkN1c3RvbWVyQ29tcGFueUxpc3QoCiAgICAgICAgICAgIFNlYXJjaCA9PiAkUGFyYW17U2VhcmNofSwKICAgICAgICAgICAgVmFsaWQgID0+IDAsCiAgICAgICAgICAgIFVzZXJJRCA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgKTsKCiAgICAgICAgIyBjaGVjayBkdXBsaWNhdGUgZmllbGQKICAgICAgICBpZiAoICVMaXN0ICYmICRMaXN0eyRDdXN0b21lckNvbXBhbnlJRH0gKSB7CiAgICAgICAgICAgICRFcnJvcnN7RHVwbGljYXRlfSA9ICdTZXJ2ZXJFcnJvcic7CiAgICAgICAgfQoKICAgICAgICAjIGlmIG5vIGVycm9ycyBvY2N1cnJlZAogICAgICAgIGlmICggISVFcnJvcnMgKSB7CgogICAgICAgICAgICAjIGFkZCBjb21wYW55CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICRDdXN0b21lckNvbXBhbnlPYmplY3QtPkN1c3RvbWVyQ29tcGFueUFkZCgKICAgICAgICAgICAgICAgICAgICAlR2V0UGFyYW0sCiAgICAgICAgICAgICAgICAgICAgVXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgewoKICAgICAgICAgICAgICAgICRTZWxmLT5fT3ZlcnZpZXcoCiAgICAgICAgICAgICAgICAgICAgTmF2ICAgID0+ICROYXYsCiAgICAgICAgICAgICAgICAgICAgU2VhcmNoID0+ICRTZWFyY2gsCiAgICAgICAgICAgICAgICAgICAgJUdldFBhcmFtLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIG15ICRPdXRwdXQgPSAkTGF5b3V0T2JqZWN0LT5IZWFkZXIoKTsKICAgICAgICAgICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+TmF2aWdhdGlvbkJhcigKICAgICAgICAgICAgICAgICAgICBUeXBlID0+ICROYXZpZ2F0aW9uQmFyVHlwZSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk5vdGlmeSgKICAgICAgICAgICAgICAgICAgICBJbmZvID0+IFRyYW5zbGF0YWJsZSgnQ3VzdG9tZXIgY29tcGFueSBhZGRlZCEnKSwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgIyBzZXQgZHluYW1pYyBmaWVsZCB2YWx1ZXMKICAgICAgICAgICAgICAgIG15ICREeW5hbWljRmllbGRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6RHluYW1pY0ZpZWxkJyk7CgogICAgICAgICAgICAgICAgRU5UUlk6CiAgICAgICAgICAgICAgICBmb3IgbXkgJEVudHJ5ICggQHsgJENvbmZpZ09iamVjdC0+R2V0KCAkR2V0UGFyYW17U291cmNlfSApLT57TWFwfSB9ICkgewogICAgICAgICAgICAgICAgICAgIG5leHQgRU5UUlkgaWYgJEVudHJ5LT5bNV0gbmUgJ2R5bmFtaWNfZmllbGQnOwoKICAgICAgICAgICAgICAgICAgICBteSAkRHluYW1pY0ZpZWxkQ29uZmlnID0gJFNlbGYtPntEeW5hbWljRmllbGRMb29rdXB9LT57ICRFbnRyeS0+WzJdIH07CgogICAgICAgICAgICAgICAgICAgIGlmICggIUlzSGFzaFJlZldpdGhEYXRhKCREeW5hbWljRmllbGRDb25maWcpICkgewogICAgICAgICAgICAgICAgICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk5vdGlmeSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEluZm8gPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdEeW5hbWljIGZpZWxkICVzIG5vdCBmb3VuZCEnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRFbnRyeS0+WzJdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgbmV4dCBFTlRSWTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIG15ICRWYWx1ZVNldCA9ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0LT5WYWx1ZVNldCgKICAgICAgICAgICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRDb25maWcsCiAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdE5hbWUgICAgICAgICA9PiAkR2V0UGFyYW17Q3VzdG9tZXJJRH0sCiAgICAgICAgICAgICAgICAgICAgICAgIFZhbHVlICAgICAgICAgICAgICA9PiAkR2V0UGFyYW17ICRFbnRyeS0+WzBdIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIFVzZXJJRCAgICAgICAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCAhJFZhbHVlU2V0ICkgewogICAgICAgICAgICAgICAgICAgICAgICAkT3V0cHV0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuPSAkTGF5b3V0T2JqZWN0LT5Ob3RpZnkoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbmZvID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnVW5hYmxlIHRvIHNldCB2YWx1ZSBmb3IgZHluYW1pYyBmaWVsZCAlcyEnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRFbnRyeS0+WzJdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIG5leHQgRU5UUlk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+T3V0cHV0KAogICAgICAgICAgICAgICAgICAgIFRlbXBsYXRlRmlsZSA9PiAnQWRtaW5DdXN0b21lckNvbXBhbnknLAogICAgICAgICAgICAgICAgICAgIERhdGEgICAgICAgICA9PiBcJVBhcmFtLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Rm9vdGVyKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gJE91dHB1dDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBzb21ldGhpbmcgd2VudCB3cm9uZwogICAgICAgIG15ICRPdXRwdXQgPSAkTGF5b3V0T2JqZWN0LT5IZWFkZXIoKTsKICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk5hdmlnYXRpb25CYXIoCiAgICAgICAgICAgIFR5cGUgPT4gJE5hdmlnYXRpb25CYXJUeXBlLAogICAgICAgICk7CgogICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Tm90aWZ5KCBQcmlvcml0eSA9PiAnRXJyb3InICk7CgogICAgICAgICMgc2V0IG5vdGlmaWNhdGlvbiBmb3IgZHVwbGljYXRlIGVudHJ5CiAgICAgICAgaWYgKCAkRXJyb3Jze0R1cGxpY2F0ZX0gKSB7CiAgICAgICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Tm90aWZ5KAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ0Vycm9yJywKICAgICAgICAgICAgICAgIEluZm8gICAgID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgKICAgICAgICAgICAgICAgICAgICAnQ3VzdG9tZXIgQ29tcGFueSAlcyBhbHJlYWR5IGV4aXN0cyEnLAogICAgICAgICAgICAgICAgICAgICRDdXN0b21lckNvbXBhbnlJRCwKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAkU2VsZi0+X0VkaXQoCiAgICAgICAgICAgIEFjdGlvbiA9PiAnQWRkJywKICAgICAgICAgICAgTmF2ICAgID0+ICROYXYsCiAgICAgICAgICAgIEVycm9ycyA9PiBcJUVycm9ycywKICAgICAgICAgICAgJUdldFBhcmFtLAogICAgICAgICk7CiAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5PdXRwdXQoCiAgICAgICAgICAgIFRlbXBsYXRlRmlsZSA9PiAnQWRtaW5DdXN0b21lckNvbXBhbnknLAogICAgICAgICAgICBEYXRhICAgICAgICAgPT4gXCVQYXJhbSwKICAgICAgICApOwogICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Rm9vdGVyKCk7CiAgICAgICAgcmV0dXJuICRPdXRwdXQ7CiAgICB9CgogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICAgICMgb3ZlcnZpZXcKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiAgICBlbHNlIHsKICAgICAgICAkU2VsZi0+X092ZXJ2aWV3KAogICAgICAgICAgICBOYXYgICAgPT4gJE5hdiwKICAgICAgICAgICAgU2VhcmNoID0+ICRTZWFyY2gsCiAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICApOwogICAgICAgIG15ICRPdXRwdXQgICAgICAgPSAkTGF5b3V0T2JqZWN0LT5IZWFkZXIoKTsKICAgICAgICBteSAkTm90aWZpY2F0aW9uID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ05vdGlmaWNhdGlvbicgKSB8fCAnJzsKICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk5hdmlnYXRpb25CYXIoCiAgICAgICAgICAgIFR5cGUgPT4gJE5hdmlnYXRpb25CYXJUeXBlLAogICAgICAgICk7CiAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5Ob3RpZnkoIEluZm8gPT4gVHJhbnNsYXRhYmxlKCdDdXN0b21lciBjb21wYW55IHVwZGF0ZWQhJykgKQogICAgICAgICAgICBpZiAoICROb3RpZmljYXRpb24gJiYgJE5vdGlmaWNhdGlvbiBlcSAnVXBkYXRlJyApOwoKICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk91dHB1dCgKICAgICAgICAgICAgVGVtcGxhdGVGaWxlID0+ICdBZG1pbkN1c3RvbWVyQ29tcGFueScsCiAgICAgICAgICAgIERhdGEgICAgICAgICA9PiBcJVBhcmFtLAogICAgICAgICk7CgogICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Rm9vdGVyKCk7CiAgICAgICAgcmV0dXJuICRPdXRwdXQ7CiAgICB9Cn0KCnN1YiBfRWRpdCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnT3ZlcnZpZXcnLAogICAgICAgIERhdGEgPT4gXCVQYXJhbSwKICAgICk7CgogICAgJExheW91dE9iamVjdC0+QmxvY2soIE5hbWUgPT4gJ0FjdGlvbkxpc3QnICk7CiAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICBOYW1lID0+ICdBY3Rpb25PdmVydmlldycsCiAgICAgICAgRGF0YSA9PiBcJVBhcmFtLAogICAgKTsKCiAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICBOYW1lID0+ICdPdmVydmlld1VwZGF0ZScsCiAgICAgICAgRGF0YSA9PiBcJVBhcmFtLAogICAgKTsKCiAgICAjIGdldCBjb25maWcgb2JqZWN0CiAgICBteSAkQ29uZmlnT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKTsKCiAgICAjIHNlbmQgcGFyYW1ldGVyIFJlYWRPbmx5IHRvIEpTIG9iamVjdAogICAgJExheW91dE9iamVjdC0+QWRkSlNEYXRhKAogICAgICAgIEtleSAgID0+ICdSZWFkT25seScsCiAgICAgICAgVmFsdWUgPT4gJENvbmZpZ09iamVjdC0+eyAkUGFyYW17U291cmNlfSB9LT57UmVhZE9ubHl9LAogICAgKTsKCiAgICAjIEdldCB2YWxpZCBvYmplY3QuCiAgICBteSAkVmFsaWRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VmFsaWQnKTsKCiAgICAkUGFyYW17J1ZhbGlkT3B0aW9uJ30gPSAkTGF5b3V0T2JqZWN0LT5CdWlsZFNlbGVjdGlvbigKICAgICAgICBEYXRhICAgICAgID0+IHsgJFZhbGlkT2JqZWN0LT5WYWxpZExpc3QoKSwgfSwKICAgICAgICBOYW1lICAgICAgID0+ICdWYWxpZElEJywKICAgICAgICBDbGFzcyAgICAgID0+ICdNb2Rlcm5pemUnLAogICAgICAgIFNlbGVjdGVkSUQgPT4gJFBhcmFte1ZhbGlkSUR9LAogICAgKTsKCiAgICAjIEdldCBuZWVkZWQgb2JqZWN0cy4KICAgIG15ICRQYXJhbU9iamVjdCAgICAgICAgICAgICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OldlYjo6UmVxdWVzdCcpOwogICAgbXkgJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6RHluYW1pY0ZpZWxkOjpCYWNrZW5kJyk7CgogICAgRU5UUlk6CiAgICBmb3IgbXkgJEVudHJ5ICggQHsgJENvbmZpZ09iamVjdC0+R2V0KCAkUGFyYW17U291cmNlfSApLT57TWFwfSB9ICkgewogICAgICAgIGlmICggJEVudHJ5LT5bMF0gKSB7CgogICAgICAgICAgICAjIEhhbmRsZSBkeW5hbWljIGZpZWxkcwogICAgICAgICAgICBpZiAoICRFbnRyeS0+WzVdIGVxICdkeW5hbWljX2ZpZWxkJyApIHsKCiAgICAgICAgICAgICAgICBteSAkRHluYW1pY0ZpZWxkQ29uZmlnID0gJFNlbGYtPntEeW5hbWljRmllbGRMb29rdXB9LT57ICRFbnRyeS0+WzJdIH07CgogICAgICAgICAgICAgICAgbmV4dCBFTlRSWSBpZiAhSXNIYXNoUmVmV2l0aERhdGEoJER5bmFtaWNGaWVsZENvbmZpZyk7CgogICAgICAgICAgICAgICAgIyBHZXQgSFRNTCBmb3IgZHluYW1pYyBmaWVsZAogICAgICAgICAgICAgICAgbXkgJER5bmFtaWNGaWVsZEhUTUwgPSAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdC0+RWRpdEZpZWxkUmVuZGVyKAogICAgICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZENvbmZpZyA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnLAogICAgICAgICAgICAgICAgICAgIFZhbHVlICAgICAgICAgICAgICA9PiAkUGFyYW17ICRFbnRyeS0+WzBdIH0gPyAkUGFyYW17ICRFbnRyeS0+WzBdIH0gOiB1bmRlZiwKICAgICAgICAgICAgICAgICAgICBNYW5kYXRvcnkgICAgICAgICAgPT4gJEVudHJ5LT5bNF0sCiAgICAgICAgICAgICAgICAgICAgTGF5b3V0T2JqZWN0ICAgICAgID0+ICRMYXlvdXRPYmplY3QsCiAgICAgICAgICAgICAgICAgICAgUGFyYW1PYmplY3QgICAgICAgID0+ICRQYXJhbU9iamVjdCwKCiAgICAgICAgICAgICAgICAgICAgIyBTZXJ2ZXIgZXJyb3IsIGlmIGFueQogICAgICAgICAgICAgICAgICAgICV7ICRQYXJhbXtFcnJvcnN9LT57ICRFbnRyeS0+WzBdIH0gfSwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgIyBza2lwIGZpZWxkcyBmb3Igd2hpY2ggSFRNTCBjb3VsZCBub3QgYmUgcmV0cmlldmVkCiAgICAgICAgICAgICAgICBuZXh0IEVOVFJZIGlmICFJc0hhc2hSZWZXaXRoRGF0YSgkRHluYW1pY0ZpZWxkSFRNTCk7CgogICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAnUHJlZmVyZW5jZXNHZW5lcmljJywKICAgICAgICAgICAgICAgICAgICBEYXRhID0+IHt9LAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICdEeW5hbWljRmllbGQnLAogICAgICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBOYW1lICA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnLT57TmFtZX0sCiAgICAgICAgICAgICAgICAgICAgICAgIExhYmVsID0+ICREeW5hbWljRmllbGRIVE1MLT57TGFiZWx9LAogICAgICAgICAgICAgICAgICAgICAgICBGaWVsZCA9PiAkRHluYW1pY0ZpZWxkSFRNTC0+e0ZpZWxkfSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICBuZXh0IEVOVFJZOwogICAgICAgICAgICB9CgogICAgICAgICAgICBteSAkQmxvY2sgPSAnSW5wdXQnOwoKICAgICAgICAgICAgIyBidWlsZCBzZWxlY3Rpb25zIG9yIGlucHV0IGZpZWxkcwogICAgICAgICAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCggJFBhcmFte1NvdXJjZX0gKS0+e1NlbGVjdGlvbnN9LT57ICRFbnRyeS0+WzBdIH0gKSB7CiAgICAgICAgICAgICAgICBteSAkT3B0aW9uUmVxdWlyZWQgPSAnJzsKICAgICAgICAgICAgICAgIGlmICggJEVudHJ5LT5bNF0gKSB7CiAgICAgICAgICAgICAgICAgICAgJE9wdGlvblJlcXVpcmVkID0gJ1ZhbGlkYXRlX1JlcXVpcmVkJzsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIGJ1aWxkIFZhbGlkSUQgc3RyaW5nCiAgICAgICAgICAgICAgICAkQmxvY2sgPSAnT3B0aW9uJzsKICAgICAgICAgICAgICAgICRQYXJhbXtPcHRpb259ID0gJExheW91dE9iamVjdC0+QnVpbGRTZWxlY3Rpb24oCiAgICAgICAgICAgICAgICAgICAgRGF0YSA9PgogICAgICAgICAgICAgICAgICAgICAgICAkQ29uZmlnT2JqZWN0LT5HZXQoICRQYXJhbXtTb3VyY2V9ICktPntTZWxlY3Rpb25zfQogICAgICAgICAgICAgICAgICAgICAgICAtPnsgJEVudHJ5LT5bMF0gfSwKICAgICAgICAgICAgICAgICAgICBOYW1lICA9PiAkRW50cnktPlswXSwKICAgICAgICAgICAgICAgICAgICBDbGFzcyA9PiAiJE9wdGlvblJlcXVpcmVkIE1vZGVybml6ZSAiIC4KICAgICAgICAgICAgICAgICAgICAgICAgKCAkUGFyYW17RXJyb3JzfS0+eyAkRW50cnktPlswXSAuICdJbnZhbGlkJyB9IHx8ICcnICksCiAgICAgICAgICAgICAgICAgICAgVHJhbnNsYXRpb24gPT4gMCwKICAgICAgICAgICAgICAgICAgICBTZWxlY3RlZElEICA9PiAkUGFyYW17ICRFbnRyeS0+WzBdIH0sCiAgICAgICAgICAgICAgICAgICAgTWF4ICAgICAgICAgPT4gMzUsCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNpZiAoICRFbnRyeS0+WzBdID1+IC9eQ3VzdG9tZXJDb21wYW55Q291bnRyeS9pICkgewogICAgICAgICAgICAgICAgbXkgJE9wdGlvblJlcXVpcmVkID0gJyc7CiAgICAgICAgICAgICAgICBpZiAoICRFbnRyeS0+WzRdICkgewogICAgICAgICAgICAgICAgICAgICRPcHRpb25SZXF1aXJlZCA9ICdWYWxpZGF0ZV9SZXF1aXJlZCc7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBidWlsZCBDb3VudHJ5IHN0cmluZwogICAgICAgICAgICAgICAgbXkgJENvdW50cnlMaXN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlJlZmVyZW5jZURhdGEnKS0+Q291bnRyeUxpc3QoKTsKCiAgICAgICAgICAgICAgICAkQmxvY2sgPSAnT3B0aW9uJzsKICAgICAgICAgICAgICAgICRQYXJhbXtPcHRpb259ID0gJExheW91dE9iamVjdC0+QnVpbGRTZWxlY3Rpb24oCiAgICAgICAgICAgICAgICAgICAgRGF0YSAgICAgICAgID0+ICRDb3VudHJ5TGlzdCwKICAgICAgICAgICAgICAgICAgICBQb3NzaWJsZU5vbmUgPT4gMSwKICAgICAgICAgICAgICAgICAgICBTb3J0ICAgICAgICAgPT4gJ0FscGhhbnVtZXJpY1ZhbHVlJywKICAgICAgICAgICAgICAgICAgICBOYW1lICAgICAgICAgPT4gJEVudHJ5LT5bMF0sCiAgICAgICAgICAgICAgICAgICAgQ2xhc3MgICAgICAgID0+ICIkT3B0aW9uUmVxdWlyZWQgTW9kZXJuaXplICIgLgogICAgICAgICAgICAgICAgICAgICAgICAoICRQYXJhbXtFcnJvcnN9LT57ICRFbnRyeS0+WzBdIC4gJ0ludmFsaWQnIH0gfHwgJycgKSwKICAgICAgICAgICAgICAgICAgICBTZWxlY3RlZElEID0+IGRlZmluZWQoICRQYXJhbXsgJEVudHJ5LT5bMF0gfSApID8gJFBhcmFteyAkRW50cnktPlswXSB9IDogMSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzaWYgKCAkRW50cnktPlswXSA9fiAvXlZhbGlkSUQvaSApIHsKICAgICAgICAgICAgICAgIG15ICRPcHRpb25SZXF1aXJlZCA9ICcnOwogICAgICAgICAgICAgICAgaWYgKCAkRW50cnktPls0XSApIHsKICAgICAgICAgICAgICAgICAgICAkT3B0aW9uUmVxdWlyZWQgPSAnVmFsaWRhdGVfUmVxdWlyZWQnOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgYnVpbGQgVmFsaWRJRCBzdHJpbmcKICAgICAgICAgICAgICAgICRCbG9jayA9ICdPcHRpb24nOwogICAgICAgICAgICAgICAgJFBhcmFte09wdGlvbn0gPSAkTGF5b3V0T2JqZWN0LT5CdWlsZFNlbGVjdGlvbigKICAgICAgICAgICAgICAgICAgICBEYXRhICA9PiB7ICRWYWxpZE9iamVjdC0+VmFsaWRMaXN0KCksIH0sCiAgICAgICAgICAgICAgICAgICAgTmFtZSAgPT4gJEVudHJ5LT5bMF0sCiAgICAgICAgICAgICAgICAgICAgQ2xhc3MgPT4gIiRPcHRpb25SZXF1aXJlZCBNb2Rlcm5pemUgIiAuCiAgICAgICAgICAgICAgICAgICAgICAgICggJFBhcmFte0Vycm9yc30tPnsgJEVudHJ5LT5bMF0gLiAnSW52YWxpZCcgfSB8fCAnJyApLAogICAgICAgICAgICAgICAgICAgIFNlbGVjdGVkSUQgPT4gZGVmaW5lZCggJFBhcmFteyAkRW50cnktPlswXSB9ICkgPyAkUGFyYW17ICRFbnRyeS0+WzBdIH0gOiAxLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRQYXJhbXtWYWx1ZX0gPSAkUGFyYW17ICRFbnRyeS0+WzBdIH0gfHwgJyc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgc2hvdyByZXF1aXJlZCBmbGFnCiAgICAgICAgICAgIGlmICggJEVudHJ5LT5bNF0gKSB7CiAgICAgICAgICAgICAgICAkUGFyYW17TWFuZGF0b3J5Q2xhc3N9ID0gJ2NsYXNzPSJNYW5kYXRvcnkiJzsKICAgICAgICAgICAgICAgICRQYXJhbXtTdGFyTGFiZWx9ICAgICAgPSAnPHNwYW4gY2xhc3M9Ik1hcmtlciI+Kjwvc3Bhbj4nOwogICAgICAgICAgICAgICAgJFBhcmFte1JlcXVpcmVkQ2xhc3N9ICA9ICdWYWxpZGF0ZV9SZXF1aXJlZCc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkUGFyYW17TWFuZGF0b3J5Q2xhc3N9ID0gJyc7CiAgICAgICAgICAgICAgICAkUGFyYW17U3RhckxhYmVsfSAgICAgID0gJyc7CiAgICAgICAgICAgICAgICAkUGFyYW17UmVxdWlyZWRDbGFzc30gID0gJyc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgc2hvdyByZXF1aXJlZCBmbGFnCiAgICAgICAgICAgIGlmICggJEVudHJ5LT5bN10gKSB7CiAgICAgICAgICAgICAgICAkUGFyYW17UmVhZE9ubHlUeXBlfSA9ICdyZWFkb25seT0icmVhZG9ubHkiJzsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRQYXJhbXtSZWFkT25seVR5cGV9ID0gJyc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgYWRkIGZvcm0gb3B0aW9uCiAgICAgICAgICAgIGlmICggJFBhcmFte1R5cGV9ICYmICRQYXJhbXtUeXBlfSBlcSAnaGlkZGVuJyApIHsKICAgICAgICAgICAgICAgICRQYXJhbXtQcmVmZXJlbmNlc30gLj0gJFBhcmFte1ZhbHVlfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gJ1ByZWZlcmVuY2VzR2VuZXJpYycsCiAgICAgICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIEl0ZW0gPT4gJEVudHJ5LT5bMV0sCiAgICAgICAgICAgICAgICAgICAgICAgICVQYXJhbQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAiUHJlZmVyZW5jZXNHZW5lcmljJEJsb2NrIiwKICAgICAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgICAgICAgICBJdGVtICAgICAgICAgPT4gJEVudHJ5LT5bMV0sCiAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgICAgICAgICA9PiAkRW50cnktPlswXSwKICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWUgICAgICAgID0+ICRQYXJhbXsgJEVudHJ5LT5bMF0gfSwKICAgICAgICAgICAgICAgICAgICAgICAgSW52YWxpZEZpZWxkID0+ICRQYXJhbXtFcnJvcnN9LT57ICRFbnRyeS0+WzBdIC4gJ0ludmFsaWQnIH0gfHwgJycsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBpZiAoICRFbnRyeS0+WzRdICkgewogICAgICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICJQcmVmZXJlbmNlc0dlbmVyaWMke0Jsb2NrfVJlcXVpcmVkIiwKICAgICAgICAgICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICRFbnRyeS0+WzBdLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gMTsKfQoKc3ViIF9PdmVydmlldyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnT3ZlcnZpZXcnLAogICAgICAgIERhdGEgPT4gXCVQYXJhbSwKICAgICk7CgogICAgJExheW91dE9iamVjdC0+QmxvY2soIE5hbWUgPT4gJ0FjdGlvbkxpc3QnICk7CiAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICBOYW1lID0+ICdBY3Rpb25TZWFyY2gnLAogICAgICAgIERhdGEgPT4gXCVQYXJhbSwKICAgICk7CgogICAgbXkgJEN1c3RvbWVyQ29tcGFueU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDdXN0b21lckNvbXBhbnknKTsKCiAgICAjIGdldCB3cml0YWJsZSBkYXRhIHNvdXJjZXMKICAgIG15ICVDdXN0b21lckNvbXBhbnlTb3VyY2UgPSAkQ3VzdG9tZXJDb21wYW55T2JqZWN0LT5DdXN0b21lckNvbXBhbnlTb3VyY2VMaXN0KAogICAgICAgIFJlYWRPbmx5ID0+IDAsCiAgICApOwoKICAgICMgb25seSBzaG93IEFkZCBvcHRpb24gaWYgd2UgaGF2ZSBhdCBsZWFzdCBvbmUgd3JpdGFibGUgYmFja2VuZAogICAgaWYgKCBzY2FsYXIga2V5cyAlQ3VzdG9tZXJDb21wYW55U291cmNlICkgewogICAgICAgICRQYXJhbXtTb3VyY2VPcHRpb259ID0gJExheW91dE9iamVjdC0+QnVpbGRTZWxlY3Rpb24oCiAgICAgICAgICAgIERhdGEgICAgICAgPT4geyAlQ3VzdG9tZXJDb21wYW55U291cmNlLCB9LAogICAgICAgICAgICBOYW1lICAgICAgID0+ICdTb3VyY2UnLAogICAgICAgICAgICBTZWxlY3RlZElEID0+ICRQYXJhbXtTb3VyY2V9IHx8ICcnLAogICAgICAgICAgICBDbGFzcyAgICAgID0+ICdNb2Rlcm5pemUnLAogICAgICAgICk7CgogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdBY3Rpb25BZGQnLAogICAgICAgICAgICBEYXRhID0+IFwlUGFyYW0sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGlmIHRoZXJlIGFyZSBhbnkgcmVnaXN0cmllcyB0byBzZWFyY2gsIHRoZSB0YWJsZSBpcyBmaWxsZWQgYW5kIHNob3duCiAgICBpZiAoICRQYXJhbXtTZWFyY2h9ICkgewoKICAgICAgICAjIGdldCBjb25maWcgb2JqZWN0CiAgICAgICAgbXkgJENvbmZpZ09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CgogICAgICAgICMgc2FtZSBMaW1pdCBhcyAkU2VsZi0+e0N1c3RvbWVyQ29tcGFueU1hcH0tPnsnQ3VzdG9tZXJDb21wYW55U2VhcmNoTGlzdExpbWl0J30KICAgICAgICAjIHNtYWxsZXN0IExpbWl0IGZyb20gYWxsIHNvdXJjZXMKICAgICAgICBteSAkTGltaXQgPSA0MDA7CiAgICAgICAgU09VUkNFOgogICAgICAgIGZvciBteSAkQ291bnQgKCAnJywgMSAuLiAxMCApIHsKICAgICAgICAgICAgbmV4dCBTT1VSQ0UgaWYgISRDb25maWdPYmplY3QtPkdldCgiQ3VzdG9tZXJDb21wYW55JENvdW50Iik7CiAgICAgICAgICAgIG15ICRDdXN0b21lclVzZXJNYXAgPSAkQ29uZmlnT2JqZWN0LT5HZXQoIkN1c3RvbWVyQ29tcGFueSRDb3VudCIpOwogICAgICAgICAgICBuZXh0IFNPVVJDRSBpZiAhJEN1c3RvbWVyVXNlck1hcC0+e0N1c3RvbWVyQ29tcGFueVNlYXJjaExpc3RMaW1pdH07CiAgICAgICAgICAgIGlmICggJEN1c3RvbWVyVXNlck1hcC0+e0N1c3RvbWVyQ29tcGFueVNlYXJjaExpc3RMaW1pdH0gPCAkTGltaXQgKSB7CiAgICAgICAgICAgICAgICAkTGltaXQgPSAkQ3VzdG9tZXJVc2VyTWFwLT57Q3VzdG9tZXJDb21wYW55U2VhcmNoTGlzdExpbWl0fTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgbXkgJUxpc3RBbGxJdGVtcyA9ICRDdXN0b21lckNvbXBhbnlPYmplY3QtPkN1c3RvbWVyQ29tcGFueUxpc3QoCiAgICAgICAgICAgIFNlYXJjaCA9PiAkUGFyYW17U2VhcmNofSwKICAgICAgICAgICAgTGltaXQgID0+ICRMaW1pdCArIDEsCiAgICAgICAgICAgIFZhbGlkICA9PiAwLAogICAgICAgICAgICBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICk7CgogICAgICAgIGlmICgga2V5cyAlTGlzdEFsbEl0ZW1zIDw9ICRMaW1pdCApIHsKICAgICAgICAgICAgbXkgJExpc3RBbGxJdGVtcyA9IGtleXMgJUxpc3RBbGxJdGVtczsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdPdmVydmlld0hlYWRlcicsCiAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICBMaXN0QWxsID0+ICRMaXN0QWxsSXRlbXMsCiAgICAgICAgICAgICAgICAgICAgTGltaXQgICA9PiAkTGltaXQsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgbXkgJUxpc3QgPSAkQ3VzdG9tZXJDb21wYW55T2JqZWN0LT5DdXN0b21lckNvbXBhbnlMaXN0KAogICAgICAgICAgICBTZWFyY2ggPT4gJFBhcmFte1NlYXJjaH0sCiAgICAgICAgICAgIFZhbGlkICA9PiAwLAogICAgICAgICAgICBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICk7CgogICAgICAgIGlmICgga2V5cyAlTGlzdEFsbEl0ZW1zID4gJExpbWl0ICkgewogICAgICAgICAgICBteSAkTGlzdEFsbEl0ZW1zICAgPSBrZXlzICVMaXN0QWxsSXRlbXM7CiAgICAgICAgICAgIG15ICRTZWFyY2hMaXN0U2l6ZSA9IGtleXMgJUxpc3Q7CgogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ092ZXJ2aWV3SGVhZGVyJywKICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgIFNlYXJjaExpc3RTaXplID0+ICRTZWFyY2hMaXN0U2l6ZSwKICAgICAgICAgICAgICAgICAgICBMaXN0QWxsICAgICAgICA9PiAkTGlzdEFsbEl0ZW1zLAogICAgICAgICAgICAgICAgICAgIExpbWl0ICAgICAgICAgID0+ICRMaW1pdCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnT3ZlcnZpZXdSZXN1bHQnLAogICAgICAgICAgICBEYXRhID0+IFwlUGFyYW0sCiAgICAgICAgKTsKCiAgICAgICAgIyBnZXQgdmFsaWQgbGlzdAogICAgICAgIG15ICVWYWxpZExpc3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VmFsaWQnKS0+VmFsaWRMaXN0KCk7CgogICAgICAgIGlmICggISRDb25maWdPYmplY3QtPkdldCggJFBhcmFte1NvdXJjZX0gKS0+e1BhcmFtc30tPntGb3JlaWduREJ9ICkgewogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jayggTmFtZSA9PiAnTG9jYWxEQicgKTsKICAgICAgICB9CgogICAgICAgICMgaWYgdGhlcmUgYXJlIHJlc3VsdHMgdG8gc2hvdwogICAgICAgIGlmICglTGlzdCkgewogICAgICAgICAgICBmb3IgbXkgJExpc3RLZXkgKCBzb3J0IHsgJExpc3R7JGF9IGNtcCAkTGlzdHskYn0gfSBrZXlzICVMaXN0ICkgewoKICAgICAgICAgICAgICAgIG15ICVEYXRhID0gJEN1c3RvbWVyQ29tcGFueU9iamVjdC0+Q3VzdG9tZXJDb21wYW55R2V0KCBDdXN0b21lcklEID0+ICRMaXN0S2V5ICk7CiAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICdPdmVydmlld1Jlc3VsdFJvdycsCiAgICAgICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICVEYXRhLAogICAgICAgICAgICAgICAgICAgICAgICBTZWFyY2ggPT4gJFBhcmFte1NlYXJjaH0sCiAgICAgICAgICAgICAgICAgICAgICAgIE5hdiAgICA9PiAkUGFyYW17TmF2fSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICBpZiAoICEkQ29uZmlnT2JqZWN0LT5HZXQoICRQYXJhbXtTb3VyY2V9ICktPntQYXJhbXN9LT57Rm9yZWlnbkRCfSApIHsKICAgICAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAnTG9jYWxEQlJvdycsCiAgICAgICAgICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgVmFsaWQgPT4gJFZhbGlkTGlzdHsgJERhdGF7VmFsaWRJRH0gfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICVEYXRhLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIG90aGVyd2lzZSBpdCBkaXNwbGF5cyBhIG5vIGRhdGEgZm91bmQgbWVzc2FnZQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ05vRGF0YUZvdW5kTXNnJywKICAgICAgICAgICAgICAgIERhdGEgPT4ge30sCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgICMgaWYgdGhlcmUgaXMgbm90aGluZyB0byBzZWFyY2ggaXQgc2hvd3MgYSBtZXNzYWdlCiAgICBlbHNlCiAgICB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ05vU2VhcmNoVGVybXMnLAogICAgICAgICAgICBEYXRhID0+IHt9LAogICAgICAgICk7CiAgICB9CiAgICByZXR1cm4gMTsKfQoKMTsK</File>
        <File Location="Custom/Kernel/Modules/AdminCustomerGroup.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxLTIwMjIgWm51bnkgR21iSCwgaHR0cHM6Ly96bnVueS5vcmcvCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6TW9kdWxlczo6QWRtaW5DdXN0b21lckdyb3VwOwoKdXNlIHN0cmljdDsKdXNlIHdhcm5pbmdzOwoKdXNlIEtlcm5lbDo6U3lzdGVtOjpWYXJpYWJsZUNoZWNrIHF3KElzSGFzaFJlZldpdGhEYXRhKTsKdXNlIEtlcm5lbDo6TGFuZ3VhZ2UgcXcoVHJhbnNsYXRhYmxlKTsKCm91ciAkT2JqZWN0TWFuYWdlckRpc2FibGVkID0gMTsKCnN1YiBuZXcgewogICAgbXkgKCAkVHlwZSwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGFsbG9jYXRlIG5ldyBoYXNoIGZvciBvYmplY3QKICAgIG15ICRTZWxmID0geyVQYXJhbX07CiAgICBibGVzcyggJFNlbGYsICRUeXBlICk7CgogICAgcmV0dXJuICRTZWxmOwp9CgpzdWIgUnVuIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKICAgIG15ICRDb25maWdPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpOwoKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgICMgY2hlY2sgaWYgZmVhdHVyZSBpcyBhY3RpdmUKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgIGlmICggISRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXJHcm91cFN1cHBvcnQnKSApIHsKICAgICAgICBteSAkT3V0cHV0ID0gJExheW91dE9iamVjdC0+SGVhZGVyKCk7CiAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5OYXZpZ2F0aW9uQmFyKCk7CgogICAgICAgICRPdXRwdXQgLj0gJFNlbGYtPl9EaXNhYmxlZCgpOwoKICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPkZvb3RlcigpOwogICAgICAgIHJldHVybiAkT3V0cHV0OwogICAgfQoKICAgIG15ICRQYXJhbU9iamVjdCAgICAgICAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6V2ViOjpSZXF1ZXN0Jyk7CiAgICBteSAkQ3VzdG9tZXJDb21wYW55T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyQ29tcGFueScpOwogICAgbXkgJEN1c3RvbWVyR3JvdXBPYmplY3QgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDdXN0b21lckdyb3VwJyk7CiAgICBteSAkR3JvdXBPYmplY3QgICAgICAgICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06Okdyb3VwJyk7CgogICAgIyBzZXQgc2VhcmNoIGxpbWl0CiAgICBteSAkU2VhcmNoTGltaXQgPSAyMDA7CgogICAgIyBnZXQgcGVybWlzc2lvbiBjb250ZXh0cwogICAgbXkgJENvbnRleHRDb25maWcgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0N1c3RvbWVyR3JvdXBQZXJtaXNzaW9uQ29udGV4dCcpOwoKICAgICMgdGhyb3cgYW4gZXJyb3IgaWYgbm8gY29udGV4dCBmb3VuZAogICAgaWYgKCAhSXNIYXNoUmVmV2l0aERhdGEoJENvbnRleHRDb25maWcpICkgewogICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5GYXRhbEVycm9yKAogICAgICAgICAgICBNZXNzYWdlID0+CiAgICAgICAgICAgICAgICBUcmFuc2xhdGFibGUoIk5vIGNvbmZpZ3VyYXRpb24gZm9yICdDdXN0b21lckdyb3VwUGVybWlzc2lvbkNvbnRleHQnIGZvdW5kISIpCiAgICAgICAgICAgICAgICAuICcgJwogICAgICAgICAgICAgICAgLiBUcmFuc2xhdGFibGUoJ1BsZWFzZSBjaGVjayBzeXN0ZW0gY29uZmlndXJhdGlvbi4nKSwKICAgICAgICApOwogICAgfQoKICAgIG15IEBDb250ZXh0czsKICAgIG15ICVDb250ZXh0TG9va3VwOwogICAgZm9yIG15ICRLZXkgKCBzb3J0IGtleXMgJXskQ29udGV4dENvbmZpZ30gKSB7CiAgICAgICAgbXkgJENvbnRleHQgPSAkQ29udGV4dENvbmZpZy0+eyRLZXl9LT57VmFsdWV9OwoKICAgICAgICAjIHRocm93IGFuIGVycm9yIGlmIG5vIHZhbHVlIHByZXNlbnQKICAgICAgICBpZiAoICEkQ29udGV4dCApIHsKICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkZhdGFsRXJyb3IoCiAgICAgICAgICAgICAgICBNZXNzYWdlID0+CiAgICAgICAgICAgICAgICAgICAgVHJhbnNsYXRhYmxlKCdJbnZhbGlkIHBlcm1pc3Npb24gY29udGV4dCBjb25maWd1cmF0aW9uOicpCiAgICAgICAgICAgICAgICAgICAgLiAiICdDdXN0b21lckdyb3VwUGVybWlzc2lvbkNvbnRleHQnIC0+ICckS2V5Jy4gIgogICAgICAgICAgICAgICAgICAgIC4gVHJhbnNsYXRhYmxlKCdQbGVhc2UgY2hlY2sgc3lzdGVtIGNvbmZpZ3VyYXRpb24uJyksCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICBwdXNoIEBDb250ZXh0cywgJENvbnRleHQ7CiAgICAgICAgJENvbnRleHRMb29rdXB7JENvbnRleHR9ID0gJENvbnRleHRDb25maWctPnskS2V5fTsKICAgIH0KCiAgICAkUGFyYW17Q3VzdG9tZXJTZWFyY2h9ID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gIkN1c3RvbWVyU2VhcmNoIiApIHx8ICcqJzsKCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICAjIGN1c3RvbWVyIDwtPiBncm91cCAxOm4KICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgIGlmICggJFNlbGYtPntTdWJhY3Rpb259IGVxICdDdXN0b21lcicgKSB7CgogICAgICAgICMgZ2V0IHVzZXIgZGF0YQogICAgICAgIG15ICRJRCAgICAgICAgICAgICAgICAgID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0lEJyApOwogICAgICAgIG15ICVDdXN0b21lckNvbXBhbnkgICAgID0gJEN1c3RvbWVyQ29tcGFueU9iamVjdC0+Q3VzdG9tZXJDb21wYW55R2V0KCBDdXN0b21lcklEID0+ICRJRCApOwogICAgICAgIG15ICRDdXN0b21lckNvbXBhbnlOYW1lID0gJEN1c3RvbWVyQ29tcGFueXtDdXN0b21lckNvbXBhbnlOYW1lfTsKCiAgICAgICAgIyBnZXQgZ3JvdXAgZGF0YQogICAgICAgIG15ICVHcm91cERhdGEgPSAkR3JvdXBPYmplY3QtPkdyb3VwTGlzdCggVmFsaWQgPT4gMSApOwogICAgICAgIG15ICVUeXBlczsKICAgICAgICBmb3IgbXkgJENvbnRleHQgKEBDb250ZXh0cykgewogICAgICAgICAgICBmb3IgbXkgJFR5cGUgKCBAeyAkQ29uZmlnT2JqZWN0LT5HZXQoJ1N5c3RlbTo6Q3VzdG9tZXI6OlBlcm1pc3Npb24nKSB9ICkgewogICAgICAgICAgICAgICAgbXkgJURhdGEgPSAkQ3VzdG9tZXJHcm91cE9iamVjdC0+R3JvdXBDdXN0b21lckxpc3QoCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJJRCA9PiAkSUQsCiAgICAgICAgICAgICAgICAgICAgVHlwZSAgICAgICA9PiAkVHlwZSwKICAgICAgICAgICAgICAgICAgICBDb250ZXh0ICAgID0+ICRDb250ZXh0LAogICAgICAgICAgICAgICAgICAgIFJlc3VsdCAgICAgPT4gJ0hBU0gnLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICRUeXBlc3skQ29udGV4dH0tPnskVHlwZX0gPSBcJURhdGE7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIG15ICRPdXRwdXQgPSAkTGF5b3V0T2JqZWN0LT5IZWFkZXIoKTsKICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk5hdmlnYXRpb25CYXIoKTsKICAgICAgICAkT3V0cHV0IC49ICRTZWxmLT5fQ2hhbmdlKAogICAgICAgICAgICAlVHlwZXMsCiAgICAgICAgICAgIERhdGEgICAgICAgICAgID0+IFwlR3JvdXBEYXRhLAogICAgICAgICAgICBJRCAgICAgICAgICAgICA9PiAkSUQsCiAgICAgICAgICAgIE5hbWUgICAgICAgICAgID0+ICRDdXN0b21lckNvbXBhbnlOYW1lLAogICAgICAgICAgICBUeXBlICAgICAgICAgICA9PiAnQ3VzdG9tZXInLAogICAgICAgICAgICBDdXN0b21lclNlYXJjaCA9PiAkUGFyYW17Q3VzdG9tZXJTZWFyY2h9LAogICAgICAgICAgICBDb250ZXh0cyAgICAgICA9PiBcQENvbnRleHRzLAogICAgICAgICAgICBDb250ZXh0TG9va3VwICA9PiBcJUNvbnRleHRMb29rdXAsCiAgICAgICAgKTsKICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPkZvb3RlcigpOwoKICAgICAgICByZXR1cm4gJE91dHB1dDsKICAgIH0KCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICAjIGdyb3VwIDwtPiBjdXN0b21lciBuOjEKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgIGVsc2lmICggJFNlbGYtPntTdWJhY3Rpb259IGVxICdHcm91cCcgKSB7CgogICAgICAgICMgR2V0IHBhcmFtcy4KICAgICAgICAkUGFyYW17U3ViYWN0aW9ufSA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdTdWJhY3Rpb24nICk7CgogICAgICAgICMgZ2V0IGdyb3VwIGRhdGEKICAgICAgICBteSAkSUQgICAgICAgID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0lEJyApOwogICAgICAgIG15ICVHcm91cERhdGEgPSAkR3JvdXBPYmplY3QtPkdyb3VwR2V0KCBJRCA9PiAkSUQgKTsKCiAgICAgICAgIyBzZWFyY2ggY3VzdG9tZXJzCiAgICAgICAgbXkgJUN1c3RvbWVyTGlzdCA9ICRDdXN0b21lckNvbXBhbnlPYmplY3QtPkN1c3RvbWVyQ29tcGFueUxpc3QoCiAgICAgICAgICAgIFNlYXJjaCA9PiAkUGFyYW17Q3VzdG9tZXJTZWFyY2h9LAogICAgICAgICAgICBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICk7CiAgICAgICAgbXkgQEN1c3RvbWVyS2V5TGlzdCA9IHNvcnQga2V5cyAlQ3VzdG9tZXJMaXN0OwoKICAgICAgICAjIHNldCBtYXggY291bnQKICAgICAgICBteSAkTWF4Q291bnQgPSBAQ3VzdG9tZXJLZXlMaXN0OwogICAgICAgIGlmICggJE1heENvdW50ID4gJFNlYXJjaExpbWl0ICkgewogICAgICAgICAgICAkTWF4Q291bnQgPSAkU2VhcmNoTGltaXQ7CiAgICAgICAgfQoKICAgICAgICBteSAlQ3VzdG9tZXJEYXRhOwoKICAgICAgICAjIG91dHB1dCByb3dzCiAgICAgICAgZm9yIG15ICRDb3VudGVyICggMSAuLiAkTWF4Q291bnQgKSB7CiAgICAgICAgICAgICRDdXN0b21lckRhdGF7ICRDdXN0b21lcktleUxpc3RbICRDb3VudGVyIC0gMSBdIH0gPSAkQ3VzdG9tZXJMaXN0eyAkQ3VzdG9tZXJLZXlMaXN0WyAkQ291bnRlciAtIDEgXSB9OwogICAgICAgIH0KCiAgICAgICAgIyBnZXQgcGVybWlzc2lvbiBsaXN0IHVzZXJzCiAgICAgICAgbXkgJVR5cGVzOwogICAgICAgIGZvciBteSAkQ29udGV4dCAoQENvbnRleHRzKSB7CiAgICAgICAgICAgIGZvciBteSAkVHlwZSAoIEB7ICRDb25maWdPYmplY3QtPkdldCgnU3lzdGVtOjpDdXN0b21lcjo6UGVybWlzc2lvbicpIH0gKSB7CiAgICAgICAgICAgICAgICBteSAlRGF0YSA9ICRDdXN0b21lckdyb3VwT2JqZWN0LT5Hcm91cEN1c3RvbWVyTGlzdCgKICAgICAgICAgICAgICAgICAgICBHcm91cElEID0+ICRJRCwKICAgICAgICAgICAgICAgICAgICBUeXBlICAgID0+ICRUeXBlLAogICAgICAgICAgICAgICAgICAgIENvbnRleHQgPT4gJENvbnRleHQsCiAgICAgICAgICAgICAgICAgICAgUmVzdWx0ICA9PiAnSEFTSCcsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgJFR5cGVzeyRDb250ZXh0fS0+eyRUeXBlfSA9IFwlRGF0YTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgbXkgJE91dHB1dCA9ICRMYXlvdXRPYmplY3QtPkhlYWRlcigpOwogICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+TmF2aWdhdGlvbkJhcigpOwogICAgICAgICRPdXRwdXQgLj0gJFNlbGYtPl9DaGFuZ2UoCiAgICAgICAgICAgICVUeXBlcywKICAgICAgICAgICAgRGF0YSAgICAgICAgICAgPT4gXCVDdXN0b21lckRhdGEsCiAgICAgICAgICAgIElEICAgICAgICAgICAgID0+ICRHcm91cERhdGF7SUR9LAogICAgICAgICAgICBOYW1lICAgICAgICAgICA9PiAkR3JvdXBEYXRhe05hbWV9LAogICAgICAgICAgICBUeXBlICAgICAgICAgICA9PiAnR3JvdXAnLAogICAgICAgICAgICBTZWFyY2hMaW1pdCAgICA9PiAkU2VhcmNoTGltaXQsCiAgICAgICAgICAgIEl0ZW1MaXN0ICAgICAgID0+IFxAQ3VzdG9tZXJLZXlMaXN0LAogICAgICAgICAgICBDdXN0b21lclNlYXJjaCA9PiAkUGFyYW17Q3VzdG9tZXJTZWFyY2h9LAogICAgICAgICAgICBDb250ZXh0cyAgICAgICA9PiBcQENvbnRleHRzLAogICAgICAgICAgICBDb250ZXh0TG9va3VwICA9PiBcJUNvbnRleHRMb29rdXAsCiAgICAgICAgICAgICVQYXJhbSwKICAgICAgICApOwogICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Rm9vdGVyKCk7CiAgICAgICAgcmV0dXJuICRPdXRwdXQ7CiAgICB9CgogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gIwogICAgIyBhZGQgY3VzdG9tZXIgdG8gZ3JvdXBzCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICBlbHNpZiAoICRTZWxmLT57U3ViYWN0aW9ufSBlcSAnQ2hhbmdlR3JvdXAnICkgewoKICAgICAgICAjIGNoYWxsZW5nZSB0b2tlbiBjaGVjayBmb3Igd3JpdGUgYWN0aW9uCiAgICAgICAgJExheW91dE9iamVjdC0+Q2hhbGxlbmdlVG9rZW5DaGVjaygpOwoKICAgICAgICBteSAkSUQgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnSUQnICkgfHwgJyc7CgogICAgICAgICMgZ2V0IGN1c3RvbWVyIGRhdGEKICAgICAgICBteSAlQ3VzdG9tZXJMaXN0ID0gJEN1c3RvbWVyQ29tcGFueU9iamVjdC0+Q3VzdG9tZXJDb21wYW55TGlzdCgKICAgICAgICAgICAgU2VhcmNoID0+ICRQYXJhbXtDdXN0b21lclNlYXJjaH0sCiAgICAgICAgICAgIFVzZXJJRCA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgKTsKCiAgICAgICAgIyBnZXQgbmV3IGdyb3VwcwogICAgICAgIGZvciBteSAkQ29udGV4dCAoQENvbnRleHRzKSB7CiAgICAgICAgICAgIG15ICVQZXJtaXNzaW9uczsKICAgICAgICAgICAgZm9yIG15ICRUeXBlICggQHsgJENvbmZpZ09iamVjdC0+R2V0KCdTeXN0ZW06OkN1c3RvbWVyOjpQZXJtaXNzaW9uJykgfSApIHsKICAgICAgICAgICAgICAgIG15IEBJRHMgPSAkUGFyYW1PYmplY3QtPkdldEFycmF5KCBQYXJhbSA9PiAiJHtDb250ZXh0fV8ke1R5cGV9IiApOwogICAgICAgICAgICAgICAgJFBlcm1pc3Npb25zeyRDb250ZXh0fS0+eyRUeXBlfSA9IFxASURzOwogICAgICAgICAgICB9CgogICAgICAgICAgICBteSAlTmV3UGVybWlzc2lvbjsKICAgICAgICAgICAgZm9yIG15ICRDdXN0b21lcklEICggc29ydCBrZXlzICVDdXN0b21lckxpc3QgKSB7CiAgICAgICAgICAgICAgICBmb3IgbXkgJFBlcm1pc3Npb24gKCBzb3J0IGtleXMgJXsgJFBlcm1pc3Npb25zeyRDb250ZXh0fSB9ICkgewogICAgICAgICAgICAgICAgICAgICROZXdQZXJtaXNzaW9ueyRDb250ZXh0fS0+eyRQZXJtaXNzaW9ufSA9IDA7CiAgICAgICAgICAgICAgICAgICAgbXkgQEFycmF5ID0gQHsgJFBlcm1pc3Npb25zeyRDb250ZXh0fS0+eyRQZXJtaXNzaW9ufSB9OwogICAgICAgICAgICAgICAgICAgIGZvciBteSAkSUQgKEBBcnJheSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoICRDdXN0b21lcklEIGVxICRJRCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICROZXdQZXJtaXNzaW9ueyRDb250ZXh0fS0+eyRQZXJtaXNzaW9ufSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJEN1c3RvbWVyR3JvdXBPYmplY3QtPkdyb3VwQ3VzdG9tZXJBZGQoCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJJRCA9PiAkQ3VzdG9tZXJJRCwKICAgICAgICAgICAgICAgICAgICBHSUQgICAgICAgID0+ICRJRCwKICAgICAgICAgICAgICAgICAgICBQZXJtaXNzaW9uID0+IFwlTmV3UGVybWlzc2lvbiwKICAgICAgICAgICAgICAgICAgICBVc2VySUQgICAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgSWYgdGhlIHVzZXIgd291bGQgbGlrZSB0byBjb250aW51ZSBlZGl0aW5nIHRoZSBncm91cCByZWxhdGlvbnMgZm9yIGN1c3RvbWVyCiAgICAgICAgIyAgIGp1c3QgcmVkaXJlY3QgdG8gdGhlIGVkaXQgc2NyZWVuIGFuZCBvdGhlcndpc2UgcmV0dXJuIHRvIHJlbGF0aW9ucyBvdmVydmlldy4KICAgICAgICBpZiAoCiAgICAgICAgICAgIGRlZmluZWQgJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0NvbnRpbnVlQWZ0ZXJTYXZlJyApCiAgICAgICAgICAgICYmICggJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0NvbnRpbnVlQWZ0ZXJTYXZlJyApIGVxICcxJyApCiAgICAgICAgICAgICkKICAgICAgICB7CiAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5SZWRpcmVjdCgKICAgICAgICAgICAgICAgIE9QID0+CiAgICAgICAgICAgICAgICAgICAgIkFjdGlvbj0kU2VsZi0+e0FjdGlvbn07U3ViYWN0aW9uPUdyb3VwO0lEPSRJRDtDdXN0b21lclNlYXJjaD0kUGFyYW17Q3VzdG9tZXJTZWFyY2h9IgogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKCiAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5SZWRpcmVjdCgKICAgICAgICAgICAgICAgIE9QID0+ICJBY3Rpb249JFNlbGYtPntBY3Rpb259O0N1c3RvbWVyU2VhcmNoPSRQYXJhbXtDdXN0b21lclNlYXJjaH0iCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgICMgZ3JvdXBzIHRvIGN1c3RvbWVyCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICBlbHNpZiAoICRTZWxmLT57U3ViYWN0aW9ufSBlcSAnQ2hhbmdlQ3VzdG9tZXInICkgewoKICAgICAgICAjIGNoYWxsZW5nZSB0b2tlbiBjaGVjayBmb3Igd3JpdGUgYWN0aW9uCiAgICAgICAgJExheW91dE9iamVjdC0+Q2hhbGxlbmdlVG9rZW5DaGVjaygpOwoKICAgICAgICBteSAkSUQgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnSUQnICk7CgogICAgICAgICMgZ2V0IGdyb3VwIGRhdGEKICAgICAgICBteSAlR3JvdXBEYXRhID0gJEdyb3VwT2JqZWN0LT5Hcm91cExpc3QoIFZhbGlkID0+IDEgKTsKCiAgICAgICAgIyBnZXQgbmV3IGdyb3VwcwogICAgICAgIGZvciBteSAkQ29udGV4dCAoQENvbnRleHRzKSB7CiAgICAgICAgICAgIG15ICVQZXJtaXNzaW9uczsKICAgICAgICAgICAgZm9yIG15ICRUeXBlICggQHsgJENvbmZpZ09iamVjdC0+R2V0KCdTeXN0ZW06OkN1c3RvbWVyOjpQZXJtaXNzaW9uJykgfSApIHsKICAgICAgICAgICAgICAgIG15IEBJRHMgPSAkUGFyYW1PYmplY3QtPkdldEFycmF5KCBQYXJhbSA9PiAiJHtDb250ZXh0fV8ke1R5cGV9IiApOwogICAgICAgICAgICAgICAgJFBlcm1pc3Npb25zeyRDb250ZXh0fS0+eyRUeXBlfSA9IFxASURzOwogICAgICAgICAgICB9CgogICAgICAgICAgICBteSAlTmV3UGVybWlzc2lvbjsKICAgICAgICAgICAgZm9yIG15ICRHcm91cElEICggc29ydCBrZXlzICVHcm91cERhdGEgKSB7CiAgICAgICAgICAgICAgICBmb3IgbXkgJFBlcm1pc3Npb24gKCBzb3J0IGtleXMgJXsgJFBlcm1pc3Npb25zeyRDb250ZXh0fSB9ICkgewogICAgICAgICAgICAgICAgICAgICROZXdQZXJtaXNzaW9ueyRDb250ZXh0fS0+eyRQZXJtaXNzaW9ufSA9IDA7CiAgICAgICAgICAgICAgICAgICAgbXkgQEFycmF5ID0gQHsgJFBlcm1pc3Npb25zeyRDb250ZXh0fS0+eyRQZXJtaXNzaW9ufSB9OwogICAgICAgICAgICAgICAgICAgIGZvciBteSAkSUQgKEBBcnJheSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoICRHcm91cElEIGVxICRJRCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICROZXdQZXJtaXNzaW9ueyRDb250ZXh0fS0+eyRQZXJtaXNzaW9ufSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJEN1c3RvbWVyR3JvdXBPYmplY3QtPkdyb3VwQ3VzdG9tZXJBZGQoCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJJRCA9PiAkSUQsCiAgICAgICAgICAgICAgICAgICAgR0lEICAgICAgICA9PiAkR3JvdXBJRCwKICAgICAgICAgICAgICAgICAgICBQZXJtaXNzaW9uID0+IFwlTmV3UGVybWlzc2lvbiwKICAgICAgICAgICAgICAgICAgICBVc2VySUQgICAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgSWYgdGhlIHVzZXIgd291bGQgbGlrZSB0byBjb250aW51ZSBlZGl0aW5nIHRoZSBjdXN0b21lciByZWxhdGlvbnMgZm9yIGdyb3VwCiAgICAgICAgIyAgIGp1c3QgcmVkaXJlY3QgdG8gdGhlIGVkaXQgc2NyZWVuIGFuZCBvdGhlcndpc2UgcmV0dXJuIHRvIHJlbGF0aW9ucyBvdmVydmlldy4KICAgICAgICBpZiAoCiAgICAgICAgICAgIGRlZmluZWQgJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0NvbnRpbnVlQWZ0ZXJTYXZlJyApCiAgICAgICAgICAgICYmICggJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0NvbnRpbnVlQWZ0ZXJTYXZlJyApIGVxICcxJyApCiAgICAgICAgICAgICkKICAgICAgICB7CiAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5SZWRpcmVjdCgKICAgICAgICAgICAgICAgIE9QID0+CiAgICAgICAgICAgICAgICAgICAgIkFjdGlvbj0kU2VsZi0+e0FjdGlvbn07U3ViYWN0aW9uPUN1c3RvbWVyO0lEPSRJRDtDdXN0b21lclNlYXJjaD0kUGFyYW17Q3VzdG9tZXJTZWFyY2h9IgogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKCiAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5SZWRpcmVjdCgKICAgICAgICAgICAgICAgIE9QID0+ICJBY3Rpb249JFNlbGYtPntBY3Rpb259O0N1c3RvbWVyU2VhcmNoPSRQYXJhbXtDdXN0b21lclNlYXJjaH0iCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgICMgb3ZlcnZpZXcKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKCiAgICBteSAkT3V0cHV0ID0gJExheW91dE9iamVjdC0+SGVhZGVyKCk7CiAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk5hdmlnYXRpb25CYXIoKTsKCiAgICAjIHNlYXJjaCBjdXN0b21lcnMKICAgIG15ICVDdXN0b21lckxpc3QgPSAkQ3VzdG9tZXJDb21wYW55T2JqZWN0LT5DdXN0b21lckNvbXBhbnlMaXN0KAogICAgICAgIFNlYXJjaCA9PiAkUGFyYW17Q3VzdG9tZXJTZWFyY2h9LAogICAgICAgIFVzZXJJRCA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICApOwogICAgbXkgQEN1c3RvbWVyS2V5TGlzdCA9IHNvcnQga2V5cyAlQ3VzdG9tZXJMaXN0OwoKICAgICMgY291bnQgcmVzdWx0cwogICAgbXkgJEN1c3RvbWVyQ291bnQgPSBAQ3VzdG9tZXJLZXlMaXN0OwoKICAgICMgc2V0IG1heCBjb3VudAogICAgbXkgJE1heEN1c3RvbWVyQ291bnQgPSAkQ3VzdG9tZXJDb3VudDsKCiAgICBpZiAoICRNYXhDdXN0b21lckNvdW50ID4gJFNlYXJjaExpbWl0ICkgewogICAgICAgICRNYXhDdXN0b21lckNvdW50ID0gJFNlYXJjaExpbWl0OwogICAgfQoKICAgICMgb3V0cHV0IHJvd3MKICAgIG15ICVDdXN0b21lckRhdGE7CiAgICBmb3IgbXkgJENvdW50ZXIgKCAxIC4uICRNYXhDdXN0b21lckNvdW50ICkgewogICAgICAgICRDdXN0b21lckRhdGF7ICRDdXN0b21lcktleUxpc3RbICRDb3VudGVyIC0gMSBdIH0gPSAkQ3VzdG9tZXJMaXN0eyAkQ3VzdG9tZXJLZXlMaXN0WyAkQ291bnRlciAtIDEgXSB9OwogICAgfQoKICAgICMgZ2V0IGdyb3VwIGRhdGEKICAgIG15ICVHcm91cERhdGEgPSAkR3JvdXBPYmplY3QtPkdyb3VwTGlzdCggVmFsaWQgPT4gMSApOwoKICAgICRPdXRwdXQgLj0gJFNlbGYtPl9PdmVydmlldygKICAgICAgICBDdXN0b21lckNvdW50ICAgPT4gJEN1c3RvbWVyQ291bnQsCiAgICAgICAgQ3VzdG9tZXJLZXlMaXN0ID0+IFxAQ3VzdG9tZXJLZXlMaXN0LAogICAgICAgIEN1c3RvbWVyRGF0YSAgICA9PiBcJUN1c3RvbWVyRGF0YSwKICAgICAgICBHcm91cERhdGEgICAgICAgPT4gXCVHcm91cERhdGEsCiAgICAgICAgU2VhcmNoTGltaXQgICAgID0+ICRTZWFyY2hMaW1pdCwKICAgICAgICBDdXN0b21lclNlYXJjaCAgPT4gJFBhcmFte0N1c3RvbWVyU2VhcmNofSwKICAgICk7CgogICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5Gb290ZXIoKTsKICAgIHJldHVybiAkT3V0cHV0Owp9CgpzdWIgX0NoYW5nZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CiAgICBteSAkQ29uZmlnT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKTsKCiAgICBteSAlRGF0YSAgICAgICAgPSAleyAkUGFyYW17RGF0YX0gfTsKICAgIG15ICRUeXBlICAgICAgICA9ICRQYXJhbXtUeXBlfSB8fCAnQ3VzdG9tZXInOwogICAgbXkgJE5lVHlwZSAgICAgID0gJFR5cGUgZXEgJ0dyb3VwJyA/ICdDdXN0b21lcicgOiAnR3JvdXAnOwogICAgbXkgJVZpc2libGVUeXBlID0gKAogICAgICAgIEN1c3RvbWVyID0+ICdDdXN0b21lcicsCiAgICAgICAgR3JvdXAgICAgPT4gJ0dyb3VwJywKICAgICk7CiAgICBteSAkU2VhcmNoTGltaXQgICA9ICRQYXJhbXtTZWFyY2hMaW1pdH07CiAgICBteSAlQ29udGV4dExvb2t1cCA9ICV7ICRQYXJhbXtDb250ZXh0TG9va3VwfSB9OwogICAgbXkgQENvbnRleHRzICAgICAgPSBAeyAkUGFyYW17Q29udGV4dHN9IH07CgogICAgbXkgQEl0ZW1MaXN0ID0gKCk7CgogICAgaWYgKCAkVmlzaWJsZVR5cGV7JE5lVHlwZX0gZXEgJ0N1c3RvbWVyJyApIHsKICAgICAgICAkUGFyYW17QnJlYWRjcnVtYlRpdGxlfSA9ICJDaGFuZ2UgQ3VzdG9tZXIgUmVsYXRpb25zIGZvciBHcm91cCI7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkUGFyYW17QnJlYWRjcnVtYlRpdGxlfSA9ICJDaGFuZ2UgR3JvdXAgUmVsYXRpb25zIGZvciBDdXN0b21lciI7CiAgICB9CgogICAgIyBvdmVydmlldwogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnT3ZlcnZpZXcnLAogICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgIE92ZXJ2aWV3TGluayA9PiAkU2VsZi0+e0FjdGlvbn0gLiAnO0N1c3RvbWVyU2VhcmNoPScgLiAkUGFyYW17Q3VzdG9tZXJTZWFyY2h9LAogICAgICAgIH0sCiAgICApOwogICAgJExheW91dE9iamVjdC0+QmxvY2soIE5hbWUgPT4gJ0FjdGlvbkxpc3QnICk7CiAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICBOYW1lID0+ICdBY3Rpb25PdmVydmlldycsCiAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgIEN1c3RvbWVyU2VhcmNoID0+ICRQYXJhbXtDdXN0b21lclNlYXJjaH0sCiAgICAgICAgfSwKICAgICk7CgogICAgaWYgKCAkTmVUeXBlIGVxICdDdXN0b21lcicgKSB7CiAgICAgICAgQEl0ZW1MaXN0ID0gQHsgJFBhcmFte0l0ZW1MaXN0fSB9OwoKICAgICAgICAjIG91dHB1dCBzZWFyY2ggYmxvY2sKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnU2VhcmNoJywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICBDdXN0b21lclNlYXJjaCA9PiAkUGFyYW17Q3VzdG9tZXJTZWFyY2h9LAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ1NlYXJjaENoYW5nZUdyb3VwJywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICBTdWJhY3Rpb24gPT4gJFBhcmFte1N1YmFjdGlvbn0sCiAgICAgICAgICAgICAgICBHcm91cElEICAgPT4gJFBhcmFte0lEfSwKICAgICAgICAgICAgfSwKICAgICAgICApOwogICAgfQogICAgZWxzZSB7CgogICAgICAgICMgb3V0cHV0IGNvbmZpZyBzaG9ydGN1dCB0byBDdXN0b21lckFsd2F5c0dyb3VwcwogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKCBOYW1lID0+ICdBbHdheXNHcm91cHNDb25maWcnICk7CgogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKCBOYW1lID0+ICdGaWx0ZXInICk7CiAgICB9CgogICAgJExheW91dE9iamVjdC0+QmxvY2soIE5hbWUgPT4gJ05vdGUnICk7CgogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnQ2hhbmdlJywKICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICBBY3Rpb25Ib21lICAgID0+ICdBZG1pbicgLiAoICRUeXBlIGVxICdDdXN0b21lcicgPyAnQ3VzdG9tZXJDb21wYW55JyA6ICRUeXBlICksCiAgICAgICAgICAgIFZpc2libGVOZVR5cGUgPT4gJFZpc2libGVUeXBleyROZVR5cGV9LAogICAgICAgICAgICBWaXNpYmxlVHlwZSAgID0+ICRWaXNpYmxlVHlwZXskVHlwZX0sCiAgICAgICAgfSwKICAgICk7CgogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnQ2hhbmdlSGVhZGluZycgLiAkTmVUeXBlLAogICAgKTsKCiAgICBteSBAR3JvdXBQZXJtaXNzaW9uczsKCiAgICBmb3IgbXkgJENvbnRleHQgKEBDb250ZXh0cykgewoKICAgICAgICBUWVBFOgogICAgICAgIG15ICRUeXBlQ291bnQgPSAwOwogICAgICAgIGZvciBteSAkVHlwZSAoIEB7ICRDb25maWdPYmplY3QtPkdldCgnU3lzdGVtOjpDdXN0b21lcjo6UGVybWlzc2lvbicpIH0gKSB7CiAgICAgICAgICAgIG5leHQgVFlQRSBpZiAhJFR5cGU7CiAgICAgICAgICAgIG15ICRNYXJrID0gJFR5cGUgZXEgJ3J3JyA/ICJIaWdobGlnaHQiIDogJyc7CgogICAgICAgICAgICBwdXNoIEBHcm91cFBlcm1pc3Npb25zLCAiJHtDb250ZXh0fV8ke1R5cGV9IjsKICAgICAgICAgICAgJFR5cGVDb3VudCsrOwoKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdDaGFuZ2VIZWFkZXInLAogICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgJXsgJFBhcmFteyRDb250ZXh0fSB9LAogICAgICAgICAgICAgICAgICAgIENvbnRleHQgPT4gJENvbnRleHQsCiAgICAgICAgICAgICAgICAgICAgTWFyayAgICA9PiAkTWFyaywKICAgICAgICAgICAgICAgICAgICBUeXBlICAgID0+ICRUeXBlLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdDaGFuZ2VIZWFkZXJDb250ZXh0TmFtZScsCiAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgJXsgJFBhcmFteyRDb250ZXh0fSB9LAogICAgICAgICAgICAgICAgQ291bnQgPT4gJFR5cGVDb3VudCwKICAgICAgICAgICAgICAgIE5hbWUgID0+ICRDb250ZXh0TG9va3VweyRDb250ZXh0fS0+e05hbWV9LAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICB9CgogICAgIyBzZXQgZ3JvdXAgcGVybWlzc2lvbnMKICAgICRMYXlvdXRPYmplY3QtPkFkZEpTRGF0YSgKICAgICAgICBLZXkgICA9PiAnUmVsYXRpb25JdGVtcycsCiAgICAgICAgVmFsdWUgPT4gXEBHcm91cFBlcm1pc3Npb25zLAogICAgKTsKCiAgICAjIGNoZWNrIGlmIHRoZXJlIGFyZSBncm91cHMvY3VzdG9tZXJzCiAgICBpZiAoICElRGF0YSApIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnTm9EYXRhRm91bmRNc2dMaXN0JywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBDb2xTcGFuID0+IDMsCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKICAgIH0KCiAgICBpZiAoICROZVR5cGUgZXEgJ0N1c3RvbWVyJyApIHsKCiAgICAgICAgIyBvdXRwdXQgY291bnQgYmxvY2sKICAgICAgICBpZiAoICFASXRlbUxpc3QgKSB7CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgTmFtZSA9PiAnQ2hhbmdlSXRlbUNvdW50TGltaXQnLAogICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgSXRlbUNvdW50ID0+IDAsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICApOwoKICAgICAgICB9CiAgICAgICAgZWxzaWYgKCBASXRlbUxpc3QgPiAkU2VhcmNoTGltaXQgKSB7CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgTmFtZSA9PiAnQ2hhbmdlSXRlbUNvdW50TGltaXQnLAogICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgSXRlbUNvdW50ID0+ICI+IiAuICRTZWFyY2hMaW1pdCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ0NoYW5nZUl0ZW1Db3VudCcsCiAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICBJdGVtQ291bnQgPT4gc2NhbGFyIEBJdGVtTGlzdCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgIG15IEBDdXN0b21lckFsd2F5c0dyb3VwcyA9IEB7ICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXJHcm91cENvbXBhbnlBbHdheXNHcm91cHMnKSB9OwoKICAgIERBVEFJVEVNOgogICAgZm9yIG15ICRJRCAoIHNvcnQgeyB1YyggJERhdGF7JGF9ICkgY21wIHVjKCAkRGF0YXskYn0gKSB9IGtleXMgJURhdGEgKSB7CgogICAgICAgIG5leHQgREFUQUlURU0gaWYgKCBncmVwIHttL1xRJFBhcmFte0RhdGF9LT57JElEfVxFL30gQEN1c3RvbWVyQWx3YXlzR3JvdXBzICk7CgogICAgICAgICMgc2V0IG91dHB1dCBjbGFzcwogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdDaGFuZ2VSb3cnLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgIEFjdGlvbkhvbWUgPT4gJ0FkbWluJyAuICggJE5lVHlwZSBlcSAnQ3VzdG9tZXInID8gJ0N1c3RvbWVyQ29tcGFueScgOiAkTmVUeXBlICksCiAgICAgICAgICAgICAgICBOYW1lICAgICAgID0+ICRQYXJhbXtEYXRhfS0+eyRJRH0sCiAgICAgICAgICAgICAgICBJRCAgICAgICAgID0+ICRJRCwKICAgICAgICAgICAgICAgIE5lVHlwZSAgICAgPT4gJE5lVHlwZSwKICAgICAgICAgICAgfSwKICAgICAgICApOwoKICAgICAgICBmb3IgbXkgJENvbnRleHQgKEBDb250ZXh0cykgewoKICAgICAgICAgICAgVFlQRToKICAgICAgICAgICAgZm9yIG15ICRUeXBlICggQHsgJENvbmZpZ09iamVjdC0+R2V0KCdTeXN0ZW06OkN1c3RvbWVyOjpQZXJtaXNzaW9uJykgfSApIHsKICAgICAgICAgICAgICAgIG5leHQgVFlQRSBpZiAhJFR5cGU7CiAgICAgICAgICAgICAgICBteSAkTWFyayAgICAgPSAkVHlwZSBlcSAncncnICAgICAgICAgICAgICAgICAgICA/ICJIaWdobGlnaHQiICAgICAgICAgIDogJyc7CiAgICAgICAgICAgICAgICBteSAkU2VsZWN0ZWQgPSAkUGFyYW17JENvbnRleHR9LT57JFR5cGV9LT57JElEfSA/ICcgY2hlY2tlZD0iY2hlY2tlZCInIDogJyc7CiAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICdDaGFuZ2VSb3dJdGVtJywKICAgICAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgJXsgJFBhcmFteyRDb250ZXh0fSB9LAogICAgICAgICAgICAgICAgICAgICAgICBNYXJrICAgICA9PiAkTWFyaywKICAgICAgICAgICAgICAgICAgICAgICAgVHlwZSAgICAgPT4gJFR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgIENvbnRleHQgID0+ICRDb250ZXh0LAogICAgICAgICAgICAgICAgICAgICAgICBJRCAgICAgICA9PiAkSUQsCiAgICAgICAgICAgICAgICAgICAgICAgIFNlbGVjdGVkID0+ICRTZWxlY3RlZCwKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSAgICAgPT4gJFBhcmFte0RhdGF9LT57JElEfSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBpZiAoICRUeXBlIGVxICdDdXN0b21lcicgKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soIE5hbWUgPT4gJ0Fsd2F5c0dyb3VwcycgKTsKCiAgICAgICAgZm9yIG15ICRJRCAoIDEgLi4gQEN1c3RvbWVyQWx3YXlzR3JvdXBzICkgewogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ0Fsd2F5c0dyb3Vwc0xpc3QnLAogICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAkQ3VzdG9tZXJBbHdheXNHcm91cHNbICRJRCAtIDEgXSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgIE5hbWUgPT4gJ1JlZmVyZW5jZScsCiAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgIENvbnRleHRzICAgICAgPT4gXEBDb250ZXh0cywKICAgICAgICAgICAgQ29udGV4dExvb2t1cCA9PiBcJUNvbnRleHRMb29rdXAsCiAgICAgICAgfSwKICAgICk7CgogICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPk91dHB1dCgKICAgICAgICBUZW1wbGF0ZUZpbGUgPT4gJ0FkbWluQ3VzdG9tZXJHcm91cCcsCiAgICAgICAgRGF0YSAgICAgICAgID0+IFwlUGFyYW0sCiAgICApOwp9CgpzdWIgX092ZXJ2aWV3IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKICAgIG15ICRDb25maWdPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpOwoKICAgIG15ICRDdXN0b21lckNvdW50ICAgPSAkUGFyYW17Q3VzdG9tZXJDb3VudH07CiAgICBteSBAQ3VzdG9tZXJLZXlMaXN0ID0gQHsgJFBhcmFte0N1c3RvbWVyS2V5TGlzdH0gfTsKICAgIG15ICVDdXN0b21lckRhdGEgICAgPSAleyAkUGFyYW17Q3VzdG9tZXJEYXRhfSB9OwogICAgbXkgJUdyb3VwRGF0YSAgICAgICA9ICV7ICRQYXJhbXtHcm91cERhdGF9IH07CiAgICBteSAkU2VhcmNoTGltaXQgICAgID0gJFBhcmFte1NlYXJjaExpbWl0fTsKCiAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICBOYW1lID0+ICdPdmVydmlldycsCiAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgIE92ZXJ2aWV3TGluayA9PiAkU2VsZi0+e0FjdGlvbn0gLiAnO0N1c3RvbWVyU2VhcmNoPScgLiAkUGFyYW17Q3VzdG9tZXJTZWFyY2h9LAogICAgICAgIH0sCiAgICApOwoKICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKCBOYW1lID0+ICdBY3Rpb25MaXN0JyApOwoKICAgICMgb3V0cHV0IHNlYXJjaCBibG9jawogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnU2VhcmNoJywKICAgICAgICBEYXRhID0+IFwlUGFyYW0sCiAgICApOwoKICAgICMgT3V0cHV0IGNvbmZpZyBzaHV0Y3V0IHRvIEN1c3RvbWVyQWx3YXlzR3JvdXBzCiAgICAkTGF5b3V0T2JqZWN0LT5CbG9jayggTmFtZSA9PiAnQWx3YXlzR3JvdXBzQ29uZmlnJyApOwoKICAgICMgb3V0cHV0IGZpbHRlciBhbmQgZGVmYXVsdCBibG9jawogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnRmlsdGVyJywKICAgICk7CgogICAgIyBvdXRwdXQgcmVzdWx0IGJsb2NrCiAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICBOYW1lID0+ICdSZXN1bHQnLAogICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgfSwKICAgICk7CgogICAgIyBvdXRwdXQgY3VzdG9tZXIgdXNlciBjb3VudCBibG9jawogICAgaWYgKCAhQEN1c3RvbWVyS2V5TGlzdCApIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnUmVzdWx0Q3VzdG9tZXJDb3VudExpbWl0JywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBDdXN0b21lckNvdW50ID0+IDAsCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnTm9EYXRhRm91bmRNc2dDdXN0b21lcicsCiAgICAgICAgKTsKICAgIH0KICAgIGVsc2lmICggQEN1c3RvbWVyS2V5TGlzdCA+ICRTZWFyY2hMaW1pdCApIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnUmVzdWx0Q3VzdG9tZXJDb3VudExpbWl0JywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBDdXN0b21lckNvdW50ID0+ICI+IiAuICRTZWFyY2hMaW1pdCwKICAgICAgICAgICAgfSwKICAgICAgICApOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ1Jlc3VsdEN1c3RvbWVyQ291bnQnLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgIEN1c3RvbWVyQ291bnQgPT4gc2NhbGFyIEBDdXN0b21lcktleUxpc3QsCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKICAgIH0KCiAgICBmb3IgbXkgJElEICgKICAgICAgICBzb3J0IHsgdWMoICRDdXN0b21lckRhdGF7JGF9ICkgY21wIHVjKCAkQ3VzdG9tZXJEYXRheyRifSApIH0KICAgICAgICBrZXlzICVDdXN0b21lckRhdGEKICAgICAgICApCiAgICB7CgogICAgICAgICMgb3V0cHV0IHVzZXIgcm93IGJsb2NrCiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ0xpc3QxbicsCiAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgSUQgICAgICAgID0+ICRJRCwKICAgICAgICAgICAgICAgIE5hbWUgICAgICA9PiAkQ3VzdG9tZXJEYXRheyRJRH0sCiAgICAgICAgICAgICAgICBTdWJhY3Rpb24gPT4gJ0N1c3RvbWVyJywKICAgICAgICAgICAgfSwKICAgICAgICApOwogICAgfQoKICAgIG15IEBDdXN0b21lckFsd2F5c0dyb3VwcyA9IEB7ICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXJHcm91cENvbXBhbnlBbHdheXNHcm91cHMnKSB9OwoKICAgIGlmICglR3JvdXBEYXRhKSB7CiAgICAgICAgR1JPVVA6CiAgICAgICAgZm9yIG15ICRJRCAoCiAgICAgICAgICAgIHNvcnQgeyB1YyggJEdyb3VwRGF0YXskYX0gKSBjbXAgdWMoICRHcm91cERhdGF7JGJ9ICkgfQogICAgICAgICAgICBrZXlzICVHcm91cERhdGEKICAgICAgICAgICAgKQogICAgICAgIHsKICAgICAgICAgICAgbmV4dCBHUk9VUCBpZiAoIGdyZXAge20vXFEkR3JvdXBEYXRheyRJRH1cRS99IEBDdXN0b21lckFsd2F5c0dyb3VwcyApOwoKICAgICAgICAgICAgIyBvdXRwdXQgZ29ydXAgYmxvY2sKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdMaXN0bjEnLAogICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgICAgIElEICAgICAgICA9PiAkSUQsCiAgICAgICAgICAgICAgICAgICAgTmFtZSAgICAgID0+ICRHcm91cERhdGF7JElEfSwKICAgICAgICAgICAgICAgICAgICBTdWJhY3Rpb24gPT4gJ0dyb3VwJywKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQogICAgZWxzZSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ05vRGF0YUZvdW5kTXNnR3JvdXAnLAogICAgICAgICAgICBEYXRhID0+IHt9LAogICAgICAgICk7CiAgICB9CgogICAgJExheW91dE9iamVjdC0+QmxvY2soIE5hbWUgPT4gJ0Fsd2F5c0dyb3VwcycgKTsKCiAgICBmb3IgbXkgJElEICggMSAuLiBAQ3VzdG9tZXJBbHdheXNHcm91cHMgKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ0Fsd2F5c0dyb3Vwc0xpc3QnLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgIE5hbWUgPT4gJEN1c3RvbWVyQWx3YXlzR3JvdXBzWyAkSUQgLSAxIF0sCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIHJldHVybiBvdXRwdXQKICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5PdXRwdXQoCiAgICAgICAgVGVtcGxhdGVGaWxlID0+ICdBZG1pbkN1c3RvbWVyR3JvdXAnLAogICAgICAgIERhdGEgICAgICAgICA9PiBcJVBhcmFtLAogICAgKTsKCn0KCnN1YiBfRGlzYWJsZWQgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwoKICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgIE5hbWUgPT4gJ092ZXJ2aWV3JywKICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgT3ZlcnZpZXdMaW5rID0+ICRTZWxmLT57QWN0aW9ufSwKICAgICAgICB9LAogICAgKTsKCiAgICAkTGF5b3V0T2JqZWN0LT5CbG9jayggTmFtZSA9PiAnRGlzYWJsZWQnICk7CgogICAgIyByZXR1cm4gb3V0cHV0CiAgICByZXR1cm4gJExheW91dE9iamVjdC0+T3V0cHV0KAogICAgICAgIFRlbXBsYXRlRmlsZSA9PiAnQWRtaW5DdXN0b21lckdyb3VwJywKICAgICAgICBEYXRhICAgICAgICAgPT4gXCVQYXJhbSwKICAgICk7Cn0KCjE7Cg==</File>
        <File Location="Custom/Kernel/Modules/AdminCustomerUserCustomer.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxLTIwMjIgWm51bnkgR21iSCwgaHR0cHM6Ly96bnVueS5vcmcvCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6TW9kdWxlczo6QWRtaW5DdXN0b21lclVzZXJDdXN0b21lcjsKCnVzZSBzdHJpY3Q7CnVzZSB3YXJuaW5nczsKCm91ciAkT2JqZWN0TWFuYWdlckRpc2FibGVkID0gMTsKCnN1YiBuZXcgewogICAgbXkgKCAkVHlwZSwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGFsbG9jYXRlIG5ldyBoYXNoIGZvciBvYmplY3QKICAgIG15ICRTZWxmID0geyVQYXJhbX07CiAgICBibGVzcyggJFNlbGYsICRUeXBlICk7CgogICAgcmV0dXJuICRTZWxmOwp9CgpzdWIgUnVuIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJExheW91dE9iamVjdCAgICAgICAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKICAgIG15ICRQYXJhbU9iamVjdCAgICAgICAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6V2ViOjpSZXF1ZXN0Jyk7CiAgICBteSAkQ3VzdG9tZXJVc2VyT2JqZWN0ICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyVXNlcicpOwogICAgbXkgJEN1c3RvbWVyQ29tcGFueU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDdXN0b21lckNvbXBhbnknKTsKCiAgICAjIHNldCBzZWFyY2ggbGltaXQKICAgIG15ICRTZWFyY2hMaW1pdCA9IDIwMDsKCiAgICAkUGFyYW17U2VhcmNofSA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdTZWFyY2gnICkgfHwgJyonOwoKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgICMgdXNlciA8LT4gY3VzdG9tZXIgMTpuCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICBpZiAoICRTZWxmLT57U3ViYWN0aW9ufSBlcSAnQ3VzdG9tZXJVc2VyJyApIHsKCiAgICAgICAgIyBnZXQgcGFyYW1zCiAgICAgICAgJFBhcmFte1N1YmFjdGlvbn0gPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnU3ViYWN0aW9uJyApOwoKICAgICAgICAjIGdldCB1c2VyIGRhdGEKICAgICAgICBteSAkSUQgICAgICAgICAgID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0lEJyApOwogICAgICAgIG15ICVVc2VyRGF0YSAgICAgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJEYXRhR2V0KCBVc2VyID0+ICRJRCApOwogICAgICAgIG15ICRDdXN0b21lck5hbWUgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lck5hbWUoIFVzZXJMb2dpbiA9PiAkVXNlckRhdGF7VXNlckxvZ2lufSApOwoKICAgICAgICAjIHNlYXJjaCBjdXN0b21lcnMKICAgICAgICBteSAlQ3VzdG9tZXJMaXN0ID0gJEN1c3RvbWVyQ29tcGFueU9iamVjdC0+Q3VzdG9tZXJDb21wYW55TGlzdCgKICAgICAgICAgICAgU2VhcmNoID0+ICRQYXJhbXtTZWFyY2h9LAogICAgICAgICAgICBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICk7CiAgICAgICAgbXkgQEN1c3RvbWVyS2V5TGlzdCA9IHNvcnQga2V5cyAlQ3VzdG9tZXJMaXN0OwoKICAgICAgICAjIG91dHB1dCByb3dzCiAgICAgICAgbXkgJEl0ZW1zU2hvd24gPSAwOwogICAgICAgIG15ICVDdXN0b21lckRhdGE7CiAgICAgICAgQ1VTVE9NRVI6CiAgICAgICAgZm9yIG15ICRDdXN0b21lciAoQEN1c3RvbWVyS2V5TGlzdCkgewoKICAgICAgICAgICAgIyBleGNsdWRlIGN1c3RvbWVyICg9IHByaW1hcnkgQ3VzdG9tZXJJRCkgb2Ygc2VsZWN0ZWQgY3VzdG9tZXIgdXNlcgogICAgICAgICAgICBuZXh0IENVU1RPTUVSIGlmICRVc2VyRGF0YXtVc2VyQ3VzdG9tZXJJRH0gZXEgJEN1c3RvbWVyOwoKICAgICAgICAgICAgIyBjaGVjayBhbmQgcmVtZW1iZXIgaWYgd2UgaGF2ZSBtb3JlIHJlc3VsdHMgdGhhbiBzaG93bgogICAgICAgICAgICArKyRJdGVtc1Nob3duOwogICAgICAgICAgICBpZiAoICRJdGVtc1Nob3duID4gJFNlYXJjaExpbWl0ICkgewogICAgICAgICAgICAgICAgbGFzdCBDVVNUT01FUjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJEN1c3RvbWVyRGF0YXskQ3VzdG9tZXJ9ID0gJEN1c3RvbWVyTGlzdHskQ3VzdG9tZXJ9OwogICAgICAgIH0KCiAgICAgICAgIyBnZXQgbWVtYmVyIGxpc3QKICAgICAgICBteSBATWVtYmVyQ3VzdG9tZXJJRHMgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJDdXN0b21lck1lbWJlckxpc3QoCiAgICAgICAgICAgIEN1c3RvbWVyVXNlcklEID0+ICRJRCwKICAgICAgICApOwogICAgICAgIG15ICVNZW1iZXJDdXN0b21lcklEcyA9IG1hcCB7ICRfID0+IDEgfSBATWVtYmVyQ3VzdG9tZXJJRHM7CgogICAgICAgIG15ICRPdXRwdXQgPSAkTGF5b3V0T2JqZWN0LT5IZWFkZXIoKTsKICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk5hdmlnYXRpb25CYXIoKTsKICAgICAgICAkT3V0cHV0IC49ICRTZWxmLT5fQ2hhbmdlKAogICAgICAgICAgICBTZWxlY3RlZCAgICA9PiBcJU1lbWJlckN1c3RvbWVySURzLAogICAgICAgICAgICBEYXRhICAgICAgICA9PiBcJUN1c3RvbWVyRGF0YSwKICAgICAgICAgICAgSUQgICAgICAgICAgPT4gJFVzZXJEYXRhe1VzZXJJRH0sCiAgICAgICAgICAgIE5hbWUgICAgICAgID0+ICIkQ3VzdG9tZXJOYW1lICgkVXNlckRhdGF7VXNlckxvZ2lufSkiLAogICAgICAgICAgICBUeXBlICAgICAgICA9PiAnQ3VzdG9tZXJVc2VyJywKICAgICAgICAgICAgU2VhcmNoTGltaXQgPT4gJFNlYXJjaExpbWl0LAogICAgICAgICAgICBJdGVtc1Nob3duICA9PiAkSXRlbXNTaG93biwKICAgICAgICAgICAgU2VhcmNoICAgICAgPT4gJFBhcmFte1NlYXJjaH0sCiAgICAgICAgICAgICVQYXJhbSwKICAgICAgICApOwogICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Rm9vdGVyKCk7CgogICAgICAgIHJldHVybiAkT3V0cHV0OwogICAgfQoKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgICMgY3VzdG9tZXIgPC0+IHVzZXIgbjoxCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICBlbHNpZiAoICRTZWxmLT57U3ViYWN0aW9ufSBlcSAnQ3VzdG9tZXInICkgewoKICAgICAgICAjIGdldCBwYXJhbXMKICAgICAgICAkUGFyYW17U3ViYWN0aW9ufSA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdTdWJhY3Rpb24nICk7CgogICAgICAgICMgZ2V0IGN1c3RvbWVyIGRhdGEKICAgICAgICBteSAkSUQgICAgICAgICAgICAgICAgICA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdJRCcgKTsKICAgICAgICBteSAlQ3VzdG9tZXJDb21wYW55ICAgICA9ICRDdXN0b21lckNvbXBhbnlPYmplY3QtPkN1c3RvbWVyQ29tcGFueUdldCggQ3VzdG9tZXJJRCA9PiAkSUQgKTsKICAgICAgICBteSAkQ3VzdG9tZXJDb21wYW55TmFtZSA9ICRDdXN0b21lckNvbXBhbnl7Q3VzdG9tZXJDb21wYW55TmFtZX07CgogICAgICAgICMgc2VhcmNoIGN1c3RvbWVyIHVzZXIKICAgICAgICBteSAlQ3VzdG9tZXJVc2VyTGlzdCA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyU2VhcmNoKAogICAgICAgICAgICBTZWFyY2ggPT4gJFBhcmFte1NlYXJjaH0sCiAgICAgICAgICAgIFVzZXJJRCA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgKTsKICAgICAgICBteSBAQ3VzdG9tZXJVc2VyS2V5TGlzdCA9IHNvcnQgeyAkQ3VzdG9tZXJVc2VyTGlzdHskYX0gY21wICRDdXN0b21lclVzZXJMaXN0eyRifSB9IGtleXMgJUN1c3RvbWVyVXNlckxpc3Q7CgogICAgICAgICMgb3V0cHV0IHJvd3MKICAgICAgICBteSAkSXRlbXNTaG93biA9IDA7CiAgICAgICAgbXkgJUN1c3RvbWVyVXNlckRhdGE7CiAgICAgICAgQ1VTVE9NRVJVU0VSOgogICAgICAgIGZvciBteSAkQ3VzdG9tZXJVc2VyIChAQ3VzdG9tZXJVc2VyS2V5TGlzdCkgewoKICAgICAgICAgICAgIyBnZXQgY3VzdG9tZXIgdXNlcgogICAgICAgICAgICBteSAlVXNlciA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyVXNlckRhdGFHZXQoCiAgICAgICAgICAgICAgICBVc2VyID0+ICRDdXN0b21lclVzZXIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIG5leHQgQ1VTVE9NRVJVU0VSIGlmICElVXNlcjsKCiAgICAgICAgICAgICMgZXhjbHVkZSBjdXN0b21lciB1c2VycyB3aGVyZSBjdXN0b21lciAoPSBwcmltYXJ5IEN1c3RvbWVySUQpCiAgICAgICAgICAgICMgICBlcXVhbHMgc2VsZWN0ZWQgY3VzdG9tZXIKICAgICAgICAgICAgbmV4dCBDVVNUT01FUlVTRVIgaWYgJFVzZXJ7VXNlckN1c3RvbWVySUR9IGVxICRJRDsKCiAgICAgICAgICAgICMgY2hlY2sgaWYgd2UgaGF2ZSBtb3JlIHJlc3VsdHMgdGhhbiBzaG93bgogICAgICAgICAgICArKyRJdGVtc1Nob3duOwogICAgICAgICAgICBpZiAoICRJdGVtc1Nob3duID4gJFNlYXJjaExpbWl0ICkgewogICAgICAgICAgICAgICAgbGFzdCBDVVNUT01FUlVTRVI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG15ICRVc2VyTmFtZSA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyTmFtZSgKICAgICAgICAgICAgICAgIFVzZXJMb2dpbiA9PiAkQ3VzdG9tZXJVc2VyLAogICAgICAgICAgICApOwogICAgICAgICAgICAkQ3VzdG9tZXJVc2VyRGF0YXsgJFVzZXJ7VXNlcklEfSB9ID0KICAgICAgICAgICAgICAgICIkVXNlck5hbWUgPCRVc2Vye1VzZXJFbWFpbH0+ICgkVXNlcntVc2VyQ3VzdG9tZXJJRH0pIjsKICAgICAgICB9CgogICAgICAgICMgZ2V0IG1lbWJlciBsaXN0CiAgICAgICAgbXkgQEN1c3RvbWVyVXNlcnMgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJDdXN0b21lck1lbWJlckxpc3QoCiAgICAgICAgICAgIEN1c3RvbWVySUQgPT4gJElELAogICAgICAgICk7CiAgICAgICAgbXkgJU1lbWJlckN1c3RvbWVyVXNlcnMgPSBtYXAgeyAkXyA9PiAxIH0gQEN1c3RvbWVyVXNlcnM7CgogICAgICAgIG15ICRPdXRwdXQgPSAkTGF5b3V0T2JqZWN0LT5IZWFkZXIoKTsKICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk5hdmlnYXRpb25CYXIoKTsKICAgICAgICAkT3V0cHV0IC49ICRTZWxmLT5fQ2hhbmdlKAogICAgICAgICAgICBTZWxlY3RlZCAgICA9PiBcJU1lbWJlckN1c3RvbWVyVXNlcnMsCiAgICAgICAgICAgIERhdGEgICAgICAgID0+IFwlQ3VzdG9tZXJVc2VyRGF0YSwKICAgICAgICAgICAgSUQgICAgICAgICAgPT4gJElELAogICAgICAgICAgICBOYW1lICAgICAgICA9PiAkQ3VzdG9tZXJDb21wYW55TmFtZSwKICAgICAgICAgICAgVHlwZSAgICAgICAgPT4gJ0N1c3RvbWVyJywKICAgICAgICAgICAgU2VhcmNoTGltaXQgPT4gJFNlYXJjaExpbWl0LAogICAgICAgICAgICBJdGVtc1Nob3duICA9PiAkSXRlbXNTaG93biwKICAgICAgICAgICAgU2VhcmNoICAgICAgPT4gJFBhcmFte1NlYXJjaH0sCiAgICAgICAgICAgICVQYXJhbSwKICAgICAgICApOwogICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Rm9vdGVyKCk7CiAgICAgICAgcmV0dXJuICRPdXRwdXQ7CiAgICB9CgogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gIwogICAgIyBhZGQgdXNlciB0byBncm91cHMKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgIGVsc2lmICggJFNlbGYtPntTdWJhY3Rpb259IGVxICdDaGFuZ2VDdXN0b21lcicgKSB7CgogICAgICAgICMgY2hhbGxlbmdlIHRva2VuIGNoZWNrIGZvciB3cml0ZSBhY3Rpb24KICAgICAgICAkTGF5b3V0T2JqZWN0LT5DaGFsbGVuZ2VUb2tlbkNoZWNrKCk7CgogICAgICAgICMgZ2V0IG5ldyBjdXN0b21lciB1c2VycwogICAgICAgIG15IEBDdXN0b21lclVzZXJzU2VsZWN0ZWQgPSAkUGFyYW1PYmplY3QtPkdldEFycmF5KCBQYXJhbSA9PiAnSXRlbXNTZWxlY3RlZCcgKTsKICAgICAgICBteSBAQ3VzdG9tZXJVc2Vyc0FsbCAgICAgID0gJFBhcmFtT2JqZWN0LT5HZXRBcnJheSggUGFyYW0gPT4gJ0l0ZW1zQWxsJyApOwoKICAgICAgICBteSAkQ3VzdG9tZXJJRCA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdJRCcgKSB8fCAnJzsKCiAgICAgICAgIyBjcmVhdGUgaGFzaCB3aXRoIHNlbGVjdGVkIGN1c3RvbWVyIHVzZXJzCiAgICAgICAgbXkgJUN1c3RvbWVyVXNlcnNTZWxlY3RlZCA9IG1hcCB7ICRfID0+IDEgfSBAQ3VzdG9tZXJVc2Vyc1NlbGVjdGVkOwoKICAgICAgICAjIGNoZWNrIGFsbCB1c2VkIGN1c3RvbWVyIHVzZXJzCiAgICAgICAgZm9yIG15ICRDdXN0b21lclVzZXJJRCAoQEN1c3RvbWVyVXNlcnNBbGwpIHsKICAgICAgICAgICAgbXkgJEFjdGl2ZSA9ICRDdXN0b21lclVzZXJzU2VsZWN0ZWR7JEN1c3RvbWVyVXNlcklEfSA/IDEgOiAwOwoKICAgICAgICAgICAgIyBzZXQgY3VzdG9tZXIgdXNlciBhcyBhIG1lbWJlciBvZiBjb21wYW55CiAgICAgICAgICAgICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyVXNlckN1c3RvbWVyTWVtYmVyQWRkKAogICAgICAgICAgICAgICAgQ3VzdG9tZXJVc2VySUQgPT4gJEN1c3RvbWVyVXNlcklELAogICAgICAgICAgICAgICAgQ3VzdG9tZXJJRCAgICAgPT4gJEN1c3RvbWVySUQsCiAgICAgICAgICAgICAgICBBY3RpdmUgICAgICAgICA9PiAkQWN0aXZlLAogICAgICAgICAgICAgICAgVXNlcklEICAgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBJZiB0aGUgdXNlciB3b3VsZCBsaWtlIHRvIGNvbnRpbnVlIGVkaXRpbmcgdGhlIGN1c3RvbWVyIHJlbGF0aW9ucyBmb3IgY3VzdG9tZXIgdXNlcgogICAgICAgICMgICBqdXN0IHJlZGlyZWN0IHRvIHRoZSBlZGl0IHNjcmVlbiBhbmQgb3RoZXJ3aXNlIHJldHVybiB0byByZWxhdGlvbnMgb3ZlcnZpZXcuCiAgICAgICAgaWYgKAogICAgICAgICAgICBkZWZpbmVkICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdDb250aW51ZUFmdGVyU2F2ZScgKQogICAgICAgICAgICAmJiAoICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdDb250aW51ZUFmdGVyU2F2ZScgKSBlcSAnMScgKQogICAgICAgICAgICApCiAgICAgICAgewogICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+UmVkaXJlY3QoCiAgICAgICAgICAgICAgICBPUCA9PgogICAgICAgICAgICAgICAgICAgICJBY3Rpb249JFNlbGYtPntBY3Rpb259O1N1YmFjdGlvbj1DdXN0b21lcjtJRD0kQ3VzdG9tZXJJRDtTZWFyY2g9JFBhcmFte1NlYXJjaH0iCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewoKICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPlJlZGlyZWN0KAogICAgICAgICAgICAgICAgT1AgPT4gIkFjdGlvbj0kU2VsZi0+e0FjdGlvbn07U2VhcmNoPSRQYXJhbXtTZWFyY2h9IgogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICAjIGdyb3VwcyB0byB1c2VyCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICBlbHNpZiAoICRTZWxmLT57U3ViYWN0aW9ufSBlcSAnQ2hhbmdlQ3VzdG9tZXJVc2VyJyApIHsKCiAgICAgICAgIyBjaGFsbGVuZ2UgdG9rZW4gY2hlY2sgZm9yIHdyaXRlIGFjdGlvbgogICAgICAgICRMYXlvdXRPYmplY3QtPkNoYWxsZW5nZVRva2VuQ2hlY2soKTsKCiAgICAgICAgIyBnZXQgbmV3IGN1c3RvbWVyIGNvbXBhbmllcwogICAgICAgIG15IEBDdXN0b21lcnNTZWxlY3RlZCA9ICRQYXJhbU9iamVjdC0+R2V0QXJyYXkoIFBhcmFtID0+ICdJdGVtc1NlbGVjdGVkJyApOwogICAgICAgIG15IEBDdXN0b21lcnNBbGwgICAgICA9ICRQYXJhbU9iamVjdC0+R2V0QXJyYXkoIFBhcmFtID0+ICdJdGVtc0FsbCcgKTsKCiAgICAgICAgbXkgJEN1c3RvbWVyVXNlcklEID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0lEJyApOwoKICAgICAgICAjIGNyZWF0ZSBoYXNoIHdpdGggc2VsZWN0ZWQgY3VzdG9tZXIgY29tcGFuaWVzCiAgICAgICAgbXkgJUN1c3RvbWVyc1NlbGVjdGVkID0gbWFwIHsgJF8gPT4gMSB9IEBDdXN0b21lcnNTZWxlY3RlZDsKCiAgICAgICAgIyBjaGVjayBhbGwgdXNlZCBjdXN0b21lciBjb21wYW5pZXMKICAgICAgICBmb3IgbXkgJEN1c3RvbWVySUQgKEBDdXN0b21lcnNBbGwpIHsKICAgICAgICAgICAgbXkgJEFjdGl2ZSA9ICRDdXN0b21lcnNTZWxlY3RlZHskQ3VzdG9tZXJJRH0gPyAxIDogMDsKCiAgICAgICAgICAgICMgc2V0IGN1c3RvbWVyIHVzZXIgYXMgYSBtZW1iZXIgb2YgY29tcGFueQogICAgICAgICAgICAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJDdXN0b21lck1lbWJlckFkZCgKICAgICAgICAgICAgICAgIEN1c3RvbWVyVXNlcklEID0+ICRDdXN0b21lclVzZXJJRCwKICAgICAgICAgICAgICAgIEN1c3RvbWVySUQgICAgID0+ICRDdXN0b21lcklELAogICAgICAgICAgICAgICAgQWN0aXZlICAgICAgICAgPT4gJEFjdGl2ZSwKICAgICAgICAgICAgICAgIFVzZXJJRCAgICAgICAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgSWYgdGhlIHVzZXIgd291bGQgbGlrZSB0byBjb250aW51ZSBlZGl0aW5nIHRoZSBjdXN0b21lciB1c2VyIHJlbGF0aW9ucyBmb3IgY3VzdG9tZXIKICAgICAgICAjICAganVzdCByZWRpcmVjdCB0byB0aGUgZWRpdCBzY3JlZW4gYW5kIG90aGVyd2lzZSByZXR1cm4gdG8gcmVsYXRpb25zIG92ZXJ2aWV3LgogICAgICAgIGlmICgKICAgICAgICAgICAgZGVmaW5lZCAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQ29udGludWVBZnRlclNhdmUnICkKICAgICAgICAgICAgJiYgKCAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQ29udGludWVBZnRlclNhdmUnICkgZXEgJzEnICkKICAgICAgICAgICAgKQogICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPlJlZGlyZWN0KAogICAgICAgICAgICAgICAgT1AgPT4KICAgICAgICAgICAgICAgICAgICAiQWN0aW9uPSRTZWxmLT57QWN0aW9ufTtTdWJhY3Rpb249Q3VzdG9tZXJVc2VyO0lEPSRDdXN0b21lclVzZXJJRDtTZWFyY2g9JFBhcmFte1NlYXJjaH0iCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewoKICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPlJlZGlyZWN0KAogICAgICAgICAgICAgICAgT1AgPT4gIkFjdGlvbj0kU2VsZi0+e0FjdGlvbn07U2VhcmNoPSRQYXJhbXtTZWFyY2h9IgogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICAjIG92ZXJ2aWV3CiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCgogICAgbXkgJE91dHB1dCA9ICRMYXlvdXRPYmplY3QtPkhlYWRlcigpOwogICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5OYXZpZ2F0aW9uQmFyKCk7CgogICAgIyBzZWFyY2ggY3VzdG9tZXIgdXNlcgogICAgbXkgJUN1c3RvbWVyVXNlckxpc3QgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclNlYXJjaCgKICAgICAgICBTZWFyY2ggPT4gJFBhcmFte1NlYXJjaH0sCiAgICAgICAgVXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICk7CiAgICBteSBAQ3VzdG9tZXJVc2VyS2V5TGlzdCA9IHNvcnQgeyAkQ3VzdG9tZXJVc2VyTGlzdHskYX0gY21wICRDdXN0b21lclVzZXJMaXN0eyRifSB9IGtleXMgJUN1c3RvbWVyVXNlckxpc3Q7CgogICAgIyBvdXRwdXQgcm93cwogICAgbXkgJEN1c3RvbWVyVXNlcnNTaG93biA9IDA7CiAgICBteSAlQ3VzdG9tZXJVc2VyRGF0YTsKICAgIENVU1RPTUVSVVNFUjoKICAgIGZvciBteSAkQ3VzdG9tZXJVc2VyIChAQ3VzdG9tZXJVc2VyS2V5TGlzdCkgewoKICAgICAgICAjIGdldCBjdXN0b21lciB1c2VyCiAgICAgICAgbXkgJVVzZXIgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJEYXRhR2V0KAogICAgICAgICAgICBVc2VyID0+ICRDdXN0b21lclVzZXIsCiAgICAgICAgKTsKICAgICAgICBuZXh0IENVU1RPTUVSVVNFUiBpZiAhJVVzZXI7CgogICAgICAgICMgY2hlY2sgaWYgd2UgaGF2ZSBtb3JlIHJlc3VsdHMgdGhhbiBzaG93bgogICAgICAgICsrJEN1c3RvbWVyVXNlcnNTaG93bjsKICAgICAgICBpZiAoICRDdXN0b21lclVzZXJzU2hvd24gPiAkU2VhcmNoTGltaXQgKSB7CiAgICAgICAgICAgIGxhc3QgQ1VTVE9NRVJVU0VSOwogICAgICAgIH0KCiAgICAgICAgbXkgJFVzZXJOYW1lID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJOYW1lKAogICAgICAgICAgICBVc2VyTG9naW4gPT4gJEN1c3RvbWVyVXNlciwKICAgICAgICApOwogICAgICAgICRDdXN0b21lclVzZXJEYXRheyAkVXNlcntVc2VySUR9IH0gPQogICAgICAgICAgICAiJFVzZXJOYW1lIDwkVXNlcntVc2VyRW1haWx9PiAoJFVzZXJ7VXNlckN1c3RvbWVySUR9KSI7CiAgICB9CgogICAgIyBzZWFyY2ggY3VzdG9tZXJzCiAgICBteSAlQ3VzdG9tZXJMaXN0ID0gJEN1c3RvbWVyQ29tcGFueU9iamVjdC0+Q3VzdG9tZXJDb21wYW55TGlzdCgKICAgICAgICBTZWFyY2ggPT4gJFBhcmFte1NlYXJjaH0sCiAgICAgICAgVXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICk7CiAgICBteSBAQ3VzdG9tZXJLZXlMaXN0ID0gc29ydCBrZXlzICVDdXN0b21lckxpc3Q7CgogICAgIyBvdXRwdXQgcm93cwogICAgbXkgJEN1c3RvbWVyc1Nob3duID0gMDsKICAgIG15ICVDdXN0b21lckRhdGE7CiAgICBDVVNUT01FUjoKICAgIGZvciBteSAkQ3VzdG9tZXIgKEBDdXN0b21lcktleUxpc3QpIHsKCiAgICAgICAgIyBjaGVjayBhbmQgcmVtZW1iZXIgaWYgd2UgaGF2ZSBtb3JlIHJlc3VsdHMgdGhhbiBzaG93bgogICAgICAgICsrJEN1c3RvbWVyc1Nob3duOwogICAgICAgIGlmICggJEN1c3RvbWVyc1Nob3duID4gJFNlYXJjaExpbWl0ICkgewogICAgICAgICAgICBsYXN0IENVU1RPTUVSOwogICAgICAgIH0KCiAgICAgICAgJEN1c3RvbWVyRGF0YXskQ3VzdG9tZXJ9ID0gJEN1c3RvbWVyTGlzdHskQ3VzdG9tZXJ9OwogICAgfQoKICAgICRPdXRwdXQgLj0gJFNlbGYtPl9PdmVydmlldygKICAgICAgICBDdXN0b21lclVzZXJEYXRhICAgPT4gXCVDdXN0b21lclVzZXJEYXRhLAogICAgICAgIEN1c3RvbWVyRGF0YSAgICAgICA9PiBcJUN1c3RvbWVyRGF0YSwKICAgICAgICBTZWFyY2hMaW1pdCAgICAgICAgPT4gJFNlYXJjaExpbWl0LAogICAgICAgIEN1c3RvbWVyc1Nob3duICAgICA9PiAkQ3VzdG9tZXJzU2hvd24sCiAgICAgICAgQ3VzdG9tZXJVc2Vyc1Nob3duID0+ICRDdXN0b21lclVzZXJzU2hvd24sCiAgICAgICAgU2VhcmNoICAgICAgICAgICAgID0+ICRQYXJhbXtTZWFyY2h9LAogICAgKTsKCiAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPkZvb3RlcigpOwogICAgcmV0dXJuICRPdXRwdXQ7Cn0KCnN1YiBfQ2hhbmdlIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKCiAgICBteSAlRGF0YSAgICAgICAgPSAleyAkUGFyYW17RGF0YX0gfTsKICAgIG15ICRUeXBlICAgICAgICA9ICRQYXJhbXtUeXBlfSB8fCAnQ3VzdG9tZXJVc2VyJzsKICAgIG15ICROZVR5cGUgICAgICA9ICRUeXBlIGVxICdDdXN0b21lcicgPyAnQ3VzdG9tZXJVc2VyJyA6ICdDdXN0b21lcic7CiAgICBteSAlVmlzaWJsZVR5cGUgPSAoCiAgICAgICAgQ3VzdG9tZXJVc2VyID0+ICdDdXN0b21lciBVc2VyJywKICAgICAgICBDdXN0b21lciAgICAgPT4gJ0N1c3RvbWVyJywKICAgICk7CgogICAgbXkgJFNlYXJjaExpbWl0ID0gJFBhcmFte1NlYXJjaExpbWl0fTsKICAgIG15ICRJdGVtc1Nob3duICA9ICRQYXJhbXtJdGVtc1Nob3dufTsKCiAgICBpZiAoICRWaXNpYmxlVHlwZXskTmVUeXBlfSBlcSAnQ3VzdG9tZXInICkgewogICAgICAgICRQYXJhbXtCcmVhZGNydW1iVGl0bGV9ID0gIkNoYW5nZSBDdXN0b21lciBSZWxhdGlvbnMgZm9yIEN1c3RvbWVyIFVzZXIiOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgJFBhcmFte0JyZWFkY3J1bWJUaXRsZX0gPSAiQ2hhbmdlIEN1c3RvbWVyIFVzZXIgUmVsYXRpb25zIGZvciBDdXN0b21lciI7CiAgICB9CgogICAgIyBvdmVydmlldwogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnT3ZlcnZpZXcnLAogICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgIE92ZXJ2aWV3TGluayA9PiAkU2VsZi0+e0FjdGlvbn0gLiAnO1NlYXJjaD0nIC4gJFBhcmFte1NlYXJjaH0sCiAgICAgICAgfSwKICAgICk7CiAgICAkTGF5b3V0T2JqZWN0LT5CbG9jayggTmFtZSA9PiAnQWN0aW9uTGlzdCcgKTsKICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgIE5hbWUgPT4gJ0FjdGlvbk92ZXJ2aWV3JywKICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgU2VhcmNoID0+ICRQYXJhbXtTZWFyY2h9LAogICAgICAgIH0sCiAgICApOwoKICAgICMgb3V0cHV0IHNlYXJjaCBibG9jawogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnU2VhcmNoJywKICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICBTZWFyY2ggPT4gJFBhcmFte1NlYXJjaH0sCiAgICAgICAgfSwKICAgICk7CgogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnU2VhcmNoQ2hhbmdlJywKICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICBTdWJhY3Rpb24gPT4gJFBhcmFte1N1YmFjdGlvbn0sCiAgICAgICAgfSwKICAgICk7CgogICAgJExheW91dE9iamVjdC0+QmxvY2soIE5hbWUgPT4gJ05vdGUnICk7CgogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnQ2hhbmdlJywKICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICBBY3Rpb25Ib21lICAgID0+ICdBZG1pbicgLiAoICRUeXBlIGVxICdDdXN0b21lcicgPyAnQ3VzdG9tZXJDb21wYW55JyA6ICRUeXBlICksCiAgICAgICAgICAgIFZpc2libGVOZVR5cGUgPT4gJFZpc2libGVUeXBleyROZVR5cGV9LAogICAgICAgICAgICBWaXNpYmxlVHlwZSAgID0+ICRWaXNpYmxlVHlwZXskVHlwZX0sCiAgICAgICAgfSwKICAgICk7CgogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnQ2hhbmdlSGVhZGluZycgLiAkVHlwZSwKICAgICk7CgogICAgIyBzZXQgZ3JvdXAgcGVybWlzc2lvbnMKICAgICRMYXlvdXRPYmplY3QtPkFkZEpTRGF0YSgKICAgICAgICBLZXkgICA9PiAnUmVsYXRpb25JdGVtcycsCiAgICAgICAgVmFsdWUgPT4gWyRUeXBlXSwKICAgICk7CgogICAgIyBjaGVjayBpZiB0aGVyZSBhcmUgY3VzdG9tZXIgdXNlcnMvY3VzdG9tZXJzCiAgICBpZiAoICElRGF0YSApIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnTm9EYXRhRm91bmRNc2dMaXN0JywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBDb2xTcGFuID0+IDIsCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIG91dHB1dCBjb3VudCBibG9jawogICAgaWYgKCAhJEl0ZW1zU2hvd24gKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ0NoYW5nZUl0ZW1Db3VudExpbWl0JywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBJdGVtQ291bnQgPT4gMCwKICAgICAgICAgICAgfSwKICAgICAgICApOwoKICAgIH0KICAgIGVsc2lmICggJEl0ZW1zU2hvd24gPiAkU2VhcmNoTGltaXQgKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ0NoYW5nZUl0ZW1Db3VudExpbWl0JywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBJdGVtQ291bnQgPT4gIj4iIC4gJFNlYXJjaExpbWl0LAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnQ2hhbmdlSXRlbUNvdW50JywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBJdGVtQ291bnQgPT4gJEl0ZW1zU2hvd24sCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKICAgIH0KCiAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICBOYW1lID0+ICdDaGFuZ2VIZWFkZXInLAogICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgIFR5cGUgICAgICAgICAgPT4gJFR5cGUsCiAgICAgICAgICAgIE5lVHlwZSAgICAgICAgPT4gJE5lVHlwZSwKICAgICAgICAgICAgVmlzaWJsZVR5cGUgICA9PiAkVmlzaWJsZVR5cGV7JFR5cGV9LAogICAgICAgICAgICBWaXNpYmxlTmVUeXBlID0+ICRWaXNpYmxlVHlwZXskTmVUeXBlfSwKICAgICAgICB9LAogICAgKTsKCiAgICBmb3IgbXkgJElEICggc29ydCB7IHVjKCAkRGF0YXskYX0gKSBjbXAgdWMoICREYXRheyRifSApIH0ga2V5cyAlRGF0YSApIHsKCiAgICAgICAgIyBzZXQgb3V0cHV0IGNsYXNzCiAgICAgICAgbXkgJFNlbGVjdGVkID0gJFBhcmFte1NlbGVjdGVkfS0+eyRJRH0gPyAnIGNoZWNrZWQ9ImNoZWNrZWQiJyA6ICcnOwoKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnQ2hhbmdlUm93JywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICBBY3Rpb25Ib21lICAgID0+ICdBZG1pbicgLiAoICROZVR5cGUgZXEgJ0N1c3RvbWVyJyA/ICdDdXN0b21lckNvbXBhbnknIDogJE5lVHlwZSApLAogICAgICAgICAgICAgICAgTmFtZSAgICAgICAgICA9PiAkUGFyYW17RGF0YX0tPnskSUR9LAogICAgICAgICAgICAgICAgTmVUeXBlICAgICAgICA9PiAkTmVUeXBlLAogICAgICAgICAgICAgICAgVHlwZSAgICAgICAgICA9PiAkVHlwZSwKICAgICAgICAgICAgICAgIElEICAgICAgICAgICAgPT4gJElELAogICAgICAgICAgICAgICAgU2VsZWN0ZWQgICAgICA9PiAkU2VsZWN0ZWQsCiAgICAgICAgICAgICAgICBWaXNpYmxlVHlwZSAgID0+ICRWaXNpYmxlVHlwZXskVHlwZX0sCiAgICAgICAgICAgICAgICBWaXNpYmxlTmVUeXBlID0+ICRWaXNpYmxlVHlwZXskTmVUeXBlfSwKICAgICAgICAgICAgfSwKICAgICAgICApOwogICAgfQoKICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5PdXRwdXQoCiAgICAgICAgVGVtcGxhdGVGaWxlID0+ICdBZG1pbkN1c3RvbWVyVXNlckN1c3RvbWVyJywKICAgICAgICBEYXRhICAgICAgICAgPT4gXCVQYXJhbSwKICAgICk7Cn0KCnN1YiBfT3ZlcnZpZXcgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwoKICAgIG15ICVDdXN0b21lclVzZXJEYXRhID0gJXsgJFBhcmFte0N1c3RvbWVyVXNlckRhdGF9IH07CgogICAgbXkgJUN1c3RvbWVyRGF0YSA9ICV7ICRQYXJhbXtDdXN0b21lckRhdGF9IH07CgogICAgbXkgJFNlYXJjaExpbWl0ICAgICAgICA9ICRQYXJhbXtTZWFyY2hMaW1pdH07CiAgICBteSAkQ3VzdG9tZXJzU2hvd24gICAgID0gJFBhcmFte0N1c3RvbWVyc1Nob3dufTsKICAgIG15ICRDdXN0b21lclVzZXJzU2hvd24gPSAkUGFyYW17Q3VzdG9tZXJVc2Vyc1Nob3dufTsKCiAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICBOYW1lID0+ICdPdmVydmlldycsCiAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgIE92ZXJ2aWV3TGluayA9PiAkU2VsZi0+e0FjdGlvbn0gLiAnO1NlYXJjaD0nIC4gJFBhcmFte1NlYXJjaH0sCiAgICAgICAgfSwKICAgICk7CgogICAgJExheW91dE9iamVjdC0+QmxvY2soIE5hbWUgPT4gJ0FjdGlvbkxpc3QnICk7CgogICAgIyBvdXRwdXQgc2VhcmNoIGN1c3RvbWVyIHVzZXIgYmxvY2sKICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgIE5hbWUgPT4gJ1NlYXJjaCcsCiAgICAgICAgRGF0YSA9PiBcJVBhcmFtLAogICAgKTsKCiAgICAjIG91dHB1dCByZXN1bHQgYmxvY2sKICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgIE5hbWUgPT4gJ1Jlc3VsdCcsCiAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICVQYXJhbSwKICAgICAgICB9LAogICAgKTsKCiAgICAjIG91dHB1dCBjdXN0b21lciB1c2VyIGNvdW50IGJsb2NrCiAgICBpZiAoICEkQ3VzdG9tZXJVc2Vyc1Nob3duICkgewogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdSZXN1bHRDdXN0b21lclVzZXJDb3VudExpbWl0JywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBDdXN0b21lclVzZXJDb3VudCA9PiAwLAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ05vRGF0YUZvdW5kTXNnQ3VzdG9tZXJVc2VyJywKICAgICAgICApOwogICAgfQogICAgZWxzaWYgKCAkQ3VzdG9tZXJVc2Vyc1Nob3duID4gJFNlYXJjaExpbWl0ICkgewogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdSZXN1bHRDdXN0b21lclVzZXJDb3VudExpbWl0JywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBDdXN0b21lclVzZXJDb3VudCA9PiAiPiIgLiAkU2VhcmNoTGltaXQsCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKICAgIH0KICAgIGVsc2UgewogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdSZXN1bHRDdXN0b21lclVzZXJDb3VudCcsCiAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgQ3VzdG9tZXJVc2VyQ291bnQgPT4gJEN1c3RvbWVyVXNlcnNTaG93biwKICAgICAgICAgICAgfSwKICAgICAgICApOwogICAgfQoKICAgIGZvciBteSAkSUQgKAogICAgICAgIHNvcnQgeyB1YyggJEN1c3RvbWVyVXNlckRhdGF7JGF9ICkgY21wIHVjKCAkQ3VzdG9tZXJVc2VyRGF0YXskYn0gKSB9CiAgICAgICAga2V5cyAlQ3VzdG9tZXJVc2VyRGF0YQogICAgICAgICkKICAgIHsKCiAgICAgICAgIyBvdXRwdXQgdXNlciByb3cgYmxvY2sKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnTGlzdDFuJywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICBJRCAgICAgICAgPT4gJElELAogICAgICAgICAgICAgICAgTmFtZSAgICAgID0+ICRDdXN0b21lclVzZXJEYXRheyRJRH0sCiAgICAgICAgICAgICAgICBTdWJhY3Rpb24gPT4gJ0N1c3RvbWVyVXNlcicsCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIG91dHB1dCBjdXN0b21lciB1c2VyIGNvdW50IGJsb2NrCiAgICBpZiAoICEkQ3VzdG9tZXJzU2hvd24gKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ1Jlc3VsdEN1c3RvbWVyQ291bnRMaW1pdCcsCiAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgQ3VzdG9tZXJDb3VudCA9PiAwLAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ05vRGF0YUZvdW5kTXNnQ3VzdG9tZXInLAogICAgICAgICk7CiAgICB9CiAgICBlbHNpZiAoICRDdXN0b21lcnNTaG93biA+ICRTZWFyY2hMaW1pdCApIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnUmVzdWx0Q3VzdG9tZXJDb3VudExpbWl0JywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBDdXN0b21lckNvdW50ID0+ICI+IiAuICRTZWFyY2hMaW1pdCwKICAgICAgICAgICAgfSwKICAgICAgICApOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ1Jlc3VsdEN1c3RvbWVyQ291bnQnLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgIEN1c3RvbWVyQ291bnQgPT4gJEN1c3RvbWVyc1Nob3duLAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICB9CgogICAgZm9yIG15ICRJRCAoCiAgICAgICAgc29ydCB7IHVjKCAkQ3VzdG9tZXJEYXRheyRhfSApIGNtcCB1YyggJEN1c3RvbWVyRGF0YXskYn0gKSB9CiAgICAgICAga2V5cyAlQ3VzdG9tZXJEYXRhCiAgICAgICAgKQogICAgewoKICAgICAgICAjIG91dHB1dCBjdXN0b21lciByb3cgYmxvY2sKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnTGlzdG4xJywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICBJRCAgICAgICAgPT4gJElELAogICAgICAgICAgICAgICAgTmFtZSAgICAgID0+ICRDdXN0b21lckRhdGF7JElEfSwKICAgICAgICAgICAgICAgIFN1YmFjdGlvbiA9PiAnQ3VzdG9tZXInLAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICB9CgogICAgIyByZXR1cm4gb3V0cHV0CiAgICByZXR1cm4gJExheW91dE9iamVjdC0+T3V0cHV0KAogICAgICAgIFRlbXBsYXRlRmlsZSA9PiAnQWRtaW5DdXN0b21lclVzZXJDdXN0b21lcicsCiAgICAgICAgRGF0YSAgICAgICAgID0+IFwlUGFyYW0sCiAgICApOwoKfQoKMTsK</File>
        <File Location="Custom/Kernel/Modules/AdminCustomerUserGroup.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxLTIwMjIgWm51bnkgR21iSCwgaHR0cHM6Ly96bnVueS5vcmcvCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6TW9kdWxlczo6QWRtaW5DdXN0b21lclVzZXJHcm91cDsKCnVzZSBzdHJpY3Q7CnVzZSB3YXJuaW5nczsKCnVzZSBLZXJuZWw6Okxhbmd1YWdlIHF3KFRyYW5zbGF0YWJsZSk7CgpvdXIgJE9iamVjdE1hbmFnZXJEaXNhYmxlZCA9IDE7CgpzdWIgbmV3IHsKICAgIG15ICggJFR5cGUsICVQYXJhbSApID0gQF87CgogICAgIyBhbGxvY2F0ZSBuZXcgaGFzaCBmb3Igb2JqZWN0CiAgICBteSAkU2VsZiA9IHslUGFyYW19OwogICAgYmxlc3MoICRTZWxmLCAkVHlwZSApOwoKICAgIHJldHVybiAkU2VsZjsKfQoKc3ViIFJ1biB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CiAgICBteSAkQ29uZmlnT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKTsKCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICAjIGNoZWNrIGlmIGZlYXR1cmUgaXMgYWN0aXZlCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICBpZiAoICEkQ29uZmlnT2JqZWN0LT5HZXQoJ0N1c3RvbWVyR3JvdXBTdXBwb3J0JykgKSB7CiAgICAgICAgbXkgJE91dHB1dCA9ICRMYXlvdXRPYmplY3QtPkhlYWRlcigpOwogICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+TmF2aWdhdGlvbkJhcigpOwoKICAgICAgICAkT3V0cHV0IC49ICRTZWxmLT5fRGlzYWJsZWQoKTsKCiAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5Gb290ZXIoKTsKICAgICAgICByZXR1cm4gJE91dHB1dDsKICAgIH0KCiAgICBteSAkUGFyYW1PYmplY3QgICAgICAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpXZWI6OlJlcXVlc3QnKTsKICAgIG15ICRDdXN0b21lclVzZXJPYmplY3QgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyVXNlcicpOwogICAgbXkgJEN1c3RvbWVyR3JvdXBPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q3VzdG9tZXJHcm91cCcpOwogICAgbXkgJEdyb3VwT2JqZWN0ICAgICAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6R3JvdXAnKTsKCiAgICAjIHNldCBzZWFyY2ggbGltaXQKICAgIG15ICRTZWFyY2hMaW1pdCA9IDIwMDsKCiAgICAkUGFyYW17Q3VzdG9tZXJVc2VyU2VhcmNofSA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdDdXN0b21lclVzZXJTZWFyY2gnICkgfHwgJyonOwoKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgICMgdXNlciA8LT4gZ3JvdXAgMTpuCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICBpZiAoICRTZWxmLT57U3ViYWN0aW9ufSBlcSAnQ3VzdG9tZXJVc2VyJyApIHsKCiAgICAgICAgIyBnZXQgdXNlciBkYXRhCiAgICAgICAgbXkgJElEICAgICAgICAgICA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdJRCcgKTsKICAgICAgICBteSAlVXNlckRhdGEgICAgID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJVc2VyRGF0YUdldCggVXNlciA9PiAkSUQgKTsKICAgICAgICBteSAkQ3VzdG9tZXJOYW1lID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJOYW1lKCBVc2VyTG9naW4gPT4gJFVzZXJEYXRhe1VzZXJMb2dpbn0gKTsKCiAgICAgICAgIyBnZXQgZ3JvdXAgZGF0YQogICAgICAgIG15ICVHcm91cERhdGEgPSAkR3JvdXBPYmplY3QtPkdyb3VwTGlzdCggVmFsaWQgPT4gMSApOwogICAgICAgIG15ICVUeXBlczsKICAgICAgICBmb3IgbXkgJFR5cGUgKCBAeyAkQ29uZmlnT2JqZWN0LT5HZXQoJ1N5c3RlbTo6Q3VzdG9tZXI6OlBlcm1pc3Npb24nKSB9ICkgewogICAgICAgICAgICBteSAlRGF0YSA9ICRDdXN0b21lckdyb3VwT2JqZWN0LT5Hcm91cE1lbWJlckxpc3QoCiAgICAgICAgICAgICAgICBVc2VySUQgICAgICAgICA9PiAkSUQsCiAgICAgICAgICAgICAgICBUeXBlICAgICAgICAgICA9PiAkVHlwZSwKICAgICAgICAgICAgICAgIFJlc3VsdCAgICAgICAgID0+ICdIQVNIJywKICAgICAgICAgICAgICAgIFJhd1Blcm1pc3Npb25zID0+IDEsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgICRUeXBlc3skVHlwZX0gPSBcJURhdGE7CiAgICAgICAgfQoKICAgICAgICBteSAkT3V0cHV0ID0gJExheW91dE9iamVjdC0+SGVhZGVyKCk7CiAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5OYXZpZ2F0aW9uQmFyKCk7CiAgICAgICAgJE91dHB1dCAuPSAkU2VsZi0+X0NoYW5nZSgKICAgICAgICAgICAgJVR5cGVzLAogICAgICAgICAgICBEYXRhICAgICAgICAgICAgICAgPT4gXCVHcm91cERhdGEsCiAgICAgICAgICAgIElEICAgICAgICAgICAgICAgICA9PiAkVXNlckRhdGF7VXNlcklEfSwKICAgICAgICAgICAgTmFtZSAgICAgICAgICAgICAgID0+ICIkQ3VzdG9tZXJOYW1lICgkVXNlckRhdGF7VXNlckxvZ2lufSkiLAogICAgICAgICAgICBUeXBlICAgICAgICAgICAgICAgPT4gJ0N1c3RvbWVyVXNlcicsCiAgICAgICAgICAgIEN1c3RvbWVyVXNlclNlYXJjaCA9PiAkUGFyYW17Q3VzdG9tZXJVc2VyU2VhcmNofSwKICAgICAgICApOwogICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Rm9vdGVyKCk7CgogICAgICAgIHJldHVybiAkT3V0cHV0OwogICAgfQoKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgICMgZ3JvdXAgPC0+IHVzZXIgbjoxCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICBlbHNpZiAoICRTZWxmLT57U3ViYWN0aW9ufSBlcSAnR3JvdXAnICkgewoKICAgICAgICAjIEdldCBwYXJhbXMuCiAgICAgICAgJFBhcmFte1N1YmFjdGlvbn0gPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnU3ViYWN0aW9uJyApOwoKICAgICAgICAjIGdldCBncm91cCBkYXRhCiAgICAgICAgbXkgJElEICAgICAgICA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdJRCcgKTsKICAgICAgICBteSAlR3JvdXBEYXRhID0gJEdyb3VwT2JqZWN0LT5Hcm91cEdldCggSUQgPT4gJElEICk7CgogICAgICAgICMgc2VhcmNoIGN1c3RvbWVyIHVzZXIKICAgICAgICBteSAlQ3VzdG9tZXJVc2VyTGlzdCA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyU2VhcmNoKAogICAgICAgICAgICBTZWFyY2ggPT4gJFBhcmFte0N1c3RvbWVyVXNlclNlYXJjaH0sCiAgICAgICAgICAgIFVzZXJJRCA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgKTsKICAgICAgICBteSBAQ3VzdG9tZXJVc2VyS2V5TGlzdCA9IHNvcnQgeyAkQ3VzdG9tZXJVc2VyTGlzdHskYX0gY21wICRDdXN0b21lclVzZXJMaXN0eyRifSB9IGtleXMgJUN1c3RvbWVyVXNlckxpc3Q7CgogICAgICAgICMgc2V0IG1heCBjb3VudAogICAgICAgIG15ICRNYXhDb3VudCA9IEBDdXN0b21lclVzZXJLZXlMaXN0OwogICAgICAgIGlmICggJE1heENvdW50ID4gJFNlYXJjaExpbWl0ICkgewogICAgICAgICAgICAkTWF4Q291bnQgPSAkU2VhcmNoTGltaXQ7CiAgICAgICAgfQoKICAgICAgICBteSAlQ3VzdG9tZXJEYXRhOwoKICAgICAgICAjIG91dHB1dCByb3dzCiAgICAgICAgZm9yIG15ICRDb3VudGVyICggMSAuLiAkTWF4Q291bnQgKSB7CgogICAgICAgICAgICAjIGdldCB1c2VyCiAgICAgICAgICAgIG15ICVVc2VyID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJVc2VyRGF0YUdldCgKICAgICAgICAgICAgICAgIFVzZXIgPT4gJEN1c3RvbWVyVXNlcktleUxpc3RbICRDb3VudGVyIC0gMSBdLAogICAgICAgICAgICApOwogICAgICAgICAgICBteSAkVXNlck5hbWUgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lck5hbWUoCiAgICAgICAgICAgICAgICBVc2VyTG9naW4gPT4gJEN1c3RvbWVyVXNlcktleUxpc3RbICRDb3VudGVyIC0gMSBdCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIG15ICRDdXN0b21lclVzZXIgPSAiJFVzZXJOYW1lIDwkVXNlcntVc2VyRW1haWx9PiAoJFVzZXJ7VXNlckN1c3RvbWVySUR9KSI7CiAgICAgICAgICAgICRDdXN0b21lckRhdGF7ICRVc2Vye1VzZXJJRH0gfSA9ICRDdXN0b21lclVzZXI7CiAgICAgICAgfQoKICAgICAgICAjIGdldCBwZXJtaXNzaW9uIGxpc3QgdXNlcnMKICAgICAgICBteSAlVHlwZXM7CiAgICAgICAgZm9yIG15ICRUeXBlICggQHsgJENvbmZpZ09iamVjdC0+R2V0KCdTeXN0ZW06OkN1c3RvbWVyOjpQZXJtaXNzaW9uJykgfSApIHsKICAgICAgICAgICAgbXkgJURhdGEgPSAkQ3VzdG9tZXJHcm91cE9iamVjdC0+R3JvdXBNZW1iZXJMaXN0KAogICAgICAgICAgICAgICAgR3JvdXBJRCAgICAgICAgPT4gJElELAogICAgICAgICAgICAgICAgVHlwZSAgICAgICAgICAgPT4gJFR5cGUsCiAgICAgICAgICAgICAgICBSZXN1bHQgICAgICAgICA9PiAnSEFTSCcsCiAgICAgICAgICAgICAgICBSYXdQZXJtaXNzaW9ucyA9PiAxLAogICAgICAgICAgICApOwogICAgICAgICAgICAkVHlwZXN7JFR5cGV9ID0gXCVEYXRhOwogICAgICAgIH0KCiAgICAgICAgbXkgJE91dHB1dCA9ICRMYXlvdXRPYmplY3QtPkhlYWRlcigpOwogICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+TmF2aWdhdGlvbkJhcigpOwogICAgICAgICRPdXRwdXQgLj0gJFNlbGYtPl9DaGFuZ2UoCiAgICAgICAgICAgICVUeXBlcywKICAgICAgICAgICAgRGF0YSAgICAgICAgICAgICAgID0+IFwlQ3VzdG9tZXJEYXRhLAogICAgICAgICAgICBJRCAgICAgICAgICAgICAgICAgPT4gJEdyb3VwRGF0YXtJRH0sCiAgICAgICAgICAgIE5hbWUgICAgICAgICAgICAgICA9PiAkR3JvdXBEYXRhe05hbWV9LAogICAgICAgICAgICBUeXBlICAgICAgICAgICAgICAgPT4gJ0dyb3VwJywKICAgICAgICAgICAgU2VhcmNoTGltaXQgICAgICAgID0+ICRTZWFyY2hMaW1pdCwKICAgICAgICAgICAgSXRlbUxpc3QgICAgICAgICAgID0+IFxAQ3VzdG9tZXJVc2VyS2V5TGlzdCwKICAgICAgICAgICAgQ3VzdG9tZXJVc2VyU2VhcmNoID0+ICRQYXJhbXtDdXN0b21lclVzZXJTZWFyY2h9LAogICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgKTsKICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPkZvb3RlcigpOwogICAgICAgIHJldHVybiAkT3V0cHV0OwogICAgfQoKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgICMgYWRkIHVzZXIgdG8gZ3JvdXBzCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICBlbHNpZiAoICRTZWxmLT57U3ViYWN0aW9ufSBlcSAnQ2hhbmdlR3JvdXAnICkgewoKICAgICAgICAjIGNoYWxsZW5nZSB0b2tlbiBjaGVjayBmb3Igd3JpdGUgYWN0aW9uCiAgICAgICAgJExheW91dE9iamVjdC0+Q2hhbGxlbmdlVG9rZW5DaGVjaygpOwoKICAgICAgICBteSAkSUQgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnSUQnICkgfHwgJyc7CgogICAgICAgICMgZ2V0IG5ldyBncm91cHMKICAgICAgICBteSAlUGVybWlzc2lvbnM7CiAgICAgICAgZm9yIG15ICRUeXBlICggQHsgJENvbmZpZ09iamVjdC0+R2V0KCdTeXN0ZW06OkN1c3RvbWVyOjpQZXJtaXNzaW9uJykgfSApIHsKICAgICAgICAgICAgbXkgQElEcyA9ICRQYXJhbU9iamVjdC0+R2V0QXJyYXkoIFBhcmFtID0+ICRUeXBlICk7CiAgICAgICAgICAgICRQZXJtaXNzaW9uc3skVHlwZX0gPSBcQElEczsKICAgICAgICB9CgogICAgICAgICMgZ2V0IGdyb3VwIGRhdGEKICAgICAgICBteSAlVXNlckRhdGEgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclNlYXJjaCgKICAgICAgICAgICAgU2VhcmNoID0+ICRQYXJhbXtDdXN0b21lclVzZXJTZWFyY2h9LAogICAgICAgICAgICBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICk7CgogICAgICAgIG15ICVOZXdQZXJtaXNzaW9uOwogICAgICAgIGZvciBteSAkVXNlcklEICggc29ydCBrZXlzICVVc2VyRGF0YSApIHsKCiAgICAgICAgICAgIGZvciBteSAkUGVybWlzc2lvbiAoIHNvcnQga2V5cyAlUGVybWlzc2lvbnMgKSB7CiAgICAgICAgICAgICAgICAkTmV3UGVybWlzc2lvbnskUGVybWlzc2lvbn0gPSAwOwogICAgICAgICAgICAgICAgbXkgQEFycmF5ID0gQHsgJFBlcm1pc3Npb25zeyRQZXJtaXNzaW9ufSB9OwogICAgICAgICAgICAgICAgZm9yIG15ICRJRCAoQEFycmF5KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCAkVXNlcklEIGVxICRJRCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJE5ld1Blcm1pc3Npb257JFBlcm1pc3Npb259ID0gMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJEN1c3RvbWVyR3JvdXBPYmplY3QtPkdyb3VwTWVtYmVyQWRkKAogICAgICAgICAgICAgICAgVUlEICAgICAgICA9PiAkVXNlcklELAogICAgICAgICAgICAgICAgR0lEICAgICAgICA9PiAkSUQsCiAgICAgICAgICAgICAgICBQZXJtaXNzaW9uID0+IFwlTmV3UGVybWlzc2lvbiwKICAgICAgICAgICAgICAgIFVzZXJJRCAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBJZiB0aGUgdXNlciB3b3VsZCBsaWtlIHRvIGNvbnRpbnVlIGVkaXRpbmcgdGhlIGN1c3RvbWVyIHVzZXIgcmVsYXRpb25zIGZvciBncm91cAogICAgICAgICMgICBqdXN0IHJlZGlyZWN0IHRvIHRoZSBlZGl0IHNjcmVlbi4KICAgICAgICBpZiAoCiAgICAgICAgICAgIGRlZmluZWQgJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0NvbnRpbnVlQWZ0ZXJTYXZlJyApCiAgICAgICAgICAgICYmICggJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0NvbnRpbnVlQWZ0ZXJTYXZlJyApIGVxICcxJyApCiAgICAgICAgICAgICkKICAgICAgICB7CiAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5SZWRpcmVjdCgKICAgICAgICAgICAgICAgIE9QID0+CiAgICAgICAgICAgICAgICAgICAgIkFjdGlvbj0kU2VsZi0+e0FjdGlvbn07U3ViYWN0aW9uPUdyb3VwO0lEPSRJRDtDdXN0b21lclVzZXJTZWFyY2g9JFBhcmFte0N1c3RvbWVyVXNlclNlYXJjaH0iCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+UmVkaXJlY3QoCiAgICAgICAgICAgICAgICBPUCA9PiAiQWN0aW9uPSRTZWxmLT57QWN0aW9ufTtDdXN0b21lclVzZXJTZWFyY2g9JFBhcmFte0N1c3RvbWVyVXNlclNlYXJjaH0iCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgICMgZ3JvdXBzIHRvIHVzZXIKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgIGVsc2lmICggJFNlbGYtPntTdWJhY3Rpb259IGVxICdDaGFuZ2VDdXN0b21lclVzZXInICkgewoKICAgICAgICAjIGNoYWxsZW5nZSB0b2tlbiBjaGVjayBmb3Igd3JpdGUgYWN0aW9uCiAgICAgICAgJExheW91dE9iamVjdC0+Q2hhbGxlbmdlVG9rZW5DaGVjaygpOwoKICAgICAgICBteSAkSUQgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnSUQnICk7CgogICAgICAgICMgZ2V0IG5ldyBncm91cHMKICAgICAgICBteSAlUGVybWlzc2lvbnM7CiAgICAgICAgZm9yIG15ICRUeXBlICggQHsgJENvbmZpZ09iamVjdC0+R2V0KCdTeXN0ZW06OkN1c3RvbWVyOjpQZXJtaXNzaW9uJykgfSApIHsKICAgICAgICAgICAgbXkgQElEcyA9ICRQYXJhbU9iamVjdC0+R2V0QXJyYXkoIFBhcmFtID0+ICRUeXBlICk7CiAgICAgICAgICAgICRQZXJtaXNzaW9uc3skVHlwZX0gPSBcQElEczsKICAgICAgICB9CgogICAgICAgICMgZ2V0IGdyb3VwIGRhdGEKICAgICAgICBteSAlR3JvdXBEYXRhID0gJEdyb3VwT2JqZWN0LT5Hcm91cExpc3QoIFZhbGlkID0+IDEgKTsKICAgICAgICBteSAlTmV3UGVybWlzc2lvbjsKICAgICAgICBmb3IgbXkgJEdyb3VwSUQgKCBzb3J0IGtleXMgJUdyb3VwRGF0YSApIHsKICAgICAgICAgICAgZm9yIG15ICRQZXJtaXNzaW9uICggc29ydCBrZXlzICVQZXJtaXNzaW9ucyApIHsKICAgICAgICAgICAgICAgICROZXdQZXJtaXNzaW9ueyRQZXJtaXNzaW9ufSA9IDA7CiAgICAgICAgICAgICAgICBteSBAQXJyYXkgPSBAeyAkUGVybWlzc2lvbnN7JFBlcm1pc3Npb259IH07CiAgICAgICAgICAgICAgICBmb3IgbXkgJElEIChAQXJyYXkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoICRHcm91cElEIGVxICRJRCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJE5ld1Blcm1pc3Npb257JFBlcm1pc3Npb259ID0gMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJEN1c3RvbWVyR3JvdXBPYmplY3QtPkdyb3VwTWVtYmVyQWRkKAogICAgICAgICAgICAgICAgVUlEICAgICAgICA9PiAkSUQsCiAgICAgICAgICAgICAgICBHSUQgICAgICAgID0+ICRHcm91cElELAogICAgICAgICAgICAgICAgUGVybWlzc2lvbiA9PiBcJU5ld1Blcm1pc3Npb24sCiAgICAgICAgICAgICAgICBVc2VySUQgICAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgSWYgdGhlIHVzZXIgd291bGQgbGlrZSB0byBjb250aW51ZSBlZGl0aW5nIHRoZSBncm91cCByZWxhdGlvbnMgZm9yIGN1c3RvbWVyIHVzZXIKICAgICAgICAjICAganVzdCByZWRpcmVjdCB0byB0aGUgZWRpdCBzY3JlZW4gYW5kIG90aGVyd2lzZSByZXR1cm4gdG8gcmVsYXRpb25zIG92ZXJ2aWV3LgogICAgICAgIGlmICgKICAgICAgICAgICAgZGVmaW5lZCAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQ29udGludWVBZnRlclNhdmUnICkKICAgICAgICAgICAgJiYgKCAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQ29udGludWVBZnRlclNhdmUnICkgZXEgJzEnICkKICAgICAgICAgICAgKQogICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPlJlZGlyZWN0KAogICAgICAgICAgICAgICAgT1AgPT4KICAgICAgICAgICAgICAgICAgICAiQWN0aW9uPSRTZWxmLT57QWN0aW9ufTtTdWJhY3Rpb249Q3VzdG9tZXJVc2VyO0lEPSRJRDtDdXN0b21lclVzZXJTZWFyY2g9JFBhcmFte0N1c3RvbWVyVXNlclNlYXJjaH0iCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+UmVkaXJlY3QoCiAgICAgICAgICAgICAgICBPUCA9PiAiQWN0aW9uPSRTZWxmLT57QWN0aW9ufTtDdXN0b21lclVzZXJTZWFyY2g9JFBhcmFte0N1c3RvbWVyVXNlclNlYXJjaH0iCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgICMgb3ZlcnZpZXcKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKCiAgICBteSAkT3V0cHV0ID0gJExheW91dE9iamVjdC0+SGVhZGVyKCk7CiAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk5hdmlnYXRpb25CYXIoKTsKCiAgICAjIHNlYXJjaCBjdXN0b21lciB1c2VyCiAgICBteSAlQ3VzdG9tZXJVc2VyTGlzdCA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyU2VhcmNoKAogICAgICAgIFNlYXJjaCA9PiAkUGFyYW17Q3VzdG9tZXJVc2VyU2VhcmNofSwKICAgICAgICBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9LAogICAgKTsKICAgIG15IEBDdXN0b21lclVzZXJLZXlMaXN0ID0gc29ydCB7ICRDdXN0b21lclVzZXJMaXN0eyRhfSBjbXAgJEN1c3RvbWVyVXNlckxpc3R7JGJ9IH0ga2V5cyAlQ3VzdG9tZXJVc2VyTGlzdDsKCiAgICAjIGNvdW50IHJlc3VsdHMKICAgIG15ICRDdXN0b21lclVzZXJDb3VudCA9IEBDdXN0b21lclVzZXJLZXlMaXN0OwoKICAgICMgICAgbXkgJEdyb3VwQ291bnQgICAgICA9IEBHcm91cExpc3Q7CgogICAgIyBzZXQgbWF4IGNvdW50CiAgICBteSAkTWF4Q3VzdG9tZXJDb3VudCA9ICRDdXN0b21lclVzZXJDb3VudDsKCiAgICAjICAgIG15ICRNYXhHcm91cENvdW50ICA9ICRHcm91cENvdW50OwoKICAgIGlmICggJE1heEN1c3RvbWVyQ291bnQgPiAkU2VhcmNoTGltaXQgKSB7CiAgICAgICAgJE1heEN1c3RvbWVyQ291bnQgPSAkU2VhcmNoTGltaXQ7CiAgICB9CgogICAgIyBvdXRwdXQgcm93cwogICAgbXkgJVVzZXJSb3dQYXJhbTsKICAgIGZvciBteSAkQ291bnRlciAoIDEgLi4gJE1heEN1c3RvbWVyQ291bnQgKSB7CgogICAgICAgICMgc2V0IGN1c3RvbWVyIHVzZXIgcm93IHBhcmFtcwogICAgICAgIGlmICggZGVmaW5lZCggJEN1c3RvbWVyVXNlcktleUxpc3RbICRDb3VudGVyIC0gMSBdICkgKSB7CgogICAgICAgICAgICAjIEdldCB1c2VyIGRldGFpbHMKICAgICAgICAgICAgbXkgJVVzZXIgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJEYXRhR2V0KAogICAgICAgICAgICAgICAgVXNlciA9PiAkQ3VzdG9tZXJVc2VyS2V5TGlzdFsgJENvdW50ZXIgLSAxIF0KICAgICAgICAgICAgKTsKICAgICAgICAgICAgbXkgJFVzZXJOYW1lID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJOYW1lKAogICAgICAgICAgICAgICAgVXNlckxvZ2luID0+ICRDdXN0b21lclVzZXJLZXlMaXN0WyAkQ291bnRlciAtIDEgXQogICAgICAgICAgICApOwogICAgICAgICAgICAkVXNlclJvd1BhcmFteyAkVXNlcntVc2VySUR9IH0gPSAiJFVzZXJOYW1lIDwkVXNlcntVc2VyRW1haWx9PiAoJFVzZXJ7VXNlckN1c3RvbWVySUR9KSI7CiAgICAgICAgfQogICAgfQoKICAgICMgZ2V0IGdyb3VwIGRhdGEKICAgIG15ICVHcm91cERhdGEgPSAkR3JvdXBPYmplY3QtPkdyb3VwTGlzdCggVmFsaWQgPT4gMSApOwoKICAgICRPdXRwdXQgLj0gJFNlbGYtPl9PdmVydmlldygKICAgICAgICBDdXN0b21lclVzZXJDb3VudCAgID0+ICRDdXN0b21lclVzZXJDb3VudCwKICAgICAgICBDdXN0b21lclVzZXJLZXlMaXN0ID0+IFxAQ3VzdG9tZXJVc2VyS2V5TGlzdCwKICAgICAgICBDdXN0b21lclVzZXJEYXRhICAgID0+IFwlVXNlclJvd1BhcmFtLAogICAgICAgIEdyb3VwRGF0YSAgICAgICAgICAgPT4gXCVHcm91cERhdGEsCiAgICAgICAgU2VhcmNoTGltaXQgICAgICAgICA9PiAkU2VhcmNoTGltaXQsCiAgICAgICAgQ3VzdG9tZXJVc2VyU2VhcmNoICA9PiAkUGFyYW17Q3VzdG9tZXJVc2VyU2VhcmNofSwKICAgICk7CgogICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5Gb290ZXIoKTsKICAgIHJldHVybiAkT3V0cHV0Owp9CgpzdWIgX0NoYW5nZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CiAgICBteSAkQ29uZmlnT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKTsKCiAgICBteSAlRGF0YSAgICAgICAgPSAleyAkUGFyYW17RGF0YX0gfTsKICAgIG15ICRUeXBlICAgICAgICA9ICRQYXJhbXtUeXBlfSB8fCAnQ3VzdG9tZXJVc2VyJzsKICAgIG15ICROZVR5cGUgICAgICA9ICRUeXBlIGVxICdHcm91cCcgPyAnQ3VzdG9tZXJVc2VyJyA6ICdHcm91cCc7CiAgICBteSAlVmlzaWJsZVR5cGUgPSAoCiAgICAgICAgQ3VzdG9tZXJVc2VyID0+ICdDdXN0b21lciBVc2VyJywKICAgICAgICBHcm91cCAgICAgICAgPT4gJ0dyb3VwJywKICAgICk7CiAgICBteSAkU2VhcmNoTGltaXQgPSAkUGFyYW17U2VhcmNoTGltaXR9OwoKICAgIG15IEBJdGVtTGlzdCA9ICgpOwoKICAgIGlmICggJFZpc2libGVUeXBleyROZVR5cGV9IGVxICdDdXN0b21lciBVc2VyJyApIHsKICAgICAgICAkUGFyYW17QnJlYWRjcnVtYlRpdGxlfSA9IFRyYW5zbGF0YWJsZSgiQ2hhbmdlIEN1c3RvbWVyIFVzZXIgUmVsYXRpb25zIGZvciBHcm91cCIpOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgJFBhcmFte0JyZWFkY3J1bWJUaXRsZX0gPSBUcmFuc2xhdGFibGUoJ0NoYW5nZSBHcm91cCBSZWxhdGlvbnMgZm9yIEN1c3RvbWVyIFVzZXInKTsKICAgIH0KCiAgICAjIG92ZXJ2aWV3CiAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICBOYW1lID0+ICdPdmVydmlldycsCiAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgT3ZlcnZpZXdMaW5rID0+ICRTZWxmLT57QWN0aW9ufSAuICc7Q3VzdG9tZXJVc2VyU2VhcmNoPScgLiAkUGFyYW17Q3VzdG9tZXJVc2VyU2VhcmNofSwKICAgICAgICB9LAogICAgKTsKICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKCBOYW1lID0+ICdBY3Rpb25MaXN0JyApOwogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnQWN0aW9uT3ZlcnZpZXcnLAogICAgICAgIERhdGEgPT4gewogICAgICAgICAgICBDdXN0b21lclVzZXJTZWFyY2ggPT4gJFBhcmFte0N1c3RvbWVyVXNlclNlYXJjaH0sCiAgICAgICAgfSwKICAgICk7CgogICAgaWYgKCAkTmVUeXBlIGVxICdDdXN0b21lclVzZXInICkgewogICAgICAgIEBJdGVtTGlzdCA9IEB7ICRQYXJhbXtJdGVtTGlzdH0gfTsKCiAgICAgICAgIyBvdXRwdXQgc2VhcmNoIGJsb2NrCiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ1NlYXJjaCcsCiAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgQ3VzdG9tZXJVc2VyU2VhcmNoID0+ICRQYXJhbXtDdXN0b21lclVzZXJTZWFyY2h9LAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ1NlYXJjaENoYW5nZUdyb3VwJywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICBTdWJhY3Rpb24gPT4gJFBhcmFte1N1YmFjdGlvbn0sCiAgICAgICAgICAgICAgICBHcm91cElEICAgPT4gJFBhcmFte0lEfSwKICAgICAgICAgICAgfSwKICAgICAgICApOwogICAgfQogICAgZWxzZSB7CgogICAgICAgICMgb3V0cHV0IGNvbmZpZyBzaG9ydGN1dCB0byBDdXN0b21lckFsd2F5c0dyb3VwcwogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKCBOYW1lID0+ICdBbHdheXNHcm91cHNDb25maWcnICk7CgogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKCBOYW1lID0+ICdGaWx0ZXInICk7CiAgICB9CgogICAgJExheW91dE9iamVjdC0+QmxvY2soIE5hbWUgPT4gJ05vdGUnICk7CgogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnQ2hhbmdlJywKICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICBBY3Rpb25Ib21lICAgID0+ICdBZG1pbicgLiAkVHlwZSwKICAgICAgICAgICAgVmlzaWJsZU5lVHlwZSA9PiAkVmlzaWJsZVR5cGV7JE5lVHlwZX0sCiAgICAgICAgICAgIFZpc2libGVUeXBlICAgPT4gJFZpc2libGVUeXBleyRUeXBlfSwKICAgICAgICAgICAgU3ViYWN0aW9uICAgICA9PiAkU2VsZi0+e1N1YmFjdGlvbn0sCiAgICAgICAgfSwKICAgICk7CgogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnQ2hhbmdlSGVhZGluZycgLiAkTmVUeXBlLAogICAgKTsKCiAgICBteSBAR3JvdXBQZXJtaXNzaW9uczsKCiAgICBUWVBFOgogICAgZm9yIG15ICRUeXBlICggQHsgJENvbmZpZ09iamVjdC0+R2V0KCdTeXN0ZW06OkN1c3RvbWVyOjpQZXJtaXNzaW9uJykgfSApIHsKICAgICAgICBuZXh0IFRZUEUgaWYgISRUeXBlOwogICAgICAgIG15ICRNYXJrID0gJFR5cGUgZXEgJ3J3JyA/ICJIaWdobGlnaHQiIDogJyc7CgogICAgICAgIHB1c2ggQEdyb3VwUGVybWlzc2lvbnMsICRUeXBlOwoKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnQ2hhbmdlSGVhZGVyJywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICBNYXJrID0+ICRNYXJrLAogICAgICAgICAgICAgICAgVHlwZSA9PiAkVHlwZSwKICAgICAgICAgICAgfSwKICAgICAgICApOwogICAgfQoKICAgICMgc2V0IGdyb3VwIHBlcm1pc3Npb25zCiAgICAkTGF5b3V0T2JqZWN0LT5BZGRKU0RhdGEoCiAgICAgICAgS2V5ICAgPT4gJ1JlbGF0aW9uSXRlbXMnLAogICAgICAgIFZhbHVlID0+IFxAR3JvdXBQZXJtaXNzaW9ucywKICAgICk7CgogICAgIyBjaGVjayBpZiB0aGVyZSBhcmUgZ3JvdXBzL2N1c3RvbWVycwogICAgaWYgKCAhJURhdGEgKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ05vRGF0YUZvdW5kTXNnTGlzdCcsCiAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgQ29sU3BhbiA9PiAzLAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICB9CgogICAgaWYgKCAkTmVUeXBlIGVxICdDdXN0b21lclVzZXInICkgewoKICAgICAgICAjIG91dHB1dCBjb3VudCBibG9jawogICAgICAgIGlmICggIUBJdGVtTGlzdCApIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdDaGFuZ2VJdGVtQ291bnRMaW1pdCcsCiAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICBJdGVtQ291bnQgPT4gMCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CgogICAgICAgIH0KICAgICAgICBlbHNpZiAoIEBJdGVtTGlzdCA+ICRTZWFyY2hMaW1pdCApIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdDaGFuZ2VJdGVtQ291bnRMaW1pdCcsCiAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICBJdGVtQ291bnQgPT4gIj4iIC4gJFNlYXJjaExpbWl0LAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgTmFtZSA9PiAnQ2hhbmdlSXRlbUNvdW50JywKICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgIEl0ZW1Db3VudCA9PiBzY2FsYXIgQEl0ZW1MaXN0LAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CgogICAgbXkgQEN1c3RvbWVyQWx3YXlzR3JvdXBzID0gQHsgJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lckdyb3VwQWx3YXlzR3JvdXBzJykgfTsKCiAgICBEQVRBSVRFTToKICAgIGZvciBteSAkSUQgKCBzb3J0IHsgdWMoICREYXRheyRhfSApIGNtcCB1YyggJERhdGF7JGJ9ICkgfSBrZXlzICVEYXRhICkgewoKICAgICAgICBuZXh0IERBVEFJVEVNIGlmICggZ3JlcCB7bS9cUSRQYXJhbXtEYXRhfS0+eyRJRH1cRS99IEBDdXN0b21lckFsd2F5c0dyb3VwcyApOwoKICAgICAgICAjIHNldCBvdXRwdXQgY2xhc3MKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnQ2hhbmdlUm93JywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICBOYW1lICAgPT4gJFBhcmFte0RhdGF9LT57JElEfSwKICAgICAgICAgICAgICAgIElEICAgICA9PiAkSUQsCiAgICAgICAgICAgICAgICBOZVR5cGUgPT4gJE5lVHlwZSwKICAgICAgICAgICAgfSwKICAgICAgICApOwoKICAgICAgICBUWVBFOgogICAgICAgIGZvciBteSAkVHlwZSAoIEB7ICRDb25maWdPYmplY3QtPkdldCgnU3lzdGVtOjpDdXN0b21lcjo6UGVybWlzc2lvbicpIH0gKSB7CiAgICAgICAgICAgIG5leHQgVFlQRSBpZiAhJFR5cGU7CiAgICAgICAgICAgIG15ICRNYXJrICAgICA9ICRUeXBlIGVxICdydycgICAgICAgID8gIkhpZ2hsaWdodCIgICAgICAgICAgOiAnJzsKICAgICAgICAgICAgbXkgJFNlbGVjdGVkID0gJFBhcmFteyRUeXBlfS0+eyRJRH0gPyAnIGNoZWNrZWQ9ImNoZWNrZWQiJyA6ICcnOwogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ0NoYW5nZVJvd0l0ZW0nLAogICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgICAgIE1hcmsgICAgID0+ICRNYXJrLAogICAgICAgICAgICAgICAgICAgIFR5cGUgICAgID0+ICRUeXBlLAogICAgICAgICAgICAgICAgICAgIElEICAgICAgID0+ICRJRCwKICAgICAgICAgICAgICAgICAgICBTZWxlY3RlZCA9PiAkU2VsZWN0ZWQsCiAgICAgICAgICAgICAgICAgICAgTmFtZSAgICAgPT4gJFBhcmFte0RhdGF9LT57JElEfSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgIGlmICggJFR5cGUgZXEgJ0N1c3RvbWVyVXNlcicgKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soIE5hbWUgPT4gJ0Fsd2F5c0dyb3VwcycgKTsKCiAgICAgICAgZm9yIG15ICRJRCAoIDEgLi4gQEN1c3RvbWVyQWx3YXlzR3JvdXBzICkgewogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ0Fsd2F5c0dyb3Vwc0xpc3QnLAogICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAkQ3VzdG9tZXJBbHdheXNHcm91cHNbICRJRCAtIDEgXSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKCBOYW1lID0+ICdSZWZlcmVuY2UnICk7CgogICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPk91dHB1dCgKICAgICAgICBUZW1wbGF0ZUZpbGUgPT4gJ0FkbWluQ3VzdG9tZXJVc2VyR3JvdXAnLAogICAgICAgIERhdGEgICAgICAgICA9PiBcJVBhcmFtLAogICAgKTsKfQoKc3ViIF9PdmVydmlldyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CiAgICBteSAkQ29uZmlnT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKTsKCiAgICBteSAkQ3VzdG9tZXJVc2VyQ291bnQgICA9ICRQYXJhbXtDdXN0b21lclVzZXJDb3VudH07CiAgICBteSBAQ3VzdG9tZXJVc2VyS2V5TGlzdCA9IEB7ICRQYXJhbXtDdXN0b21lclVzZXJLZXlMaXN0fSB9OwogICAgbXkgJUN1c3RvbWVyVXNlckRhdGEgICAgPSAleyAkUGFyYW17Q3VzdG9tZXJVc2VyRGF0YX0gfTsKICAgIG15ICVHcm91cERhdGEgICAgICAgICAgID0gJXsgJFBhcmFte0dyb3VwRGF0YX0gfTsKICAgIG15ICRTZWFyY2hMaW1pdCAgICAgICAgID0gJFBhcmFte1NlYXJjaExpbWl0fTsKCiAgICAjIG92ZXJ2aWV3CiAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICBOYW1lID0+ICdPdmVydmlldycsCiAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgT3ZlcnZpZXdMaW5rID0+ICRTZWxmLT57QWN0aW9ufSAuICc7Q3VzdG9tZXJVc2VyU2VhcmNoPScgLiAkUGFyYW17Q3VzdG9tZXJVc2VyU2VhcmNofSwKICAgICAgICB9CiAgICApOwoKICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKCBOYW1lID0+ICdBY3Rpb25MaXN0JyApOwoKICAgICMgb3V0cHV0IHNlYXJjaCBibG9jawogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnU2VhcmNoJywKICAgICAgICBEYXRhID0+IFwlUGFyYW0sCiAgICApOwoKICAgICMgT3V0cHV0IGNvbmZpZyBzaHV0Y3V0IHRvIEN1c3RvbWVyQWx3YXlzR3JvdXBzCiAgICAkTGF5b3V0T2JqZWN0LT5CbG9jayggTmFtZSA9PiAnQWx3YXlzR3JvdXBzQ29uZmlnJyApOwoKICAgICMgb3V0cHV0IGZpbHRlciBhbmQgZGVmYXVsdCBibG9jawogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnRmlsdGVyJywKICAgICk7CgogICAgIyBvdXRwdXQgcmVzdWx0IGJsb2NrCiAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICBOYW1lID0+ICdSZXN1bHQnLAogICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgfSwKICAgICk7CgogICAgIyBvdXRwdXQgY3VzdG9tZXIgdXNlciBjb3VudCBibG9jawogICAgaWYgKCAhQEN1c3RvbWVyVXNlcktleUxpc3QgKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ1Jlc3VsdEN1c3RvbWVyVXNlckNvdW50TGltaXQnLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgIEN1c3RvbWVyVXNlckNvdW50ID0+IDAsCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnTm9EYXRhRm91bmRNc2dDdXN0b21lcicsCiAgICAgICAgKTsKICAgIH0KICAgIGVsc2lmICggQEN1c3RvbWVyVXNlcktleUxpc3QgPiAkU2VhcmNoTGltaXQgKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ1Jlc3VsdEN1c3RvbWVyVXNlckNvdW50TGltaXQnLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgIEN1c3RvbWVyVXNlckNvdW50ID0+ICI+IiAuICRTZWFyY2hMaW1pdCwKICAgICAgICAgICAgfSwKICAgICAgICApOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ1Jlc3VsdEN1c3RvbWVyVXNlckNvdW50JywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBDdXN0b21lclVzZXJDb3VudCA9PiBzY2FsYXIgQEN1c3RvbWVyVXNlcktleUxpc3QsCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKICAgIH0KCiAgICBmb3IgbXkgJElEICgKICAgICAgICBzb3J0IHsgdWMoICRDdXN0b21lclVzZXJEYXRheyRhfSApIGNtcCB1YyggJEN1c3RvbWVyVXNlckRhdGF7JGJ9ICkgfQogICAgICAgIGtleXMgJUN1c3RvbWVyVXNlckRhdGEKICAgICAgICApCiAgICB7CgogICAgICAgICMgb3V0cHV0IHVzZXIgcm93IGJsb2NrCiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ0xpc3QxbicsCiAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgSUQgICAgICAgID0+ICRJRCwKICAgICAgICAgICAgICAgIE5hbWUgICAgICA9PiAkQ3VzdG9tZXJVc2VyRGF0YXskSUR9LAogICAgICAgICAgICAgICAgU3ViYWN0aW9uID0+ICdDdXN0b21lclVzZXInLAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICB9CgogICAgbXkgQEN1c3RvbWVyQWx3YXlzR3JvdXBzID0gQHsgJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lckdyb3VwQWx3YXlzR3JvdXBzJykgfTsKCiAgICBpZiAoJUdyb3VwRGF0YSkgewogICAgICAgIEdST1VQOgogICAgICAgIGZvciBteSAkSUQgKAogICAgICAgICAgICBzb3J0IHsgdWMoICRHcm91cERhdGF7JGF9ICkgY21wIHVjKCAkR3JvdXBEYXRheyRifSApIH0KICAgICAgICAgICAga2V5cyAlR3JvdXBEYXRhCiAgICAgICAgICAgICkKICAgICAgICB7CiAgICAgICAgICAgIG5leHQgR1JPVVAgaWYgKCBncmVwIHttL1xRJEdyb3VwRGF0YXskSUR9XEUvfSBAQ3VzdG9tZXJBbHdheXNHcm91cHMgKTsKCiAgICAgICAgICAgICMgb3V0cHV0IGdvcnVwIGJsb2NrCiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgTmFtZSA9PiAnTGlzdG4xJywKICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgICAgICBJRCAgICAgICAgPT4gJElELAogICAgICAgICAgICAgICAgICAgIE5hbWUgICAgICA9PiAkR3JvdXBEYXRheyRJRH0sCiAgICAgICAgICAgICAgICAgICAgU3ViYWN0aW9uID0+ICdHcm91cCcsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KICAgIGVsc2UgewogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdOb0RhdGFGb3VuZE1zZ0dyb3VwJywKICAgICAgICAgICAgRGF0YSA9PiB7fSwKICAgICAgICApOwogICAgfQoKICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKCBOYW1lID0+ICdBbHdheXNHcm91cHMnICk7CgogICAgZm9yIG15ICRJRCAoIDEgLi4gQEN1c3RvbWVyQWx3YXlzR3JvdXBzICkgewogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdBbHdheXNHcm91cHNMaXN0JywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBOYW1lID0+ICRDdXN0b21lckFsd2F5c0dyb3Vwc1sgJElEIC0gMSBdLAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICB9CgogICAgIyByZXR1cm4gb3V0cHV0CiAgICByZXR1cm4gJExheW91dE9iamVjdC0+T3V0cHV0KAogICAgICAgIFRlbXBsYXRlRmlsZSA9PiAnQWRtaW5DdXN0b21lclVzZXJHcm91cCcsCiAgICAgICAgRGF0YSAgICAgICAgID0+IFwlUGFyYW0sCiAgICApOwoKfQoKc3ViIF9EaXNhYmxlZCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnT3ZlcnZpZXcnLAogICAgICAgIERhdGEgPT4gewogICAgICAgICAgICBPdmVydmlld0xpbmsgPT4gJFNlbGYtPntBY3Rpb259LAogICAgICAgIH0sCiAgICApOwoKICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKCBOYW1lID0+ICdEaXNhYmxlZCcgKTsKCiAgICAjIHJldHVybiBvdXRwdXQKICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5PdXRwdXQoCiAgICAgICAgVGVtcGxhdGVGaWxlID0+ICdBZG1pbkN1c3RvbWVyVXNlckdyb3VwJywKICAgICAgICBEYXRhICAgICAgICAgPT4gXCVQYXJhbSwKICAgICk7Cn0KCjE7Cg==</File>
        <File Location="Custom/Kernel/Modules/AdminCustomerUser.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxLTIwMjIgWm51bnkgR21iSCwgaHR0cHM6Ly96bnVueS5vcmcvCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6TW9kdWxlczo6QWRtaW5DdXN0b21lclVzZXI7Cgp1c2Ugc3RyaWN0Owp1c2Ugd2FybmluZ3M7Cgp1c2UgS2VybmVsOjpTeXN0ZW06OkNoZWNrSXRlbTsKdXNlIEtlcm5lbDo6U3lzdGVtOjpWYXJpYWJsZUNoZWNrIHF3KDphbGwpOwp1c2UgS2VybmVsOjpMYW5ndWFnZSBxdyhUcmFuc2xhdGFibGUpOwoKb3VyICRPYmplY3RNYW5hZ2VyRGlzYWJsZWQgPSAxOwoKc3ViIG5ldyB7CiAgICBteSAoICRUeXBlLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgYWxsb2NhdGUgbmV3IGhhc2ggZm9yIG9iamVjdAogICAgbXkgJFNlbGYgPSB7JVBhcmFtfTsKICAgIGJsZXNzKCAkU2VsZiwgJFR5cGUgKTsKCiAgICBteSAkRHluYW1pY0ZpZWxkQ29uZmlncyA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEeW5hbWljRmllbGQnKS0+RHluYW1pY0ZpZWxkTGlzdEdldCgKICAgICAgICBPYmplY3RUeXBlID0+ICdDdXN0b21lclVzZXInLAogICAgKTsKCiAgICAkU2VsZi0+e0R5bmFtaWNGaWVsZExvb2t1cH0gPSB7IG1hcCB7ICRfLT57TmFtZX0gPT4gJF8gfSBAeyREeW5hbWljRmllbGRDb25maWdzfSB9OwoKICAgIHJldHVybiAkU2VsZjsKfQoKc3ViIFJ1biB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRQYXJhbU9iamVjdCAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6V2ViOjpSZXF1ZXN0Jyk7CiAgICBteSAkQ29uZmlnT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKTsKCiAgICBteSAkTmF2ICAgID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ05hdicgKSAgICB8fCAnJzsKICAgIG15ICRTb3VyY2UgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnU291cmNlJyApIHx8ICdDdXN0b21lclVzZXInOwogICAgbXkgJFNlYXJjaCA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdTZWFyY2gnICk7CiAgICAkU2VhcmNoCiAgICAgICAgfHw9ICRDb25maWdPYmplY3QtPkdldCgnQWRtaW5DdXN0b21lclVzZXI6OlJ1bkluaXRpYWxXaWxkY2FyZFNlYXJjaCcpID8gJyonIDogJyc7CgogICAgIyBjcmVhdGUgbG9jYWwgb2JqZWN0CiAgICBteSAkQ2hlY2tJdGVtT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNoZWNrSXRlbScpOwoKICAgIG15ICROYXZCYXIgICAgICAgPSAnJzsKICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CiAgICBpZiAoICROYXYgZXEgJ05vbmUnICkgewogICAgICAgICROYXZCYXIgPSAkTGF5b3V0T2JqZWN0LT5IZWFkZXIoIFR5cGUgPT4gJ1NtYWxsJyApOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgJE5hdkJhciA9ICRMYXlvdXRPYmplY3QtPkhlYWRlcigpOwogICAgICAgICROYXZCYXIgLj0gJExheW91dE9iamVjdC0+TmF2aWdhdGlvbkJhcigKICAgICAgICAgICAgVHlwZSA9PiAkTmF2IGVxICdBZ2VudCcgPyAnQ3VzdG9tZXJzJyA6ICdBZG1pbicsCiAgICAgICAgKTsKICAgIH0KCiAgICAjIEdldCBsaXN0IG9mIHZhbGlkIElEcy4KICAgIG15IEBWYWxpZElETGlzdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpWYWxpZCcpLT5WYWxpZElEc0dldCgpOwoKICAgICMgY2hlY2sgdGhlIHBlcm1pc3Npb24gZm9yIHRoZSBTd2l0Y2hUb0N1c3RvbWVyIGZlYXR1cmUKICAgIGlmICggJENvbmZpZ09iamVjdC0+R2V0KCdTd2l0Y2hUb0N1c3RvbWVyJykgKSB7CgogICAgICAgIG15ICRHcm91cE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpHcm91cCcpOwoKICAgICAgICAjIGdldCB0aGUgZ3JvdXAgaWQgd2hpY2ggaXMgYWxsb3dlZCB0byB1c2UgdGhlIHN3aXRjaCB0byBjdXN0b21lciBmZWF0dXJlCiAgICAgICAgbXkgJFN3aXRjaFRvQ3VzdG9tZXJHcm91cElEID0gJEdyb3VwT2JqZWN0LT5Hcm91cExvb2t1cCgKICAgICAgICAgICAgR3JvdXAgPT4gJENvbmZpZ09iamVjdC0+R2V0KCdTd2l0Y2hUb0N1c3RvbWVyOjpQZXJtaXNzaW9uR3JvdXAnKSwKICAgICAgICApOwoKICAgICAgICAjIGdldCB1c2VyIGdyb3Vwcywgd2hlcmUgdGhlIHVzZXIgaGFzIHRoZSBydyBwcml2aWxlZ2UKICAgICAgICBteSAlR3JvdXBzID0gJEdyb3VwT2JqZWN0LT5QZXJtaXNzaW9uVXNlckdldCgKICAgICAgICAgICAgVXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgVHlwZSAgID0+ICdydycsCiAgICAgICAgKTsKCiAgICAgICAgIyBpZiB0aGUgdXNlciBpcyBhIG1lbWJlciBpbiB0aGlzIGdyb3VwIGhlIGNhbiBhY2Nlc3MgdGhlIGZlYXR1cmUKICAgICAgICBpZiAoICRHcm91cHN7JFN3aXRjaFRvQ3VzdG9tZXJHcm91cElEfSApIHsKICAgICAgICAgICAgJFNlbGYtPntTd2l0Y2hUb0N1c3RvbWVyUGVybWlzc2lvbn0gPSAxOwogICAgICAgIH0KICAgIH0KCiAgICBteSAkQ3VzdG9tZXJVc2VyT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyVXNlcicpOwogICAgbXkgJE1haW5PYmplY3QgICAgICAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpNYWluJyk7CgogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gIwogICAgIyAgc3dpdGNoIHRvIGN1c3RvbWVyCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICBpZiAoCiAgICAgICAgJFNlbGYtPntTdWJhY3Rpb259IGVxICdTd2l0Y2gnCiAgICAgICAgJiYgJENvbmZpZ09iamVjdC0+R2V0KCdTd2l0Y2hUb0N1c3RvbWVyJykKICAgICAgICAmJiAkU2VsZi0+e1N3aXRjaFRvQ3VzdG9tZXJQZXJtaXNzaW9ufQogICAgICAgICkKICAgIHsKCiAgICAgICAgIyBjaGFsbGVuZ2UgdG9rZW4gY2hlY2sgZm9yIHdyaXRlIGFjdGlvbgogICAgICAgICRMYXlvdXRPYmplY3QtPkNoYWxsZW5nZVRva2VuQ2hlY2soKTsKCiAgICAgICAgIyBnZXQgdXNlciBkYXRhCiAgICAgICAgbXkgJFVzZXJJRCAgID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0lEJyApIHx8ICcnOwogICAgICAgIG15ICVVc2VyRGF0YSA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyVXNlckRhdGFHZXQoCiAgICAgICAgICAgIFVzZXIgID0+ICRVc2VySUQsCiAgICAgICAgICAgIFZhbGlkID0+IDEsCiAgICAgICAgKTsKCiAgICAgICAgIyBjcmVhdGUgbmV3IHNlc3Npb24gaWQKICAgICAgICBteSAkTmV3U2Vzc2lvbklEID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkF1dGhTZXNzaW9uJyktPkNyZWF0ZVNlc3Npb25JRCgKICAgICAgICAgICAgJVVzZXJEYXRhLAogICAgICAgICAgICBVc2VyTGFzdFJlcXVlc3QgPT4gJEtlcm5lbDo6T00tPkNyZWF0ZSgnS2VybmVsOjpTeXN0ZW06OkRhdGVUaW1lJyktPlRvRXBvY2goKSwKICAgICAgICAgICAgVXNlclR5cGUgICAgICAgID0+ICdDdXN0b21lcicsCiAgICAgICAgICAgIFNlc3Npb25Tb3VyY2UgICA9PiAnQ3VzdG9tZXJJbnRlcmZhY2UnLAogICAgICAgICk7CgogICAgICAgICMgZ2V0IGN1c3RvbWVyIGludGVyZmFjZSBzZXNzaW9uIG5hbWUKICAgICAgICBteSAkU2Vzc2lvbk5hbWUgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0N1c3RvbWVyUGFuZWxTZXNzaW9uTmFtZScpIHx8ICdDU0lEJzsKCiAgICAgICAgIyBjcmVhdGUgYSBuZXcgTGF5b3V0T2JqZWN0IHdpdGggU2Vzc2lvbklEQ29va2llCiAgICAgICAgbXkgJEV4cGlyZXMgPSAnKycgLiAkQ29uZmlnT2JqZWN0LT5HZXQoJ1Nlc3Npb25NYXhUaW1lJykgLiAncyc7CiAgICAgICAgaWYgKCAhJENvbmZpZ09iamVjdC0+R2V0KCdTZXNzaW9uVXNlQ29va2llQWZ0ZXJCcm93c2VyQ2xvc2UnKSApIHsKICAgICAgICAgICAgJEV4cGlyZXMgPSAnJzsKICAgICAgICB9CgogICAgICAgIG15ICRTZWN1cmVBdHRyaWJ1dGU7CiAgICAgICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ0h0dHBUeXBlJykgZXEgJ2h0dHBzJyApIHsKCiAgICAgICAgICAgICMgUmVzdHJpY3QgQ29va2llIHRvIEhUVFBTIGlmIGl0IGlzIHVzZWQuCiAgICAgICAgICAgICRTZWN1cmVBdHRyaWJ1dGUgPSAxOwogICAgICAgIH0KCiAgICAgICAgbXkgJExheW91dE9iamVjdCA9IEtlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQtPm5ldygKICAgICAgICAgICAgJXskU2VsZn0sCiAgICAgICAgICAgIFNldENvb2tpZXMgPT4gewogICAgICAgICAgICAgICAgU2Vzc2lvbklEQ29va2llID0+ICRQYXJhbU9iamVjdC0+U2V0Q29va2llKAogICAgICAgICAgICAgICAgICAgIEtleSAgICAgID0+ICRTZXNzaW9uTmFtZSwKICAgICAgICAgICAgICAgICAgICBWYWx1ZSAgICA9PiAkTmV3U2Vzc2lvbklELAogICAgICAgICAgICAgICAgICAgIEV4cGlyZXMgID0+ICRFeHBpcmVzLAogICAgICAgICAgICAgICAgICAgIFBhdGggICAgID0+ICRDb25maWdPYmplY3QtPkdldCgnU2NyaXB0QWxpYXMnKSwKICAgICAgICAgICAgICAgICAgICBTZWN1cmUgICA9PiBzY2FsYXIgJFNlY3VyZUF0dHJpYnV0ZSwKICAgICAgICAgICAgICAgICAgICBIVFRQT25seSA9PiAxLAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2Vzc2lvbklEICAgPT4gJE5ld1Nlc3Npb25JRCwKICAgICAgICAgICAgU2Vzc2lvbk5hbWUgPT4gJENvbmZpZ09iamVjdC0+R2V0KCdTZXNzaW9uTmFtZScpLAogICAgICAgICk7CgogICAgICAgICMgbG9nIGV2ZW50CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdub3RpY2UnLAogICAgICAgICAgICBNZXNzYWdlID0+CiAgICAgICAgICAgICAgICAiU3dpdGNoZWQgZnJvbSBBZ2VudCB0byBDdXN0b21lciAoJFNlbGYtPntVc2VyTG9naW59IC09PiAkVXNlckRhdGF7VXNlckxvZ2lufSkiLAogICAgICAgICk7CgogICAgICAgICMgYnVpbGQgVVJMIHRvIGN1c3RvbWVyIGludGVyZmFjZQogICAgICAgIG15ICRVUkwgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0h0dHBUeXBlJykKICAgICAgICAgICAgLiAnOi8vJwogICAgICAgICAgICAuICRDb25maWdPYmplY3QtPkdldCgnRlFETicpCiAgICAgICAgICAgIC4gJy8nCiAgICAgICAgICAgIC4gJENvbmZpZ09iamVjdC0+R2V0KCdTY3JpcHRBbGlhcycpCiAgICAgICAgICAgIC4gJ2N1c3RvbWVyLnBsJzsKCiAgICAgICAgIyBpZiBubyBzZXNzaW9ucyBhcmUgdXNlZCB3ZSBhdHRhY2ggdGhlIHNlc3Npb24gYXMgVVJMIHBhcmFtZXRlcgogICAgICAgIGlmICggISRDb25maWdPYmplY3QtPkdldCgnU2Vzc2lvblVzZUNvb2tpZScpICkgewogICAgICAgICAgICAkVVJMIC49ICI/JFNlc3Npb25OYW1lPSROZXdTZXNzaW9uSUQiOwogICAgICAgIH0KCiAgICAgICAgIyByZWRpcmVjdCB0byBjdXN0b21lciBpbnRlcmZhY2Ugd2l0aCBuZXcgc2Vzc2lvbiBpZAogICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5SZWRpcmVjdCggRXh0VVJMID0+ICRVUkwgKTsKICAgIH0KCiAgICAjIHNlYXJjaCB1c2VyIGxpc3QKICAgIGlmICggJFNlbGYtPntTdWJhY3Rpb259IGVxICdTZWFyY2gnICkgewogICAgICAgICRTZWxmLT5fT3ZlcnZpZXcoCiAgICAgICAgICAgIE5hdiAgICA9PiAkTmF2LAogICAgICAgICAgICBTZWFyY2ggPT4gJFNlYXJjaCwKICAgICAgICApOwogICAgICAgIG15ICRPdXRwdXQgPSAkTmF2QmFyOwogICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+T3V0cHV0KAogICAgICAgICAgICBUZW1wbGF0ZUZpbGUgPT4gJ0FkbWluQ3VzdG9tZXJVc2VyJywKICAgICAgICAgICAgRGF0YSAgICAgICAgID0+IFwlUGFyYW0sCiAgICAgICAgKTsKCiAgICAgICAgaWYgKCAkTmF2IGVxICdOb25lJyApIHsKICAgICAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5Gb290ZXIoIFR5cGUgPT4gJ1NtYWxsJyApOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5Gb290ZXIoKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkT3V0cHV0OwogICAgfQoKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgICMgZG93bmxvYWQgZmlsZSBwcmVmZXJlbmNlcwogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gIwogICAgZWxzaWYgKCAkU2VsZi0+e1N1YmFjdGlvbn0gZXEgJ0Rvd25sb2FkJyApIHsKICAgICAgICBteSAkR3JvdXAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnR3JvdXAnICkgfHwgJyc7CiAgICAgICAgbXkgJFVzZXIgID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0lEJyApICAgIHx8ICcnOwogICAgICAgIG15ICRGaWxlICA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdGaWxlJyApICB8fCAnJzsKCiAgICAgICAgIyBnZXQgdXNlciBkYXRhCiAgICAgICAgbXkgJVVzZXJEYXRhICAgID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJVc2VyRGF0YUdldCggVXNlciA9PiAkVXNlciApOwogICAgICAgIG15ICVQcmVmZXJlbmNlcyA9ICV7ICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXJQcmVmZXJlbmNlc0dyb3VwcycpIH07CiAgICAgICAgbXkgJE1vZHVsZSAgICAgID0gJFByZWZlcmVuY2VzeyRHcm91cH0tPntNb2R1bGV9OwogICAgICAgIGlmICggISRNYWluT2JqZWN0LT5SZXF1aXJlKCRNb2R1bGUpICkgewogICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigpOwogICAgICAgIH0KICAgICAgICBteSAkT2JqZWN0ID0gJE1vZHVsZS0+bmV3KAogICAgICAgICAgICAleyRTZWxmfSwKICAgICAgICAgICAgQ29uZmlnSXRlbSA9PiAkUHJlZmVyZW5jZXN7JEdyb3VwfSwKICAgICAgICAgICAgVXNlck9iamVjdCA9PiAkQ3VzdG9tZXJVc2VyT2JqZWN0LAogICAgICAgICAgICBEZWJ1ZyAgICAgID0+ICRTZWxmLT57RGVidWd9LAogICAgICAgICk7CiAgICAgICAgbXkgJUZpbGUgPSAkT2JqZWN0LT5Eb3dubG9hZCggVXNlckRhdGEgPT4gXCVVc2VyRGF0YSApOwoKICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+QXR0YWNobWVudCglRmlsZSk7CiAgICB9CgogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gIwogICAgIyBjaGFuZ2UKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgIGVsc2lmICggJFNlbGYtPntTdWJhY3Rpb259IGVxICdDaGFuZ2UnICkgewogICAgICAgIG15ICRVc2VyICAgICAgICAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnSUQnICkgICAgICAgICAgIHx8ICcnOwogICAgICAgIG15ICROb3RpZmljYXRpb24gPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnTm90aWZpY2F0aW9uJyApIHx8ICcnOwoKICAgICAgICAjIGdldCB1c2VyIGRhdGEKICAgICAgICBteSAlVXNlckRhdGEgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJEYXRhR2V0KCBVc2VyID0+ICRVc2VyICk7CgogICAgICAgIG15ICRPdXRwdXQgPSAkTmF2QmFyOwogICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Tm90aWZ5KCBJbmZvID0+IFRyYW5zbGF0YWJsZSgnQ3VzdG9tZXIgdXBkYXRlZCEnKSApCiAgICAgICAgICAgIGlmICggJE5vdGlmaWNhdGlvbiAmJiAkTm90aWZpY2F0aW9uIGVxICdVcGRhdGUnICk7CiAgICAgICAgJE91dHB1dCAuPSAkU2VsZi0+X0VkaXQoCiAgICAgICAgICAgIE5hdiAgICA9PiAkTmF2LAogICAgICAgICAgICBBY3Rpb24gPT4gJ0NoYW5nZScsCiAgICAgICAgICAgIFNvdXJjZSA9PiAkU291cmNlLAogICAgICAgICAgICBTZWFyY2ggPT4gJFNlYXJjaCwKICAgICAgICAgICAgSUQgICAgID0+ICRVc2VyLAogICAgICAgICAgICAlVXNlckRhdGEsCiAgICAgICAgKTsKCiAgICAgICAgaWYgKCAkTmF2IGVxICdOb25lJyApIHsKICAgICAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5Gb290ZXIoIFR5cGUgPT4gJ1NtYWxsJyApOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5Gb290ZXIoKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkT3V0cHV0OwogICAgfQoKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgICMgY2hhbmdlIGFjdGlvbgogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gIwogICAgZWxzaWYgKCAkU2VsZi0+e1N1YmFjdGlvbn0gZXEgJ0NoYW5nZUFjdGlvbicgKSB7CgogICAgICAgICMgY2hhbGxlbmdlIHRva2VuIGNoZWNrIGZvciB3cml0ZSBhY3Rpb24KICAgICAgICAkTGF5b3V0T2JqZWN0LT5DaGFsbGVuZ2VUb2tlbkNoZWNrKCk7CgogICAgICAgICMgdXBkYXRlIG9ubHkgdGhlIHByZWZlcmVuY2VzIGFuZCBkeW5hbWljIGZpZWxkcywgaWYgdGhlIHNvdXJjZSBpcyByZWFkb25seSBvciBhIGxkYXAgYmFja2VuZAogICAgICAgIG15ICRVcGRhdGVPbmx5UHJlZmVyZW5jZXM7CgogICAgICAgIGlmICggJENvbmZpZ09iamVjdC0+R2V0KCRTb3VyY2UpLT57UmVhZE9ubHl9IHx8ICRDb25maWdPYmplY3QtPkdldCgkU291cmNlKS0+e01vZHVsZX0gPX4gL0xEQVAvaSApIHsKICAgICAgICAgICAgJFVwZGF0ZU9ubHlQcmVmZXJlbmNlcyA9IDE7CiAgICAgICAgfQoKICAgICAgICBteSAkTm90ZSA9ICcnOwogICAgICAgIG15ICggJUdldFBhcmFtLCAlRXJyb3JzICk7CgogICAgICAgICMgR2V0IGR5bmFtaWMgZmllbGQgYmFja2VuZCBvYmplY3QuCiAgICAgICAgbXkgJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6RHluYW1pY0ZpZWxkOjpCYWNrZW5kJyk7CgogICAgICAgIEVOVFJZOgogICAgICAgIGZvciBteSAkRW50cnkgKCBAeyAkQ29uZmlnT2JqZWN0LT5HZXQoJFNvdXJjZSktPntNYXB9IH0gKSB7CgogICAgICAgICAgICAjIGNoZWNrIGR5bmFtaWMgZmllbGRzCiAgICAgICAgICAgIGlmICggJEVudHJ5LT5bNV0gZXEgJ2R5bmFtaWNfZmllbGQnICkgewoKICAgICAgICAgICAgICAgIG15ICREeW5hbWljRmllbGRDb25maWcgPSAkU2VsZi0+e0R5bmFtaWNGaWVsZExvb2t1cH0tPnsgJEVudHJ5LT5bMl0gfTsKCiAgICAgICAgICAgICAgICBpZiAoICFJc0hhc2hSZWZXaXRoRGF0YSgkRHluYW1pY0ZpZWxkQ29uZmlnKSApIHsKICAgICAgICAgICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIkR5bmFtaWNGaWVsZCAkRW50cnktPlsyXSBub3QgZm91bmQhIiwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIG5leHQgRU5UUlk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbXkgJFZhbGlkYXRpb25SZXN1bHQgPSAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdC0+RWRpdEZpZWxkVmFsdWVWYWxpZGF0ZSgKICAgICAgICAgICAgICAgICAgICBEeW5hbWljRmllbGRDb25maWcgPT4gJER5bmFtaWNGaWVsZENvbmZpZywKICAgICAgICAgICAgICAgICAgICBQYXJhbU9iamVjdCAgICAgICAgPT4gJFBhcmFtT2JqZWN0LAogICAgICAgICAgICAgICAgICAgIE1hbmRhdG9yeSAgICAgICAgICA9PiAkRW50cnktPls0XSwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgaWYgKCAkVmFsaWRhdGlvblJlc3VsdC0+e1NlcnZlckVycm9yfSApIHsKICAgICAgICAgICAgICAgICAgICAkRXJyb3JzeyAkRW50cnktPlswXSB9ID0gJFZhbGlkYXRpb25SZXN1bHQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKCiAgICAgICAgICAgICAgICAgICAgIyBnZW5lcmF0ZSBzdG9yYWJsZSB2YWx1ZSBvZiBkeW5hbWljIGZpZWxkIGVkaXQgZmllbGQKICAgICAgICAgICAgICAgICAgICAkR2V0UGFyYW17ICRFbnRyeS0+WzBdIH0gPSAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdC0+RWRpdEZpZWxkVmFsdWVHZXQoCiAgICAgICAgICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZENvbmZpZyA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnLAogICAgICAgICAgICAgICAgICAgICAgICBQYXJhbU9iamVjdCAgICAgICAgPT4gJFBhcmFtT2JqZWN0LAogICAgICAgICAgICAgICAgICAgICAgICBMYXlvdXRPYmplY3QgICAgICAgPT4gJExheW91dE9iamVjdCwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGNoZWNrIHJlbWFpbmluZyBub24tZHluYW1pYy1maWVsZCBtYW5kYXRvcnkgZmllbGRzCiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJEdldFBhcmFteyAkRW50cnktPlswXSB9ID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJEVudHJ5LT5bMF0gKSB8fCAnJzsKCiAgICAgICAgICAgICAgICBuZXh0IEVOVFJZIGlmICRVcGRhdGVPbmx5UHJlZmVyZW5jZXM7CgogICAgICAgICAgICAgICAgaWYgKCAhJEdldFBhcmFteyAkRW50cnktPlswXSB9ICYmICRFbnRyeS0+WzRdICkgewogICAgICAgICAgICAgICAgICAgICRFcnJvcnN7ICRFbnRyeS0+WzBdIC4gJ0ludmFsaWQnIH0gPSAnU2VydmVyRXJyb3InOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICRHZXRQYXJhbXtJRH0gPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnSUQnICkgfHwgJyc7CgogICAgICAgICMgY2hlY2sgZW1haWwgYWRkcmVzcwogICAgICAgIGlmICgKICAgICAgICAgICAgISRVcGRhdGVPbmx5UHJlZmVyZW5jZXMKICAgICAgICAgICAgJiYgJEdldFBhcmFte1VzZXJFbWFpbH0KICAgICAgICAgICAgJiYgISRDaGVja0l0ZW1PYmplY3QtPkNoZWNrRW1haWwoIEFkZHJlc3MgPT4gJEdldFBhcmFte1VzZXJFbWFpbH0gKQogICAgICAgICAgICAmJiBncmVwIHsgJF8gZXEgJEdldFBhcmFte1ZhbGlkSUR9IH0gQFZhbGlkSURMaXN0CiAgICAgICAgICAgICkKICAgICAgICB7CiAgICAgICAgICAgICRFcnJvcnN7VXNlckVtYWlsSW52YWxpZH0gPSAnU2VydmVyRXJyb3InOwogICAgICAgICAgICAkRXJyb3Jze0Vycm9yVHlwZX0gICAgICAgID0gJENoZWNrSXRlbU9iamVjdC0+Q2hlY2tFcnJvclR5cGUoKSAuICdTZXJ2ZXJFcnJvck1zZyc7CiAgICAgICAgfQoKICAgICAgICAjIEdldCB0aGUgY3VycmVudCB1c2VyIGRhdGEgZm9yIHNvbWUgY2hlY2tzLgogICAgICAgIG15ICVDdXJyZW50VXNlckRhdGEgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJEYXRhR2V0KAogICAgICAgICAgICBVc2VyID0+ICRHZXRQYXJhbXtJRH0sCiAgICAgICAgKTsKCiAgICAgICAgIyBDaGVjayBDdXN0b21lcklELCBpZiBDdXN0b21lckNvbXBhbnlTdXBwb3J0IGlzIGVuYWJsZWQgYW5kIHRoZSBVc2VyQ3VzdG9tZXJJRCB3YXMgY2hhbmdlZC4KICAgICAgICBpZiAoCiAgICAgICAgICAgICRDb25maWdPYmplY3QtPkdldCgkU291cmNlKS0+e0N1c3RvbWVyQ29tcGFueVN1cHBvcnR9CiAgICAgICAgICAgICYmICRHZXRQYXJhbXtVc2VyQ3VzdG9tZXJJRH0KICAgICAgICAgICAgJiYgJEN1cnJlbnRVc2VyRGF0YXtVc2VyQ3VzdG9tZXJJRH0gbmUgJEdldFBhcmFte1VzZXJDdXN0b21lcklEfQogICAgICAgICAgICApCiAgICAgICAgewoKICAgICAgICAgICAgbXkgJUNvbXBhbnkgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q3VzdG9tZXJDb21wYW55JyktPkN1c3RvbWVyQ29tcGFueUdldCgKICAgICAgICAgICAgICAgIEN1c3RvbWVySUQgPT4gJEdldFBhcmFte1VzZXJDdXN0b21lcklEfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGlmICggISVDb21wYW55ICkgewogICAgICAgICAgICAgICAgJEVycm9yc3tVc2VyQ3VzdG9tZXJJREludmFsaWR9ID0gJ1NlcnZlckVycm9yJzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBpZiBubyBlcnJvcnMgb2NjdXJyZWQKICAgICAgICBpZiAoICElRXJyb3JzICkgewoKICAgICAgICAgICAgbXkgJFVwZGF0ZVN1Y2Nlc3M7CiAgICAgICAgICAgIGlmICggISRVcGRhdGVPbmx5UHJlZmVyZW5jZXMgKSB7CiAgICAgICAgICAgICAgICAkVXBkYXRlU3VjY2VzcyA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyVXNlclVwZGF0ZSgKICAgICAgICAgICAgICAgICAgICAlR2V0UGFyYW0sCiAgICAgICAgICAgICAgICAgICAgVXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICggJFVwZGF0ZVN1Y2Nlc3MgfHwgJFVwZGF0ZU9ubHlQcmVmZXJlbmNlcyApIHsKCiAgICAgICAgICAgICAgICAjIHNldCBkeW5hbWljIGZpZWxkIHZhbHVlcwogICAgICAgICAgICAgICAgbXkgJER5bmFtaWNGaWVsZE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEeW5hbWljRmllbGQnKTsKCiAgICAgICAgICAgICAgICBFTlRSWToKICAgICAgICAgICAgICAgIGZvciBteSAkRW50cnkgKCBAeyAkQ29uZmlnT2JqZWN0LT5HZXQoJFNvdXJjZSktPntNYXB9IH0gKSB7CiAgICAgICAgICAgICAgICAgICAgbmV4dCBFTlRSWSBpZiAkRW50cnktPls1XSBuZSAnZHluYW1pY19maWVsZCc7CgogICAgICAgICAgICAgICAgICAgIG15ICREeW5hbWljRmllbGRDb25maWcgPSAkU2VsZi0+e0R5bmFtaWNGaWVsZExvb2t1cH0tPnsgJEVudHJ5LT5bMl0gfTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCAhSXNIYXNoUmVmV2l0aERhdGEoJER5bmFtaWNGaWVsZENvbmZpZykgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICROb3RlIC49ICRMYXlvdXRPYmplY3QtPk5vdGlmeSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEluZm8gPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdEeW5hbWljIGZpZWxkICVzIG5vdCBmb3VuZCEnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRFbnRyeS0+WzJdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgbmV4dCBFTlRSWTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIG15ICRWYWx1ZVNldCA9ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0LT5WYWx1ZVNldCgKICAgICAgICAgICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRDb25maWcsCiAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdE5hbWUgICAgICAgICA9PiAkR2V0UGFyYW17VXNlckxvZ2lufSwKICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWUgICAgICAgICAgICAgID0+ICRHZXRQYXJhbXsgJEVudHJ5LT5bMF0gfSwKICAgICAgICAgICAgICAgICAgICAgICAgVXNlcklEICAgICAgICAgICAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICAgICBpZiAoICEkVmFsdWVTZXQgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICROb3RlIC49ICRMYXlvdXRPYmplY3QtPk5vdGlmeSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEluZm8gPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdVbmFibGUgdG8gc2V0IHZhbHVlIGZvciBkeW5hbWljIGZpZWxkICVzIScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEVudHJ5LT5bMl0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICBuZXh0IEVOVFJZOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIHVwZGF0ZSBwcmVmZXJlbmNlcwogICAgICAgICAgICAgICAgbXkgJVByZWZlcmVuY2VzID0gJXsgJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lclByZWZlcmVuY2VzR3JvdXBzJykgfTsKICAgICAgICAgICAgICAgIEdST1VQOgogICAgICAgICAgICAgICAgZm9yIG15ICRHcm91cCAoIHNvcnQga2V5cyAlUHJlZmVyZW5jZXMgKSB7CiAgICAgICAgICAgICAgICAgICAgbmV4dCBHUk9VUCBpZiAkR3JvdXAgZXEgJ1Bhc3N3b3JkJzsKCiAgICAgICAgICAgICAgICAgICAgIyBnZXQgdXNlciBkYXRhCiAgICAgICAgICAgICAgICAgICAgbXkgJVVzZXJEYXRhID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJVc2VyRGF0YUdldCgKICAgICAgICAgICAgICAgICAgICAgICAgVXNlciA9PiAkR2V0UGFyYW17VXNlckxvZ2lufQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgbXkgJE1vZHVsZSA9ICRQcmVmZXJlbmNlc3skR3JvdXB9LT57TW9kdWxlfTsKICAgICAgICAgICAgICAgICAgICBpZiAoICEkTWFpbk9iamVjdC0+UmVxdWlyZSgkTW9kdWxlKSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkZhdGFsRXJyb3IoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbXkgJE9iamVjdCA9ICRNb2R1bGUtPm5ldygKICAgICAgICAgICAgICAgICAgICAgICAgJXskU2VsZn0sCiAgICAgICAgICAgICAgICAgICAgICAgIENvbmZpZ0l0ZW0gPT4gJFByZWZlcmVuY2VzeyRHcm91cH0sCiAgICAgICAgICAgICAgICAgICAgICAgIFVzZXJPYmplY3QgPT4gJEN1c3RvbWVyVXNlck9iamVjdCwKICAgICAgICAgICAgICAgICAgICAgICAgRGVidWcgICAgICA9PiAkU2VsZi0+e0RlYnVnfSwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIG15IEBQYXJhbXMgPSAkT2JqZWN0LT5QYXJhbSggVXNlckRhdGEgPT4gXCVVc2VyRGF0YSApOwogICAgICAgICAgICAgICAgICAgIGlmIChAUGFyYW1zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG15ICVHZXRQYXJhbTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIG15ICRQYXJhbUl0ZW0gKEBQYXJhbXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15IEBBcnJheSA9ICRQYXJhbU9iamVjdC0+R2V0QXJyYXkoIFBhcmFtID0+ICRQYXJhbUl0ZW0tPntOYW1lfSApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEdldFBhcmFteyAkUGFyYW1JdGVtLT57TmFtZX0gfSA9IFxAQXJyYXk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgISRPYmplY3QtPlJ1bigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHZXRQYXJhbSA9PiBcJUdldFBhcmFtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFVzZXJEYXRhID0+IFwlVXNlckRhdGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJE5vdGUgLj0gJExheW91dE9iamVjdC0+Tm90aWZ5KCBJbmZvID0+ICRPYmplY3QtPkVycm9yKCkgKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIGNsZWFyIGN1c3RvbWVyIHVzZXIgY2FjaGUKICAgICAgICAgICAgICAgICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyVXNlckNhY2hlQ2xlYXIoCiAgICAgICAgICAgICAgICAgICAgVXNlckxvZ2luID0+ICRHZXRQYXJhbXtVc2VyTG9naW59LAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAjIGdldCB1c2VyIGRhdGEgYW5kIHNob3cgc2NyZWVuIGFnYWluCiAgICAgICAgICAgICAgICBpZiAoICEkTm90ZSApIHsKCiAgICAgICAgICAgICAgICAgICAgIyBpZiB0aGUgdXNlciB3b3VsZCBsaWtlIHRvIGNvbnRpbnVlIGVkaXRpbmcgdGhlIHByaW9yaXR5LCBqdXN0IHJlZGlyZWN0IHRvIHRoZSBlZGl0IHNjcmVlbgogICAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAgICAgZGVmaW5lZCAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQ29udGludWVBZnRlclNhdmUnICkKICAgICAgICAgICAgICAgICAgICAgICAgJiYgKCAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQ29udGludWVBZnRlclNhdmUnICkgZXEgJzEnICkKICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgbXkgJElEID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0lEJyApIHx8ICcnOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+UmVkaXJlY3QoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBPUCA9PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJBY3Rpb249JFNlbGYtPntBY3Rpb259O1N1YmFjdGlvbj1DaGFuZ2U7SUQ9JElEO1NlYXJjaD0kU2VhcmNoO05hdj0kTmF2O05vdGlmaWNhdGlvbj1VcGRhdGUiCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewoKICAgICAgICAgICAgICAgICAgICAgICAgIyBvdGhlcndpc2UgcmV0dXJuIHRvIG92ZXJ2aWV3CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5SZWRpcmVjdCggT1AgPT4gIkFjdGlvbj0kU2VsZi0+e0FjdGlvbn07Tm90aWZpY2F0aW9uPVVwZGF0ZSIgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkTm90ZSAuPSAkTGF5b3V0T2JqZWN0LT5Ob3RpZnkoIFByaW9yaXR5ID0+ICdFcnJvcicgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBzb21ldGhpbmcgaGFzIGdvbmUgd3JvbmcKICAgICAgICBteSAkT3V0cHV0ID0gJE5hdkJhcjsKICAgICAgICAkT3V0cHV0IC49ICROb3RlOwogICAgICAgICRPdXRwdXQgLj0gJFNlbGYtPl9FZGl0KAogICAgICAgICAgICBOYXYgICAgPT4gJE5hdiwKICAgICAgICAgICAgQWN0aW9uID0+ICdDaGFuZ2UnLAogICAgICAgICAgICBTb3VyY2UgPT4gJFNvdXJjZSwKICAgICAgICAgICAgU2VhcmNoID0+ICRTZWFyY2gsCiAgICAgICAgICAgIEVycm9ycyA9PiBcJUVycm9ycywKICAgICAgICAgICAgJUdldFBhcmFtLAogICAgICAgICk7CgogICAgICAgIGlmICggJE5hdiBlcSAnTm9uZScgKSB7CiAgICAgICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Rm9vdGVyKCBUeXBlID0+ICdTbWFsbCcgKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Rm9vdGVyKCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJE91dHB1dDsKICAgIH0KCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICAjIGFkZAogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gIwogICAgZWxzaWYgKCAkU2VsZi0+e1N1YmFjdGlvbn0gZXEgJ0FkZCcgKSB7CiAgICAgICAgbXkgJUdldFBhcmFtOwogICAgICAgICRHZXRQYXJhbXtVc2VyTG9naW59ICA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdVc2VyTG9naW4nICkgIHx8ICcnOwogICAgICAgICRHZXRQYXJhbXtDdXN0b21lcklEfSA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdDdXN0b21lcklEJyApIHx8ICcnOwogICAgICAgIG15ICRPdXRwdXQgPSAkTmF2QmFyOwogICAgICAgICRPdXRwdXQgLj0gJFNlbGYtPl9FZGl0KAogICAgICAgICAgICBOYXYgICAgPT4gJE5hdiwKICAgICAgICAgICAgQWN0aW9uID0+ICdBZGQnLAogICAgICAgICAgICBTb3VyY2UgPT4gJFNvdXJjZSwKICAgICAgICAgICAgU2VhcmNoID0+ICRTZWFyY2gsCiAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICApOwoKICAgICAgICBpZiAoICROYXYgZXEgJ05vbmUnICkgewogICAgICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPkZvb3RlciggVHlwZSA9PiAnU21hbGwnICk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPkZvb3RlcigpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRPdXRwdXQ7CiAgICB9CgogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gIwogICAgIyBhZGQgYWN0aW9uCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICBlbHNpZiAoICRTZWxmLT57U3ViYWN0aW9ufSBlcSAnQWRkQWN0aW9uJyApIHsKCiAgICAgICAgIyBjaGFsbGVuZ2UgdG9rZW4gY2hlY2sgZm9yIHdyaXRlIGFjdGlvbgogICAgICAgICRMYXlvdXRPYmplY3QtPkNoYWxsZW5nZVRva2VuQ2hlY2soKTsKCiAgICAgICAgbXkgJE5vdGUgPSAnJzsKICAgICAgICBteSAoICVHZXRQYXJhbSwgJUVycm9ycyApOwoKICAgICAgICBteSAkQXV0b0xvZ2luQ3JlYXRpb24gPSAkQ29uZmlnT2JqZWN0LT5HZXQoJFNvdXJjZSktPntBdXRvTG9naW5DcmVhdGlvbn07CgogICAgICAgICMgR2V0IGR5bmFtaWMgZmllbGQgYmFja2VuZCBvYmplY3QuCiAgICAgICAgbXkgJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6RHluYW1pY0ZpZWxkOjpCYWNrZW5kJyk7CgogICAgICAgIEVOVFJZOgogICAgICAgIGZvciBteSAkRW50cnkgKCBAeyAkQ29uZmlnT2JqZWN0LT5HZXQoJFNvdXJjZSktPntNYXB9IH0gKSB7CgogICAgICAgICAgICAjIGRvbid0IHZhbGlkYXRlIFVzZXJMb2dpbiBpZiBBdXRvTG9naW5DcmVhdGlvbiBpcyBjb25maWd1cmVkCiAgICAgICAgICAgIG5leHQgRU5UUlkgaWYgKCAkQXV0b0xvZ2luQ3JlYXRpb24gJiYgJEVudHJ5LT5bMF0gZXEgJ1VzZXJMb2dpbicgKTsKCiAgICAgICAgICAgICMgY2hlY2sgZHluYW1pYyBmaWVsZHMKICAgICAgICAgICAgaWYgKCAkRW50cnktPls1XSBlcSAnZHluYW1pY19maWVsZCcgKSB7CgogICAgICAgICAgICAgICAgbXkgJER5bmFtaWNGaWVsZENvbmZpZyA9ICRTZWxmLT57RHluYW1pY0ZpZWxkTG9va3VwfS0+eyAkRW50cnktPlsyXSB9OwoKICAgICAgICAgICAgICAgIGlmICggIUlzSGFzaFJlZldpdGhEYXRhKCREeW5hbWljRmllbGRDb25maWcpICkgewogICAgICAgICAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiRHluYW1pY0ZpZWxkICRFbnRyeS0+WzJdIG5vdCBmb3VuZCEiLAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgbmV4dCBFTlRSWTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBteSAkVmFsaWRhdGlvblJlc3VsdCA9ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0LT5FZGl0RmllbGRWYWx1ZVZhbGlkYXRlKAogICAgICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZENvbmZpZyA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnLAogICAgICAgICAgICAgICAgICAgIFBhcmFtT2JqZWN0ICAgICAgICA9PiAkUGFyYW1PYmplY3QsCiAgICAgICAgICAgICAgICAgICAgTWFuZGF0b3J5ICAgICAgICAgID0+ICRFbnRyeS0+WzRdLAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICBpZiAoICRWYWxpZGF0aW9uUmVzdWx0LT57U2VydmVyRXJyb3J9ICkgewogICAgICAgICAgICAgICAgICAgICRFcnJvcnN7ICRFbnRyeS0+WzBdIH0gPSAkVmFsaWRhdGlvblJlc3VsdDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewoKICAgICAgICAgICAgICAgICAgICAjIGdlbmVyYXRlIHN0b3JhYmxlIHZhbHVlIG9mIGR5bmFtaWMgZmllbGQgZWRpdCBmaWVsZAogICAgICAgICAgICAgICAgICAgICRHZXRQYXJhbXsgJEVudHJ5LT5bMF0gfSA9ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0LT5FZGl0RmllbGRWYWx1ZUdldCgKICAgICAgICAgICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRDb25maWcsCiAgICAgICAgICAgICAgICAgICAgICAgIFBhcmFtT2JqZWN0ICAgICAgICA9PiAkUGFyYW1PYmplY3QsCiAgICAgICAgICAgICAgICAgICAgICAgIExheW91dE9iamVjdCAgICAgICA9PiAkTGF5b3V0T2JqZWN0LAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgY2hlY2sgcmVtYWluaW5nIG5vbi1keW5hbWljLWZpZWxkIG1hbmRhdG9yeSBmaWVsZHMKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkR2V0UGFyYW17ICRFbnRyeS0+WzBdIH0gPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAkRW50cnktPlswXSApIHx8ICcnOwogICAgICAgICAgICAgICAgaWYgKCAhJEdldFBhcmFteyAkRW50cnktPlswXSB9ICYmICRFbnRyeS0+WzRdICkgewogICAgICAgICAgICAgICAgICAgICRFcnJvcnN7ICRFbnRyeS0+WzBdIC4gJ0ludmFsaWQnIH0gPSAnU2VydmVyRXJyb3InOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIGNoZWNrIGVtYWlsIGFkZHJlc3MKICAgICAgICBpZiAoCiAgICAgICAgICAgICRHZXRQYXJhbXtVc2VyRW1haWx9CiAgICAgICAgICAgICYmICEkQ2hlY2tJdGVtT2JqZWN0LT5DaGVja0VtYWlsKCBBZGRyZXNzID0+ICRHZXRQYXJhbXtVc2VyRW1haWx9ICkKICAgICAgICAgICAgJiYgZ3JlcCB7ICRfIGVxICRHZXRQYXJhbXtWYWxpZElEfSB9IEBWYWxpZElETGlzdAogICAgICAgICAgICApCiAgICAgICAgewogICAgICAgICAgICAkRXJyb3Jze1VzZXJFbWFpbEludmFsaWR9ID0gJ1NlcnZlckVycm9yJzsKICAgICAgICAgICAgJEVycm9yc3tFcnJvclR5cGV9ICAgICAgICA9ICRDaGVja0l0ZW1PYmplY3QtPkNoZWNrRXJyb3JUeXBlKCkgLiAnU2VydmVyRXJyb3JNc2cnOwogICAgICAgIH0KCiAgICAgICAgIyBDaGVjayBDdXN0b21lcklELCBpZiBDdXN0b21lckNvbXBhbnlTdXBwb3J0IGlzIGVuYWJsZWQuCiAgICAgICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJFNvdXJjZSktPntDdXN0b21lckNvbXBhbnlTdXBwb3J0fSAmJiAkR2V0UGFyYW17VXNlckN1c3RvbWVySUR9ICkgewoKICAgICAgICAgICAgbXkgJUNvbXBhbnkgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q3VzdG9tZXJDb21wYW55JyktPkN1c3RvbWVyQ29tcGFueUdldCgKICAgICAgICAgICAgICAgIEN1c3RvbWVySUQgPT4gJEdldFBhcmFte1VzZXJDdXN0b21lcklEfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGlmICggISVDb21wYW55ICkgewogICAgICAgICAgICAgICAgJEVycm9yc3tVc2VyQ3VzdG9tZXJJREludmFsaWR9ID0gJ1NlcnZlckVycm9yJzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBpZiBubyBlcnJvcnMgb2NjdXJyZWQKICAgICAgICBpZiAoICElRXJyb3JzICkgewoKICAgICAgICAgICAgIyBhZGQgdXNlcgogICAgICAgICAgICBteSAkVXNlciA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyVXNlckFkZCgKICAgICAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgICAgIFVzZXJJRCA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICAgICBTb3VyY2UgPT4gJFNvdXJjZQogICAgICAgICAgICApOwogICAgICAgICAgICBpZiAoJFVzZXIpIHsKCiAgICAgICAgICAgICAgICAjIHNldCBkeW5hbWljIGZpZWxkIHZhbHVlcwogICAgICAgICAgICAgICAgbXkgJER5bmFtaWNGaWVsZE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEeW5hbWljRmllbGQnKTsKCiAgICAgICAgICAgICAgICBFTlRSWToKICAgICAgICAgICAgICAgIGZvciBteSAkRW50cnkgKCBAeyAkQ29uZmlnT2JqZWN0LT5HZXQoJFNvdXJjZSktPntNYXB9IH0gKSB7CiAgICAgICAgICAgICAgICAgICAgbmV4dCBFTlRSWSBpZiAkRW50cnktPls1XSBuZSAnZHluYW1pY19maWVsZCc7CgogICAgICAgICAgICAgICAgICAgIG15ICREeW5hbWljRmllbGRDb25maWcgPSAkU2VsZi0+e0R5bmFtaWNGaWVsZExvb2t1cH0tPnsgJEVudHJ5LT5bMl0gfTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCAhSXNIYXNoUmVmV2l0aERhdGEoJER5bmFtaWNGaWVsZENvbmZpZykgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICROb3RlIC49ICRMYXlvdXRPYmplY3QtPk5vdGlmeSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEluZm8gPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdEeW5hbWljIGZpZWxkICVzIG5vdCBmb3VuZCEnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRFbnRyeS0+WzJdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgbmV4dCBFTlRSWTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIG15ICRWYWx1ZVNldCA9ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0LT5WYWx1ZVNldCgKICAgICAgICAgICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRDb25maWcsCiAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdE5hbWUgICAgICAgICA9PiAkVXNlciwKICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWUgICAgICAgICAgICAgID0+ICRHZXRQYXJhbXsgJEVudHJ5LT5bMF0gfSwKICAgICAgICAgICAgICAgICAgICAgICAgVXNlcklEICAgICAgICAgICAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICAgICBpZiAoICEkVmFsdWVTZXQgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICROb3RlIC49ICRMYXlvdXRPYmplY3QtPk5vdGlmeSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEluZm8gPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdVbmFibGUgdG8gc2V0IHZhbHVlIGZvciBkeW5hbWljIGZpZWxkICVzIScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEVudHJ5LT5bMl0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICBuZXh0IEVOVFJZOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIHVwZGF0ZSBwcmVmZXJlbmNlcwogICAgICAgICAgICAgICAgbXkgJVByZWZlcmVuY2VzID0gJXsgJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lclByZWZlcmVuY2VzR3JvdXBzJykgfTsKICAgICAgICAgICAgICAgIEdST1VQOgogICAgICAgICAgICAgICAgZm9yIG15ICRHcm91cCAoIHNvcnQga2V5cyAlUHJlZmVyZW5jZXMgKSB7CiAgICAgICAgICAgICAgICAgICAgbmV4dCBHUk9VUCBpZiAkR3JvdXAgZXEgJ1Bhc3N3b3JkJzsKCiAgICAgICAgICAgICAgICAgICAgIyBnZXQgdXNlciBkYXRhCiAgICAgICAgICAgICAgICAgICAgbXkgJVVzZXJEYXRhID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJVc2VyRGF0YUdldCgKICAgICAgICAgICAgICAgICAgICAgICAgVXNlciA9PiAkVXNlciwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIG15ICRNb2R1bGUgPSAkUHJlZmVyZW5jZXN7JEdyb3VwfS0+e01vZHVsZX07CiAgICAgICAgICAgICAgICAgICAgaWYgKCAhJE1haW5PYmplY3QtPlJlcXVpcmUoJE1vZHVsZSkgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5GYXRhbEVycm9yKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIG15ICRPYmplY3QgPSAkTW9kdWxlLT5uZXcoCiAgICAgICAgICAgICAgICAgICAgICAgICV7JFNlbGZ9LAogICAgICAgICAgICAgICAgICAgICAgICBDb25maWdJdGVtID0+ICRQcmVmZXJlbmNlc3skR3JvdXB9LAogICAgICAgICAgICAgICAgICAgICAgICBVc2VyT2JqZWN0ID0+ICRDdXN0b21lclVzZXJPYmplY3QsCiAgICAgICAgICAgICAgICAgICAgICAgIERlYnVnICAgICAgPT4gJFNlbGYtPntEZWJ1Z30sCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICBteSBAUGFyYW1zID0gJE9iamVjdC0+UGFyYW0oICV7ICRQcmVmZXJlbmNlc3skR3JvdXB9IH0sIFVzZXJEYXRhID0+IFwlVXNlckRhdGEgKTsKICAgICAgICAgICAgICAgICAgICBpZiAoQFBhcmFtcykgewogICAgICAgICAgICAgICAgICAgICAgICBteSAlR2V0UGFyYW07CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBteSAkUGFyYW1JdGVtIChAUGFyYW1zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBteSBAQXJyYXkgPSAkUGFyYW1PYmplY3QtPkdldEFycmF5KCBQYXJhbSA9PiAkUGFyYW1JdGVtLT57TmFtZX0gKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRHZXRQYXJhbXsgJFBhcmFtSXRlbS0+e05hbWV9IH0gPSBcQEFycmF5OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICEkT2JqZWN0LT5SdW4oCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgR2V0UGFyYW0gPT4gXCVHZXRQYXJhbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVc2VyRGF0YSA9PiBcJVVzZXJEYXRhCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICROb3RlIC49ICRMYXlvdXRPYmplY3QtPk5vdGlmeSggSW5mbyA9PiAkT2JqZWN0LT5FcnJvcigpICk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBnZXQgdXNlciBkYXRhIGFuZCBzaG93IHNjcmVlbiBhZ2FpbgogICAgICAgICAgICAgICAgaWYgKCAhJE5vdGUgKSB7CgogICAgICAgICAgICAgICAgICAgICMgaW4gYm9ycm93ZWQgdmlldywgdGFrZSB0aGUgbmV3IGNyZWF0ZWQgY3VzdG9tZXIgb3ZlciBpbnRvIHRoZSBuZXcgdGlja2V0CiAgICAgICAgICAgICAgICAgICAgaWYgKCAkTmF2IGVxICdOb25lJyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgbXkgJE91dHB1dCA9ICROYXZCYXI7CgogICAgICAgICAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5BZGRKU0RhdGEoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBLZXkgICA9PiAnQ3VzdG9tZXInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWUgPT4gJFVzZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkFkZEpTRGF0YSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEtleSAgID0+ICdOYXYnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWUgPT4gJE5hdiwKICAgICAgICAgICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+T3V0cHV0KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVGVtcGxhdGVGaWxlID0+ICdBZG1pbkN1c3RvbWVyVXNlcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEYXRhICAgICAgICAgPT4gXCVQYXJhbSwKICAgICAgICAgICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Rm9vdGVyKCBUeXBlID0+ICdTbWFsbCcgKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkT3V0cHV0OwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJFNlbGYtPl9PdmVydmlldygKICAgICAgICAgICAgICAgICAgICAgICAgTmF2ICAgID0+ICROYXYsCiAgICAgICAgICAgICAgICAgICAgICAgIFNlYXJjaCA9PiAkU2VhcmNoLAogICAgICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgICAgIG15ICRPdXRwdXQgICAgICAgID0gJE5hdkJhciAuICROb3RlOwogICAgICAgICAgICAgICAgICAgIG15ICRVUkwgICAgICAgICAgID0gJyc7CiAgICAgICAgICAgICAgICAgICAgbXkgJFVzZXJIVE1MUXVvdGUgPSAkTGF5b3V0T2JqZWN0LT5MaW5rRW5jb2RlKCRVc2VyKTsKICAgICAgICAgICAgICAgICAgICBteSAkVXNlclF1b3RlICAgICA9ICRMYXlvdXRPYmplY3QtPkFzY2lpMkh0bWwoIFRleHQgPT4gJFVzZXIgKTsKICAgICAgICAgICAgICAgICAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnRnJvbnRlbmQ6Ok1vZHVsZScpLT57QWdlbnRUaWNrZXRQaG9uZX0gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRVUkwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC49ICI8YSBocmVmPVwiJExheW91dE9iamVjdC0+e0Jhc2VsaW5rfUFjdGlvbj1BZ2VudFRpY2tldFBob25lO1N1YmFjdGlvbj1TdG9yZU5ldztFeHBhbmRDdXN0b21lck5hbWU9MjtDdXN0b21lclVzZXI9JFVzZXJIVE1MUXVvdGU7JExheW91dE9iamVjdC0+e0NoYWxsZW5nZVRva2VuUGFyYW19XCI+IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoJ05ldyBwaG9uZSB0aWNrZXQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLiAiPC9hPiI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICggJENvbmZpZ09iamVjdC0+R2V0KCdGcm9udGVuZDo6TW9kdWxlJyktPntBZ2VudFRpY2tldEVtYWlsfSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRVUkwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRVUkwgLj0gIiAtICI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgJFVSTAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLj0gIjxhIGhyZWY9XCIkTGF5b3V0T2JqZWN0LT57QmFzZWxpbmt9QWN0aW9uPUFnZW50VGlja2V0RW1haWw7U3ViYWN0aW9uPVN0b3JlTmV3O0V4cGFuZEN1c3RvbWVyTmFtZT0yO0N1c3RvbWVyVXNlcj0kVXNlckhUTUxRdW90ZTskTGF5b3V0T2JqZWN0LT57Q2hhbGxlbmdlVG9rZW5QYXJhbX1cIj4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgnTmV3IGVtYWlsIHRpY2tldCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuICI8L2E+IjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCRVUkwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJE91dHB1dAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLj0gJExheW91dE9iamVjdC0+Tm90aWZ5KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgRGF0YSA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0N1c3RvbWVyICVzIGFkZGVkJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVXNlclF1b3RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuICIgKCAkVVJMICkhIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkT3V0cHV0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuPSAkTGF5b3V0T2JqZWN0LT5Ob3RpZnkoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEYXRhID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQ3VzdG9tZXIgJXMgYWRkZWQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRVc2VyUXVvdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4gIiEiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5PdXRwdXQoCiAgICAgICAgICAgICAgICAgICAgICAgIFRlbXBsYXRlRmlsZSA9PiAnQWRtaW5DdXN0b21lclVzZXInLAogICAgICAgICAgICAgICAgICAgICAgICBEYXRhICAgICAgICAgPT4gXCVQYXJhbSwKICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICAgICBpZiAoICROYXYgZXEgJ05vbmUnICkgewogICAgICAgICAgICAgICAgICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPkZvb3RlciggVHlwZSA9PiAnU21hbGwnICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPkZvb3RlcigpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRPdXRwdXQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkTm90ZSAuPSAkTGF5b3V0T2JqZWN0LT5Ob3RpZnkoIFByaW9yaXR5ID0+ICdFcnJvcicgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBzb21ldGhpbmcgaGFzIGdvbmUgd3JvbmcKICAgICAgICBteSAkT3V0cHV0ID0gJE5hdkJhciAuICROb3RlOwogICAgICAgICRPdXRwdXQgLj0gJFNlbGYtPl9FZGl0KAogICAgICAgICAgICBOYXYgICAgPT4gJE5hdiwKICAgICAgICAgICAgQWN0aW9uID0+ICdBZGQnLAogICAgICAgICAgICBTb3VyY2UgPT4gJFNvdXJjZSwKICAgICAgICAgICAgU2VhcmNoID0+ICRTZWFyY2gsCiAgICAgICAgICAgIEVycm9ycyA9PiBcJUVycm9ycywKICAgICAgICAgICAgJUdldFBhcmFtLAogICAgICAgICk7CgogICAgICAgIGlmICggJE5hdiBlcSAnTm9uZScgKSB7CiAgICAgICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Rm9vdGVyKCBUeXBlID0+ICdTbWFsbCcgKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Rm9vdGVyKCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJE91dHB1dDsKICAgIH0KCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICAjIG92ZXJ2aWV3CiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICBlbHNlIHsKICAgICAgICAkU2VsZi0+X092ZXJ2aWV3KAogICAgICAgICAgICBOYXYgICAgPT4gJE5hdiwKICAgICAgICAgICAgU2VhcmNoID0+ICRTZWFyY2gsCiAgICAgICAgKTsKCiAgICAgICAgbXkgJE5vdGlmaWNhdGlvbiA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdOb3RpZmljYXRpb24nICkgfHwgJyc7CiAgICAgICAgbXkgJE91dHB1dCAgICAgICA9ICROYXZCYXI7CiAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5Ob3RpZnkoIEluZm8gPT4gVHJhbnNsYXRhYmxlKCdDdXN0b21lciB1c2VyIHVwZGF0ZWQhJykgKQogICAgICAgICAgICBpZiAoICROb3RpZmljYXRpb24gJiYgJE5vdGlmaWNhdGlvbiBlcSAnVXBkYXRlJyApOwoKICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk91dHB1dCgKICAgICAgICAgICAgVGVtcGxhdGVGaWxlID0+ICdBZG1pbkN1c3RvbWVyVXNlcicsCiAgICAgICAgICAgIERhdGEgICAgICAgICA9PiBcJVBhcmFtLAogICAgICAgICk7CgogICAgICAgIGlmICggJE5hdiBlcSAnTm9uZScgKSB7CiAgICAgICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Rm9vdGVyKCBUeXBlID0+ICdTbWFsbCcgKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Rm9vdGVyKCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJE91dHB1dDsKICAgIH0KfQoKc3ViIF9PdmVydmlldyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnT3ZlcnZpZXcnLAogICAgICAgIERhdGEgPT4gXCVQYXJhbSwKICAgICk7CgogICAgJExheW91dE9iamVjdC0+QmxvY2soIE5hbWUgPT4gJ0FjdGlvbkxpc3QnICk7CiAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICBOYW1lID0+ICdBY3Rpb25TZWFyY2gnLAogICAgICAgIERhdGEgPT4gXCVQYXJhbSwKICAgICk7CgogICAgbXkgJEN1c3RvbWVyVXNlck9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDdXN0b21lclVzZXInKTsKCiAgICAjIGdldCB3cml0YWJsZSBkYXRhIHNvdXJjZXMKICAgIG15ICVDdXN0b21lclNvdXJjZSA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyU291cmNlTGlzdCgKICAgICAgICBSZWFkT25seSA9PiAwLAogICAgKTsKCiAgICAjIG9ubHkgc2hvdyBBZGQgb3B0aW9uIGlmIHdlIGhhdmUgYXQgbGVhc3Qgb25lIHdyaXRhYmxlIGJhY2tlbmQKICAgIGlmICggc2NhbGFyIGtleXMgJUN1c3RvbWVyU291cmNlICkgewogICAgICAgICRQYXJhbXtTb3VyY2VPcHRpb259ID0gJExheW91dE9iamVjdC0+QnVpbGRTZWxlY3Rpb24oCiAgICAgICAgICAgIERhdGEgICAgICAgPT4geyAlQ3VzdG9tZXJTb3VyY2UsIH0sCiAgICAgICAgICAgIE5hbWUgICAgICAgPT4gJ1NvdXJjZScsCiAgICAgICAgICAgIFNlbGVjdGVkSUQgPT4gJFBhcmFte1NvdXJjZX0gfHwgJycsCiAgICAgICAgICAgIENsYXNzICAgICAgPT4gJ01vZGVybml6ZScsCiAgICAgICAgKTsKCiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ0FjdGlvbkFkZCcsCiAgICAgICAgICAgIERhdGEgPT4gXCVQYXJhbSwKICAgICAgICApOwogICAgfQoKICAgIGlmICggJFBhcmFte1NlYXJjaH0gKSB7CgogICAgICAgICMgZ2V0IGNvbmZpZyBvYmplY3QKICAgICAgICBteSAkQ29uZmlnT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKTsKCiAgICAgICAgIyB3aGVuIHRoZXJlIGlzIG5vIGRhdGEgdG8gc2hvdywgYSBtZXNzYWdlIGlzIGRpc3BsYXllZCBvbiB0aGUgdGFibGUgd2l0aCB0aGlzIGNvbHNwYW4KICAgICAgICBteSAkQ29sU3BhbiA9IDY7CgogICAgICAgICMgc2FtZSBMaW1pdCBhcyAkU2VsZi0+e0N1c3RvbWVyVXNlck1hcH0tPntDdXN0b21lclVzZXJTZWFyY2hMaXN0TGltaXR9CiAgICAgICAgIyBzbWFsbGVzdCBMaW1pdCBmcm9tIGFsbCBzb3VyY2VzCiAgICAgICAgbXkgJExpbWl0ID0gNDAwOwogICAgICAgIFNPVVJDRToKICAgICAgICBmb3IgbXkgJENvdW50ICggJycsIDEgLi4gMTAgKSB7CiAgICAgICAgICAgIG5leHQgU09VUkNFIGlmICEkQ29uZmlnT2JqZWN0LT5HZXQoIkN1c3RvbWVyVXNlciRDb3VudCIpOwogICAgICAgICAgICBteSAkQ3VzdG9tZXJVc2VyTWFwID0gJENvbmZpZ09iamVjdC0+R2V0KCJDdXN0b21lclVzZXIkQ291bnQiKTsKICAgICAgICAgICAgbmV4dCBTT1VSQ0UgaWYgISRDdXN0b21lclVzZXJNYXAtPntDdXN0b21lclVzZXJTZWFyY2hMaXN0TGltaXR9OwogICAgICAgICAgICBpZiAoICRDdXN0b21lclVzZXJNYXAtPntDdXN0b21lclVzZXJTZWFyY2hMaXN0TGltaXR9IDwgJExpbWl0ICkgewogICAgICAgICAgICAgICAgJExpbWl0ID0gJEN1c3RvbWVyVXNlck1hcC0+e0N1c3RvbWVyVXNlclNlYXJjaExpc3RMaW1pdH07CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIG15ICVMaXN0QWxsSXRlbXMgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclNlYXJjaCgKICAgICAgICAgICAgU2VhcmNoID0+ICRQYXJhbXtTZWFyY2h9LAogICAgICAgICAgICBMaW1pdCAgPT4gJExpbWl0ICsgMSwKICAgICAgICAgICAgVmFsaWQgID0+IDAsCiAgICAgICAgICAgIFVzZXJJRCA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgKTsKCiAgICAgICAgaWYgKCBrZXlzICVMaXN0QWxsSXRlbXMgPD0gJExpbWl0ICkgewogICAgICAgICAgICBteSAkTGlzdEFsbEl0ZW1zID0ga2V5cyAlTGlzdEFsbEl0ZW1zOwogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ092ZXJ2aWV3SGVhZGVyJywKICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgIExpc3RBbGwgPT4gJExpc3RBbGxJdGVtcywKICAgICAgICAgICAgICAgICAgICBMaW1pdCAgID0+ICRMaW1pdCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICBteSAlTGlzdCA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyU2VhcmNoKAogICAgICAgICAgICBTZWFyY2ggPT4gJFBhcmFte1NlYXJjaH0sCiAgICAgICAgICAgIFZhbGlkICA9PiAwLAogICAgICAgICAgICBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICk7CgogICAgICAgIGlmICgga2V5cyAlTGlzdEFsbEl0ZW1zID4gJExpbWl0ICkgewogICAgICAgICAgICBteSAkTGlzdEFsbEl0ZW1zICAgPSBrZXlzICVMaXN0QWxsSXRlbXM7CiAgICAgICAgICAgIG15ICRTZWFyY2hMaXN0U2l6ZSA9IGtleXMgJUxpc3Q7CgogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ092ZXJ2aWV3SGVhZGVyJywKICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgIFNlYXJjaExpc3RTaXplID0+ICRTZWFyY2hMaXN0U2l6ZSwKICAgICAgICAgICAgICAgICAgICBMaXN0QWxsICAgICAgICA9PiAkTGlzdEFsbEl0ZW1zLAogICAgICAgICAgICAgICAgICAgIExpbWl0ICAgICAgICAgID0+ICRMaW1pdCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnT3ZlcnZpZXdSZXN1bHQnLAogICAgICAgICAgICBEYXRhID0+IFwlUGFyYW0sCiAgICAgICAgKTsKCiAgICAgICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ1N3aXRjaFRvQ3VzdG9tZXInKSAmJiAkU2VsZi0+e1N3aXRjaFRvQ3VzdG9tZXJQZXJtaXNzaW9ufSAmJiAkUGFyYW17TmF2fSBuZSAnTm9uZScgKQogICAgICAgIHsKICAgICAgICAgICAgJENvbFNwYW4gPSA3OwogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ092ZXJ2aWV3UmVzdWx0U3dpdGNoVG9DdXN0b21lcicsCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIGlmIHRoZXJlIGFyZSByZXN1bHRzIHRvIHNob3cKICAgICAgICBpZiAoJUxpc3QpIHsKCiAgICAgICAgICAgICMgZ2V0IHZhbGlkIGxpc3QKICAgICAgICAgICAgbXkgJVZhbGlkTGlzdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpWYWxpZCcpLT5WYWxpZExpc3QoKTsKICAgICAgICAgICAgZm9yIG15ICRMaXN0S2V5ICggc29ydCB7IGxjKCRhKSBjbXAgbGMoJGIpIH0ga2V5cyAlTGlzdCApIHsKCiAgICAgICAgICAgICAgICBteSAlVXNlckRhdGEgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJEYXRhR2V0KCBVc2VyID0+ICRMaXN0S2V5ICk7CiAgICAgICAgICAgICAgICAkVXNlckRhdGF7VXNlckZ1bGxuYW1lfSA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyTmFtZSgKICAgICAgICAgICAgICAgICAgICBVc2VyTG9naW4gPT4gJFVzZXJEYXRhe1VzZXJMb2dpbn0sCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gJ092ZXJ2aWV3UmVzdWx0Um93JywKICAgICAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgVmFsaWQgICAgICAgPT4gJFZhbGlkTGlzdHsgJFVzZXJEYXRhe1ZhbGlkSUR9IHx8ICcnIH0gfHwgJy0nLAogICAgICAgICAgICAgICAgICAgICAgICBTZWFyY2ggICAgICA9PiAkUGFyYW17U2VhcmNofSwKICAgICAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJLZXkgPT4gJExpc3RLZXksCiAgICAgICAgICAgICAgICAgICAgICAgICVVc2VyRGF0YSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGlmICggJFBhcmFte05hdn0gZXEgJ05vbmUnICkgewogICAgICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICdPdmVydmlld1Jlc3VsdFJvd0xpbmtOb25lJywKICAgICAgICAgICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZWFyY2ggICAgICA9PiAkUGFyYW17U2VhcmNofSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyS2V5ID0+ICRMaXN0S2V5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJVVzZXJEYXRhLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAnT3ZlcnZpZXdSZXN1bHRSb3dMaW5rJywKICAgICAgICAgICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZWFyY2ggICAgICA9PiAkUGFyYW17U2VhcmNofSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hdiAgICAgICAgID0+ICRQYXJhbXtOYXZ9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJLZXkgPT4gJExpc3RLZXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAlVXNlckRhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgJENvbmZpZ09iamVjdC0+R2V0KCdTd2l0Y2hUb0N1c3RvbWVyJykKICAgICAgICAgICAgICAgICAgICAmJiAkU2VsZi0+e1N3aXRjaFRvQ3VzdG9tZXJQZXJtaXNzaW9ufQogICAgICAgICAgICAgICAgICAgICYmICRQYXJhbXtOYXZ9IG5lICdOb25lJwogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAnT3ZlcnZpZXdSZXN1bHRSb3dTd2l0Y2hUb0N1c3RvbWVyJywKICAgICAgICAgICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZWFyY2ggPT4gJFBhcmFte1NlYXJjaH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAlVXNlckRhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBvdGhlcndpc2UgaXQgZGlzcGxheXMgYSBubyBkYXRhIGZvdW5kIG1lc3NhZ2UKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdOb0RhdGFGb3VuZE1zZycsCiAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICBDb2xTcGFuID0+ICRDb2xTcGFuLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CgogICAgIyBpZiB0aGVyZSBpcyBub3RoaW5nIHRvIHNlYXJjaCBpdCBzaG93cyBhIG1lc3NhZ2UKICAgIGVsc2UKICAgIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnTm9TZWFyY2hUZXJtcycsCiAgICAgICAgICAgIERhdGEgPT4ge30sCiAgICAgICAgKTsKICAgIH0KCiAgICAkTGF5b3V0T2JqZWN0LT5BZGRKU0RhdGEoCiAgICAgICAgS2V5ICAgPT4gJ05hdicsCiAgICAgICAgVmFsdWUgPT4gJFBhcmFte05hdn0sCiAgICApOwoKICAgIHJldHVybjsKfQoKc3ViIF9FZGl0IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBHZXQgbGF5b3V0IG9iamVjdC4KICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgbXkgJE91dHB1dCA9ICcnOwoKICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgIE5hbWUgPT4gJ092ZXJ2aWV3JywKICAgICAgICBEYXRhID0+IFwlUGFyYW0sCiAgICApOwoKICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKCBOYW1lID0+ICdBY3Rpb25MaXN0JyApOwogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnQWN0aW9uT3ZlcnZpZXcnLAogICAgICAgIERhdGEgPT4gXCVQYXJhbSwKICAgICk7CgogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnT3ZlcnZpZXdVcGRhdGUnLAogICAgICAgIERhdGEgPT4gXCVQYXJhbSwKICAgICk7CgogICAgaWYgKCAkUGFyYW17QWN0aW9ufSBlcSAnQ2hhbmdlJyApIHsKCiAgICAgICAgIyBzaG93cyBlZGl0IGhlYWRlcgogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKCBOYW1lID0+ICdIZWFkZXJFZGl0JyApOwoKICAgICAgICAjIHNob3dzIGVmZmVjdGl2ZSBwZXJtaXNzaW9ucyBtYXRyaXgKICAgICAgICAkU2VsZi0+X0VmZmVjdGl2ZVBlcm1pc3Npb25zKCVQYXJhbSk7CiAgICB9CgogICAgIyBzaG93cyBhZGQgaGVhZGVyCiAgICBlbHNlIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jayggTmFtZSA9PiAnSGVhZGVyQWRkJyApOwogICAgfQoKICAgIG15ICRVcGRhdGVPbmx5UHJlZmVyZW5jZXM7CgogICAgIyBHZXQgY29uZmlnIG9iamVjdAogICAgbXkgJENvbmZpZ09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CgogICAgIyB1cGRhdGUgdXNlcgogICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoICRQYXJhbXtTb3VyY2V9ICktPntSZWFkT25seX0gfHwgJENvbmZpZ09iamVjdC0+R2V0KCAkUGFyYW17U291cmNlfSApLT57TW9kdWxlfSA9fiAvTERBUC9pICkKICAgIHsKICAgICAgICAkVXBkYXRlT25seVByZWZlcmVuY2VzID0gMTsKICAgIH0KCiAgICAjIEdldCBkeW5hbWljIGZpZWxkIGJhY2tlbmQgb2JqZWN0LgogICAgbXkgJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6RHluYW1pY0ZpZWxkOjpCYWNrZW5kJyk7CiAgICBteSAkUGFyYW1PYmplY3QgICAgICAgICAgICAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpXZWI6OlJlcXVlc3QnKTsKCiAgICBFTlRSWToKICAgIGZvciBteSAkRW50cnkgKCBAeyAkQ29uZmlnT2JqZWN0LT5HZXQoICRQYXJhbXtTb3VyY2V9ICktPntNYXB9IH0gKSB7CiAgICAgICAgbmV4dCBFTlRSWSBpZiAhJEVudHJ5LT5bMF07CgogICAgICAgICMgSGFuZGxlIGR5bmFtaWMgZmllbGRzCiAgICAgICAgaWYgKCAkRW50cnktPls1XSBlcSAnZHluYW1pY19maWVsZCcgKSB7CgogICAgICAgICAgICBteSAkRHluYW1pY0ZpZWxkQ29uZmlnID0gJFNlbGYtPntEeW5hbWljRmllbGRMb29rdXB9LT57ICRFbnRyeS0+WzJdIH07CgogICAgICAgICAgICBuZXh0IEVOVFJZIGlmICFJc0hhc2hSZWZXaXRoRGF0YSgkRHluYW1pY0ZpZWxkQ29uZmlnKTsKCiAgICAgICAgICAgICMgR2V0IEhUTUwgZm9yIGR5bmFtaWMgZmllbGQKICAgICAgICAgICAgbXkgJER5bmFtaWNGaWVsZEhUTUwgPSAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdC0+RWRpdEZpZWxkUmVuZGVyKAogICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRDb25maWcsCiAgICAgICAgICAgICAgICBWYWx1ZSAgICAgICAgICAgICAgPT4gJFBhcmFteyAkRW50cnktPlswXSB9ID8gJFBhcmFteyAkRW50cnktPlswXSB9IDogdW5kZWYsCiAgICAgICAgICAgICAgICBNYW5kYXRvcnkgICAgICAgICAgPT4gJEVudHJ5LT5bNF0sCiAgICAgICAgICAgICAgICBMYXlvdXRPYmplY3QgICAgICAgPT4gJExheW91dE9iamVjdCwKICAgICAgICAgICAgICAgIFBhcmFtT2JqZWN0ICAgICAgICA9PiAkUGFyYW1PYmplY3QsCgogICAgICAgICAgICAgICAgIyBTZXJ2ZXIgZXJyb3IsIGlmIGFueQogICAgICAgICAgICAgICAgJXsgJFBhcmFte0Vycm9yc30tPnsgJEVudHJ5LT5bMF0gfSB9LAogICAgICAgICAgICApOwoKICAgICAgICAgICAgIyBza2lwIGZpZWxkcyBmb3Igd2hpY2ggSFRNTCBjb3VsZCBub3QgYmUgcmV0cmlldmVkCiAgICAgICAgICAgIG5leHQgRU5UUlkgaWYgIUlzSGFzaFJlZldpdGhEYXRhKCREeW5hbWljRmllbGRIVE1MKTsKCiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgTmFtZSA9PiAnSXRlbScsCiAgICAgICAgICAgICAgICBEYXRhID0+IHt9LAogICAgICAgICAgICApOwoKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdEeW5hbWljRmllbGQnLAogICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgTmFtZSAgPT4gJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9LAogICAgICAgICAgICAgICAgICAgIExhYmVsID0+ICREeW5hbWljRmllbGRIVE1MLT57TGFiZWx9LAogICAgICAgICAgICAgICAgICAgIEZpZWxkID0+ICREeW5hbWljRmllbGRIVE1MLT57RmllbGR9LAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIG5leHQgRU5UUlk7CiAgICAgICAgfQoKICAgICAgICBteSAkQmxvY2sgPSAnSW5wdXQnOwoKICAgICAgICAjIGNoZWNrIGlucHV0IHR5cGUKICAgICAgICBpZiAoICRFbnRyeS0+WzBdID1+IC9eVXNlclBhc3N3b3IvaSApIHsKICAgICAgICAgICAgJEJsb2NrID0gJ1Bhc3N3b3JkJzsKICAgICAgICB9CgogICAgICAgICMgY2hlY2sgaWYgbG9naW4gYXV0byBjcmVhdGlvbgogICAgICAgIGlmICggJENvbmZpZ09iamVjdC0+R2V0KCAkUGFyYW17U291cmNlfSApLT57QXV0b0xvZ2luQ3JlYXRpb259ICYmICRFbnRyeS0+WzBdIGVxICdVc2VyTG9naW4nICkgewogICAgICAgICAgICAkQmxvY2sgPSAnSW5wdXRIaWRkZW4nOwogICAgICAgIH0KCiAgICAgICAgaWYgKCAkRW50cnktPls3XSB8fCAkVXBkYXRlT25seVByZWZlcmVuY2VzICkgewogICAgICAgICAgICAkUGFyYW17UmVhZE9ubHl9ID0gMTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRQYXJhbXtSZWFkT25seX0gPSAwOwogICAgICAgIH0KCiAgICAgICAgIyBzaG93IHJlcXVpcmVkIGZsYWcKICAgICAgICBpZiAoICRFbnRyeS0+WzRdICkgewogICAgICAgICAgICAkUGFyYW17UmVxdWlyZWRDbGFzc30gICAgICAgICAgPSAnVmFsaWRhdGVfUmVxdWlyZWQnOwogICAgICAgICAgICAkUGFyYW17UmVxdWlyZWRMYWJlbENsYXNzfSAgICAgPSAnTWFuZGF0b3J5JzsKICAgICAgICAgICAgJFBhcmFte1JlcXVpcmVkTGFiZWxDaGFyYWN0ZXJ9ID0gJyonOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJFBhcmFte1JlcXVpcmVkQ2xhc3N9ICAgICAgICAgID0gJyc7CiAgICAgICAgICAgICRQYXJhbXtSZXF1aXJlZExhYmVsQ2xhc3N9ICAgICA9ICcnOwogICAgICAgICAgICAkUGFyYW17UmVxdWlyZWRMYWJlbENoYXJhY3Rlcn0gPSAnJzsKICAgICAgICB9CgogICAgICAgICMgc2V0IGVtcHR5IHN0cmluZwogICAgICAgICRQYXJhbXtFcnJvcnN9LT57ICRFbnRyeS0+WzBdIC4gJ0ludmFsaWQnIH0gfHw9ICcnOwoKICAgICAgICAjIGFkZCBjbGFzcyB0byB2YWxpZGF0ZSBlbWFpbHMKICAgICAgICBpZiAoICRFbnRyeS0+WzBdIGVxICdVc2VyRW1haWwnICkgewogICAgICAgICAgICAkUGFyYW17UmVxdWlyZWRDbGFzc30gLj0gJyBWYWxpZGF0ZV9FbWFpbCc7CiAgICAgICAgfQoKICAgICAgICAjIGJ1aWxkIHNlbGVjdGlvbnMgb3IgaW5wdXQgZmllbGRzCiAgICAgICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoICRQYXJhbXtTb3VyY2V9ICktPntTZWxlY3Rpb25zfS0+eyAkRW50cnktPlswXSB9ICkgewogICAgICAgICAgICAkQmxvY2sgPSAnT3B0aW9uJzsKCiAgICAgICAgICAgICMgQ2hhbmdlIHRoZSB2YWxpZGF0aW9uIGNsYXNzCiAgICAgICAgICAgIGlmICggJFBhcmFte1JlcXVpcmVkQ2xhc3N9ICkgewogICAgICAgICAgICAgICAgJFBhcmFte1JlcXVpcmVkQ2xhc3N9ID0gJ1ZhbGlkYXRlX1JlcXVpcmVkJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBnZXQgdGhlIGRhdGEgb2YgdGhlIGN1cnJlbnQgc2VsZWN0aW9uCiAgICAgICAgICAgIG15ICRTZWxlY3Rpb25zRGF0YSA9ICRDb25maWdPYmplY3QtPkdldCggJFBhcmFte1NvdXJjZX0gKS0+e1NlbGVjdGlvbnN9LT57ICRFbnRyeS0+WzBdIH07CgogICAgICAgICAgICAjIG1ha2Ugc3VyZSB0aGUgZW5jb2Rpbmcgc3RhbXAgaXMgc2V0CiAgICAgICAgICAgIGZvciBteSAkS2V5ICggc29ydCBrZXlzICV7JFNlbGVjdGlvbnNEYXRhfSApIHsKICAgICAgICAgICAgICAgICRTZWxlY3Rpb25zRGF0YS0+eyRLZXl9CiAgICAgICAgICAgICAgICAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6RW5jb2RlJyktPkVuY29kZUlucHV0KCAkU2VsZWN0aW9uc0RhdGEtPnskS2V5fSApOwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGJ1aWxkIG9wdGlvbiBzdHJpbmcKICAgICAgICAgICAgJFBhcmFte09wdGlvbn0gPSAkTGF5b3V0T2JqZWN0LT5CdWlsZFNlbGVjdGlvbigKICAgICAgICAgICAgICAgIERhdGEgICAgICAgID0+ICRTZWxlY3Rpb25zRGF0YSwKICAgICAgICAgICAgICAgIE5hbWUgICAgICAgID0+ICRFbnRyeS0+WzBdLAogICAgICAgICAgICAgICAgVHJhbnNsYXRpb24gPT4gMSwKICAgICAgICAgICAgICAgIFNlbGVjdGVkSUQgID0+ICRQYXJhbXsgJEVudHJ5LT5bMF0gfSwKICAgICAgICAgICAgICAgIENsYXNzICAgICAgID0+ICIkUGFyYW17UmVxdWlyZWRDbGFzc30gTW9kZXJuaXplICIgLiAkUGFyYW17RXJyb3JzfS0+eyAkRW50cnktPlswXSAuICdJbnZhbGlkJyB9LAogICAgICAgICAgICAgICAgRGlzYWJsZWQgICAgPT4gJFVwZGF0ZU9ubHlQcmVmZXJlbmNlcyA/IDEgOiAwLAogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBlbHNpZiAoICRFbnRyeS0+WzBdID1+IC9eVmFsaWRJRC9pICkgewoKICAgICAgICAgICAgIyBDaGFuZ2UgdGhlIHZhbGlkYXRpb24gY2xhc3MKICAgICAgICAgICAgaWYgKCAkUGFyYW17UmVxdWlyZWRDbGFzc30gKSB7CiAgICAgICAgICAgICAgICAkUGFyYW17UmVxdWlyZWRDbGFzc30gPSAnVmFsaWRhdGVfUmVxdWlyZWQnOwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGJ1aWxkIFZhbGlkSUQgc3RyaW5nCiAgICAgICAgICAgICRCbG9jayA9ICdPcHRpb24nOwogICAgICAgICAgICAkUGFyYW17T3B0aW9ufSA9ICRMYXlvdXRPYmplY3QtPkJ1aWxkU2VsZWN0aW9uKAogICAgICAgICAgICAgICAgRGF0YSAgICAgICA9PiB7ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpWYWxpZCcpLT5WYWxpZExpc3QoKSwgfSwKICAgICAgICAgICAgICAgIE5hbWUgICAgICAgPT4gJEVudHJ5LT5bMF0sCiAgICAgICAgICAgICAgICBTZWxlY3RlZElEID0+IGRlZmluZWQoICRQYXJhbXsgJEVudHJ5LT5bMF0gfSApID8gJFBhcmFteyAkRW50cnktPlswXSB9IDogMSwKICAgICAgICAgICAgICAgIENsYXNzICAgICAgPT4gIiRQYXJhbXtSZXF1aXJlZENsYXNzfSBNb2Rlcm5pemUgIiAuICRQYXJhbXtFcnJvcnN9LT57ICRFbnRyeS0+WzBdIC4gJ0ludmFsaWQnIH0sCiAgICAgICAgICAgICAgICBEaXNhYmxlZCAgID0+ICRVcGRhdGVPbmx5UHJlZmVyZW5jZXMgPyAxIDogMCwKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgZWxzaWYgKAogICAgICAgICAgICAkRW50cnktPlswXSA9fiAvXlVzZXJDdXN0b21lcklEJC9pCiAgICAgICAgICAgICYmICRDb25maWdPYmplY3QtPkdldCggJFBhcmFte1NvdXJjZX0gKS0+e0N1c3RvbWVyQ29tcGFueVN1cHBvcnR9CiAgICAgICAgICAgICkKICAgICAgICB7CiAgICAgICAgICAgIG15ICRDdXN0b21lckNvbXBhbnlPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q3VzdG9tZXJDb21wYW55Jyk7CiAgICAgICAgICAgIG15ICVDb21wYW55TGlzdCAgICAgICAgICAgPSAoCiAgICAgICAgICAgICAgICAkQ3VzdG9tZXJDb21wYW55T2JqZWN0LT5DdXN0b21lckNvbXBhbnlMaXN0KCBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9LCBMaW1pdCA9PiAwICksCiAgICAgICAgICAgICAgICAnJyA9PiAnLScsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGlmICggJFBhcmFteyAkRW50cnktPlswXSB9ICkgewogICAgICAgICAgICAgICAgbXkgJUNvbXBhbnkgPSAkQ3VzdG9tZXJDb21wYW55T2JqZWN0LT5DdXN0b21lckNvbXBhbnlHZXQoCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJJRCA9PiAkUGFyYW17ICRFbnRyeS0+WzBdIH0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgaWYgKCAhJUNvbXBhbnkgKSB7CiAgICAgICAgICAgICAgICAgICAgJENvbXBhbnlMaXN0eyAkUGFyYW17ICRFbnRyeS0+WzBdIH0gfSA9ICRQYXJhbXsgJEVudHJ5LT5bMF0gfSAuICcgKC0pJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAkQmxvY2sgPSAnT3B0aW9uJzsKCiAgICAgICAgICAgICMgQ2hhbmdlIHRoZSB2YWxpZGF0aW9uIGNsYXNzCiAgICAgICAgICAgIGlmICggJFBhcmFte1JlcXVpcmVkQ2xhc3N9ICkgewogICAgICAgICAgICAgICAgJFBhcmFte1JlcXVpcmVkQ2xhc3N9ID0gJ1ZhbGlkYXRlX1JlcXVpcmVkJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbXkgJFVzZUF1dG9Db21wbGV0ZSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnQWRtaW5DdXN0b21lclVzZXI6OlVzZUF1dG9Db21wbGV0ZScpOwoKICAgICAgICAgICAgaWYgKCRVc2VBdXRvQ29tcGxldGUpIHsKCiAgICAgICAgICAgICAgICBteSAkVmFsdWUgPSAkUGFyYW17ICRFbnRyeS0+WzBdIH0gfHwgJFBhcmFte0N1c3RvbWVySUR9OwogICAgICAgICAgICAgICAgJFBhcmFte09wdGlvbn0gPSAnPGlucHV0IHR5cGU9InRleHQiIGlkPSJVc2VyQ3VzdG9tZXJJRCIgbmFtZT0iVXNlckN1c3RvbWVySUQiIHZhbHVlPSInIC4gJFZhbHVlIC4gJyIKICAgICAgICAgICAgICAgICAgICBjbGFzcz0iVzUwcGMgQ3VzdG9tZXJBdXRvQ29tcGxldGVTaW1wbGUgJwogICAgICAgICAgICAgICAgICAgIC4gJFBhcmFte1JlcXVpcmVkQ2xhc3N9IC4gJyAnCiAgICAgICAgICAgICAgICAgICAgLiAkUGFyYW17RXJyb3JzfS0+eyAkRW50cnktPlswXSAuICdJbnZhbGlkJyB9CiAgICAgICAgICAgICAgICAgICAgLiAnIiBkYXRhLWN1c3RvbWVyLXNlYXJjaC10eXBlPSJDdXN0b21lcklEIiAvPic7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkUGFyYW17T3B0aW9ufSA9ICRMYXlvdXRPYmplY3QtPkJ1aWxkU2VsZWN0aW9uKAogICAgICAgICAgICAgICAgICAgIERhdGEgICAgICAgPT4gXCVDb21wYW55TGlzdCwKICAgICAgICAgICAgICAgICAgICBOYW1lICAgICAgID0+ICRFbnRyeS0+WzBdLAogICAgICAgICAgICAgICAgICAgIE1heCAgICAgICAgPT4gODAsCiAgICAgICAgICAgICAgICAgICAgU2VsZWN0ZWRJRCA9PiAkUGFyYW17ICRFbnRyeS0+WzBdIH0gfHwgJFBhcmFte0N1c3RvbWVySUR9LAogICAgICAgICAgICAgICAgICAgIENsYXNzICAgICAgPT4gIiRQYXJhbXtSZXF1aXJlZENsYXNzfSBNb2Rlcm5pemUgIiAuICRQYXJhbXtFcnJvcnN9LT57ICRFbnRyeS0+WzBdIC4gJ0ludmFsaWQnIH0sCiAgICAgICAgICAgICAgICAgICAgRGlzYWJsZWQgICA9PiAkVXBkYXRlT25seVByZWZlcmVuY2VzID8gMSA6IDAsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2lmICggJFBhcmFte0FjdGlvbn0gZXEgJ0FkZCcgJiYgJEVudHJ5LT5bMF0gPX4gL15Vc2VyQ3VzdG9tZXJJRCQvaSApIHsKCiAgICAgICAgICAgICMgVXNlIEN1c3RvbWVySUQgcGFyYW0gaWYgY2FsbGVkIGZyb20gQ0lDLgogICAgICAgICAgICAkUGFyYW17VmFsdWV9ID0gJFBhcmFteyAkRW50cnktPlswXSB9IHx8ICRQYXJhbXtDdXN0b21lcklEfSB8fCAnJzsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRQYXJhbXtWYWx1ZX0gPSAkUGFyYW17ICRFbnRyeS0+WzBdIH0gfHwgJyc7CiAgICAgICAgfQoKICAgICAgICAjIGFkZCBmb3JtIG9wdGlvbgogICAgICAgIGlmICggJFBhcmFte1R5cGV9ICYmICRQYXJhbXtUeXBlfSBlcSAnaGlkZGVuJyApIHsKICAgICAgICAgICAgJFBhcmFte1ByZWZlcmVuY2VzfSAuPSAkUGFyYW17VmFsdWV9OwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdQcmVmZXJlbmNlc0dlbmVyaWMnLAogICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgSXRlbSA9PiAkRW50cnktPlsxXSwKICAgICAgICAgICAgICAgICAgICAlUGFyYW0KICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgTmFtZSA9PiAiUHJlZmVyZW5jZXNHZW5lcmljJEJsb2NrIiwKICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgIEl0ZW0gICAgICAgICA9PiAkRW50cnktPlsxXSwKICAgICAgICAgICAgICAgICAgICBOYW1lICAgICAgICAgPT4gJEVudHJ5LT5bMF0sCiAgICAgICAgICAgICAgICAgICAgSW52YWxpZEZpZWxkID0+ICRQYXJhbXtFcnJvcnN9LT57ICRFbnRyeS0+WzBdIC4gJ0ludmFsaWQnIH0gfHwgJycsCiAgICAgICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgYWRkIHRoZSBjb3JyZWN0IGNsaWVudCBzaWRlIGVycm9yIG1zZwogICAgICAgICAgICBpZiAoICRCbG9jayBlcSAnSW5wdXQnICYmICRFbnRyeS0+WzBdIGVxICdVc2VyRW1haWwnICkgewogICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAnUHJlZmVyZW5jZXNVc2VyRW1haWxFcnJvck1zZycsCiAgICAgICAgICAgICAgICAgICAgRGF0YSA9PiB7IE5hbWUgPT4gJEVudHJ5LT5bMF0gfSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICJQcmVmZXJlbmNlc0dlbmVyaWNFcnJvck1zZyIsCiAgICAgICAgICAgICAgICAgICAgRGF0YSA9PiB7IE5hbWUgPT4gJEVudHJ5LT5bMF0gfSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgYWRkIHRoZSBjb3JyZWN0IHNlcnZlciBlcnJvciBtc2cKICAgICAgICAgICAgaWYgKCAkQmxvY2sgZXEgJ0lucHV0JyAmJiAkUGFyYW17VXNlckVtYWlsfSAmJiAkRW50cnktPlswXSBlcSAnVXNlckVtYWlsJyApIHsKCiAgICAgICAgICAgICAgICAjIGRpc3BsYXkgc2VydmVyIGVycm9yIG1zZyBhY2NvcmRpbmcgd2l0aCB0aGUgb2NjdXJyZWQgZW1haWwgZXJyb3IgdHlwZQogICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAnUHJlZmVyZW5jZXNVc2VyRW1haWwnIC4gKCAkUGFyYW17RXJyb3JzfS0+e0Vycm9yVHlwZX0gfHwgJycgKSwKICAgICAgICAgICAgICAgICAgICBEYXRhID0+IHsgTmFtZSA9PiAkRW50cnktPlswXSB9LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gIlByZWZlcmVuY2VzR2VuZXJpY1NlcnZlckVycm9yTXNnIiwKICAgICAgICAgICAgICAgICAgICBEYXRhID0+IHsgTmFtZSA9PiAkRW50cnktPlswXSB9LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBteSAkUHJlZmVyZW5jZXNVc2VkID0gJENvbmZpZ09iamVjdC0+R2V0KCAkUGFyYW17U291cmNlfSApLT57QWRtaW5TZXRQcmVmZXJlbmNlc307CiAgICBpZiAoICggZGVmaW5lZCAkUHJlZmVyZW5jZXNVc2VkICYmICRQcmVmZXJlbmNlc1VzZWQgIT0gMCApIHx8ICFkZWZpbmVkICRQcmVmZXJlbmNlc1VzZWQgKSB7CgogICAgICAgIG15ICVEYXRhOwogICAgICAgIG15ICVQcmVmZXJlbmNlcyA9ICV7ICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXJQcmVmZXJlbmNlc0dyb3VwcycpIH07CgogICAgICAgIEdST1VQOgogICAgICAgIGZvciBteSAkR3JvdXAgKCBzb3J0IGtleXMgJVByZWZlcmVuY2VzICkgewoKICAgICAgICAgICAgbmV4dCBHUk9VUCBpZiAhJEdyb3VwOwoKICAgICAgICAgICAgbXkgJFByZWZlcmVuY2VzR3JvdXAgPSAkUHJlZmVyZW5jZXN7JEdyb3VwfTsKCiAgICAgICAgICAgIG5leHQgR1JPVVAgaWYgISRQcmVmZXJlbmNlc0dyb3VwOwogICAgICAgICAgICBuZXh0IEdST1VQIGlmIHJlZiAkUHJlZmVyZW5jZXNHcm91cCBuZSAnSEFTSCc7CgogICAgICAgICAgICBpZiAoICREYXRheyAkUHJlZmVyZW5jZXNHcm91cC0+e1ByaW99IH0gKSB7CgogICAgICAgICAgICAgICAgQ09VTlQ6CiAgICAgICAgICAgICAgICBmb3IgbXkgJENvdW50ICggMSAuLiAxNTEgKSB7CgogICAgICAgICAgICAgICAgICAgICRQcmVmZXJlbmNlc0dyb3VwLT57UHJpb30rKzsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCAhJERhdGF7ICRQcmVmZXJlbmNlc0dyb3VwLT57UHJpb30gfSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJERhdGF7ICRQcmVmZXJlbmNlc0dyb3VwLT57UHJpb30gfSA9ICRHcm91cDsKICAgICAgICAgICAgICAgICAgICAgICAgbGFzdCBDT1VOVDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICREYXRheyAkUHJlZmVyZW5jZXNHcm91cC0+e1ByaW99IH0gPSAkR3JvdXA7CiAgICAgICAgfQoKICAgICAgICAjIHNvcnQKICAgICAgICBmb3IgbXkgJEtleSAoIHNvcnQga2V5cyAlRGF0YSApIHsKICAgICAgICAgICAgJERhdGF7IHNwcmludGYgIiUwN2QiLCAkS2V5IH0gPSAkRGF0YXskS2V5fTsKICAgICAgICAgICAgZGVsZXRlICREYXRheyRLZXl9OwogICAgICAgIH0KCiAgICAgICAgIyBzaG93IGVhY2ggcHJlZmVyZW5jZXMgc2V0dGluZwogICAgICAgIFBSSU86CiAgICAgICAgZm9yIG15ICRQcmlvICggc29ydCBrZXlzICVEYXRhICkgewoKICAgICAgICAgICAgbXkgJEdyb3VwID0gJERhdGF7JFByaW99OwogICAgICAgICAgICBpZiAoICEkQ29uZmlnT2JqZWN0LT57Q3VzdG9tZXJQcmVmZXJlbmNlc0dyb3Vwc30tPnskR3JvdXB9ICkgewogICAgICAgICAgICAgICAgbmV4dCBQUklPOwogICAgICAgICAgICB9CgogICAgICAgICAgICBteSAlUHJlZmVyZW5jZSA9ICV7ICRDb25maWdPYmplY3QtPntDdXN0b21lclByZWZlcmVuY2VzR3JvdXBzfS0+eyRHcm91cH0gfTsKICAgICAgICAgICAgaWYgKCAkR3JvdXAgZXEgJ1Bhc3N3b3JkJyApIHsKICAgICAgICAgICAgICAgIG5leHQgUFJJTzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbXkgJE1vZHVsZSA9ICRQcmVmZXJlbmNle01vZHVsZX0KICAgICAgICAgICAgICAgIHx8ICdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6Q3VzdG9tZXJQcmVmZXJlbmNlc0dlbmVyaWMnOwoKICAgICAgICAgICAgIyBsb2FkIG1vZHVsZQogICAgICAgICAgICBpZiAoICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpNYWluJyktPlJlcXVpcmUoJE1vZHVsZSkgKSB7CiAgICAgICAgICAgICAgICBteSAkT2JqZWN0ID0gJE1vZHVsZS0+bmV3KAogICAgICAgICAgICAgICAgICAgICV7JFNlbGZ9LAogICAgICAgICAgICAgICAgICAgIENvbmZpZ0l0ZW0gPT4gXCVQcmVmZXJlbmNlLAogICAgICAgICAgICAgICAgICAgIFVzZXJPYmplY3QgPT4gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyVXNlcicpLAogICAgICAgICAgICAgICAgICAgIERlYnVnICAgICAgPT4gJFNlbGYtPntEZWJ1Z30sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgbXkgQFBhcmFtcyA9ICRPYmplY3QtPlBhcmFtKCBVc2VyRGF0YSA9PiBcJVBhcmFtICk7CiAgICAgICAgICAgICAgICBpZiAoQFBhcmFtcykgewogICAgICAgICAgICAgICAgICAgIGZvciBteSAkUGFyYW1JdGVtIChAUGFyYW1zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAnSXRlbScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEYXRhID0+IHslUGFyYW19LAogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWYgJFBhcmFtSXRlbS0+e0RhdGF9IGVxICdIQVNIJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfHwgcmVmICRQcmVmZXJlbmNle0RhdGF9IGVxICdIQVNIJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBteSAlQnVpbGRTZWxlY3Rpb25QYXJhbXMgPSAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJVByZWZlcmVuY2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJXskUGFyYW1JdGVtfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkQnVpbGRTZWxlY3Rpb25QYXJhbXN7Q2xhc3N9ID0gam9pbiggJyAnLCAkQnVpbGRTZWxlY3Rpb25QYXJhbXN7Q2xhc3N9IC8vICcnLCAnTW9kZXJuaXplJyApOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRQYXJhbUl0ZW0tPntPcHRpb259ID0gJExheW91dE9iamVjdC0+QnVpbGRTZWxlY3Rpb24oCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJUJ1aWxkU2VsZWN0aW9uUGFyYW1zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICRQYXJhbUl0ZW0tPntCbG9ja30gfHwgJFByZWZlcmVuY2V7QmxvY2t9IHx8ICdPcHRpb24nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgR3JvdXAgPT4gJEdyb3VwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlRGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlUHJlZmVyZW5jZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAleyRQYXJhbUl0ZW19LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgICRMYXlvdXRPYmplY3QtPkFkZEpTRGF0YSgKICAgICAgICBLZXkgICA9PiAnTmF2JywKICAgICAgICBWYWx1ZSA9PiAkUGFyYW17TmF2fSwKICAgICk7CgogICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPk91dHB1dCgKICAgICAgICBUZW1wbGF0ZUZpbGUgPT4gJ0FkbWluQ3VzdG9tZXJVc2VyJywKICAgICAgICBEYXRhICAgICAgICAgPT4gXCVQYXJhbSwKICAgICk7Cn0KCnN1YiBfRWZmZWN0aXZlUGVybWlzc2lvbnMgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIG9ubHkgaWYgY3VzdG9tZXIgZ3JvdXAgZmVhdHVyZSBpcyBhY3RpdmUKICAgIGlmICggISRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnQ3VzdG9tZXJHcm91cFN1cHBvcnQnKSApIHsKICAgICAgICByZXR1cm4gMTsKICAgIH0KCiAgICAjIGdldCBuZWVkZWQgb2JqZWN0cwogICAgbXkgJENvbmZpZ09iamVjdCAgICAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpOwogICAgbXkgJExheW91dE9iamVjdCAgICAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CiAgICBteSAkQ3VzdG9tZXJHcm91cE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDdXN0b21lckdyb3VwJyk7CgogICAgIyBzaG93IHRhYmxlcwogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnRWZmZWN0aXZlUGVybWlzc2lvbnMnLAogICAgKTsKCiAgICBteSAlR3JvdXBzOwogICAgbXkgJVBlcm1pc3Npb25zOwoKICAgICMgZ28gdGhyb3VnaCBwZXJtaXNzaW9uIHR5cGVzCiAgICBteSBAVHlwZXMgPSBAeyAkQ29uZmlnT2JqZWN0LT5HZXQoJ1N5c3RlbTo6Q3VzdG9tZXI6OlBlcm1pc3Npb24nKSB9OwogICAgZm9yIG15ICRUeXBlIChAVHlwZXMpIHsKCiAgICAgICAgIyBzaG93IGhlYWRlcgogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICJIZWFkZXJHcm91cFBlcm1pc3Npb25UeXBlIiwKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBUeXBlID0+ICRUeXBlLAogICAgICAgICAgICB9LAogICAgICAgICk7CgogICAgICAgICMgZ2V0IGdyb3VwcyBvZiB0aGUgdXNlcgogICAgICAgIG15ICVVc2VyR3JvdXBzID0gJEN1c3RvbWVyR3JvdXBPYmplY3QtPkdyb3VwTWVtYmVyTGlzdCgKICAgICAgICAgICAgVXNlcklEICAgICAgICAgPT4gJFBhcmFte0lEfSwKICAgICAgICAgICAgVHlwZSAgICAgICAgICAgPT4gJFR5cGUsCiAgICAgICAgICAgIFJlc3VsdCAgICAgICAgID0+ICdIQVNIJywKICAgICAgICAgICAgUmF3UGVybWlzc2lvbnMgPT4gMCwgICAgICAgICAgICAjIGdldCBlZmZlY3RpdmUgcGVybWlzc2lvbnMKICAgICAgICApOwoKICAgICAgICAjIHN0b3JlIGRhdGEgaW4gbG9va3VwIGhhc2hlcwogICAgICAgIGZvciBteSAkR3JvdXBJRCAoIHNvcnQga2V5cyAlVXNlckdyb3VwcyApIHsKICAgICAgICAgICAgJEdyb3Vwc3skR3JvdXBJRH0gPSAkVXNlckdyb3Vwc3skR3JvdXBJRH07CiAgICAgICAgICAgICRQZXJtaXNzaW9uc3skR3JvdXBJRH17JFR5cGV9ID0gMTsKICAgICAgICB9CiAgICB9CgogICAgIyBzaG93IG1lc3NhZ2UgaWYgbm8gcGVybWlzc2lvbnMgZm91bmQKICAgIGlmICggISVQZXJtaXNzaW9ucyApIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnTm9Hcm91cFBlcm1pc3Npb25zRm91bmRNc2cnLAogICAgICAgICk7CiAgICB9CgogICAgIyBnbyB0aHJvdWdoIGdyb3Vwcywgc29ydCBieSBuYW1lCiAgICBlbHNlIHsKICAgICAgICBmb3IgbXkgJEdyb3VwSUQgKCBzb3J0IHsgdWMoICRHcm91cHN7JGF9ICkgY21wIHVjKCAkR3JvdXBzeyRifSApIH0ga2V5cyAlR3JvdXBzICkgewoKICAgICAgICAgICAgIyBzaG93IHRhYmxlIHJvd3MKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdHcm91cFBlcm1pc3Npb25UYWJsZVJvdycsCiAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICBJRCAgID0+ICRHcm91cElELAogICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gJEdyb3Vwc3skR3JvdXBJRH0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICApOwoKICAgICAgICAgICAgIyBzaG93IHBlcm1pc3Npb24gbWFya3MKICAgICAgICAgICAgZm9yIG15ICRUeXBlIChAVHlwZXMpIHsKICAgICAgICAgICAgICAgIG15ICRQZXJtaXNzaW9uTWFyayA9ICRQZXJtaXNzaW9uc3skR3JvdXBJRH17JFR5cGV9ID8gJ09uJyAgICAgICAgOiAnT2ZmJzsKICAgICAgICAgICAgICAgIG15ICRIaWdobGlnaHRNYXJrICA9ICRUeXBlIGVxICdydycgICAgICAgICAgICAgICAgID8gJ0hpZ2hsaWdodCcgOiAnJzsKICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gJ0dyb3VwUGVybWlzc2lvbk1hcmsnLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gJ0dyb3VwUGVybWlzc2lvbk1hcmsnIC4gJFBlcm1pc3Npb25NYXJrLAogICAgICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBIaWdobGlnaHQgPT4gJEhpZ2hsaWdodE1hcmssCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgIyBnZXQgYWxsIGFjY2Vzc2libGUgY3VzdG9tZXJzIG9mIHRoZSB1c2VyCiAgICBteSAlQ3VzdG9tZXJzID0gJEN1c3RvbWVyR3JvdXBPYmplY3QtPkdyb3VwQ29udGV4dEN1c3RvbWVycygKICAgICAgICBDdXN0b21lclVzZXJJRCA9PiAkUGFyYW17SUR9LAogICAgKTsKCiAgICAjIHNob3cgbWVzc2FnZSBpZiBubyBjdXN0b21lcnMgZm91bmQKICAgIGlmICggISVDdXN0b21lcnMgKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ05vQ3VzdG9tZXJBY2Nlc3NGb3VuZE1zZycsCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gMTsKICAgIH0KCiAgICAjIGdldCBwZXJtaXNzaW9uIGNvbnRleHRzCiAgICBteSAkQ29udGV4dENvbmZpZyAgICAgICAgICAgID0gJENvbmZpZ09iamVjdC0+R2V0KCdDdXN0b21lckdyb3VwUGVybWlzc2lvbkNvbnRleHQnKTsKICAgIG15ICREaXJlY3RBY2Nlc3NDb250ZXh0S2V5ICAgPSAnMDAxLUN1c3RvbWVySUQtc2FtZSc7CiAgICBteSAkSW5kaXJlY3RBY2Nlc3NDb250ZXh0S2V5ID0gJzEwMC1DdXN0b21lcklELW90aGVyJzsKCiAgICAjIHVzZSBkZWZhdWx0IGNvbnRleHQgaWYgbm9uZSBhcmUgZm91bmQKICAgIGlmICggIUlzSGFzaFJlZldpdGhEYXRhKCRDb250ZXh0Q29uZmlnKSApIHsKICAgICAgICAkQ29udGV4dENvbmZpZyA9IHsKICAgICAgICAgICAgJERpcmVjdEFjY2Vzc0NvbnRleHRLZXkgPT4gewogICAgICAgICAgICAgICAgTmFtZSA9PiBUcmFuc2xhdGFibGUoJ1NhbWUgQ3VzdG9tZXInKSwKICAgICAgICAgICAgfSwKICAgICAgICB9OwogICAgfQoKICAgICMgc2hvdyBkZWZhdWx0IGFuZCBleHRyYSBjb250ZXh0IGhlYWRlcnMgaWYgYXZhaWxhYmxlCiAgICBpZiAoICRDb250ZXh0Q29uZmlnLT57JERpcmVjdEFjY2Vzc0NvbnRleHRLZXl9ICkgewogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdIZWFkZXJDdXN0b21lckFjY2Vzc0NvbnRleHQnLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgIE5hbWUgPT4gVHJhbnNsYXRhYmxlKCdEaXJlY3QnKSwKICAgICAgICAgICAgfSwKICAgICAgICApOwogICAgfQogICAgaWYgKCAkQ29udGV4dENvbmZpZy0+eyRJbmRpcmVjdEFjY2Vzc0NvbnRleHRLZXl9ICkgewogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdIZWFkZXJDdXN0b21lckFjY2Vzc0NvbnRleHQnLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgIE5hbWUgPT4gVHJhbnNsYXRhYmxlKCdJbmRpcmVjdCcpLAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICB9CgogICAgIyBkZXRlcm1pbmUgY3VzdG9tZXJzIGZvciBkaXJlY3QgYW5kIGluZGlyZWN0IGFjY2VzcwogICAgbXkgQFVzZXJDdXN0b21lcklEcyA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDdXN0b21lclVzZXInKS0+Q3VzdG9tZXJJRHMoCiAgICAgICAgVXNlciA9PiAkUGFyYW17SUR9LAogICAgKTsKICAgIG15ICVFeHRyYUN1c3RvbWVySURzOwogICAgaWYgKCAkQ29udGV4dENvbmZpZy0+eyRJbmRpcmVjdEFjY2Vzc0NvbnRleHRLZXl9ICkgewogICAgICAgIG15ICRFeHRyYUNvbnRleHROYW1lID0gJEN1c3RvbWVyR3JvdXBPYmplY3QtPkdyb3VwQ29udGV4dE5hbWVHZXQoCiAgICAgICAgICAgIFN5c0NvbmZpZ05hbWUgPT4gJEluZGlyZWN0QWNjZXNzQ29udGV4dEtleSwKICAgICAgICApOwoKICAgICAgICAjIGZvciBhbGwgQ3VzdG9tZXJJRHMgZ2V0IGdyb3VwcyB3aXRoIGV4dHJhIGFjY2VzcwogICAgICAgIG15ICVFeHRyYVBlcm1pc3Npb25Hcm91cHM7CiAgICAgICAgQ1VTVE9NRVJJRDoKICAgICAgICBmb3IgbXkgJEN1c3RvbWVySUQgKEBVc2VyQ3VzdG9tZXJJRHMpIHsKICAgICAgICAgICAgbXkgJUdyb3VwTGlzdCA9ICRDdXN0b21lckdyb3VwT2JqZWN0LT5Hcm91cEN1c3RvbWVyTGlzdCgKICAgICAgICAgICAgICAgIEN1c3RvbWVySUQgPT4gJEN1c3RvbWVySUQsCiAgICAgICAgICAgICAgICBUeXBlICAgICAgID0+ICdybycsCiAgICAgICAgICAgICAgICBDb250ZXh0ICAgID0+ICRFeHRyYUNvbnRleHROYW1lLAogICAgICAgICAgICAgICAgUmVzdWx0ICAgICA9PiAnSEFTSCcsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIG5leHQgQ1VTVE9NRVJJRCBpZiAhJUdyb3VwTGlzdDsKCiAgICAgICAgICAgICMgYWRkIHRvIGdyb3VwcwogICAgICAgICAgICAlRXh0cmFQZXJtaXNzaW9uR3JvdXBzID0gKAogICAgICAgICAgICAgICAgJUV4dHJhUGVybWlzc2lvbkdyb3VwcywKICAgICAgICAgICAgICAgICVHcm91cExpc3QsCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIGFkZCBhbGwgdW5pcXVlIGFjY2Vzc2libGUgR3JvdXA8LT5DdXN0b21lciBjb21iaW5hdGlvbnMKICAgICAgICBHUk9VUElEOgogICAgICAgIGZvciBteSAkR3JvdXBJRCAoIHNvcnQga2V5cyAlRXh0cmFQZXJtaXNzaW9uR3JvdXBzICkgewogICAgICAgICAgICBteSBAR3JvdXBDdXN0b21lcklEcyA9ICRDdXN0b21lckdyb3VwT2JqZWN0LT5Hcm91cEN1c3RvbWVyTGlzdCgKICAgICAgICAgICAgICAgIEdyb3VwSUQgPT4gJEdyb3VwSUQsCiAgICAgICAgICAgICAgICBUeXBlICAgID0+ICdybycsCiAgICAgICAgICAgICAgICBSZXN1bHQgID0+ICdJRCcsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIG5leHQgR1JPVVBJRCBpZiAhQEdyb3VwQ3VzdG9tZXJJRHM7CgogICAgICAgICAgICAjIGFkZCB0byBFeHRyYUN1c3RvbWVySURzCiAgICAgICAgICAgICVFeHRyYUN1c3RvbWVySURzID0gKAogICAgICAgICAgICAgICAgJUV4dHJhQ3VzdG9tZXJJRHMsCiAgICAgICAgICAgICAgICBtYXAgeyAkXyA9PiAxIH0gQEdyb3VwQ3VzdG9tZXJJRHMsCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgICMgZ28gdGhyb3VnaCBjdXN0b21lcnMKICAgIENVU1RPTUVSSUQ6CiAgICBmb3IgbXkgJEN1c3RvbWVySUQgKCBzb3J0IGtleXMgJUN1c3RvbWVycyApIHsKCiAgICAgICAgIyBzaG93IHRhYmxlIHJvd3MKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnQ3VzdG9tZXJBY2Nlc3NUYWJsZVJvdycsCiAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgSUQgICA9PiAkQ3VzdG9tZXJJRCwKICAgICAgICAgICAgICAgIE5hbWUgPT4gJEN1c3RvbWVyc3skQ3VzdG9tZXJJRH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKCiAgICAgICAgIyAnU2FtZSBDdXN0b21lcicKICAgICAgICBpZiAoICRDb250ZXh0Q29uZmlnLT57JERpcmVjdEFjY2Vzc0NvbnRleHRLZXl9ICkgewoKICAgICAgICAgICAgIyBjaGVjayBpZiB3ZSBzaG91bGQgc2hvdyBjaGVjayBtYXJrIGZvciAnU2FtZSBDdXN0b21lcicKICAgICAgICAgICAgbXkgJEFjY2Vzc01hcmsgPSAoIGdyZXAgeyAkXyBlcSAkQ3VzdG9tZXJJRCB9IEBVc2VyQ3VzdG9tZXJJRHMgKSA/ICdPbicgOiAnT2ZmJzsKCiAgICAgICAgICAgICMgc2hvdyBibG9ja3MKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdDdXN0b21lckFjY2Vzc01hcmsnLAogICAgICAgICAgICApOwogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ0N1c3RvbWVyQWNjZXNzTWFyaycgLiAkQWNjZXNzTWFyaywKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgJ090aGVyIEN1c3RvbWVycycKICAgICAgICBuZXh0IENVU1RPTUVSSUQgaWYgISRDb250ZXh0Q29uZmlnLT57JEluZGlyZWN0QWNjZXNzQ29udGV4dEtleX07CgogICAgICAgICMgY2hlY2sgaWYgd2Ugc2hvdWxkIHNob3cgY2hlY2sgbWFyayBmb3IgJ090aGVyIEN1c3RvbWVycycKICAgICAgICBteSAkQWNjZXNzTWFyayA9ICRFeHRyYUN1c3RvbWVySURzeyRDdXN0b21lcklEfSA/ICdPbicgOiAnT2ZmJzsKCiAgICAgICAgIyBzaG93IGJsb2NrcwogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdDdXN0b21lckFjY2Vzc01hcmsnLAogICAgICAgICk7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ0N1c3RvbWVyQWNjZXNzTWFyaycgLiAkQWNjZXNzTWFyaywKICAgICAgICApOwogICAgfQoKICAgIHJldHVybiAxOwp9CgoxOwo=</File>
        <File Location="Custom/Kernel/Modules/AdminCustomerUserService.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxLTIwMjIgWm51bnkgR21iSCwgaHR0cHM6Ly96bnVueS5vcmcvCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6TW9kdWxlczo6QWRtaW5DdXN0b21lclVzZXJTZXJ2aWNlOwoKdXNlIHN0cmljdDsKdXNlIHdhcm5pbmdzOwoKdXNlIEtlcm5lbDo6TGFuZ3VhZ2UgcXcoVHJhbnNsYXRhYmxlKTsKCm91ciAkT2JqZWN0TWFuYWdlckRpc2FibGVkID0gMTsKCnN1YiBuZXcgewogICAgbXkgKCAkVHlwZSwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGFsbG9jYXRlIG5ldyBoYXNoIGZvciBvYmplY3QKICAgIG15ICRTZWxmID0geyVQYXJhbX07CiAgICBibGVzcyggJFNlbGYsICRUeXBlICk7CgogICAgcmV0dXJuICRTZWxmOwp9CgpzdWIgUnVuIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJExheW91dE9iamVjdCAgICAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKICAgIG15ICRQYXJhbU9iamVjdCAgICAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6V2ViOjpSZXF1ZXN0Jyk7CiAgICBteSAkU2VydmljZU9iamVjdCAgICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlNlcnZpY2UnKTsKICAgIG15ICRDdXN0b21lclVzZXJPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q3VzdG9tZXJVc2VyJyk7CgogICAgIyBzZXQgc2VhcmNoIGxpbWl0CiAgICBteSAkU2VhcmNoTGltaXQgPSAyMDA7CgogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gIwogICAgIyBhbGxvY2F0ZSBjdXN0b21lciB1c2VyCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICBpZiAoICRTZWxmLT57U3ViYWN0aW9ufSBlcSAnQWxsb2NhdGVDdXN0b21lclVzZXInICkgewoKICAgICAgICAjIGdldCBwYXJhbXMKICAgICAgICAkUGFyYW17Q3VzdG9tZXJVc2VyTG9naW59ID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0N1c3RvbWVyVXNlckxvZ2luJyApCiAgICAgICAgICAgIHx8ICc8REVGQVVMVD4nOwogICAgICAgICRQYXJhbXtDdXN0b21lclVzZXJTZWFyY2h9ID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0N1c3RvbWVyVXNlclNlYXJjaCcgKQogICAgICAgICAgICB8fCAnKic7CgogICAgICAgICMgb3V0cHV0IGhlYWRlcgogICAgICAgIG15ICRPdXRwdXQgPSAkTGF5b3V0T2JqZWN0LT5IZWFkZXIoKTsKICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk5hdmlnYXRpb25CYXIoKTsKCiAgICAgICAgIyBnZXQgc2VydmljZSBtZW1iZXIKICAgICAgICBteSAlU2VydmljZU1lbWJlckxpc3QgPSAkU2VydmljZU9iamVjdC0+Q3VzdG9tZXJVc2VyU2VydmljZU1lbWJlckxpc3QoCiAgICAgICAgICAgIEN1c3RvbWVyVXNlckxvZ2luID0+ICRQYXJhbXtDdXN0b21lclVzZXJMb2dpbn0sCiAgICAgICAgICAgIFJlc3VsdCAgICAgICAgICAgID0+ICdIQVNIJywKICAgICAgICAgICAgRGVmYXVsdFNlcnZpY2VzICAgPT4gMCwKICAgICAgICApOwoKICAgICAgICAjIExpc3Qgc2VydmljZXMuCiAgICAgICAgbXkgJVNlcnZpY2VEYXRhID0gJFNlcnZpY2VPYmplY3QtPlNlcnZpY2VMaXN0KAogICAgICAgICAgICBLZWVwQ2hpbGRyZW4gPT4gMSwKICAgICAgICAgICAgVXNlcklEICAgICAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICApOwoKICAgICAgICBpZiAoICRQYXJhbXtDdXN0b21lclVzZXJMb2dpbn0gZXEgJzxERUZBVUxUPicgKSB7CiAgICAgICAgICAgICRQYXJhbXtOYW1lfSA9IHF7fTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRQYXJhbXtOYW1lfSA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyTmFtZSggVXNlckxvZ2luID0+ICRQYXJhbXtDdXN0b21lclVzZXJMb2dpbn0gKQogICAgICAgICAgICAgICAgLiAiICgkUGFyYW17Q3VzdG9tZXJVc2VyTG9naW59KSI7CiAgICAgICAgfQoKICAgICAgICAkT3V0cHV0IC49ICRTZWxmLT5fQ2hhbmdlKAogICAgICAgICAgICBJRCAgICAgICAgICAgICAgICAgPT4gJFBhcmFte0N1c3RvbWVyVXNlckxvZ2lufSwKICAgICAgICAgICAgTmFtZSAgICAgICAgICAgICAgID0+ICRQYXJhbXtOYW1lfSwKICAgICAgICAgICAgRGF0YSAgICAgICAgICAgICAgID0+IFwlU2VydmljZURhdGEsCiAgICAgICAgICAgIFNlbGVjdGVkICAgICAgICAgICA9PiBcJVNlcnZpY2VNZW1iZXJMaXN0LAogICAgICAgICAgICBDdXN0b21lclVzZXJTZWFyY2ggPT4gJFBhcmFte0N1c3RvbWVyVXNlclNlYXJjaH0sCiAgICAgICAgICAgIFNlcnZpY2VTZWFyY2ggICAgICA9PiAkUGFyYW17U2VydmljZVNlYXJjaH0sCiAgICAgICAgICAgIFNlYXJjaExpbWl0ICAgICAgICA9PiAkU2VhcmNoTGltaXQsCiAgICAgICAgICAgIFR5cGUgICAgICAgICAgICAgICA9PiAnQ3VzdG9tZXJVc2VyJywKICAgICAgICApOwoKICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPkZvb3RlcigpOwoKICAgICAgICByZXR1cm4gJE91dHB1dDsKICAgIH0KCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICAjIGFsbG9jYXRlIHNlcnZpY2UKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgIGVsc2lmICggJFNlbGYtPntTdWJhY3Rpb259IGVxICdBbGxvY2F0ZVNlcnZpY2UnICkgewoKICAgICAgICAjIGdldCBwYXJhbXMKICAgICAgICAkUGFyYW17U2VydmljZUlEfSA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICJTZXJ2aWNlSUQiICk7CgogICAgICAgICRQYXJhbXtTdWJhY3Rpb259ID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ1N1YmFjdGlvbicgKTsKCiAgICAgICAgJFBhcmFte0N1c3RvbWVyVXNlclNlYXJjaH0gPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAiQ3VzdG9tZXJVc2VyU2VhcmNoIiApCiAgICAgICAgICAgIHx8ICcqJzsKCiAgICAgICAgIyBvdXRwdXQgaGVhZGVyCiAgICAgICAgbXkgJE91dHB1dCA9ICRMYXlvdXRPYmplY3QtPkhlYWRlcigpOwogICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+TmF2aWdhdGlvbkJhcigpOwoKICAgICAgICAjIGdldCBzZXJ2aWNlCiAgICAgICAgbXkgJVNlcnZpY2UgPSAkU2VydmljZU9iamVjdC0+U2VydmljZUdldCgKICAgICAgICAgICAgU2VydmljZUlEID0+ICRQYXJhbXtTZXJ2aWNlSUR9LAogICAgICAgICAgICBVc2VySUQgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICk7CgogICAgICAgICMgZ2V0IGN1c3RvbWVyIHVzZXIgbWVtYmVyCiAgICAgICAgbXkgJUN1c3RvbWVyVXNlck1lbWJlckxpc3QgPSAkU2VydmljZU9iamVjdC0+Q3VzdG9tZXJVc2VyU2VydmljZU1lbWJlckxpc3QoCiAgICAgICAgICAgIFNlcnZpY2VJRCAgICAgICA9PiAkUGFyYW17U2VydmljZUlEfSwKICAgICAgICAgICAgUmVzdWx0ICAgICAgICAgID0+ICdIQVNIJywKICAgICAgICAgICAgRGVmYXVsdFNlcnZpY2VzID0+IDAsCiAgICAgICAgKTsKCiAgICAgICAgIyBzZWFyY2ggY3VzdG9tZXIgdXNlcgogICAgICAgIG15ICVDdXN0b21lclVzZXJMaXN0ID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJTZWFyY2goCiAgICAgICAgICAgIFNlYXJjaCA9PiAkUGFyYW17Q3VzdG9tZXJVc2VyU2VhcmNofSwKICAgICAgICAgICAgVXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICApOwogICAgICAgIG15IEBDdXN0b21lclVzZXJLZXlMaXN0ID0gc29ydCB7ICRDdXN0b21lclVzZXJMaXN0eyRhfSBjbXAgJEN1c3RvbWVyVXNlckxpc3R7JGJ9IH0ga2V5cyAlQ3VzdG9tZXJVc2VyTGlzdDsKCiAgICAgICAgIyBzZXQgbWF4IGNvdW50CiAgICAgICAgbXkgJE1heENvdW50ID0gQEN1c3RvbWVyVXNlcktleUxpc3Q7CiAgICAgICAgaWYgKCAkTWF4Q291bnQgPiAkU2VhcmNoTGltaXQgKSB7CiAgICAgICAgICAgICRNYXhDb3VudCA9ICRTZWFyY2hMaW1pdDsKICAgICAgICB9CgogICAgICAgIG15ICVDdXN0b21lckRhdGE7CgogICAgICAgICMgb3V0cHV0IHJvd3MKICAgICAgICBmb3IgbXkgJENvdW50ZXIgKCAxIC4uICRNYXhDb3VudCApIHsKCiAgICAgICAgICAgICMgZ2V0IHNlcnZpY2UKICAgICAgICAgICAgbXkgJVVzZXIgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJEYXRhR2V0KAogICAgICAgICAgICAgICAgVXNlciA9PiAkQ3VzdG9tZXJVc2VyS2V5TGlzdFsgJENvdW50ZXIgLSAxIF0sCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIG15ICRVc2VyTmFtZSA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyTmFtZSgKICAgICAgICAgICAgICAgIFVzZXJMb2dpbiA9PiAkQ3VzdG9tZXJVc2VyS2V5TGlzdFsgJENvdW50ZXIgLSAxIF0KICAgICAgICAgICAgKTsKICAgICAgICAgICAgbXkgJEN1c3RvbWVyVXNlciA9ICIkVXNlck5hbWUgPCRVc2Vye1VzZXJFbWFpbH0+ICgkVXNlcntVc2VyQ3VzdG9tZXJJRH0pIjsKICAgICAgICAgICAgJEN1c3RvbWVyRGF0YXsgJFVzZXJ7VXNlcklEfSB9ID0gJEN1c3RvbWVyVXNlcjsKICAgICAgICB9CgogICAgICAgICRPdXRwdXQgLj0gJFNlbGYtPl9DaGFuZ2UoCiAgICAgICAgICAgIElEICAgICAgICAgICAgICAgICA9PiAkUGFyYW17U2VydmljZUlEfSwKICAgICAgICAgICAgTmFtZSAgICAgICAgICAgICAgID0+ICRTZXJ2aWNle05hbWV9LAogICAgICAgICAgICBJdGVtTGlzdCAgICAgICAgICAgPT4gXEBDdXN0b21lclVzZXJLZXlMaXN0LAogICAgICAgICAgICBEYXRhICAgICAgICAgICAgICAgPT4gXCVDdXN0b21lckRhdGEsCiAgICAgICAgICAgIFNlbGVjdGVkICAgICAgICAgICA9PiBcJUN1c3RvbWVyVXNlck1lbWJlckxpc3QsCiAgICAgICAgICAgIEN1c3RvbWVyVXNlclNlYXJjaCA9PiAkUGFyYW17Q3VzdG9tZXJVc2VyU2VhcmNofSwKICAgICAgICAgICAgU2VhcmNoTGltaXQgICAgICAgID0+ICRTZWFyY2hMaW1pdCwKICAgICAgICAgICAgVHlwZSAgICAgICAgICAgICAgID0+ICdTZXJ2aWNlJywKICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICk7CgogICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Rm9vdGVyKCk7CgogICAgICAgIHJldHVybiAkT3V0cHV0OwogICAgfQoKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgICMgYWxsb2NhdGUgY3VzdG9tZXIgdXNlciBzYXZlCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICBlbHNpZiAoICRTZWxmLT57U3ViYWN0aW9ufSBlcSAnQWxsb2NhdGVDdXN0b21lclVzZXJTYXZlJyApIHsKCiAgICAgICAgIyBjaGFsbGVuZ2UgdG9rZW4gY2hlY2sgZm9yIHdyaXRlIGFjdGlvbgogICAgICAgICRMYXlvdXRPYmplY3QtPkNoYWxsZW5nZVRva2VuQ2hlY2soKTsKCiAgICAgICAgIyBnZXQgcGFyYW1zCiAgICAgICAgJFBhcmFte0N1c3RvbWVyVXNlckxvZ2lufSA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdJRCcgKTsKCiAgICAgICAgJFBhcmFte0N1c3RvbWVyVXNlclNlYXJjaH0gPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQ3VzdG9tZXJVc2VyU2VhcmNoJyApCiAgICAgICAgICAgIHx8ICcqJzsKCiAgICAgICAgbXkgQFNlcnZpY2VJRHNTZWxlY3RlZCA9ICRQYXJhbU9iamVjdC0+R2V0QXJyYXkoIFBhcmFtID0+ICdJdGVtc1NlbGVjdGVkJyApOwogICAgICAgIG15IEBTZXJ2aWNlSURzQWxsICAgICAgPSAkUGFyYW1PYmplY3QtPkdldEFycmF5KCBQYXJhbSA9PiAnSXRlbXNBbGwnICk7CgogICAgICAgICMgY3JlYXRlIGhhc2ggd2l0aCBzZWxlY3RlZCBpZHMKICAgICAgICBteSAlU2VydmljZUlEU2VsZWN0ZWQgPSBtYXAgeyAkXyA9PiAxIH0gQFNlcnZpY2VJRHNTZWxlY3RlZDsKCiAgICAgICAgIyBjaGVjayBhbGwgdXNlZCBzZXJ2aWNlIGlkcwogICAgICAgIGZvciBteSAkU2VydmljZUlEIChAU2VydmljZUlEc0FsbCkgewogICAgICAgICAgICBteSAkQWN0aXZlID0gJFNlcnZpY2VJRFNlbGVjdGVkeyRTZXJ2aWNlSUR9ID8gMSA6IDA7CgogICAgICAgICAgICAjIHNldCBjdXN0b21lciB1c2VyIHNlcnZpY2UgbWVtYmVyCiAgICAgICAgICAgICRTZXJ2aWNlT2JqZWN0LT5DdXN0b21lclVzZXJTZXJ2aWNlTWVtYmVyQWRkKAogICAgICAgICAgICAgICAgQ3VzdG9tZXJVc2VyTG9naW4gPT4gJFBhcmFte0N1c3RvbWVyVXNlckxvZ2lufSwKICAgICAgICAgICAgICAgIFNlcnZpY2VJRCAgICAgICAgID0+ICRTZXJ2aWNlSUQsCiAgICAgICAgICAgICAgICBBY3RpdmUgICAgICAgICAgICA9PiAkQWN0aXZlLAogICAgICAgICAgICAgICAgVXNlcklEICAgICAgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBpZiB0aGUgdXNlciB3b3VsZCBsaWtlIHRvIGNvbnRpbnVlIGVkaXRpbmcgdGhlIGN1c3RvbWVyIHVzZXIgYWxsb2NhdGluZyBqdXN0IHJlZGlyZWN0IHRvIHRoZSBlZGl0IHNjcmVlbgogICAgICAgIGlmICgKICAgICAgICAgICAgZGVmaW5lZCAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQ29udGludWVBZnRlclNhdmUnICkKICAgICAgICAgICAgJiYgKCAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQ29udGludWVBZnRlclNhdmUnICkgZXEgJzEnICkKICAgICAgICAgICAgKQogICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPlJlZGlyZWN0KAogICAgICAgICAgICAgICAgT1AgPT4KICAgICAgICAgICAgICAgICAgICAiQWN0aW9uPSRTZWxmLT57QWN0aW9ufTtTdWJhY3Rpb249QWxsb2NhdGVDdXN0b21lclVzZXI7Q3VzdG9tZXJVc2VyTG9naW49JFBhcmFte0N1c3RvbWVyVXNlckxvZ2lufTtDdXN0b21lclVzZXJTZWFyY2g9JFBhcmFte0N1c3RvbWVyVXNlclNlYXJjaH0iCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewoKICAgICAgICAgICAgIyBvdGhlcndpc2UgcmV0dXJuIHRvIHJlbGF0aW9ucyBvdmVydmlldwogICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+UmVkaXJlY3QoCiAgICAgICAgICAgICAgICBPUCA9PiAiQWN0aW9uPSRTZWxmLT57QWN0aW9ufTtDdXN0b21lclVzZXJTZWFyY2g9JFBhcmFte0N1c3RvbWVyVXNlclNlYXJjaH0iCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgICMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICMKICAgICMgYWxsb2NhdGUgc2VydmljZSBzYXZlCiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAjCiAgICBlbHNpZiAoICRTZWxmLT57U3ViYWN0aW9ufSBlcSAnQWxsb2NhdGVTZXJ2aWNlU2F2ZScgKSB7CgogICAgICAgICMgY2hhbGxlbmdlIHRva2VuIGNoZWNrIGZvciB3cml0ZSBhY3Rpb24KICAgICAgICAkTGF5b3V0T2JqZWN0LT5DaGFsbGVuZ2VUb2tlbkNoZWNrKCk7CgogICAgICAgICMgZ2V0IHBhcmFtcwogICAgICAgICRQYXJhbXtTZXJ2aWNlSUR9ID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gIklEIiApOwoKICAgICAgICAkUGFyYW17Q3VzdG9tZXJVc2VyU2VhcmNofSA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdDdXN0b21lclVzZXJTZWFyY2gnICkKICAgICAgICAgICAgfHwgJyonOwoKICAgICAgICBteSBAQ3VzdG9tZXJVc2VyTG9naW5zU2VsZWN0ZWQgPSAkUGFyYW1PYmplY3QtPkdldEFycmF5KCBQYXJhbSA9PiAnSXRlbXNTZWxlY3RlZCcgKTsKICAgICAgICBteSBAQ3VzdG9tZXJVc2VyTG9naW5zQWxsICAgICAgPSAkUGFyYW1PYmplY3QtPkdldEFycmF5KCBQYXJhbSA9PiAnSXRlbXNBbGwnICk7CgogICAgICAgICMgY3JlYXRlIGhhc2ggd2l0aCBzZWxlY3RlZCBjdXN0b21lciB1c2VycwogICAgICAgIG15ICVDdXN0b21lclVzZXJMb2dpbnNTZWxlY3RlZDsKICAgICAgICBmb3IgbXkgJEN1c3RvbWVyVXNlckxvZ2luIChAQ3VzdG9tZXJVc2VyTG9naW5zU2VsZWN0ZWQpIHsKICAgICAgICAgICAgJEN1c3RvbWVyVXNlckxvZ2luc1NlbGVjdGVkeyRDdXN0b21lclVzZXJMb2dpbn0gPSAxOwogICAgICAgIH0KCiAgICAgICAgIyBjaGVjayBhbGwgdXNlZCBjdXN0b21lciB1c2VycwogICAgICAgIGZvciBteSAkQ3VzdG9tZXJVc2VyTG9naW4gKEBDdXN0b21lclVzZXJMb2dpbnNBbGwpIHsKICAgICAgICAgICAgbXkgJEFjdGl2ZSA9ICRDdXN0b21lclVzZXJMb2dpbnNTZWxlY3RlZHskQ3VzdG9tZXJVc2VyTG9naW59ID8gMSA6IDA7CgogICAgICAgICAgICAjIHNldCBjdXN0b21lciB1c2VyIHNlcnZpY2UgbWVtYmVyCiAgICAgICAgICAgICRTZXJ2aWNlT2JqZWN0LT5DdXN0b21lclVzZXJTZXJ2aWNlTWVtYmVyQWRkKAogICAgICAgICAgICAgICAgQ3VzdG9tZXJVc2VyTG9naW4gPT4gJEN1c3RvbWVyVXNlckxvZ2luLAogICAgICAgICAgICAgICAgU2VydmljZUlEICAgICAgICAgPT4gJFBhcmFte1NlcnZpY2VJRH0sCiAgICAgICAgICAgICAgICBBY3RpdmUgICAgICAgICAgICA9PiAkQWN0aXZlLAogICAgICAgICAgICAgICAgVXNlcklEICAgICAgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBpZiB0aGUgdXNlciB3b3VsZCBsaWtlIHRvIGNvbnRpbnVlIGVkaXRpbmcgdGhlIGN1c3RvbWVyIHVzZXIgYWxsb2NhdGluZyBqdXN0IHJlZGlyZWN0IHRvIHRoZSBlZGl0IHNjcmVlbgogICAgICAgIGlmICgKICAgICAgICAgICAgZGVmaW5lZCAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQ29udGludWVBZnRlclNhdmUnICkKICAgICAgICAgICAgJiYgKCAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQ29udGludWVBZnRlclNhdmUnICkgZXEgJzEnICkKICAgICAgICAgICAgKQogICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPlJlZGlyZWN0KAogICAgICAgICAgICAgICAgT1AgPT4KICAgICAgICAgICAgICAgICAgICAiQWN0aW9uPSRTZWxmLT57QWN0aW9ufTtTdWJhY3Rpb249QWxsb2NhdGVTZXJ2aWNlO1NlcnZpY2VJRD0kUGFyYW17U2VydmljZUlEfTtDdXN0b21lclVzZXJTZWFyY2g9JFBhcmFte0N1c3RvbWVyVXNlclNlYXJjaH0iCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewoKICAgICAgICAgICAgIyBvdGhlcndpc2UgcmV0dXJuIHRvIHJlbGF0aW9ucyBvdmVydmlldwogICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+UmVkaXJlY3QoCiAgICAgICAgICAgICAgICBPUCA9PgogICAgICAgICAgICAgICAgICAgICJBY3Rpb249JFNlbGYtPntBY3Rpb259O0N1c3RvbWVyVXNlclNlYXJjaD0kUGFyYW17Q3VzdG9tZXJVc2VyU2VhcmNofSIKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CgogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gIwogICAgIyBvdmVydmlldwogICAgIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gIwogICAgZWxzZSB7CgogICAgICAgICMgZ2V0IHBhcmFtcwogICAgICAgICRQYXJhbXtDdXN0b21lclVzZXJTZWFyY2h9ID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0N1c3RvbWVyVXNlclNlYXJjaCcgKQogICAgICAgICAgICB8fCAnKic7CgogICAgICAgICMgb3V0cHV0IGhlYWRlcgogICAgICAgIG15ICRPdXRwdXQgPSAkTGF5b3V0T2JqZWN0LT5IZWFkZXIoKTsKICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk5hdmlnYXRpb25CYXIoKTsKCiAgICAgICAgIyBzZWFyY2ggY3VzdG9tZXIgdXNlcgogICAgICAgIG15ICVDdXN0b21lclVzZXJMaXN0ID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJTZWFyY2goCiAgICAgICAgICAgIFNlYXJjaCA9PiAkUGFyYW17Q3VzdG9tZXJVc2VyU2VhcmNofSwKICAgICAgICAgICAgVXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICApOwogICAgICAgIG15IEBDdXN0b21lclVzZXJLZXlMaXN0ID0gc29ydCB7ICRDdXN0b21lclVzZXJMaXN0eyRhfSBjbXAgJEN1c3RvbWVyVXNlckxpc3R7JGJ9IH0ga2V5cyAlQ3VzdG9tZXJVc2VyTGlzdDsKCiAgICAgICAgIyBjb3VudCByZXN1bHRzCiAgICAgICAgbXkgJEN1c3RvbWVyVXNlckNvdW50ID0gQEN1c3RvbWVyVXNlcktleUxpc3Q7CgogICAgICAgICMgc2V0IG1heCBjb3VudAogICAgICAgIG15ICRNYXhDdXN0b21lckNvdW50ID0gJEN1c3RvbWVyVXNlckNvdW50OwoKICAgICAgICBpZiAoICRNYXhDdXN0b21lckNvdW50ID4gJFNlYXJjaExpbWl0ICkgewogICAgICAgICAgICAkTWF4Q3VzdG9tZXJDb3VudCA9ICRTZWFyY2hMaW1pdDsKICAgICAgICB9CgogICAgICAgICMgb3V0cHV0IHJvd3MKICAgICAgICBteSAlVXNlclJvd1BhcmFtOwogICAgICAgIGZvciBteSAkQ291bnRlciAoIDEgLi4gJE1heEN1c3RvbWVyQ291bnQgKSB7CgogICAgICAgICAgICAjIHNldCBjdXN0b21lciB1c2VyIHJvdyBwYXJhbXMKICAgICAgICAgICAgaWYgKCBkZWZpbmVkKCAkQ3VzdG9tZXJVc2VyS2V5TGlzdFsgJENvdW50ZXIgLSAxIF0gKSApIHsKCiAgICAgICAgICAgICAgICAjIEdldCB1c2VyIGRldGFpbHMKICAgICAgICAgICAgICAgIG15ICVVc2VyID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJVc2VyRGF0YUdldCgKICAgICAgICAgICAgICAgICAgICBVc2VyID0+ICRDdXN0b21lclVzZXJLZXlMaXN0WyAkQ291bnRlciAtIDEgXQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIG15ICRVc2VyTmFtZSA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyTmFtZSgKICAgICAgICAgICAgICAgICAgICBVc2VyTG9naW4gPT4gJEN1c3RvbWVyVXNlcktleUxpc3RbICRDb3VudGVyIC0gMSBdCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgJFVzZXJSb3dQYXJhbXsgJFVzZXJ7VXNlcklEfSB9ID0gIiRVc2VyTmFtZSA8JFVzZXJ7VXNlckVtYWlsfT4gKCRVc2Vye1VzZXJDdXN0b21lcklEfSkiOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBteSAlU2VydmljZURhdGEgPSAkU2VydmljZU9iamVjdC0+U2VydmljZUxpc3QoCiAgICAgICAgICAgIEtlZXBDaGlsZHJlbiA9PiAxLAogICAgICAgICAgICBVc2VySUQgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICk7CgogICAgICAgICRPdXRwdXQgLj0gJFNlbGYtPl9PdmVydmlldygKICAgICAgICAgICAgQ3VzdG9tZXJVc2VyQ291bnQgICA9PiAkQ3VzdG9tZXJVc2VyQ291bnQsCiAgICAgICAgICAgIEN1c3RvbWVyVXNlcktleUxpc3QgPT4gXEBDdXN0b21lclVzZXJLZXlMaXN0LAogICAgICAgICAgICBDdXN0b21lclVzZXJEYXRhICAgID0+IFwlVXNlclJvd1BhcmFtLAogICAgICAgICAgICBTZXJ2aWNlRGF0YSAgICAgICAgID0+IFwlU2VydmljZURhdGEsCiAgICAgICAgICAgIFNlYXJjaExpbWl0ICAgICAgICAgPT4gJFNlYXJjaExpbWl0LAogICAgICAgICAgICBDdXN0b21lclVzZXJTZWFyY2ggID0+ICRQYXJhbXtDdXN0b21lclVzZXJTZWFyY2h9LAogICAgICAgICk7CgogICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Rm9vdGVyKCk7CgogICAgICAgIHJldHVybiAkT3V0cHV0OwogICAgfQp9CgpzdWIgX0NoYW5nZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRTZWFyY2hMaW1pdCA9ICRQYXJhbXtTZWFyY2hMaW1pdH07CiAgICBteSAlRGF0YSAgICAgICAgPSAleyAkUGFyYW17RGF0YX0gfTsKICAgIG15ICRUeXBlICAgICAgICA9ICRQYXJhbXtUeXBlfSB8fCAnQ3VzdG9tZXJVc2VyJzsKICAgIG15ICROZVR5cGUgICAgICA9ICRUeXBlIGVxICdTZXJ2aWNlJyA/ICdDdXN0b21lclVzZXInIDogJ1NlcnZpY2UnOwogICAgbXkgJVZpc2libGVUeXBlID0gKAogICAgICAgIEN1c3RvbWVyVXNlciA9PiAnQ3VzdG9tZXInLAogICAgICAgIFNlcnZpY2UgICAgICA9PiAnU2VydmljZScsCiAgICApOwogICAgbXkgJVN1YmFjdGlvbiA9ICgKICAgICAgICBDdXN0b21lclVzZXIgPT4gJ0NoYW5nZScsCiAgICAgICAgU2VydmljZSAgICAgID0+ICdTZXJ2aWNlRWRpdCcsCiAgICApOwogICAgbXkgJUlEU3RyZyA9ICgKICAgICAgICBDdXN0b21lclVzZXIgPT4gJ0lEJywKICAgICAgICBTZXJ2aWNlICAgICAgPT4gJ1NlcnZpY2VJRCcsCiAgICApOwoKICAgIG15IEBJdGVtTGlzdCA9ICgpOwoKICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgaWYgKCAkVmlzaWJsZVR5cGV7JE5lVHlwZX0gZXEgJ0N1c3RvbWVyJyApIHsKICAgICAgICAkUGFyYW17QnJlYWRjcnVtYlRpdGxlfSA9IFRyYW5zbGF0YWJsZSgnQWxsb2NhdGUgQ3VzdG9tZXIgVXNlcnMgdG8gU2VydmljZScpOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgJFBhcmFte0JyZWFkY3J1bWJUaXRsZX0gPSBUcmFuc2xhdGFibGUoJ0FsbG9jYXRlIFNlcnZpY2VzIHRvIEN1c3RvbWVyIFVzZXInKTsKICAgIH0KCiAgICAjIG92ZXJ2aWV3CiAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICBOYW1lID0+ICdPdmVydmlldycsCiAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgT3ZlcnZpZXdMaW5rID0+ICRTZWxmLT57QWN0aW9ufSAuICc7Q3VzdG9tZXJVc2VyU2VhcmNoPScgLiAkUGFyYW17Q3VzdG9tZXJVc2VyU2VhcmNofSwKICAgICAgICB9LAogICAgKTsKICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKCBOYW1lID0+ICdBY3Rpb25MaXN0JyApOwogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnQWN0aW9uT3ZlcnZpZXcnLAogICAgICAgIERhdGEgPT4gewogICAgICAgICAgICBDdXN0b21lclVzZXJTZWFyY2ggPT4gJFBhcmFte0N1c3RvbWVyVXNlclNlYXJjaH0sCiAgICAgICAgfSwKICAgICk7CgogICAgaWYgKCAkTmVUeXBlIGVxICdDdXN0b21lclVzZXInICkgewogICAgICAgIEBJdGVtTGlzdCA9IEB7ICRQYXJhbXtJdGVtTGlzdH0gfTsKCiAgICAgICAgIyBvdXRwdXQgc2VhcmNoIGJsb2NrCiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ1NlYXJjaCcsCiAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgQ3VzdG9tZXJVc2VyU2VhcmNoID0+ICRQYXJhbXtDdXN0b21lclVzZXJTZWFyY2h9LAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ1NlYXJjaEFsbG9jYXRlU2VydmljZScsCiAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgU3ViYWN0aW9uID0+ICRQYXJhbXtTdWJhY3Rpb259LAogICAgICAgICAgICAgICAgU2VydmljZUlEID0+ICRQYXJhbXtTZXJ2aWNlSUR9LAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jayggTmFtZSA9PiAnRmlsdGVyJyApOwogICAgfQoKICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgIE5hbWUgPT4gJ0FsbG9jYXRlSXRlbScsCiAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgIElEICAgICAgICAgICAgICA9PiAkUGFyYW17SUR9LAogICAgICAgICAgICBBY3Rpb25Ib21lICAgICAgPT4gJ0FkbWluJyAuICRUeXBlLAogICAgICAgICAgICBUeXBlICAgICAgICAgICAgPT4gJFR5cGUsCiAgICAgICAgICAgIE5lVHlwZSAgICAgICAgICA9PiAkTmVUeXBlLAogICAgICAgICAgICBWaXNpYmxlVHlwZSAgICAgPT4gJFZpc2libGVUeXBleyRUeXBlfSwKICAgICAgICAgICAgVmlzaWJsZU5lVHlwZSAgID0+ICRWaXNpYmxlVHlwZXskTmVUeXBlfSwKICAgICAgICAgICAgU3ViYWN0aW9uSGVhZGVyID0+ICRTdWJhY3Rpb257JFR5cGV9LAogICAgICAgICAgICBJREhlYWRlclN0cmcgICAgPT4gJElEU3RyZ3skVHlwZX0sCiAgICAgICAgICAgIFN1YmFjdGlvbiAgICAgICA9PiAkU2VsZi0+e1N1YmFjdGlvbn0sCiAgICAgICAgICAgICVQYXJhbSwKICAgICAgICB9LAogICAgKTsKCiAgICBteSAkQ29sU3BhbiA9IDI7CgogICAgaWYgKCAkTmVUeXBlIGVxICdDdXN0b21lclVzZXInICkgewoKICAgICAgICAjIG91dHB1dCBjb3VudCBibG9jawogICAgICAgIGlmICggIUBJdGVtTGlzdCApIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdBbGxvY2F0ZUl0ZW1Db3VudExpbWl0JywKICAgICAgICAgICAgICAgIERhdGEgPT4geyBJdGVtQ291bnQgPT4gMCB9LAogICAgICAgICAgICApOwoKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdOb0RhdGFGb3VuZE1zZ0xpc3QnLAogICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgQ29sU3BhbiA9PiAkQ29sU3BhbiwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGVsc2lmICggQEl0ZW1MaXN0ID4gJFNlYXJjaExpbWl0ICkgewogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ0FsbG9jYXRlSXRlbUNvdW50TGltaXQnLAogICAgICAgICAgICAgICAgRGF0YSA9PiB7IEl0ZW1Db3VudCA9PiAiPiIgLiAkU2VhcmNoTGltaXQgfSwKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgTmFtZSA9PiAnQWxsb2NhdGVJdGVtQ291bnQnLAogICAgICAgICAgICAgICAgRGF0YSA9PiB7IEl0ZW1Db3VudCA9PiBzY2FsYXIgQEl0ZW1MaXN0IH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgICMgU2VydmljZSBzb3J0aW5nLgogICAgbXkgJVNlcnZpY2VEYXRhOwogICAgaWYgKCAkTmVUeXBlIGVxICdTZXJ2aWNlJyApIHsKICAgICAgICAlU2VydmljZURhdGEgPSAlRGF0YTsKCiAgICAgICAgIyBhZGQgc3VmZml4IGZvciBjb3JyZWN0IHNvcnRpbmcKICAgICAgICBmb3IgbXkgJERhdGFLZXkgKCBzb3J0IGtleXMgJURhdGEgKSB7CiAgICAgICAgICAgICREYXRheyREYXRhS2V5fSAuPSAnOjonOwogICAgICAgIH0KCiAgICAgICAgaWYgKCAhJVNlcnZpY2VEYXRhICkgewogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ05vRGF0YUZvdW5kTXNnTGlzdCcsCiAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICBDb2xTcGFuID0+ICRDb2xTcGFuLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgfQoKICAgICMgb3V0cHV0IHJvd3MKICAgIGZvciBteSAkSUQgKCBzb3J0IHsgdWMoICREYXRheyRhfSApIGNtcCB1YyggJERhdGF7JGJ9ICkgfSBrZXlzICVEYXRhICkgewoKICAgICAgICAjIHNldCBjaGVja2VkCiAgICAgICAgbXkgJENoZWNrZWQgPSAkUGFyYW17U2VsZWN0ZWR9LT57JElEfSA/ICJjaGVja2VkPSdjaGVja2VkJyIgOiAnJzsKCiAgICAgICAgIyBSZWNvdmVyIG9yaWdpbmFsIFNlcnZpY2UgTmFtZQogICAgICAgIGlmICggJE5lVHlwZSBlcSAnU2VydmljZScgKSB7CiAgICAgICAgICAgICREYXRheyRJRH0gPSAkU2VydmljZURhdGF7JElEfTsKICAgICAgICB9CgogICAgICAgICMgb3V0cHV0IHJvdyBibG9jawogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdBbGxvY2F0ZUl0ZW1Sb3cnLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgIEFjdGlvbk5lSG9tZSA9PiAnQWRtaW4nIC4gJE5lVHlwZSwKICAgICAgICAgICAgICAgIE5hbWUgICAgICAgICA9PiAkRGF0YXskSUR9LAogICAgICAgICAgICAgICAgSUQgICAgICAgICAgID0+ICRJRCwKICAgICAgICAgICAgICAgIENoZWNrZWQgICAgICA9PiAkQ2hlY2tlZCwKICAgICAgICAgICAgICAgIFN1YmFjdGlvblJvdyA9PiAkU3ViYWN0aW9ueyROZVR5cGV9LAogICAgICAgICAgICAgICAgSURSb3dTdHJnICAgID0+ICRJRFN0cmd7JE5lVHlwZX0sCgogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICB9CgogICAgIyBnZW5lcmF0ZSBvdXRwdXQKICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5PdXRwdXQoCiAgICAgICAgVGVtcGxhdGVGaWxlID0+ICdBZG1pbkN1c3RvbWVyVXNlclNlcnZpY2UnLAogICAgICAgIERhdGEgICAgICAgICA9PiBcJVBhcmFtLAogICAgKTsKfQoKc3ViIF9PdmVydmlldyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRDdXN0b21lclVzZXJDb3VudCAgID0gJFBhcmFte0N1c3RvbWVyVXNlckNvdW50fTsKICAgIG15IEBDdXN0b21lclVzZXJLZXlMaXN0ID0gQHsgJFBhcmFte0N1c3RvbWVyVXNlcktleUxpc3R9IH07CiAgICBteSAkU2VhcmNoTGltaXQgICAgICAgICA9ICRQYXJhbXtTZWFyY2hMaW1pdH07CiAgICBteSAlQ3VzdG9tZXJVc2VyRGF0YSAgICA9ICV7ICRQYXJhbXtDdXN0b21lclVzZXJEYXRhfSB9OwogICAgbXkgJVNlcnZpY2VEYXRhICAgICAgICAgPSAleyAkUGFyYW17U2VydmljZURhdGF9IH07CgogICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKCiAgICAjIG92ZXJ2aWV3CiAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICBOYW1lID0+ICdPdmVydmlldycsCiAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgT3ZlcnZpZXdMaW5rID0+ICRTZWxmLT57QWN0aW9ufSwKICAgICAgICB9LAogICAgKTsKICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKCBOYW1lID0+ICdBY3Rpb25MaXN0JyApOwoKICAgICMgb3V0cHV0IHNlYXJjaCBibG9jawogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnU2VhcmNoJywKICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICBDdXN0b21lclVzZXJTZWFyY2ggPT4gJFBhcmFte0N1c3RvbWVyVXNlclNlYXJjaH0sCiAgICAgICAgfSwKICAgICk7CiAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICBOYW1lID0+ICdEZWZhdWx0JywKICAgICk7CgogICAgIyBvdXRwdXQgZmlsdGVyIGFuZCBkZWZhdWx0IGJsb2NrCiAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICBOYW1lID0+ICdGaWx0ZXInLAogICAgKTsKCiAgICAjIG91dHB1dCByZXN1bHQgYmxvY2sKICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgIE5hbWUgPT4gJ1Jlc3VsdCcsCiAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgQ3VzdG9tZXJVc2VyQ291bnQgPT4gJEN1c3RvbWVyVXNlckNvdW50LAogICAgICAgIH0sCiAgICApOwoKICAgICMgb3V0cHV0IGN1c3RvbWVyIHVzZXIgY291bnQgYmxvY2sKICAgIGlmICggIUBDdXN0b21lclVzZXJLZXlMaXN0ICkgewogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdSZXN1bHRDdXN0b21lclVzZXJDb3VudExpbWl0JywKICAgICAgICAgICAgRGF0YSA9PiB7IEN1c3RvbWVyVXNlckNvdW50ID0+IDAgfSwKICAgICAgICApOwoKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnTm9EYXRhRm91bmRNc2cnLAogICAgICAgICk7CiAgICB9CiAgICBlbHNpZiAoIEBDdXN0b21lclVzZXJLZXlMaXN0ID4gJFNlYXJjaExpbWl0ICkgewogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdSZXN1bHRDdXN0b21lclVzZXJDb3VudExpbWl0JywKICAgICAgICAgICAgRGF0YSA9PiB7IEN1c3RvbWVyVXNlckNvdW50ID0+ICI+IiAuICRTZWFyY2hMaW1pdCB9LAogICAgICAgICk7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnUmVzdWx0Q3VzdG9tZXJVc2VyQ291bnQnLAogICAgICAgICAgICBEYXRhID0+IHsgQ3VzdG9tZXJVc2VyQ291bnQgPT4gc2NhbGFyIEBDdXN0b21lclVzZXJLZXlMaXN0IH0sCiAgICAgICAgKTsKICAgIH0KCiAgICBmb3IgbXkgJElEICgKICAgICAgICBzb3J0IHsgdWMoICRDdXN0b21lclVzZXJEYXRheyRhfSApIGNtcCB1YyggJEN1c3RvbWVyVXNlckRhdGF7JGJ9ICkgfQogICAgICAgIGtleXMgJUN1c3RvbWVyVXNlckRhdGEKICAgICAgICApCiAgICB7CgogICAgICAgICMgb3V0cHV0IHVzZXIgcm93IGJsb2NrCiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ1Jlc3VsdFVzZXJSb3cnLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgIElEICAgPT4gJElELAogICAgICAgICAgICAgICAgTmFtZSA9PiAkQ3VzdG9tZXJVc2VyRGF0YXskSUR9LAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICB9CgogICAgbXkgJVNlcnZpY2VEYXRhU29ydCA9ICVTZXJ2aWNlRGF0YTsKCiAgICAjIGFkZCBzdWZmaXggZm9yIGNvcnJlY3Qgc29ydGluZwogICAgZm9yIG15ICRTZXJ2aWNlRGF0YUtleSAoIHNvcnQga2V5cyAlU2VydmljZURhdGFTb3J0ICkgewogICAgICAgICRTZXJ2aWNlRGF0YVNvcnR7JFNlcnZpY2VEYXRhS2V5fSAuPSAnOjonOwogICAgfQoKICAgICMgZ2V0IHNlcnZpY2UgZGF0YQogICAgaWYgKCVTZXJ2aWNlRGF0YVNvcnQpIHsKICAgICAgICBmb3IgbXkgJElEICgKICAgICAgICAgICAgc29ydCB7IHVjKCAkU2VydmljZURhdGFTb3J0eyRhfSApIGNtcCB1YyggJFNlcnZpY2VEYXRhU29ydHskYn0gKSB9CiAgICAgICAgICAgIGtleXMgJVNlcnZpY2VEYXRhU29ydAogICAgICAgICAgICApCiAgICAgICAgewoKICAgICAgICAgICAgIyBvdXRwdXQgc2VydmljZSByb3cgYmxvY2sKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdSZXN1bHRTZXJ2aWNlUm93JywKICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgICAgICBJRCAgID0+ICRJRCwKICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICRTZXJ2aWNlRGF0YXskSUR9LAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CgogICAgIyBvdGhlcndpc2UgYSBubyBkYXRhIG1lc3NhZ2UgaXMgZGlzcGxheWVkCiAgICBlbHNlIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnTm9TZXJ2aWNlRm91bmRNc2cnLAogICAgICAgICAgICBEYXRhID0+IHt9LAogICAgICAgICk7CiAgICB9CgogICAgIyBnZW5lcmF0ZSBvdXRwdXQKICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5PdXRwdXQoCiAgICAgICAgVGVtcGxhdGVGaWxlID0+ICdBZG1pbkN1c3RvbWVyVXNlclNlcnZpY2UnLAogICAgICAgIERhdGEgICAgICAgICA9PiBcJVBhcmFtLAogICAgKTsKfQoKMTsK</File>
        <File Location="Custom/Kernel/Modules/AgentCustomerInformationCenterSearch.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxLTIwMjIgWm51bnkgR21iSCwgaHR0cHM6Ly96bnVueS5vcmcvCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6TW9kdWxlczo6QWdlbnRDdXN0b21lckluZm9ybWF0aW9uQ2VudGVyU2VhcmNoOwojIyBub2ZpbHRlcihUaWR5QWxsOjpQbHVnaW46Ok9UUlM6OlBlcmw6OkRCT2JqZWN0KQoKdXNlIHN0cmljdDsKdXNlIHdhcm5pbmdzOwoKdXNlIEtlcm5lbDo6U3lzdGVtOjpWYXJpYWJsZUNoZWNrIHF3KDphbGwpOwoKb3VyICRPYmplY3RNYW5hZ2VyRGlzYWJsZWQgPSAxOwoKc3ViIG5ldyB7CiAgICBteSAoICRUeXBlLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgYWxsb2NhdGUgbmV3IGhhc2ggZm9yIG9iamVjdAogICAgbXkgJFNlbGYgPSB7JVBhcmFtfTsKICAgIGJsZXNzKCAkU2VsZiwgJFR5cGUgKTsKCiAgICByZXR1cm4gJFNlbGY7Cn0KCnN1YiBSdW4gewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGdldCBuZWVkZWQgb2JqZWN0cwogICAgbXkgJFBhcmFtT2JqZWN0ICAgICAgICAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpXZWI6OlJlcXVlc3QnKTsKICAgIG15ICRMYXlvdXRPYmplY3QgICAgICAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CiAgICBteSAkQ3VzdG9tZXJVc2VyT2JqZWN0ICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyVXNlcicpOwogICAgbXkgJENvbmZpZ09iamVjdCAgICAgICAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CiAgICBteSAkVGlja2V0T2JqZWN0ICAgICAgICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpY2tldCcpOwogICAgbXkgJEN1c3RvbWVyQ29tcGFueU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDdXN0b21lckNvbXBhbnknKTsKCiAgICBteSAkQXV0b0NvbXBsZXRlQ29uZmlnICAgICAgICAgICAgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0F1dG9Db21wbGV0ZTo6QWdlbnQnKS0+e0N1c3RvbWVyU2VhcmNofTsKICAgIG15ICRNYXhSZXN1bHRzICAgICAgICAgICAgICAgICAgICA9ICRBdXRvQ29tcGxldGVDb25maWctPntNYXhSZXN1bHRzRGlzcGxheWVkfSB8fCAyMDsKICAgIG15ICRJbmNsdWRlVW5rbm93blRpY2tldEN1c3RvbWVycyA9IGludCggJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0luY2x1ZGVVbmtub3duVGlja2V0Q3VzdG9tZXJzJyApIHx8IDAgKTsKICAgIG15ICRTZWFyY2hUZXJtICAgICAgICAgICAgICAgICAgICA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdUZXJtJyApIHx8ICcnOwoKICAgIGlmICggJFNlbGYtPntTdWJhY3Rpb259IGVxICdTZWFyY2hDdXN0b21lcklEJyApIHsKCiAgICAgICAgIyBidWlsZCByZXN1bHQgbGlzdAogICAgICAgIG15ICRVbmtub3duVGlja2V0Q3VzdG9tZXJMaXN0OwoKICAgICAgICBpZiAoJEluY2x1ZGVVbmtub3duVGlja2V0Q3VzdG9tZXJzKSB7CgogICAgICAgICAgICAjIGFkZCBjdXN0b21lcnMgdGhhdCBhcmUgbm90IHNhdmVkIGluIGFueSBiYWNrZW5kCiAgICAgICAgICAgICRVbmtub3duVGlja2V0Q3VzdG9tZXJMaXN0ID0gJFRpY2tldE9iamVjdC0+U2VhcmNoVW5rbm93blRpY2tldEN1c3RvbWVycygKICAgICAgICAgICAgICAgIFNlYXJjaFRlcm0gPT4gJFNlYXJjaFRlcm0sCiAgICAgICAgICAgICAgICBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBTZWFyY2ggZm9yIFZhbGlkIGN1c3RvbWVyIGNvbXBhbmllcy4KICAgICAgICBteSAlQ3VzdG9tZXJDb21wYW55TGlzdCA9ICRDdXN0b21lckNvbXBhbnlPYmplY3QtPkN1c3RvbWVyQ29tcGFueUxpc3QoCiAgICAgICAgICAgIFNlYXJjaCA9PiAkU2VhcmNoVGVybSwKICAgICAgICAgICAgVXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICApOwogICAgICAgIG1hcCB7ICRDdXN0b21lckNvbXBhbnlMaXN0eyRffSA9ICRVbmtub3duVGlja2V0Q3VzdG9tZXJMaXN0LT57JF99IH0ga2V5cyAleyRVbmtub3duVGlja2V0Q3VzdG9tZXJMaXN0fTsKCiAgICAgICAgIyBTZWFyY2ggZm9yIGFsbCBjdXN0b21lciBjb21wYW5pZXMsIHZhbGlkIGFuZCBpbnZhbGlkLgogICAgICAgIG15ICVDdXN0b21lckNvbXBhbnlMaXN0QWxsID0gJEN1c3RvbWVyQ29tcGFueU9iamVjdC0+Q3VzdG9tZXJDb21wYW55TGlzdCgKICAgICAgICAgICAgU2VhcmNoID0+ICRTZWFyY2hUZXJtLAogICAgICAgICAgICBWYWxpZCAgPT4gMCwKICAgICAgICAgICAgVXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICApOwoKICAgICAgICBteSBAQ3VzdG9tZXJJRHMgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lcklETGlzdCgKICAgICAgICAgICAgU2VhcmNoVGVybSA9PiAkU2VhcmNoVGVybSwKICAgICAgICAgICAgVXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICApOwoKICAgICAgICAjIGFkZCBDdXN0b21lcklEcyBmb3Igd2hpY2ggbm8gQ3VzdG9tZXJDb21wYW55IGFyZSByZWdpc3RlcmVkCiAgICAgICAgbXkgJVNlZW47CiAgICAgICAgQ1VTVE9NRVJJRDoKICAgICAgICBmb3IgbXkgJEN1c3RvbWVySUQgKEBDdXN0b21lcklEcykgewoKICAgICAgICAgICAgIyBza2lwIGR1cGxpY2F0ZXMKICAgICAgICAgICAgbmV4dCBDVVNUT01FUklEIGlmICRTZWVueyRDdXN0b21lcklEfTsKICAgICAgICAgICAgJFNlZW57JEN1c3RvbWVySUR9ID0gMTsKCiAgICAgICAgICAgICMgaWRlbnRpZmllcyB1bmtub3duIGNvbXBhbmllcwogICAgICAgICAgICBpZiAoICFleGlzdHMgJEN1c3RvbWVyQ29tcGFueUxpc3RBbGx7JEN1c3RvbWVySUR9ICkgewogICAgICAgICAgICAgICAgJEN1c3RvbWVyQ29tcGFueUxpc3R7JEN1c3RvbWVySUR9ID0gJEN1c3RvbWVySUQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgfQoKICAgICAgICBteSBAUmVzdWx0OwoKICAgICAgICBDVVNUT01FUklEOgogICAgICAgIGZvciBteSAkQ3VzdG9tZXJJRCAoIHNvcnQga2V5cyAlQ3VzdG9tZXJDb21wYW55TGlzdCApIHsKICAgICAgICAgICAgaWYgKCAhKCBncmVwIHsgJF8tPntWYWx1ZX0gZXEgJEN1c3RvbWVySUQgfSBAUmVzdWx0ICkgKSB7CiAgICAgICAgICAgICAgICBwdXNoIEBSZXN1bHQsCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIExhYmVsID0+ICRDdXN0b21lckNvbXBhbnlMaXN0eyRDdXN0b21lcklEfSwKICAgICAgICAgICAgICAgICAgICBWYWx1ZSA9PiAkQ3VzdG9tZXJJRAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGFzdCBDVVNUT01FUklEIGlmIHNjYWxhciBAUmVzdWx0ID49ICRNYXhSZXN1bHRzOwoKICAgICAgICB9CgogICAgICAgIG15ICRKU09OID0gJExheW91dE9iamVjdC0+SlNPTkVuY29kZSgKICAgICAgICAgICAgRGF0YSA9PiBcQFJlc3VsdCwKICAgICAgICApOwoKICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+QXR0YWNobWVudCgKICAgICAgICAgICAgQ29udGVudFR5cGUgPT4gJ2FwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9JyAuICRMYXlvdXRPYmplY3QtPntDaGFyc2V0fSwKICAgICAgICAgICAgQ29udGVudCAgICAgPT4gJEpTT04gfHwgJycsCiAgICAgICAgICAgIFR5cGUgICAgICAgID0+ICdpbmxpbmUnLAogICAgICAgICAgICBOb0NhY2hlICAgICA9PiAxLAogICAgICAgICk7CiAgICB9CiAgICBlbHNpZiAoICRTZWxmLT57U3ViYWN0aW9ufSBlcSAnU2VhcmNoQ3VzdG9tZXJVc2VyJyApIHsKCiAgICAgICAgbXkgJFVua25vd25UaWNrZXRDdXN0b21lckxpc3Q7CgogICAgICAgIGlmICgkSW5jbHVkZVVua25vd25UaWNrZXRDdXN0b21lcnMpIHsKCiAgICAgICAgICAgICMgYWRkIGN1c3RvbWVycyB0aGF0IGFyZSBub3Qgc2F2ZWQgaW4gYW55IGJhY2tlbmQKICAgICAgICAgICAgJFVua25vd25UaWNrZXRDdXN0b21lckxpc3QgPSAkVGlja2V0T2JqZWN0LT5TZWFyY2hVbmtub3duVGlja2V0Q3VzdG9tZXJzKAogICAgICAgICAgICAgICAgU2VhcmNoVGVybSA9PiAkU2VhcmNoVGVybSwKICAgICAgICAgICAgICAgIFVzZXJJRCA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICBteSAlQ3VzdG9tZXJMaXN0ID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJTZWFyY2goCiAgICAgICAgICAgIFNlYXJjaCA9PiAkU2VhcmNoVGVybSwKICAgICAgICAgICAgVXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICApOwogICAgICAgIG1hcCB7ICRDdXN0b21lckxpc3R7JF99ID0gJFVua25vd25UaWNrZXRDdXN0b21lckxpc3QtPnskX30gfSBrZXlzICV7JFVua25vd25UaWNrZXRDdXN0b21lckxpc3R9OwoKICAgICAgICBteSBAUmVzdWx0OwoKICAgICAgICBDVVNUT01FUkxPR0lOOgogICAgICAgIGZvciBteSAkQ3VzdG9tZXJMb2dpbiAoIHNvcnQga2V5cyAlQ3VzdG9tZXJMaXN0ICkgewogICAgICAgICAgICBteSAlQ3VzdG9tZXJEYXRhID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJVc2VyRGF0YUdldCgKICAgICAgICAgICAgICAgIFVzZXIgPT4gJEN1c3RvbWVyTG9naW4sCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBwdXNoIEBSZXN1bHQsCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBMYWJlbCA9PiAkQ3VzdG9tZXJMaXN0eyRDdXN0b21lckxvZ2lufSwKICAgICAgICAgICAgICAgIFZhbHVlID0+ICRDdXN0b21lckRhdGF7VXNlckN1c3RvbWVySUR9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICBsYXN0IENVU1RPTUVSTE9HSU4gaWYgc2NhbGFyIEBSZXN1bHQgPj0gJE1heFJlc3VsdHM7CgogICAgICAgIH0KCiAgICAgICAgbXkgJEpTT04gPSAkTGF5b3V0T2JqZWN0LT5KU09ORW5jb2RlKAogICAgICAgICAgICBEYXRhID0+IFxAUmVzdWx0LAogICAgICAgICk7CgogICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5BdHRhY2htZW50KAogICAgICAgICAgICBDb250ZW50VHlwZSA9PiAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD0nIC4gJExheW91dE9iamVjdC0+e0NoYXJzZXR9LAogICAgICAgICAgICBDb250ZW50ICAgICA9PiAkSlNPTiB8fCAnJywKICAgICAgICAgICAgVHlwZSAgICAgICAgPT4gJ2lubGluZScsCiAgICAgICAgICAgIE5vQ2FjaGUgICAgID0+IDEsCiAgICAgICAgKTsKICAgIH0KCiAgICBteSAkT3V0cHV0ID0gJExheW91dE9iamVjdC0+T3V0cHV0KAogICAgICAgIFRlbXBsYXRlRmlsZSA9PiAnQWdlbnRDdXN0b21lckluZm9ybWF0aW9uQ2VudGVyU2VhcmNoJywKICAgICAgICBEYXRhICAgICAgICAgPT4gXCVQYXJhbSwKICAgICk7CiAgICByZXR1cm4gJExheW91dE9iamVjdC0+QXR0YWNobWVudCgKICAgICAgICBOb0NhY2hlICAgICA9PiAxLAogICAgICAgIENvbnRlbnRUeXBlID0+ICd0ZXh0L2h0bWwnLAogICAgICAgIENoYXJzZXQgICAgID0+ICRMYXlvdXRPYmplY3QtPntVc2VyQ2hhcnNldH0sCiAgICAgICAgQ29udGVudCAgICAgPT4gJE91dHB1dCB8fCAnJywKICAgICAgICBUeXBlICAgICAgICA9PiAnaW5saW5lJywKICAgICk7Cn0KCjE7Cg==</File>
        <File Location="Custom/Kernel/Modules/AgentCustomerSearch.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxLTIwMjIgWm51bnkgR21iSCwgaHR0cHM6Ly96bnVueS5vcmcvCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6TW9kdWxlczo6QWdlbnRDdXN0b21lclNlYXJjaDsKIyMgbm9maWx0ZXIoVGlkeUFsbDo6UGx1Z2luOjpPVFJTOjpQZXJsOjpEQk9iamVjdCkKCnVzZSBzdHJpY3Q7CnVzZSB3YXJuaW5nczsKCnVzZSBLZXJuZWw6Okxhbmd1YWdlIHF3KFRyYW5zbGF0YWJsZSk7CgpvdXIgJE9iamVjdE1hbmFnZXJEaXNhYmxlZCA9IDE7CgpzdWIgbmV3IHsKICAgIG15ICggJFR5cGUsICVQYXJhbSApID0gQF87CgogICAgIyBhbGxvY2F0ZSBuZXcgaGFzaCBmb3Igb2JqZWN0CiAgICBteSAkU2VsZiA9IHslUGFyYW19OwogICAgYmxlc3MoICRTZWxmLCAkVHlwZSApOwoKICAgIHJldHVybiAkU2VsZjsKfQoKc3ViIFJ1biB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRQYXJhbU9iamVjdCAgICAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6V2ViOjpSZXF1ZXN0Jyk7CiAgICBteSAkRW5jb2RlT2JqZWN0ICAgICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkVuY29kZScpOwogICAgbXkgJExheW91dE9iamVjdCAgICAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKICAgIG15ICRDdXN0b21lclVzZXJPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q3VzdG9tZXJVc2VyJyk7CiAgICBteSAkQ29uZmlnT2JqZWN0ICAgICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKTsKICAgIG15ICRUaWNrZXRPYmplY3QgICAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGlja2V0Jyk7CgogICAgIyBnZXQgY29uZmlnIGZvciBmcm9udGVuZAogICAgJFNlbGYtPntDb25maWd9ID0gJENvbmZpZ09iamVjdC0+R2V0KCJUaWNrZXQ6OkZyb250ZW5kOjokU2VsZi0+e0FjdGlvbn0iKTsKCiAgICBteSAkQXV0b0NvbXBsZXRlQ29uZmlnID0gJENvbmZpZ09iamVjdC0+R2V0KCdBdXRvQ29tcGxldGU6OkFnZW50JyktPntDdXN0b21lclNlYXJjaH07CiAgICBteSAkTWF4UmVzdWx0cyAgICAgICAgID0gaW50KCAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnTWF4UmVzdWx0cycgKSB8fCAwICkKICAgICAgICB8fCAkQXV0b0NvbXBsZXRlQ29uZmlnLT57TWF4UmVzdWx0c0Rpc3BsYXllZH0KICAgICAgICB8fCAyMDsKICAgIG15ICRJbmNsdWRlVW5rbm93blRpY2tldEN1c3RvbWVycyA9IGludCggJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0luY2x1ZGVVbmtub3duVGlja2V0Q3VzdG9tZXJzJyApIHx8IDAgKTsKICAgIG15ICRTZWFyY2hUZXJtICAgICAgICAgICAgICAgICAgICA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdUZXJtJyApIHx8ICcnOwoKICAgIG15ICRKU09OID0gJyc7CgogICAgaWYgKCAhJFNlbGYtPntTdWJhY3Rpb259IHx8ICRTZWxmLT57U3ViYWN0aW9ufSBlcSAnU2VhcmNoQ3VzdG9tZXJVc2VyJyApIHsKCiAgICAgICAgbXkgJFVua25vd25UaWNrZXRDdXN0b21lckxpc3Q7CgogICAgICAgIGlmICgkSW5jbHVkZVVua25vd25UaWNrZXRDdXN0b21lcnMpIHsKCiAgICAgICAgICAgICMgYWRkIGN1c3RvbWVycyB0aGF0IGFyZSBub3Qgc2F2ZWQgaW4gYW55IGJhY2tlbmQKICAgICAgICAgICAgJFVua25vd25UaWNrZXRDdXN0b21lckxpc3QgPSAkVGlja2V0T2JqZWN0LT5TZWFyY2hVbmtub3duVGlja2V0Q3VzdG9tZXJzKAogICAgICAgICAgICAgICAgU2VhcmNoVGVybSA9PiAkU2VhcmNoVGVybSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgZ2V0IGN1c3RvbWVyIGxpc3QKICAgICAgICBteSAlQ3VzdG9tZXJVc2VyTGlzdCA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyU2VhcmNoKAogICAgICAgICAgICBTZWFyY2ggPT4gJFNlYXJjaFRlcm0sCiAgICAgICAgICAgIFVzZXJJRCA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgKTsKICAgICAgICBtYXAgeyAkQ3VzdG9tZXJVc2VyTGlzdHskX30gPSAkVW5rbm93blRpY2tldEN1c3RvbWVyTGlzdC0+eyRffSB9IGtleXMgJXskVW5rbm93blRpY2tldEN1c3RvbWVyTGlzdH07CgogICAgICAgICMgYnVpbGQgZGF0YQogICAgICAgIG15IEBEYXRhOwogICAgICAgIENVU1RPTUVSVVNFUklEOgogICAgICAgIGZvciBteSAkQ3VzdG9tZXJVc2VySUQgKCBzb3J0IGtleXMgJUN1c3RvbWVyVXNlckxpc3QgKSB7CgogICAgICAgICAgICBteSAkQ3VzdG9tZXJWYWx1ZSA9ICRDdXN0b21lclVzZXJMaXN0eyRDdXN0b21lclVzZXJJRH07CgogICAgICAgICAgICAjIHJlcGxhY2UgbmV3IGxpbmVzIHdpdGggb25lIHNwYWNlIChzZWUgYnVnIzExMTMzKQogICAgICAgICAgICAkQ3VzdG9tZXJWYWx1ZSA9fiBzL1xuLyAvZ3M7CiAgICAgICAgICAgICRDdXN0b21lclZhbHVlID1+IHMvXHIvIC9nczsKCiAgICAgICAgICAgIGlmICggISggZ3JlcCB7ICRfLT57TGFiZWx9IGVxICRDdXN0b21lclZhbHVlIH0gQERhdGEgKSApIHsKICAgICAgICAgICAgICAgIHB1c2ggQERhdGEsIHsKICAgICAgICAgICAgICAgICAgICBMYWJlbCA9PiAkQ3VzdG9tZXJWYWx1ZSwKICAgICAgICAgICAgICAgICAgICBWYWx1ZSA9PiAkQ3VzdG9tZXJVc2VySUQsCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxhc3QgQ1VTVE9NRVJVU0VSSUQgaWYgc2NhbGFyIEBEYXRhID49ICRNYXhSZXN1bHRzOwogICAgICAgIH0KCiAgICAgICAgIyBidWlsZCBKU09OIG91dHB1dAogICAgICAgICRKU09OID0gJExheW91dE9iamVjdC0+SlNPTkVuY29kZSgKICAgICAgICAgICAgRGF0YSA9PiBcQERhdGEsCiAgICAgICAgKTsKICAgIH0KCiAgICBlbHNpZiAoICRTZWxmLT57U3ViYWN0aW9ufSBlcSAnU2VhcmNoQ3VzdG9tZXJJRCcgKSB7CgogICAgICAgICMgQnVpbGQgdGhlIHJlc3VsdCBsaXN0LgogICAgICAgIG15ICRVbmtub3duVGlja2V0Q3VzdG9tZXJMaXN0OwoKICAgICAgICBpZiAoJEluY2x1ZGVVbmtub3duVGlja2V0Q3VzdG9tZXJzKSB7CgogICAgICAgICAgICAjIEFkZCBjdXN0b21lcnMgdGhhdCBhcmUgbm90IHNhdmVkIGluIGFueSBiYWNrZW5kLgogICAgICAgICAgICAkVW5rbm93blRpY2tldEN1c3RvbWVyTGlzdCA9ICRUaWNrZXRPYmplY3QtPlNlYXJjaFVua25vd25UaWNrZXRDdXN0b21lcnMoCiAgICAgICAgICAgICAgICBTZWFyY2hUZXJtID0+ICRTZWFyY2hUZXJtLAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgbXkgJUN1c3RvbWVyQ29tcGFueUxpc3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q3VzdG9tZXJDb21wYW55JyktPkN1c3RvbWVyQ29tcGFueUxpc3QoCiAgICAgICAgICAgIFNlYXJjaCA9PiAkU2VhcmNoVGVybSwKICAgICAgICAgICAgVXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICApOwogICAgICAgIG1hcCB7ICRDdXN0b21lckNvbXBhbnlMaXN0eyRffSA9ICRVbmtub3duVGlja2V0Q3VzdG9tZXJMaXN0LT57JF99IH0ga2V5cyAleyRVbmtub3duVGlja2V0Q3VzdG9tZXJMaXN0fTsKCiAgICAgICAgbXkgQEN1c3RvbWVySURzID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJJRExpc3QoCiAgICAgICAgICAgIFNlYXJjaFRlcm0gPT4gJFNlYXJjaFRlcm0sCiAgICAgICAgKTsKCiAgICAgICAgIyBBZGQgQ3VzdG9tZXJJRHMgZm9yIHdoaWNoIG5vIEN1c3RvbWVyQ29tcGFueSBhcmUgcmVnaXN0ZXJlZC4KICAgICAgICBteSAlU2VlbjsKICAgICAgICBDVVNUT01FUklEOgogICAgICAgIGZvciBteSAkQ3VzdG9tZXJJRCAoQEN1c3RvbWVySURzKSB7CgogICAgICAgICAgICAjIFNraXAgZHVwbGljYXRlIGVudHJpZXMuCiAgICAgICAgICAgIG5leHQgQ1VTVE9NRVJJRCBpZiAkU2VlbnskQ3VzdG9tZXJJRH07CiAgICAgICAgICAgICRTZWVueyRDdXN0b21lcklEfSA9IDE7CgogICAgICAgICAgICAjIElkZW50aWZpZXMgdW5rbm93biBjb21wYW5pZXMuCiAgICAgICAgICAgIGlmICggIWV4aXN0cyAkQ3VzdG9tZXJDb21wYW55TGlzdHskQ3VzdG9tZXJJRH0gKSB7CiAgICAgICAgICAgICAgICAkQ3VzdG9tZXJDb21wYW55TGlzdHskQ3VzdG9tZXJJRH0gPSAkQ3VzdG9tZXJJRDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgbXkgQERhdGE7CgogICAgICAgIENVU1RPTUVSSUQ6CiAgICAgICAgZm9yIG15ICRDdXN0b21lcklEICggc29ydCBrZXlzICVDdXN0b21lckNvbXBhbnlMaXN0ICkgewogICAgICAgICAgICBpZiAoICEoIGdyZXAgeyAkXy0+e1ZhbHVlfSBlcSAkQ3VzdG9tZXJJRCB9IEBEYXRhICkgKSB7CiAgICAgICAgICAgICAgICBwdXNoIEBEYXRhLCB7CiAgICAgICAgICAgICAgICAgICAgTGFiZWwgPT4gJEN1c3RvbWVyQ29tcGFueUxpc3R7JEN1c3RvbWVySUR9LAogICAgICAgICAgICAgICAgICAgIFZhbHVlID0+ICRDdXN0b21lcklELAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBsYXN0IENVU1RPTUVSSUQgaWYgc2NhbGFyIEBEYXRhID49ICRNYXhSZXN1bHRzOwogICAgICAgIH0KCiAgICAgICAgIyBidWlsZCBKU09OIG91dHB1dAogICAgICAgICRKU09OID0gJExheW91dE9iamVjdC0+SlNPTkVuY29kZSgKICAgICAgICAgICAgRGF0YSA9PiBcQERhdGEsCiAgICAgICAgKTsKICAgIH0KCiAgICAjIEdldCBhbGwgYXNzaWduZWQgY3VzdG9tZXIgaWRzIGZyb20gdGhlIGdpdmVuIGN1c3RvbWVyIHVzZXIgaWQuCiAgICBlbHNpZiAoICRTZWxmLT57U3ViYWN0aW9ufSBlcSAnQXNzaWduZWRDdXN0b21lcklEcycgKSB7CgogICAgICAgIG15ICRDdXN0b21lclVzZXJJRCA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdDdXN0b21lclVzZXJJRCcgKSB8fCAnJzsKCiAgICAgICAgbXkgQEN1c3RvbWVySURzOwogICAgICAgIGlmICgkQ3VzdG9tZXJVc2VySUQpIHsKICAgICAgICAgICAgQEN1c3RvbWVySURzID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJJRHMoCiAgICAgICAgICAgICAgICBVc2VyID0+ICRDdXN0b21lclVzZXJJRCwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgYnVpbGQgSlNPTiBvdXRwdXQKICAgICAgICAkSlNPTiA9ICRMYXlvdXRPYmplY3QtPkpTT05FbmNvZGUoCiAgICAgICAgICAgIERhdGEgPT4gXEBDdXN0b21lcklEcywKICAgICAgICApOwogICAgfQoKICAgICMgZ2V0IGN1c3RvbWVyIGluZm8KICAgIGVsc2lmICggJFNlbGYtPntTdWJhY3Rpb259IGVxICdDdXN0b21lckluZm8nICkgewoKICAgICAgICAjIGdldCBwYXJhbXMKICAgICAgICBteSAkQ3VzdG9tZXJVc2VySUQgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQ3VzdG9tZXJVc2VySUQnICkgfHwgJyc7CgogICAgICAgIG15ICRDdXN0b21lcklEICAgICAgICAgICAgICA9ICcnOwogICAgICAgIG15ICRDdXN0b21lclRhYmxlSFRNTFN0cmluZyA9ICcnOwoKICAgICAgICAjIGdldCBjdXN0b21lciBkYXRhCiAgICAgICAgbXkgJUN1c3RvbWVyRGF0YSA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyVXNlckRhdGFHZXQoCiAgICAgICAgICAgIFVzZXIgPT4gJEN1c3RvbWVyVXNlcklELAogICAgICAgICk7CgogICAgICAgIGlmICggJEN1c3RvbWVyRGF0YXtVc2VyVGl0bGV9ICkgewogICAgICAgICAgICAkQ3VzdG9tZXJEYXRhe1VzZXJUaXRsZX0gPSAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoICRDdXN0b21lckRhdGF7VXNlclRpdGxlfSApOwogICAgICAgIH0KCiAgICAgICAgIyBnZXQgY3VzdG9tZXIgaWQKICAgICAgICBpZiAoICRDdXN0b21lckRhdGF7VXNlckN1c3RvbWVySUR9ICkgewogICAgICAgICAgICAkQ3VzdG9tZXJJRCA9ICRDdXN0b21lckRhdGF7VXNlckN1c3RvbWVySUR9OwogICAgICAgIH0KCiAgICAgICAgbXkgQEN1c3RvbWVySURzOwoKICAgICAgICBpZiAoJEN1c3RvbWVyVXNlcklEKSB7CiAgICAgICAgICAgIEBDdXN0b21lcklEcyA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVySURzKAogICAgICAgICAgICAgICAgVXNlciA9PiAkQ3VzdG9tZXJVc2VySUQsCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIGJ1aWxkIGh0bWwgZm9yIGN1c3RvbWVyIGluZm8gdGFibGUKICAgICAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpGcm9udGVuZDo6Q3VzdG9tZXJJbmZvQ29tcG9zZScpICkgewoKICAgICAgICAgICAgJEN1c3RvbWVyVGFibGVIVE1MU3RyaW5nID0gJExheW91dE9iamVjdC0+QWdlbnRDdXN0b21lclZpZXdUYWJsZSgKICAgICAgICAgICAgICAgIERhdGEgPT4geyVDdXN0b21lckRhdGF9LAogICAgICAgICAgICAgICAgTWF4ICA9PiAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6OkN1c3RvbWVySW5mb0NvbXBvc2VNYXhTaXplJyksCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIGJ1aWxkIEpTT04gb3V0cHV0CiAgICAgICAgJEpTT04gPSAkTGF5b3V0T2JqZWN0LT5KU09ORW5jb2RlKAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgIEN1c3RvbWVySUQgICAgICAgICAgICAgID0+ICRDdXN0b21lcklELAogICAgICAgICAgICAgICAgQ3VzdG9tZXJUYWJsZUhUTUxTdHJpbmcgPT4gJEN1c3RvbWVyVGFibGVIVE1MU3RyaW5nLAogICAgICAgICAgICAgICAgQ3VzdG9tZXJJRHMgICAgICAgICAgICAgPT4gXEBDdXN0b21lcklEcywKICAgICAgICAgICAgfSwKICAgICAgICApOwogICAgfQoKICAgICMgZ2V0IGN1c3RvbWVyIHRpY2tldHMKICAgIGVsc2lmICggJFNlbGYtPntTdWJhY3Rpb259IGVxICdDdXN0b21lclRpY2tldHMnICkgewoKICAgICAgICAjIGdldCBwYXJhbXMKICAgICAgICBteSAkQ3VzdG9tZXJVc2VySUQgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQ3VzdG9tZXJVc2VySUQnICkgfHwgJyc7CiAgICAgICAgbXkgJEN1c3RvbWVySUQgICAgID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0N1c3RvbWVySUQnICkgICAgIHx8ICcnOwoKICAgICAgICAjIGdldCBzZWNvbmRhcnkgY3VzdG9tZXIgaWRzCiAgICAgICAgbXkgQEN1c3RvbWVySURzOwogICAgICAgIGlmICgkQ3VzdG9tZXJVc2VySUQpIHsKICAgICAgICAgICAgQEN1c3RvbWVySURzID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJJRHMoCiAgICAgICAgICAgICAgICBVc2VyID0+ICRDdXN0b21lclVzZXJJRCwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgYWRkIG93biBjdXN0b21lciBpZAogICAgICAgIGlmICgkQ3VzdG9tZXJJRCkgewogICAgICAgICAgICBwdXNoIEBDdXN0b21lcklEcywgJEN1c3RvbWVySUQ7CiAgICAgICAgfQoKICAgICAgICBteSAkVmlldyAgICA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdWaWV3JyApICAgIHx8ICcnOwogICAgICAgIG15ICRTb3J0QnkgID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ1NvcnRCeScgKSAgfHwgJ0FnZSc7CiAgICAgICAgbXkgJE9yZGVyQnkgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnT3JkZXJCeScgKSB8fCAnRG93bic7CgogICAgICAgIG15IEBWaWV3YWJsZVRpY2tldHM7CiAgICAgICAgaWYgKEBDdXN0b21lcklEcykgewogICAgICAgICAgICBAVmlld2FibGVUaWNrZXRzID0gJFRpY2tldE9iamVjdC0+VGlja2V0U2VhcmNoKAogICAgICAgICAgICAgICAgUmVzdWx0ICAgICAgICA9PiAnQVJSQVknLAogICAgICAgICAgICAgICAgTGltaXQgICAgICAgICA9PiAyNTAsCiAgICAgICAgICAgICAgICBTb3J0QnkgICAgICAgID0+IFskU29ydEJ5XSwKICAgICAgICAgICAgICAgIE9yZGVyQnkgICAgICAgPT4gWyRPcmRlckJ5XSwKICAgICAgICAgICAgICAgIEN1c3RvbWVySURSYXcgPT4gXEBDdXN0b21lcklEcywKICAgICAgICAgICAgICAgIFVzZXJJRCAgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICAgICAgUGVybWlzc2lvbiAgICA9PiAncm8nLAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgbXkgJExpbmtTb3J0ID0gJ1N1YmFjdGlvbj0nIC4gJFNlbGYtPntTdWJhY3Rpb259CiAgICAgICAgICAgIC4gJztWaWV3PScgLiAkTGF5b3V0T2JqZWN0LT5Bc2NpaTJIdG1sKCBUZXh0ID0+ICRWaWV3ICkKICAgICAgICAgICAgLiAnO0N1c3RvbWVyVXNlcklEPScgLiAkTGF5b3V0T2JqZWN0LT5Bc2NpaTJIdG1sKCBUZXh0ID0+ICRDdXN0b21lclVzZXJJRCApCiAgICAgICAgICAgIC4gJztDdXN0b21lcklEPScgLiAkTGF5b3V0T2JqZWN0LT5Bc2NpaTJIdG1sKCBUZXh0ID0+ICRDdXN0b21lcklEICkKICAgICAgICAgICAgLiAnJic7CiAgICAgICAgbXkgJExpbmtQYWdlID0gJ1N1YmFjdGlvbj0nIC4gJFNlbGYtPntTdWJhY3Rpb259CiAgICAgICAgICAgIC4gJztWaWV3PScgLiAkTGF5b3V0T2JqZWN0LT5Bc2NpaTJIdG1sKCBUZXh0ID0+ICRWaWV3ICkKICAgICAgICAgICAgLiAnO1NvcnRCeT0nIC4gJExheW91dE9iamVjdC0+QXNjaWkySHRtbCggVGV4dCA9PiAkU29ydEJ5ICkKICAgICAgICAgICAgLiAnO09yZGVyQnk9JyAuICRMYXlvdXRPYmplY3QtPkFzY2lpMkh0bWwoIFRleHQgPT4gJE9yZGVyQnkgKQogICAgICAgICAgICAuICc7Q3VzdG9tZXJVc2VySUQ9JyAuICRMYXlvdXRPYmplY3QtPkFzY2lpMkh0bWwoIFRleHQgPT4gJEN1c3RvbWVyVXNlcklEICkKICAgICAgICAgICAgLiAnO0N1c3RvbWVySUQ9JyAuICRMYXlvdXRPYmplY3QtPkFzY2lpMkh0bWwoIFRleHQgPT4gJEN1c3RvbWVySUQgKQogICAgICAgICAgICAuICcmJzsKICAgICAgICBteSAkTGlua0ZpbHRlciA9ICdTdWJhY3Rpb249JyAuICRTZWxmLT57U3ViYWN0aW9ufQogICAgICAgICAgICAuICc7Q3VzdG9tZXJVc2VySUQ9JyAuICRMYXlvdXRPYmplY3QtPkFzY2lpMkh0bWwoIFRleHQgPT4gJEN1c3RvbWVyVXNlcklEICkKICAgICAgICAgICAgLiAnO0N1c3RvbWVySUQ9JyAuICRMYXlvdXRPYmplY3QtPkFzY2lpMkh0bWwoIFRleHQgPT4gJEN1c3RvbWVySUQgKQogICAgICAgICAgICAuICcmJzsKCiAgICAgICAgbXkgJEN1c3RvbWVyVGlja2V0c0hUTUxTdHJpbmcgPSAnJzsKICAgICAgICBpZiAoQFZpZXdhYmxlVGlja2V0cykgewogICAgICAgICAgICAkQ3VzdG9tZXJUaWNrZXRzSFRNTFN0cmluZyAuPSAkTGF5b3V0T2JqZWN0LT5UaWNrZXRMaXN0U2hvdygKICAgICAgICAgICAgICAgIFRpY2tldElEcyAgPT4gXEBWaWV3YWJsZVRpY2tldHMsCiAgICAgICAgICAgICAgICBUb3RhbCAgICAgID0+IHNjYWxhciBAVmlld2FibGVUaWNrZXRzLAogICAgICAgICAgICAgICAgRW52ICAgICAgICA9PiAkU2VsZiwKICAgICAgICAgICAgICAgIFZpZXcgICAgICAgPT4gJFZpZXcsCiAgICAgICAgICAgICAgICBUaXRsZU5hbWUgID0+IFRyYW5zbGF0YWJsZSgnQ3VzdG9tZXIgSGlzdG9yeScpLAogICAgICAgICAgICAgICAgTGlua1BhZ2UgICA9PiAkTGlua1BhZ2UsCiAgICAgICAgICAgICAgICBMaW5rU29ydCAgID0+ICRMaW5rU29ydCwKICAgICAgICAgICAgICAgIExpbmtGaWx0ZXIgPT4gJExpbmtGaWx0ZXIsCiAgICAgICAgICAgICAgICBPdXRwdXQgICAgID0+ICdyYXcnLAoKICAgICAgICAgICAgICAgIE9yZGVyQnkgPT4gJE9yZGVyQnksCiAgICAgICAgICAgICAgICBTb3J0QnkgID0+ICRTb3J0QnksCiAgICAgICAgICAgICAgICBBSkFYICAgID0+IDEsCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIGJ1aWxkIEpTT04gb3V0cHV0CiAgICAgICAgJEpTT04gPSAkTGF5b3V0T2JqZWN0LT5KU09ORW5jb2RlKAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgIEN1c3RvbWVyVGlja2V0c0hUTUxTdHJpbmcgPT4gJEN1c3RvbWVyVGlja2V0c0hUTUxTdHJpbmcsCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIHNlbmQgSlNPTiByZXNwb25zZQogICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkF0dGFjaG1lbnQoCiAgICAgICAgQ29udGVudFR5cGUgPT4gJ2FwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9JyAuICRMYXlvdXRPYmplY3QtPntDaGFyc2V0fSwKICAgICAgICBDb250ZW50ICAgICA9PiAkSlNPTiB8fCAnJywKICAgICAgICBUeXBlICAgICAgICA9PiAnaW5saW5lJywKICAgICAgICBOb0NhY2hlICAgICA9PiAxLAogICAgKTsKCn0KCjE7Cg==</File>
        <File Location="Custom/Kernel/Modules/AgentCustomerUserInformationCenterSearch.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxLTIwMjIgWm51bnkgR21iSCwgaHR0cHM6Ly96bnVueS5vcmcvCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6TW9kdWxlczo6QWdlbnRDdXN0b21lclVzZXJJbmZvcm1hdGlvbkNlbnRlclNlYXJjaDsKIyMgbm9maWx0ZXIoVGlkeUFsbDo6UGx1Z2luOjpPVFJTOjpQZXJsOjpEQk9iamVjdCkKCnVzZSBzdHJpY3Q7CnVzZSB3YXJuaW5nczsKCnVzZSBLZXJuZWw6OlN5c3RlbTo6VmFyaWFibGVDaGVjayBxdyg6YWxsKTsKCm91ciAkT2JqZWN0TWFuYWdlckRpc2FibGVkID0gMTsKCnN1YiBuZXcgewogICAgbXkgKCAkVHlwZSwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGFsbG9jYXRlIG5ldyBoYXNoIGZvciBvYmplY3QKICAgIG15ICRTZWxmID0geyVQYXJhbX07CiAgICBibGVzcyggJFNlbGYsICRUeXBlICk7CgogICAgcmV0dXJuICRTZWxmOwp9CgpzdWIgUnVuIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBnZXQgbmVlZGVkIG9iamVjdHMKICAgIG15ICRQYXJhbU9iamVjdCAgICAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6V2ViOjpSZXF1ZXN0Jyk7CiAgICBteSAkTGF5b3V0T2JqZWN0ICAgICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwogICAgbXkgJEN1c3RvbWVyVXNlck9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDdXN0b21lclVzZXInKTsKICAgIG15ICRDb25maWdPYmplY3QgICAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpOwogICAgbXkgJFRpY2tldE9iamVjdCAgICAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpUaWNrZXQnKTsKCiAgICBteSAkQXV0b0NvbXBsZXRlQ29uZmlnICAgICAgICAgICAgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0F1dG9Db21wbGV0ZTo6QWdlbnQnKS0+e0N1c3RvbWVyU2VhcmNofTsKICAgIG15ICRNYXhSZXN1bHRzICAgICAgICAgICAgICAgICAgICA9ICRBdXRvQ29tcGxldGVDb25maWctPntNYXhSZXN1bHRzRGlzcGxheWVkfSB8fCAyMDsKICAgIG15ICRJbmNsdWRlVW5rbm93blRpY2tldEN1c3RvbWVycyA9IGludCggJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0luY2x1ZGVVbmtub3duVGlja2V0Q3VzdG9tZXJzJyApIHx8IDAgKTsKICAgIG15ICRTZWFyY2hUZXJtICAgICAgICAgICAgICAgICAgICA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdUZXJtJyApIHx8ICcnOwoKICAgIGlmICggJFNlbGYtPntTdWJhY3Rpb259IGVxICdTZWFyY2hDdXN0b21lclVzZXInICkgewoKICAgICAgICBteSAkVW5rbm93blRpY2tldEN1c3RvbWVyTGlzdDsKCiAgICAgICAgaWYgKCRJbmNsdWRlVW5rbm93blRpY2tldEN1c3RvbWVycykgewoKICAgICAgICAgICAgIyBhZGQgY3VzdG9tZXJzIHRoYXQgYXJlIG5vdCBzYXZlZCBpbiBhbnkgYmFja2VuZAogICAgICAgICAgICAkVW5rbm93blRpY2tldEN1c3RvbWVyTGlzdCA9ICRUaWNrZXRPYmplY3QtPlNlYXJjaFVua25vd25UaWNrZXRDdXN0b21lcnMoCiAgICAgICAgICAgICAgICBTZWFyY2hUZXJtID0+ICRTZWFyY2hUZXJtLAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgbXkgJUN1c3RvbWVyTGlzdCA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyU2VhcmNoKAogICAgICAgICAgICBTZWFyY2ggPT4gJFNlYXJjaFRlcm0sCiAgICAgICAgICAgIFVzZXJJRCA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgKTsKICAgICAgICBtYXAgeyAkQ3VzdG9tZXJMaXN0eyRffSA9ICRVbmtub3duVGlja2V0Q3VzdG9tZXJMaXN0LT57JF99IH0ga2V5cyAleyRVbmtub3duVGlja2V0Q3VzdG9tZXJMaXN0fTsKCiAgICAgICAgbXkgQFJlc3VsdDsKCiAgICAgICAgQ1VTVE9NRVJMT0dJTjoKICAgICAgICBmb3IgbXkgJEN1c3RvbWVyTG9naW4gKCBzb3J0IGtleXMgJUN1c3RvbWVyTGlzdCApIHsKCiAgICAgICAgICAgIG15ICVDdXN0b21lckRhdGEgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJEYXRhR2V0KAogICAgICAgICAgICAgICAgVXNlciA9PiAkQ3VzdG9tZXJMb2dpbiwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGlmICggISggZ3JlcCB7ICRfLT57VmFsdWV9IGVxICRDdXN0b21lckRhdGF7VXNlckN1c3RvbWVySUR9IH0gQFJlc3VsdCApICkgewogICAgICAgICAgICAgICAgcHVzaCBAUmVzdWx0LCB7CiAgICAgICAgICAgICAgICAgICAgTGFiZWwgPT4gJEN1c3RvbWVyTGlzdHskQ3VzdG9tZXJMb2dpbn0sCiAgICAgICAgICAgICAgICAgICAgVmFsdWUgPT4gJEN1c3RvbWVyTG9naW4sCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBsYXN0IENVU1RPTUVSTE9HSU4gaWYgc2NhbGFyIEBSZXN1bHQgPj0gJE1heFJlc3VsdHM7CiAgICAgICAgfQoKICAgICAgICBteSAkSlNPTiA9ICRMYXlvdXRPYmplY3QtPkpTT05FbmNvZGUoCiAgICAgICAgICAgIERhdGEgPT4gXEBSZXN1bHQsCiAgICAgICAgKTsKCiAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkF0dGFjaG1lbnQoCiAgICAgICAgICAgIENvbnRlbnRUeXBlID0+ICdhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PScgLiAkTGF5b3V0T2JqZWN0LT57Q2hhcnNldH0sCiAgICAgICAgICAgIENvbnRlbnQgICAgID0+ICRKU09OIHx8ICcnLAogICAgICAgICAgICBUeXBlICAgICAgICA9PiAnaW5saW5lJywKICAgICAgICAgICAgTm9DYWNoZSAgICAgPT4gMSwKICAgICAgICApOwogICAgfQoKICAgIG15ICRPdXRwdXQgPSAkTGF5b3V0T2JqZWN0LT5PdXRwdXQoCiAgICAgICAgVGVtcGxhdGVGaWxlID0+ICdBZ2VudEN1c3RvbWVyVXNlckluZm9ybWF0aW9uQ2VudGVyU2VhcmNoJywKICAgICAgICBEYXRhICAgICAgICAgPT4gXCVQYXJhbSwKICAgICk7CiAgICByZXR1cm4gJExheW91dE9iamVjdC0+QXR0YWNobWVudCgKICAgICAgICBOb0NhY2hlICAgICA9PiAxLAogICAgICAgIENvbnRlbnRUeXBlID0+ICd0ZXh0L2h0bWwnLAogICAgICAgIENoYXJzZXQgICAgID0+ICRMYXlvdXRPYmplY3QtPntVc2VyQ2hhcnNldH0sCiAgICAgICAgQ29udGVudCAgICAgPT4gJE91dHB1dCB8fCAnJywKICAgICAgICBUeXBlICAgICAgICA9PiAnaW5saW5lJywKICAgICk7Cn0KCjE7Cg==</File>
        <File Location="Custom/Kernel/Modules/AgentTicketCompose.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxLTIwMjIgWm51bnkgR21iSCwgaHR0cHM6Ly96bnVueS5vcmcvCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6TW9kdWxlczo6QWdlbnRUaWNrZXRDb21wb3NlOwoKdXNlIHN0cmljdDsKdXNlIHdhcm5pbmdzOwoKdXNlIEtlcm5lbDo6U3lzdGVtOjpWYXJpYWJsZUNoZWNrIHF3KDphbGwpOwp1c2UgS2VybmVsOjpMYW5ndWFnZSBxdyhUcmFuc2xhdGFibGUpOwp1c2UgTWFpbDo6QWRkcmVzczsKCm91ciAkT2JqZWN0TWFuYWdlckRpc2FibGVkID0gMTsKCnN1YiBuZXcgewogICAgbXkgKCAkVHlwZSwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGFsbG9jYXRlIG5ldyBoYXNoIGZvciBvYmplY3QKICAgIG15ICRTZWxmID0geyVQYXJhbX07CiAgICBibGVzcyggJFNlbGYsICRUeXBlICk7CgogICAgIyBUcnkgdG8gbG9hZCBkcmFmdCBpZiByZXF1ZXN0ZWQuCiAgICBpZiAoCiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKS0+R2V0KCJUaWNrZXQ6OkZyb250ZW5kOjokU2VsZi0+e0FjdGlvbn0iKS0+e0Zvcm1EcmFmdH0KICAgICAgICAmJiAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6V2ViOjpSZXF1ZXN0JyktPkdldFBhcmFtKCBQYXJhbSA9PiAnTG9hZEZvcm1EcmFmdCcgKQogICAgICAgICYmICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpXZWI6OlJlcXVlc3QnKS0+R2V0UGFyYW0oIFBhcmFtID0+ICdGb3JtRHJhZnRJRCcgKQogICAgICAgICkKICAgIHsKICAgICAgICAkU2VsZi0+e0xvYWRlZEZvcm1EcmFmdElEfSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpXZWI6OlJlcXVlc3QnKS0+TG9hZEZvcm1EcmFmdCgKICAgICAgICAgICAgRm9ybURyYWZ0SUQgPT4gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OldlYjo6UmVxdWVzdCcpLT5HZXRQYXJhbSggUGFyYW0gPT4gJ0Zvcm1EcmFmdElEJyApLAogICAgICAgICAgICBVc2VySUQgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgKTsKICAgIH0KCiAgICAkU2VsZi0+e0RlYnVnfSA9ICRQYXJhbXtEZWJ1Z30gfHwgMDsKCiAgICAjIGdldCBmb3JtIGlkCiAgICAkU2VsZi0+e0Zvcm1JRH0gPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6V2ViOjpSZXF1ZXN0JyktPkdldFBhcmFtKCBQYXJhbSA9PiAnRm9ybUlEJyApOwoKICAgICMgY3JlYXRlIGZvcm0gaWQKICAgIGlmICggISRTZWxmLT57Rm9ybUlEfSApIHsKICAgICAgICAkU2VsZi0+e0Zvcm1JRH0gPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6V2ViOjpVcGxvYWRDYWNoZScpLT5Gb3JtSURDcmVhdGUoKTsKICAgIH0KCiAgICByZXR1cm4gJFNlbGY7Cn0KCnN1YiBSdW4gewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGdldCBsYXlvdXQgb2JqZWN0CiAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBpZiAoICEkU2VsZi0+e1RpY2tldElEfSApIHsKICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+RXJyb3JTY3JlZW4oCiAgICAgICAgICAgIE1lc3NhZ2UgPT4gVHJhbnNsYXRhYmxlKCdObyBUaWNrZXRJRCBpcyBnaXZlbiEnKSwKICAgICAgICAgICAgQ29tbWVudCA9PiBUcmFuc2xhdGFibGUoJ1BsZWFzZSBjb250YWN0IHRoZSBhZG1pbmlzdHJhdG9yLicpLAogICAgICAgICk7CiAgICB9CgogICAgIyBnZXQgbmVlZGVkIG9iamVjdHMKICAgIG15ICRDb25maWdPYmplY3QgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpOwogICAgbXkgJFRpY2tldE9iamVjdCAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpUaWNrZXQnKTsKICAgIG15ICRBcnRpY2xlT2JqZWN0ICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGlja2V0OjpBcnRpY2xlJyk7CiAgICBteSAkSFRNTFV0aWxzT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkhUTUxVdGlscycpOwoKICAgIG15ICRBcnRpY2xlQmFja2VuZE9iamVjdCA9ICRBcnRpY2xlT2JqZWN0LT5CYWNrZW5kRm9yQ2hhbm5lbCggQ2hhbm5lbE5hbWUgPT4gJ0VtYWlsJyApOwoKICAgICMgZ2V0IGNvbmZpZyBmb3IgZnJvbnRlbmQgbW9kdWxlCiAgICBteSAkQ29uZmlnID0gJENvbmZpZ09iamVjdC0+R2V0KCJUaWNrZXQ6OkZyb250ZW5kOjokU2VsZi0+e0FjdGlvbn0iKTsKCiAgICAjIGNoZWNrIHBlcm1pc3Npb25zCiAgICBteSAkQWNjZXNzID0gJFRpY2tldE9iamVjdC0+VGlja2V0UGVybWlzc2lvbigKICAgICAgICBUeXBlICAgICA9PiAkQ29uZmlnLT57UGVybWlzc2lvbn0sCiAgICAgICAgVGlja2V0SUQgPT4gJFNlbGYtPntUaWNrZXRJRH0sCiAgICAgICAgVXNlcklEICAgPT4gJFNlbGYtPntVc2VySUR9CiAgICApOwoKICAgICMgZXJyb3Igc2NyZWVuLCBkb24ndCBzaG93IHRpY2tldAogICAgaWYgKCAhJEFjY2VzcyApIHsKICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+Tm9QZXJtaXNzaW9uKAogICAgICAgICAgICBNZXNzYWdlID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSggJ1lvdSBuZWVkICVzIHBlcm1pc3Npb25zIScsICRDb25maWctPntQZXJtaXNzaW9ufSApLAogICAgICAgICAgICBXaXRoSGVhZGVyID0+ICd5ZXMnLAogICAgICAgICk7CiAgICB9CgogICAgIyBnZXQgQUNMIHJlc3RyaWN0aW9ucwogICAgbXkgJVBvc3NpYmxlQWN0aW9ucyA9ICggMSA9PiAkU2VsZi0+e0FjdGlvbn0gKTsKCiAgICBteSAkQUNMID0gJFRpY2tldE9iamVjdC0+VGlja2V0QWNsKAogICAgICAgIERhdGEgICAgICAgICAgPT4gXCVQb3NzaWJsZUFjdGlvbnMsCiAgICAgICAgQWN0aW9uICAgICAgICA9PiAkU2VsZi0+e0FjdGlvbn0sCiAgICAgICAgVGlja2V0SUQgICAgICA9PiAkU2VsZi0+e1RpY2tldElEfSwKICAgICAgICBSZXR1cm5UeXBlICAgID0+ICdBY3Rpb24nLAogICAgICAgIFJldHVyblN1YlR5cGUgPT4gJy0nLAogICAgICAgIFVzZXJJRCAgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgKTsKICAgIG15ICVBY2xBY3Rpb24gPSAkVGlja2V0T2JqZWN0LT5UaWNrZXRBY2xBY3Rpb25EYXRhKCk7CgogICAgIyBjaGVjayBpZiBBQ0wgcmVzdHJpY3Rpb25zIGV4aXN0CiAgICBpZiAoICRBQ0wgfHwgSXNIYXNoUmVmV2l0aERhdGEoIFwlQWNsQWN0aW9uICkgKSB7CgogICAgICAgIG15ICVBY2xBY3Rpb25Mb29rdXAgPSByZXZlcnNlICVBY2xBY3Rpb247CgogICAgICAgICMgc2hvdyBlcnJvciBzY3JlZW4gaWYgQUNMIHByb2hpYml0cyB0aGlzIGFjdGlvbgogICAgICAgIGlmICggISRBY2xBY3Rpb25Mb29rdXB7ICRTZWxmLT57QWN0aW9ufSB9ICkgewogICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+Tm9QZXJtaXNzaW9uKCBXaXRoSGVhZGVyID0+ICd5ZXMnICk7CiAgICAgICAgfQogICAgfQoKICAgICMgQ2hlY2sgZm9yIGZhaWxlZCBkcmFmdCBsb2FkaW5nIHJlcXVlc3QuCiAgICBpZiAoCiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OldlYjo6UmVxdWVzdCcpLT5HZXRQYXJhbSggUGFyYW0gPT4gJ0xvYWRGb3JtRHJhZnQnICkKICAgICAgICAmJiAhJFNlbGYtPntMb2FkZWRGb3JtRHJhZnRJRH0KICAgICAgICApCiAgICB7CiAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkVycm9yU2NyZWVuKAogICAgICAgICAgICBNZXNzYWdlID0+IFRyYW5zbGF0YWJsZSgnTG9hZGluZyBkcmFmdCBmYWlsZWQhJyksCiAgICAgICAgICAgIENvbW1lbnQgPT4gVHJhbnNsYXRhYmxlKCdQbGVhc2UgY29udGFjdCB0aGUgYWRtaW5pc3RyYXRvci4nKSwKICAgICAgICApOwogICAgfQoKICAgIG15ICVUaWNrZXQgPSAkVGlja2V0T2JqZWN0LT5UaWNrZXRHZXQoCiAgICAgICAgVGlja2V0SUQgICAgICA9PiAkU2VsZi0+e1RpY2tldElEfSwKICAgICAgICBEeW5hbWljRmllbGRzID0+IDEKICAgICk7CgogICAgIyBnZXQgbG9jayBzdGF0ZQogICAgbXkgJFRpY2tldEJhY2tUeXBlID0gJ1RpY2tldEJhY2snOwogICAgaWYgKCAkQ29uZmlnLT57UmVxdWlyZWRMb2NrfSApIHsKICAgICAgICBpZiAoICEkVGlja2V0T2JqZWN0LT5UaWNrZXRMb2NrR2V0KCBUaWNrZXRJRCA9PiAkU2VsZi0+e1RpY2tldElEfSApICkgewoKICAgICAgICAgICAgbXkgJExvY2sgPSAkVGlja2V0T2JqZWN0LT5UaWNrZXRMb2NrU2V0KAogICAgICAgICAgICAgICAgVGlja2V0SUQgPT4gJFNlbGYtPntUaWNrZXRJRH0sCiAgICAgICAgICAgICAgICBMb2NrICAgICA9PiAnbG9jaycsCiAgICAgICAgICAgICAgICBVc2VySUQgICA9PiAkU2VsZi0+e1VzZXJJRH0KICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgU2V0IG5ldyBvd25lciBpZiB0aWNrZXQgb3duZXIgaXMgZGlmZmVyZW50IHRoZW4gbG9nZ2VkIHVzZXIuCiAgICAgICAgICAgIGlmICggJExvY2sgJiYgKCAkVGlja2V0e093bmVySUR9ICE9ICRTZWxmLT57VXNlcklEfSApICkgewoKICAgICAgICAgICAgICAgICMgUmVtZW1iZXIgcHJldmlvdXMgb3duZXIsIHdoaWNoIHdpbGwgYmUgdXNlZCB0byByZXN0b3JlIHRpY2tldCBvd25lciBvbiB1bmRvIGFjdGlvbi4KICAgICAgICAgICAgICAgICRUaWNrZXR7UHJldmlvdXNPd25lcn0gPSAkVGlja2V0e093bmVySUR9OwoKICAgICAgICAgICAgICAgIG15ICRTdWNjZXNzID0gJFRpY2tldE9iamVjdC0+VGlja2V0T3duZXJTZXQoCiAgICAgICAgICAgICAgICAgICAgVGlja2V0SUQgID0+ICRTZWxmLT57VGlja2V0SUR9LAogICAgICAgICAgICAgICAgICAgIFVzZXJJRCAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICAgICAgICAgTmV3VXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgIyBTaG93IGxvY2sgc3RhdGUuCiAgICAgICAgICAgICAgICBpZiAoICEkU3VjY2VzcyApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAkVGlja2V0QmFja1R5cGUgLj0gJ1VuZG8nOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgbXkgJEFjY2Vzc09rID0gJFRpY2tldE9iamVjdC0+T3duZXJDaGVjaygKICAgICAgICAgICAgICAgIFRpY2tldElEID0+ICRTZWxmLT57VGlja2V0SUR9LAogICAgICAgICAgICAgICAgT3duZXJJRCAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICApOwogICAgICAgICAgICBpZiAoICEkQWNjZXNzT2sgKSB7CiAgICAgICAgICAgICAgICBteSAkT3V0cHV0ID0gJExheW91dE9iamVjdC0+SGVhZGVyKAogICAgICAgICAgICAgICAgICAgIFZhbHVlICAgICA9PiAkVGlja2V0e051bWJlcn0sCiAgICAgICAgICAgICAgICAgICAgVHlwZSAgICAgID0+ICdTbWFsbCcsCiAgICAgICAgICAgICAgICAgICAgQm9keUNsYXNzID0+ICdQb3B1cCcsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5XYXJuaW5nKAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gVHJhbnNsYXRhYmxlKCdTb3JyeSwgeW91IG5lZWQgdG8gYmUgdGhlIHRpY2tldCBvd25lciB0byBwZXJmb3JtIHRoaXMgYWN0aW9uLicpLAogICAgICAgICAgICAgICAgICAgIENvbW1lbnQgPT4gVHJhbnNsYXRhYmxlKCdQbGVhc2UgY2hhbmdlIHRoZSBvd25lciBmaXJzdC4nKSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPkZvb3RlcigKICAgICAgICAgICAgICAgICAgICBUeXBlID0+ICdTbWFsbCcsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgcmV0dXJuICRPdXRwdXQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgIyBnZXQgcGFyYW0gb2JqZWN0CiAgICBteSAkUGFyYW1PYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6V2ViOjpSZXF1ZXN0Jyk7CgogICAgIyBnZXQgcGFyYW1zCiAgICBteSAlR2V0UGFyYW07CiAgICBmb3IgbXkgJE5lZWRlZCAoCiAgICAgICAgcXcoCiAgICAgICAgVG8gQ2MgQmNjIFN1YmplY3QgQm9keSBJblJlcGx5VG8gUmVmZXJlbmNlcyBSZXNwb25zZUlEIFJlcGx5QXJ0aWNsZUlEIFN0YXRlSUQgQXJ0aWNsZUlECiAgICAgICAgSXNWaXNpYmxlRm9yQ3VzdG9tZXJQcmVzZW50IElzVmlzaWJsZUZvckN1c3RvbWVyIFRpbWVVbml0cyBZZWFyIE1vbnRoIERheSBIb3VyIE1pbnV0ZSBGb3JtSUQgUmVwbHlBbGwKICAgICAgICBGb3JtRHJhZnRJRCBUaXRsZQogICAgICAgICkKICAgICAgICApCiAgICB7CiAgICAgICAgJEdldFBhcmFteyROZWVkZWR9ID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJE5lZWRlZCApOwogICAgfQoKICAgICMgTWFrZSBzdXJlIHNlbmRlciBpcyBjb3JyZWN0IG9uZS4gU2VlIGJ1ZyMxNDg3MiAoIGh0dHBzOi8vYnVncy5vdHJzLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MTQ4NzIgKS4KICAgICRHZXRQYXJhbXtGcm9tfSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpUZW1wbGF0ZUdlbmVyYXRvcicpLT5TZW5kZXIoCiAgICAgICAgUXVldWVJRCA9PiAkVGlja2V0e1F1ZXVlSUR9LAogICAgICAgIFVzZXJJRCAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgKTsKCiAgICAjIGhhc2ggZm9yIGNoZWNrIGR1cGxpY2F0ZWQgZW50cmllcwogICAgbXkgJUFkZHJlc3Nlc0xpc3Q7CgogICAgbXkgQE11bHRpcGxlQ3VzdG9tZXI7CiAgICBteSAkQ3VzdG9tZXJzTnVtYmVyID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0N1c3RvbWVyVGlja2V0Q291bnRlclRvQ3VzdG9tZXInICkgfHwgMDsKICAgIG15ICRTZWxlY3RlZCAgICAgICAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQ3VzdG9tZXJTZWxlY3RlZCcgKSAgICAgICAgICAgICAgICB8fCAnJzsKCiAgICAjIGdldCBjaGVjayBpdGVtIG9iamVjdAogICAgbXkgJENoZWNrSXRlbU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDaGVja0l0ZW0nKTsKCiAgICBpZiAoJEN1c3RvbWVyc051bWJlcikgewoKICAgICAgICBteSAkQ3VzdG9tZXJDb3VudGVyID0gMTsKICAgICAgICBmb3IgbXkgJENvdW50ICggMSAuLi4gJEN1c3RvbWVyc051bWJlciApIHsKICAgICAgICAgICAgbXkgJEN1c3RvbWVyRWxlbWVudCAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQ3VzdG9tZXJUaWNrZXRUZXh0XycgLiAkQ291bnQgKTsKICAgICAgICAgICAgbXkgJEN1c3RvbWVyU2VsZWN0ZWQgPSAoICRTZWxlY3RlZCBlcSAkQ291bnQgPyAnY2hlY2tlZD0iY2hlY2tlZCInIDogJycgKTsKICAgICAgICAgICAgbXkgJEN1c3RvbWVyS2V5ICAgICAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQ3VzdG9tZXJLZXlfJyAuICRDb3VudCApCiAgICAgICAgICAgICAgICB8fCAnJzsKICAgICAgICAgICAgbXkgJEN1c3RvbWVyUXVldWUgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQ3VzdG9tZXJRdWV1ZV8nIC4gJENvdW50ICkKICAgICAgICAgICAgICAgIHx8ICcnOwogICAgICAgICAgICBpZiAoJEN1c3RvbWVyRWxlbWVudCkgewoKICAgICAgICAgICAgICAgIGlmICggJEdldFBhcmFte1RvfSApIHsKICAgICAgICAgICAgICAgICAgICAkR2V0UGFyYW17VG99IC49ICcsICcgLiAkQ3VzdG9tZXJFbGVtZW50OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJEdldFBhcmFte1RvfSA9ICRDdXN0b21lckVsZW1lbnQ7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBjaGVjayBlbWFpbCBhZGRyZXNzCiAgICAgICAgICAgICAgICBteSAkQ3VzdG9tZXJFcnJvck1zZyA9ICdDdXN0b21lckdlbmVyaWNTZXJ2ZXJFcnJvck1zZyc7CiAgICAgICAgICAgICAgICBteSAkQ3VzdG9tZXJFcnJvciAgICA9ICcnOwogICAgICAgICAgICAgICAgZm9yIG15ICRFbWFpbCAoIE1haWw6OkFkZHJlc3MtPnBhcnNlKCRDdXN0b21lckVsZW1lbnQpICkgewogICAgICAgICAgICAgICAgICAgIGlmICggISRDaGVja0l0ZW1PYmplY3QtPkNoZWNrRW1haWwoIEFkZHJlc3MgPT4gJEVtYWlsLT5hZGRyZXNzKCkgKSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJEN1c3RvbWVyRXJyb3JNc2cgPSAkQ2hlY2tJdGVtT2JqZWN0LT5DaGVja0Vycm9yVHlwZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuICdTZXJ2ZXJFcnJvck1zZyc7CiAgICAgICAgICAgICAgICAgICAgICAgICRDdXN0b21lckVycm9yID0gJ1NlcnZlckVycm9yJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBjaGVjayBmb3IgZHVwbGljYXRlZCBlbnRyaWVzCiAgICAgICAgICAgICAgICBpZiAoIGRlZmluZWQgJEFkZHJlc3Nlc0xpc3R7JEN1c3RvbWVyRWxlbWVudH0gJiYgJEN1c3RvbWVyRXJyb3IgZXEgJycgKSB7CiAgICAgICAgICAgICAgICAgICAgJEN1c3RvbWVyRXJyb3JNc2cgPSAnSXNEdXBsaWNhdGVkU2VydmVyRXJyb3JNc2cnOwogICAgICAgICAgICAgICAgICAgICRDdXN0b21lckVycm9yICAgID0gJ1NlcnZlckVycm9yJzsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBteSAkQ3VzdG9tZXJEaXNhYmxlZCA9ICcnOwogICAgICAgICAgICAgICAgbXkgJENvdW50QXV4ICAgICAgICAgPSAkQ3VzdG9tZXJDb3VudGVyKys7CiAgICAgICAgICAgICAgICBpZiAoICRDdXN0b21lckVycm9yIG5lICcnICkgewogICAgICAgICAgICAgICAgICAgICRDdXN0b21lckRpc2FibGVkID0gJ2Rpc2FibGVkPSJkaXNhYmxlZCInOwogICAgICAgICAgICAgICAgICAgICRDb3VudEF1eCAgICAgICAgID0gJENvdW50IC4gJ0Vycm9yJzsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoICRDdXN0b21lclF1ZXVlIG5lICcnICkgewogICAgICAgICAgICAgICAgICAgICRDdXN0b21lclF1ZXVlID0gJENvdW50OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHB1c2ggQE11bHRpcGxlQ3VzdG9tZXIsIHsKICAgICAgICAgICAgICAgICAgICBDb3VudCAgICAgICAgICAgID0+ICRDb3VudEF1eCwKICAgICAgICAgICAgICAgICAgICBDdXN0b21lckVsZW1lbnQgID0+ICRDdXN0b21lckVsZW1lbnQsCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJTZWxlY3RlZCA9PiAkQ3VzdG9tZXJTZWxlY3RlZCwKICAgICAgICAgICAgICAgICAgICBDdXN0b21lcktleSAgICAgID0+ICRDdXN0b21lcktleSwKICAgICAgICAgICAgICAgICAgICBDdXN0b21lckVycm9yICAgID0+ICRDdXN0b21lckVycm9yLAogICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyRXJyb3JNc2cgPT4gJEN1c3RvbWVyRXJyb3JNc2csCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJEaXNhYmxlZCA9PiAkQ3VzdG9tZXJEaXNhYmxlZCwKICAgICAgICAgICAgICAgICAgICBDdXN0b21lclF1ZXVlICAgID0+ICRDdXN0b21lclF1ZXVlLAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICRBZGRyZXNzZXNMaXN0eyRDdXN0b21lckVsZW1lbnR9ID0gMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBteSBATXVsdGlwbGVDdXN0b21lckNjOwogICAgbXkgJEN1c3RvbWVyc051bWJlckNjID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0N1c3RvbWVyVGlja2V0Q291bnRlckNjQ3VzdG9tZXInICkgfHwgMDsKCiAgICBpZiAoJEN1c3RvbWVyc051bWJlckNjKSB7CiAgICAgICAgbXkgJEN1c3RvbWVyQ291bnRlckNjID0gMTsKICAgICAgICBmb3IgbXkgJENvdW50ICggMSAuLi4gJEN1c3RvbWVyc051bWJlckNjICkgewogICAgICAgICAgICBteSAkQ3VzdG9tZXJFbGVtZW50Q2MgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQ2NDdXN0b21lclRpY2tldFRleHRfJyAuICRDb3VudCApOwogICAgICAgICAgICBteSAkQ3VzdG9tZXJLZXlDYyAgICAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQ2NDdXN0b21lcktleV8nIC4gJENvdW50ICkKICAgICAgICAgICAgICAgIHx8ICcnOwogICAgICAgICAgICBteSAkQ3VzdG9tZXJRdWV1ZUNjID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0NjQ3VzdG9tZXJRdWV1ZV8nIC4gJENvdW50ICkKICAgICAgICAgICAgICAgIHx8ICcnOwoKICAgICAgICAgICAgaWYgKCRDdXN0b21lckVsZW1lbnRDYykgewoKICAgICAgICAgICAgICAgIGlmICggJEdldFBhcmFte0NjfSApIHsKICAgICAgICAgICAgICAgICAgICAkR2V0UGFyYW17Q2N9IC49ICcsICcgLiAkQ3VzdG9tZXJFbGVtZW50Q2M7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkR2V0UGFyYW17Q2N9ID0gJEN1c3RvbWVyRWxlbWVudENjOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgY2hlY2sgZW1haWwgYWRkcmVzcwogICAgICAgICAgICAgICAgbXkgJEN1c3RvbWVyRXJyb3JNc2dDYyA9ICdDdXN0b21lckdlbmVyaWNTZXJ2ZXJFcnJvck1zZyc7CiAgICAgICAgICAgICAgICBteSAkQ3VzdG9tZXJFcnJvckNjICAgID0gJyc7CiAgICAgICAgICAgICAgICBmb3IgbXkgJEVtYWlsICggTWFpbDo6QWRkcmVzcy0+cGFyc2UoJEN1c3RvbWVyRWxlbWVudENjKSApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoICEkQ2hlY2tJdGVtT2JqZWN0LT5DaGVja0VtYWlsKCBBZGRyZXNzID0+ICRFbWFpbC0+YWRkcmVzcygpICkgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRDdXN0b21lckVycm9yTXNnQ2MgPSAkQ2hlY2tJdGVtT2JqZWN0LT5DaGVja0Vycm9yVHlwZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuICdTZXJ2ZXJFcnJvck1zZyc7CiAgICAgICAgICAgICAgICAgICAgICAgICRDdXN0b21lckVycm9yQ2MgPSAnU2VydmVyRXJyb3InOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIGNoZWNrIGZvciBkdXBsaWNhdGVkIGVudHJpZXMKICAgICAgICAgICAgICAgIGlmICggZGVmaW5lZCAkQWRkcmVzc2VzTGlzdHskQ3VzdG9tZXJFbGVtZW50Q2N9ICYmICRDdXN0b21lckVycm9yQ2MgZXEgJycgKSB7CiAgICAgICAgICAgICAgICAgICAgJEN1c3RvbWVyRXJyb3JNc2dDYyA9ICdJc0R1cGxpY2F0ZWRTZXJ2ZXJFcnJvck1zZyc7CiAgICAgICAgICAgICAgICAgICAgJEN1c3RvbWVyRXJyb3JDYyAgICA9ICdTZXJ2ZXJFcnJvcic7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbXkgJEN1c3RvbWVyRGlzYWJsZWRDYyA9ICcnOwogICAgICAgICAgICAgICAgbXkgJENvdW50QXV4Q2MgICAgICAgICA9ICRDdXN0b21lckNvdW50ZXJDYysrOwogICAgICAgICAgICAgICAgaWYgKCAkQ3VzdG9tZXJFcnJvckNjIG5lICcnICkgewogICAgICAgICAgICAgICAgICAgICRDdXN0b21lckRpc2FibGVkQ2MgPSAnZGlzYWJsZWQ9ImRpc2FibGVkIic7CiAgICAgICAgICAgICAgICAgICAgJENvdW50QXV4Q2MgICAgICAgICA9ICRDb3VudCAuICdFcnJvcic7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCAkQ3VzdG9tZXJRdWV1ZUNjIG5lICcnICkgewogICAgICAgICAgICAgICAgICAgICRDdXN0b21lclF1ZXVlQ2MgPSAkQ291bnQ7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcHVzaCBATXVsdGlwbGVDdXN0b21lckNjLCB7CiAgICAgICAgICAgICAgICAgICAgQ291bnQgICAgICAgICAgICA9PiAkQ291bnRBdXhDYywKICAgICAgICAgICAgICAgICAgICBDdXN0b21lckVsZW1lbnQgID0+ICRDdXN0b21lckVsZW1lbnRDYywKICAgICAgICAgICAgICAgICAgICBDdXN0b21lcktleSAgICAgID0+ICRDdXN0b21lcktleUNjLAogICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyRXJyb3IgICAgPT4gJEN1c3RvbWVyRXJyb3JDYywKICAgICAgICAgICAgICAgICAgICBDdXN0b21lckVycm9yTXNnID0+ICRDdXN0b21lckVycm9yTXNnQ2MsCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJEaXNhYmxlZCA9PiAkQ3VzdG9tZXJEaXNhYmxlZENjLAogICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyUXVldWUgICAgPT4gJEN1c3RvbWVyUXVldWVDYywKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAkQWRkcmVzc2VzTGlzdHskQ3VzdG9tZXJFbGVtZW50Q2N9ID0gMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBteSBATXVsdGlwbGVDdXN0b21lckJjYzsKICAgIG15ICRDdXN0b21lcnNOdW1iZXJCY2MgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQ3VzdG9tZXJUaWNrZXRDb3VudGVyQmNjQ3VzdG9tZXInICkgfHwgMDsKCiAgICBpZiAoJEN1c3RvbWVyc051bWJlckJjYykgewogICAgICAgIG15ICRDdXN0b21lckNvdW50ZXJCY2MgPSAxOwogICAgICAgIGZvciBteSAkQ291bnQgKCAxIC4uLiAkQ3VzdG9tZXJzTnVtYmVyQmNjICkgewogICAgICAgICAgICBteSAkQ3VzdG9tZXJFbGVtZW50QmNjID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0JjY0N1c3RvbWVyVGlja2V0VGV4dF8nIC4gJENvdW50ICk7CiAgICAgICAgICAgIG15ICRDdXN0b21lcktleUJjYyAgICAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQmNjQ3VzdG9tZXJLZXlfJyAuICRDb3VudCApCiAgICAgICAgICAgICAgICB8fCAnJzsKICAgICAgICAgICAgbXkgJEN1c3RvbWVyUXVldWVCY2MgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQmNjQ3VzdG9tZXJRdWV1ZV8nIC4gJENvdW50ICkKICAgICAgICAgICAgICAgIHx8ICcnOwoKICAgICAgICAgICAgaWYgKCRDdXN0b21lckVsZW1lbnRCY2MpIHsKCiAgICAgICAgICAgICAgICBpZiAoICRHZXRQYXJhbXtCY2N9ICkgewogICAgICAgICAgICAgICAgICAgICRHZXRQYXJhbXtCY2N9IC49ICcsICcgLiAkQ3VzdG9tZXJFbGVtZW50QmNjOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJEdldFBhcmFte0JjY30gPSAkQ3VzdG9tZXJFbGVtZW50QmNjOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgY2hlY2sgZW1haWwgYWRkcmVzcwogICAgICAgICAgICAgICAgbXkgJEN1c3RvbWVyRXJyb3JNc2dCY2MgPSAnQ3VzdG9tZXJHZW5lcmljU2VydmVyRXJyb3JNc2cnOwogICAgICAgICAgICAgICAgbXkgJEN1c3RvbWVyRXJyb3JCY2MgICAgPSAnJzsKICAgICAgICAgICAgICAgIGZvciBteSAkRW1haWwgKCBNYWlsOjpBZGRyZXNzLT5wYXJzZSgkQ3VzdG9tZXJFbGVtZW50QmNjKSApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoICEkQ2hlY2tJdGVtT2JqZWN0LT5DaGVja0VtYWlsKCBBZGRyZXNzID0+ICRFbWFpbC0+YWRkcmVzcygpICkgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRDdXN0b21lckVycm9yTXNnQmNjID0gJENoZWNrSXRlbU9iamVjdC0+Q2hlY2tFcnJvclR5cGUoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLiAnU2VydmVyRXJyb3JNc2cnOwogICAgICAgICAgICAgICAgICAgICAgICAkQ3VzdG9tZXJFcnJvckJjYyA9ICdTZXJ2ZXJFcnJvcic7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgY2hlY2sgZm9yIGR1cGxpY2F0ZWQgZW50cmllcwogICAgICAgICAgICAgICAgaWYgKCBkZWZpbmVkICRBZGRyZXNzZXNMaXN0eyRDdXN0b21lckVsZW1lbnRCY2N9ICYmICRDdXN0b21lckVycm9yQmNjIGVxICcnICkgewogICAgICAgICAgICAgICAgICAgICRDdXN0b21lckVycm9yTXNnQmNjID0gJ0lzRHVwbGljYXRlZFNlcnZlckVycm9yTXNnJzsKICAgICAgICAgICAgICAgICAgICAkQ3VzdG9tZXJFcnJvckJjYyAgICA9ICdTZXJ2ZXJFcnJvcic7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbXkgJEN1c3RvbWVyRGlzYWJsZWRCY2MgPSAnJzsKICAgICAgICAgICAgICAgIG15ICRDb3VudEF1eEJjYyAgICAgICAgID0gJEN1c3RvbWVyQ291bnRlckJjYysrOwogICAgICAgICAgICAgICAgaWYgKCAkQ3VzdG9tZXJFcnJvckJjYyBuZSAnJyApIHsKICAgICAgICAgICAgICAgICAgICAkQ3VzdG9tZXJEaXNhYmxlZEJjYyA9ICdkaXNhYmxlZD0iZGlzYWJsZWQiJzsKICAgICAgICAgICAgICAgICAgICAkQ291bnRBdXhCY2MgICAgICAgICA9ICRDb3VudCAuICdFcnJvcic7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCAkQ3VzdG9tZXJRdWV1ZUJjYyBuZSAnJyApIHsKICAgICAgICAgICAgICAgICAgICAkQ3VzdG9tZXJRdWV1ZUJjYyA9ICRDb3VudDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBwdXNoIEBNdWx0aXBsZUN1c3RvbWVyQmNjLCB7CiAgICAgICAgICAgICAgICAgICAgQ291bnQgICAgICAgICAgICA9PiAkQ291bnRBdXhCY2MsCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJFbGVtZW50ICA9PiAkQ3VzdG9tZXJFbGVtZW50QmNjLAogICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyS2V5ICAgICAgPT4gJEN1c3RvbWVyS2V5QmNjLAogICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyRXJyb3IgICAgPT4gJEN1c3RvbWVyRXJyb3JCY2MsCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJFcnJvck1zZyA9PiAkQ3VzdG9tZXJFcnJvck1zZ0JjYywKICAgICAgICAgICAgICAgICAgICBDdXN0b21lckRpc2FibGVkID0+ICRDdXN0b21lckRpc2FibGVkQmNjLAogICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyUXVldWUgICAgPT4gJEN1c3RvbWVyUXVldWVCY2MsCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgJEFkZHJlc3Nlc0xpc3R7JEN1c3RvbWVyRWxlbWVudEJjY30gPSAxOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgICMgZ2V0IER5bmFtaWMgZmllbGRzIGZvcm0gUGFyYW1PYmplY3QKICAgIG15ICVEeW5hbWljRmllbGRWYWx1ZXM7CgogICAgIyBnZXQgYmFja2VuZCBvYmplY3QKICAgIG15ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkR5bmFtaWNGaWVsZDo6QmFja2VuZCcpOwoKICAgICMgZ2V0IHRoZSBkeW5hbWljIGZpZWxkcyBmb3IgdGhpcyBzY3JlZW4KICAgIG15ICREeW5hbWljRmllbGQgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6RHluYW1pY0ZpZWxkJyktPkR5bmFtaWNGaWVsZExpc3RHZXQoCiAgICAgICAgVmFsaWQgICAgICAgPT4gMSwKICAgICAgICBPYmplY3RUeXBlICA9PiBbICdUaWNrZXQnLCAnQXJ0aWNsZScgXSwKICAgICAgICBGaWVsZEZpbHRlciA9PiAkQ29uZmlnLT57RHluYW1pY0ZpZWxkfSB8fCB7fSwKICAgICk7CgogICAgIyBjeWNsZSB0cm91Z2ggdGhlIGFjdGl2YXRlZCBEeW5hbWljIEZpZWxkcyBmb3IgdGhpcyBzY3JlZW4KICAgIERZTkFNSUNGSUVMRDoKICAgIGZvciBteSAkRHluYW1pY0ZpZWxkQ29uZmlnICggQHskRHluYW1pY0ZpZWxkfSApIHsKICAgICAgICBuZXh0IERZTkFNSUNGSUVMRCBpZiAhSXNIYXNoUmVmV2l0aERhdGEoJER5bmFtaWNGaWVsZENvbmZpZyk7CgogICAgICAgICMgZXh0cmFjdCB0aGUgZHluYW1pYyBmaWVsZCB2YWx1ZSBmcm9tIHRoZSB3ZWIgcmVxdWVzdAogICAgICAgICREeW5hbWljRmllbGRWYWx1ZXN7ICREeW5hbWljRmllbGRDb25maWctPntOYW1lfSB9ID0KICAgICAgICAgICAgJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QtPkVkaXRGaWVsZFZhbHVlR2V0KAogICAgICAgICAgICBEeW5hbWljRmllbGRDb25maWcgPT4gJER5bmFtaWNGaWVsZENvbmZpZywKICAgICAgICAgICAgUGFyYW1PYmplY3QgICAgICAgID0+ICRQYXJhbU9iamVjdCwKICAgICAgICAgICAgTGF5b3V0T2JqZWN0ICAgICAgID0+ICRMYXlvdXRPYmplY3QsCiAgICAgICAgICAgICk7CiAgICB9CgogICAgIyBjb252ZXJ0IGR5bmFtaWMgZmllbGQgdmFsdWVzIGludG8gYSBzdHJ1Y3R1cmUgZm9yIEFDTHMKICAgIG15ICVEeW5hbWljRmllbGRBQ0xQYXJhbWV0ZXJzOwogICAgRFlOQU1JQ0ZJRUxEOgogICAgZm9yIG15ICREeW5hbWljRmllbGRJdGVtICggc29ydCBrZXlzICVEeW5hbWljRmllbGRWYWx1ZXMgKSB7CiAgICAgICAgbmV4dCBEWU5BTUlDRklFTEQgaWYgISREeW5hbWljRmllbGRJdGVtOwogICAgICAgIG5leHQgRFlOQU1JQ0ZJRUxEIGlmICFkZWZpbmVkICREeW5hbWljRmllbGRWYWx1ZXN7JER5bmFtaWNGaWVsZEl0ZW19OwoKICAgICAgICAkRHluYW1pY0ZpZWxkQUNMUGFyYW1ldGVyc3sgJ0R5bmFtaWNGaWVsZF8nIC4gJER5bmFtaWNGaWVsZEl0ZW0gfSA9ICREeW5hbWljRmllbGRWYWx1ZXN7JER5bmFtaWNGaWVsZEl0ZW19OwogICAgfQogICAgJEdldFBhcmFte0R5bmFtaWNGaWVsZH0gPSBcJUR5bmFtaWNGaWVsZEFDTFBhcmFtZXRlcnM7CgogICAgIyB0cmFuc2Zvcm0gcGVuZGluZyB0aW1lLCB0aW1lIHN0YW1wIGJhc2VkIG9uIHVzZXIgdGltZSB6b25lCiAgICBpZiAoCiAgICAgICAgZGVmaW5lZCAkR2V0UGFyYW17WWVhcn0KICAgICAgICAmJiBkZWZpbmVkICRHZXRQYXJhbXtNb250aH0KICAgICAgICAmJiBkZWZpbmVkICRHZXRQYXJhbXtEYXl9CiAgICAgICAgJiYgZGVmaW5lZCAkR2V0UGFyYW17SG91cn0KICAgICAgICAmJiBkZWZpbmVkICRHZXRQYXJhbXtNaW51dGV9CiAgICAgICAgKQogICAgewogICAgICAgICVHZXRQYXJhbSA9ICRMYXlvdXRPYmplY3QtPlRyYW5zZm9ybURhdGVTZWxlY3Rpb24oCiAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICApOwogICAgfQoKICAgICMgZ2V0IG5lZWRlZCBvYmplY3RzCiAgICBteSAkVXBsb2FkQ2FjaGVPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6V2ViOjpVcGxvYWRDYWNoZScpOwogICAgbXkgJE1haW5PYmplY3QgICAgICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06Ok1haW4nKTsKCiAgICAjIHNlbmQgZW1haWwKICAgIGlmICggJFNlbGYtPntTdWJhY3Rpb259IGVxICdTZW5kRW1haWwnIHx8ICRTZWxmLT57TG9hZGVkRm9ybURyYWZ0SUR9ICkgewoKICAgICAgICAjIGNoYWxsZW5nZSB0b2tlbiBjaGVjayBmb3Igd3JpdGUgYWN0aW9uCiAgICAgICAgaWYgKCAhJFNlbGYtPntMb2FkZWRGb3JtRHJhZnRJRH0gKSB7CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkNoYWxsZW5nZVRva2VuQ2hlY2soKTsKICAgICAgICB9CgogICAgICAgICMgZ2V0IHZhbGlkIHN0YXRlIGlkCiAgICAgICAgaWYgKCAhJEdldFBhcmFte1N0YXRlSUR9ICkgewogICAgICAgICAgICBteSAlVGlja2V0ID0gJFRpY2tldE9iamVjdC0+VGlja2V0R2V0KAogICAgICAgICAgICAgICAgVGlja2V0SUQgPT4gJFNlbGYtPntUaWNrZXRJRH0sCiAgICAgICAgICAgICAgICBVc2VySUQgICA9PiAxLAogICAgICAgICAgICApOwogICAgICAgICAgICAkR2V0UGFyYW17U3RhdGVJRH0gPSAkVGlja2V0e1N0YXRlSUR9OwogICAgICAgIH0KCiAgICAgICAgbXkgJVN0YXRlRGF0YSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpTdGF0ZScpLT5TdGF0ZUdldCggSUQgPT4gJEdldFBhcmFte1N0YXRlSUR9ICk7CgogICAgICAgIG15ICVFcnJvcjsKCiAgICAgICAgIyBnZXQgY2hlY2sgaXRlbSBvYmplY3QKICAgICAgICBteSAkQ2hlY2tJdGVtT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNoZWNrSXRlbScpOwoKICAgICAgICAjIGNoZWNrIHNvbWUgdmFsdWVzCiAgICAgICAgTElORToKICAgICAgICBmb3IgbXkgJExpbmUgKHF3KFRvIENjIEJjYykpIHsKICAgICAgICAgICAgbmV4dCBMSU5FIGlmICEkR2V0UGFyYW17JExpbmV9OwogICAgICAgICAgICBmb3IgbXkgJEVtYWlsICggTWFpbDo6QWRkcmVzcy0+cGFyc2UoICRHZXRQYXJhbXskTGluZX0gKSApIHsKICAgICAgICAgICAgICAgIGlmICggISRDaGVja0l0ZW1PYmplY3QtPkNoZWNrRW1haWwoIEFkZHJlc3MgPT4gJEVtYWlsLT5hZGRyZXNzKCkgKSApIHsKICAgICAgICAgICAgICAgICAgICAkRXJyb3J7ICRMaW5lIC4gJ0Vycm9yVHlwZScgfSA9ICRMaW5lIC4gJENoZWNrSXRlbU9iamVjdC0+Q2hlY2tFcnJvclR5cGUoKSAuICdTZXJ2ZXJFcnJvck1zZyc7CiAgICAgICAgICAgICAgICAgICAgJEVycm9yeyAkTGluZSAuICdJbnZhbGlkJyB9ICAgPSAnU2VydmVyRXJyb3InOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbXkgJElzTG9jYWwgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6U3lzdGVtQWRkcmVzcycpLT5TeXN0ZW1BZGRyZXNzSXNMb2NhbEFkZHJlc3MoCiAgICAgICAgICAgICAgICAgICAgQWRkcmVzcyA9PiAkRW1haWwtPmFkZHJlc3MoKQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGlmICgkSXNMb2NhbCkgewogICAgICAgICAgICAgICAgICAgICRFcnJvcnsgJExpbmUgLiAnSXNMb2NhbEFkZHJlc3MnIH0gPSAnU2VydmVyRXJyb3InOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoICRFcnJvcntUb0lzTG9jYWxBZGRyZXNzfSApIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdUb0lzTG9jYWxBZGRyZXNzU2VydmVyRXJyb3JNc2cnLAogICAgICAgICAgICAgICAgRGF0YSA9PiBcJUdldFBhcmFtLAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgaWYgKCAkRXJyb3J7Q2NJc0xvY2FsQWRkcmVzc30gKSB7CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgTmFtZSA9PiAnQ2NJc0xvY2FsQWRkcmVzc1NlcnZlckVycm9yTXNnJywKICAgICAgICAgICAgICAgIERhdGEgPT4gXCVHZXRQYXJhbSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIGlmICggJEVycm9ye0JjY0lzTG9jYWxBZGRyZXNzfSApIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdCY2NJc0xvY2FsQWRkcmVzc1NlcnZlckVycm9yTXNnJywKICAgICAgICAgICAgICAgIERhdGEgPT4gXCVHZXRQYXJhbSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgZ2V0IGFsbCBhdHRhY2htZW50cyBtZXRhIGRhdGEKICAgICAgICBteSBAQXR0YWNobWVudHMgPSAkVXBsb2FkQ2FjaGVPYmplY3QtPkZvcm1JREdldEFsbEZpbGVzTWV0YSgKICAgICAgICAgICAgRm9ybUlEID0+ICRTZWxmLT57Rm9ybUlEfSwKICAgICAgICApOwoKICAgICAgICAjIEdldCBhbmQgdmFsaWRhdGUgZHJhZnQgYWN0aW9uLgogICAgICAgIG15ICRGb3JtRHJhZnRBY3Rpb24gPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnRm9ybURyYWZ0QWN0aW9uJyApOwogICAgICAgIGlmICggJEZvcm1EcmFmdEFjdGlvbiAmJiAhJENvbmZpZy0+e0Zvcm1EcmFmdH0gKSB7CiAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5FcnJvclNjcmVlbigKICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gVHJhbnNsYXRhYmxlKCdGb3JtRHJhZnQgZnVuY3Rpb25hbGl0eSBkaXNhYmxlZCEnKSwKICAgICAgICAgICAgICAgIENvbW1lbnQgPT4gVHJhbnNsYXRhYmxlKCdQbGVhc2UgY29udGFjdCB0aGUgYWRtaW5pc3RyYXRvci4nKSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIG15ICVGb3JtRHJhZnRSZXNwb25zZTsKCiAgICAgICAgIyBDaGVjayBkcmFmdCBuYW1lLgogICAgICAgIGlmICgKICAgICAgICAgICAgJEZvcm1EcmFmdEFjdGlvbgogICAgICAgICAgICAmJiAoICRGb3JtRHJhZnRBY3Rpb24gZXEgJ0FkZCcgfHwgJEZvcm1EcmFmdEFjdGlvbiBlcSAnVXBkYXRlJyApCiAgICAgICAgICAgICkKICAgICAgICB7CiAgICAgICAgICAgIG15ICRUaXRsZSA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdGb3JtRHJhZnRUaXRsZScgKTsKCiAgICAgICAgICAgICMgQSBkcmFmdCBuYW1lIGlzIHJlcXVpcmVkLgogICAgICAgICAgICBpZiAoICEkVGl0bGUgKSB7CgogICAgICAgICAgICAgICAgJUZvcm1EcmFmdFJlc3BvbnNlID0gKAogICAgICAgICAgICAgICAgICAgIFN1Y2Nlc3MgICAgICA9PiAwLAogICAgICAgICAgICAgICAgICAgIEVycm9yTWVzc2FnZSA9PiAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Okxhbmd1YWdlJyktPlRyYW5zbGF0ZSgiRHJhZnQgbmFtZSBpcyByZXF1aXJlZCEiKSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgQ2hvc2VuIGRyYWZ0IG5hbWUgbXVzdCBiZSB1bmlxdWUuCiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgbXkgJEZvcm1EcmFmdExpc3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Rm9ybURyYWZ0JyktPkZvcm1EcmFmdExpc3RHZXQoCiAgICAgICAgICAgICAgICAgICAgT2JqZWN0VHlwZSA9PiAnVGlja2V0JywKICAgICAgICAgICAgICAgICAgICBPYmplY3RJRCAgID0+ICRTZWxmLT57VGlja2V0SUR9LAogICAgICAgICAgICAgICAgICAgIEFjdGlvbiAgICAgPT4gJFNlbGYtPntBY3Rpb259LAogICAgICAgICAgICAgICAgICAgIFVzZXJJRCAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIERSQUZUOgogICAgICAgICAgICAgICAgZm9yIG15ICRGb3JtRHJhZnQgKCBAeyRGb3JtRHJhZnRMaXN0fSApIHsKCiAgICAgICAgICAgICAgICAgICAgIyBObyBleGlzdGluZyBkcmFmdCB3aXRoIHNhbWUgbmFtZS4KICAgICAgICAgICAgICAgICAgICBuZXh0IERSQUZUIGlmICRUaXRsZSBuZSAkRm9ybURyYWZ0LT57VGl0bGV9OwoKICAgICAgICAgICAgICAgICAgICAjIFNhbWUgbmFtZSBmb3IgdXBkYXRlIG9uIGV4aXN0aW5nIGRyYWZ0LgogICAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAgICAgJEdldFBhcmFte0Zvcm1EcmFmdElEfQogICAgICAgICAgICAgICAgICAgICAgICAmJiAkRm9ybURyYWZ0QWN0aW9uIGVxICdVcGRhdGUnCiAgICAgICAgICAgICAgICAgICAgICAgICYmICRHZXRQYXJhbXtGb3JtRHJhZnRJRH0gZXEgJEZvcm1EcmFmdC0+e0Zvcm1EcmFmdElEfQogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBuZXh0IERSQUZUOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgIyBBbm90aGVyIGRyYWZ0IHdpdGggdGhlIGNob3NlbiBuYW1lIGFscmVhZHkgZXhpc3RzLgogICAgICAgICAgICAgICAgICAgICVGb3JtRHJhZnRSZXNwb25zZSA9ICgKICAgICAgICAgICAgICAgICAgICAgICAgU3VjY2VzcyAgICAgID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIEVycm9yTWVzc2FnZSA9PiAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Okxhbmd1YWdlJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0+VHJhbnNsYXRlKCAiRm9ybURyYWZ0IG5hbWUgJXMgaXMgYWxyZWFkeSBpbiB1c2UhIiwgJFRpdGxlICksCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICBsYXN0IERSQUZUOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIFBlcmZvcm0gZHJhZnQgYWN0aW9uIGluc3RlYWQgb2Ygc2F2aW5nIGZvcm0gZGF0YSBpbiB0aWNrZXQvYXJ0aWNsZS4KICAgICAgICBpZiAoICRGb3JtRHJhZnRBY3Rpb24gJiYgISVGb3JtRHJhZnRSZXNwb25zZSApIHsKCiAgICAgICAgICAgICMgUmVzZXQgRm9ybURyYWZ0SUQgdG8gcHJldmVudCB1cGRhdGluZyBleGlzdGluZyBkcmFmdC4KICAgICAgICAgICAgaWYgKCAkRm9ybURyYWZ0QWN0aW9uIGVxICdBZGQnICYmICRHZXRQYXJhbXtGb3JtRHJhZnRJRH0gKSB7CiAgICAgICAgICAgICAgICAkUGFyYW1PYmplY3QtPntRdWVyeX0tPnBhcmFtKAogICAgICAgICAgICAgICAgICAgIC1uYW1lICA9PiAnRm9ybURyYWZ0SUQnLAogICAgICAgICAgICAgICAgICAgIC12YWx1ZSA9PiAnJywKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG15ICRGb3JtRHJhZnRBY3Rpb25PazsKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgJEZvcm1EcmFmdEFjdGlvbiBlcSAnQWRkJwogICAgICAgICAgICAgICAgfHwKICAgICAgICAgICAgICAgICggJEZvcm1EcmFmdEFjdGlvbiBlcSAnVXBkYXRlJyAmJiAkR2V0UGFyYW17Rm9ybURyYWZ0SUR9ICkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJEZvcm1EcmFmdEFjdGlvbk9rID0gJFBhcmFtT2JqZWN0LT5TYXZlRm9ybURyYWZ0KAogICAgICAgICAgICAgICAgICAgIFVzZXJJRCAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICAgICAgICAgIE9iamVjdFR5cGUgPT4gJ1RpY2tldCcsCiAgICAgICAgICAgICAgICAgICAgT2JqZWN0SUQgICA9PiAkU2VsZi0+e1RpY2tldElEfSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzaWYgKCAkRm9ybURyYWZ0QWN0aW9uIGVxICdEZWxldGUnICYmICRHZXRQYXJhbXtGb3JtRHJhZnRJRH0gKSB7CiAgICAgICAgICAgICAgICAkRm9ybURyYWZ0QWN0aW9uT2sgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Rm9ybURyYWZ0JyktPkZvcm1EcmFmdERlbGV0ZSgKICAgICAgICAgICAgICAgICAgICBGb3JtRHJhZnRJRCA9PiAkR2V0UGFyYW17Rm9ybURyYWZ0SUR9LAogICAgICAgICAgICAgICAgICAgIFVzZXJJRCAgICAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICgkRm9ybURyYWZ0QWN0aW9uT2spIHsKICAgICAgICAgICAgICAgICRGb3JtRHJhZnRSZXNwb25zZXtTdWNjZXNzfSA9IDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAlRm9ybURyYWZ0UmVzcG9uc2UgPSAoCiAgICAgICAgICAgICAgICAgICAgU3VjY2VzcyAgICAgID0+IDAsCiAgICAgICAgICAgICAgICAgICAgRXJyb3JNZXNzYWdlID0+ICdDb3VsZCBub3QgcGVyZm9ybSByZXF1ZXN0ZWQgZHJhZnQgYWN0aW9uIScsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoJUZvcm1EcmFmdFJlc3BvbnNlKSB7CgogICAgICAgICAgICAjIGJ1aWxkIEpTT04gb3V0cHV0CiAgICAgICAgICAgIG15ICRKU09OID0gJExheW91dE9iamVjdC0+SlNPTkVuY29kZSgKICAgICAgICAgICAgICAgIERhdGEgPT4gXCVGb3JtRHJhZnRSZXNwb25zZSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgc2VuZCBKU09OIHJlc3BvbnNlCiAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5BdHRhY2htZW50KAogICAgICAgICAgICAgICAgQ29udGVudFR5cGUgPT4gJ2FwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9JyAuICRMYXlvdXRPYmplY3QtPntDaGFyc2V0fSwKICAgICAgICAgICAgICAgIENvbnRlbnQgICAgID0+ICRKU09OLAogICAgICAgICAgICAgICAgVHlwZSAgICAgICAgPT4gJ2lubGluZScsCiAgICAgICAgICAgICAgICBOb0NhY2hlICAgICA9PiAxLAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBjaGVjayBwZW5kaW5nIGRhdGUKICAgICAgICBpZiAoICRTdGF0ZURhdGF7VHlwZU5hbWV9ICYmICRTdGF0ZURhdGF7VHlwZU5hbWV9ID1+IC9ecGVuZGluZy9pICkgewoKICAgICAgICAgICAgIyBjb252ZXJ0IHBlbmRpbmcgZGF0ZSB0byBhIGRhdGV0aW1lIG9iamVjdAogICAgICAgICAgICBteSAkUGVuZGluZ0RhdGVUaW1lT2JqZWN0ID0gJEtlcm5lbDo6T00tPkNyZWF0ZSgKICAgICAgICAgICAgICAgICdLZXJuZWw6OlN5c3RlbTo6RGF0ZVRpbWUnLAogICAgICAgICAgICAgICAgT2JqZWN0UGFyYW1zID0+IHsKICAgICAgICAgICAgICAgICAgICAlR2V0UGFyYW0sCiAgICAgICAgICAgICAgICAgICAgU2Vjb25kID0+IDAsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICApOwoKICAgICAgICAgICAgIyBnZXQgY3VycmVudCBzeXN0ZW0gZXBvY2gKICAgICAgICAgICAgbXkgJEN1clN5c3RlbURhdGVUaW1lT2JqZWN0ID0gJEtlcm5lbDo6T00tPkNyZWF0ZSgnS2VybmVsOjpTeXN0ZW06OkRhdGVUaW1lJyk7CgogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAoICEkUGVuZGluZ0RhdGVUaW1lT2JqZWN0IHx8ICRQZW5kaW5nRGF0ZVRpbWVPYmplY3QgPCAkQ3VyU3lzdGVtRGF0ZVRpbWVPYmplY3QgKQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkRXJyb3J7RGF0ZUludmFsaWR9ID0gJ1NlcnZlckVycm9yJzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBjaGVjayBpZiBhdCBsZWFzdCBvbmUgcmVjaXBpZW50IGhhcyBiZWVuIGNob3NlbgogICAgICAgIGlmICggISRHZXRQYXJhbXtUb30gKSB7CiAgICAgICAgICAgICRFcnJvcnsnVG9JbnZhbGlkJ30gPSAnU2VydmVyRXJyb3InOwogICAgICAgIH0KCiAgICAgICAgIyBjaGVjayBzb21lIHZhbHVlcwogICAgICAgIExJTkU6CiAgICAgICAgZm9yIG15ICRMaW5lIChxdyhUbyBDYyBCY2MpKSB7CiAgICAgICAgICAgIG5leHQgTElORSBpZiAhJEdldFBhcmFteyRMaW5lfTsKICAgICAgICAgICAgZm9yIG15ICRFbWFpbCAoIE1haWw6OkFkZHJlc3MtPnBhcnNlKCAkR2V0UGFyYW17JExpbmV9ICkgKSB7CiAgICAgICAgICAgICAgICBpZiAoICEkQ2hlY2tJdGVtT2JqZWN0LT5DaGVja0VtYWlsKCBBZGRyZXNzID0+ICRFbWFpbC0+YWRkcmVzcygpICkgKSB7CiAgICAgICAgICAgICAgICAgICAgJEVycm9yeyAkTGluZSAuICdJbnZhbGlkJyB9ID0gJ1NlcnZlckVycm9yJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBjaGVjayBzdWJqZWN0CiAgICAgICAgaWYgKCAhJEdldFBhcmFte1N1YmplY3R9ICkgewogICAgICAgICAgICAkRXJyb3J7U3ViamVjdEludmFsaWR9ID0gJyBTZXJ2ZXJFcnJvcic7CiAgICAgICAgfQoKICAgICAgICAjIGNoZWNrIGJvZHkKICAgICAgICBpZiAoICEkR2V0UGFyYW17Qm9keX0gKSB7CiAgICAgICAgICAgICRFcnJvcntCb2R5SW52YWxpZH0gPSAnIFNlcnZlckVycm9yJzsKICAgICAgICB9CgogICAgICAgICMgY2hlY2sgdGltZSB1bml0cwogICAgICAgIGlmICgKICAgICAgICAgICAgJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpBY2NvdW50VGltZScpCiAgICAgICAgICAgICYmICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpGcm9udGVuZDo6TmVlZEFjY291bnRlZFRpbWUnKQogICAgICAgICAgICAmJiAkR2V0UGFyYW17VGltZVVuaXRzfSBlcSAnJwogICAgICAgICAgICApCiAgICAgICAgewogICAgICAgICAgICAkRXJyb3J7VGltZVVuaXRzSW52YWxpZH0gPSAnU2VydmVyRXJyb3InOwogICAgICAgIH0KCiAgICAgICAgIyBwcmVwYXJlIHN1YmplY3QKICAgICAgICBteSAkVG4gPSAkVGlja2V0T2JqZWN0LT5UaWNrZXROdW1iZXJMb29rdXAoIFRpY2tldElEID0+ICRTZWxmLT57VGlja2V0SUR9ICk7CiAgICAgICAgJEdldFBhcmFte1N1YmplY3R9ID0gJFRpY2tldE9iamVjdC0+VGlja2V0U3ViamVjdEJ1aWxkKAogICAgICAgICAgICBUaWNrZXROdW1iZXIgPT4gJFRuLAogICAgICAgICAgICBTdWJqZWN0ICAgICAgPT4gJEdldFBhcmFte1N1YmplY3R9IHx8ICcnLAogICAgICAgICk7CgogICAgICAgIG15ICVBcnRpY2xlUGFyYW07CgogICAgICAgICMgcnVuIGNvbXBvc2UgbW9kdWxlcwogICAgICAgIGlmICggcmVmICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpGcm9udGVuZDo6QXJ0aWNsZUNvbXBvc2VNb2R1bGUnKSBlcSAnSEFTSCcgKSB7CgogICAgICAgICAgICAjIHVzZSB0aWNrZXQgUXVldWVJRCBpbiBjb21wb3NlIG1vZHVsZXMKICAgICAgICAgICAgJEdldFBhcmFte1F1ZXVlSUR9ID0gJFRpY2tldHtRdWV1ZUlEfTsKCiAgICAgICAgICAgIG15ICVKb2JzID0gJXsgJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpBcnRpY2xlQ29tcG9zZU1vZHVsZScpIH07CiAgICAgICAgICAgIGZvciBteSAkSm9iICggc29ydCBrZXlzICVKb2JzICkgewoKICAgICAgICAgICAgICAgICMgbG9hZCBtb2R1bGUKICAgICAgICAgICAgICAgIGlmICggISRNYWluT2JqZWN0LT5SZXF1aXJlKCAkSm9ic3skSm9ifS0+e01vZHVsZX0gKSApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbXkgJE9iamVjdCA9ICRKb2JzeyRKb2J9LT57TW9kdWxlfS0+bmV3KCAleyRTZWxmfSwgRGVidWcgPT4gJFNlbGYtPntEZWJ1Z30gKTsKCiAgICAgICAgICAgICAgICBteSAkTXVsdGlwbGU7CgogICAgICAgICAgICAgICAgIyBnZXQgcGFyYW1zCiAgICAgICAgICAgICAgICBQQVJBTUVURVI6CiAgICAgICAgICAgICAgICBmb3IgbXkgJFBhcmFtZXRlciAoICRPYmplY3QtPk9wdGlvbiggJUdldFBhcmFtLCBDb25maWcgPT4gJEpvYnN7JEpvYn0gKSApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoICRKb2JzeyRKb2J9LT57UGFyYW1UeXBlfSAmJiAkSm9ic3skSm9ifS0+e1BhcmFtVHlwZX0gbmUgJ1NpbmdsZScgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIEB7ICRHZXRQYXJhbXskUGFyYW1ldGVyfSB9ID0gJFBhcmFtT2JqZWN0LT5HZXRBcnJheSggUGFyYW0gPT4gJFBhcmFtZXRlciApOwogICAgICAgICAgICAgICAgICAgICAgICAkTXVsdGlwbGUgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBuZXh0IFBBUkFNRVRFUjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICRHZXRQYXJhbXskUGFyYW1ldGVyfSA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICRQYXJhbWV0ZXIgKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIHJ1biBtb2R1bGUKICAgICAgICAgICAgICAgICRPYmplY3QtPlJ1bigKICAgICAgICAgICAgICAgICAgICAlR2V0UGFyYW0sCiAgICAgICAgICAgICAgICAgICAgU3RvcmVOZXcgPT4gMSwKICAgICAgICAgICAgICAgICAgICBDb25maWcgICA9PiAkSm9ic3skSm9ifQogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAjIGdldCBvcHRpb25zIHRoYXQgaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGUgc2VsZWN0aW9uCiAgICAgICAgICAgICAgICAjIGFuZCBhZGQgdGhlbSBiYWNrIHRvIHRoZSBzZWxlY3Rpb24gc28gdGhhdCB0aGUgc3VibWl0CiAgICAgICAgICAgICAgICAjIHdpbGwgY29udGFpbiBvcHRpb25zIHRoYXQgd2VyZSBoaWRkZW4gZnJvbSB0aGUgYWdlbnQKICAgICAgICAgICAgICAgIG15ICRLZXkgPSAkT2JqZWN0LT5PcHRpb24oICVHZXRQYXJhbSwgQ29uZmlnID0+ICRKb2JzeyRKb2J9ICk7CgogICAgICAgICAgICAgICAgaWYgKCAkT2JqZWN0LT5jYW4oJ0dldE9wdGlvbnNUb1JlbW92ZUFKQVgnKSApIHsKICAgICAgICAgICAgICAgICAgICBteSBAUmVtb3ZlZE9wdGlvbnMgPSAkT2JqZWN0LT5HZXRPcHRpb25zVG9SZW1vdmVBSkFYKCVHZXRQYXJhbSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKEBSZW1vdmVkT3B0aW9ucykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJE11bHRpcGxlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgbXkgJFJlbW92ZWRPcHRpb24gKEBSZW1vdmVkT3B0aW9ucykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2ggQHsgJEdldFBhcmFteyRLZXl9IH0sICRSZW1vdmVkT3B0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEdldFBhcmFteyRLZXl9ID0gc2hpZnQgQFJlbW92ZWRPcHRpb25zOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgdGlja2V0IHBhcmFtcwogICAgICAgICAgICAgICAgJUFydGljbGVQYXJhbSA9ICgKICAgICAgICAgICAgICAgICAgICAlQXJ0aWNsZVBhcmFtLAogICAgICAgICAgICAgICAgICAgICRPYmplY3QtPkFydGljbGVPcHRpb24oICVHZXRQYXJhbSwgJUFydGljbGVQYXJhbSwgQ29uZmlnID0+ICRKb2JzeyRKb2J9ICksCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICMgZ2V0IGVycm9ycwogICAgICAgICAgICAgICAgJUVycm9yID0gKAogICAgICAgICAgICAgICAgICAgICVFcnJvciwKICAgICAgICAgICAgICAgICAgICAkT2JqZWN0LT5FcnJvciggJUdldFBhcmFtLCBDb25maWcgPT4gJEpvYnN7JEpvYn0gKSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgY3JlYXRlIGh0bWwgc3RyaW5ncyBmb3IgYWxsIGR5bmFtaWMgZmllbGRzCiAgICAgICAgbXkgJUR5bmFtaWNGaWVsZEhUTUw7CgogICAgICAgICMgY3ljbGUgdHJvdWdoIHRoZSBhY3RpdmF0ZWQgRHluYW1pYyBGaWVsZHMgZm9yIHRoaXMgc2NyZWVuCiAgICAgICAgRFlOQU1JQ0ZJRUxEOgogICAgICAgIGZvciBteSAkRHluYW1pY0ZpZWxkQ29uZmlnICggQHskRHluYW1pY0ZpZWxkfSApIHsKICAgICAgICAgICAgbmV4dCBEWU5BTUlDRklFTEQgaWYgIUlzSGFzaFJlZldpdGhEYXRhKCREeW5hbWljRmllbGRDb25maWcpOwoKICAgICAgICAgICAgbXkgJFBvc3NpYmxlVmFsdWVzRmlsdGVyOwoKICAgICAgICAgICAgbXkgJElzQUNMUmVkdWNpYmxlID0gJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QtPkhhc0JlaGF2aW9yKAogICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRDb25maWcsCiAgICAgICAgICAgICAgICBCZWhhdmlvciAgICAgICAgICAgPT4gJ0lzQUNMUmVkdWNpYmxlJywKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGlmICgkSXNBQ0xSZWR1Y2libGUpIHsKCiAgICAgICAgICAgICAgICAjIGdldCBQb3NzaWJsZVZhbHVlcwogICAgICAgICAgICAgICAgbXkgJFBvc3NpYmxlVmFsdWVzID0gJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QtPlBvc3NpYmxlVmFsdWVzR2V0KAogICAgICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZENvbmZpZyA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnLAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAjIGNoZWNrIGlmIGZpZWxkIGhhcyBQb3NzaWJsZVZhbHVlcyBwcm9wZXJ0eSBpbiBpdHMgY29uZmlndXJhdGlvbgogICAgICAgICAgICAgICAgaWYgKCBJc0hhc2hSZWZXaXRoRGF0YSgkUG9zc2libGVWYWx1ZXMpICkgewoKICAgICAgICAgICAgICAgICAgICAjIGNvbnZlcnQgcG9zc2libGUgdmFsdWVzIGtleSA9PiB2YWx1ZSB0byBrZXkgPT4ga2V5IGZvciBBQ0xzIHVzaW5nIGEgSGFzaCBzbGljZQogICAgICAgICAgICAgICAgICAgIG15ICVBY2xEYXRhID0gJXskUG9zc2libGVWYWx1ZXN9OwogICAgICAgICAgICAgICAgICAgIEBBY2xEYXRheyBrZXlzICVBY2xEYXRhIH0gPSBrZXlzICVBY2xEYXRhOwoKICAgICAgICAgICAgICAgICAgICAjIHNldCBwb3NzaWJsZSB2YWx1ZXMgZmlsdGVyIGZyb20gQUNMcwogICAgICAgICAgICAgICAgICAgIG15ICRBQ0wgPSAkVGlja2V0T2JqZWN0LT5UaWNrZXRBY2woCiAgICAgICAgICAgICAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgICAgICAgICAgICAgQWN0aW9uICAgICAgICA9PiAkU2VsZi0+e0FjdGlvbn0sCiAgICAgICAgICAgICAgICAgICAgICAgIFRpY2tldElEICAgICAgPT4gJFNlbGYtPntUaWNrZXRJRH0sCiAgICAgICAgICAgICAgICAgICAgICAgIFJldHVyblR5cGUgICAgPT4gJ1RpY2tldCcsCiAgICAgICAgICAgICAgICAgICAgICAgIFJldHVyblN1YlR5cGUgPT4gJ0R5bmFtaWNGaWVsZF8nIC4gJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9LAogICAgICAgICAgICAgICAgICAgICAgICBEYXRhICAgICAgICAgID0+IFwlQWNsRGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgVXNlcklEICAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICBpZiAoJEFDTCkgewogICAgICAgICAgICAgICAgICAgICAgICBteSAlRmlsdGVyID0gJFRpY2tldE9iamVjdC0+VGlja2V0QWNsRGF0YSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgIyBjb252ZXJ0IEZpbGVyIGtleSA9PiBrZXkgYmFjayB0byBrZXkgPT4gdmFsdWUgdXNpbmcgbWFwCiAgICAgICAgICAgICAgICAgICAgICAgICV7JFBvc3NpYmxlVmFsdWVzRmlsdGVyfSA9IG1hcCB7ICRfID0+ICRQb3NzaWJsZVZhbHVlcy0+eyRffSB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXlzICVGaWx0ZXI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBteSAkVmFsaWRhdGlvblJlc3VsdCA9ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0LT5FZGl0RmllbGRWYWx1ZVZhbGlkYXRlKAogICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnICAgPT4gJER5bmFtaWNGaWVsZENvbmZpZywKICAgICAgICAgICAgICAgIFBvc3NpYmxlVmFsdWVzRmlsdGVyID0+ICRQb3NzaWJsZVZhbHVlc0ZpbHRlciwKICAgICAgICAgICAgICAgIFBhcmFtT2JqZWN0ICAgICAgICAgID0+ICRQYXJhbU9iamVjdCwKICAgICAgICAgICAgICAgIE1hbmRhdG9yeSA9PgogICAgICAgICAgICAgICAgICAgICRDb25maWctPntEeW5hbWljRmllbGR9LT57ICREeW5hbWljRmllbGRDb25maWctPntOYW1lfSB9ID09IDIsCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBpZiAoICFJc0hhc2hSZWZXaXRoRGF0YSgkVmFsaWRhdGlvblJlc3VsdCkgKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+RXJyb3JTY3JlZW4oCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgICdDb3VsZCBub3QgcGVyZm9ybSB2YWxpZGF0aW9uIG9uIGZpZWxkICVzIScsCiAgICAgICAgICAgICAgICAgICAgICAgICREeW5hbWljRmllbGRDb25maWctPntMYWJlbH0sCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICBDb21tZW50ID0+IFRyYW5zbGF0YWJsZSgnUGxlYXNlIGNvbnRhY3QgdGhlIGFkbWluaXN0cmF0b3IuJyksCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIHByb3BhZ2F0ZSB2YWxpZGF0aW9uIGVycm9yIHRvIHRoZSBFcnJvciB2YXJpYWJsZSB0byBiZSBkZXRlY3RlZCBieSB0aGUgZnJvbnRlbmQKICAgICAgICAgICAgaWYgKCAkVmFsaWRhdGlvblJlc3VsdC0+e1NlcnZlckVycm9yfSApIHsKICAgICAgICAgICAgICAgICRFcnJvcnsgJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9IH0gPSAnIFNlcnZlckVycm9yJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBnZXQgZmllbGQgaHRtbAogICAgICAgICAgICAkRHluYW1pY0ZpZWxkSFRNTHsgJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9IH0gPQogICAgICAgICAgICAgICAgJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QtPkVkaXRGaWVsZFJlbmRlcigKICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZENvbmZpZyAgID0+ICREeW5hbWljRmllbGRDb25maWcsCiAgICAgICAgICAgICAgICBQb3NzaWJsZVZhbHVlc0ZpbHRlciA9PiAkUG9zc2libGVWYWx1ZXNGaWx0ZXIsCiAgICAgICAgICAgICAgICBNYW5kYXRvcnkgPT4KICAgICAgICAgICAgICAgICAgICAkQ29uZmlnLT57RHluYW1pY0ZpZWxkfS0+eyAkRHluYW1pY0ZpZWxkQ29uZmlnLT57TmFtZX0gfSA9PSAyLAogICAgICAgICAgICAgICAgU2VydmVyRXJyb3IgID0+ICRWYWxpZGF0aW9uUmVzdWx0LT57U2VydmVyRXJyb3J9ICB8fCAnJywKICAgICAgICAgICAgICAgIEVycm9yTWVzc2FnZSA9PiAkVmFsaWRhdGlvblJlc3VsdC0+e0Vycm9yTWVzc2FnZX0gfHwgJycsCiAgICAgICAgICAgICAgICBMYXlvdXRPYmplY3QgPT4gJExheW91dE9iamVjdCwKICAgICAgICAgICAgICAgIFBhcmFtT2JqZWN0ICA9PiAkUGFyYW1PYmplY3QsCiAgICAgICAgICAgICAgICBBSkFYVXBkYXRlICAgPT4gMSwKICAgICAgICAgICAgICAgIFVwZGF0YWJsZUZpZWxkcyA9PiAkU2VsZi0+X0dldEZpZWxkc1RvVXBkYXRlKCksCiAgICAgICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgaWYgKCAkU2VsZi0+e0xvYWRlZEZvcm1EcmFmdElEfSApIHsKCiAgICAgICAgICAgICMgTWFrZSBzdXJlIHdlIGRvbid0IHNhdmUgZm9ybSBpZiBhIGRyYWZ0IHdhcyBsb2FkZWQuCiAgICAgICAgICAgICVFcnJvciA9ICggTG9hZGVkRm9ybURyYWZ0ID0+IDEgKTsKICAgICAgICB9CgogICAgICAgICMgY2hlY2sgaWYgdGhlcmUgaXMgYW4gZXJyb3IKICAgICAgICBpZiAoJUVycm9yKSB7CgogICAgICAgICAgICBteSAkT3V0cHV0ID0gJExheW91dE9iamVjdC0+SGVhZGVyKAogICAgICAgICAgICAgICAgVmFsdWUgICAgID0+ICRUaWNrZXR7VGlja2V0TnVtYmVyfSwKICAgICAgICAgICAgICAgIFR5cGUgICAgICA9PiAnU21hbGwnLAogICAgICAgICAgICAgICAgQm9keUNsYXNzID0+ICdQb3B1cCcsCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAjIFdoZW4gYSBkcmFmdCBpcyBsb2FkZWQsIGluZm9ybSBhIHVzZXIgdGhhdCBhcnRpY2xlIHN1YmplY3Qgd2lsbCBiZSBlbXB0eQogICAgICAgICAgICAjIGlmIGNvbnRhaW5zIG9ubHkgdGhlIHRpY2tldCBob29rIChpZiBub3RoaW5nIGlzIG1vZGlmaWVkKS4KICAgICAgICAgICAgaWYgKCAkRXJyb3J7TG9hZGVkRm9ybURyYWZ0fSApIHsKICAgICAgICAgICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Tm90aWZ5KAogICAgICAgICAgICAgICAgICAgIERhdGEgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKAogICAgICAgICAgICAgICAgICAgICAgICAnQXJ0aWNsZSBzdWJqZWN0IHdpbGwgYmUgZW1wdHkgaWYgdGhlIHN1YmplY3QgY29udGFpbnMgb25seSB0aGUgdGlja2V0IGhvb2shJwogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkR2V0UGFyYW17U3RhbmRhcmRSZXNwb25zZX0gPSAkR2V0UGFyYW17Qm9keX07CiAgICAgICAgICAgICRPdXRwdXQgLj0gJFNlbGYtPl9NYXNrKAogICAgICAgICAgICAgICAgVGlja2V0SUQgICA9PiAkU2VsZi0+e1RpY2tldElEfSwKICAgICAgICAgICAgICAgIE5leHRTdGF0ZXMgPT4gJFNlbGYtPl9HZXROZXh0U3RhdGVzKAogICAgICAgICAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICBSZXNwb25zZUZvcm1hdCAgICAgID0+ICRMYXlvdXRPYmplY3QtPkFzY2lpMkh0bWwoIFRleHQgPT4gJEdldFBhcmFte0JvZHl9ICksCiAgICAgICAgICAgICAgICBFcnJvcnMgICAgICAgICAgICAgID0+IFwlRXJyb3IsCiAgICAgICAgICAgICAgICBNdWx0aXBsZUN1c3RvbWVyICAgID0+IFxATXVsdGlwbGVDdXN0b21lciwKICAgICAgICAgICAgICAgIE11bHRpcGxlQ3VzdG9tZXJDYyAgPT4gXEBNdWx0aXBsZUN1c3RvbWVyQ2MsCiAgICAgICAgICAgICAgICBNdWx0aXBsZUN1c3RvbWVyQmNjID0+IFxATXVsdGlwbGVDdXN0b21lckJjYywKICAgICAgICAgICAgICAgIEF0dGFjaG1lbnRzICAgICAgICAgPT4gXEBBdHRhY2htZW50cywKICAgICAgICAgICAgICAgIEdldFBhcmFtICAgICAgICAgICAgPT4gXCVHZXRQYXJhbSwKICAgICAgICAgICAgICAgIFRpY2tldEJhY2tUeXBlICAgICAgPT4gJFRpY2tldEJhY2tUeXBlLAogICAgICAgICAgICAgICAgJVRpY2tldCwKICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZEhUTUwgPT4gXCVEeW5hbWljRmllbGRIVE1MLAogICAgICAgICAgICAgICAgJUdldFBhcmFtLAogICAgICAgICAgICApOwogICAgICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPkZvb3RlcigKICAgICAgICAgICAgICAgIFR5cGUgPT4gJ1NtYWxsJywKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuICRPdXRwdXQ7CiAgICAgICAgfQoKICAgICAgICAjIHJlcGxhY2UgPE9UUlNfVElDS0VUX1NUQVRFPiB3aXRoIG5leHQgdGlja2V0IHN0YXRlIG5hbWUKICAgICAgICBpZiAoICRTdGF0ZURhdGF7TmFtZX0gKSB7CiAgICAgICAgICAgICRHZXRQYXJhbXtCb2R5fSA9fiBzLzxPVFJTX1RJQ0tFVF9TVEFURT4vJFN0YXRlRGF0YXtOYW1lfS9nOwogICAgICAgICAgICAkR2V0UGFyYW17Qm9keX0gPX4gcy8mbHQ7T1RSU19USUNLRVRfU1RBVEUmZ3Q7LyRTdGF0ZURhdGF7TmFtZX0vZzsKICAgICAgICB9CgogICAgICAgICMgZ2V0IHByZSBsb2FkZWQgYXR0YWNobWVudHMKICAgICAgICBteSBAQXR0YWNobWVudERhdGEgPSAkVXBsb2FkQ2FjaGVPYmplY3QtPkZvcm1JREdldEFsbEZpbGVzRGF0YSgKICAgICAgICAgICAgRm9ybUlEID0+ICRTZWxmLT57Rm9ybUlEfSwKICAgICAgICApOwoKICAgICAgICAjIGdldCBzdWJtaXQgYXR0YWNobWVudAogICAgICAgIG15ICVVcGxvYWRTdHVmZiA9ICRQYXJhbU9iamVjdC0+R2V0VXBsb2FkQWxsKAogICAgICAgICAgICBQYXJhbSA9PiAnRmlsZVVwbG9hZCcsCiAgICAgICAgKTsKICAgICAgICBpZiAoJVVwbG9hZFN0dWZmKSB7CiAgICAgICAgICAgIHB1c2ggQEF0dGFjaG1lbnREYXRhLCBcJVVwbG9hZFN0dWZmOwogICAgICAgIH0KCiAgICAgICAgIyBnZXQgcmVjaXBpZW50cwogICAgICAgIG15ICRSZWNpcGllbnRzID0gJyc7CiAgICAgICAgTElORToKICAgICAgICBmb3IgbXkgJExpbmUgKHF3KFRvIENjIEJjYykpIHsKCiAgICAgICAgICAgIG5leHQgTElORSBpZiAhJEdldFBhcmFteyRMaW5lfTsKCiAgICAgICAgICAgIGlmICgkUmVjaXBpZW50cykgewogICAgICAgICAgICAgICAgJFJlY2lwaWVudHMgLj0gJywgJzsKICAgICAgICAgICAgfQogICAgICAgICAgICAkUmVjaXBpZW50cyAuPSAkR2V0UGFyYW17JExpbmV9OwogICAgICAgIH0KCiAgICAgICAgbXkgJE1pbWVUeXBlID0gJ3RleHQvcGxhaW4nOwogICAgICAgIGlmICggJExheW91dE9iamVjdC0+e0Jyb3dzZXJSaWNoVGV4dH0gKSB7CiAgICAgICAgICAgICRNaW1lVHlwZSA9ICd0ZXh0L2h0bWwnOwoKICAgICAgICAgICAgIyByZW1vdmUgdW51c2VkIGlubGluZSBpbWFnZXMKICAgICAgICAgICAgbXkgQE5ld0F0dGFjaG1lbnREYXRhOwogICAgICAgICAgICBBVFRBQ0hNRU5UOgogICAgICAgICAgICBmb3IgbXkgJEF0dGFjaG1lbnQgKEBBdHRhY2htZW50RGF0YSkgewogICAgICAgICAgICAgICAgbXkgJENvbnRlbnRJRCA9ICRBdHRhY2htZW50LT57Q29udGVudElEfTsKICAgICAgICAgICAgICAgIGlmICggJENvbnRlbnRJRCAmJiAoICRBdHRhY2htZW50LT57Q29udGVudFR5cGV9ID1+IC9pbWFnZS9pICkgKSB7CiAgICAgICAgICAgICAgICAgICAgbXkgJENvbnRlbnRJREhUTUxRdW90ZSA9ICRMYXlvdXRPYmplY3QtPkFzY2lpMkh0bWwoCiAgICAgICAgICAgICAgICAgICAgICAgIFRleHQgPT4gJENvbnRlbnRJRCwKICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICAgICAjIHdvcmthcm91bmQgZm9yIGxpbmsgZW5jb2RlIG9mIHJpY2ggdGV4dCBlZGl0b3IsIHNlZSBidWcjNTA1MwogICAgICAgICAgICAgICAgICAgIG15ICRDb250ZW50SURMaW5rRW5jb2RlID0gJExheW91dE9iamVjdC0+TGlua0VuY29kZSgkQ29udGVudElEKTsKICAgICAgICAgICAgICAgICAgICAkR2V0UGFyYW17Qm9keX0gPX4gcy8oQ29udGVudElEPSkkQ29udGVudElETGlua0VuY29kZS8kMSRDb250ZW50SUQvZzsKCiAgICAgICAgICAgICAgICAgICAgIyBJRiB0aGUgaW1hZ2UgaXMgcmVmZXJlbmNlZCBpbiB0aGUgYm9keSBzZXQgaXQgYXMgaW5saW5lLgogICAgICAgICAgICAgICAgICAgIGlmICggJEdldFBhcmFte0JvZHl9ID1+IC8oXFEkQ29udGVudElESFRNTFF1b3RlXEV8XFEkQ29udGVudElEXEUpL2kgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRBdHRhY2htZW50LT57RGlzcG9zaXRpb259ID0gJ2lubGluZSc7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2lmICggJEF0dGFjaG1lbnQtPntEaXNwb3NpdGlvbn0gZXEgJ2lubGluZScgKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAjIElnbm9yZSBhdHRhY2htZW50IGlmIG5vdCBsaW5rZWQgaW4gYm9keS4KICAgICAgICAgICAgICAgICAgICAgICAgbmV4dCBBVFRBQ0hNRU5UOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIHJlbWVtYmVyIGlubGluZSBpbWFnZXMgYW5kIG5vcm1hbCBhdHRhY2htZW50cwogICAgICAgICAgICAgICAgcHVzaCBATmV3QXR0YWNobWVudERhdGEsIFwleyRBdHRhY2htZW50fTsKICAgICAgICAgICAgfQogICAgICAgICAgICBAQXR0YWNobWVudERhdGEgPSBATmV3QXR0YWNobWVudERhdGE7CgogICAgICAgICAgICAjIHZlcmlmeSBIVE1MIGRvY3VtZW50CiAgICAgICAgICAgICRHZXRQYXJhbXtCb2R5fSA9ICRMYXlvdXRPYmplY3QtPlJpY2hUZXh0RG9jdW1lbnRDb21wbGV0ZSgKICAgICAgICAgICAgICAgIFN0cmluZyA9PiAkR2V0UGFyYW17Qm9keX0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICBteSAkSXNWaXNpYmxlRm9yQ3VzdG9tZXIgPSAkQ29uZmlnLT57SXNWaXNpYmxlRm9yQ3VzdG9tZXJEZWZhdWx0fTsKICAgICAgICBpZiAoICRHZXRQYXJhbXtJc1Zpc2libGVGb3JDdXN0b21lclByZXNlbnR9ICkgewogICAgICAgICAgICAkSXNWaXNpYmxlRm9yQ3VzdG9tZXIgPSAkR2V0UGFyYW17SXNWaXNpYmxlRm9yQ3VzdG9tZXJ9ID8gMSA6IDA7CiAgICAgICAgfQoKICAgICAgICAjIEdldCBhdHRyaWJ1dGVzIGxpa2Ugc2VuZGVyIGFkZHJlc3MKICAgICAgICBteSAlRGF0YSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpUZW1wbGF0ZUdlbmVyYXRvcicpLT5BdHRyaWJ1dGVzKAogICAgICAgICAgICBUaWNrZXRJRCA9PiAkU2VsZi0+e1RpY2tldElEfSwKICAgICAgICAgICAgRGF0YSAgICAgPT4ge30sCiAgICAgICAgICAgIFVzZXJJRCAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICApOwoKICAgICAgICAjIHNlbmQgZW1haWwKICAgICAgICBteSAkQXJ0aWNsZUlEID0gJEFydGljbGVCYWNrZW5kT2JqZWN0LT5BcnRpY2xlU2VuZCgKICAgICAgICAgICAgSXNWaXNpYmxlRm9yQ3VzdG9tZXIgPT4gJElzVmlzaWJsZUZvckN1c3RvbWVyLAogICAgICAgICAgICBTZW5kZXJUeXBlICAgICAgICAgICA9PiAnYWdlbnQnLAogICAgICAgICAgICBUaWNrZXRJRCAgICAgICAgICAgICA9PiAkU2VsZi0+e1RpY2tldElEfSwKICAgICAgICAgICAgSGlzdG9yeVR5cGUgICAgICAgICAgPT4gJ1NlbmRBbnN3ZXInLAogICAgICAgICAgICBIaXN0b3J5Q29tbWVudCAgICAgICA9PiAiXCVcJSRSZWNpcGllbnRzIiwKICAgICAgICAgICAgRnJvbSAgICAgICAgICAgICAgICAgPT4gJERhdGF7RnJvbX0sCiAgICAgICAgICAgIFRvICAgICAgICAgICAgICAgICAgID0+ICRHZXRQYXJhbXtUb30sCiAgICAgICAgICAgIENjICAgICAgICAgICAgICAgICAgID0+ICRHZXRQYXJhbXtDY30sCiAgICAgICAgICAgIEJjYyAgICAgICAgICAgICAgICAgID0+ICRHZXRQYXJhbXtCY2N9LAogICAgICAgICAgICBTdWJqZWN0ICAgICAgICAgICAgICA9PiAkR2V0UGFyYW17U3ViamVjdH0sCiAgICAgICAgICAgIFVzZXJJRCAgICAgICAgICAgICAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgQm9keSAgICAgICAgICAgICAgICAgPT4gJEdldFBhcmFte0JvZHl9LAogICAgICAgICAgICBJblJlcGx5VG8gICAgICAgICAgICA9PiAkR2V0UGFyYW17SW5SZXBseVRvfSwKICAgICAgICAgICAgUmVmZXJlbmNlcyAgICAgICAgICAgPT4gJEdldFBhcmFte1JlZmVyZW5jZXN9LAogICAgICAgICAgICBDaGFyc2V0ICAgICAgICAgICAgICA9PiAkTGF5b3V0T2JqZWN0LT57VXNlckNoYXJzZXR9LAogICAgICAgICAgICBNaW1lVHlwZSAgICAgICAgICAgICA9PiAkTWltZVR5cGUsCiAgICAgICAgICAgIEF0dGFjaG1lbnQgICAgICAgICAgID0+IFxAQXR0YWNobWVudERhdGEsCiAgICAgICAgICAgICVBcnRpY2xlUGFyYW0sCiAgICAgICAgKTsKCiAgICAgICAgIyBlcnJvciBwYWdlCiAgICAgICAgaWYgKCAhJEFydGljbGVJRCApIHsKICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkVycm9yU2NyZWVuKCk7CiAgICAgICAgfQoKICAgICAgICAjIHRpbWUgYWNjb3VudGluZwogICAgICAgIGlmICggJEdldFBhcmFte1RpbWVVbml0c30gKSB7CiAgICAgICAgICAgICRUaWNrZXRPYmplY3QtPlRpY2tldEFjY291bnRUaW1lKAogICAgICAgICAgICAgICAgVGlja2V0SUQgID0+ICRTZWxmLT57VGlja2V0SUR9LAogICAgICAgICAgICAgICAgQXJ0aWNsZUlEID0+ICRBcnRpY2xlSUQsCiAgICAgICAgICAgICAgICBUaW1lVW5pdCAgPT4gJEdldFBhcmFte1RpbWVVbml0c30sCiAgICAgICAgICAgICAgICBVc2VySUQgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBzZXQgZHluYW1pYyBmaWVsZHMKICAgICAgICAjIGN5Y2xlIHRyb3VnaCB0aGUgYWN0aXZhdGVkIER5bmFtaWMgRmllbGRzIGZvciB0aGlzIHNjcmVlbgogICAgICAgIERZTkFNSUNGSUVMRDoKICAgICAgICBmb3IgbXkgJER5bmFtaWNGaWVsZENvbmZpZyAoIEB7JER5bmFtaWNGaWVsZH0gKSB7CiAgICAgICAgICAgIG5leHQgRFlOQU1JQ0ZJRUxEIGlmICFJc0hhc2hSZWZXaXRoRGF0YSgkRHluYW1pY0ZpZWxkQ29uZmlnKTsKCiAgICAgICAgICAgICMgc2V0IHRoZSBvYmplY3QgSUQgKFRpY2tldElEIG9yIEFydGljbGVJRCkgZGVwZW5kaW5nIG9uIHRoZSBmaWVsZCBjb25maWdyYXRpb24KICAgICAgICAgICAgbXkgJE9iamVjdElEID0gJER5bmFtaWNGaWVsZENvbmZpZy0+e09iamVjdFR5cGV9IGVxICdBcnRpY2xlJyA/ICRBcnRpY2xlSUQgOiAkU2VsZi0+e1RpY2tldElEfTsKCiAgICAgICAgICAgICMgc2V0IHRoZSB2YWx1ZQogICAgICAgICAgICBteSAkU3VjY2VzcyA9ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0LT5WYWx1ZVNldCgKICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZENvbmZpZyA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnLAogICAgICAgICAgICAgICAgT2JqZWN0SUQgICAgICAgICAgID0+ICRPYmplY3RJRCwKICAgICAgICAgICAgICAgIFZhbHVlICAgICAgICAgICAgICA9PiAkRHluYW1pY0ZpZWxkVmFsdWVzeyAkRHluYW1pY0ZpZWxkQ29uZmlnLT57TmFtZX0gfSwKICAgICAgICAgICAgICAgIFVzZXJJRCAgICAgICAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIHNldCBzdGF0ZQogICAgICAgICRUaWNrZXRPYmplY3QtPlRpY2tldFN0YXRlU2V0KAogICAgICAgICAgICBUaWNrZXRJRCAgPT4gJFNlbGYtPntUaWNrZXRJRH0sCiAgICAgICAgICAgIEFydGljbGVJRCA9PiAkQXJ0aWNsZUlELAogICAgICAgICAgICBTdGF0ZUlEICAgPT4gJEdldFBhcmFte1N0YXRlSUR9LAogICAgICAgICAgICBVc2VySUQgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICk7CgogICAgICAgICMgc2hvdWxkIEkgc2V0IGFuIHVubG9jaz8KICAgICAgICBpZiAoICRTdGF0ZURhdGF7VHlwZU5hbWV9ID1+IC9eY2xvc2UvaSApIHsKICAgICAgICAgICAgJFRpY2tldE9iamVjdC0+VGlja2V0TG9ja1NldCgKICAgICAgICAgICAgICAgIFRpY2tldElEID0+ICRTZWxmLT57VGlja2V0SUR9LAogICAgICAgICAgICAgICAgTG9jayAgICAgPT4gJ3VubG9jaycsCiAgICAgICAgICAgICAgICBVc2VySUQgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIHNldCBwZW5kaW5nIHRpbWUKICAgICAgICBlbHNpZiAoICRTdGF0ZURhdGF7VHlwZU5hbWV9ID1+IC9ecGVuZGluZy9pICkgewogICAgICAgICAgICAkVGlja2V0T2JqZWN0LT5UaWNrZXRQZW5kaW5nVGltZVNldCgKICAgICAgICAgICAgICAgIFVzZXJJRCAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgICAgIFRpY2tldElEID0+ICRTZWxmLT57VGlja2V0SUR9LAogICAgICAgICAgICAgICAgWWVhciAgICAgPT4gJEdldFBhcmFte1llYXJ9LAogICAgICAgICAgICAgICAgTW9udGggICAgPT4gJEdldFBhcmFte01vbnRofSwKICAgICAgICAgICAgICAgIERheSAgICAgID0+ICRHZXRQYXJhbXtEYXl9LAogICAgICAgICAgICAgICAgSG91ciAgICAgPT4gJEdldFBhcmFte0hvdXJ9LAogICAgICAgICAgICAgICAgTWludXRlICAgPT4gJEdldFBhcmFte01pbnV0ZX0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIGxvZyB1c2UgcmVzcG9uc2UgaWQgYW5kIHJlcGx5IGFydGljbGUgaWQgKHVzZWZ1bCBmb3IgcmVzcG9uc2UgZGlhZ25vc3RpY3MpCiAgICAgICAgJFRpY2tldE9iamVjdC0+SGlzdG9yeUFkZCgKICAgICAgICAgICAgTmFtZSAgICAgICAgID0+ICJSZXNwb25zZVRlbXBsYXRlICgkR2V0UGFyYW17UmVzcG9uc2VJRH0vJEdldFBhcmFte1JlcGx5QXJ0aWNsZUlEfS8kQXJ0aWNsZUlEKSIsCiAgICAgICAgICAgIEhpc3RvcnlUeXBlICA9PiAnTWlzYycsCiAgICAgICAgICAgIFRpY2tldElEICAgICA9PiAkU2VsZi0+e1RpY2tldElEfSwKICAgICAgICAgICAgQ3JlYXRlVXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICApOwoKICAgICAgICAjIHJlbW92ZSBwcmUgc3VibWl0ZWQgYXR0YWNobWVudHMKICAgICAgICAkVXBsb2FkQ2FjaGVPYmplY3QtPkZvcm1JRFJlbW92ZSggRm9ybUlEID0+ICRHZXRQYXJhbXtGb3JtSUR9ICk7CgogICAgICAgICMgSWYgZm9ybSB3YXMgY2FsbGVkIGJhc2VkIG9uIGEgZHJhZnQsCiAgICAgICAgIyAgIGRlbGV0ZSBkcmFmdCBzaW5jZSBpdHMgY29udGVudCBoYXMgbm93IGJlZW4gdXNlZC4KICAgICAgICBpZiAoCiAgICAgICAgICAgICRHZXRQYXJhbXtGb3JtRHJhZnRJRH0KICAgICAgICAgICAgJiYgISRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpGb3JtRHJhZnQnKS0+Rm9ybURyYWZ0RGVsZXRlKAogICAgICAgICAgICAgICAgRm9ybURyYWZ0SUQgPT4gJEdldFBhcmFte0Zvcm1EcmFmdElEfSwKICAgICAgICAgICAgICAgIFVzZXJJRCAgICAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgKQogICAgICAgICAgICApCiAgICAgICAgewogICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+RXJyb3JTY3JlZW4oCiAgICAgICAgICAgICAgICBNZXNzYWdlID0+IFRyYW5zbGF0YWJsZSgnQ291bGQgbm90IGRlbGV0ZSBkcmFmdCEnKSwKICAgICAgICAgICAgICAgIENvbW1lbnQgPT4gVHJhbnNsYXRhYmxlKCdQbGVhc2UgY29udGFjdCB0aGUgYWRtaW5pc3RyYXRvci4nKSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgcmVkaXJlY3QKICAgICAgICBpZiAoCiAgICAgICAgICAgICRTdGF0ZURhdGF7VHlwZU5hbWV9ID1+IC9eY2xvc2UvaQogICAgICAgICAgICAmJiAhJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpSZWRpcmVjdEFmdGVyQ2xvc2VEaXNhYmxlZCcpCiAgICAgICAgICAgICkKICAgICAgICB7CiAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5Qb3B1cENsb3NlKAogICAgICAgICAgICAgICAgVVJMID0+ICggJFNlbGYtPntMYXN0U2NyZWVuT3ZlcnZpZXd9IHx8ICdBY3Rpb249QWdlbnREYXNoYm9hcmQnICksCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIGxvYWQgbmV3IFVSTCBpbiBwYXJlbnQgd2luZG93IGFuZCBjbG9zZSBwb3B1cAogICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5Qb3B1cENsb3NlKAogICAgICAgICAgICBVUkwgPT4gIkFjdGlvbj1BZ2VudFRpY2tldFpvb207VGlja2V0SUQ9JFNlbGYtPntUaWNrZXRJRH07QXJ0aWNsZUlEPSRBcnRpY2xlSUQiLAogICAgICAgICk7CiAgICB9CgogICAgIyBjaGVjayBmb3IgU01JTUUgLyBQR1AgaWYgY3VzdG9tZXIgaGFzIGNoYW5nZWQKICAgIGVsc2lmICggJFNlbGYtPntTdWJhY3Rpb259IGVxICdBSkFYVXBkYXRlJyApIHsKCiAgICAgICAgbXkgQEV4dGVuZGVkRGF0YTsKCiAgICAgICAgIyBydW4gY29tcG9zZSBtb2R1bGVzCiAgICAgICAgaWYgKCByZWYgJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpBcnRpY2xlQ29tcG9zZU1vZHVsZScpIGVxICdIQVNIJyApIHsKCiAgICAgICAgICAgICMgdXNlIHRpY2tldCBRdWV1ZUlEIGluIGNvbXBvc2UgbW9kdWxlcwogICAgICAgICAgICAkR2V0UGFyYW17UXVldWVJRH0gPSAkVGlja2V0e1F1ZXVlSUR9OwoKICAgICAgICAgICAgbXkgJUpvYnMgPSAleyAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6OkFydGljbGVDb21wb3NlTW9kdWxlJykgfTsKICAgICAgICAgICAgSk9COgogICAgICAgICAgICBmb3IgbXkgJEpvYiAoIHNvcnQga2V5cyAlSm9icyApIHsKCiAgICAgICAgICAgICAgICAjIGxvYWQgbW9kdWxlCiAgICAgICAgICAgICAgICBuZXh0IEpPQiBpZiAhJE1haW5PYmplY3QtPlJlcXVpcmUoICRKb2JzeyRKb2J9LT57TW9kdWxlfSApOwoKICAgICAgICAgICAgICAgIG15ICRPYmplY3QgPSAkSm9ic3skSm9ifS0+e01vZHVsZX0tPm5ldygKICAgICAgICAgICAgICAgICAgICAleyRTZWxmfSwKICAgICAgICAgICAgICAgICAgICBEZWJ1ZyA9PiAkU2VsZi0+e0RlYnVnfSwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgbXkgJE11bHRpcGxlOwoKICAgICAgICAgICAgICAgICMgZ2V0IHBhcmFtcwogICAgICAgICAgICAgICAgUEFSQU1FVEVSOgogICAgICAgICAgICAgICAgZm9yIG15ICRQYXJhbWV0ZXIgKCAkT2JqZWN0LT5PcHRpb24oICVHZXRQYXJhbSwgQ29uZmlnID0+ICRKb2JzeyRKb2J9ICkgKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCAkSm9ic3skSm9ifS0+e1BhcmFtVHlwZX0gJiYgJEpvYnN7JEpvYn0tPntQYXJhbVR5cGV9IG5lICdTaW5nbGUnICkgewogICAgICAgICAgICAgICAgICAgICAgICBAeyAkR2V0UGFyYW17JFBhcmFtZXRlcn0gfSA9ICRQYXJhbU9iamVjdC0+R2V0QXJyYXkoIFBhcmFtID0+ICRQYXJhbWV0ZXIgKTsKICAgICAgICAgICAgICAgICAgICAgICAgJE11bHRpcGxlID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgbmV4dCBQQVJBTUVURVI7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAkR2V0UGFyYW17JFBhcmFtZXRlcn0gPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAkUGFyYW1ldGVyICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBydW4gbW9kdWxlCiAgICAgICAgICAgICAgICBteSAlRGF0YSA9ICRPYmplY3QtPkRhdGEoICVHZXRQYXJhbSwgQ29uZmlnID0+ICRKb2JzeyRKb2J9ICk7CgogICAgICAgICAgICAgICAgIyBnZXQgQUpBWCBwYXJhbSB2YWx1ZXMKICAgICAgICAgICAgICAgIGlmICggJE9iamVjdC0+Y2FuKCdHZXRQYXJhbUFKQVgnKSApIHsKICAgICAgICAgICAgICAgICAgICAlR2V0UGFyYW0gPSAoICVHZXRQYXJhbSwgJE9iamVjdC0+R2V0UGFyYW1BSkFYKCVHZXRQYXJhbSkgKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIGdldCBvcHRpb25zIHRoYXQgaGF2ZSB0byBiZSByZW1vdmVkIGZyb20gdGhlIHNlbGVjdGlvbiB2aXNpYmxlCiAgICAgICAgICAgICAgICAjIHRvIHRoZSBhZ2VudC4gVGhlc2Ugb3B0aW9ucyB3aWxsIGJlIGFkZGVkIGFnYWluIG9uIHN1Ym1pdC4KICAgICAgICAgICAgICAgIGlmICggJE9iamVjdC0+Y2FuKCdHZXRPcHRpb25zVG9SZW1vdmVBSkFYJykgKSB7CiAgICAgICAgICAgICAgICAgICAgbXkgQE9wdGlvbnNUb1JlbW92ZSA9ICRPYmplY3QtPkdldE9wdGlvbnNUb1JlbW92ZUFKQVgoJUdldFBhcmFtKTsKCiAgICAgICAgICAgICAgICAgICAgZm9yIG15ICRPcHRpb25Ub1JlbW92ZSAoQE9wdGlvbnNUb1JlbW92ZSkgewogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgJERhdGF7JE9wdGlvblRvUmVtb3ZlfTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbXkgJEtleSA9ICRPYmplY3QtPk9wdGlvbiggJUdldFBhcmFtLCBDb25maWcgPT4gJEpvYnN7JEpvYn0gKTsKICAgICAgICAgICAgICAgIGlmICgkS2V5KSB7CiAgICAgICAgICAgICAgICAgICAgcHVzaCgKICAgICAgICAgICAgICAgICAgICAgICAgQEV4dGVuZGVkRGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSAgICAgICAgID0+ICRLZXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEYXRhICAgICAgICAgPT4gXCVEYXRhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VsZWN0ZWRJRCAgID0+ICRHZXRQYXJhbXskS2V5fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRyYW5zbGF0aW9uICA9PiAxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zc2libGVOb25lID0+IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNdWx0aXBsZSAgICAgPT4gJE11bHRpcGxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF4ICAgICAgICAgID0+IDE1MCwKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIG15ICROZXh0U3RhdGVzID0gJFNlbGYtPl9HZXROZXh0U3RhdGVzKAogICAgICAgICAgICAlR2V0UGFyYW0sCiAgICAgICAgKTsKCiAgICAgICAgIyB1cGRhdGUgRHluYW1pYyBGaWVsZHMgUG9zc2libGUgVmFsdWVzIHZpYSBBSkFYCiAgICAgICAgbXkgQER5bmFtaWNGaWVsZEFKQVg7CgogICAgICAgICMgY3ljbGUgdHJvdWdoIHRoZSBhY3RpdmF0ZWQgRHluYW1pYyBGaWVsZHMgZm9yIHRoaXMgc2NyZWVuCiAgICAgICAgRFlOQU1JQ0ZJRUxEOgogICAgICAgIGZvciBteSAkRHluYW1pY0ZpZWxkQ29uZmlnICggQHskRHluYW1pY0ZpZWxkfSApIHsKICAgICAgICAgICAgbmV4dCBEWU5BTUlDRklFTEQgaWYgIUlzSGFzaFJlZldpdGhEYXRhKCREeW5hbWljRmllbGRDb25maWcpOwoKICAgICAgICAgICAgbXkgJElzQUNMUmVkdWNpYmxlID0gJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QtPkhhc0JlaGF2aW9yKAogICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRDb25maWcsCiAgICAgICAgICAgICAgICBCZWhhdmlvciAgICAgICAgICAgPT4gJ0lzQUNMUmVkdWNpYmxlJywKICAgICAgICAgICAgKTsKICAgICAgICAgICAgbmV4dCBEWU5BTUlDRklFTEQgaWYgISRJc0FDTFJlZHVjaWJsZTsKCiAgICAgICAgICAgIG15ICRQb3NzaWJsZVZhbHVlcyA9ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0LT5Qb3NzaWJsZVZhbHVlc0dldCgKICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZENvbmZpZyA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgIyBjb252ZXJ0IHBvc3NpYmxlIHZhbHVlcyBrZXkgPT4gdmFsdWUgdG8ga2V5ID0+IGtleSBmb3IgQUNMcyB1c2luZyBhIEhhc2ggc2xpY2UKICAgICAgICAgICAgbXkgJUFjbERhdGEgPSAleyRQb3NzaWJsZVZhbHVlc307CiAgICAgICAgICAgIEBBY2xEYXRheyBrZXlzICVBY2xEYXRhIH0gPSBrZXlzICVBY2xEYXRhOwoKICAgICAgICAgICAgIyBzZXQgcG9zc2libGUgdmFsdWVzIGZpbHRlciBmcm9tIEFDTHMKICAgICAgICAgICAgbXkgJEFDTCA9ICRUaWNrZXRPYmplY3QtPlRpY2tldEFjbCgKICAgICAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgICAgIEFjdGlvbiAgICAgICAgPT4gJFNlbGYtPntBY3Rpb259LAogICAgICAgICAgICAgICAgVGlja2V0SUQgICAgICA9PiAkU2VsZi0+e1RpY2tldElEfSwKICAgICAgICAgICAgICAgIFF1ZXVlSUQgICAgICAgPT4gJFNlbGYtPntRdWV1ZUlEfSwKICAgICAgICAgICAgICAgIFJldHVyblR5cGUgICAgPT4gJ1RpY2tldCcsCiAgICAgICAgICAgICAgICBSZXR1cm5TdWJUeXBlID0+ICdEeW5hbWljRmllbGRfJyAuICREeW5hbWljRmllbGRDb25maWctPntOYW1lfSwKICAgICAgICAgICAgICAgIERhdGEgICAgICAgICAgPT4gXCVBY2xEYXRhLAogICAgICAgICAgICAgICAgVXNlcklEICAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGlmICgkQUNMKSB7CiAgICAgICAgICAgICAgICBteSAlRmlsdGVyID0gJFRpY2tldE9iamVjdC0+VGlja2V0QWNsRGF0YSgpOwoKICAgICAgICAgICAgICAgICMgY29udmVydCBGaWxlciBrZXkgPT4ga2V5IGJhY2sgdG8ga2V5ID0+IHZhbHVlIHVzaW5nIG1hcAogICAgICAgICAgICAgICAgJXskUG9zc2libGVWYWx1ZXN9ID0gbWFwIHsgJF8gPT4gJFBvc3NpYmxlVmFsdWVzLT57JF99IH0ga2V5cyAlRmlsdGVyOwogICAgICAgICAgICB9CgogICAgICAgICAgICBteSAkRGF0YVZhbHVlcyA9ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0LT5CdWlsZFNlbGVjdGlvbkRhdGFHZXQoCiAgICAgICAgICAgICAgICBEeW5hbWljRmllbGRDb25maWcgPT4gJER5bmFtaWNGaWVsZENvbmZpZywKICAgICAgICAgICAgICAgIFBvc3NpYmxlVmFsdWVzICAgICA9PiAkUG9zc2libGVWYWx1ZXMsCiAgICAgICAgICAgICAgICBWYWx1ZSAgICAgICAgICAgICAgPT4gJER5bmFtaWNGaWVsZFZhbHVlc3sgJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9IH0sCiAgICAgICAgICAgICkgfHwgJFBvc3NpYmxlVmFsdWVzOwoKICAgICAgICAgICAgIyBhZGQgZHluYW1pYyBmaWVsZCB0byB0aGUgbGlzdCBvZiBmaWVsZHMgdG8gdXBkYXRlCiAgICAgICAgICAgIHB1c2goCiAgICAgICAgICAgICAgICBARHluYW1pY0ZpZWxkQUpBWCwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBOYW1lICAgICAgICA9PiAnRHluYW1pY0ZpZWxkXycgLiAkRHluYW1pY0ZpZWxkQ29uZmlnLT57TmFtZX0sCiAgICAgICAgICAgICAgICAgICAgRGF0YSAgICAgICAgPT4gJERhdGFWYWx1ZXMsCiAgICAgICAgICAgICAgICAgICAgU2VsZWN0ZWRJRCAgPT4gJER5bmFtaWNGaWVsZFZhbHVlc3sgJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9IH0sCiAgICAgICAgICAgICAgICAgICAgVHJhbnNsYXRpb24gPT4gJER5bmFtaWNGaWVsZENvbmZpZy0+e0NvbmZpZ30tPntUcmFuc2xhdGFibGVWYWx1ZXN9IHx8IDAsCiAgICAgICAgICAgICAgICAgICAgTWF4ICAgICAgICAgPT4gMTAwLAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgbXkgJEpTT04gPSAkTGF5b3V0T2JqZWN0LT5CdWlsZFNlbGVjdGlvbkpTT04oCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIEBFeHRlbmRlZERhdGEsCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgTmFtZSAgICAgICAgID0+ICdTdGF0ZUlEJywKICAgICAgICAgICAgICAgICAgICBEYXRhICAgICAgICAgPT4gJE5leHRTdGF0ZXMsCiAgICAgICAgICAgICAgICAgICAgU2VsZWN0ZWRJRCAgID0+ICRHZXRQYXJhbXtTdGF0ZUlEfSwKICAgICAgICAgICAgICAgICAgICBUcmFuc2xhdGlvbiAgPT4gMSwKICAgICAgICAgICAgICAgICAgICBQb3NzaWJsZU5vbmUgPT4gMSwKICAgICAgICAgICAgICAgICAgICBNYXggICAgICAgICAgPT4gMTAwLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIEBEeW5hbWljRmllbGRBSkFYLAoKICAgICAgICAgICAgXSwKICAgICAgICApOwogICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5BdHRhY2htZW50KAogICAgICAgICAgICBDb250ZW50VHlwZSA9PiAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD0nIC4gJExheW91dE9iamVjdC0+e0NoYXJzZXR9LAogICAgICAgICAgICBDb250ZW50ICAgICA9PiAkSlNPTiwKICAgICAgICAgICAgVHlwZSAgICAgICAgPT4gJ2lubGluZScsCiAgICAgICAgICAgIE5vQ2FjaGUgICAgID0+IDEsCiAgICAgICAgKTsKICAgIH0KICAgIGVsc2lmICggJFNlbGYtPntTdWJhY3Rpb259IGVxICdDaGVja1N1YmplY3QnICkgewoKICAgICAgICAjIEluZm9ybSBhIHVzZXIgdGhhdCBhcnRpY2xlIHN1YmplY3Qgd2lsbCBiZSBlbXB0eSBpZiBjb250YWlucyBvbmx5IHRoZSB0aWNrZXQgaG9vayAoaWYgbm90aGluZyBpcyBtb2RpZmllZCkuCiAgICAgICAgbXkgJE1lc3NhZ2UgPSAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoCiAgICAgICAgICAgICdBcnRpY2xlIHN1YmplY3Qgd2lsbCBiZSBlbXB0eSBpZiB0aGUgc3ViamVjdCBjb250YWlucyBvbmx5IHRoZSB0aWNrZXQgaG9vayEnCiAgICAgICAgKTsKCiAgICAgICAgbXkgJFN1YmplY3QgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnU3ViamVjdCcgKTsKCiAgICAgICAgbXkgJENsZWFuZWRTdWJqZWN0ID0gJFRpY2tldE9iamVjdC0+VGlja2V0U3ViamVjdENsZWFuKAogICAgICAgICAgICBUaWNrZXROdW1iZXIgPT4gJFRpY2tldHtUaWNrZXROdW1iZXJ9LAogICAgICAgICAgICBTdWJqZWN0ICAgICAgPT4gJFN1YmplY3QsCiAgICAgICAgKTsKCiAgICAgICAgbXkgJEVtcHR5ID0gIWxlbmd0aCAkQ2xlYW5lZFN1YmplY3Q7CgogICAgICAgIG15ICRKU09OID0gJExheW91dE9iamVjdC0+SlNPTkVuY29kZSgKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBFbXB0eSAgID0+ICRFbXB0eSA/IDEgOiAwLAogICAgICAgICAgICAgICAgTWVzc2FnZSA9PiAkTWVzc2FnZSwKICAgICAgICAgICAgfQogICAgICAgICk7CgogICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5BdHRhY2htZW50KAogICAgICAgICAgICBDb250ZW50VHlwZSA9PiAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD0nIC4gJExheW91dE9iamVjdC0+e0NoYXJzZXR9LAogICAgICAgICAgICBDb250ZW50ICAgICA9PiAkSlNPTiwKICAgICAgICAgICAgVHlwZSAgICAgICAgPT4gJ2lubGluZScsCiAgICAgICAgICAgIE5vQ2FjaGUgICAgID0+IDEsCiAgICAgICAgKTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIG15ICRPdXRwdXQgPSAkTGF5b3V0T2JqZWN0LT5IZWFkZXIoCiAgICAgICAgICAgIFZhbHVlICAgICA9PiAkVGlja2V0e1RpY2tldE51bWJlcn0sCiAgICAgICAgICAgIFR5cGUgICAgICA9PiAnU21hbGwnLAogICAgICAgICAgICBCb2R5Q2xhc3MgPT4gJ1BvcHVwJywKICAgICAgICApOwoKICAgICAgICAjIGdldCBzdGQgYXR0YWNobWVudCBvYmplY3QKICAgICAgICBteSAkU3RkQXR0YWNobWVudE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpTdGRBdHRhY2htZW50Jyk7CgogICAgICAgICMgYWRkIHN0ZC4gYXR0YWNobWVudHMgdG8gZW1haWwKICAgICAgICBpZiAoICRHZXRQYXJhbXtSZXNwb25zZUlEfSApIHsKICAgICAgICAgICAgbXkgJUFsbFN0ZEF0dGFjaG1lbnRzID0gJFN0ZEF0dGFjaG1lbnRPYmplY3QtPlN0ZEF0dGFjaG1lbnRTdGFuZGFyZFRlbXBsYXRlTWVtYmVyTGlzdCgKICAgICAgICAgICAgICAgIFN0YW5kYXJkVGVtcGxhdGVJRCA9PiAkR2V0UGFyYW17UmVzcG9uc2VJRH0sCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGZvciBteSAkSUQgKCBzb3J0IGtleXMgJUFsbFN0ZEF0dGFjaG1lbnRzICkgewogICAgICAgICAgICAgICAgbXkgJURhdGEgPSAkU3RkQXR0YWNobWVudE9iamVjdC0+U3RkQXR0YWNobWVudEdldCggSUQgPT4gJElEICk7CiAgICAgICAgICAgICAgICAkVXBsb2FkQ2FjaGVPYmplY3QtPkZvcm1JREFkZEZpbGUoCiAgICAgICAgICAgICAgICAgICAgRm9ybUlEICAgICAgPT4gJFNlbGYtPntGb3JtSUR9LAogICAgICAgICAgICAgICAgICAgIERpc3Bvc2l0aW9uID0+ICdhdHRhY2htZW50JywKICAgICAgICAgICAgICAgICAgICAlRGF0YSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgZ2V0IGFsbCBhdHRhY2htZW50cyBtZXRhIGRhdGEKICAgICAgICBteSBAQXR0YWNobWVudHMgPSAkVXBsb2FkQ2FjaGVPYmplY3QtPkZvcm1JREdldEFsbEZpbGVzTWV0YSgKICAgICAgICAgICAgRm9ybUlEID0+ICRTZWxmLT57Rm9ybUlEfSwKICAgICAgICApOwoKICAgICAgICAjIGdldCBsYXN0IGN1c3RvbWVyIGFydGljbGUgb3Igc2VsZWN0ZWQgYXJ0aWNsZSAuLi4KICAgICAgICBteSBAQXJ0aWNsZUxpc3Q7CgogICAgICAgIGlmICggJEdldFBhcmFte0FydGljbGVJRH0gKSB7CgogICAgICAgICAgICBAQXJ0aWNsZUxpc3QgPSAkQXJ0aWNsZU9iamVjdC0+QXJ0aWNsZUxpc3QoCiAgICAgICAgICAgICAgICBUaWNrZXRJRCAgPT4gJFNlbGYtPntUaWNrZXRJRH0sCiAgICAgICAgICAgICAgICBBcnRpY2xlSUQgPT4gJEdldFBhcmFte0FydGljbGVJRH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewoKICAgICAgICAgICAgQEFydGljbGVMaXN0ID0gJEFydGljbGVPYmplY3QtPkFydGljbGVMaXN0KAogICAgICAgICAgICAgICAgVGlja2V0SUQgICAgICAgICAgICAgPT4gJFNlbGYtPntUaWNrZXRJRH0sCiAgICAgICAgICAgICAgICBJc1Zpc2libGVGb3JDdXN0b21lciA9PiAxLAogICAgICAgICAgICAgICAgT25seUxhc3QgICAgICAgICAgICAgPT4gMSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIG15ICVEYXRhOwoKICAgICAgICBBUlRJQ0xFTUVUQURBVEE6CiAgICAgICAgZm9yIG15ICRBcnRpY2xlTWV0YURhdGEgKEBBcnRpY2xlTGlzdCkgewoKICAgICAgICAgICAgbmV4dCBBUlRJQ0xFTUVUQURBVEEgaWYgISRBcnRpY2xlTWV0YURhdGE7CiAgICAgICAgICAgIG5leHQgQVJUSUNMRU1FVEFEQVRBIGlmICFJc0hhc2hSZWZXaXRoRGF0YSgkQXJ0aWNsZU1ldGFEYXRhKTsKCiAgICAgICAgICAgIG15ICRDdXJyZW50QXJ0aWNsZUJhY2tlbmRPYmplY3QgPSAkQXJ0aWNsZU9iamVjdC0+QmFja2VuZEZvckFydGljbGUoICV7JEFydGljbGVNZXRhRGF0YX0gKTsKCiAgICAgICAgICAgICVEYXRhID0gJEN1cnJlbnRBcnRpY2xlQmFja2VuZE9iamVjdC0+QXJ0aWNsZUdldCgKICAgICAgICAgICAgICAgIFRpY2tldElEICA9PiAkU2VsZi0+e1RpY2tldElEfSwKICAgICAgICAgICAgICAgIEFydGljbGVJRCA9PiAkQXJ0aWNsZU1ldGFEYXRhLT57QXJ0aWNsZUlEfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICREYXRhe0NvbW11bmljYXRpb25DaGFubmVsTmFtZX0gPSAkQ3VycmVudEFydGljbGVCYWNrZW5kT2JqZWN0LT5DaGFubmVsTmFtZUdldCgpOwoKICAgICAgICAgICAgbGFzdCBBUlRJQ0xFTUVUQURBVEE7CiAgICAgICAgfQoKICAgICAgICAjIE1lcmdlIHRpY2tldCBkYXRhIHdpdGggYXJ0aWNsZSBkYXRhLCBzZWUgYnVnIzEzOTk1IChodHRwczovL2J1Z3Mub3Rycy5vcmcvc2hvd19idWcuY2dpP2lkPTEzOTk1KS4KICAgICAgICAlRGF0YSA9ICggJVRpY2tldCwgJURhdGEgKTsKCiAgICAgICAgIyBJZiBhcnRpY2xlIGlzIG5vdCBhIE1JTUVCYXNlIGFydGljbGUsIGdldCBjdXN0b21lciByZWNpcGllbnRzIGZyb20gdGhlIGJhY2tlbmQuCiAgICAgICAgaWYgKCAhJERhdGF7VG99ICYmICEkRGF0YXtGcm9tfSApIHsKICAgICAgICAgICAgbXkgQEN1c3RvbWVyVXNlcklEcyA9ICRMYXlvdXRPYmplY3QtPkFydGljbGVDdXN0b21lclJlY2lwaWVudHNHZXQoCiAgICAgICAgICAgICAgICBUaWNrZXRJRCAgPT4gJFNlbGYtPntUaWNrZXRJRH0sCiAgICAgICAgICAgICAgICBBcnRpY2xlSUQgPT4gJERhdGF7QXJ0aWNsZUlEfSwKICAgICAgICAgICAgICAgIFVzZXJJRCAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBteSAkQ3VzdG9tZXJVc2VyT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyVXNlcicpOwoKICAgICAgICAgICAgbXkgQEN1c3RvbWVyUmVjaXBpZW50czsKCiAgICAgICAgICAgIENVU1RPTUVSX1VTRVJfSUQ6CiAgICAgICAgICAgIGZvciBteSAkQ3VzdG9tZXJVc2VySUQgKEBDdXN0b21lclVzZXJJRHMpIHsKICAgICAgICAgICAgICAgIG15ICVDdXN0b21lciA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyVXNlckRhdGFHZXQoCiAgICAgICAgICAgICAgICAgICAgVXNlciA9PiAkQ3VzdG9tZXJVc2VySUQsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgbmV4dCBDVVNUT01FUl9VU0VSX0lEIGlmICElQ3VzdG9tZXI7CgogICAgICAgICAgICAgICAgcHVzaCBAQ3VzdG9tZXJSZWNpcGllbnRzLCAiXCIkQ3VzdG9tZXJ7VXNlckZpcnN0bmFtZX0gJEN1c3RvbWVye1VzZXJMYXN0bmFtZX1cIiA8JEN1c3RvbWVye1VzZXJFbWFpbH0+IjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJERhdGF7VG99ID0gam9pbiggJywnLCBAQ3VzdG9tZXJSZWNpcGllbnRzICkgLy8gJyc7CgogICAgICAgICAgICAjIEluY2x1ZGUgc2VuZGVyIG5hbWUgaW4gJ0Zyb20nIGZpZWxkIGZvciBjb3JyZWN0IHF1b3RpbmcuCiAgICAgICAgICAgIG15ICVBcnRpY2xlRmllbGRzID0gJExheW91dE9iamVjdC0+QXJ0aWNsZUZpZWxkcygKICAgICAgICAgICAgICAgIFRpY2tldElEICA9PiAkU2VsZi0+e1RpY2tldElEfSwKICAgICAgICAgICAgICAgIEFydGljbGVJRCA9PiAkRGF0YXtBcnRpY2xlSUR9LAogICAgICAgICAgICApOwogICAgICAgICAgICAkRGF0YXtGcm9tfSA9ICRBcnRpY2xlRmllbGRze1NlbmRlcn0tPntWYWx1ZX0gLy8gJyc7CiAgICAgICAgfQoKICAgICAgICAjIHNldCBPcmlnRnJvbSBmb3IgY29ycmVjdCBlbWFpbCBxdW90aW5nICh4eHh4IHdyb3RlKQogICAgICAgICREYXRhe09yaWdGcm9tfSA9ICREYXRhe0Zyb219OwoKICAgICAgICAjIGNoZWNrIGFydGljbGUgdHlwZSBhbmQgcmVwbGFjZSBUbyB3aXRoIEZyb20gKGluIGNhc2UpCiAgICAgICAgaWYgKCAkRGF0YXtTZW5kZXJUeXBlfSAhfiAvY3VzdG9tZXIvICkgewoKICAgICAgICAgICAgIyByZXBsYWNlIEZyb20vVG8sIFRvL0Zyb20gYmVjYXVzZSBzZW5kZXIgaXMgYWdlbnQKICAgICAgICAgICAgbXkgJFRvID0gJERhdGF7VG99OwogICAgICAgICAgICAkRGF0YXtUb30gICA9ICREYXRhe0Zyb219OwogICAgICAgICAgICAkRGF0YXtGcm9tfSA9ICRUbzsKCiAgICAgICAgICAgICREYXRhe1JlcGx5VG99ID0gJyc7CiAgICAgICAgfQoKICAgICAgICAjIGJ1aWxkIE9yaWdGcm9tTmFtZSAodG8gb25seSB1c2UgdGhlIHJlYWxuYW1lKQogICAgICAgICREYXRhe09yaWdGcm9tTmFtZX0gPSAkRGF0YXtPcmlnRnJvbX07CiAgICAgICAgJERhdGF7T3JpZ0Zyb21OYW1lfSA9fiBzLzwuKj58XCguKlwpfFwifDt8LC8vZzsKICAgICAgICAkRGF0YXtPcmlnRnJvbU5hbWV9ID1+IHMvKCAkKXwoICAkKS8vZzsKCiAgICAgICAgIyBGYWxsYmFjayB0byBPcmlnRnJvbSBpZiByZWFsbmFtZSBwYXJ0IGlzIGVtcHR5LgogICAgICAgIGlmICggISREYXRhe09yaWdGcm9tTmFtZX0gKSB7CiAgICAgICAgICAgICREYXRhe09yaWdGcm9tTmFtZX0gPSAkRGF0YXtPcmlnRnJvbX07CiAgICAgICAgfQoKICAgICAgICAjIGdldCBjdXN0b21lciBkYXRhCiAgICAgICAgbXkgJUN1c3RvbWVyOwogICAgICAgIGlmICggJFRpY2tldHtDdXN0b21lclVzZXJJRH0gKSB7CiAgICAgICAgICAgICVDdXN0b21lciA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDdXN0b21lclVzZXInKS0+Q3VzdG9tZXJVc2VyRGF0YUdldCgKICAgICAgICAgICAgICAgIFVzZXIgPT4gJFRpY2tldHtDdXN0b21lclVzZXJJRH0KICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgZ2V0IGFydGljbGUgdG8gcXVvdGUKICAgICAgICAkRGF0YXtCb2R5fSA9ICRMYXlvdXRPYmplY3QtPkFydGljbGVRdW90ZSgKICAgICAgICAgICAgVGlja2V0SUQgICAgICAgICAgPT4gJFNlbGYtPntUaWNrZXRJRH0sCiAgICAgICAgICAgIEFydGljbGVJRCAgICAgICAgID0+ICREYXRhe0FydGljbGVJRH0sCiAgICAgICAgICAgIEZvcm1JRCAgICAgICAgICAgID0+ICRTZWxmLT57Rm9ybUlEfSwKICAgICAgICAgICAgVXBsb2FkQ2FjaGVPYmplY3QgPT4gJFVwbG9hZENhY2hlT2JqZWN0LAogICAgICAgICk7CgogICAgICAgIG15ICVTYWZldHlDaGVja1Jlc3VsdCA9ICRIVE1MVXRpbHNPYmplY3QtPlNhZmV0eSgKICAgICAgICAgICAgU3RyaW5nID0+ICREYXRhe0JvZHl9LAoKICAgICAgICAgICAgIyBTdHJpcCBvdXQgZXh0ZXJuYWwgY29udGVudCBpZiBCbG9ja0xvYWRpbmdSZW1vdGVDb250ZW50IGlzIGVuYWJsZWQuCiAgICAgICAgICAgIE5vRXh0U3JjTG9hZCA9PiAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6OkJsb2NrTG9hZGluZ1JlbW90ZUNvbnRlbnQnKSwKCiAgICAgICAgICAgICMgRGlzYWxsb3cgcG90ZW50aWFsbHkgdW5zYWZlIGNvbnRlbnQuCiAgICAgICAgICAgIE5vQXBwbGV0ICAgICA9PiAxLAogICAgICAgICAgICBOb09iamVjdCAgICAgPT4gMSwKICAgICAgICAgICAgTm9FbWJlZCAgICAgID0+IDEsCiAgICAgICAgICAgIE5vU1ZHICAgICAgICA9PiAxLAogICAgICAgICAgICBOb0phdmFTY3JpcHQgPT4gMSwKICAgICAgICApOwogICAgICAgICREYXRhe0JvZHl9ID0gJFNhZmV0eUNoZWNrUmVzdWx0e1N0cmluZ307CgogICAgICAgICMgcmVzdHJpY3QgbnVtYmVyIG9mIGJvZHkgbGluZXMgaWYgY29uZmlndXJlZAogICAgICAgIG15ICRSZXNwb25zZVF1b3RlTWF4TGluZXMgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6OlJlc3BvbnNlUXVvdGVNYXhMaW5lcycpOwogICAgICAgIGlmICgKICAgICAgICAgICAgSXNTdHJpbmdXaXRoRGF0YSggJERhdGF7Qm9keX0gKQogICAgICAgICAgICAmJiAkUmVzcG9uc2VRdW90ZU1heExpbmVzCiAgICAgICAgICAgICkKICAgICAgICB7CiAgICAgICAgICAgICREYXRhe0JvZHl9ID0gJEhUTUxVdGlsc09iamVjdC0+VHJ1bmNhdGVCb2R5UXVvdGUoCiAgICAgICAgICAgICAgICBCb2R5ICAgICAgID0+ICREYXRhe0JvZHl9LAogICAgICAgICAgICAgICAgTGltaXQgICAgICA9PiAkUmVzcG9uc2VRdW90ZU1heExpbmVzLAogICAgICAgICAgICAgICAgSFRNTE91dHB1dCA9PiAkTGF5b3V0T2JqZWN0LT57QnJvd3NlclJpY2hUZXh0fSwKICAgICAgICAgICAgKSAvLyAkRGF0YXtCb2R5fTsKICAgICAgICB9CgogICAgICAgIGlmICggJExheW91dE9iamVjdC0+e0Jyb3dzZXJSaWNoVGV4dH0gKSB7CgogICAgICAgICAgICAjIHByZXBhcmUgYm9keSwgc3ViamVjdCwgUmVwbHlUbyAuLi4KICAgICAgICAgICAgIyByZXdyYXAgYm9keSBpZiBleGlzdHMKICAgICAgICAgICAgaWYgKCAkRGF0YXtCb2R5fSApIHsKICAgICAgICAgICAgICAgICREYXRhe0JvZHl9ID1+IHMvXHQvIC9nOwoKICAgICAgICAgICAgICAgIG15ICRRdW90ZSA9ICRMYXlvdXRPYmplY3QtPkFzY2lpMkh0bWwoCiAgICAgICAgICAgICAgICAgICAgVGV4dCAgICAgICAgICAgPT4gJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpRdW90ZScpIHx8ICcnLAogICAgICAgICAgICAgICAgICAgIEhUTUxSZXN1bHRNb2RlID0+IDEsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgaWYgKCRRdW90ZSkgewoKICAgICAgICAgICAgICAgICAgICAjIHF1b3RlIHRleHQKICAgICAgICAgICAgICAgICAgICAkRGF0YXtCb2R5fSA9ICI8YmxvY2txdW90ZSB0eXBlPVwiY2l0ZVwiPiREYXRhe0JvZHl9PC9ibG9ja3F1b3RlPlxuIjsKCiAgICAgICAgICAgICAgICAgICAgIyBjbGVhbnVwIG5vdCBjb21wYXQuIHRhZ3MKICAgICAgICAgICAgICAgICAgICAkRGF0YXtCb2R5fSA9ICRMYXlvdXRPYmplY3QtPlJpY2hUZXh0RG9jdW1lbnRDbGVhbnVwKAogICAgICAgICAgICAgICAgICAgICAgICBTdHJpbmcgPT4gJERhdGF7Qm9keX0sCiAgICAgICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkRGF0YXtCb2R5fSA9ICI8YnIvPiIgLiAkRGF0YXtCb2R5fTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCAkRGF0YXtDcmVhdGVUaW1lfSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJERhdGF7Qm9keX0gPSAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoJ0RhdGUnKSAuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiOiAkRGF0YXtDcmVhdGVUaW1lfTxici8+IiAuICREYXRhe0JvZHl9OwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgZm9yIG15ICRLZXkgKHF3KFN1YmplY3QgUmVwbHlUbyBSZXBseS1UbyBDYyBUbyBGcm9tKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoICREYXRheyRLZXl9ICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERhdGF7Qm9keX0gPSAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoJEtleSkgLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICI6ICREYXRheyRLZXl9PGJyLz4iIC4gJERhdGF7Qm9keX07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIG15ICRGcm9tID0gJExheW91dE9iamVjdC0+QXNjaWkyUmljaFRleHQoCiAgICAgICAgICAgICAgICAgICAgICAgIFN0cmluZyA9PiAkRGF0YXtGcm9tfSwKICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICAgICBteSAkTWVzc2FnZUZyb20gPSAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoJ01lc3NhZ2UgZnJvbScpOwogICAgICAgICAgICAgICAgICAgIG15ICRFbmRNZXNzYWdlICA9ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgnRW5kIG1lc3NhZ2UnKTsKCiAgICAgICAgICAgICAgICAgICAgJERhdGF7Qm9keX0gPSAiPGJyLz4tLS0tICRNZXNzYWdlRnJvbSAkRnJvbSAtLS08YnIvPjxici8+IiAuICREYXRhe0JvZHl9OwogICAgICAgICAgICAgICAgICAgICREYXRhe0JvZHl9IC49ICI8YnIvPi0tLS0gJEVuZE1lc3NhZ2UgLS0tPGJyLz4iOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewoKICAgICAgICAgICAgIyBwcmVwYXJlIGJvZHksIHN1YmplY3QsIFJlcGx5VG8gLi4uCiAgICAgICAgICAgICMgcmUtd3JhcCBib2R5IGlmIGV4aXN0cwogICAgICAgICAgICBpZiAoICREYXRhe0JvZHl9ICkgewogICAgICAgICAgICAgICAgJERhdGF7Qm9keX0gPX4gcy9cdC8gL2c7CgogICAgICAgICAgICAgICAgbXkgJFF1b3RlID0gJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpRdW90ZScpOwogICAgICAgICAgICAgICAgaWYgKCRRdW90ZSkgewogICAgICAgICAgICAgICAgICAgICREYXRhe0JvZHl9ID1+IHMvXG4vXG4kUXVvdGUgL2c7CiAgICAgICAgICAgICAgICAgICAgJERhdGF7Qm9keX0gPSAiXG4kUXVvdGUgIiAuICREYXRhe0JvZHl9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJERhdGF7Qm9keX0gPSAiXG4iIC4gJERhdGF7Qm9keX07CiAgICAgICAgICAgICAgICAgICAgaWYgKCAkRGF0YXtDcmVhdGVUaW1lfSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJERhdGF7Qm9keX0gPSAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoJ0RhdGUnKSAuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiOiAkRGF0YXtDcmVhdGVUaW1lfVxuIiAuICREYXRhe0JvZHl9OwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgZm9yIG15ICRLZXkgKHF3KFN1YmplY3QgUmVwbHlUbyBSZXBseS1UbyBDYyBUbyBGcm9tKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoICREYXRheyRLZXl9ICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERhdGF7Qm9keX0gPSAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoJEtleSkgLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICI6ICREYXRheyRLZXl9XG4iIC4gJERhdGF7Qm9keX07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIG15ICRNZXNzYWdlRnJvbSA9ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgnTWVzc2FnZSBmcm9tJyk7CiAgICAgICAgICAgICAgICAgICAgbXkgJEVuZE1lc3NhZ2UgID0gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCdFbmQgbWVzc2FnZScpOwoKICAgICAgICAgICAgICAgICAgICAkRGF0YXtCb2R5fSA9ICJcbi0tLS0gJE1lc3NhZ2VGcm9tICREYXRhe0Zyb219IC0tLVxuXG4iIC4gJERhdGF7Qm9keX07CiAgICAgICAgICAgICAgICAgICAgJERhdGF7Qm9keX0gLj0gIlxuLS0tLSAkRW5kTWVzc2FnZSAtLS1cbiI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgZ2V0IHN5c3RlbSBhZGRyZXNzIG9iamVjdAogICAgICAgIG15ICRTeXN0ZW1BZGRyZXNzID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlN5c3RlbUFkZHJlc3MnKTsKCiAgICAgICAgIyBhZGQgbm90IGxvY2FsIFRvIGFkZHJlc3NlcyB0byBDYwogICAgICAgIGZvciBteSAkRW1haWwgKCBNYWlsOjpBZGRyZXNzLT5wYXJzZSggJERhdGF7VG99ICkgKSB7CiAgICAgICAgICAgIG15ICRJc0xvY2FsID0gJFN5c3RlbUFkZHJlc3MtPlN5c3RlbUFkZHJlc3NJc0xvY2FsQWRkcmVzcygKICAgICAgICAgICAgICAgIEFkZHJlc3MgPT4gJEVtYWlsLT5hZGRyZXNzKCksCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGlmICggISRJc0xvY2FsICkgewogICAgICAgICAgICAgICAgaWYgKCAkRGF0YXtDY30gKSB7CiAgICAgICAgICAgICAgICAgICAgJERhdGF7Q2N9IC49ICcsICc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkRGF0YXtDY30gLj0gJEVtYWlsLT5mb3JtYXQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBjaGVjayBSZXBseVRvCiAgICAgICAgaWYgKCAkRGF0YXtSZXBseVRvfSApIHsKICAgICAgICAgICAgJERhdGF7VG99ID0gJERhdGF7UmVwbHlUb307CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkRGF0YXtUb30gPSAkRGF0YXtGcm9tfTsKCiAgICAgICAgICAgICMgdHJ5IHRvIHJlbW92ZSBzb21lIHdyb25nIHRleHQgdG8gZnJvbSBsaW5lIChieSB3YXkgb2YgLi4uKQogICAgICAgICAgICAjIGFkZGVkIGJ5IHNvbWUgc3RyYW5nZSBtYWlsIHByb2dyYW1zIG9uIGJvdW5jZQogICAgICAgICAgICAkRGF0YXtUb30gPX4gcy8oLis/XDwuKz9cQC4rP1w+KVxzK1woYnlccyt3YXlccytvZlxzKy4rP1wpLyQxL2lnOwogICAgICAgIH0KCiAgICAgICAgIyBnZXQgdG8gZW1haWwgKGp1c3QgInNvbWVAZXhhbXBsZS5jb20iKQogICAgICAgIGZvciBteSAkRW1haWwgKCBNYWlsOjpBZGRyZXNzLT5wYXJzZSggJERhdGF7VG99ICkgKSB7CiAgICAgICAgICAgICREYXRhe1RvRW1haWx9ID0gJEVtYWlsLT5hZGRyZXNzKCk7CiAgICAgICAgfQoKICAgICAgICAjIG9ubHkgcmVwbHkgdG8gc2VuZGVyCiAgICAgICAgaWYgKCAhJEdldFBhcmFte1JlcGx5QWxsfSApIHsKICAgICAgICAgICAgJERhdGF7Q2N9ICA9ICcnOwogICAgICAgICAgICAkRGF0YXtCY2N9ID0gJyc7CiAgICAgICAgfQoKICAgICAgICAjIHVzZSBjdXN0b21lciBkYXRhYmFzZSBlbWFpbAogICAgICAgICMgZG8gbm90IGFkZCBjdXN0b21lciBlbWFpbCB0byBjYywgaWYgYXJ0aWNsZSBpcyB2aXNpYmxlIGZvciBjdXN0b21lcgogICAgICAgIGlmICgKICAgICAgICAgICAgJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpDb21wb3NlQWRkQ3VzdG9tZXJBZGRyZXNzJykKICAgICAgICAgICAgJiYgJERhdGF7SXNWaXNpYmxlRm9yQ3VzdG9tZXJ9CiAgICAgICAgICAgICkKICAgICAgICB7CiAgICAgICAgICAgICMgY2hlY2sgaWYgY3VzdG9tZXIgaXMgaW4gcmVjaXBpZW50IGxpc3QKICAgICAgICAgICAgaWYgKCAkQ3VzdG9tZXJ7VXNlckVtYWlsfSAmJiAkRGF0YXtUb0VtYWlsfSAhfiAvXlxRJEN1c3RvbWVye1VzZXJFbWFpbH1cRSQvaSApIHsKCiAgICAgICAgICAgICAgICBpZiAoICREYXRhe1NlbmRlclR5cGV9IGVxICdhZ2VudCcgJiYgISREYXRhe0lzVmlzaWJsZUZvckN1c3RvbWVyfSApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoICREYXRhe1RvfSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJERhdGF7VG99IC49ICcsICcgLiAkQ3VzdG9tZXJ7VXNlckVtYWlsfTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICREYXRhe1RvfSA9ICRDdXN0b21lcntVc2VyRW1haWx9OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIHJlcGxhY2UgVG8gd2l0aCBjdXN0b21lcnMgZGF0YWJhc2UgYWRkcmVzcwogICAgICAgICAgICAgICAgZWxzaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6OkNvbXBvc2VSZXBsYWNlU2VuZGVyQWRkcmVzcycpICkgewoKICAgICAgICAgICAgICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk5vdGlmeSgKICAgICAgICAgICAgICAgICAgICAgICAgRGF0YSA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQWRkcmVzcyAlcyByZXBsYWNlZCB3aXRoIHJlZ2lzdGVyZWQgY3VzdG9tZXIgYWRkcmVzcy4nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJERhdGF7VG9FbWFpbH0sCiAgICAgICAgICAgICAgICAgICAgICAgICksCgogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgJERhdGF7VG99ID0gJEN1c3RvbWVye1VzZXJFbWFpbH07CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBhZGQgY3VzdG9tZXJzIGRhdGFiYXNlIGFkZHJlc3MgdG8gQ2MKICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Tm90aWZ5KAogICAgICAgICAgICAgICAgICAgICAgICBJbmZvID0+IFRyYW5zbGF0YWJsZSgiQ3VzdG9tZXIgdXNlciBhdXRvbWF0aWNhbGx5IGFkZGVkIGluIENjLiIpLAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCAkRGF0YXtDY30gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICREYXRhe0NjfSAuPSAnLCAnIC4gJEN1c3RvbWVye1VzZXJFbWFpbH07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAkRGF0YXtDY30gPSAkQ3VzdG9tZXJ7VXNlckVtYWlsfTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgZmluZCBkdXBsaWNhdGUgYWRkcmVzc2VzCiAgICAgICAgbXkgJVJlY2lwaWVudDsKICAgICAgICBmb3IgbXkgJFR5cGUgKHF3KFRvIENjIEJjYykpIHsKICAgICAgICAgICAgaWYgKCAkRGF0YXskVHlwZX0gKSB7CiAgICAgICAgICAgICAgICBteSAkTmV3TGluZSA9ICcnOwogICAgICAgICAgICAgICAgZm9yIG15ICRFbWFpbCAoIE1haWw6OkFkZHJlc3MtPnBhcnNlKCAkRGF0YXskVHlwZX0gKSApIHsKICAgICAgICAgICAgICAgICAgICBteSAkQWRkcmVzcyA9IGxjICRFbWFpbC0+YWRkcmVzcygpOwoKICAgICAgICAgICAgICAgICAgICAjIG9ubHkgdXNlIGVtYWlsIGFkZHJlc3NlcyB3aXRoIEAgaW5zaWRlCiAgICAgICAgICAgICAgICAgICAgaWYgKCAkQWRkcmVzcyAmJiAkQWRkcmVzcyA9fiAvQC8gJiYgISRSZWNpcGllbnR7JEFkZHJlc3N9ICkgewogICAgICAgICAgICAgICAgICAgICAgICAkUmVjaXBpZW50eyRBZGRyZXNzfSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIG15ICRJc0xvY2FsID0gJFN5c3RlbUFkZHJlc3MtPlN5c3RlbUFkZHJlc3NJc0xvY2FsQWRkcmVzcygKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFkZHJlc3MgPT4gJEFkZHJlc3MsCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggISRJc0xvY2FsICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCROZXdMaW5lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE5ld0xpbmUgLj0gJywgJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICROZXdMaW5lIC49ICRFbWFpbC0+Zm9ybWF0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkRGF0YXskVHlwZX0gPSAkTmV3TGluZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBnZXQgdGVtcGxhdGUKICAgICAgICBteSAkVGVtcGxhdGVHZW5lcmF0b3IgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGVtcGxhdGVHZW5lcmF0b3InKTsKCiAgICAgICAgIyB1c2Uga2V5IFN0ZFJlc3BvbnNlIHRvIHBhc3MgdGhlIGRhdGEgdG8gdGhlIHRlbXBsYXRlIGZvciBsZWdhY3kgcmVhc29ucywKICAgICAgICAjICAgYmVjYXVzZSBleGlzdGluZyBzeXN0ZW1zIG1heSBoYXZlIGl0IGluIHRoZWlyIGNvbmZpZ3VyYXRpb24gYXMgdGhhdCB3YXMKICAgICAgICAjICAgdGhlIGtleSB1c2VkIGJlZm9yZSB0aGUgaW50ZXJuYWwgc3dpdGNoIHRvIFN0YW5kYXJkUmVzcG9uc2UgQW5kIFN0YW5kYXJkVGVtcGxhdGUKCiAgICAgICAgJERhdGF7U3RkUmVzcG9uc2V9ID0gJFRlbXBsYXRlR2VuZXJhdG9yLT5UZW1wbGF0ZSgKICAgICAgICAgICAgVGlja2V0SUQgICA9PiAkU2VsZi0+e1RpY2tldElEfSwKICAgICAgICAgICAgQXJ0aWNsZUlEICA9PiAkR2V0UGFyYW17QXJ0aWNsZUlEfSwKICAgICAgICAgICAgVGVtcGxhdGVJRCA9PiAkR2V0UGFyYW17UmVzcG9uc2VJRH0sCiAgICAgICAgICAgIERhdGEgICAgICAgPT4gXCVEYXRhLAogICAgICAgICAgICBVc2VySUQgICAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICApOwoKICAgICAgICAjIGdldCBzYWx1dGF0aW9uCiAgICAgICAgJERhdGF7U2FsdXRhdGlvbn0gPSAkVGVtcGxhdGVHZW5lcmF0b3ItPlNhbHV0YXRpb24oCiAgICAgICAgICAgIFRpY2tldElEID0+ICRTZWxmLT57VGlja2V0SUR9LAogICAgICAgICAgICBEYXRhICAgICA9PiBcJURhdGEsCiAgICAgICAgICAgIFVzZXJJRCAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICApOwoKICAgICAgICAjIGdldCBzaWduYXR1cmUKICAgICAgICAkRGF0YXtTaWduYXR1cmV9ID0gJFRlbXBsYXRlR2VuZXJhdG9yLT5TaWduYXR1cmUoCiAgICAgICAgICAgIFRpY2tldElEID0+ICRTZWxmLT57VGlja2V0SUR9LAogICAgICAgICAgICBEYXRhICAgICA9PiBcJURhdGEsCiAgICAgICAgICAgIFVzZXJJRCAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICApOwoKICAgICAgICAjICRUZW1wbGF0ZUdlbmVyYXRvci0+QXR0cmlidXRlcygpIGRvZXMgbm90IG92ZXJ3cml0ZSAlRGF0YSwgYnV0IGl0IGFkZHMgbW9yZSBrZXlzCiAgICAgICAgJURhdGEgPSAkVGVtcGxhdGVHZW5lcmF0b3ItPkF0dHJpYnV0ZXMoCiAgICAgICAgICAgIFRpY2tldElEICA9PiAkU2VsZi0+e1RpY2tldElEfSwKICAgICAgICAgICAgQXJ0aWNsZUlEID0+ICRHZXRQYXJhbXtBcnRpY2xlSUR9LAogICAgICAgICAgICBEYXRhICAgICAgPT4gXCVEYXRhLAogICAgICAgICAgICBVc2VySUQgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICk7CgogICAgICAgIG15ICRSZXNwb25zZUZvcm1hdCA9ICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpGcm9udGVuZDo6UmVzcG9uc2VGb3JtYXQnKTsKCiAgICAgICAgIyBtYWtlIHN1cmUgYm9keSBpcyByaWNoIHRleHQKICAgICAgICBteSAlRGF0YUhUTUwgPSAlRGF0YTsKICAgICAgICBpZiAoICRMYXlvdXRPYmplY3QtPntCcm93c2VyUmljaFRleHR9ICkgewogICAgICAgICAgICBpZiAoJFJlc3BvbnNlRm9ybWF0KSB7CiAgICAgICAgICAgICAgICAkUmVzcG9uc2VGb3JtYXQgPSAkTGF5b3V0T2JqZWN0LT5Bc2NpaTJSaWNoVGV4dCgKICAgICAgICAgICAgICAgICAgICBTdHJpbmcgPT4gJFJlc3BvbnNlRm9ybWF0LAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAjIHJlc3RvcmUgcWRhdGEgZm9ybWF0dGluZyBmb3IgT3V0cHV0IHJlcGxhY2VtZW50CiAgICAgICAgICAgICAgICAkUmVzcG9uc2VGb3JtYXQgPX4gcy8mcXVvdDsvIi9naTsKCiAgICAgICAgICAgICAgICAjIGh0bWwgcXVvdGUgdG8gaGF2ZSBpdCBjb3JyZWN0IGluIGVkaXQgYXJlYQogICAgICAgICAgICAgICAgJFJlc3BvbnNlRm9ybWF0ID0gJExheW91dE9iamVjdC0+QXNjaWkySHRtbCgKICAgICAgICAgICAgICAgICAgICBUZXh0ID0+ICRSZXNwb25zZUZvcm1hdCwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgIyByZXN0b3JlIHFkYXRhIGZvcm1hdHRpbmcgZm9yIE91dHB1dCByZXBsYWNlbWVudAogICAgICAgICAgICAgICAgJFJlc3BvbnNlRm9ybWF0ID1+IHMvJnF1b3Q7LyIvZ2k7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgcXVvdGUgYWxsIG5vbiBodG1sIGNvbnRlbnQgdG8gaGF2ZSBpdCBjb3JyZWN0IGluIGVkaXQgYXJlYQogICAgICAgICAgICBLRVk6CiAgICAgICAgICAgIGZvciBteSAkS2V5ICggc29ydCBrZXlzICVEYXRhSFRNTCApIHsKICAgICAgICAgICAgICAgIG5leHQgS0VZIGlmICEkRGF0YUhUTUx7JEtleX07CiAgICAgICAgICAgICAgICBuZXh0IEtFWSBpZiAkS2V5IGVxICdTYWx1dGF0aW9uJzsKICAgICAgICAgICAgICAgIG5leHQgS0VZIGlmICRLZXkgZXEgJ0JvZHknOwogICAgICAgICAgICAgICAgbmV4dCBLRVkgaWYgJEtleSBlcSAnU3RkUmVzcG9uc2UnOwogICAgICAgICAgICAgICAgbmV4dCBLRVkgaWYgJEtleSBlcSAnU2lnbmF0dXJlJzsKICAgICAgICAgICAgICAgICREYXRhSFRNTHskS2V5fSA9ICRMYXlvdXRPYmplY3QtPkFzY2lpMlJpY2hUZXh0KAogICAgICAgICAgICAgICAgICAgIFN0cmluZyA9PiAkRGF0YUhUTUx7JEtleX0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIGJ1aWxkIG5ldyByZXBzb25zZSBmb3JtYXQgYmFzZWQgb24gdGVtcGxhdGUKICAgICAgICAkRGF0YXtSZXNwb25zZUZvcm1hdH0gPSAkTGF5b3V0T2JqZWN0LT5PdXRwdXQoCiAgICAgICAgICAgIFRlbXBsYXRlID0+ICRSZXNwb25zZUZvcm1hdCwKICAgICAgICAgICAgRGF0YSAgICAgPT4geyAlUGFyYW0sICVEYXRhSFRNTCB9LAogICAgICAgICk7CgogICAgICAgICMgY2hlY2sgc29tZSB2YWx1ZXMKICAgICAgICBteSAlRXJyb3I7CiAgICAgICAgTElORToKICAgICAgICBmb3IgbXkgJExpbmUgKHF3KFRvIENjIEJjYykpIHsKICAgICAgICAgICAgbmV4dCBMSU5FIGlmICEkRGF0YXskTGluZX07CiAgICAgICAgICAgIGZvciBteSAkRW1haWwgKCBNYWlsOjpBZGRyZXNzLT5wYXJzZSggJERhdGF7JExpbmV9ICkgKSB7CiAgICAgICAgICAgICAgICBpZiAoICEkQ2hlY2tJdGVtT2JqZWN0LT5DaGVja0VtYWlsKCBBZGRyZXNzID0+ICRFbWFpbC0+YWRkcmVzcygpICkgKSB7CiAgICAgICAgICAgICAgICAgICAgJEVycm9yeyAkTGluZSAuICJJbnZhbGlkIiB9ID0gIiBTZXJ2ZXJFcnJvciI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCAkRGF0YXtGcm9tfSApIHsKICAgICAgICAgICAgZm9yIG15ICRFbWFpbCAoIE1haWw6OkFkZHJlc3MtPnBhcnNlKCAkRGF0YXtGcm9tfSApICkgewogICAgICAgICAgICAgICAgaWYgKCAhJENoZWNrSXRlbU9iamVjdC0+Q2hlY2tFbWFpbCggQWRkcmVzcyA9PiAkRW1haWwtPmFkZHJlc3MoKSApICkgewogICAgICAgICAgICAgICAgICAgICRFcnJvcnsiRnJvbUludmFsaWQifSAuPSAkQ2hlY2tJdGVtT2JqZWN0LT5DaGVja0Vycm9yKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgY3JlYXRlIGh0bWwgc3RyaW5ncyBmb3IgYWxsIGR5bmFtaWMgZmllbGRzCiAgICAgICAgbXkgJUR5bmFtaWNGaWVsZEhUTUw7CgogICAgICAgICMgY3ljbGUgdHJvdWdoIHRoZSBhY3RpdmF0ZWQgRHluYW1pYyBGaWVsZHMgZm9yIHRoaXMgc2NyZWVuCiAgICAgICAgRFlOQU1JQ0ZJRUxEOgogICAgICAgIGZvciBteSAkRHluYW1pY0ZpZWxkQ29uZmlnICggQHskRHluYW1pY0ZpZWxkfSApIHsKICAgICAgICAgICAgbmV4dCBEWU5BTUlDRklFTEQgaWYgIUlzSGFzaFJlZldpdGhEYXRhKCREeW5hbWljRmllbGRDb25maWcpOwoKICAgICAgICAgICAgbXkgJFBvc3NpYmxlVmFsdWVzRmlsdGVyOwoKICAgICAgICAgICAgbXkgJElzQUNMUmVkdWNpYmxlID0gJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QtPkhhc0JlaGF2aW9yKAogICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRDb25maWcsCiAgICAgICAgICAgICAgICBCZWhhdmlvciAgICAgICAgICAgPT4gJ0lzQUNMUmVkdWNpYmxlJywKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGlmICgkSXNBQ0xSZWR1Y2libGUpIHsKCiAgICAgICAgICAgICAgICAjIGdldCBQb3NzaWJsZVZhbHVlcwogICAgICAgICAgICAgICAgbXkgJFBvc3NpYmxlVmFsdWVzID0gJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QtPlBvc3NpYmxlVmFsdWVzR2V0KAogICAgICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZENvbmZpZyA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnLAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAjIGNoZWNrIGlmIGZpZWxkIGhhcyBQb3NzaWJsZVZhbHVlcyBwcm9wZXJ0eSBpbiBpdHMgY29uZmlndXJhdGlvbgogICAgICAgICAgICAgICAgaWYgKCBJc0hhc2hSZWZXaXRoRGF0YSgkUG9zc2libGVWYWx1ZXMpICkgewoKICAgICAgICAgICAgICAgICAgICAjIGNvbnZlcnQgcG9zc2libGUgdmFsdWVzIGtleSA9PiB2YWx1ZSB0byBrZXkgPT4ga2V5IGZvciBBQ0xzIHVzaW5nIGEgSGFzaCBzbGljZQogICAgICAgICAgICAgICAgICAgIG15ICVBY2xEYXRhID0gJXskUG9zc2libGVWYWx1ZXN9OwogICAgICAgICAgICAgICAgICAgIEBBY2xEYXRheyBrZXlzICVBY2xEYXRhIH0gPSBrZXlzICVBY2xEYXRhOwoKICAgICAgICAgICAgICAgICAgICAjIHNldCBwb3NzaWJsZSB2YWx1ZXMgZmlsdGVyIGZyb20gQUNMcwogICAgICAgICAgICAgICAgICAgIG15ICRBQ0wgPSAkVGlja2V0T2JqZWN0LT5UaWNrZXRBY2woCiAgICAgICAgICAgICAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgICAgICAgICAgICAgQWN0aW9uICAgICAgICA9PiAkU2VsZi0+e0FjdGlvbn0sCiAgICAgICAgICAgICAgICAgICAgICAgIFRpY2tldElEICAgICAgPT4gJFNlbGYtPntUaWNrZXRJRH0sCiAgICAgICAgICAgICAgICAgICAgICAgIFJldHVyblR5cGUgICAgPT4gJ1RpY2tldCcsCiAgICAgICAgICAgICAgICAgICAgICAgIFJldHVyblN1YlR5cGUgPT4gJ0R5bmFtaWNGaWVsZF8nIC4gJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9LAogICAgICAgICAgICAgICAgICAgICAgICBEYXRhICAgICAgICAgID0+IFwlQWNsRGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgVXNlcklEICAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICBpZiAoJEFDTCkgewogICAgICAgICAgICAgICAgICAgICAgICBteSAlRmlsdGVyID0gJFRpY2tldE9iamVjdC0+VGlja2V0QWNsRGF0YSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgIyBjb252ZXJ0IEZpbGVyIGtleSA9PiBrZXkgYmFjayB0byBrZXkgPT4gdmFsdWUgdXNpbmcgbWFwCiAgICAgICAgICAgICAgICAgICAgICAgICV7JFBvc3NpYmxlVmFsdWVzRmlsdGVyfSA9IG1hcCB7ICRfID0+ICRQb3NzaWJsZVZhbHVlcy0+eyRffSB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXlzICVGaWx0ZXI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIHRvIHN0b3JlIGR5bmFtaWMgZmllbGQgdmFsdWUgZnJvbSBkYXRhYmFzZSAob3IgdW5kZWZpbmVkKQogICAgICAgICAgICBteSAkVmFsdWU7CgogICAgICAgICAgICAjIG9ubHkgZ2V0IHZhbHVlcyBmb3IgVGlja2V0IGZpZWxkcyAoYWxsIHNjcmVlbnMgYmFzZWQgb24gQWdlbnRUaWNrZUFjdGlvbkNvbW1vbgogICAgICAgICAgICAjIGdlbmVyYXRlcyBhIG5ldyBhcnRpY2xlLCB0aGVuIGFydGljbGUgZmllbGRzIHdpbGwgYmUgYWx3YXlzIGVtcHR5IGF0IHRoZSBiZWdpbmlnbikKICAgICAgICAgICAgaWYgKCAkRHluYW1pY0ZpZWxkQ29uZmlnLT57T2JqZWN0VHlwZX0gZXEgJ1RpY2tldCcgKSB7CgogICAgICAgICAgICAgICAgIyBnZXQgdmFsdWUgc3RvcmVkIG9uIHRoZSBkYXRhYmFzZSBmcm9tIFRpY2tldAogICAgICAgICAgICAgICAgJFZhbHVlID0gJFRpY2tldHsgJ0R5bmFtaWNGaWVsZF8nIC4gJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9IH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgZ2V0IGZpZWxkIGh0bWwKICAgICAgICAgICAgJER5bmFtaWNGaWVsZEhUTUx7ICREeW5hbWljRmllbGRDb25maWctPntOYW1lfSB9ID0KICAgICAgICAgICAgICAgICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0LT5FZGl0RmllbGRSZW5kZXIoCiAgICAgICAgICAgICAgICBEeW5hbWljRmllbGRDb25maWcgICA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnLAogICAgICAgICAgICAgICAgUG9zc2libGVWYWx1ZXNGaWx0ZXIgPT4gJFBvc3NpYmxlVmFsdWVzRmlsdGVyLAogICAgICAgICAgICAgICAgVmFsdWUgICAgICAgICAgICAgICAgPT4gJFZhbHVlLAogICAgICAgICAgICAgICAgTWFuZGF0b3J5ID0+CiAgICAgICAgICAgICAgICAgICAgJENvbmZpZy0+e0R5bmFtaWNGaWVsZH0tPnsgJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9IH0gPT0gMiwKICAgICAgICAgICAgICAgIExheW91dE9iamVjdCAgICA9PiAkTGF5b3V0T2JqZWN0LAogICAgICAgICAgICAgICAgUGFyYW1PYmplY3QgICAgID0+ICRQYXJhbU9iamVjdCwKICAgICAgICAgICAgICAgIEFKQVhVcGRhdGUgICAgICA9PiAxLAogICAgICAgICAgICAgICAgVXBkYXRhYmxlRmllbGRzID0+ICRTZWxmLT5fR2V0RmllbGRzVG9VcGRhdGUoKSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIGJ1aWxkIHJlZmVyZW5jZXMgaWYgZXhpc3QKICAgICAgICBteSAkUmVmZXJlbmNlcyA9ICggJERhdGF7TWVzc2FnZUlEfSB8fCAnJyApIC4gKCAkRGF0YXtSZWZlcmVuY2VzfSB8fCAnJyApOwoKICAgICAgICAjIHJ1biBjb21wb3NlIG1vZHVsZXMKICAgICAgICBpZiAoIHJlZiAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6OkFydGljbGVDb21wb3NlTW9kdWxlJykgZXEgJ0hBU0gnICkgewoKICAgICAgICAgICAgIyB1c2UgdGlja2V0IFF1ZXVlSUQgaW4gY29tcG9zZSBtb2R1bGVzCiAgICAgICAgICAgICRHZXRQYXJhbXtRdWV1ZUlEfSA9ICRUaWNrZXR7UXVldWVJRH07CgogICAgICAgICAgICBteSAlSm9icyA9ICV7ICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpGcm9udGVuZDo6QXJ0aWNsZUNvbXBvc2VNb2R1bGUnKSB9OwogICAgICAgICAgICBmb3IgbXkgJEpvYiAoIHNvcnQga2V5cyAlSm9icyApIHsKCiAgICAgICAgICAgICAgICAjIGxvYWQgbW9kdWxlCiAgICAgICAgICAgICAgICBpZiAoICEkTWFpbk9iamVjdC0+UmVxdWlyZSggJEpvYnN7JEpvYn0tPntNb2R1bGV9ICkgKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkZhdGFsRXJyb3IoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG15ICRPYmplY3QgPSAkSm9ic3skSm9ifS0+e01vZHVsZX0tPm5ldyggJXskU2VsZn0sIERlYnVnID0+ICRTZWxmLT57RGVidWd9ICk7CgogICAgICAgICAgICAgICAgIyBnZXQgcGFyYW1zCiAgICAgICAgICAgICAgICBQQVJBTUVURVI6CiAgICAgICAgICAgICAgICBmb3IgbXkgJFBhcmFtZXRlciAoICRPYmplY3QtPk9wdGlvbiggJUdldFBhcmFtLCBDb25maWcgPT4gJEpvYnN7JEpvYn0gKSApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoICRKb2JzeyRKb2J9LT57UGFyYW1UeXBlfSAmJiAkSm9ic3skSm9ifS0+e1BhcmFtVHlwZX0gbmUgJ1NpbmdsZScgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIEB7ICRHZXRQYXJhbXskUGFyYW1ldGVyfSB9ID0gJFBhcmFtT2JqZWN0LT5HZXRBcnJheSggUGFyYW0gPT4gJFBhcmFtZXRlciApOwogICAgICAgICAgICAgICAgICAgICAgICBuZXh0IFBBUkFNRVRFUjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICRHZXRQYXJhbXskUGFyYW1ldGVyfSA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICRQYXJhbWV0ZXIgKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIHJ1biBtb2R1bGUKICAgICAgICAgICAgICAgIG15ICROZXdQYXJhbXMgPSAkT2JqZWN0LT5SdW4oICVHZXRQYXJhbSwgQ29uZmlnID0+ICRKb2JzeyRKb2J9ICk7CgogICAgICAgICAgICAgICAgaWYgKCROZXdQYXJhbXMpIHsKICAgICAgICAgICAgICAgICAgICBmb3IgbXkgJFBhcmFtZXRlciAoICRPYmplY3QtPk9wdGlvbiggJUdldFBhcmFtLCBDb25maWcgPT4gJEpvYnN7JEpvYn0gKSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJEdldFBhcmFteyRQYXJhbWV0ZXJ9ID0gJE5ld1BhcmFtczsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBnZXQgZXJyb3JzCiAgICAgICAgICAgICAgICAlRXJyb3IgPSAoCiAgICAgICAgICAgICAgICAgICAgJUVycm9yLAogICAgICAgICAgICAgICAgICAgICRPYmplY3QtPkVycm9yKCAlR2V0UGFyYW0sIENvbmZpZyA9PiAkSm9ic3skSm9ifSApLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBidWlsZCB2aWV3IC4uLgogICAgICAgICRPdXRwdXQgLj0gJFNlbGYtPl9NYXNrKAogICAgICAgICAgICBUaWNrZXRJRCAgID0+ICRTZWxmLT57VGlja2V0SUR9LAogICAgICAgICAgICBOZXh0U3RhdGVzID0+ICRTZWxmLT5fR2V0TmV4dFN0YXRlcygKICAgICAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgKSwKICAgICAgICAgICAgQXR0YWNobWVudHMgICAgICAgICA9PiBcQEF0dGFjaG1lbnRzLAogICAgICAgICAgICBFcnJvcnMgICAgICAgICAgICAgID0+IFwlRXJyb3IsCiAgICAgICAgICAgIE11bHRpcGxlQ3VzdG9tZXIgICAgPT4gXEBNdWx0aXBsZUN1c3RvbWVyLAogICAgICAgICAgICBNdWx0aXBsZUN1c3RvbWVyQ2MgID0+IFxATXVsdGlwbGVDdXN0b21lckNjLAogICAgICAgICAgICBNdWx0aXBsZUN1c3RvbWVyQmNjID0+IFxATXVsdGlwbGVDdXN0b21lckJjYywKICAgICAgICAgICAgR2V0UGFyYW0gICAgICAgICAgICA9PiBcJUdldFBhcmFtLAogICAgICAgICAgICBSZXNwb25zZUlEICAgICAgICAgID0+ICRHZXRQYXJhbXtSZXNwb25zZUlEfSwKICAgICAgICAgICAgUmVwbHlBcnRpY2xlSUQgICAgICA9PiAkR2V0UGFyYW17QXJ0aWNsZUlEfSwKICAgICAgICAgICAgJVRpY2tldCwKICAgICAgICAgICAgJURhdGEsCiAgICAgICAgICAgIEluUmVwbHlUbyAgICAgICAgPT4gJERhdGF7TWVzc2FnZUlEfSwKICAgICAgICAgICAgUmVmZXJlbmNlcyAgICAgICA9PiAiJFJlZmVyZW5jZXMiLAogICAgICAgICAgICBUaWNrZXRCYWNrVHlwZSAgID0+ICRUaWNrZXRCYWNrVHlwZSwKICAgICAgICAgICAgRHluYW1pY0ZpZWxkSFRNTCA9PiBcJUR5bmFtaWNGaWVsZEhUTUwsCiAgICAgICAgKTsKICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPkZvb3RlcigKICAgICAgICAgICAgVHlwZSA9PiAnU21hbGwnLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuICRPdXRwdXQ7CiAgICB9Cn0KCnN1YiBfR2V0TmV4dFN0YXRlcyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgZ2V0IG5leHQgc3RhdGVzCiAgICBteSAlTmV4dFN0YXRlcyA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpUaWNrZXQnKS0+VGlja2V0U3RhdGVMaXN0KAogICAgICAgICVQYXJhbSwKICAgICAgICBBY3Rpb24gICA9PiAkU2VsZi0+e0FjdGlvbn0sCiAgICAgICAgVGlja2V0SUQgPT4gJFNlbGYtPntUaWNrZXRJRH0sCiAgICAgICAgVXNlcklEICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgKTsKICAgIHJldHVybiBcJU5leHRTdGF0ZXM7Cn0KCnN1YiBfTWFzayB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICREeW5hbWljRmllbGROYW1lcyA9ICRTZWxmLT5fR2V0RmllbGRzVG9VcGRhdGUoCiAgICAgICAgT25seUR5bmFtaWNGaWVsZHMgPT4gMQogICAgKTsKCiAgICAjIGdldCBuZWVkZWQgb2JqZWN0cwogICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKICAgIG15ICRDb25maWdPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpOwoKICAgICMgZ2V0IGNvbmZpZyBmb3IgZnJvbnRlbmQgbW9kdWxlCiAgICBteSAkQ29uZmlnID0gJENvbmZpZ09iamVjdC0+R2V0KCJUaWNrZXQ6OkZyb250ZW5kOjokU2VsZi0+e0FjdGlvbn0iKTsKCiAgICBteSAlU3RhdGU7CiAgICBpZiAoICRQYXJhbXtHZXRQYXJhbX0tPntTdGF0ZUlEfSApIHsKICAgICAgICAkU3RhdGV7U2VsZWN0ZWRJRH0gPSAkUGFyYW17R2V0UGFyYW19LT57U3RhdGVJRH07CiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkU3RhdGV7U2VsZWN0ZWRWYWx1ZX0gPSAkQ29uZmlnLT57U3RhdGVEZWZhdWx0fTsKICAgIH0KICAgICRQYXJhbXtOZXh0U3RhdGVzU3RyZ30gPSAkTGF5b3V0T2JqZWN0LT5CdWlsZFNlbGVjdGlvbigKICAgICAgICBEYXRhICAgICAgICAgPT4gJFBhcmFte05leHRTdGF0ZXN9LAogICAgICAgIE5hbWUgICAgICAgICA9PiAnU3RhdGVJRCcsCiAgICAgICAgUG9zc2libGVOb25lID0+IDEsCiAgICAgICAgJVN0YXRlLAogICAgICAgICVQYXJhbSwKICAgICAgICBDbGFzcyA9PiAnTW9kZXJuaXplJywKICAgICk7CgogICAgbXkgJElzVmlzaWJsZUZvckN1c3RvbWVyID0gJENvbmZpZy0+e0lzVmlzaWJsZUZvckN1c3RvbWVyRGVmYXVsdH07CiAgICBpZiAoICRQYXJhbXtHZXRQYXJhbX0tPntJc1Zpc2libGVGb3JDdXN0b21lclByZXNlbnR9ICkgewogICAgICAgICRJc1Zpc2libGVGb3JDdXN0b21lciA9ICRQYXJhbXtHZXRQYXJhbX0tPntJc1Zpc2libGVGb3JDdXN0b21lcn0gPyAxIDogMDsKICAgIH0KCiAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICBOYW1lID0+ICdJc1Zpc2libGVGb3JDdXN0b21lcicsCiAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgIElzVmlzaWJsZUZvckN1c3RvbWVyID0+ICRJc1Zpc2libGVGb3JDdXN0b21lciwKICAgICAgICB9LAogICAgKTsKCiAgICAjIHByZXBhcmUgZXJyb3JzIQogICAgaWYgKCAkUGFyYW17RXJyb3JzfSApIHsKICAgICAgICBmb3IgbXkgJEVycm9yICggc29ydCBrZXlzICV7ICRQYXJhbXtFcnJvcnN9IH0gKSB7CiAgICAgICAgICAgICRQYXJhbXskRXJyb3J9ID0gJExheW91dE9iamVjdC0+QXNjaWkySHRtbCgKICAgICAgICAgICAgICAgIFRleHQgPT4gJFBhcmFte0Vycm9yc30tPnskRXJyb3J9LAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICAjIGdldCB1c2VkIGNhbGVuZGFyCiAgICBteSAkQ2FsZW5kYXIgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGlja2V0JyktPlRpY2tldENhbGVuZGFyR2V0KAogICAgICAgIFF1ZXVlSUQgPT4gJFBhcmFte1F1ZXVlSUR9LAogICAgICAgIFNMQUlEICAgPT4gJFBhcmFte1NMQUlEfSwKICAgICk7CgogICAgIyBwZW5kaW5nIGRhdGEgc3RyaW5nCiAgICAkUGFyYW17UGVuZGluZ0RhdGVTdHJpbmd9ID0gJExheW91dE9iamVjdC0+QnVpbGREYXRlU2VsZWN0aW9uKAogICAgICAgICVQYXJhbSwKICAgICAgICBGb3JtYXQgICAgICAgICAgICAgICA9PiAnRGF0ZUlucHV0Rm9ybWF0TG9uZycsCiAgICAgICAgWWVhclBlcmlvZFBhc3QgICAgICAgPT4gMCwKICAgICAgICBZZWFyUGVyaW9kRnV0dXJlICAgICA9PiA1LAogICAgICAgIERpZmZUaW1lICAgICAgICAgICAgID0+ICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpGcm9udGVuZDo6UGVuZGluZ0RpZmZUaW1lJykgfHwgMCwKICAgICAgICBDbGFzcyAgICAgICAgICAgICAgICA9PiAkUGFyYW17RXJyb3JzfS0+e0RhdGVJbnZhbGlkfSB8fCAnICcsCiAgICAgICAgVmFsaWRhdGUgICAgICAgICAgICAgPT4gMSwKICAgICAgICBWYWxpZGF0ZURhdGVJbkZ1dHVyZSA9PiAxLAogICAgICAgIENhbGVuZGFyICAgICAgICAgICAgID0+ICRDYWxlbmRhciwKICAgICk7CgogICAgIyBNdWx0aXBsZS1BdXRvY29tcGxldGUKICAgICRQYXJhbXtUb30gPSAoIHNjYWxhciBAeyAkUGFyYW17TXVsdGlwbGVDdXN0b21lcn0gfSA/ICcnIDogJFBhcmFte1RvfSApOwogICAgaWYgKCBkZWZpbmVkICRQYXJhbXtUb30gJiYgJFBhcmFte1RvfSBuZSAnJyApIHsKICAgICAgICAkUGFyYW17VG9JbnZhbGlkfSA9ICcnOwogICAgfQoKICAgICRQYXJhbXtDY30gPSAoIHNjYWxhciBAeyAkUGFyYW17TXVsdGlwbGVDdXN0b21lckNjfSB9ID8gJycgOiAkUGFyYW17Q2N9ICk7CiAgICBpZiAoIGRlZmluZWQgJFBhcmFte0NjfSAmJiAkUGFyYW17Q2N9IG5lICcnICkgewogICAgICAgICRQYXJhbXtDY0ludmFsaWR9ID0gJyc7CiAgICB9CgogICAgIyBDYwogICAgbXkgJEN1c3RvbWVyQ291bnRlckNjID0gMDsKICAgIGlmICggJFBhcmFte011bHRpcGxlQ3VzdG9tZXJDY30gKSB7CiAgICAgICAgZm9yIG15ICRJdGVtICggQHsgJFBhcmFte011bHRpcGxlQ3VzdG9tZXJDY30gfSApIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdDY011bHRpcGxlQ3VzdG9tZXInLAogICAgICAgICAgICAgICAgRGF0YSA9PiAkSXRlbSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdDYycgLiAkSXRlbS0+e0N1c3RvbWVyRXJyb3JNc2d9LAogICAgICAgICAgICAgICAgRGF0YSA9PiAkSXRlbSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgaWYgKCAkSXRlbS0+e0N1c3RvbWVyRXJyb3J9ICkgewogICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAnQ2NDdXN0b21lckVycm9yRXhwbGFudGlvbicsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRDdXN0b21lckNvdW50ZXJDYysrOwogICAgICAgIH0KICAgIH0KCiAgICBpZiAoICEkQ3VzdG9tZXJDb3VudGVyQ2MgKSB7CiAgICAgICAgJFBhcmFte0NjQ3VzdG9tZXJIaWRkZW5Db250YWluZXJ9ID0gJ0hpZGRlbic7CiAgICB9CgogICAgIyBzZXQgY3VzdG9tZXIgY291bnRlcgogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnQ2NNdWx0aXBsZUN1c3RvbWVyQ291bnRlcicsCiAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgIEN1c3RvbWVyQ291bnRlciA9PiAkQ3VzdG9tZXJDb3VudGVyQ2MsCiAgICAgICAgfSwKICAgICk7CgogICAgIyBCY2MKICAgIG15ICRDdXN0b21lckNvdW50ZXJCY2MgPSAwOwogICAgaWYgKCAkUGFyYW17TXVsdGlwbGVDdXN0b21lckJjY30gKSB7CiAgICAgICAgZm9yIG15ICRJdGVtICggQHsgJFBhcmFte011bHRpcGxlQ3VzdG9tZXJCY2N9IH0gKSB7CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgTmFtZSA9PiAnQmNjTXVsdGlwbGVDdXN0b21lcicsCiAgICAgICAgICAgICAgICBEYXRhID0+ICRJdGVtLAogICAgICAgICAgICApOwogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ0JjYycgLiAkSXRlbS0+e0N1c3RvbWVyRXJyb3JNc2d9LAogICAgICAgICAgICAgICAgRGF0YSA9PiAkSXRlbSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgaWYgKCAkSXRlbS0+e0N1c3RvbWVyRXJyb3J9ICkgewogICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAnQmNjQ3VzdG9tZXJFcnJvckV4cGxhbnRpb24nLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkQ3VzdG9tZXJDb3VudGVyQmNjKys7CiAgICAgICAgfQogICAgfQoKICAgIGlmICggISRDdXN0b21lckNvdW50ZXJCY2MgKSB7CiAgICAgICAgJFBhcmFte0JjY0N1c3RvbWVySGlkZGVuQ29udGFpbmVyfSA9ICdIaWRkZW4nOwogICAgfQoKICAgICMgc2V0IGN1c3RvbWVyIGNvdW50ZXIKICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgIE5hbWUgPT4gJ0JjY011bHRpcGxlQ3VzdG9tZXJDb3VudGVyJywKICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgQ3VzdG9tZXJDb3VudGVyID0+ICRDdXN0b21lckNvdW50ZXJCY2MrKywKICAgICAgICB9LAogICAgKTsKCiAgICAjIFRvCiAgICBteSAkQ3VzdG9tZXJDb3VudGVyID0gMDsKICAgIGlmICggJFBhcmFte011bHRpcGxlQ3VzdG9tZXJ9ICkgewogICAgICAgIGZvciBteSAkSXRlbSAoIEB7ICRQYXJhbXtNdWx0aXBsZUN1c3RvbWVyfSB9ICkgewogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ011bHRpcGxlQ3VzdG9tZXInLAogICAgICAgICAgICAgICAgRGF0YSA9PiAkSXRlbSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICRJdGVtLT57Q3VzdG9tZXJFcnJvck1zZ30sCiAgICAgICAgICAgICAgICBEYXRhID0+ICRJdGVtLAogICAgICAgICAgICApOwogICAgICAgICAgICBpZiAoICRJdGVtLT57Q3VzdG9tZXJFcnJvcn0gKSB7CiAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICdDdXN0b21lckVycm9yRXhwbGFudGlvbicsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRDdXN0b21lckNvdW50ZXIrKzsKICAgICAgICB9CiAgICB9CgogICAgaWYgKCAhJEN1c3RvbWVyQ291bnRlciApIHsKICAgICAgICAkUGFyYW17Q3VzdG9tZXJIaWRkZW5Db250YWluZXJ9ID0gJ0hpZGRlbic7CiAgICB9CgogICAgIyBzZXQgY3VzdG9tZXIgY291bnRlcgogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnTXVsdGlwbGVDdXN0b21lckNvdW50ZXInLAogICAgICAgIERhdGEgPT4gewogICAgICAgICAgICBDdXN0b21lckNvdW50ZXIgPT4gJEN1c3RvbWVyQ291bnRlciwKICAgICAgICB9LAogICAgKTsKCiAgICBpZiAoICRQYXJhbXtUb0ludmFsaWR9ICYmICRQYXJhbXtFcnJvcnN9ICkgewogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdUb1NlcnZlckVycm9yTXNnJywKICAgICAgICApOwogICAgfQoKICAgIG15ICRDdXN0b21lclVzZXJPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q3VzdG9tZXJVc2VyJyk7CgogICAgIyBzZXQgcHJlc2VsZWN0ZWQgdmFsdWVzIGZvciBDYyBmaWVsZAogICAgaWYgKCAkUGFyYW17Q2N9ICYmICRQYXJhbXtDY30gbmUgJycgJiYgISRDdXN0b21lckNvdW50ZXJDYyApIHsKCiAgICAgICAgIyBzcGxpdCBDYyB2YWx1ZXMKICAgICAgICBteSBARW1haWxBZGRyZXNzZXNDYzsKICAgICAgICBmb3IgbXkgJEVtYWlsICggTWFpbDo6QWRkcmVzcy0+cGFyc2UoICRQYXJhbXtDY30gKSApIHsKCiAgICAgICAgICAgIG15ICVDdXN0b21lclNlYXJjaCA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyU2VhcmNoKAogICAgICAgICAgICAgICAgUG9zdE1hc3RlclNlYXJjaCA9PiAkRW1haWwtPmFkZHJlc3MoKSwKICAgICAgICAgICAgICAgIExpbWl0ICAgICAgICAgICAgPT4gMSwKICAgICAgICAgICAgICAgIFVzZXJJRCA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAjIEN1c3RvbWVyU2VhcmNoIGhhc2ggY291bGQgaGF2ZSBvbmUgaXRlbSBmcm9tIGVhY2ggYmFja2VuZCwgc28gaW5zZXJ0IGp1c3QgdGhlIGZpcnN0IG9uZS4KICAgICAgICAgICAgaWYgKCVDdXN0b21lclNlYXJjaCkgewogICAgICAgICAgICAgICAgQ1VTVE9NRVJVU0VSSUQ6CiAgICAgICAgICAgICAgICBmb3IgbXkgJEN1c3RvbWVyVXNlcklEICggc29ydCBrZXlzICVDdXN0b21lclNlYXJjaCApIHsKICAgICAgICAgICAgICAgICAgICBwdXNoIEBFbWFpbEFkZHJlc3Nlc0NjLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyS2V5ICAgICAgICA9PiAkQ3VzdG9tZXJVc2VySUQsCiAgICAgICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyVGlja2V0VGV4dCA9PiAkQ3VzdG9tZXJTZWFyY2h7JEN1c3RvbWVyVXNlcklEfSwKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIGxhc3QgQ1VTVE9NRVJVU0VSSUQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBwdXNoIEBFbWFpbEFkZHJlc3Nlc0NjLCB7CiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJLZXkgICAgICAgID0+ICcnLAogICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyVGlja2V0VGV4dCA9PiAkRW1haWwtPlswXSA/ICIkRW1haWwtPlswXSA8JEVtYWlsLT5bMV0+IiA6ICIkRW1haWwtPlsxXSIsCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAkTGF5b3V0T2JqZWN0LT5BZGRKU0RhdGEoCiAgICAgICAgICAgIEtleSAgID0+ICdFbWFpbEFkZHJlc3Nlc0NjJywKICAgICAgICAgICAgVmFsdWUgPT4gXEBFbWFpbEFkZHJlc3Nlc0NjLAogICAgICAgICk7CgogICAgICAgICRQYXJhbXtDY30gPSAnJzsKICAgIH0KCiAgICAjIHNldCBwcmVzZWxlY3RlZCB2YWx1ZXMgZm9yIFRvIGZpZWxkCiAgICBpZiAoIGRlZmluZWQgJFBhcmFte1RvfSAmJiAkUGFyYW17VG99IG5lICcnICYmICEkQ3VzdG9tZXJDb3VudGVyICkgewoKICAgICAgICAjIHNwbGl0IFRvIHZhbHVlcwogICAgICAgIG15IEBFbWFpbEFkZHJlc3Nlc1RvOwogICAgICAgIGZvciBteSAkRW1haWwgKCBNYWlsOjpBZGRyZXNzLT5wYXJzZSggJFBhcmFte1RvfSApICkgewoKICAgICAgICAgICAgbXkgJUN1c3RvbWVyU2VhcmNoID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJTZWFyY2goCiAgICAgICAgICAgICAgICBQb3N0TWFzdGVyU2VhcmNoID0+ICRFbWFpbC0+YWRkcmVzcygpLAogICAgICAgICAgICAgICAgTGltaXQgICAgICAgICAgICA9PiAxLAogICAgICAgICAgICAgICAgVXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgQ3VzdG9tZXJTZWFyY2ggaGFzaCBjb3VsZCBoYXZlIG9uZSBpdGVtIGZyb20gZWFjaCBiYWNrZW5kLCBzbyBpbnNlcnQganVzdCB0aGUgZmlyc3Qgb25lLgogICAgICAgICAgICBpZiAoJUN1c3RvbWVyU2VhcmNoKSB7CiAgICAgICAgICAgICAgICBDVVNUT01FUlVTRVJJRDoKICAgICAgICAgICAgICAgIGZvciBteSAkQ3VzdG9tZXJVc2VySUQgKCBzb3J0IGtleXMgJUN1c3RvbWVyU2VhcmNoICkgewogICAgICAgICAgICAgICAgICAgIHB1c2ggQEVtYWlsQWRkcmVzc2VzVG8sIHsKICAgICAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJLZXkgICAgICAgID0+ICRDdXN0b21lclVzZXJJRCwKICAgICAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJUaWNrZXRUZXh0ID0+ICRDdXN0b21lclNlYXJjaHskQ3VzdG9tZXJVc2VySUR9LAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgbGFzdCBDVVNUT01FUlVTRVJJRDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHB1c2ggQEVtYWlsQWRkcmVzc2VzVG8sIHsKICAgICAgICAgICAgICAgICAgICBDdXN0b21lcktleSAgICAgICAgPT4gJycsCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJUaWNrZXRUZXh0ID0+ICRFbWFpbC0+WzBdID8gIiRFbWFpbC0+WzBdIDwkRW1haWwtPlsxXT4iIDogIiRFbWFpbC0+WzFdIiwKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICRMYXlvdXRPYmplY3QtPkFkZEpTRGF0YSgKICAgICAgICAgICAgS2V5ICAgPT4gJ0VtYWlsQWRkcmVzc2VzVG8nLAogICAgICAgICAgICBWYWx1ZSA9PiBcQEVtYWlsQWRkcmVzc2VzVG8sCiAgICAgICAgKTsKCiAgICAgICAgJFBhcmFte1RvfSA9ICcnOwogICAgfQoKICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgIE5hbWUgPT4gJFBhcmFte1RpY2tldEJhY2tUeXBlfSwKICAgICAgICBEYXRhID0+IHsKCiAgICAgICAgICAgICMgICAgICAgICAgICBGb3JtSUQgPT4gJFNlbGYtPntGb3JtSUR9LAogICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgfSwKICAgICk7CgogICAgIyBnZXQgdGhlIGR5bmFtaWMgZmllbGRzIGZvciB0aGlzIHNjcmVlbgogICAgbXkgJER5bmFtaWNGaWVsZCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEeW5hbWljRmllbGQnKS0+RHluYW1pY0ZpZWxkTGlzdEdldCgKICAgICAgICBWYWxpZCAgICAgICA9PiAxLAogICAgICAgIE9iamVjdFR5cGUgID0+IFsgJ1RpY2tldCcsICdBcnRpY2xlJyBdLAogICAgICAgIEZpZWxkRmlsdGVyID0+ICRDb25maWctPntEeW5hbWljRmllbGR9IHx8IHt9LAogICAgKTsKCiAgICAjIER5bmFtaWMgZmllbGRzCiAgICAjIGN5Y2xlIHRyb3VnaCB0aGUgYWN0aXZhdGVkIER5bmFtaWMgRmllbGRzIGZvciB0aGlzIHNjcmVlbgogICAgRFlOQU1JQ0ZJRUxEOgogICAgZm9yIG15ICREeW5hbWljRmllbGRDb25maWcgKCBAeyREeW5hbWljRmllbGR9ICkgewogICAgICAgIG5leHQgRFlOQU1JQ0ZJRUxEIGlmICFJc0hhc2hSZWZXaXRoRGF0YSgkRHluYW1pY0ZpZWxkQ29uZmlnKTsKCiAgICAgICAgIyBza2lwIGZpZWxkcyB0aGF0IEhUTUwgY291bGQgbm90IGJlIHJldHJpZXZlZAogICAgICAgIG5leHQgRFlOQU1JQ0ZJRUxEIGlmICFJc0hhc2hSZWZXaXRoRGF0YSgKICAgICAgICAgICAgJFBhcmFte0R5bmFtaWNGaWVsZEhUTUx9LT57ICREeW5hbWljRmllbGRDb25maWctPntOYW1lfSB9CiAgICAgICAgKTsKCiAgICAgICAgIyBnZXQgdGhlIGh0bWwgc3RyaW5ncyBmb3JtICRQYXJhbQogICAgICAgIG15ICREeW5hbWljRmllbGRIVE1MID0gJFBhcmFte0R5bmFtaWNGaWVsZEhUTUx9LT57ICREeW5hbWljRmllbGRDb25maWctPntOYW1lfSB9OwoKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnRHluYW1pY0ZpZWxkJywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBOYW1lICA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnLT57TmFtZX0sCiAgICAgICAgICAgICAgICBMYWJlbCA9PiAkRHluYW1pY0ZpZWxkSFRNTC0+e0xhYmVsfSwKICAgICAgICAgICAgICAgIEZpZWxkID0+ICREeW5hbWljRmllbGRIVE1MLT57RmllbGR9LAogICAgICAgICAgICB9LAogICAgICAgICk7CgogICAgICAgICMgZXhhbXBsZSBvZiBkeW5hbWljIGZpZWxkcyBvcmRlciBjdXN0b21pemF0aW9uCiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ0R5bmFtaWNGaWVsZF8nIC4gJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9LAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgIE5hbWUgID0+ICREeW5hbWljRmllbGRDb25maWctPntOYW1lfSwKICAgICAgICAgICAgICAgIExhYmVsID0+ICREeW5hbWljRmllbGRIVE1MLT57TGFiZWx9LAogICAgICAgICAgICAgICAgRmllbGQgPT4gJER5bmFtaWNGaWVsZEhUTUwtPntGaWVsZH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIHNob3cgdGltZSBhY2NvdW50aW5nIGJveAogICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6OkFjY291bnRUaW1lJykgKSB7CiAgICAgICAgJFBhcmFte1RpbWVVbml0c0Jsb2NrfSA9ICRMYXlvdXRPYmplY3QtPlRpbWVVbml0cygKICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICk7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ1RpbWVVbml0cycsCiAgICAgICAgICAgIERhdGEgPT4gXCVQYXJhbSwKICAgICAgICApOwogICAgfQoKICAgICMgU2hvdyB0aGUgY3VzdG9tZXIgdXNlciBhZGRyZXNzIGJvb2sgaWYgdGhlIG1vZHVsZSBpcyByZWdpc3RlcmVkIGFuZCBqYXZhIHNjcmlwdCBzdXBwb3J0IGlzIGF2YWlsYWJsZS4KICAgIGlmICgKICAgICAgICAkQ29uZmlnT2JqZWN0LT5HZXQoJ0Zyb250ZW5kOjpNb2R1bGUnKS0+e0FnZW50Q3VzdG9tZXJVc2VyQWRkcmVzc0Jvb2t9CiAgICAgICAgJiYgJExheW91dE9iamVjdC0+e0Jyb3dzZXJKYXZhU2NyaXB0U3VwcG9ydH0KICAgICAgICApCiAgICB7CiAgICAgICAgJFBhcmFte09wdGlvbkN1c3RvbWVyVXNlckFkZHJlc3NCb29rfSA9IDE7CiAgICB9CgogICAgIyBhZGQgcmljaCB0ZXh0IGVkaXRvcgogICAgaWYgKCAkTGF5b3V0T2JqZWN0LT57QnJvd3NlclJpY2hUZXh0fSApIHsKCiAgICAgICAgIyB1c2UgaGVpZ2h0L3dpZHRoIGRlZmluZWQgZm9yIHRoaXMgc2NyZWVuCiAgICAgICAgJFBhcmFte1JpY2hUZXh0SGVpZ2h0fSA9ICRDb25maWctPntSaWNoVGV4dEhlaWdodH0gfHwgMDsKICAgICAgICAkUGFyYW17UmljaFRleHRXaWR0aH0gID0gJENvbmZpZy0+e1JpY2hUZXh0V2lkdGh9ICB8fCAwOwoKICAgICAgICAjIHNldCB1cCByaWNoIHRleHQgZWRpdG9yCiAgICAgICAgJExheW91dE9iamVjdC0+U2V0UmljaFRleHRQYXJhbWV0ZXJzKAogICAgICAgICAgICBEYXRhID0+IFwlUGFyYW0sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIHNob3cgYXR0YWNobWVudHMKICAgIEFUVEFDSE1FTlQ6CiAgICBmb3IgbXkgJEF0dGFjaG1lbnQgKCBAeyAkUGFyYW17QXR0YWNobWVudHN9IH0gKSB7CiAgICAgICAgaWYgKAogICAgICAgICAgICAkQXR0YWNobWVudC0+e0NvbnRlbnRJRH0KICAgICAgICAgICAgJiYgJExheW91dE9iamVjdC0+e0Jyb3dzZXJSaWNoVGV4dH0KICAgICAgICAgICAgJiYgKCAkQXR0YWNobWVudC0+e0NvbnRlbnRUeXBlfSA9fiAvaW1hZ2UvaSApCiAgICAgICAgICAgICYmICggJEF0dGFjaG1lbnQtPntEaXNwb3NpdGlvbn0gZXEgJ2lubGluZScgKQogICAgICAgICAgICApCiAgICAgICAgewogICAgICAgICAgICBuZXh0IEFUVEFDSE1FTlQ7CiAgICAgICAgfQoKICAgICAgICBwdXNoIEB7ICRQYXJhbXtBdHRhY2htZW50TGlzdH0gfSwgJEF0dGFjaG1lbnQ7CiAgICB9CgogICAgJExheW91dE9iamVjdC0+QWRkSlNEYXRhKAogICAgICAgIEtleSAgID0+ICdEeW5hbWljRmllbGROYW1lcycsCiAgICAgICAgVmFsdWUgPT4gJER5bmFtaWNGaWVsZE5hbWVzLAogICAgKTsKCiAgICBteSAkTG9hZGVkRm9ybURyYWZ0OwogICAgaWYgKCAkU2VsZi0+e0xvYWRlZEZvcm1EcmFmdElEfSApIHsKICAgICAgICAkTG9hZGVkRm9ybURyYWZ0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkZvcm1EcmFmdCcpLT5Gb3JtRHJhZnRHZXQoCiAgICAgICAgICAgIEZvcm1EcmFmdElEID0+ICRTZWxmLT57TG9hZGVkRm9ybURyYWZ0SUR9LAogICAgICAgICAgICBHZXRDb250ZW50ICA9PiAwLAogICAgICAgICAgICBVc2VySUQgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgKTsKCiAgICAgICAgbXkgQEFydGljbGVzID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpY2tldDo6QXJ0aWNsZScpLT5BcnRpY2xlTGlzdCgKICAgICAgICAgICAgVGlja2V0SUQgPT4gJFNlbGYtPntUaWNrZXRJRH0sCiAgICAgICAgICAgIE9ubHlMYXN0ID0+IDEsCiAgICAgICAgKTsKCiAgICAgICAgaWYgKEBBcnRpY2xlcykgewogICAgICAgICAgICBteSAkTGFzdEFydGljbGUgPSAkQXJ0aWNsZXNbMF07CgogICAgICAgICAgICBteSAkTGFzdEFydGljbGVTeXN0ZW1UaW1lOwogICAgICAgICAgICBpZiAoICRMYXN0QXJ0aWNsZS0+e0NyZWF0ZVRpbWV9ICkgewogICAgICAgICAgICAgICAgbXkgJExhc3RBcnRpY2xlU3lzdGVtVGltZU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5DcmVhdGUoCiAgICAgICAgICAgICAgICAgICAgJ0tlcm5lbDo6U3lzdGVtOjpEYXRlVGltZScsCiAgICAgICAgICAgICAgICAgICAgT2JqZWN0UGFyYW1zID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nID0+ICRMYXN0QXJ0aWNsZS0+e0NyZWF0ZVRpbWV9LAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgJExhc3RBcnRpY2xlU3lzdGVtVGltZSA9ICRMYXN0QXJ0aWNsZVN5c3RlbVRpbWVPYmplY3QtPlRvRXBvY2goKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbXkgJEZvcm1EcmFmdFN5c3RlbVRpbWVPYmplY3QgPSAkS2VybmVsOjpPTS0+Q3JlYXRlKAogICAgICAgICAgICAgICAgJ0tlcm5lbDo6U3lzdGVtOjpEYXRlVGltZScsCiAgICAgICAgICAgICAgICBPYmplY3RQYXJhbXMgPT4gewogICAgICAgICAgICAgICAgICAgIFN0cmluZyA9PiAkTG9hZGVkRm9ybURyYWZ0LT57Q2hhbmdlVGltZX0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICApOwogICAgICAgICAgICBteSAkRm9ybURyYWZ0U3lzdGVtVGltZSA9ICRGb3JtRHJhZnRTeXN0ZW1UaW1lT2JqZWN0LT5Ub0Vwb2NoKCk7CgogICAgICAgICAgICBpZiAoICEkTGFzdEFydGljbGVTeXN0ZW1UaW1lIHx8ICRGb3JtRHJhZnRTeXN0ZW1UaW1lIDw9ICRMYXN0QXJ0aWNsZVN5c3RlbVRpbWUgKSB7CiAgICAgICAgICAgICAgICAkUGFyYW17Rm9ybURyYWZ0T3V0ZGF0ZWR9ID0gMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBpZiAoIElzSGFzaFJlZldpdGhEYXRhKCRMb2FkZWRGb3JtRHJhZnQpICkgewoKICAgICAgICAkTG9hZGVkRm9ybURyYWZ0LT57Q2hhbmdlQnlOYW1lfSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpVc2VyJyktPlVzZXJOYW1lKAogICAgICAgICAgICBVc2VySUQgPT4gJExvYWRlZEZvcm1EcmFmdC0+e0NoYW5nZUJ5fSwKICAgICAgICApOwogICAgfQoKICAgICMgY3JlYXRlICYgcmV0dXJuIG91dHB1dAogICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPk91dHB1dCgKICAgICAgICBUZW1wbGF0ZUZpbGUgPT4gJ0FnZW50VGlja2V0Q29tcG9zZScsCiAgICAgICAgRGF0YSAgICAgICAgID0+IHsKICAgICAgICAgICAgRm9ybUlEICAgICAgICAgPT4gJFNlbGYtPntGb3JtSUR9LAogICAgICAgICAgICBGb3JtRHJhZnQgICAgICA9PiAkQ29uZmlnLT57Rm9ybURyYWZ0fSwKICAgICAgICAgICAgRm9ybURyYWZ0SUQgICAgPT4gJFNlbGYtPntMb2FkZWRGb3JtRHJhZnRJRH0sCiAgICAgICAgICAgIEZvcm1EcmFmdFRpdGxlID0+ICRMb2FkZWRGb3JtRHJhZnQgPyAkTG9hZGVkRm9ybURyYWZ0LT57VGl0bGV9IDogJycsCiAgICAgICAgICAgIEZvcm1EcmFmdE1ldGEgID0+ICRMb2FkZWRGb3JtRHJhZnQsCiAgICAgICAgICAgICVQYXJhbSwKICAgICAgICB9LAogICAgKTsKfQoKc3ViIF9HZXRGaWVsZHNUb1VwZGF0ZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15IEBVcGRhdGFibGVGaWVsZHM7CgogICAgIyBzZXQgdGhlIGZpZWxkcyB0aGF0IGNhbiBiZSB1cGRhdGFibGUgdmlhIEFKQVhVcGRhdGUKICAgIGlmICggISRQYXJhbXtPbmx5RHluYW1pY0ZpZWxkc30gKSB7CiAgICAgICAgQFVwZGF0YWJsZUZpZWxkcyA9IHF3KCBTdGF0ZUlEICk7CiAgICB9CgogICAgbXkgJENvbmZpZyA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgiVGlja2V0OjpGcm9udGVuZDo6JFNlbGYtPntBY3Rpb259Iik7CgogICAgIyBnZXQgdGhlIGR5bmFtaWMgZmllbGRzIGZvciB0aGlzIHNjcmVlbgogICAgbXkgJER5bmFtaWNGaWVsZCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEeW5hbWljRmllbGQnKS0+RHluYW1pY0ZpZWxkTGlzdEdldCgKICAgICAgICBWYWxpZCAgICAgICA9PiAxLAogICAgICAgIE9iamVjdFR5cGUgID0+IFsgJ1RpY2tldCcsICdBcnRpY2xlJyBdLAogICAgICAgIEZpZWxkRmlsdGVyID0+ICRDb25maWctPntEeW5hbWljRmllbGR9IHx8IHt9LAogICAgKTsKCiAgICAjIGN5Y2xlIHRyb3VnaCB0aGUgYWN0aXZhdGVkIER5bmFtaWMgRmllbGRzIGZvciB0aGlzIHNjcmVlbgogICAgRFlOQU1JQ0ZJRUxEOgogICAgZm9yIG15ICREeW5hbWljRmllbGRDb25maWcgKCBAeyREeW5hbWljRmllbGR9ICkgewogICAgICAgIG5leHQgRFlOQU1JQ0ZJRUxEIGlmICFJc0hhc2hSZWZXaXRoRGF0YSgkRHluYW1pY0ZpZWxkQ29uZmlnKTsKCiAgICAgICAgbXkgJElzQUNMUmVkdWNpYmxlID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkR5bmFtaWNGaWVsZDo6QmFja2VuZCcpLT5IYXNCZWhhdmlvcigKICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRDb25maWcsCiAgICAgICAgICAgIEJlaGF2aW9yICAgICAgICAgICA9PiAnSXNBQ0xSZWR1Y2libGUnLAogICAgICAgICk7CiAgICAgICAgbmV4dCBEWU5BTUlDRklFTEQgaWYgISRJc0FDTFJlZHVjaWJsZTsKCiAgICAgICAgcHVzaCBAVXBkYXRhYmxlRmllbGRzLCAnRHluYW1pY0ZpZWxkXycgLiAkRHluYW1pY0ZpZWxkQ29uZmlnLT57TmFtZX07CiAgICB9CgogICAgcmV0dXJuIFxAVXBkYXRhYmxlRmllbGRzOwp9CgoxOwo=</File>
        <File Location="Custom/Kernel/Modules/AgentTicketCustomer.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxLTIwMjIgWm51bnkgR21iSCwgaHR0cHM6Ly96bnVueS5vcmcvCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6TW9kdWxlczo6QWdlbnRUaWNrZXRDdXN0b21lcjsKCnVzZSBzdHJpY3Q7CnVzZSB3YXJuaW5nczsKCnVzZSBLZXJuZWw6Okxhbmd1YWdlIHF3KFRyYW5zbGF0YWJsZSk7CgpvdXIgJE9iamVjdE1hbmFnZXJEaXNhYmxlZCA9IDE7Cgp1c2UgS2VybmVsOjpTeXN0ZW06OlZhcmlhYmxlQ2hlY2sgcXcoOmFsbCk7CgpzdWIgbmV3IHsKICAgIG15ICggJFR5cGUsICVQYXJhbSApID0gQF87CgogICAgIyBhbGxvY2F0ZSBuZXcgaGFzaCBmb3Igb2JqZWN0CiAgICBteSAkU2VsZiA9IHslUGFyYW19OwogICAgYmxlc3MoICRTZWxmLCAkVHlwZSApOwoKICAgIHJldHVybiAkU2VsZjsKfQoKc3ViIFJ1biB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRPdXRwdXQ7CgogICAgIyBnZXQgbGF5b3V0IG9iamVjdAogICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKCiAgICAjIGNoZWNrIG5lZWRlZCBzdHVmZgogICAgaWYgKCAhJFNlbGYtPntUaWNrZXRJRH0gKSB7CgogICAgICAgICMgZXJyb3IgcGFnZQogICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5FcnJvclNjcmVlbigKICAgICAgICAgICAgTWVzc2FnZSA9PiBUcmFuc2xhdGFibGUoJ05vIFRpY2tldElEIGlzIGdpdmVuIScpLAogICAgICAgICAgICBDb21tZW50ID0+IFRyYW5zbGF0YWJsZSgnUGxlYXNlIGNvbnRhY3QgdGhlIGFkbWluaXN0cmF0b3IuJyksCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGdldCB0aWNrZXQgb2JqZWN0CiAgICBteSAkVGlja2V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpY2tldCcpOwoKICAgICMgZ2V0IGNvbmZpZwogICAgbXkgJENvbmZpZyA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgiVGlja2V0OjpGcm9udGVuZDo6JFNlbGYtPntBY3Rpb259Iik7CgogICAgIyBjaGVjayBwZXJtaXNzaW9ucwogICAgaWYgKAogICAgICAgICEkVGlja2V0T2JqZWN0LT5UaWNrZXRQZXJtaXNzaW9uKAogICAgICAgICAgICBUeXBlICAgICA9PiAkQ29uZmlnLT57UGVybWlzc2lvbn0sCiAgICAgICAgICAgIFRpY2tldElEID0+ICRTZWxmLT57VGlja2V0SUR9LAogICAgICAgICAgICBVc2VySUQgICA9PiAkU2VsZi0+e1VzZXJJRH0KICAgICAgICApCiAgICAgICAgKQogICAgewoKICAgICAgICAjIGVycm9yIHNjcmVlbiwgZG9uJ3Qgc2hvdyB0aWNrZXQKICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+Tm9QZXJtaXNzaW9uKAogICAgICAgICAgICBNZXNzYWdlID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSggJ1lvdSBuZWVkICVzIHBlcm1pc3Npb25zIScsICRDb25maWctPntQZXJtaXNzaW9ufSApLAogICAgICAgICAgICBXaXRoSGVhZGVyID0+ICd5ZXMnLAogICAgICAgICk7CiAgICB9CgogICAgIyBnZXQgQUNMIHJlc3RyaWN0aW9ucwogICAgbXkgJVBvc3NpYmxlQWN0aW9ucyA9ICggMSA9PiAkU2VsZi0+e0FjdGlvbn0gKTsKCiAgICBteSAkQUNMID0gJFRpY2tldE9iamVjdC0+VGlja2V0QWNsKAogICAgICAgIERhdGEgICAgICAgICAgPT4gXCVQb3NzaWJsZUFjdGlvbnMsCiAgICAgICAgQWN0aW9uICAgICAgICA9PiAkU2VsZi0+e0FjdGlvbn0sCiAgICAgICAgVGlja2V0SUQgICAgICA9PiAkU2VsZi0+e1RpY2tldElEfSwKICAgICAgICBSZXR1cm5UeXBlICAgID0+ICdBY3Rpb24nLAogICAgICAgIFJldHVyblN1YlR5cGUgPT4gJy0nLAogICAgICAgIFVzZXJJRCAgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgKTsKICAgIG15ICVBY2xBY3Rpb24gPSAkVGlja2V0T2JqZWN0LT5UaWNrZXRBY2xBY3Rpb25EYXRhKCk7CgogICAgIyBjaGVjayBpZiBBQ0wgcmVzdHJpY3Rpb25zIGV4aXN0CiAgICBpZiAoICRBQ0wgfHwgSXNIYXNoUmVmV2l0aERhdGEoIFwlQWNsQWN0aW9uICkgKSB7CgogICAgICAgIG15ICVBY2xBY3Rpb25Mb29rdXAgPSByZXZlcnNlICVBY2xBY3Rpb247CgogICAgICAgICMgc2hvdyBlcnJvciBzY3JlZW4gaWYgQUNMIHByb2hpYml0cyB0aGlzIGFjdGlvbgogICAgICAgIGlmICggISRBY2xBY3Rpb25Mb29rdXB7ICRTZWxmLT57QWN0aW9ufSB9ICkgewogICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+Tm9QZXJtaXNzaW9uKCBXaXRoSGVhZGVyID0+ICd5ZXMnICk7CiAgICAgICAgfQogICAgfQoKICAgICMgZ2V0IHBhcmFtIG9iamVjdAogICAgbXkgJFBhcmFtT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OldlYjo6UmVxdWVzdCcpOwoKICAgIGlmICggJFNlbGYtPntTdWJhY3Rpb259IGVxICdVcGRhdGUnICkgewoKICAgICAgICAjIGNoYWxsZW5nZSB0b2tlbiBjaGVjayBmb3Igd3JpdGUgYWN0aW9uCiAgICAgICAgJExheW91dE9iamVjdC0+Q2hhbGxlbmdlVG9rZW5DaGVjaygpOwoKICAgICAgICAjIHNldCBjdXN0b21lciBpZAogICAgICAgIG15ICRFeHBhbmRDdXN0b21lck5hbWUxID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0V4cGFuZEN1c3RvbWVyTmFtZTEnICkKICAgICAgICAgICAgfHwgMDsKICAgICAgICBteSAkRXhwYW5kQ3VzdG9tZXJOYW1lMiA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdFeHBhbmRDdXN0b21lck5hbWUyJyApCiAgICAgICAgICAgIHx8IDA7CiAgICAgICAgbXkgJEN1c3RvbWVyVXNlck9wdGlvbiA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdDdXN0b21lclVzZXJPcHRpb24nICkKICAgICAgICAgICAgfHwgJyc7CiAgICAgICAgJFBhcmFte0N1c3RvbWVyVXNlcklEfSAgICAgICA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdDdXN0b21lclVzZXJJRCcgKSAgICAgICB8fCAnJzsKICAgICAgICAkUGFyYW17Q3VzdG9tZXJJRH0gICAgICAgICAgID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0N1c3RvbWVySUQnICkgICAgICAgICAgIHx8ICcnOwogICAgICAgICRQYXJhbXtTZWxlY3RlZEN1c3RvbWVyVXNlcn0gPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnU2VsZWN0ZWRDdXN0b21lclVzZXInICkgfHwgJyc7CgogICAgICAgICMgdXNlIGN1c3RvbWVyIGxvZ2luIGluc3RlYWQgb2YgZW1haWwgYWRkcmVzcyBpZiBhcHBsaWNhYmxlCiAgICAgICAgaWYgKCAkUGFyYW17U2VsZWN0ZWRDdXN0b21lclVzZXJ9IG5lICcnICkgewogICAgICAgICAgICAkUGFyYW17Q3VzdG9tZXJVc2VySUR9ID0gJFBhcmFte1NlbGVjdGVkQ3VzdG9tZXJVc2VyfTsKICAgICAgICB9CgogICAgICAgICMgZ2V0IGN1c3RvbWVyIHVzZXIgb2JqZWN0CiAgICAgICAgbXkgJEN1c3RvbWVyVXNlck9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDdXN0b21lclVzZXInKTsKCiAgICAgICAgIyBFeHBhbmQgQ3VzdG9tZXIgTmFtZQogICAgICAgIGlmICgkRXhwYW5kQ3VzdG9tZXJOYW1lMSkgewoKICAgICAgICAgICAgIyBzZWFyY2ggY3VzdG9tZXIKICAgICAgICAgICAgbXkgJUN1c3RvbWVyVXNlckxpc3QgPSAoKTsKICAgICAgICAgICAgJUN1c3RvbWVyVXNlckxpc3QgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclNlYXJjaCgKICAgICAgICAgICAgICAgIFNlYXJjaCA9PiAkUGFyYW17Q3VzdG9tZXJVc2VySUR9LAogICAgICAgICAgICAgICAgVXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgY2hlY2sgaWYganVzdCBvbmUgY3VzdG9tZXIgdXNlciBleGlzdHMKICAgICAgICAgICAgIyBpZiBqdXN0IG9uZSwgZmlsbHVwIEN1c3RvbWVyVXNlcklEIGFuZCBDdXN0b21lcklECiAgICAgICAgICAgICRQYXJhbXtDdXN0b21lclVzZXJMaXN0Q291bnR9ID0gMDsKICAgICAgICAgICAgZm9yIG15ICRLZXlDdXN0b21lclVzZXIgKCBzb3J0IGtleXMgJUN1c3RvbWVyVXNlckxpc3QgKSB7CiAgICAgICAgICAgICAgICAkUGFyYW17Q3VzdG9tZXJVc2VyTGlzdENvdW50fSsrOwogICAgICAgICAgICAgICAgJFBhcmFte0N1c3RvbWVyVXNlckxpc3RMYXN0fSAgICAgPSAkQ3VzdG9tZXJVc2VyTGlzdHskS2V5Q3VzdG9tZXJVc2VyfTsKICAgICAgICAgICAgICAgICRQYXJhbXtDdXN0b21lclVzZXJMaXN0TGFzdFVzZXJ9ID0gJEtleUN1c3RvbWVyVXNlcjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoICRQYXJhbXtDdXN0b21lclVzZXJMaXN0Q291bnR9ID09IDEgKSB7CiAgICAgICAgICAgICAgICAkUGFyYW17Q3VzdG9tZXJVc2VySUR9ID0gJFBhcmFte0N1c3RvbWVyVXNlckxpc3RMYXN0VXNlcn07CiAgICAgICAgICAgICAgICBteSAlQ3VzdG9tZXJVc2VyRGF0YSA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyVXNlckRhdGFHZXQoCiAgICAgICAgICAgICAgICAgICAgVXNlciA9PiAkUGFyYW17Q3VzdG9tZXJVc2VyTGlzdExhc3RVc2VyfSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBpZiAoICRDdXN0b21lclVzZXJEYXRhe1VzZXJDdXN0b21lcklEfSApIHsKICAgICAgICAgICAgICAgICAgICAkUGFyYW17Q3VzdG9tZXJJRH0gPSAkQ3VzdG9tZXJVc2VyRGF0YXtVc2VyQ3VzdG9tZXJJRH07CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGlmIG1vcmUgdGhlIG9uZSBjdXN0b21lciB1c2VyIGV4aXN0cywgc2hvdyBsaXN0CiAgICAgICAgICAgICMgYW5kIGNsZWFuIEN1c3RvbWVySUQKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkUGFyYW17Q3VzdG9tZXJJRH0gICAgICAgICAgICA9ICcnOwogICAgICAgICAgICAgICAgJFBhcmFteyJDdXN0b21lclVzZXJPcHRpb25zIn0gPSBcJUN1c3RvbWVyVXNlckxpc3Q7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICRTZWxmLT5Gb3JtKCVQYXJhbSk7CiAgICAgICAgfQoKICAgICAgICAjIGdldCBjdXN0b21lciB1c2VyIGFuZCBjdXN0b21lciBpZAogICAgICAgIGVsc2lmICgkRXhwYW5kQ3VzdG9tZXJOYW1lMikgewogICAgICAgICAgICBteSAlQ3VzdG9tZXJVc2VyRGF0YSA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyVXNlckRhdGFHZXQoCiAgICAgICAgICAgICAgICBVc2VyID0+ICRDdXN0b21lclVzZXJPcHRpb24sCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIG15ICVDdXN0b21lclVzZXJMaXN0ID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJTZWFyY2goCiAgICAgICAgICAgICAgICBVc2VyTG9naW4gPT4gJEN1c3RvbWVyVXNlck9wdGlvbiwKICAgICAgICAgICAgICAgIFVzZXJJRCA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGZvciBteSAkS2V5Q3VzdG9tZXJVc2VyICggc29ydCBrZXlzICVDdXN0b21lclVzZXJMaXN0ICkgewogICAgICAgICAgICAgICAgJFBhcmFte0N1c3RvbWVyVXNlcklEfSA9ICRLZXlDdXN0b21lclVzZXI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCAkQ3VzdG9tZXJVc2VyRGF0YXtVc2VyQ3VzdG9tZXJJRH0gKSB7CiAgICAgICAgICAgICAgICAkUGFyYW17Q3VzdG9tZXJJRH0gPSAkQ3VzdG9tZXJVc2VyRGF0YXtVc2VyQ3VzdG9tZXJJRH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICRTZWxmLT5Gb3JtKCVQYXJhbSk7CiAgICAgICAgfQoKICAgICAgICBteSAlRXJyb3I7CgogICAgICAgICMgY2hlY2sgbmVlZGVkIGRhdGEKICAgICAgICBpZiAoICEkUGFyYW17Q3VzdG9tZXJVc2VySUR9ICkgewogICAgICAgICAgICAkRXJyb3J7J0N1c3RvbWVyVXNlcklESW52YWxpZCd9ID0gJ1NlcnZlckVycm9yJzsKICAgICAgICB9CgogICAgICAgIGlmICglRXJyb3IpIHsKICAgICAgICAgICAgcmV0dXJuICRTZWxmLT5Gb3JtKCAlUGFyYW0sICVFcnJvciApOwogICAgICAgIH0KCiAgICAgICAgIyB1cGRhdGUgY3VzdG9tZXIgdXNlciBkYXRhCiAgICAgICAgaWYgKAogICAgICAgICAgICAkVGlja2V0T2JqZWN0LT5UaWNrZXRDdXN0b21lclNldCgKICAgICAgICAgICAgICAgIFRpY2tldElEID0+ICRTZWxmLT57VGlja2V0SUR9LAogICAgICAgICAgICAgICAgTm8gICAgICAgPT4gJFBhcmFte0N1c3RvbWVySUR9LAogICAgICAgICAgICAgICAgVXNlciAgICAgPT4gJFBhcmFte0N1c3RvbWVyVXNlcklEfSwKICAgICAgICAgICAgICAgIFVzZXJJRCAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgKQogICAgICAgICAgICApCiAgICAgICAgewoKICAgICAgICAgICAgIyByZWRpcmVjdAogICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+UG9wdXBDbG9zZSgKICAgICAgICAgICAgICAgIFVSTCA9PiAiQWN0aW9uPUFnZW50VGlja2V0Wm9vbTtUaWNrZXRJRD0kU2VsZi0+e1RpY2tldElEfSIsCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewoKICAgICAgICAgICAgIyBlcnJvcj8hCiAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5FcnJvclNjcmVlbigpOwogICAgICAgIH0KICAgIH0KCiAgICAjIHNob3cgZm9ybQogICAgZWxzZSB7CiAgICAgICAgcmV0dXJuICRTZWxmLT5Gb3JtKCVQYXJhbSk7CiAgICB9Cn0KCnN1YiBGb3JtIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJE91dHB1dDsKCiAgICAjIGdldCBsYXlvdXQgb2JqZWN0CiAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwoKICAgICMgcHJpbnQgaGVhZGVyCiAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPkhlYWRlcigKICAgICAgICBUeXBlID0+ICdTbWFsbCcsCiAgICApOwogICAgbXkgJFRpY2tldEN1c3RvbWVySUQgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6V2ViOjpSZXF1ZXN0JyktPkdldFBhcmFtKCBQYXJhbSA9PiAnQ3VzdG9tZXJJRCcgKSB8fCAnJzsKCiAgICAjIHByaW50IGNoYW5nZSBmb3JtIGlmIHRpY2tldCBpZCBpcyBnaXZlbgogICAgbXkgJUN1c3RvbWVyVXNlckRhdGEgPSAoKTsKICAgIGlmICggJFNlbGYtPntUaWNrZXRJRH0gKSB7CgogICAgICAgICMgZ2V0IGNvbmZpZyBvYmplY3QKICAgICAgICBteSAkQ29uZmlnT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKTsKCiAgICAgICAgIyBzZXQgSlMgZGF0YQogICAgICAgICRMYXlvdXRPYmplY3QtPkFkZEpTRGF0YSgKICAgICAgICAgICAgS2V5ICAgPT4gJ0N1c3RvbWVyU2VhcmNoJywKICAgICAgICAgICAgVmFsdWUgPT4gewogICAgICAgICAgICAgICAgU2hvd0N1c3RvbWVyVGlja2V0cyA9PiAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6OlNob3dDdXN0b21lclRpY2tldHMnKSwKICAgICAgICAgICAgfSwKICAgICAgICApOwoKICAgICAgICAjIGdldCB0aWNrZXQgZGF0YQogICAgICAgIG15ICVUaWNrZXREYXRhID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpY2tldCcpLT5UaWNrZXRHZXQoIFRpY2tldElEID0+ICRTZWxmLT57VGlja2V0SUR9ICk7CiAgICAgICAgaWYgKCAkVGlja2V0RGF0YXtDdXN0b21lclVzZXJJRH0gfHwgJFBhcmFte0N1c3RvbWVyVXNlcklEfSApIHsKICAgICAgICAgICAgJUN1c3RvbWVyVXNlckRhdGEgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q3VzdG9tZXJVc2VyJyktPkN1c3RvbWVyVXNlckRhdGFHZXQoCiAgICAgICAgICAgICAgICBVc2VyID0+ICRQYXJhbXtDdXN0b21lclVzZXJJRH0gfHwgJFRpY2tldERhdGF7Q3VzdG9tZXJVc2VySUR9LAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgaWYgKCAkQ3VzdG9tZXJVc2VyRGF0YXtVc2VyVGl0bGV9ICkgewogICAgICAgICAgICAkQ3VzdG9tZXJVc2VyRGF0YXtVc2VyVGl0bGV9ID0gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCAkQ3VzdG9tZXJVc2VyRGF0YXtVc2VyVGl0bGV9ICk7CiAgICAgICAgfQoKICAgICAgICAkVGlja2V0Q3VzdG9tZXJJRCA9ICRUaWNrZXREYXRhe0N1c3RvbWVySUR9OwogICAgICAgICRQYXJhbXtTZWxlY3RlZEN1c3RvbWVyVXNlcn0gPSAkVGlja2V0RGF0YXtDdXN0b21lclVzZXJJRH07CgogICAgICAgICRQYXJhbXtUYWJsZX0gPSAkTGF5b3V0T2JqZWN0LT5BZ2VudEN1c3RvbWVyVmlld1RhYmxlKAogICAgICAgICAgICBEYXRhICAgPT4gXCVDdXN0b21lclVzZXJEYXRhLAogICAgICAgICAgICBUaWNrZXQgPT4gXCVUaWNrZXREYXRhLAogICAgICAgICAgICBNYXggICAgPT4gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKS0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpDdXN0b21lckluZm9Db21wb3NlTWF4U2l6ZScpLAogICAgICAgICk7CgogICAgICAgICMgc2hvdyBjdXN0b21lciBmaWVsZCBhcyAiRmlyc3ROYW1lIExhc3RuYW1lIiA8TWFpbEFkZHJlc3M+CiAgICAgICAgaWYgKCVDdXN0b21lclVzZXJEYXRhKSB7CiAgICAgICAgICAgICRUaWNrZXREYXRhe0N1c3RvbWVyVXNlcklEfSA9ICJcIiRDdXN0b21lclVzZXJEYXRhe1VzZXJGdWxsbmFtZX0gIiAuICIgPCRDdXN0b21lclVzZXJEYXRhe1VzZXJFbWFpbH0+IjsKICAgICAgICB9CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ0N1c3RvbWVyJywKICAgICAgICAgICAgRGF0YSA9PiB7ICVUaWNrZXREYXRhLCAlUGFyYW0sIH0sCiAgICAgICAgKTsKICAgIH0KCiAgICAkT3V0cHV0CiAgICAgICAgLj0gJExheW91dE9iamVjdC0+T3V0cHV0KAogICAgICAgIFRlbXBsYXRlRmlsZSA9PiAnQWdlbnRUaWNrZXRDdXN0b21lcicsCiAgICAgICAgRGF0YSAgICAgICAgID0+IFwlUGFyYW0KICAgICAgICApOwogICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5Gb290ZXIoCiAgICAgICAgVHlwZSA9PiAnU21hbGwnLAogICAgKTsKICAgIHJldHVybiAkT3V0cHV0Owp9CgoxOwo=</File>
        <File Location="Custom/Kernel/Modules/AgentTicketEmail.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxLTIwMjIgWm51bnkgR21iSCwgaHR0cHM6Ly96bnVueS5vcmcvCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6TW9kdWxlczo6QWdlbnRUaWNrZXRFbWFpbDsKCnVzZSBzdHJpY3Q7CnVzZSB3YXJuaW5nczsKCnVzZSBNYWlsOjpBZGRyZXNzOwoKdXNlIEtlcm5lbDo6U3lzdGVtOjpWYXJpYWJsZUNoZWNrIHF3KDphbGwpOwp1c2UgS2VybmVsOjpMYW5ndWFnZSBxdyhUcmFuc2xhdGFibGUpOwoKb3VyICRPYmplY3RNYW5hZ2VyRGlzYWJsZWQgPSAxOwoKc3ViIG5ldyB7CiAgICBteSAoICRUeXBlLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgYWxsb2NhdGUgbmV3IGhhc2ggZm9yIG9iamVjdAogICAgbXkgJFNlbGYgPSB7JVBhcmFtfTsKICAgIGJsZXNzKCAkU2VsZiwgJFR5cGUgKTsKCiAgICBteSAkQ29uZmlnID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKS0+R2V0KCJUaWNrZXQ6OkZyb250ZW5kOjokU2VsZi0+e0FjdGlvbn0iKTsKCiAgICAjIGdldCB0aGUgZHluYW1pYyBmaWVsZHMgZm9yIHRoaXMgc2NyZWVuCiAgICAkU2VsZi0+e0R5bmFtaWNGaWVsZH0gPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6RHluYW1pY0ZpZWxkJyktPkR5bmFtaWNGaWVsZExpc3RHZXQoCiAgICAgICAgVmFsaWQgICAgICAgPT4gMSwKICAgICAgICBPYmplY3RUeXBlICA9PiBbICdUaWNrZXQnLCAnQXJ0aWNsZScgXSwKICAgICAgICBGaWVsZEZpbHRlciA9PiAkQ29uZmlnLT57RHluYW1pY0ZpZWxkfSB8fCB7fSwKICAgICk7CgogICAgIyBnZXQgZm9ybSBpZAogICAgJFNlbGYtPntGb3JtSUR9ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OldlYjo6UmVxdWVzdCcpLT5HZXRQYXJhbSggUGFyYW0gPT4gJ0Zvcm1JRCcgKTsKCiAgICAjIGNyZWF0ZSBmb3JtIGlkCiAgICBpZiAoICEkU2VsZi0+e0Zvcm1JRH0gKSB7CiAgICAgICAgJFNlbGYtPntGb3JtSUR9ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OldlYjo6VXBsb2FkQ2FjaGUnKS0+Rm9ybUlEQ3JlYXRlKCk7CiAgICB9CgogICAgcmV0dXJuICRTZWxmOwp9CgpzdWIgUnVuIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJE91dHB1dDsKCiAgICAjIHN0b3JlIGxhc3QgcXVldWUgc2NyZWVuCiAgICBpZiAoICRTZWxmLT57TGFzdFNjcmVlbk92ZXJ2aWV3fSAmJiAkU2VsZi0+e0xhc3RTY3JlZW5PdmVydmlld30gIX4gL0FjdGlvbj1BZ2VudFRpY2tldEVtYWlsLyApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6QXV0aFNlc3Npb24nKS0+VXBkYXRlU2Vzc2lvbklEKAogICAgICAgICAgICBTZXNzaW9uSUQgPT4gJFNlbGYtPntTZXNzaW9uSUR9LAogICAgICAgICAgICBLZXkgICAgICAgPT4gJ0xhc3RTY3JlZW5PdmVydmlldycsCiAgICAgICAgICAgIFZhbHVlICAgICA9PiAkU2VsZi0+e1JlcXVlc3RlZFVSTH0sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGdldCBwYXJhbSBvYmplY3QKICAgIG15ICRQYXJhbU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpXZWI6OlJlcXVlc3QnKTsKCiAgICAjIGdldCB1cGxvYWQgY2FjaGUgb2JqZWN0CiAgICBteSAkVXBsb2FkQ2FjaGVPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6V2ViOjpVcGxvYWRDYWNoZScpOwoKICAgICMgZ2V0IG5lZWRlZCBvYmplY3RzCiAgICBteSAkVGlja2V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpY2tldCcpOwogICAgbXkgJFF1ZXVlT2JqZWN0ICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpRdWV1ZScpOwogICAgbXkgJE1haW5PYmplY3QgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpNYWluJyk7CiAgICBteSAkQ29uZmlnT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKTsKCiAgICBteSAkRGVidWcgICAgICAgICAgICAgID0gJFBhcmFte0RlYnVnfSB8fCAwOwogICAgbXkgJENvbmZpZyAgICAgICAgICAgICA9ICRDb25maWdPYmplY3QtPkdldCgiVGlja2V0OjpGcm9udGVuZDo6JFNlbGYtPntBY3Rpb259Iik7CiAgICBteSAkQ3VzdG9tZXJVc2VyT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyVXNlcicpOwoKICAgICMgZ2V0IHBhcmFtcwogICAgbXkgJUdldFBhcmFtOwogICAgZm9yIG15ICRLZXkgKAogICAgICAgIHF3KFllYXIgTW9udGggRGF5IEhvdXIgTWludXRlIFRvIENjIEJjYyBUaW1lVW5pdHMgUHJpb3JpdHlJRCBTdWJqZWN0IEJvZHkKICAgICAgICBUeXBlSUQgU2VydmljZUlEIFNMQUlEIE93bmVyQWxsIFJlc3BvbnNpYmxlQWxsIE5ld1Jlc3BvbnNpYmxlSUQgTmV3VXNlcklECiAgICAgICAgTmV4dFN0YXRlSUQgU3RhbmRhcmRUZW1wbGF0ZUlEIERlc3QgQXJ0aWNsZUlEIExpbmtUaWNrZXRJRAogICAgICAgICkKICAgICAgICApCiAgICB7CiAgICAgICAgJEdldFBhcmFteyRLZXl9ID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJEtleSApOwogICAgfQoKICAgICMgQUNMIGNvbXBhdGliaWxpdHkgdHJhbnNsYXRpb24KICAgIG15ICVBQ0xDb21wYXRHZXRQYXJhbTsKICAgICRBQ0xDb21wYXRHZXRQYXJhbXtPd25lcklEfSA9ICRHZXRQYXJhbXtOZXdVc2VySUR9OwoKICAgICMgaGFzaCBmb3IgY2hlY2sgZHVwbGljYXRlZCBlbnRyaWVzCiAgICBteSAlQWRkcmVzc2VzTGlzdDsKCiAgICAjIE11bHRpcGxlQ3VzdG9tZXIgVG8tZmllbGQKICAgIG15IEBNdWx0aXBsZUN1c3RvbWVyOwogICAgbXkgJEN1c3RvbWVyc051bWJlciA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdDdXN0b21lclRpY2tldENvdW50ZXJUb0N1c3RvbWVyJyApIHx8IDA7CiAgICBteSAkU2VsZWN0ZWQgICAgICAgID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0N1c3RvbWVyU2VsZWN0ZWQnICkgICAgICAgICAgICAgICAgfHwgJyc7CgogICAgIyBnZXQgY2hlY2sgaXRlbSBvYmplY3QKICAgIG15ICRDaGVja0l0ZW1PYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2hlY2tJdGVtJyk7CgogICAgaWYgKCRDdXN0b21lcnNOdW1iZXIpIHsKICAgICAgICBteSAkQ3VzdG9tZXJDb3VudGVyID0gMTsKICAgICAgICBmb3IgbXkgJENvdW50ICggMSAuLi4gJEN1c3RvbWVyc051bWJlciApIHsKICAgICAgICAgICAgbXkgJEN1c3RvbWVyRWxlbWVudCAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQ3VzdG9tZXJUaWNrZXRUZXh0XycgLiAkQ291bnQgKTsKICAgICAgICAgICAgbXkgJEN1c3RvbWVyU2VsZWN0ZWQgPSAoICRTZWxlY3RlZCBlcSAkQ291bnQgPyAnY2hlY2tlZD0iY2hlY2tlZCInIDogJycgKTsKICAgICAgICAgICAgbXkgJEN1c3RvbWVyS2V5ICAgICAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQ3VzdG9tZXJLZXlfJyAuICRDb3VudCApCiAgICAgICAgICAgICAgICB8fCAnJzsKICAgICAgICAgICAgaWYgKCRDdXN0b21lckVsZW1lbnQpIHsKCiAgICAgICAgICAgICAgICBpZiAoICRHZXRQYXJhbXtUb30gKSB7CiAgICAgICAgICAgICAgICAgICAgJEdldFBhcmFte1RvfSAuPSAnLCAnIC4gJEN1c3RvbWVyRWxlbWVudDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRHZXRQYXJhbXtUb30gPSAkQ3VzdG9tZXJFbGVtZW50OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG15ICRDdXN0b21lckVycm9yTXNnID0gJ0N1c3RvbWVyR2VuZXJpY1NlcnZlckVycm9yTXNnJzsKICAgICAgICAgICAgICAgIG15ICRDdXN0b21lckVycm9yICAgID0gJyc7CiAgICAgICAgICAgICAgICBteSAkQ3VzdG9tZXJEaXNhYmxlZCA9ICcnOwogICAgICAgICAgICAgICAgbXkgJENvdW50QXV4ICAgICAgICAgPSAkQ3VzdG9tZXJDb3VudGVyKys7CgogICAgICAgICAgICAgICAgIyBjaGVjayBlbWFpbCBhZGRyZXNzCiAgICAgICAgICAgICAgICBmb3IgbXkgJEVtYWlsICggTWFpbDo6QWRkcmVzcy0+cGFyc2UoJEN1c3RvbWVyRWxlbWVudCkgKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCAhJENoZWNrSXRlbU9iamVjdC0+Q2hlY2tFbWFpbCggQWRkcmVzcyA9PiAkRW1haWwtPmFkZHJlc3MoKSApICkKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICRDdXN0b21lckVycm9yTXNnID0gJENoZWNrSXRlbU9iamVjdC0+Q2hlY2tFcnJvclR5cGUoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLiAnU2VydmVyRXJyb3JNc2cnOwogICAgICAgICAgICAgICAgICAgICAgICAkQ3VzdG9tZXJFcnJvciA9ICdTZXJ2ZXJFcnJvcic7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgY2hlY2sgZm9yIGR1cGxpY2F0ZWQgZW50cmllcwogICAgICAgICAgICAgICAgaWYgKCBkZWZpbmVkICRBZGRyZXNzZXNMaXN0eyRDdXN0b21lckVsZW1lbnR9ICYmICRDdXN0b21lckVycm9yIGVxICcnICkgewogICAgICAgICAgICAgICAgICAgICRDdXN0b21lckVycm9yTXNnID0gJ0lzRHVwbGljYXRlZFNlcnZlckVycm9yTXNnJzsKICAgICAgICAgICAgICAgICAgICAkQ3VzdG9tZXJFcnJvciAgICA9ICdTZXJ2ZXJFcnJvcic7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCAkQ3VzdG9tZXJFcnJvciBuZSAnJyApIHsKICAgICAgICAgICAgICAgICAgICAkQ3VzdG9tZXJEaXNhYmxlZCA9ICdkaXNhYmxlZD0iZGlzYWJsZWQiJzsKICAgICAgICAgICAgICAgICAgICAkQ291bnRBdXggICAgICAgICA9ICRDb3VudCAuICdFcnJvcic7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcHVzaCBATXVsdGlwbGVDdXN0b21lciwgewogICAgICAgICAgICAgICAgICAgIENvdW50ICAgICAgICAgICAgPT4gJENvdW50QXV4LAogICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyRWxlbWVudCAgPT4gJEN1c3RvbWVyRWxlbWVudCwKICAgICAgICAgICAgICAgICAgICBDdXN0b21lclNlbGVjdGVkID0+ICRDdXN0b21lclNlbGVjdGVkLAogICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyS2V5ICAgICAgPT4gJEN1c3RvbWVyS2V5LAogICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyRXJyb3IgICAgPT4gJEN1c3RvbWVyRXJyb3IsCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJFcnJvck1zZyA9PiAkQ3VzdG9tZXJFcnJvck1zZywKICAgICAgICAgICAgICAgICAgICBDdXN0b21lckRpc2FibGVkID0+ICRDdXN0b21lckRpc2FibGVkLAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICRBZGRyZXNzZXNMaXN0eyRDdXN0b21lckVsZW1lbnR9ID0gMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAjIE11bHRpcGxlQ3VzdG9tZXIgQ2MtZmllbGQKICAgIG15IEBNdWx0aXBsZUN1c3RvbWVyQ2M7CiAgICBteSAkQ3VzdG9tZXJzTnVtYmVyQ2MgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQ3VzdG9tZXJUaWNrZXRDb3VudGVyQ2NDdXN0b21lcicgKSB8fCAwOwoKICAgIGlmICgkQ3VzdG9tZXJzTnVtYmVyQ2MpIHsKICAgICAgICBteSAkQ3VzdG9tZXJDb3VudGVyQ2MgPSAxOwogICAgICAgIGZvciBteSAkQ291bnQgKCAxIC4uLiAkQ3VzdG9tZXJzTnVtYmVyQ2MgKSB7CiAgICAgICAgICAgIG15ICRDdXN0b21lckVsZW1lbnRDYyA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdDY0N1c3RvbWVyVGlja2V0VGV4dF8nIC4gJENvdW50ICk7CiAgICAgICAgICAgIG15ICRDdXN0b21lcktleUNjICAgICA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdDY0N1c3RvbWVyS2V5XycgLiAkQ291bnQgKQogICAgICAgICAgICAgICAgfHwgJyc7CgogICAgICAgICAgICBpZiAoJEN1c3RvbWVyRWxlbWVudENjKSB7CiAgICAgICAgICAgICAgICBteSAkQ3VzdG9tZXJFcnJvck1zZ0NjID0gJ0N1c3RvbWVyR2VuZXJpY1NlcnZlckVycm9yTXNnJzsKICAgICAgICAgICAgICAgIG15ICRDdXN0b21lckVycm9yQ2MgICAgPSAnJzsKICAgICAgICAgICAgICAgIG15ICRDdXN0b21lckRpc2FibGVkQ2MgPSAnJzsKICAgICAgICAgICAgICAgIG15ICRDb3VudEF1eENjICAgICAgICAgPSAkQ3VzdG9tZXJDb3VudGVyQ2MrKzsKCiAgICAgICAgICAgICAgICBpZiAoICRHZXRQYXJhbXtDY30gKSB7CiAgICAgICAgICAgICAgICAgICAgJEdldFBhcmFte0NjfSAuPSAnLCAnIC4gJEN1c3RvbWVyRWxlbWVudENjOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJEdldFBhcmFte0NjfSA9ICRDdXN0b21lckVsZW1lbnRDYzsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIGNoZWNrIGVtYWlsIGFkZHJlc3MKICAgICAgICAgICAgICAgIGZvciBteSAkRW1haWwgKCBNYWlsOjpBZGRyZXNzLT5wYXJzZSgkQ3VzdG9tZXJFbGVtZW50Q2MpICkgewogICAgICAgICAgICAgICAgICAgIGlmICggISRDaGVja0l0ZW1PYmplY3QtPkNoZWNrRW1haWwoIEFkZHJlc3MgPT4gJEVtYWlsLT5hZGRyZXNzKCkgKSApCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAkQ3VzdG9tZXJFcnJvck1zZ0NjID0gJENoZWNrSXRlbU9iamVjdC0+Q2hlY2tFcnJvclR5cGUoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLiAnU2VydmVyRXJyb3JNc2cnOwogICAgICAgICAgICAgICAgICAgICAgICAkQ3VzdG9tZXJFcnJvckNjID0gJ1NlcnZlckVycm9yJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBjaGVjayBmb3IgZHVwbGljYXRlZCBlbnRyaWVzCiAgICAgICAgICAgICAgICBpZiAoIGRlZmluZWQgJEFkZHJlc3Nlc0xpc3R7JEN1c3RvbWVyRWxlbWVudENjfSAmJiAkQ3VzdG9tZXJFcnJvckNjIGVxICcnICkgewogICAgICAgICAgICAgICAgICAgICRDdXN0b21lckVycm9yTXNnQ2MgPSAnSXNEdXBsaWNhdGVkU2VydmVyRXJyb3JNc2cnOwogICAgICAgICAgICAgICAgICAgICRDdXN0b21lckVycm9yQ2MgICAgPSAnU2VydmVyRXJyb3InOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICggJEN1c3RvbWVyRXJyb3JDYyBuZSAnJyApIHsKICAgICAgICAgICAgICAgICAgICAkQ3VzdG9tZXJEaXNhYmxlZENjID0gJ2Rpc2FibGVkPSJkaXNhYmxlZCInOwogICAgICAgICAgICAgICAgICAgICRDb3VudEF1eENjICAgICAgICAgPSAkQ291bnQgLiAnRXJyb3InOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHB1c2ggQE11bHRpcGxlQ3VzdG9tZXJDYywgewogICAgICAgICAgICAgICAgICAgIENvdW50ICAgICAgICAgICAgPT4gJENvdW50QXV4Q2MsCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJFbGVtZW50ICA9PiAkQ3VzdG9tZXJFbGVtZW50Q2MsCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJLZXkgICAgICA9PiAkQ3VzdG9tZXJLZXlDYywKICAgICAgICAgICAgICAgICAgICBDdXN0b21lckVycm9yICAgID0+ICRDdXN0b21lckVycm9yQ2MsCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJFcnJvck1zZyA9PiAkQ3VzdG9tZXJFcnJvck1zZ0NjLAogICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyRGlzYWJsZWQgPT4gJEN1c3RvbWVyRGlzYWJsZWRDYywKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAkQWRkcmVzc2VzTGlzdHskQ3VzdG9tZXJFbGVtZW50Q2N9ID0gMTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAjIE11bHRpcGxlQ3VzdG9tZXIgQmNjLWZpZWxkCiAgICBteSBATXVsdGlwbGVDdXN0b21lckJjYzsKICAgIG15ICRDdXN0b21lcnNOdW1iZXJCY2MgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQ3VzdG9tZXJUaWNrZXRDb3VudGVyQmNjQ3VzdG9tZXInICkgfHwgMDsKCiAgICBpZiAoJEN1c3RvbWVyc051bWJlckJjYykgewogICAgICAgIG15ICRDdXN0b21lckNvdW50ZXJCY2MgPSAxOwogICAgICAgIGZvciBteSAkQ291bnQgKCAxIC4uLiAkQ3VzdG9tZXJzTnVtYmVyQmNjICkgewogICAgICAgICAgICBteSAkQ3VzdG9tZXJFbGVtZW50QmNjID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0JjY0N1c3RvbWVyVGlja2V0VGV4dF8nIC4gJENvdW50ICk7CiAgICAgICAgICAgIG15ICRDdXN0b21lcktleUJjYyAgICAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQmNjQ3VzdG9tZXJLZXlfJyAuICRDb3VudCApCiAgICAgICAgICAgICAgICB8fCAnJzsKCiAgICAgICAgICAgIGlmICgkQ3VzdG9tZXJFbGVtZW50QmNjKSB7CgogICAgICAgICAgICAgICAgbXkgJEN1c3RvbWVyRGlzYWJsZWRCY2MgPSAnJzsKICAgICAgICAgICAgICAgIG15ICRDb3VudEF1eEJjYyAgICAgICAgID0gJEN1c3RvbWVyQ291bnRlckJjYysrOwogICAgICAgICAgICAgICAgbXkgJEN1c3RvbWVyRXJyb3JNc2dCY2MgPSAnQ3VzdG9tZXJHZW5lcmljU2VydmVyRXJyb3JNc2cnOwogICAgICAgICAgICAgICAgbXkgJEN1c3RvbWVyRXJyb3JCY2MgICAgPSAnJzsKCiAgICAgICAgICAgICAgICBpZiAoICRHZXRQYXJhbXtCY2N9ICkgewogICAgICAgICAgICAgICAgICAgICRHZXRQYXJhbXtCY2N9IC49ICcsICcgLiAkQ3VzdG9tZXJFbGVtZW50QmNjOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJEdldFBhcmFte0JjY30gPSAkQ3VzdG9tZXJFbGVtZW50QmNjOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgY2hlY2sgZW1haWwgYWRkcmVzcwogICAgICAgICAgICAgICAgZm9yIG15ICRFbWFpbCAoIE1haWw6OkFkZHJlc3MtPnBhcnNlKCRDdXN0b21lckVsZW1lbnRCY2MpICkgewogICAgICAgICAgICAgICAgICAgIGlmICggISRDaGVja0l0ZW1PYmplY3QtPkNoZWNrRW1haWwoIEFkZHJlc3MgPT4gJEVtYWlsLT5hZGRyZXNzKCkgKSApCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAkQ3VzdG9tZXJFcnJvck1zZ0JjYyA9ICRDaGVja0l0ZW1PYmplY3QtPkNoZWNrRXJyb3JUeXBlKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4gJ1NlcnZlckVycm9yTXNnJzsKICAgICAgICAgICAgICAgICAgICAgICAgJEN1c3RvbWVyRXJyb3JCY2MgPSAnU2VydmVyRXJyb3InOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIGNoZWNrIGZvciBkdXBsaWNhdGVkIGVudHJpZXMKICAgICAgICAgICAgICAgIGlmICggZGVmaW5lZCAkQWRkcmVzc2VzTGlzdHskQ3VzdG9tZXJFbGVtZW50QmNjfSAmJiAkQ3VzdG9tZXJFcnJvckJjYyBlcSAnJyApIHsKICAgICAgICAgICAgICAgICAgICAkQ3VzdG9tZXJFcnJvck1zZ0JjYyA9ICdJc0R1cGxpY2F0ZWRTZXJ2ZXJFcnJvck1zZyc7CiAgICAgICAgICAgICAgICAgICAgJEN1c3RvbWVyRXJyb3JCY2MgICAgPSAnU2VydmVyRXJyb3InOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICggJEN1c3RvbWVyRXJyb3JCY2MgbmUgJycgKSB7CiAgICAgICAgICAgICAgICAgICAgJEN1c3RvbWVyRGlzYWJsZWRCY2MgPSAnZGlzYWJsZWQ9ImRpc2FibGVkIic7CiAgICAgICAgICAgICAgICAgICAgJENvdW50QXV4QmNjICAgICAgICAgPSAkQ291bnQgLiAnRXJyb3InOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHB1c2ggQE11bHRpcGxlQ3VzdG9tZXJCY2MsIHsKICAgICAgICAgICAgICAgICAgICBDb3VudCAgICAgICAgICAgID0+ICRDb3VudEF1eEJjYywKICAgICAgICAgICAgICAgICAgICBDdXN0b21lckVsZW1lbnQgID0+ICRDdXN0b21lckVsZW1lbnRCY2MsCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJLZXkgICAgICA9PiAkQ3VzdG9tZXJLZXlCY2MsCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJFcnJvciAgICA9PiAkQ3VzdG9tZXJFcnJvckJjYywKICAgICAgICAgICAgICAgICAgICBDdXN0b21lckVycm9yTXNnID0+ICRDdXN0b21lckVycm9yTXNnQmNjLAogICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyRGlzYWJsZWQgPT4gJEN1c3RvbWVyRGlzYWJsZWRCY2MsCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgJEFkZHJlc3Nlc0xpc3R7JEN1c3RvbWVyRWxlbWVudEJjY30gPSAxOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgICMgc2V0IGFuIGVtcHR5IHZhbHVlIGlmIG5vdCBkZWZpbmVkCiAgICAkR2V0UGFyYW17Q2N9ICA9ICcnIGlmICFkZWZpbmVkICRHZXRQYXJhbXtDY307CiAgICAkR2V0UGFyYW17QmNjfSA9ICcnIGlmICFkZWZpbmVkICRHZXRQYXJhbXtCY2N9OwoKICAgICMgZ2V0IER5bmFtaWMgZmllbGRzIGZvcm0gUGFyYW1PYmplY3QKICAgIG15ICVEeW5hbWljRmllbGRWYWx1ZXM7CgogICAgIyBnZXQgbmVlZGVkIG9iamVjdHMKICAgIG15ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkR5bmFtaWNGaWVsZDo6QmFja2VuZCcpOwogICAgbXkgJExheW91dE9iamVjdCAgICAgICAgICAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgIyBjeWNsZSB0aHJvdWdoIHRoZSBhY3RpdmF0ZWQgRHluYW1pYyBGaWVsZHMgZm9yIHRoaXMgc2NyZWVuCiAgICBEWU5BTUlDRklFTEQ6CiAgICBmb3IgbXkgJER5bmFtaWNGaWVsZENvbmZpZyAoIEB7ICRTZWxmLT57RHluYW1pY0ZpZWxkfSB9ICkgewogICAgICAgIG5leHQgRFlOQU1JQ0ZJRUxEIGlmICFJc0hhc2hSZWZXaXRoRGF0YSgkRHluYW1pY0ZpZWxkQ29uZmlnKTsKCiAgICAgICAgIyBleHRyYWN0IHRoZSBkeW5hbWljIGZpZWxkIHZhbHVlIGZyb20gdGhlIHdlYiByZXF1ZXN0CiAgICAgICAgJER5bmFtaWNGaWVsZFZhbHVlc3sgJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9IH0gPSAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdC0+RWRpdEZpZWxkVmFsdWVHZXQoCiAgICAgICAgICAgIER5bmFtaWNGaWVsZENvbmZpZyA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnLAogICAgICAgICAgICBQYXJhbU9iamVjdCAgICAgICAgPT4gJFBhcmFtT2JqZWN0LAogICAgICAgICAgICBMYXlvdXRPYmplY3QgICAgICAgPT4gJExheW91dE9iamVjdCwKICAgICAgICApOwogICAgfQoKICAgICMgY29udmVydCBkeW5hbWljIGZpZWxkIHZhbHVlcyBpbnRvIGEgc3RydWN0dXJlIGZvciBBQ0xzCiAgICBteSAlRHluYW1pY0ZpZWxkQUNMUGFyYW1ldGVyczsKICAgIERZTkFNSUNGSUVMRDoKICAgIGZvciBteSAkRHluYW1pY0ZpZWxkICggc29ydCBrZXlzICVEeW5hbWljRmllbGRWYWx1ZXMgKSB7CiAgICAgICAgbmV4dCBEWU5BTUlDRklFTEQgaWYgISREeW5hbWljRmllbGQ7CiAgICAgICAgbmV4dCBEWU5BTUlDRklFTEQgaWYgISREeW5hbWljRmllbGRWYWx1ZXN7JER5bmFtaWNGaWVsZH07CgogICAgICAgICREeW5hbWljRmllbGRBQ0xQYXJhbWV0ZXJzeyAnRHluYW1pY0ZpZWxkXycgLiAkRHluYW1pY0ZpZWxkIH0gPSAkRHluYW1pY0ZpZWxkVmFsdWVzeyREeW5hbWljRmllbGR9OwogICAgfQogICAgJEdldFBhcmFte0R5bmFtaWNGaWVsZH0gPSBcJUR5bmFtaWNGaWVsZEFDTFBhcmFtZXRlcnM7CgogICAgIyB0cmFuc2Zvcm0gcGVuZGluZyB0aW1lLCB0aW1lIHN0YW1wIGJhc2VkIG9uIHVzZXIgdGltZSB6b25lCiAgICBpZiAoCiAgICAgICAgZGVmaW5lZCAkR2V0UGFyYW17WWVhcn0KICAgICAgICAmJiBkZWZpbmVkICRHZXRQYXJhbXtNb250aH0KICAgICAgICAmJiBkZWZpbmVkICRHZXRQYXJhbXtEYXl9CiAgICAgICAgJiYgZGVmaW5lZCAkR2V0UGFyYW17SG91cn0KICAgICAgICAmJiBkZWZpbmVkICRHZXRQYXJhbXtNaW51dGV9CiAgICAgICAgKQogICAgewogICAgICAgICVHZXRQYXJhbSA9ICRMYXlvdXRPYmplY3QtPlRyYW5zZm9ybURhdGVTZWxlY3Rpb24oCiAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICApOwogICAgfQoKICAgIGlmICggISRTZWxmLT57U3ViYWN0aW9ufSB8fCAkU2VsZi0+e1N1YmFjdGlvbn0gZXEgJ0NyZWF0ZWQnICkgewogICAgICAgIG15ICVUaWNrZXQ7CiAgICAgICAgaWYgKCAkU2VsZi0+e1RpY2tldElEfSApIHsKICAgICAgICAgICAgJVRpY2tldCA9ICRUaWNrZXRPYmplY3QtPlRpY2tldEdldCggVGlja2V0SUQgPT4gJFNlbGYtPntUaWNrZXRJRH0gKTsKICAgICAgICB9CgogICAgICAgICMgaGVhZGVyCiAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5IZWFkZXIoKTsKICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk5hdmlnYXRpb25CYXIoKTsKCiAgICAgICAgIyBub3RpZnkgaW5mbwogICAgICAgIGlmICggJFNlbGYtPntUaWNrZXRJRH0gJiYgJFNlbGYtPntTdWJhY3Rpb259IGVxICdDcmVhdGVkJyApIHsKCiAgICAgICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Tm90aWZ5KAogICAgICAgICAgICAgICAgSW5mbyA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoCiAgICAgICAgICAgICAgICAgICAgJ1RpY2tldCAiJXMiIGNyZWF0ZWQhJywKICAgICAgICAgICAgICAgICAgICAkVGlja2V0e1RpY2tldE51bWJlcn0sCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgTGluayA9PiAkTGF5b3V0T2JqZWN0LT57QmFzZWxpbmt9CiAgICAgICAgICAgICAgICAgICAgLiAnQWN0aW9uPUFnZW50VGlja2V0Wm9vbTtUaWNrZXRJRD0nCiAgICAgICAgICAgICAgICAgICAgLiAkVGlja2V0e1RpY2tldElEfSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgc3RvcmUgbGFzdCBxdWV1ZSBzY3JlZW4KICAgICAgICBpZiAoCiAgICAgICAgICAgICRTZWxmLT57TGFzdFNjcmVlbk92ZXJ2aWV3fQogICAgICAgICAgICAmJiAkU2VsZi0+e0xhc3RTY3JlZW5PdmVydmlld30gIX4gL0FjdGlvbj1BZ2VudFRpY2tldEVtYWlsLwogICAgICAgICAgICAmJiAkU2VsZi0+e1JlcXVlc3RlZFVSTH0gICAgICAgIX4gL0FjdGlvbj1BZ2VudFRpY2tldEVtYWlsLipMaW5rVGlja2V0SUQ9LwogICAgICAgICAgICApCiAgICAgICAgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6QXV0aFNlc3Npb24nKS0+VXBkYXRlU2Vzc2lvbklEKAogICAgICAgICAgICAgICAgU2Vzc2lvbklEID0+ICRTZWxmLT57U2Vzc2lvbklEfSwKICAgICAgICAgICAgICAgIEtleSAgICAgICA9PiAnTGFzdFNjcmVlbk92ZXJ2aWV3JywKICAgICAgICAgICAgICAgIFZhbHVlICAgICA9PiAkU2VsZi0+e1JlcXVlc3RlZFVSTH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIGdldCBzcGxpdCBhcnRpY2xlIGlmIGdpdmVuCiAgICAgICAgIyBnZXQgQXJ0aWNsZUlECiAgICAgICAgbXkgJUFydGljbGU7CiAgICAgICAgbXkgJUN1c3RvbWVyRGF0YTsKICAgICAgICBteSAkQXJ0aWNsZUZyb20gPSAnJzsKICAgICAgICBteSAlU3BsaXRUaWNrZXREYXRhOwogICAgICAgIGlmICggJEdldFBhcmFte0FydGljbGVJRH0gKSB7CgogICAgICAgICAgICBteSAkQWNjZXNzID0gJFRpY2tldE9iamVjdC0+VGlja2V0UGVybWlzc2lvbigKICAgICAgICAgICAgICAgIFR5cGUgICAgID0+ICdybycsCiAgICAgICAgICAgICAgICBUaWNrZXRJRCA9PiAkU2VsZi0+e1RpY2tldElEfSwKICAgICAgICAgICAgICAgIFVzZXJJRCAgID0+ICRTZWxmLT57VXNlcklEfQogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKCAhJEFjY2VzcyApIHsKICAgICAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5Ob1Blcm1pc3Npb24oCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSAgICA9PiAiWW91IG5lZWQgcm8gcGVybWlzc2lvbiEiLAogICAgICAgICAgICAgICAgICAgIFdpdGhIZWFkZXIgPT4gJ3llcycsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIEdldCBpbmZvcm1hdGlvbiBmcm9tIG9yaWdpbmFsIHRpY2tldCAoU3BsaXRUaWNrZXQpLgogICAgICAgICAgICAlU3BsaXRUaWNrZXREYXRhID0gJFRpY2tldE9iamVjdC0+VGlja2V0R2V0KAogICAgICAgICAgICAgICAgVGlja2V0SUQgICAgICA9PiAkU2VsZi0+e1RpY2tldElEfSwKICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZHMgPT4gMSwKICAgICAgICAgICAgICAgIFVzZXJJRCAgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICApOwoKICAgICAgICAgICAgbXkgJEFydGljbGVCYWNrZW5kT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpY2tldDo6QXJ0aWNsZScpLT5CYWNrZW5kRm9yQXJ0aWNsZSgKICAgICAgICAgICAgICAgIFRpY2tldElEICA9PiAkU2VsZi0+e1RpY2tldElEfSwKICAgICAgICAgICAgICAgIEFydGljbGVJRCA9PiAkR2V0UGFyYW17QXJ0aWNsZUlEfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICVBcnRpY2xlID0gJEFydGljbGVCYWNrZW5kT2JqZWN0LT5BcnRpY2xlR2V0KAogICAgICAgICAgICAgICAgVGlja2V0SUQgID0+ICRTZWxmLT57VGlja2V0SUR9LAogICAgICAgICAgICAgICAgQXJ0aWNsZUlEID0+ICRHZXRQYXJhbXtBcnRpY2xlSUR9LAogICAgICAgICAgICApOwoKICAgICAgICAgICAgIyBjaGVjayBpZiBhcnRpY2xlIGlzIGZyb20gdGhlIHNhbWUgVGlja2V0SUQgYXMgd2UgY2hlY2tlZCBwZXJtaXNzaW9ucyBmb3IuCiAgICAgICAgICAgIGlmICggJEFydGljbGV7VGlja2V0SUR9IG5lICRTZWxmLT57VGlja2V0SUR9ICkgewogICAgICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkVycm9yU2NyZWVuKAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKAogICAgICAgICAgICAgICAgICAgICAgICAnQXJ0aWNsZSBkb2VzIG5vdCBiZWxvbmcgdG8gdGlja2V0ICVzIScsICRTZWxmLT57VGlja2V0SUR9CiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRBcnRpY2xle1N1YmplY3R9ID0gJFRpY2tldE9iamVjdC0+VGlja2V0U3ViamVjdENsZWFuKAogICAgICAgICAgICAgICAgVGlja2V0TnVtYmVyID0+ICRUaWNrZXR7VGlja2V0TnVtYmVyfSwKICAgICAgICAgICAgICAgIFN1YmplY3QgICAgICA9PiAkQXJ0aWNsZXtTdWJqZWN0fSB8fCAnJywKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgc2F2ZSBhcnRpY2xlIGZyb20gZm9yIGFkZHJlc3NlcyBsaXN0CiAgICAgICAgICAgICRBcnRpY2xlRnJvbSA9ICRBcnRpY2xle0Zyb219OwoKICAgICAgICAgICAgIyBpZiBUbyBpcyBwcmVzZW50CiAgICAgICAgICAgICMgYW5kIGlzIG5vIGEgcXVldWUKICAgICAgICAgICAgIyBhbmQgYWxzbyBpcyBubyBhIHN5c3RlbSBhZGRyZXNzCiAgICAgICAgICAgICMgc2V0IFRvIGFzIGFydGljbGUgZnJvbQogICAgICAgICAgICBpZiAoIElzU3RyaW5nV2l0aERhdGEoICRBcnRpY2xle1RvfSApICkgewogICAgICAgICAgICAgICAgbXkgJVF1ZXVlcyA9ICRRdWV1ZU9iamVjdC0+UXVldWVMaXN0KCk7CgogICAgICAgICAgICAgICAgaWYgKCAkQ29uZmlnT2JqZWN0LT57Q3VzdG9tZXJQYW5lbE93blNlbGVjdGlvbn0gKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIG15ICRRdWV1ZSAoIHNvcnQga2V5cyAleyAkQ29uZmlnT2JqZWN0LT57Q3VzdG9tZXJQYW5lbE93blNlbGVjdGlvbn0gfSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgbXkgJFZhbHVlID0gJENvbmZpZ09iamVjdC0+e0N1c3RvbWVyUGFuZWxPd25TZWxlY3Rpb259LT57JFF1ZXVlfTsKICAgICAgICAgICAgICAgICAgICAgICAgJFF1ZXVlc3skUXVldWV9ID0gJFZhbHVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBteSAlUXVldWVMb29rdXAgPSByZXZlcnNlICVRdWV1ZXM7CiAgICAgICAgICAgICAgICBteSAlU3lzdGVtQWRkcmVzc0xvb2t1cAogICAgICAgICAgICAgICAgICAgID0gcmV2ZXJzZSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6U3lzdGVtQWRkcmVzcycpLT5TeXN0ZW1BZGRyZXNzTGlzdCgpOwogICAgICAgICAgICAgICAgbXkgQEFydGljbGVGcm9tQWRkcmVzczsKICAgICAgICAgICAgICAgIG15ICRTeXN0ZW1BZGRyZXNzRW1haWw7CgogICAgICAgICAgICAgICAgaWYgKCRBcnRpY2xlRnJvbSkgewogICAgICAgICAgICAgICAgICAgIEBBcnRpY2xlRnJvbUFkZHJlc3MgPSBNYWlsOjpBZGRyZXNzLT5wYXJzZSgkQXJ0aWNsZUZyb20pOwogICAgICAgICAgICAgICAgICAgICRTeXN0ZW1BZGRyZXNzRW1haWwgPSAkQXJ0aWNsZUZyb21BZGRyZXNzWzBdLT5hZGRyZXNzKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCAhZGVmaW5lZCAkUXVldWVMb29rdXB7ICRBcnRpY2xle1RvfSB9ICYmIGRlZmluZWQgJFN5c3RlbUFkZHJlc3NMb29rdXB7JFN5c3RlbUFkZHJlc3NFbWFpbH0gKSB7CiAgICAgICAgICAgICAgICAgICAgJEFydGljbGVGcm9tID0gJEFydGljbGV7VG99OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGJvZHkgcHJlcGFyYXRpb24gZm9yIHBsYWluIHRleHQgcHJvY2Vzc2luZwogICAgICAgICAgICAkQXJ0aWNsZXtCb2R5fSA9ICRMYXlvdXRPYmplY3QtPkFydGljbGVRdW90ZSgKICAgICAgICAgICAgICAgIFRpY2tldElEICAgICAgICAgICA9PiAkQXJ0aWNsZXtUaWNrZXRJRH0sCiAgICAgICAgICAgICAgICBBcnRpY2xlSUQgICAgICAgICAgPT4gJEdldFBhcmFte0FydGljbGVJRH0sCiAgICAgICAgICAgICAgICBGb3JtSUQgICAgICAgICAgICAgPT4gJFNlbGYtPntGb3JtSUR9LAogICAgICAgICAgICAgICAgVXBsb2FkQ2FjaGVPYmplY3QgID0+ICRVcGxvYWRDYWNoZU9iamVjdCwKICAgICAgICAgICAgICAgIEF0dGFjaG1lbnRzSW5jbHVkZSA9PiAxLAogICAgICAgICAgICApOwogICAgICAgICAgICBpZiAoICRMYXlvdXRPYmplY3QtPntCcm93c2VyUmljaFRleHR9ICkgewogICAgICAgICAgICAgICAgJEFydGljbGV7Q29udGVudFR5cGV9ID0gJ3RleHQvaHRtbCc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkQXJ0aWNsZXtDb250ZW50VHlwZX0gPSAndGV4dC9wbGFpbic7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG15ICVTYWZldHlDaGVja1Jlc3VsdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpIVE1MVXRpbHMnKS0+U2FmZXR5KAogICAgICAgICAgICAgICAgU3RyaW5nID0+ICRBcnRpY2xle0JvZHl9LAoKICAgICAgICAgICAgICAgICMgU3RyaXAgb3V0IGV4dGVybmFsIGNvbnRlbnQgaWYgQmxvY2tMb2FkaW5nUmVtb3RlQ29udGVudCBpcyBlbmFibGVkLgogICAgICAgICAgICAgICAgTm9FeHRTcmNMb2FkID0+ICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpGcm9udGVuZDo6QmxvY2tMb2FkaW5nUmVtb3RlQ29udGVudCcpLAoKICAgICAgICAgICAgICAgICMgRGlzYWxsb3cgcG90ZW50aWFsbHkgdW5zYWZlIGNvbnRlbnQuCiAgICAgICAgICAgICAgICBOb0FwcGxldCAgICAgPT4gMSwKICAgICAgICAgICAgICAgIE5vT2JqZWN0ICAgICA9PiAxLAogICAgICAgICAgICAgICAgTm9FbWJlZCAgICAgID0+IDEsCiAgICAgICAgICAgICAgICBOb1NWRyAgICAgICAgPT4gMSwKICAgICAgICAgICAgICAgIE5vSmF2YVNjcmlwdCA9PiAxLAogICAgICAgICAgICApOwogICAgICAgICAgICAkQXJ0aWNsZXtCb2R5fSA9ICRTYWZldHlDaGVja1Jlc3VsdHtTdHJpbmd9OwoKICAgICAgICAgICAgIyBzaG93IGN1c3RvbWVyIGluZm8KICAgICAgICAgICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6OkN1c3RvbWVySW5mb0NvbXBvc2UnKSApIHsKICAgICAgICAgICAgICAgIGlmICggJEFydGljbGV7Q3VzdG9tZXJVc2VySUR9ICkgewogICAgICAgICAgICAgICAgICAgICVDdXN0b21lckRhdGEgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJEYXRhR2V0KAogICAgICAgICAgICAgICAgICAgICAgICBVc2VyID0+ICRBcnRpY2xle0N1c3RvbWVyVXNlcklEfSwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzaWYgKCAkQXJ0aWNsZXtDdXN0b21lcklEfSApIHsKICAgICAgICAgICAgICAgICAgICAlQ3VzdG9tZXJEYXRhID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJVc2VyRGF0YUdldCgKICAgICAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJJRCA9PiAkQXJ0aWNsZXtDdXN0b21lcklEfSwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzaWYgKCAkU3BsaXRUaWNrZXREYXRhe0N1c3RvbWVyVXNlcklEfSApIHsKICAgICAgICAgICAgICAgICAgICAlQ3VzdG9tZXJEYXRhID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJVc2VyRGF0YUdldCgKICAgICAgICAgICAgICAgICAgICAgICAgVXNlciA9PiAkU3BsaXRUaWNrZXREYXRhe0N1c3RvbWVyVXNlcklEfSwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzaWYgKCAkU3BsaXRUaWNrZXREYXRhe0N1c3RvbWVySUR9ICkgewogICAgICAgICAgICAgICAgICAgICVDdXN0b21lckRhdGEgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJEYXRhR2V0KAogICAgICAgICAgICAgICAgICAgICAgICBDdXN0b21lcklEID0+ICRTcGxpdFRpY2tldERhdGF7Q3VzdG9tZXJJRH0sCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoICRBcnRpY2xle0N1c3RvbWVyVXNlcklEfSApIHsKICAgICAgICAgICAgICAgIG15ICVDdXN0b21lclVzZXJMaXN0ID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJTZWFyY2goCiAgICAgICAgICAgICAgICAgICAgVXNlckxvZ2luID0+ICRBcnRpY2xle0N1c3RvbWVyVXNlcklEfSwKICAgICAgICAgICAgICAgICAgICBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGZvciBteSAkS2V5Q3VzdG9tZXJVc2VyTGlzdCAoIHNvcnQga2V5cyAlQ3VzdG9tZXJVc2VyTGlzdCApIHsKICAgICAgICAgICAgICAgICAgICAkQXJ0aWNsZXtGcm9tfSA9ICRDdXN0b21lclVzZXJMaXN0eyRLZXlDdXN0b21lclVzZXJMaXN0fTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBtdWx0aXBsZSBhZGRyZXNzZXMgbGlzdAogICAgICAgICMgY2hlY2sgZW1haWwgYWRkcmVzcwogICAgICAgIG15ICRDb3VudEZyb20gPSBzY2FsYXIgQE11bHRpcGxlQ3VzdG9tZXIgfHwgMTsKICAgICAgICBteSAlQ3VzdG9tZXJEYXRhRnJvbTsKICAgICAgICBpZiAoICRBcnRpY2xle0N1c3RvbWVyVXNlcklEfSApIHsKICAgICAgICAgICAgJUN1c3RvbWVyRGF0YUZyb20gPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJEYXRhR2V0KAogICAgICAgICAgICAgICAgVXNlciA9PiAkQXJ0aWNsZXtDdXN0b21lclVzZXJJRH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICBmb3IgbXkgJEVtYWlsICggTWFpbDo6QWRkcmVzcy0+cGFyc2UoJEFydGljbGVGcm9tKSApIHsKCiAgICAgICAgICAgIG15ICRDb3VudEF1eCAgICAgICAgID0gJENvdW50RnJvbTsKICAgICAgICAgICAgbXkgJEN1c3RvbWVyRXJyb3IgICAgPSAnJzsKICAgICAgICAgICAgbXkgJEN1c3RvbWVyRXJyb3JNc2cgPSAnQ3VzdG9tZXJHZW5lcmljU2VydmVyRXJyb3JNc2cnOwogICAgICAgICAgICBteSAkQ3VzdG9tZXJEaXNhYmxlZCA9ICcnOwogICAgICAgICAgICBteSAkQ3VzdG9tZXJTZWxlY3RlZCA9ICRDb3VudEZyb20gZXEgJzEnID8gJ2NoZWNrZWQ9ImNoZWNrZWQiJyA6ICcnOwogICAgICAgICAgICBteSAkRW1haWxBZGRyZXNzICAgICA9ICRFbWFpbC0+YWRkcmVzcygpOwogICAgICAgICAgICBpZiAoICEkQ2hlY2tJdGVtT2JqZWN0LT5DaGVja0VtYWlsKCBBZGRyZXNzID0+ICRFbWFpbEFkZHJlc3MgKSApCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRDdXN0b21lckVycm9yTXNnID0gJENoZWNrSXRlbU9iamVjdC0+Q2hlY2tFcnJvclR5cGUoKQogICAgICAgICAgICAgICAgICAgIC4gJ1NlcnZlckVycm9yTXNnJzsKICAgICAgICAgICAgICAgICRDdXN0b21lckVycm9yID0gJ1NlcnZlckVycm9yJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBjaGVjayBmb3IgZHVwbGljYXRlZCBlbnRyaWVzCiAgICAgICAgICAgIGlmICggZGVmaW5lZCAkQWRkcmVzc2VzTGlzdHskRW1haWx9ICYmICRDdXN0b21lckVycm9yIGVxICcnICkgewogICAgICAgICAgICAgICAgJEN1c3RvbWVyRXJyb3JNc2cgPSAnSXNEdXBsaWNhdGVkU2VydmVyRXJyb3JNc2cnOwogICAgICAgICAgICAgICAgJEN1c3RvbWVyRXJyb3IgICAgPSAnU2VydmVyRXJyb3InOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoICRDdXN0b21lckVycm9yIG5lICcnICkgewogICAgICAgICAgICAgICAgJEN1c3RvbWVyRGlzYWJsZWQgPSAnZGlzYWJsZWQ9ImRpc2FibGVkIic7CiAgICAgICAgICAgICAgICAkQ291bnRBdXggICAgICAgICA9ICRDb3VudEZyb20gLiAnRXJyb3InOwogICAgICAgICAgICB9CgogICAgICAgICAgICBteSAkUGhyYXNlID0gJyc7CiAgICAgICAgICAgIGlmICggJEVtYWlsLT5waHJhc2UoKSApIHsKICAgICAgICAgICAgICAgICRQaHJhc2UgPSAkRW1haWwtPnBocmFzZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBteSAkQ3VzdG9tZXJLZXkgPSAnJzsKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgZGVmaW5lZCAkQ3VzdG9tZXJEYXRhRnJvbXtVc2VyRW1haWx9CiAgICAgICAgICAgICAgICAmJiAkQ3VzdG9tZXJEYXRhRnJvbXtVc2VyRW1haWx9IGVxICRFbWFpbEFkZHJlc3MKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJEN1c3RvbWVyS2V5ID0gJEFydGljbGV7Q3VzdG9tZXJVc2VySUR9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2lmICgkRW1haWxBZGRyZXNzKSB7CiAgICAgICAgICAgICAgICBteSAlTGlzdCA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyU2VhcmNoKAogICAgICAgICAgICAgICAgICAgIFBvc3RNYXN0ZXJTZWFyY2ggPT4gJEVtYWlsQWRkcmVzcywKICAgICAgICAgICAgICAgICAgICBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICBmb3IgbXkgJFVzZXJMb2dpbiAoIHNvcnQga2V5cyAlTGlzdCApIHsKCiAgICAgICAgICAgICAgICAgICAgIyBTZXQgcmlnaHQgb25lIGlmIHRoZXJlIGlzIG1vcmUgdGhhbiBvbmUgY3VzdG9tZXIgdXNlciB3aXRoIHRoZSBzYW1lIGVtYWlsIGFkZHJlc3MuCiAgICAgICAgICAgICAgICAgICAgaWYgKCAkUGhyYXNlICYmICRMaXN0eyRVc2VyTG9naW59ID1+IC8kUGhyYXNlLyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJEN1c3RvbWVyS2V5ID0gJFVzZXJMb2dpbjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG15ICRDdXN0b21lckVsZW1lbnQgPSAkRW1haWxBZGRyZXNzOwogICAgICAgICAgICBpZiAoJFBocmFzZSkgewogICAgICAgICAgICAgICAgJEN1c3RvbWVyRWxlbWVudCA9ICRQaHJhc2UgLiAiIDwkRW1haWxBZGRyZXNzPiI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICggJEN1c3RvbWVyU2VsZWN0ZWQgJiYgJEN1c3RvbWVyS2V5ICkgewogICAgICAgICAgICAgICAgJUN1c3RvbWVyRGF0YSA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyVXNlckRhdGFHZXQoCiAgICAgICAgICAgICAgICAgICAgVXNlciA9PiAkQ3VzdG9tZXJLZXksCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdXNoIEBNdWx0aXBsZUN1c3RvbWVyLCB7CiAgICAgICAgICAgICAgICBDb3VudCAgICAgICAgICAgID0+ICRDb3VudEF1eCwKICAgICAgICAgICAgICAgIEN1c3RvbWVyRWxlbWVudCAgPT4gJEN1c3RvbWVyRWxlbWVudCwKICAgICAgICAgICAgICAgIEN1c3RvbWVyU2VsZWN0ZWQgPT4gJEN1c3RvbWVyU2VsZWN0ZWQsCiAgICAgICAgICAgICAgICBDdXN0b21lcktleSAgICAgID0+ICRDdXN0b21lcktleSwKICAgICAgICAgICAgICAgIEN1c3RvbWVyRXJyb3IgICAgPT4gJEN1c3RvbWVyRXJyb3IsCiAgICAgICAgICAgICAgICBDdXN0b21lckVycm9yTXNnID0+ICRDdXN0b21lckVycm9yTXNnLAogICAgICAgICAgICAgICAgQ3VzdG9tZXJEaXNhYmxlZCA9PiAkQ3VzdG9tZXJEaXNhYmxlZCwKICAgICAgICAgICAgfTsKICAgICAgICAgICAgJEFkZHJlc3Nlc0xpc3R7JEVtYWlsQWRkcmVzc30gPSAxOwogICAgICAgICAgICAkQ291bnRGcm9tKys7CiAgICAgICAgfQoKICAgICAgICAjIGdldCB1c2VyIHByZWZlcmVuY2VzCiAgICAgICAgbXkgJVVzZXJQcmVmZXJlbmNlcyA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpVc2VyJyktPkdldFVzZXJEYXRhKAogICAgICAgICAgICBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICk7CgogICAgICAgICMgc3RvcmUgdGhlIGR5bmFtaWMgZmllbGRzIGRlZmF1bHQgdmFsdWVzIG9yIHVzZWQgc3BlY2lmaWMgZGVmYXVsdCB2YWx1ZXMgdG8gYmUgdXNlZCBhcwogICAgICAgICMgQUNMcyBpbmZvIGZvciBhbGwgZmllbGRzCiAgICAgICAgbXkgJUR5bmFtaWNGaWVsZERlZmF1bHRzOwoKICAgICAgICAjIGN5Y2xlIHRocm91Z2ggdGhlIGFjdGl2YXRlZCBEeW5hbWljIEZpZWxkcyBmb3IgdGhpcyBzY3JlZW4KICAgICAgICBEWU5BTUlDRklFTEQ6CiAgICAgICAgZm9yIG15ICREeW5hbWljRmllbGRDb25maWcgKCBAeyAkU2VsZi0+e0R5bmFtaWNGaWVsZH0gfSApIHsKICAgICAgICAgICAgbmV4dCBEWU5BTUlDRklFTEQgaWYgIUlzSGFzaFJlZldpdGhEYXRhKCREeW5hbWljRmllbGRDb25maWcpOwogICAgICAgICAgICBuZXh0IERZTkFNSUNGSUVMRCBpZiAhSXNIYXNoUmVmV2l0aERhdGEoICREeW5hbWljRmllbGRDb25maWctPntDb25maWd9ICk7CiAgICAgICAgICAgIG5leHQgRFlOQU1JQ0ZJRUxEIGlmICEkRHluYW1pY0ZpZWxkQ29uZmlnLT57TmFtZX07CgogICAgICAgICAgICAjIGdldCBkZWZhdWx0IHZhbHVlIGZyb20gZHluYW1pYyBmaWVsZCBjb25maWcgKGlmIGFueSkKICAgICAgICAgICAgbXkgJERlZmF1bHRWYWx1ZSA9ICREeW5hbWljRmllbGRDb25maWctPntDb25maWd9LT57RGVmYXVsdFZhbHVlfSB8fCAnJzsKCiAgICAgICAgICAgICMgb3ZlcnJpZGUgdGhlIHZhbHVlIGZyb20gdXNlciBwcmVmZXJlbmNlcyBpZiBpcyBzZXQKICAgICAgICAgICAgaWYgKCAkVXNlclByZWZlcmVuY2VzeyAnVXNlckR5bmFtaWNGaWVsZF8nIC4gJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9IH0gKSB7CiAgICAgICAgICAgICAgICAkRGVmYXVsdFZhbHVlID0gJFVzZXJQcmVmZXJlbmNlc3sgJ1VzZXJEeW5hbWljRmllbGRfJyAuICREeW5hbWljRmllbGRDb25maWctPntOYW1lfSB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBuZXh0IERZTkFNSUNGSUVMRCBpZiAkRGVmYXVsdFZhbHVlIGVxICcnOwogICAgICAgICAgICBuZXh0IERZTkFNSUNGSUVMRAogICAgICAgICAgICAgICAgaWYgcmVmICREZWZhdWx0VmFsdWUgZXEgJ0FSUkFZJyAmJiAhSXNBcnJheVJlZldpdGhEYXRhKCREZWZhdWx0VmFsdWUpOwoKICAgICAgICAgICAgJER5bmFtaWNGaWVsZERlZmF1bHRzeyAnRHluYW1pY0ZpZWxkXycgLiAkRHluYW1pY0ZpZWxkQ29uZmlnLT57TmFtZX0gfSA9ICREZWZhdWx0VmFsdWU7CiAgICAgICAgfQogICAgICAgICRHZXRQYXJhbXtEeW5hbWljRmllbGR9ID0gXCVEeW5hbWljRmllbGREZWZhdWx0czsKCiAgICAgICAgIyBnZXQgc3BsaXQgYXJ0aWNsZSBpZiBnaXZlbgogICAgICAgICMgY3JlYXRlIGh0bWwgc3RyaW5ncyBmb3IgYWxsIGR5bmFtaWMgZmllbGRzCiAgICAgICAgbXkgJUR5bmFtaWNGaWVsZEhUTUw7CgogICAgICAgIG15ICVTcGxpdFRpY2tldFBhcmFtOwoKICAgICAgICAjIGluIGNhc2Ugb2Ygc3BsaXQgYSBUaWNrZXRJRCBhbmQgQXJ0aWNsZUlEIGFyZSBhbHdheXMgZ2l2ZW4sIHNlbmQgdGhlIFRpY2tldElEIHRvIGNhbGN1bGF0ZQogICAgICAgICMgQUNMcyBiYXNlZCBvbiBwYXJlbnQgaW5mb3JtYXRpb24KICAgICAgICBpZiAoICRTZWxmLT57VGlja2V0SUR9ICYmICRBcnRpY2xle0FydGljbGVJRH0gKSB7CiAgICAgICAgICAgICRTcGxpdFRpY2tldFBhcmFte1RpY2tldElEfSA9ICRTZWxmLT57VGlja2V0SUR9OwogICAgICAgIH0KCiAgICAgICAgIyBmaXggdG8gYnVnIyA4MDY4IEZpZWxkICYgRHluYW1pY0ZpZWxkIHByZXNlbGVjdGlvbiBvbiBUaWNrZXRTcGxpdAogICAgICAgICMgd2hlbiBzcGxpdHRpbmcgYSB0aWNrZXQgdGhlIHNlbGVjdGVkIGF0dHJpYnV0ZXMgbXVzdCByZW1haW4gaW4gdGhlIG5ldyB0aWNrZXQgc2NyZWVuCiAgICAgICAgIyB0aGlzIGluZm9ybWF0aW9uIHdpbGwgYmUgYXZhaWxhYmxlIGluIHRoZSBTcGxpdFRpY2tldFBhcmFtIGhhc2gKICAgICAgICBpZiAoICRTcGxpdFRpY2tldFBhcmFte1RpY2tldElEfSApIHsKCiAgICAgICAgICAgICMgZ2V0IGluZm9ybWF0aW9uIGZyb20gb3JpZ2luYWwgdGlja2V0IChTcGxpdFRpY2tldCkKICAgICAgICAgICAgbXkgJVNwbGl0VGlja2V0RGF0YSA9ICRUaWNrZXRPYmplY3QtPlRpY2tldEdldCgKICAgICAgICAgICAgICAgIFRpY2tldElEICAgICAgPT4gJFNwbGl0VGlja2V0UGFyYW17VGlja2V0SUR9LAogICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkcyA9PiAxLAogICAgICAgICAgICAgICAgVXNlcklEICAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAjIHNldCBzaW1wbGUgSURzIHRvIHBhc3MgdGhlbSB0byB0aGUgbWFzawogICAgICAgICAgICBmb3IgbXkgJFNwbGl0ZWRQYXJhbSAocXcoVHlwZUlEIFNlcnZpY2VJRCBTTEFJRCBQcmlvcml0eUlEKSkgewogICAgICAgICAgICAgICAgJFNwbGl0VGlja2V0UGFyYW17JFNwbGl0ZWRQYXJhbX0gPSAkU3BsaXRUaWNrZXREYXRheyRTcGxpdGVkUGFyYW19OwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIHNldCBTdGF0ZUlEIGFzIE5leHRTdGF0ZUlECiAgICAgICAgICAgICRTcGxpdFRpY2tldFBhcmFte05leHRTdGF0ZUlEfSA9ICRTcGxpdFRpY2tldERhdGF7U3RhdGVJRH07CgogICAgICAgICAgICAjIHNldCBPd25lciBhbmQgUmVzcG9uc2libGUKICAgICAgICAgICAgJFNwbGl0VGlja2V0UGFyYW17VXNlclNlbGVjdGVkfSAgICAgICAgICAgID0gJFNwbGl0VGlja2V0RGF0YXtPd25lcklEfTsKICAgICAgICAgICAgJFNwbGl0VGlja2V0UGFyYW17UmVzcG9uc2libGVVc2VyU2VsZWN0ZWR9ID0gJFNwbGl0VGlja2V0RGF0YXtSZXNwb25zaWJsZUlEfTsKCiAgICAgICAgICAgICMgc2V0IGFkZGl0aW9uYWwgaW5mb3JtYXRpb24gbmVlZGVkIGZvciBPd25lciBhbmQgUmVzcG9uc2libGUKICAgICAgICAgICAgaWYgKCAkU3BsaXRUaWNrZXREYXRhe1F1ZXVlSUR9ICkgewogICAgICAgICAgICAgICAgJFNwbGl0VGlja2V0UGFyYW17UXVldWVJRH0gPSAkU3BsaXRUaWNrZXREYXRhe1F1ZXVlSUR9OwogICAgICAgICAgICB9CiAgICAgICAgICAgICRTcGxpdFRpY2tldFBhcmFte0FsbFVzZXJzfSA9IDE7CgogICAgICAgICAgICAjIHNldCB0aGUgc2VsZWN0ZWQgcXVldWUgaW4gZm9ybWF0IElEfHxOYW1lCiAgICAgICAgICAgICRTcGxpdFRpY2tldFBhcmFte0Zyb21TZWxlY3RlZH0gPSAkU3BsaXRUaWNrZXREYXRhe1F1ZXVlSUR9IC4gJ3x8JyAuICRTcGxpdFRpY2tldERhdGF7UXVldWV9OwoKICAgICAgICAgICAgZm9yIG15ICRLZXkgKCBzb3J0IGtleXMgJVNwbGl0VGlja2V0RGF0YSApIHsKICAgICAgICAgICAgICAgIGlmICggJEtleSA9fiAvRHluYW1pY0ZpZWxkXF8oLiopLyApIHsKICAgICAgICAgICAgICAgICAgICAkU3BsaXRUaWNrZXRQYXJhbXtEeW5hbWljRmllbGR9eyQxfSA9ICRTcGxpdFRpY2tldERhdGF7JEtleX07CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlICRTcGxpdFRpY2tldFBhcmFteyRLZXl9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIGN5Y2xlIHRocm91Z2ggdGhlIGFjdGl2YXRlZCBEeW5hbWljIEZpZWxkcyBmb3IgdGhpcyBzY3JlZW4KICAgICAgICBEWU5BTUlDRklFTEQ6CiAgICAgICAgZm9yIG15ICREeW5hbWljRmllbGRDb25maWcgKCBAeyAkU2VsZi0+e0R5bmFtaWNGaWVsZH0gfSApIHsKICAgICAgICAgICAgbmV4dCBEWU5BTUlDRklFTEQgaWYgIUlzSGFzaFJlZldpdGhEYXRhKCREeW5hbWljRmllbGRDb25maWcpOwoKICAgICAgICAgICAgbXkgJFBvc3NpYmxlVmFsdWVzRmlsdGVyOwoKICAgICAgICAgICAgbXkgJElzQUNMUmVkdWNpYmxlID0gJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QtPkhhc0JlaGF2aW9yKAogICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRDb25maWcsCiAgICAgICAgICAgICAgICBCZWhhdmlvciAgICAgICAgICAgPT4gJ0lzQUNMUmVkdWNpYmxlJywKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGlmICgkSXNBQ0xSZWR1Y2libGUpIHsKCiAgICAgICAgICAgICAgICAjIGdldCBQb3NzaWJsZVZhbHVlcwogICAgICAgICAgICAgICAgbXkgJFBvc3NpYmxlVmFsdWVzID0gJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QtPlBvc3NpYmxlVmFsdWVzR2V0KAogICAgICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZENvbmZpZyA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnLAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAjIGNoZWNrIGlmIGZpZWxkIGhhcyBQb3NzaWJsZVZhbHVlcyBwcm9wZXJ0eSBpbiBpdHMgY29uZmlndXJhdGlvbgogICAgICAgICAgICAgICAgaWYgKCBJc0hhc2hSZWZXaXRoRGF0YSgkUG9zc2libGVWYWx1ZXMpICkgewoKICAgICAgICAgICAgICAgICAgICAjIGNvbnZlcnQgcG9zc2libGUgdmFsdWVzIGtleSA9PiB2YWx1ZSB0byBrZXkgPT4ga2V5IGZvciBBQ0xzIHVzaW5nIGEgSGFzaCBzbGljZQogICAgICAgICAgICAgICAgICAgIG15ICVBY2xEYXRhID0gJXskUG9zc2libGVWYWx1ZXN9OwogICAgICAgICAgICAgICAgICAgIEBBY2xEYXRheyBrZXlzICVBY2xEYXRhIH0gPSBrZXlzICVBY2xEYXRhOwoKICAgICAgICAgICAgICAgICAgICAjIHNldCBwb3NzaWJsZSB2YWx1ZXMgZmlsdGVyIGZyb20gQUNMcwogICAgICAgICAgICAgICAgICAgIG15ICRBQ0wgPSAkVGlja2V0T2JqZWN0LT5UaWNrZXRBY2woCiAgICAgICAgICAgICAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgICAgICAgICAgICAgJUFDTENvbXBhdEdldFBhcmFtLAogICAgICAgICAgICAgICAgICAgICAgICAlU3BsaXRUaWNrZXRQYXJhbSwKICAgICAgICAgICAgICAgICAgICAgICAgQWN0aW9uICAgICAgICA9PiAkU2VsZi0+e0FjdGlvbn0sCiAgICAgICAgICAgICAgICAgICAgICAgIFJldHVyblR5cGUgICAgPT4gJ1RpY2tldCcsCiAgICAgICAgICAgICAgICAgICAgICAgIFJldHVyblN1YlR5cGUgPT4gJ0R5bmFtaWNGaWVsZF8nIC4gJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9LAogICAgICAgICAgICAgICAgICAgICAgICBEYXRhICAgICAgICAgID0+IFwlQWNsRGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgVXNlcklEICAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICBpZiAoJEFDTCkgewogICAgICAgICAgICAgICAgICAgICAgICBteSAlRmlsdGVyID0gJFRpY2tldE9iamVjdC0+VGlja2V0QWNsRGF0YSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgIyBjb252ZXJ0IEZpbGVyIGtleSA9PiBrZXkgYmFjayB0byBrZXkgPT4gdmFsdWUgdXNpbmcgbWFwCiAgICAgICAgICAgICAgICAgICAgICAgICV7JFBvc3NpYmxlVmFsdWVzRmlsdGVyfSA9IG1hcCB7ICRfID0+ICRQb3NzaWJsZVZhbHVlcy0+eyRffSB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXlzICVGaWx0ZXI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIHRvIHN0b3JlIGR5bmFtaWMgZmllbGQgdmFsdWUgZnJvbSBkYXRhYmFzZSAob3IgdW5kZWZpbmVkKQogICAgICAgICAgICBteSAkVmFsdWU7CgogICAgICAgICAgICAjIGluIGNhc2Ugb2Ygc3BsaXQgYSBUaWNrZXRJRCBhbmQgQXJ0aWNsZUlEIGFyZSBhbHdheXMgZ2l2ZW4sIEdldCB0aGUgdmFsdWUKICAgICAgICAgICAgIyBmcm9tIERCIHRoaXMgY2FzZXMKICAgICAgICAgICAgaWYgKCAkU2VsZi0+e1RpY2tldElEfSAmJiAkQXJ0aWNsZXtBcnRpY2xlSUR9ICkgewoKICAgICAgICAgICAgICAgICMgc2VsZWN0IFRpY2tldElEIG9yIEFydGljbGVJRCB0byBnZXQgdGhlIHZhbHVlIGRlcGVuZGluZyBvbiBkeW5hbWljIGZpZWxkIGNvbmZpZ3VyYXRpb24KICAgICAgICAgICAgICAgIG15ICRPYmplY3RJRCA9ICREeW5hbWljRmllbGRDb25maWctPntPYmplY3RUeXBlfSBlcSAnVGlja2V0JwogICAgICAgICAgICAgICAgICAgID8gJFNlbGYtPntUaWNrZXRJRH0KICAgICAgICAgICAgICAgICAgICA6ICRBcnRpY2xle0FydGljbGVJRH07CgogICAgICAgICAgICAgICAgIyBnZXQgdmFsdWUgc3RvcmVkIG9uIHRoZSBkYXRhYmFzZSAoc3BsaXQpCiAgICAgICAgICAgICAgICAkVmFsdWUgPSAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdC0+VmFsdWVHZXQoCiAgICAgICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRDb25maWcsCiAgICAgICAgICAgICAgICAgICAgT2JqZWN0SUQgICAgICAgICAgID0+ICRPYmplY3RJRCwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgb3RoZXJ3aXNlIChvbiBhIG5ldyB0aWNrZXQpLiBDaGVjayBpZiB0aGUgdXNlciBoYXMgYSB1c2VyIHNwZWNpZmljIGRlZmF1bHQgdmFsdWUgZm9yCiAgICAgICAgICAgICMgdGhlIGR5bmFtaWMgZmllbGQsIG90aGVyd2lzZSB3aWxsIHVzZSBEeW5hbWljIEZpZWxkIGRlZmF1bHQgdmFsdWUKICAgICAgICAgICAgZWxzZSB7CgogICAgICAgICAgICAgICAgIyBvdmVycmlkZSB0aGUgdmFsdWUgZnJvbSB1c2VyIHByZWZlcmVuY2VzIGlmIGlzIHNldAogICAgICAgICAgICAgICAgaWYgKCAkVXNlclByZWZlcmVuY2VzeyAnVXNlckR5bmFtaWNGaWVsZF8nIC4gJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9IH0gKSB7CiAgICAgICAgICAgICAgICAgICAgJFZhbHVlID0gJFVzZXJQcmVmZXJlbmNlc3sgJ1VzZXJEeW5hbWljRmllbGRfJyAuICREeW5hbWljRmllbGRDb25maWctPntOYW1lfSB9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGdldCBmaWVsZCBodG1sCiAgICAgICAgICAgICREeW5hbWljRmllbGRIVE1MeyAkRHluYW1pY0ZpZWxkQ29uZmlnLT57TmFtZX0gfSA9CiAgICAgICAgICAgICAgICAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdC0+RWRpdEZpZWxkUmVuZGVyKAogICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnICAgPT4gJER5bmFtaWNGaWVsZENvbmZpZywKICAgICAgICAgICAgICAgIFBvc3NpYmxlVmFsdWVzRmlsdGVyID0+ICRQb3NzaWJsZVZhbHVlc0ZpbHRlciwKICAgICAgICAgICAgICAgIFZhbHVlICAgICAgICAgICAgICAgID0+ICRWYWx1ZSwKICAgICAgICAgICAgICAgIE1hbmRhdG9yeSA9PgogICAgICAgICAgICAgICAgICAgICRDb25maWctPntEeW5hbWljRmllbGR9LT57ICREeW5hbWljRmllbGRDb25maWctPntOYW1lfSB9ID09IDIsCiAgICAgICAgICAgICAgICBMYXlvdXRPYmplY3QgICAgPT4gJExheW91dE9iamVjdCwKICAgICAgICAgICAgICAgIFBhcmFtT2JqZWN0ICAgICA9PiAkUGFyYW1PYmplY3QsCiAgICAgICAgICAgICAgICBBSkFYVXBkYXRlICAgICAgPT4gMSwKICAgICAgICAgICAgICAgIFVwZGF0YWJsZUZpZWxkcyA9PiAkU2VsZi0+X0dldEZpZWxkc1RvVXBkYXRlKCksCiAgICAgICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBydW4gY29tcG9zZSBtb2R1bGVzCiAgICAgICAgaWYgKAogICAgICAgICAgICByZWYgJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpBcnRpY2xlQ29tcG9zZU1vZHVsZScpIGVxCiAgICAgICAgICAgICdIQVNIJwogICAgICAgICAgICApCiAgICAgICAgewoKICAgICAgICAgICAgIyBHZXQgUXVldWUgc2V0dGluZ3MgaWYgJ0Rlc3QnIHBhcmFtIHdhcyBzZXQgaW4gdGhlIFVSTC4KICAgICAgICAgICAgbXkgJUdldFBhcmFtOwogICAgICAgICAgICAkR2V0UGFyYW17RGVzdH0gPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnRGVzdCcgKTsKCiAgICAgICAgICAgIGlmICggJEdldFBhcmFte0Rlc3R9ICYmICRHZXRQYXJhbXtEZXN0fSA9fiAvXihcZHsxLDEwMH0pXHxcfC4rPyQvICkgewogICAgICAgICAgICAgICAgJEdldFBhcmFte1F1ZXVlSUR9ID0gJDE7CiAgICAgICAgICAgICAgICBteSAlUXVldWUgPSAkUXVldWVPYmplY3QtPkdldFN5c3RlbUFkZHJlc3MoIFF1ZXVlSUQgPT4gJEdldFBhcmFte1F1ZXVlSUR9ICk7CiAgICAgICAgICAgICAgICAkR2V0UGFyYW17RnJvbX0gPSAkUXVldWV7RW1haWx9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBteSAlSm9icyA9ICV7ICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpGcm9udGVuZDo6QXJ0aWNsZUNvbXBvc2VNb2R1bGUnKSB9OwogICAgICAgICAgICBmb3IgbXkgJEpvYiAoIHNvcnQga2V5cyAlSm9icyApIHsKCiAgICAgICAgICAgICAgICAjIGxvYWQgbW9kdWxlCiAgICAgICAgICAgICAgICBpZiAoICEkTWFpbk9iamVjdC0+UmVxdWlyZSggJEpvYnN7JEpvYn0tPntNb2R1bGV9ICkgKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkZhdGFsRXJyb3IoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBteSAkT2JqZWN0ID0gJEpvYnN7JEpvYn0tPntNb2R1bGV9LT5uZXcoCiAgICAgICAgICAgICAgICAgICAgJXskU2VsZn0sCiAgICAgICAgICAgICAgICAgICAgRGVidWcgPT4gJERlYnVnLAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAjIGdldCBwYXJhbXMKICAgICAgICAgICAgICAgIFBBUkFNRVRFUjoKICAgICAgICAgICAgICAgIGZvciBteSAkUGFyYW1ldGVyICggJE9iamVjdC0+T3B0aW9uKCAlR2V0UGFyYW0sIENvbmZpZyA9PiAkSm9ic3skSm9ifSApICkgewogICAgICAgICAgICAgICAgICAgIGlmICggJEpvYnN7JEpvYn0tPntQYXJhbVR5cGV9ICYmICRKb2JzeyRKb2J9LT57UGFyYW1UeXBlfSBuZSAnU2luZ2xlJyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgQHsgJEdldFBhcmFteyRQYXJhbWV0ZXJ9IH0gPSAkUGFyYW1PYmplY3QtPkdldEFycmF5KCBQYXJhbSA9PiAkUGFyYW1ldGVyICk7CiAgICAgICAgICAgICAgICAgICAgICAgIG5leHQgUEFSQU1FVEVSOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJEdldFBhcmFteyRQYXJhbWV0ZXJ9ID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJFBhcmFtZXRlciApOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgcnVuIG1vZHVsZQogICAgICAgICAgICAgICAgbXkgJE5ld1BhcmFtcyA9ICRPYmplY3QtPlJ1biggJUdldFBhcmFtLCBDb25maWcgPT4gJEpvYnN7JEpvYn0gKTsKCiAgICAgICAgICAgICAgICBpZiAoJE5ld1BhcmFtcykgewogICAgICAgICAgICAgICAgICAgIGZvciBteSAkUGFyYW1ldGVyICggJE9iamVjdC0+T3B0aW9uKCAlR2V0UGFyYW0sIENvbmZpZyA9PiAkSm9ic3skSm9ifSApICkgewogICAgICAgICAgICAgICAgICAgICAgICAkR2V0UGFyYW17JFBhcmFtZXRlcn0gPSAkTmV3UGFyYW1zOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBnZXQgYWxsIGF0dGFjaG1lbnRzIG1ldGEgZGF0YQogICAgICAgIG15IEBBdHRhY2htZW50cyA9ICRVcGxvYWRDYWNoZU9iamVjdC0+Rm9ybUlER2V0QWxsRmlsZXNNZXRhKAogICAgICAgICAgICBGb3JtSUQgPT4gJFNlbGYtPntGb3JtSUR9LAogICAgICAgICk7CgogICAgICAgICMgZ2V0IGFuZCBmb3JtYXQgZGVmYXVsdCBzdWJqZWN0IGFuZCBib2R5CiAgICAgICAgbXkgJFN1YmplY3QgPSAkQXJ0aWNsZXtTdWJqZWN0fTsKICAgICAgICBpZiAoICEkU3ViamVjdCApIHsKICAgICAgICAgICAgJFN1YmplY3QgPSAkTGF5b3V0T2JqZWN0LT5PdXRwdXQoCiAgICAgICAgICAgICAgICBUZW1wbGF0ZSA9PiAkQ29uZmlnLT57U3ViamVjdH0gfHwgJycsCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIG15ICRCb2R5ID0gJEFydGljbGV7Qm9keX0gfHwgJyc7CiAgICAgICAgaWYgKCAhJEJvZHkgKSB7CiAgICAgICAgICAgICRCb2R5ID0gJExheW91dE9iamVjdC0+T3V0cHV0KAogICAgICAgICAgICAgICAgVGVtcGxhdGUgPT4gJENvbmZpZy0+e0JvZHl9IHx8ICcnLAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBtYWtlIHN1cmUgYm9keSBpcyByaWNoIHRleHQgKGlmIGJvZHkgaXMgYmFzZWQgb24gY29uZmlnKQogICAgICAgIGlmICggISRHZXRQYXJhbXtBcnRpY2xlSUR9ICYmICRMYXlvdXRPYmplY3QtPntCcm93c2VyUmljaFRleHR9ICkgewogICAgICAgICAgICAkQm9keSA9ICRMYXlvdXRPYmplY3QtPkFzY2lpMlJpY2hUZXh0KAogICAgICAgICAgICAgICAgU3RyaW5nID0+ICRCb2R5LAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBpbiBjYXNlIG9mIHRpY2tldCBzcGxpdCBzZXQgJFNlbGYtPntRdWV1ZUlEfSBhcyB0aGUgUXVldWVJRCBvZiB0aGUgb3JpZ2luYWwgdGlja2V0LAogICAgICAgICMgaW4gb3JkZXIgdG8gc2V0IGNvcnJlY3QgQUNMcyBvbiBwYWdlIGxvYWQgKGluaXRpYWwpLiBTZWUgYnVnIDg2ODcuCiAgICAgICAgaWYgKAogICAgICAgICAgICBJc0hhc2hSZWZXaXRoRGF0YSggXCVTcGxpdFRpY2tldFBhcmFtICkKICAgICAgICAgICAgJiYgJFNwbGl0VGlja2V0UGFyYW17UXVldWVJRH0KICAgICAgICAgICAgJiYgISRTZWxmLT57UXVldWVJRH0KICAgICAgICAgICAgKQogICAgICAgIHsKICAgICAgICAgICAgJFNlbGYtPntRdWV1ZUlEfSA9ICRTcGxpdFRpY2tldFBhcmFte1F1ZXVlSUR9OwogICAgICAgIH0KCiAgICAgICAgbXkgJERlc3QgPSAnJzsKICAgICAgICBpZiAoICEkU2VsZi0+e1F1ZXVlSUR9ICYmICRHZXRQYXJhbXtEZXN0fSApIHsKCiAgICAgICAgICAgIG15IEBRdWV1ZVBhcnRzID0gc3BsaXQoIC9cfFx8LywgJEdldFBhcmFte0Rlc3R9ICk7CiAgICAgICAgICAgICRTZWxmLT57UXVldWVJRH0gPSAkUXVldWVQYXJ0c1swXTsKICAgICAgICAgICAgJERlc3QgPSAkR2V0UGFyYW17RGVzdH07CiAgICAgICAgfQoKICAgICAgICAjIGh0bWwgb3V0cHV0CiAgICAgICAgbXkgJFNlcnZpY2VzID0gJFNlbGYtPl9HZXRTZXJ2aWNlcygKICAgICAgICAgICAgJUdldFBhcmFtLAogICAgICAgICAgICAlQUNMQ29tcGF0R2V0UGFyYW0sCiAgICAgICAgICAgICVTcGxpdFRpY2tldFBhcmFtLAogICAgICAgICAgICBDdXN0b21lclVzZXJJRCA9PiAkQ3VzdG9tZXJEYXRhe1VzZXJMb2dpbn0gfHwgJycsCiAgICAgICAgICAgIFF1ZXVlSUQgICAgICAgID0+ICRTZWxmLT57UXVldWVJRH0gICAgICAgICB8fCAxLAogICAgICAgICk7CiAgICAgICAgbXkgJFNMQXMgPSAkU2VsZi0+X0dldFNMQXMoCiAgICAgICAgICAgIFF1ZXVlSUQgID0+ICRTZWxmLT57UXVldWVJRH0gfHwgMSwKICAgICAgICAgICAgU2VydmljZXMgPT4gJFNlcnZpY2VzLAogICAgICAgICAgICAlR2V0UGFyYW0sCiAgICAgICAgICAgICVBQ0xDb21wYXRHZXRQYXJhbSwKICAgICAgICAgICAgJVNwbGl0VGlja2V0UGFyYW0sCiAgICAgICAgKTsKICAgICAgICAkT3V0cHV0IC49ICRTZWxmLT5fTWFza0VtYWlsTmV3KAogICAgICAgICAgICBRdWV1ZUlEICAgID0+ICRTZWxmLT57UXVldWVJRH0sCiAgICAgICAgICAgIE5leHRTdGF0ZXMgPT4gJFNlbGYtPl9HZXROZXh0U3RhdGVzKAogICAgICAgICAgICAgICAgJUdldFBhcmFtLAogICAgICAgICAgICAgICAgJUFDTENvbXBhdEdldFBhcmFtLAogICAgICAgICAgICAgICAgJVNwbGl0VGlja2V0UGFyYW0sCiAgICAgICAgICAgICAgICBDdXN0b21lclVzZXJJRCA9PiAkQ3VzdG9tZXJEYXRhe1VzZXJMb2dpbn0gfHwgJycsCiAgICAgICAgICAgICAgICBRdWV1ZUlEICAgICAgICA9PiAkU2VsZi0+e1F1ZXVlSUR9ICAgICAgICAgfHwgMQogICAgICAgICAgICApLAogICAgICAgICAgICBQcmlvcml0aWVzID0+ICRTZWxmLT5fR2V0UHJpb3JpdGllcygKICAgICAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgICAgICVBQ0xDb21wYXRHZXRQYXJhbSwKICAgICAgICAgICAgICAgICVTcGxpdFRpY2tldFBhcmFtLAogICAgICAgICAgICAgICAgQ3VzdG9tZXJVc2VySUQgPT4gJEN1c3RvbWVyRGF0YXtVc2VyTG9naW59IHx8ICcnLAogICAgICAgICAgICAgICAgUXVldWVJRCAgICAgICAgPT4gJFNlbGYtPntRdWV1ZUlEfSAgICAgICAgIHx8IDEKICAgICAgICAgICAgKSwKICAgICAgICAgICAgVHlwZXMgPT4gJFNlbGYtPl9HZXRUeXBlcygKICAgICAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgICAgICVBQ0xDb21wYXRHZXRQYXJhbSwKICAgICAgICAgICAgICAgICVTcGxpdFRpY2tldFBhcmFtLAogICAgICAgICAgICAgICAgQ3VzdG9tZXJVc2VySUQgPT4gJEN1c3RvbWVyRGF0YXtVc2VyTG9naW59IHx8ICcnLAogICAgICAgICAgICAgICAgUXVldWVJRCAgICAgICAgPT4gJFNlbGYtPntRdWV1ZUlEfSAgICAgICAgIHx8IDEKICAgICAgICAgICAgKSwKICAgICAgICAgICAgU2VydmljZXMgICAgICAgICAgPT4gJFNlcnZpY2VzLAogICAgICAgICAgICBTTEFzICAgICAgICAgICAgICA9PiAkU0xBcywKICAgICAgICAgICAgU3RhbmRhcmRUZW1wbGF0ZXMgPT4gJFNlbGYtPl9HZXRTdGFuZGFyZFRlbXBsYXRlcygKICAgICAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgICAgICVBQ0xDb21wYXRHZXRQYXJhbSwKICAgICAgICAgICAgICAgICVTcGxpdFRpY2tldFBhcmFtLAogICAgICAgICAgICAgICAgUXVldWVJRCA9PiAkU2VsZi0+e1F1ZXVlSUR9IHx8ICcnLAogICAgICAgICAgICApLAogICAgICAgICAgICBVc2VycyA9PiAkU2VsZi0+X0dldFVzZXJzKAogICAgICAgICAgICAgICAgJUdldFBhcmFtLAogICAgICAgICAgICAgICAgJUFDTENvbXBhdEdldFBhcmFtLAogICAgICAgICAgICAgICAgUXVldWVJRCA9PiAkU2VsZi0+e1F1ZXVlSUR9LAogICAgICAgICAgICAgICAgJVNwbGl0VGlja2V0UGFyYW0sCiAgICAgICAgICAgICksCiAgICAgICAgICAgIFJlc3BvbnNpYmxlVXNlcnMgPT4gJFNlbGYtPl9HZXRSZXNwb25zaWJsZXMoCiAgICAgICAgICAgICAgICAlR2V0UGFyYW0sCiAgICAgICAgICAgICAgICAlQUNMQ29tcGF0R2V0UGFyYW0sCiAgICAgICAgICAgICAgICBRdWV1ZUlEID0+ICRTZWxmLT57UXVldWVJRH0sCiAgICAgICAgICAgICAgICAlU3BsaXRUaWNrZXRQYXJhbSwKICAgICAgICAgICAgKSwKICAgICAgICAgICAgRnJvbUxpc3QgPT4gJFNlbGYtPl9HZXRUb3MoCiAgICAgICAgICAgICAgICAlR2V0UGFyYW0sCiAgICAgICAgICAgICAgICAlQUNMQ29tcGF0R2V0UGFyYW0sCiAgICAgICAgICAgICAgICAlU3BsaXRUaWNrZXRQYXJhbSwKICAgICAgICAgICAgICAgIEN1c3RvbWVyVXNlcklEID0+ICRDdXN0b21lckRhdGF7VXNlckxvZ2lufSB8fCAnJywKICAgICAgICAgICAgICAgIFF1ZXVlSUQgICAgICAgID0+ICRTZWxmLT57UXVldWVJRH0KICAgICAgICAgICAgKSwKICAgICAgICAgICAgVGltZVVuaXRzID0+ICRTZWxmLT5fR2V0VGltZVVuaXRzKAogICAgICAgICAgICAgICAgJUdldFBhcmFtLAogICAgICAgICAgICAgICAgJUFDTENvbXBhdEdldFBhcmFtLAogICAgICAgICAgICAgICAgJVNwbGl0VGlja2V0UGFyYW0sCiAgICAgICAgICAgICAgICBBcnRpY2xlSUQgPT4gJEFydGljbGV7QXJ0aWNsZUlEfSwKICAgICAgICAgICAgKSwKICAgICAgICAgICAgRnJvbVNlbGVjdGVkICAgICAgPT4gJERlc3QsCiAgICAgICAgICAgIFRvICAgICAgICAgICAgICAgID0+ICRBcnRpY2xle0Zyb219IC8vICcnLAogICAgICAgICAgICBTdWJqZWN0ICAgICAgICAgICA9PiAkU3ViamVjdCwKICAgICAgICAgICAgQm9keSAgICAgICAgICAgICAgPT4gJEJvZHksCiAgICAgICAgICAgIEN1c3RvbWVySUQgICAgICAgID0+ICRTcGxpdFRpY2tldERhdGF7Q3VzdG9tZXJJRH0sCiAgICAgICAgICAgIEN1c3RvbWVyVXNlciAgICAgID0+ICRTcGxpdFRpY2tldERhdGF7Q3VzdG9tZXJVc2VySUR9LAogICAgICAgICAgICBDdXN0b21lckRhdGEgICAgICA9PiBcJUN1c3RvbWVyRGF0YSwKICAgICAgICAgICAgQXR0YWNobWVudHMgICAgICAgPT4gXEBBdHRhY2htZW50cywKICAgICAgICAgICAgTGlua1RpY2tldElEICAgICAgPT4gJEdldFBhcmFte0xpbmtUaWNrZXRJRH0gfHwgJycsCiAgICAgICAgICAgIFRpbWVVbml0c1JlcXVpcmVkID0+ICgKICAgICAgICAgICAgICAgICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpGcm9udGVuZDo6TmVlZEFjY291bnRlZFRpbWUnKQogICAgICAgICAgICAgICAgPyAnVmFsaWRhdGVfUmVxdWlyZWQnCiAgICAgICAgICAgICAgICA6ICcnCiAgICAgICAgICAgICksCiAgICAgICAgICAgICVTcGxpdFRpY2tldFBhcmFtLAogICAgICAgICAgICBEeW5hbWljRmllbGRIVE1MICAgID0+IFwlRHluYW1pY0ZpZWxkSFRNTCwKICAgICAgICAgICAgTXVsdGlwbGVDdXN0b21lciAgICA9PiBcQE11bHRpcGxlQ3VzdG9tZXIsCiAgICAgICAgICAgIE11bHRpcGxlQ3VzdG9tZXJDYyAgPT4gXEBNdWx0aXBsZUN1c3RvbWVyQ2MsCiAgICAgICAgICAgIE11bHRpcGxlQ3VzdG9tZXJCY2MgPT4gXEBNdWx0aXBsZUN1c3RvbWVyQmNjLAogICAgICAgICk7CgogICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Rm9vdGVyKCk7CiAgICAgICAgcmV0dXJuICRPdXRwdXQ7CiAgICB9CgogICAgIyBkZWxpdmVyIHNpZ25hdHVyZQogICAgZWxzaWYgKCAkU2VsZi0+e1N1YmFjdGlvbn0gZXEgJ1NpZ25hdHVyZScgKSB7CiAgICAgICAgbXkgJEN1c3RvbWVyVXNlciA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdTZWxlY3RlZEN1c3RvbWVyVXNlcicgKSB8fCAnJzsKICAgICAgICBteSAkUXVldWVJRCAgICAgID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ1F1ZXVlSUQnICk7CiAgICAgICAgaWYgKCAhJFF1ZXVlSUQgKSB7CiAgICAgICAgICAgIG15ICREZXN0ID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0Rlc3QnICkgfHwgJyc7CiAgICAgICAgICAgICgkUXVldWVJRCkgPSBzcGxpdCggL1x8XHwvLCAkRGVzdCApOwogICAgICAgIH0KCiAgICAgICAgIyBzdGFydCB3aXRoIGVtcHR5IHNpZ25hdHVyZSAobm8gcXVldWUgc2VsZWN0ZWQpIC0gaWYgd2UgaGF2ZSBhIHF1ZXVlLCBnZXQgdGhlIHNpZy4KICAgICAgICBteSAkU2lnbmF0dXJlID0gJyc7CiAgICAgICAgaWYgKCRRdWV1ZUlEKSB7CiAgICAgICAgICAgICRTaWduYXR1cmUgPSAkU2VsZi0+X0dldFNpZ25hdHVyZSgKICAgICAgICAgICAgICAgIFF1ZXVlSUQgICAgICAgID0+ICRRdWV1ZUlELAogICAgICAgICAgICAgICAgQ3VzdG9tZXJVc2VySUQgPT4gJEN1c3RvbWVyVXNlciwKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgbXkgJE1pbWVUeXBlID0gJ3RleHQvcGxhaW4nOwogICAgICAgIGlmICggJExheW91dE9iamVjdC0+e0Jyb3dzZXJSaWNoVGV4dH0gKSB7CiAgICAgICAgICAgICRNaW1lVHlwZSAgPSAndGV4dC9odG1sJzsKICAgICAgICAgICAgJFNpZ25hdHVyZSA9ICRMYXlvdXRPYmplY3QtPlJpY2hUZXh0RG9jdW1lbnRDb21wbGV0ZSgKICAgICAgICAgICAgICAgIFN0cmluZyA9PiAkU2lnbmF0dXJlLAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkF0dGFjaG1lbnQoCiAgICAgICAgICAgIENvbnRlbnRUeXBlID0+ICRNaW1lVHlwZSAuICc7IGNoYXJzZXQ9JyAuICRMYXlvdXRPYmplY3QtPntDaGFyc2V0fSwKICAgICAgICAgICAgQ29udGVudCAgICAgPT4gJFNpZ25hdHVyZSwKICAgICAgICAgICAgVHlwZSAgICAgICAgPT4gJ2lubGluZScsCiAgICAgICAgICAgIE5vQ2FjaGUgICAgID0+IDEsCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGNyZWF0ZSBuZXcgdGlja2V0IGFuZCBhcnRpY2xlCiAgICBlbHNpZiAoICRTZWxmLT57U3ViYWN0aW9ufSBlcSAnU3RvcmVOZXcnICkgewoKICAgICAgICBteSAlRXJyb3I7CiAgICAgICAgbXkgJE5leHRTdGF0ZUlEID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ05leHRTdGF0ZUlEJyApIHx8ICcnOwogICAgICAgIG15ICVTdGF0ZURhdGE7CiAgICAgICAgaWYgKCROZXh0U3RhdGVJRCkgewogICAgICAgICAgICAlU3RhdGVEYXRhID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlN0YXRlJyktPlN0YXRlR2V0KAogICAgICAgICAgICAgICAgSUQgPT4gJE5leHRTdGF0ZUlELAogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBteSAkTmV4dFN0YXRlICAgICAgICA9ICRTdGF0ZURhdGF7TmFtZX07CiAgICAgICAgbXkgJE5ld1Jlc3BvbnNpYmxlSUQgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnTmV3UmVzcG9uc2libGVJRCcgKSB8fCAnJzsKICAgICAgICBteSAkTmV3VXNlcklEICAgICAgICA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdOZXdVc2VySUQnICkgfHwgJyc7CiAgICAgICAgbXkgJERlc3QgICAgICAgICAgICAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnRGVzdCcgKSB8fCAnJzsKCiAgICAgICAgIyBzZWUgaWYgb25seSBhIG5hbWUgaGFzIGJlZW4gcGFzc2VkCiAgICAgICAgaWYgKCAkRGVzdCAmJiAkRGVzdCAhfiBteyBcQSAoXGQrKT8gXHwgXHwgLisgXHogfXhtcyApIHsKCiAgICAgICAgICAgICMgc2VlIGlmIHdlIGNhbiBnZXQgYW4gSUQgZm9yIHRoaXMgcXVldWUgbmFtZQogICAgICAgICAgICBteSAkRGVzdElEID0gJFF1ZXVlT2JqZWN0LT5RdWV1ZUxvb2t1cCgKICAgICAgICAgICAgICAgIFF1ZXVlID0+ICREZXN0LAogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKCREZXN0SUQpIHsKICAgICAgICAgICAgICAgICREZXN0ID0gJERlc3RJRCAuICd8fCcgLiAkRGVzdDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICREZXN0ID0gJyc7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIG15ICggJE5ld1F1ZXVlSUQsICRGcm9tICkgPSBzcGxpdCggL1x8XHwvLCAkRGVzdCApOwogICAgICAgIGlmICggISROZXdRdWV1ZUlEICkgewogICAgICAgICAgICAkR2V0UGFyYW17T3duZXJBbGx9ID0gMTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIG15ICVRdWV1ZSA9ICRRdWV1ZU9iamVjdC0+R2V0U3lzdGVtQWRkcmVzcyggUXVldWVJRCA9PiAkTmV3UXVldWVJRCApOwogICAgICAgICAgICAkR2V0UGFyYW17RnJvbX0gPSAkUXVldWV7RW1haWx9OwogICAgICAgIH0KCiAgICAgICAgbXkgJEN1c3RvbWVyVXNlciA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdDdXN0b21lclVzZXInICkKICAgICAgICAgICAgfHwgJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ1ByZVNlbGVjdGVkQ3VzdG9tZXJVc2VyJyApCiAgICAgICAgICAgIHx8ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdTZWxlY3RlZEN1c3RvbWVyVXNlcicgKQogICAgICAgICAgICB8fCAnJzsKICAgICAgICBteSAkQ3VzdG9tZXJJRCAgICAgICAgICAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQ3VzdG9tZXJJRCcgKSB8fCAnJzsKICAgICAgICBteSAkU2VsZWN0ZWRDdXN0b21lclVzZXIgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnU2VsZWN0ZWRDdXN0b21lclVzZXInICkKICAgICAgICAgICAgfHwgJyc7CiAgICAgICAgbXkgJEV4cGFuZEN1c3RvbWVyTmFtZSA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdFeHBhbmRDdXN0b21lck5hbWUnICkKICAgICAgICAgICAgfHwgMDsKICAgICAgICBteSAlRnJvbUV4dGVybmFsQ3VzdG9tZXI7CiAgICAgICAgJEZyb21FeHRlcm5hbEN1c3RvbWVye0N1c3RvbWVyfSA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdQcmVTZWxlY3RlZEN1c3RvbWVyVXNlcicgKQogICAgICAgICAgICB8fCAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQ3VzdG9tZXJVc2VyJyApCiAgICAgICAgICAgIHx8ICcnOwogICAgICAgICRHZXRQYXJhbXtRdWV1ZUlEfSAgICAgICAgICAgID0gJE5ld1F1ZXVlSUQ7CiAgICAgICAgJEdldFBhcmFte0V4cGFuZEN1c3RvbWVyTmFtZX0gPSAkRXhwYW5kQ3VzdG9tZXJOYW1lOwoKICAgICAgICAjIGdldCBzZW5kZXIgcXVldWUgZnJvbQogICAgICAgIG15ICRTaWduYXR1cmUgPSAnJzsKICAgICAgICBpZiAoJE5ld1F1ZXVlSUQpIHsKICAgICAgICAgICAgJFNpZ25hdHVyZSA9ICRTZWxmLT5fR2V0U2lnbmF0dXJlKAogICAgICAgICAgICAgICAgUXVldWVJRCAgICAgICAgPT4gJE5ld1F1ZXVlSUQsCiAgICAgICAgICAgICAgICBDdXN0b21lclVzZXJJRCA9PiAkQ3VzdG9tZXJVc2VyCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICBpZiAoICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdPd25lckFsbFJlZnJlc2gnICkgKSB7CiAgICAgICAgICAgICRHZXRQYXJhbXtPd25lckFsbH0gPSAxOwogICAgICAgICAgICAkRXhwYW5kQ3VzdG9tZXJOYW1lID0gMzsKICAgICAgICB9CiAgICAgICAgaWYgKCAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnUmVzcG9uc2libGVBbGxSZWZyZXNoJyApICkgewogICAgICAgICAgICAkR2V0UGFyYW17UmVzcG9uc2libGVBbGx9ID0gMTsKICAgICAgICAgICAgJEV4cGFuZEN1c3RvbWVyTmFtZSA9IDM7CiAgICAgICAgfQogICAgICAgIGlmICggJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0NsZWFyVG8nICkgKSB7CiAgICAgICAgICAgICRHZXRQYXJhbXtUb30gPSAnJzsKICAgICAgICAgICAgJEV4cGFuZEN1c3RvbWVyTmFtZSA9IDM7CiAgICAgICAgfQogICAgICAgIGZvciBteSAkTnVtYmVyICggMSAuLiAyICkgewogICAgICAgICAgICBteSAkSXRlbSA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICJFeHBhbmRDdXN0b21lck5hbWUkTnVtYmVyIiApIHx8IDA7CiAgICAgICAgICAgIGlmICggJE51bWJlciA9PSAxICYmICRJdGVtICkgewogICAgICAgICAgICAgICAgJEV4cGFuZEN1c3RvbWVyTmFtZSA9IDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzaWYgKCAkTnVtYmVyID09IDIgJiYgJEl0ZW0gKSB7CiAgICAgICAgICAgICAgICAkRXhwYW5kQ3VzdG9tZXJOYW1lID0gMjsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBjcmVhdGUgaHRtbCBzdHJpbmdzIGZvciBhbGwgZHluYW1pYyBmaWVsZHMKICAgICAgICBteSAlRHluYW1pY0ZpZWxkSFRNTDsKCiAgICAgICAgIyBjeWNsZSB0aHJvdWdoIHRoZSBhY3RpdmF0ZWQgRHluYW1pYyBGaWVsZHMgZm9yIHRoaXMgc2NyZWVuCiAgICAgICAgRFlOQU1JQ0ZJRUxEOgogICAgICAgIGZvciBteSAkRHluYW1pY0ZpZWxkQ29uZmlnICggQHsgJFNlbGYtPntEeW5hbWljRmllbGR9IH0gKSB7CiAgICAgICAgICAgIG5leHQgRFlOQU1JQ0ZJRUxEIGlmICFJc0hhc2hSZWZXaXRoRGF0YSgkRHluYW1pY0ZpZWxkQ29uZmlnKTsKCiAgICAgICAgICAgIG15ICRQb3NzaWJsZVZhbHVlc0ZpbHRlcjsKCiAgICAgICAgICAgIG15ICRJc0FDTFJlZHVjaWJsZSA9ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0LT5IYXNCZWhhdmlvcigKICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZENvbmZpZyA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnLAogICAgICAgICAgICAgICAgQmVoYXZpb3IgICAgICAgICAgID0+ICdJc0FDTFJlZHVjaWJsZScsCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBpZiAoJElzQUNMUmVkdWNpYmxlKSB7CgogICAgICAgICAgICAgICAgIyBnZXQgUG9zc2libGVWYWx1ZXMKICAgICAgICAgICAgICAgIG15ICRQb3NzaWJsZVZhbHVlcyA9ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0LT5Qb3NzaWJsZVZhbHVlc0dldCgKICAgICAgICAgICAgICAgICAgICBEeW5hbWljRmllbGRDb25maWcgPT4gJER5bmFtaWNGaWVsZENvbmZpZywKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgIyBjaGVjayBpZiBmaWVsZCBoYXMgUG9zc2libGVWYWx1ZXMgcHJvcGVydHkgaW4gaXRzIGNvbmZpZ3VyYXRpb24KICAgICAgICAgICAgICAgIGlmICggSXNIYXNoUmVmV2l0aERhdGEoJFBvc3NpYmxlVmFsdWVzKSApIHsKCiAgICAgICAgICAgICAgICAgICAgIyBjb252ZXJ0IHBvc3NpYmxlIHZhbHVlcyBrZXkgPT4gdmFsdWUgdG8ga2V5ID0+IGtleSBmb3IgQUNMcyB1c2luZyBhIEhhc2ggc2xpY2UKICAgICAgICAgICAgICAgICAgICBteSAlQWNsRGF0YSA9ICV7JFBvc3NpYmxlVmFsdWVzfTsKICAgICAgICAgICAgICAgICAgICBAQWNsRGF0YXsga2V5cyAlQWNsRGF0YSB9ID0ga2V5cyAlQWNsRGF0YTsKCiAgICAgICAgICAgICAgICAgICAgIyBzZXQgcG9zc2libGUgdmFsdWVzIGZpbHRlciBmcm9tIEFDTHMKICAgICAgICAgICAgICAgICAgICBteSAkQUNMID0gJFRpY2tldE9iamVjdC0+VGlja2V0QWNsKAogICAgICAgICAgICAgICAgICAgICAgICAlR2V0UGFyYW0sCiAgICAgICAgICAgICAgICAgICAgICAgICVBQ0xDb21wYXRHZXRQYXJhbSwKICAgICAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJVc2VySUQgPT4gJEN1c3RvbWVyVXNlciB8fCAnJywKICAgICAgICAgICAgICAgICAgICAgICAgQWN0aW9uICAgICAgICAgPT4gJFNlbGYtPntBY3Rpb259LAogICAgICAgICAgICAgICAgICAgICAgICBSZXR1cm5UeXBlICAgICA9PiAnVGlja2V0JywKICAgICAgICAgICAgICAgICAgICAgICAgUmV0dXJuU3ViVHlwZSAgPT4gJ0R5bmFtaWNGaWVsZF8nIC4gJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9LAogICAgICAgICAgICAgICAgICAgICAgICBEYXRhICAgICAgICAgICA9PiBcJUFjbERhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgIFVzZXJJRCAgICAgICAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIGlmICgkQUNMKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG15ICVGaWx0ZXIgPSAkVGlja2V0T2JqZWN0LT5UaWNrZXRBY2xEYXRhKCk7CgogICAgICAgICAgICAgICAgICAgICAgICAjIGNvbnZlcnQgRmlsZXIga2V5ID0+IGtleSBiYWNrIHRvIGtleSA9PiB2YWx1ZSB1c2luZyBtYXAKICAgICAgICAgICAgICAgICAgICAgICAgJXskUG9zc2libGVWYWx1ZXNGaWx0ZXJ9ID0gbWFwIHsgJF8gPT4gJFBvc3NpYmxlVmFsdWVzLT57JF99IH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleXMgJUZpbHRlcjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG15ICRWYWxpZGF0aW9uUmVzdWx0OwoKICAgICAgICAgICAgIyBkbyBub3QgdmFsaWRhdGUgb24gYXR0YWNobWVudCB1cGxvYWQKICAgICAgICAgICAgaWYgKCAhJEV4cGFuZEN1c3RvbWVyTmFtZSApIHsKCiAgICAgICAgICAgICAgICAkVmFsaWRhdGlvblJlc3VsdCA9ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0LT5FZGl0RmllbGRWYWx1ZVZhbGlkYXRlKAogICAgICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZENvbmZpZyAgID0+ICREeW5hbWljRmllbGRDb25maWcsCiAgICAgICAgICAgICAgICAgICAgUG9zc2libGVWYWx1ZXNGaWx0ZXIgPT4gJFBvc3NpYmxlVmFsdWVzRmlsdGVyLAogICAgICAgICAgICAgICAgICAgIFBhcmFtT2JqZWN0ICAgICAgICAgID0+ICRQYXJhbU9iamVjdCwKICAgICAgICAgICAgICAgICAgICBNYW5kYXRvcnkgPT4KICAgICAgICAgICAgICAgICAgICAgICAgJENvbmZpZy0+e0R5bmFtaWNGaWVsZH0tPnsgJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9IH0gPT0gMiwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgaWYgKCAhSXNIYXNoUmVmV2l0aERhdGEoJFZhbGlkYXRpb25SZXN1bHQpICkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5FcnJvclNjcmVlbigKICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5UcmFuc2xhdGUoICdDb3VsZCBub3QgcGVyZm9ybSB2YWxpZGF0aW9uIG9uIGZpZWxkICVzIScsICREeW5hbWljRmllbGRDb25maWctPntMYWJlbH0gKSwKICAgICAgICAgICAgICAgICAgICAgICAgQ29tbWVudCA9PiBUcmFuc2xhdGFibGUoJ1BsZWFzZSBjb250YWN0IHRoZSBhZG1pbmlzdHJhdG9yLicpLAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBwcm9wYWdhdGUgdmFsaWRhdGlvbiBlcnJvciB0byB0aGUgRXJyb3IgdmFyaWFibGUgdG8gYmUgZGV0ZWN0ZWQgYnkgdGhlIGZyb250ZW5kCiAgICAgICAgICAgICAgICBpZiAoICRWYWxpZGF0aW9uUmVzdWx0LT57U2VydmVyRXJyb3J9ICkgewogICAgICAgICAgICAgICAgICAgICRFcnJvcnsgJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9IH0gPSAnIFNlcnZlckVycm9yJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBnZXQgZmllbGQgaHRtbAogICAgICAgICAgICAkRHluYW1pY0ZpZWxkSFRNTHsgJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9IH0gPSAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdC0+RWRpdEZpZWxkUmVuZGVyKAogICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnICAgPT4gJER5bmFtaWNGaWVsZENvbmZpZywKICAgICAgICAgICAgICAgIFBvc3NpYmxlVmFsdWVzRmlsdGVyID0+ICRQb3NzaWJsZVZhbHVlc0ZpbHRlciwKICAgICAgICAgICAgICAgIE1hbmRhdG9yeSA9PgogICAgICAgICAgICAgICAgICAgICRDb25maWctPntEeW5hbWljRmllbGR9LT57ICREeW5hbWljRmllbGRDb25maWctPntOYW1lfSB9ID09IDIsCiAgICAgICAgICAgICAgICBTZXJ2ZXJFcnJvciAgPT4gJFZhbGlkYXRpb25SZXN1bHQtPntTZXJ2ZXJFcnJvcn0gIHx8ICcnLAogICAgICAgICAgICAgICAgRXJyb3JNZXNzYWdlID0+ICRWYWxpZGF0aW9uUmVzdWx0LT57RXJyb3JNZXNzYWdlfSB8fCAnJywKICAgICAgICAgICAgICAgIExheW91dE9iamVjdCA9PiAkTGF5b3V0T2JqZWN0LAogICAgICAgICAgICAgICAgUGFyYW1PYmplY3QgID0+ICRQYXJhbU9iamVjdCwKICAgICAgICAgICAgICAgIEFKQVhVcGRhdGUgICA9PiAxLAogICAgICAgICAgICAgICAgVXBkYXRhYmxlRmllbGRzID0+ICRTZWxmLT5fR2V0RmllbGRzVG9VcGRhdGUoKSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgZ2V0IGFsbCBhdHRhY2htZW50cyBtZXRhIGRhdGEKICAgICAgICBteSBAQXR0YWNobWVudHMgPSAkVXBsb2FkQ2FjaGVPYmplY3QtPkZvcm1JREdldEFsbEZpbGVzTWV0YSgKICAgICAgICAgICAgRm9ybUlEID0+ICRTZWxmLT57Rm9ybUlEfSwKICAgICAgICApOwoKICAgICAgICAjIGdldCBjdXN0b21lciB1c2VyIG9iamVjdAogICAgICAgIG15ICRDdXN0b21lclVzZXJPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q3VzdG9tZXJVc2VyJyk7CgogICAgICAgICMgRXhwYW5kIEN1c3RvbWVyIE5hbWUKICAgICAgICBteSAlQ3VzdG9tZXJVc2VyRGF0YTsKICAgICAgICBpZiAoICRFeHBhbmRDdXN0b21lck5hbWUgPT0gMSApIHsKCiAgICAgICAgICAgICMgc2VhcmNoIGN1c3RvbWVyCiAgICAgICAgICAgIG15ICVDdXN0b21lclVzZXJMaXN0OwogICAgICAgICAgICAlQ3VzdG9tZXJVc2VyTGlzdCA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyU2VhcmNoKAogICAgICAgICAgICAgICAgU2VhcmNoID0+ICRHZXRQYXJhbXtUb30sCiAgICAgICAgICAgICAgICBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICApOwoKICAgICAgICAgICAgIyBjaGVjayBpZiBqdXN0IG9uZSBjdXN0b21lciB1c2VyIGV4aXN0cwogICAgICAgICAgICAjIGlmIGp1c3Qgb25lLCBmaWxsdXAgQ3VzdG9tZXJVc2VySUQgYW5kIEN1c3RvbWVySUQKICAgICAgICAgICAgJFBhcmFte0N1c3RvbWVyVXNlckxpc3RDb3VudH0gPSAwOwogICAgICAgICAgICBmb3IgbXkgJEN1c3RvbWVyVXNlcktleSAoIHNvcnQga2V5cyAlQ3VzdG9tZXJVc2VyTGlzdCApIHsKICAgICAgICAgICAgICAgICRQYXJhbXtDdXN0b21lclVzZXJMaXN0Q291bnR9Kys7CiAgICAgICAgICAgICAgICAkUGFyYW17Q3VzdG9tZXJVc2VyTGlzdExhc3R9ICAgICA9ICRDdXN0b21lclVzZXJMaXN0eyRDdXN0b21lclVzZXJLZXl9OwogICAgICAgICAgICAgICAgJFBhcmFte0N1c3RvbWVyVXNlckxpc3RMYXN0VXNlcn0gPSAkQ3VzdG9tZXJVc2VyS2V5OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICggJFBhcmFte0N1c3RvbWVyVXNlckxpc3RDb3VudH0gPT0gMSApIHsKICAgICAgICAgICAgICAgICRHZXRQYXJhbXtUb30gICAgICAgICAgICAgID0gJFBhcmFte0N1c3RvbWVyVXNlckxpc3RMYXN0fTsKICAgICAgICAgICAgICAgICRFcnJvcntFeHBhbmRDdXN0b21lck5hbWV9ID0gMTsKICAgICAgICAgICAgICAgIG15ICVDdXN0b21lclVzZXJEYXRhID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJVc2VyRGF0YUdldCgKICAgICAgICAgICAgICAgICAgICBVc2VyID0+ICRQYXJhbXtDdXN0b21lclVzZXJMaXN0TGFzdFVzZXJ9LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGlmICggJEN1c3RvbWVyVXNlckRhdGF7VXNlckN1c3RvbWVySUR9ICkgewogICAgICAgICAgICAgICAgICAgICRDdXN0b21lcklEID0gJEN1c3RvbWVyVXNlckRhdGF7VXNlckN1c3RvbWVySUR9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCAkQ3VzdG9tZXJVc2VyRGF0YXtVc2VyTG9naW59ICkgewogICAgICAgICAgICAgICAgICAgICRDdXN0b21lclVzZXIgPSAkQ3VzdG9tZXJVc2VyRGF0YXtVc2VyTG9naW59OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGlmIG1vcmUgdGhlIG9uZSBjdXN0b21lciB1c2VyIGV4aXN0cywgc2hvdyBsaXN0CiAgICAgICAgICAgICMgYW5kIGNsZWFuIEN1c3RvbWVyVXNlcklEIGFuZCBDdXN0b21lcklECiAgICAgICAgICAgIGVsc2UgewoKICAgICAgICAgICAgICAgICMgZG9uJ3QgY2hlY2sgZW1haWwgc3ludGF4IG9uIG11bHRpIGN1c3RvbWVyIHNlbGVjdAogICAgICAgICAgICAgICAgJENvbmZpZ09iamVjdC0+U2V0KAogICAgICAgICAgICAgICAgICAgIEtleSAgID0+ICdDaGVja0VtYWlsQWRkcmVzc2VzJywKICAgICAgICAgICAgICAgICAgICBWYWx1ZSA9PiAwCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgJEN1c3RvbWVySUQgPSAnJzsKCiAgICAgICAgICAgICAgICAjIGNsZWFyIHRvIGlmIHRoZXJlIGlzIG5vIGN1c3RvbWVyIGZvdW5kCiAgICAgICAgICAgICAgICBpZiAoICElQ3VzdG9tZXJVc2VyTGlzdCApIHsKICAgICAgICAgICAgICAgICAgICAkR2V0UGFyYW17VG99ID0gJyc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkRXJyb3J7RXhwYW5kQ3VzdG9tZXJOYW1lfSA9IDE7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgZ2V0IGZyb20gYW5kIGN1c3RvbWVyIGlkIGlmIGN1c3RvbWVyIHVzZXIgaXMgZ2l2ZW4KICAgICAgICBlbHNpZiAoICRFeHBhbmRDdXN0b21lck5hbWUgPT0gMiApIHsKICAgICAgICAgICAgJUN1c3RvbWVyVXNlckRhdGEgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJEYXRhR2V0KAogICAgICAgICAgICAgICAgVXNlciA9PiAkQ3VzdG9tZXJVc2VyLAogICAgICAgICAgICApOwogICAgICAgICAgICBteSAlQ3VzdG9tZXJVc2VyTGlzdCA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyU2VhcmNoKAogICAgICAgICAgICAgICAgVXNlckxvZ2luID0+ICRDdXN0b21lclVzZXIsCiAgICAgICAgICAgICAgICBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICApOwogICAgICAgICAgICBmb3IgbXkgJEN1c3RvbWVyVXNlcktleSAoIHNvcnQga2V5cyAlQ3VzdG9tZXJVc2VyTGlzdCApIHsKICAgICAgICAgICAgICAgICRHZXRQYXJhbXtUb30gPSAkQ3VzdG9tZXJVc2VyTGlzdHskQ3VzdG9tZXJVc2VyS2V5fTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoICRDdXN0b21lclVzZXJEYXRhe1VzZXJDdXN0b21lcklEfSApIHsKICAgICAgICAgICAgICAgICRDdXN0b21lcklEID0gJEN1c3RvbWVyVXNlckRhdGF7VXNlckN1c3RvbWVySUR9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICggJEN1c3RvbWVyVXNlckRhdGF7VXNlckxvZ2lufSApIHsKICAgICAgICAgICAgICAgICRDdXN0b21lclVzZXIgPSAkQ3VzdG9tZXJVc2VyRGF0YXtVc2VyTG9naW59OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICggJEZyb21FeHRlcm5hbEN1c3RvbWVye0N1c3RvbWVyfSApIHsKICAgICAgICAgICAgICAgIG15ICVFeHRlcm5hbEN1c3RvbWVyVXNlckRhdGEgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJEYXRhR2V0KAogICAgICAgICAgICAgICAgICAgIFVzZXIgPT4gJEZyb21FeHRlcm5hbEN1c3RvbWVye0N1c3RvbWVyfSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAkRnJvbUV4dGVybmFsQ3VzdG9tZXJ7RW1haWx9ID0gJEV4dGVybmFsQ3VzdG9tZXJVc2VyRGF0YXtVc2VyTWFpbFN0cmluZ307CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJEVycm9ye0V4cGFuZEN1c3RvbWVyTmFtZX0gPSAxOwogICAgICAgIH0KCiAgICAgICAgIyBpZiBhIG5ldyBkZXN0aW5hdGlvbiBxdWV1ZSBpcyBzZWxlY3RlZAogICAgICAgIGVsc2lmICggJEV4cGFuZEN1c3RvbWVyTmFtZSA9PSAzICkgewogICAgICAgICAgICAkRXJyb3J7Tm9TdWJtaXR9ID0gMTsKICAgICAgICAgICAgJEN1c3RvbWVyVXNlciA9ICRTZWxlY3RlZEN1c3RvbWVyVXNlcjsKICAgICAgICB9CgogICAgICAgICMgc2hvdyBjdXN0b21lciBpbmZvCiAgICAgICAgbXkgJUN1c3RvbWVyRGF0YTsKICAgICAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpGcm9udGVuZDo6Q3VzdG9tZXJJbmZvQ29tcG9zZScpICkgewogICAgICAgICAgICBpZiAoICRDdXN0b21lclVzZXIgfHwgJFNlbGVjdGVkQ3VzdG9tZXJVc2VyICkgewogICAgICAgICAgICAgICAgJUN1c3RvbWVyRGF0YSA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyVXNlckRhdGFHZXQoCiAgICAgICAgICAgICAgICAgICAgVXNlciA9PiAkQ3VzdG9tZXJVc2VyIHx8ICRTZWxlY3RlZEN1c3RvbWVyVXNlciwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzaWYgKCRDdXN0b21lcklEKSB7CiAgICAgICAgICAgICAgICAlQ3VzdG9tZXJEYXRhID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJVc2VyRGF0YUdldCgKICAgICAgICAgICAgICAgICAgICBDdXN0b21lcklEID0+ICRDdXN0b21lcklELAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBjaGVjayBlbWFpbCBhZGRyZXNzCiAgICAgICAgUEFSQU1FVEVSOgogICAgICAgIGZvciBteSAkUGFyYW1ldGVyIChxdyhUbyBDYyBCY2MpKSB7CiAgICAgICAgICAgIG5leHQgUEFSQU1FVEVSIGlmICEkR2V0UGFyYW17JFBhcmFtZXRlcn07CiAgICAgICAgICAgIGZvciBteSAkRW1haWwgKCBNYWlsOjpBZGRyZXNzLT5wYXJzZSggJEdldFBhcmFteyRQYXJhbWV0ZXJ9ICkgKSB7CiAgICAgICAgICAgICAgICBpZiAoICEkQ2hlY2tJdGVtT2JqZWN0LT5DaGVja0VtYWlsKCBBZGRyZXNzID0+ICRFbWFpbC0+YWRkcmVzcygpICkgKSB7CiAgICAgICAgICAgICAgICAgICAgJEVycm9yeyAkUGFyYW1ldGVyIC4gJ0Vycm9yVHlwZScgfQogICAgICAgICAgICAgICAgICAgICAgICA9ICRQYXJhbWV0ZXIgLiAkQ2hlY2tJdGVtT2JqZWN0LT5DaGVja0Vycm9yVHlwZSgpIC4gJ1NlcnZlckVycm9yTXNnJzsKICAgICAgICAgICAgICAgICAgICAkRXJyb3J7ICRQYXJhbWV0ZXIgLiAnSW52YWxpZCcgfSA9ICdTZXJ2ZXJFcnJvcic7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbXkgJElzTG9jYWwgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6U3lzdGVtQWRkcmVzcycpLT5TeXN0ZW1BZGRyZXNzSXNMb2NhbEFkZHJlc3MoCiAgICAgICAgICAgICAgICAgICAgQWRkcmVzcyA9PiAkRW1haWwtPmFkZHJlc3MoKQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGlmICgkSXNMb2NhbCkgewogICAgICAgICAgICAgICAgICAgICRFcnJvcnsgJFBhcmFtZXRlciAuICdJc0xvY2FsQWRkcmVzcycgfSA9ICdTZXJ2ZXJFcnJvcic7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgaWYgaXQgaXMgbm90IGEgc3ViYWN0aW9uIGFib3V0IGF0dGFjaG1lbnRzLCBjaGVjayBmb3Igc2VydmVyIGVycm9ycwogICAgICAgIGlmICggISRFeHBhbmRDdXN0b21lck5hbWUgKSB7CiAgICAgICAgICAgIGlmICggISRHZXRQYXJhbXtUb30gKSB7CiAgICAgICAgICAgICAgICAkRXJyb3J7J1RvSW52YWxpZCd9ID0gJ1NlcnZlckVycm9yJzsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoICEkR2V0UGFyYW17U3ViamVjdH0gKSB7CiAgICAgICAgICAgICAgICAkRXJyb3J7J1N1YmplY3RJbnZhbGlkJ30gPSAnU2VydmVyRXJyb3InOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICggISROZXdRdWV1ZUlEICkgewogICAgICAgICAgICAgICAgJEVycm9yeydEZXN0aW5hdGlvbkludmFsaWQnfSA9ICdTZXJ2ZXJFcnJvcic7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCAhJEdldFBhcmFte0JvZHl9ICkgewogICAgICAgICAgICAgICAgJEVycm9yeydCb2R5SW52YWxpZCd9ID0gJ1NlcnZlckVycm9yJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBjaGVjayBpZiBkYXRlIGlzIHZhbGlkCiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICEkRXhwYW5kQ3VzdG9tZXJOYW1lCiAgICAgICAgICAgICAgICAmJiAkU3RhdGVEYXRhe1R5cGVOYW1lfQogICAgICAgICAgICAgICAgJiYgJFN0YXRlRGF0YXtUeXBlTmFtZX0gPX4gL15wZW5kaW5nL2kKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgewoKICAgICAgICAgICAgICAgICMgY29udmVydCBwZW5kaW5nIGRhdGUgdG8gYSBkYXRldGltZSBvYmplY3QKICAgICAgICAgICAgICAgIG15ICRQZW5kaW5nRGF0ZVRpbWVPYmplY3QgPSAkS2VybmVsOjpPTS0+Q3JlYXRlKAogICAgICAgICAgICAgICAgICAgICdLZXJuZWw6OlN5c3RlbTo6RGF0ZVRpbWUnLAogICAgICAgICAgICAgICAgICAgIE9iamVjdFBhcmFtcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgICAgICAgICAgICAgU2Vjb25kID0+IDAsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgIyBnZXQgY3VycmVudCBzeXN0ZW0gZXBvY2gKICAgICAgICAgICAgICAgIG15ICRDdXJTeXN0ZW1EYXRlVGltZU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5DcmVhdGUoJ0tlcm5lbDo6U3lzdGVtOjpEYXRlVGltZScpOwoKICAgICAgICAgICAgICAgIGlmICggISRQZW5kaW5nRGF0ZVRpbWVPYmplY3QgfHwgJFBlbmRpbmdEYXRlVGltZU9iamVjdCA8ICRDdXJTeXN0ZW1EYXRlVGltZU9iamVjdCApIHsKICAgICAgICAgICAgICAgICAgICAkRXJyb3J7J0RhdGVJbnZhbGlkJ30gPSAnU2VydmVyRXJyb3InOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6U2VydmljZScpCiAgICAgICAgICAgICAgICAmJiAkR2V0UGFyYW17U0xBSUR9CiAgICAgICAgICAgICAgICAmJiAhJEdldFBhcmFte1NlcnZpY2VJRH0KICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJEVycm9yeydTZXJ2aWNlSW52YWxpZCd9ID0gJ1NlcnZlckVycm9yJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBjaGVjayBtYW5kYXRvcnkgc2VydmljZQogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6U2VydmljZScpCiAgICAgICAgICAgICAgICAmJiAkQ29uZmlnLT57U2VydmljZU1hbmRhdG9yeX0KICAgICAgICAgICAgICAgICYmICEkR2V0UGFyYW17U2VydmljZUlEfQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkRXJyb3J7J1NlcnZpY2VJbnZhbGlkJ30gPSAnIFNlcnZlckVycm9yJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBjaGVjayBtYW5kYXRvcnkgc2xhCiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpTZXJ2aWNlJykKICAgICAgICAgICAgICAgICYmICRDb25maWctPntTTEFNYW5kYXRvcnl9CiAgICAgICAgICAgICAgICAmJiAhJEdldFBhcmFte1NMQUlEfQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkRXJyb3J7J1NMQUludmFsaWQnfSA9ICcgU2VydmVyRXJyb3InOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpUeXBlJykgJiYgISRHZXRQYXJhbXtUeXBlSUR9ICkgewogICAgICAgICAgICAgICAgJEVycm9yeydUeXBlSW52YWxpZCd9ID0gJ1NlcnZlckVycm9yJzsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6OkFjY291bnRUaW1lJykKICAgICAgICAgICAgICAgICYmICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpGcm9udGVuZDo6TmVlZEFjY291bnRlZFRpbWUnKQogICAgICAgICAgICAgICAgJiYgJEdldFBhcmFte1RpbWVVbml0c30gZXEgJycKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJEVycm9yeydUaW1lVW5pdHNJbnZhbGlkJ30gPSAnU2VydmVyRXJyb3InOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIHJ1biBjb21wb3NlIG1vZHVsZXMKICAgICAgICBteSAlQXJ0aWNsZVBhcmFtOwogICAgICAgIGlmICggcmVmICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpGcm9udGVuZDo6QXJ0aWNsZUNvbXBvc2VNb2R1bGUnKSBlcSAnSEFTSCcgKSB7CiAgICAgICAgICAgIG15ICVKb2JzID0gJXsgJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpBcnRpY2xlQ29tcG9zZU1vZHVsZScpIH07CiAgICAgICAgICAgIGZvciBteSAkSm9iICggc29ydCBrZXlzICVKb2JzICkgewoKICAgICAgICAgICAgICAgICMgbG9hZCBtb2R1bGUKICAgICAgICAgICAgICAgIGlmICggISRNYWluT2JqZWN0LT5SZXF1aXJlKCAkSm9ic3skSm9ifS0+e01vZHVsZX0gKSApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG15ICRPYmplY3QgPSAkSm9ic3skSm9ifS0+e01vZHVsZX0tPm5ldygKICAgICAgICAgICAgICAgICAgICAleyRTZWxmfSwKICAgICAgICAgICAgICAgICAgICBEZWJ1ZyA9PiAkRGVidWcsCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICMgZ2V0IHBhcmFtcwogICAgICAgICAgICAgICAgbXkgJE11bHRpcGxlOwogICAgICAgICAgICAgICAgUEFSQU1FVEVSOgogICAgICAgICAgICAgICAgZm9yIG15ICRQYXJhbWV0ZXIgKCAkT2JqZWN0LT5PcHRpb24oICVHZXRQYXJhbSwgQ29uZmlnID0+ICRKb2JzeyRKb2J9ICkgKSB7CgogICAgICAgICAgICAgICAgICAgIGlmICggJEpvYnN7JEpvYn0tPntQYXJhbVR5cGV9ICYmICRKb2JzeyRKb2J9LT57UGFyYW1UeXBlfSBuZSAnU2luZ2xlJyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgQHsgJEdldFBhcmFteyRQYXJhbWV0ZXJ9IH0gPSAkUGFyYW1PYmplY3QtPkdldEFycmF5KCBQYXJhbSA9PiAkUGFyYW1ldGVyICk7CiAgICAgICAgICAgICAgICAgICAgICAgICRNdWx0aXBsZSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIG5leHQgUEFSQU1FVEVSOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJEdldFBhcmFteyRQYXJhbWV0ZXJ9ID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJFBhcmFtZXRlciApOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgcnVuIG1vZHVsZQogICAgICAgICAgICAgICAgJE9iamVjdC0+UnVuKAogICAgICAgICAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgICAgICAgICBTdG9yZU5ldyA9PiAxLAogICAgICAgICAgICAgICAgICAgIENvbmZpZyAgID0+ICRKb2JzeyRKb2J9CiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICMgZ2V0IG9wdGlvbnMgdGhhdCBoYXZlIGJlZW4gcmVtb3ZlZCBmcm9tIHRoZSBzZWxlY3Rpb24KICAgICAgICAgICAgICAgICMgYW5kIGFkZCB0aGVtIGJhY2sgdG8gdGhlIHNlbGVjdGlvbiBzbyB0aGF0IHRoZSBzdWJtaXQKICAgICAgICAgICAgICAgICMgd2lsbCBjb250YWluIG9wdGlvbnMgdGhhdCB3ZXJlIGhpZGRlbiBmcm9tIHRoZSBhZ2VudAogICAgICAgICAgICAgICAgbXkgJEtleSA9ICRPYmplY3QtPk9wdGlvbiggJUdldFBhcmFtLCBDb25maWcgPT4gJEpvYnN7JEpvYn0gKTsKCiAgICAgICAgICAgICAgICBpZiAoICRPYmplY3QtPmNhbignR2V0T3B0aW9uc1RvUmVtb3ZlQUpBWCcpICkgewogICAgICAgICAgICAgICAgICAgIG15IEBSZW1vdmVkT3B0aW9ucyA9ICRPYmplY3QtPkdldE9wdGlvbnNUb1JlbW92ZUFKQVgoJUdldFBhcmFtKTsKICAgICAgICAgICAgICAgICAgICBpZiAoQFJlbW92ZWRPcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkTXVsdGlwbGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBteSAkUmVtb3ZlZE9wdGlvbiAoQFJlbW92ZWRPcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCBAeyAkR2V0UGFyYW17JEtleX0gfSwgJFJlbW92ZWRPcHRpb247CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkR2V0UGFyYW17JEtleX0gPSBzaGlmdCBAUmVtb3ZlZE9wdGlvbnM7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyB0aWNrZXQgcGFyYW1zCiAgICAgICAgICAgICAgICAlQXJ0aWNsZVBhcmFtID0gKAogICAgICAgICAgICAgICAgICAgICVBcnRpY2xlUGFyYW0sCiAgICAgICAgICAgICAgICAgICAgJE9iamVjdC0+QXJ0aWNsZU9wdGlvbiggJUdldFBhcmFtLCAlQXJ0aWNsZVBhcmFtLCBDb25maWcgPT4gJEpvYnN7JEpvYn0gKSwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgIyBnZXQgZXJyb3JzCiAgICAgICAgICAgICAgICAlRXJyb3IgPSAoCiAgICAgICAgICAgICAgICAgICAgJUVycm9yLAogICAgICAgICAgICAgICAgICAgICRPYmplY3QtPkVycm9yKCAlR2V0UGFyYW0sIENvbmZpZyA9PiAkSm9ic3skSm9ifSApLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCVFcnJvcikgewoKICAgICAgICAgICAgaWYgKCAkRXJyb3J7VG9Jc0xvY2FsQWRkcmVzc30gKSB7CiAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICdUb0lzTG9jYWxBZGRyZXNzU2VydmVyRXJyb3JNc2cnLAogICAgICAgICAgICAgICAgICAgIERhdGEgPT4gXCVHZXRQYXJhbSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICggJEVycm9ye0NjSXNMb2NhbEFkZHJlc3N9ICkgewogICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAnQ2NJc0xvY2FsQWRkcmVzc1NlcnZlckVycm9yTXNnJywKICAgICAgICAgICAgICAgICAgICBEYXRhID0+IFwlR2V0UGFyYW0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoICRFcnJvcntCY2NJc0xvY2FsQWRkcmVzc30gKSB7CiAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICdCY2NJc0xvY2FsQWRkcmVzc1NlcnZlckVycm9yTXNnJywKICAgICAgICAgICAgICAgICAgICBEYXRhID0+IFwlR2V0UGFyYW0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGdldCBhbmQgZm9ybWF0IGRlZmF1bHQgc3ViamVjdCBhbmQgYm9keQogICAgICAgICAgICBteSAkU3ViamVjdCA9ICRMYXlvdXRPYmplY3QtPk91dHB1dCgKICAgICAgICAgICAgICAgIFRlbXBsYXRlID0+ICRDb25maWctPntTdWJqZWN0fSB8fCAnJywKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIG15ICRCb2R5ID0gJExheW91dE9iamVjdC0+T3V0cHV0KAogICAgICAgICAgICAgICAgVGVtcGxhdGUgPT4gJENvbmZpZy0+e0JvZHl9IHx8ICcnLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgIyBtYWtlIHN1cmUgYm9keSBpcyByaWNoIHRleHQKICAgICAgICAgICAgaWYgKCAkTGF5b3V0T2JqZWN0LT57QnJvd3NlclJpY2hUZXh0fSApIHsKICAgICAgICAgICAgICAgICRCb2R5ID0gJExheW91dE9iamVjdC0+QXNjaWkyUmljaFRleHQoCiAgICAgICAgICAgICAgICAgICAgU3RyaW5nID0+ICRCb2R5LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgI3NldCBCb2R5IGFuZCBTdWJqZWN0IHBhcmFtZXRlcnMgZm9yIE91dHB1dAogICAgICAgICAgICBpZiAoICEkR2V0UGFyYW17U3ViamVjdH0gKSB7CiAgICAgICAgICAgICAgICAkR2V0UGFyYW17U3ViamVjdH0gPSAkU3ViamVjdDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCAhJEdldFBhcmFte0JvZHl9ICkgewogICAgICAgICAgICAgICAgJEdldFBhcmFte0JvZHl9ID0gJEJvZHk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgZ2V0IHNlcnZpY2VzCiAgICAgICAgICAgIG15ICRTZXJ2aWNlcyA9ICRTZWxmLT5fR2V0U2VydmljZXMoCiAgICAgICAgICAgICAgICAlR2V0UGFyYW0sCiAgICAgICAgICAgICAgICAlQUNMQ29tcGF0R2V0UGFyYW0sCiAgICAgICAgICAgICAgICBDdXN0b21lclVzZXJJRCA9PiAkQ3VzdG9tZXJVc2VyIHx8ICcnLAogICAgICAgICAgICAgICAgUXVldWVJRCAgICAgICAgPT4gJE5ld1F1ZXVlSUQgICB8fCAxLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgIyByZXNldCBwcmV2aW91cyBTZXJ2aWNlSUQgdG8gcmVzZXQgU0xBLUxpc3QgaWYgbm8gc2VydmljZSBpcyBzZWxlY3RlZAogICAgICAgICAgICBpZiAoICEkR2V0UGFyYW17U2VydmljZUlEfSB8fCAhJFNlcnZpY2VzLT57ICRHZXRQYXJhbXtTZXJ2aWNlSUR9IH0gKSB7CiAgICAgICAgICAgICAgICAkR2V0UGFyYW17U2VydmljZUlEfSA9ICcnOwogICAgICAgICAgICB9CgogICAgICAgICAgICBteSAkU0xBcyA9ICRTZWxmLT5fR2V0U0xBcygKICAgICAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgICAgICVBQ0xDb21wYXRHZXRQYXJhbSwKICAgICAgICAgICAgICAgIFF1ZXVlSUQgID0+ICROZXdRdWV1ZUlEIHx8IDEsCiAgICAgICAgICAgICAgICBTZXJ2aWNlcyA9PiAkU2VydmljZXMsCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAjIGhlYWRlcgogICAgICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPkhlYWRlcigpOwogICAgICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk5hdmlnYXRpb25CYXIoKTsKCiAgICAgICAgICAgICMgaHRtbCBvdXRwdXQKICAgICAgICAgICAgJE91dHB1dCAuPSAkU2VsZi0+X01hc2tFbWFpbE5ldygKICAgICAgICAgICAgICAgIFF1ZXVlSUQgPT4gJFNlbGYtPntRdWV1ZUlEfSwKICAgICAgICAgICAgICAgIFVzZXJzICAgPT4gJFNlbGYtPl9HZXRVc2VycygKICAgICAgICAgICAgICAgICAgICAlR2V0UGFyYW0sCiAgICAgICAgICAgICAgICAgICAgJUFDTENvbXBhdEdldFBhcmFtLAogICAgICAgICAgICAgICAgICAgIFF1ZXVlSUQgID0+ICROZXdRdWV1ZUlELAogICAgICAgICAgICAgICAgICAgIEFsbFVzZXJzID0+ICRHZXRQYXJhbXtPd25lckFsbH0KICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICBVc2VyU2VsZWN0ZWQgICAgID0+ICROZXdVc2VySUQsCiAgICAgICAgICAgICAgICBSZXNwb25zaWJsZVVzZXJzID0+ICRTZWxmLT5fR2V0UmVzcG9uc2libGVzKAogICAgICAgICAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgICAgICAgICAlQUNMQ29tcGF0R2V0UGFyYW0sCiAgICAgICAgICAgICAgICAgICAgUXVldWVJRCAgPT4gJE5ld1F1ZXVlSUQsCiAgICAgICAgICAgICAgICAgICAgQWxsVXNlcnMgPT4gJEdldFBhcmFte1Jlc3BvbnNpYmxlQWxsfQogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgIFJlc3BvbnNpYmxlVXNlclNlbGVjdGVkID0+ICROZXdSZXNwb25zaWJsZUlELAogICAgICAgICAgICAgICAgTmV4dFN0YXRlcyAgICAgICAgICAgICAgPT4gJFNlbGYtPl9HZXROZXh0U3RhdGVzKAogICAgICAgICAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgICAgICAgICAlQUNMQ29tcGF0R2V0UGFyYW0sCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJVc2VySUQgPT4gJEN1c3RvbWVyVXNlciB8fCAnJywKICAgICAgICAgICAgICAgICAgICBRdWV1ZUlEICAgICAgICA9PiAkTmV3UXVldWVJRCAgIHx8IDEsCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgTmV4dFN0YXRlICA9PiAkTmV4dFN0YXRlLAogICAgICAgICAgICAgICAgUHJpb3JpdGllcyA9PiAkU2VsZi0+X0dldFByaW9yaXRpZXMoCiAgICAgICAgICAgICAgICAgICAgJUdldFBhcmFtLAogICAgICAgICAgICAgICAgICAgICVBQ0xDb21wYXRHZXRQYXJhbSwKICAgICAgICAgICAgICAgICAgICBDdXN0b21lclVzZXJJRCA9PiAkQ3VzdG9tZXJVc2VyIHx8ICcnLAogICAgICAgICAgICAgICAgICAgIFF1ZXVlSUQgICAgICAgID0+ICROZXdRdWV1ZUlEICAgfHwgMSwKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICBUeXBlcyA9PiAkU2VsZi0+X0dldFR5cGVzKAogICAgICAgICAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgICAgICAgICAlQUNMQ29tcGF0R2V0UGFyYW0sCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJVc2VySUQgPT4gJEN1c3RvbWVyVXNlciB8fCAnJywKICAgICAgICAgICAgICAgICAgICBRdWV1ZUlEICAgICAgICA9PiAkTmV3UXVldWVJRCAgIHx8IDEsCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgU2VydmljZXMgICAgICAgICAgPT4gJFNlcnZpY2VzLAogICAgICAgICAgICAgICAgU0xBcyAgICAgICAgICAgICAgPT4gJFNMQXMsCiAgICAgICAgICAgICAgICBTdGFuZGFyZFRlbXBsYXRlcyA9PiAkU2VsZi0+X0dldFN0YW5kYXJkVGVtcGxhdGVzKAogICAgICAgICAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgICAgICAgICAlQUNMQ29tcGF0R2V0UGFyYW0sCiAgICAgICAgICAgICAgICAgICAgUXVldWVJRCA9PiAkTmV3UXVldWVJRCB8fCAnJywKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICBDdXN0b21lcklEICAgICAgICA9PiAkTGF5b3V0T2JqZWN0LT5Bc2NpaTJIdG1sKCBUZXh0ID0+ICRDdXN0b21lcklEICksCiAgICAgICAgICAgICAgICBDdXN0b21lclVzZXIgICAgICA9PiAkQ3VzdG9tZXJVc2VyLAogICAgICAgICAgICAgICAgQ3VzdG9tZXJEYXRhICAgICAgPT4gXCVDdXN0b21lckRhdGEsCiAgICAgICAgICAgICAgICBUaW1lVW5pdHNSZXF1aXJlZCA9PiAoCiAgICAgICAgICAgICAgICAgICAgJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpOZWVkQWNjb3VudGVkVGltZScpCiAgICAgICAgICAgICAgICAgICAgPyAnVmFsaWRhdGVfUmVxdWlyZWQnCiAgICAgICAgICAgICAgICAgICAgOiAnJwogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgIEZyb21MaXN0ICAgICA9PiAkU2VsZi0+X0dldFRvcygpLAogICAgICAgICAgICAgICAgRnJvbVNlbGVjdGVkID0+ICREZXN0LAogICAgICAgICAgICAgICAgU3ViamVjdCAgICAgID0+ICRMYXlvdXRPYmplY3QtPkFzY2lpMkh0bWwoIFRleHQgPT4gJEdldFBhcmFte1N1YmplY3R9ICksCiAgICAgICAgICAgICAgICBCb2R5ICAgICAgICAgPT4gJExheW91dE9iamVjdC0+QXNjaWkySHRtbCggVGV4dCA9PiAkR2V0UGFyYW17Qm9keX0gKSwKICAgICAgICAgICAgICAgIEVycm9ycyAgICAgICA9PiBcJUVycm9yLAogICAgICAgICAgICAgICAgQXR0YWNobWVudHMgID0+IFxAQXR0YWNobWVudHMsCiAgICAgICAgICAgICAgICBTaWduYXR1cmUgICAgPT4gJFNpZ25hdHVyZSwKICAgICAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZEhUTUwgICAgID0+IFwlRHluYW1pY0ZpZWxkSFRNTCwKICAgICAgICAgICAgICAgIE11bHRpcGxlQ3VzdG9tZXIgICAgID0+IFxATXVsdGlwbGVDdXN0b21lciwKICAgICAgICAgICAgICAgIE11bHRpcGxlQ3VzdG9tZXJDYyAgID0+IFxATXVsdGlwbGVDdXN0b21lckNjLAogICAgICAgICAgICAgICAgTXVsdGlwbGVDdXN0b21lckJjYyAgPT4gXEBNdWx0aXBsZUN1c3RvbWVyQmNjLAogICAgICAgICAgICAgICAgRnJvbUV4dGVybmFsQ3VzdG9tZXIgPT4gXCVGcm9tRXh0ZXJuYWxDdXN0b21lciwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Rm9vdGVyKCk7CiAgICAgICAgICAgIHJldHVybiAkT3V0cHV0OwogICAgICAgIH0KCiAgICAgICAgIyBjaGFsbGVuZ2UgdG9rZW4gY2hlY2sgZm9yIHdyaXRlIGFjdGlvbgogICAgICAgICRMYXlvdXRPYmplY3QtPkNoYWxsZW5nZVRva2VuQ2hlY2soKTsKCiAgICAgICAgIyBjcmVhdGUgbmV3IHRpY2tldCwgZG8gZGIgaW5zZXJ0CiAgICAgICAgbXkgJFRpY2tldElEID0gJFRpY2tldE9iamVjdC0+VGlja2V0Q3JlYXRlKAogICAgICAgICAgICBUaXRsZSAgICAgICAgPT4gJEdldFBhcmFte1N1YmplY3R9LAogICAgICAgICAgICBRdWV1ZUlEICAgICAgPT4gJE5ld1F1ZXVlSUQsCiAgICAgICAgICAgIFN1YmplY3QgICAgICA9PiAkR2V0UGFyYW17U3ViamVjdH0sCiAgICAgICAgICAgIExvY2sgICAgICAgICA9PiAndW5sb2NrJywKICAgICAgICAgICAgVHlwZUlEICAgICAgID0+ICRHZXRQYXJhbXtUeXBlSUR9LAogICAgICAgICAgICBTZXJ2aWNlSUQgICAgPT4gJEdldFBhcmFte1NlcnZpY2VJRH0sCiAgICAgICAgICAgIFNMQUlEICAgICAgICA9PiAkR2V0UGFyYW17U0xBSUR9LAogICAgICAgICAgICBTdGF0ZUlEICAgICAgPT4gJE5leHRTdGF0ZUlELAogICAgICAgICAgICBQcmlvcml0eUlEICAgPT4gJEdldFBhcmFte1ByaW9yaXR5SUR9LAogICAgICAgICAgICBPd25lcklEICAgICAgPT4gMSwKICAgICAgICAgICAgQ3VzdG9tZXJJRCAgID0+ICRDdXN0b21lcklELAogICAgICAgICAgICBDdXN0b21lclVzZXIgPT4gJFNlbGVjdGVkQ3VzdG9tZXJVc2VyLAogICAgICAgICAgICBVc2VySUQgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICk7CgogICAgICAgICMgc2V0IHRpY2tldCBkeW5hbWljIGZpZWxkcwogICAgICAgICMgY3ljbGUgdGhyb3VnaCB0aGUgYWN0aXZhdGVkIER5bmFtaWMgRmllbGRzIGZvciB0aGlzIHNjcmVlbgogICAgICAgIERZTkFNSUNGSUVMRDoKICAgICAgICBmb3IgbXkgJER5bmFtaWNGaWVsZENvbmZpZyAoIEB7ICRTZWxmLT57RHluYW1pY0ZpZWxkfSB9ICkgewogICAgICAgICAgICBuZXh0IERZTkFNSUNGSUVMRCBpZiAhSXNIYXNoUmVmV2l0aERhdGEoJER5bmFtaWNGaWVsZENvbmZpZyk7CiAgICAgICAgICAgIG5leHQgRFlOQU1JQ0ZJRUxEIGlmICREeW5hbWljRmllbGRDb25maWctPntPYmplY3RUeXBlfSBuZSAnVGlja2V0JzsKCiAgICAgICAgICAgICMgc2V0IHRoZSB2YWx1ZQogICAgICAgICAgICBteSAkU3VjY2VzcyA9ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0LT5WYWx1ZVNldCgKICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZENvbmZpZyA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnLAogICAgICAgICAgICAgICAgT2JqZWN0SUQgICAgICAgICAgID0+ICRUaWNrZXRJRCwKICAgICAgICAgICAgICAgIFZhbHVlICAgICAgICAgICAgICA9PiAkRHluYW1pY0ZpZWxkVmFsdWVzeyAkRHluYW1pY0ZpZWxkQ29uZmlnLT57TmFtZX0gfSwKICAgICAgICAgICAgICAgIFVzZXJJRCAgICAgICAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIGdldCBwcmUgbG9hZGVkIGF0dGFjaG1lbnQKICAgICAgICBAQXR0YWNobWVudHMgPSAkVXBsb2FkQ2FjaGVPYmplY3QtPkZvcm1JREdldEFsbEZpbGVzRGF0YSgKICAgICAgICAgICAgRm9ybUlEID0+ICRTZWxmLT57Rm9ybUlEfSwKICAgICAgICApOwoKICAgICAgICAjIGdldCBzdWJtaXQgYXR0YWNobWVudAogICAgICAgIG15ICVVcGxvYWRTdHVmZiA9ICRQYXJhbU9iamVjdC0+R2V0VXBsb2FkQWxsKAogICAgICAgICAgICBQYXJhbSA9PiAnRmlsZVVwbG9hZCcsCiAgICAgICAgKTsKICAgICAgICBpZiAoJVVwbG9hZFN0dWZmKSB7CiAgICAgICAgICAgIHB1c2ggQEF0dGFjaG1lbnRzLCBcJVVwbG9hZFN0dWZmOwogICAgICAgIH0KCiAgICAgICAgIyBwcmVwYXJlIHN1YmplY3QKICAgICAgICBteSAkVG4gPSAkVGlja2V0T2JqZWN0LT5UaWNrZXROdW1iZXJMb29rdXAoIFRpY2tldElEID0+ICRUaWNrZXRJRCApOwogICAgICAgICRHZXRQYXJhbXtTdWJqZWN0fSA9ICRUaWNrZXRPYmplY3QtPlRpY2tldFN1YmplY3RCdWlsZCgKICAgICAgICAgICAgVGlja2V0TnVtYmVyID0+ICRUbiwKICAgICAgICAgICAgU3ViamVjdCAgICAgID0+ICRHZXRQYXJhbXtTdWJqZWN0fSB8fCAnJywKICAgICAgICAgICAgVHlwZSAgICAgICAgID0+ICdOZXcnLAogICAgICAgICk7CgogICAgICAgICMgY2hlY2sgaWYgbmV3IG93bmVyIGlzIGdpdmVuICh0aGVuIHNlbmQgbm8gYWdlbnQgbm90aWZ5KQogICAgICAgIG15ICROb0FnZW50Tm90aWZ5ID0gMDsKICAgICAgICBpZiAoJE5ld1VzZXJJRCkgewogICAgICAgICAgICAkTm9BZ2VudE5vdGlmeSA9IDE7CiAgICAgICAgfQoKICAgICAgICBteSAkTWltZVR5cGUgPSAndGV4dC9wbGFpbic7CiAgICAgICAgaWYgKCAkTGF5b3V0T2JqZWN0LT57QnJvd3NlclJpY2hUZXh0fSApIHsKICAgICAgICAgICAgJE1pbWVUeXBlID0gJ3RleHQvaHRtbCc7CiAgICAgICAgICAgICRHZXRQYXJhbXtCb2R5fSAuPSAnPGJyLz48YnIvPicgLiAkU2lnbmF0dXJlOwoKICAgICAgICAgICAgIyByZW1vdmUgdW51c2VkIGlubGluZSBpbWFnZXMKICAgICAgICAgICAgbXkgQE5ld0F0dGFjaG1lbnREYXRhOwogICAgICAgICAgICBBVFRBQ0hNRU5UOgogICAgICAgICAgICBmb3IgbXkgJEF0dGFjaG1lbnQgKEBBdHRhY2htZW50cykgewogICAgICAgICAgICAgICAgbXkgJENvbnRlbnRJRCA9ICRBdHRhY2htZW50LT57Q29udGVudElEfTsKICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAkQ29udGVudElECiAgICAgICAgICAgICAgICAgICAgJiYgKCAkQXR0YWNobWVudC0+e0NvbnRlbnRUeXBlfSA9fiAvaW1hZ2UvaSApCiAgICAgICAgICAgICAgICAgICAgJiYgKCAkQXR0YWNobWVudC0+e0Rpc3Bvc2l0aW9ufSBlcSAnaW5saW5lJyApCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIG15ICRDb250ZW50SURIVE1MUXVvdGUgPSAkTGF5b3V0T2JqZWN0LT5Bc2NpaTJIdG1sKAogICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0+ICRDb250ZW50SUQsCiAgICAgICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAgICAgIyB3b3JrYXJvdW5kIGZvciBsaW5rIGVuY29kZSBvZiByaWNoIHRleHQgZWRpdG9yLCBzZWUgYnVnIzUwNTMKICAgICAgICAgICAgICAgICAgICBteSAkQ29udGVudElETGlua0VuY29kZSA9ICRMYXlvdXRPYmplY3QtPkxpbmtFbmNvZGUoJENvbnRlbnRJRCk7CiAgICAgICAgICAgICAgICAgICAgJEdldFBhcmFte0JvZHl9ID1+IHMvKENvbnRlbnRJRD0pJENvbnRlbnRJRExpbmtFbmNvZGUvJDEkQ29udGVudElEL2c7CgogICAgICAgICAgICAgICAgICAgICMgaWdub3JlIGF0dGFjaG1lbnQgaWYgbm90IGxpbmtlZCBpbiBib2R5CiAgICAgICAgICAgICAgICAgICAgbmV4dCBBVFRBQ0hNRU5UCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICRHZXRQYXJhbXtCb2R5fSAhfiAvKFxRJENvbnRlbnRJREhUTUxRdW90ZVxFfFxRJENvbnRlbnRJRFxFKS9pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgcmVtZW1iZXIgaW5saW5lIGltYWdlcyBhbmQgbm9ybWFsIGF0dGFjaG1lbnRzCiAgICAgICAgICAgICAgICBwdXNoIEBOZXdBdHRhY2htZW50RGF0YSwgXCV7JEF0dGFjaG1lbnR9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIEBBdHRhY2htZW50cyA9IEBOZXdBdHRhY2htZW50RGF0YTsKCiAgICAgICAgICAgICMgdmVyaWZ5IGh0bWwgZG9jdW1lbnQKICAgICAgICAgICAgJEdldFBhcmFte0JvZHl9ID0gJExheW91dE9iamVjdC0+UmljaFRleHREb2N1bWVudENvbXBsZXRlKAogICAgICAgICAgICAgICAgU3RyaW5nID0+ICRHZXRQYXJhbXtCb2R5fSwKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRHZXRQYXJhbXtCb2R5fSAuPSAiXG5cbiIgLiAkU2lnbmF0dXJlOwogICAgICAgIH0KCiAgICAgICAgIyBsb29rdXAgc2VuZGVyCiAgICAgICAgbXkgJFRlbXBsYXRlR2VuZXJhdG9yID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRlbXBsYXRlR2VuZXJhdG9yJyk7CiAgICAgICAgbXkgJFNlbmRlciAgICAgICAgICAgID0gJFRlbXBsYXRlR2VuZXJhdG9yLT5TZW5kZXIoCiAgICAgICAgICAgIFF1ZXVlSUQgPT4gJE5ld1F1ZXVlSUQsCiAgICAgICAgICAgIFVzZXJJRCAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICk7CgogICAgICAgIG15ICRBcnRpY2xlT2JqZWN0ICAgICAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpUaWNrZXQ6OkFydGljbGUnKTsKICAgICAgICBteSAkQXJ0aWNsZUJhY2tlbmRPYmplY3QgPSAkQXJ0aWNsZU9iamVjdC0+QmFja2VuZEZvckNoYW5uZWwoIENoYW5uZWxOYW1lID0+ICdFbWFpbCcgKTsKCiAgICAgICAgIyBzZW5kIGVtYWlsCiAgICAgICAgbXkgJEFydGljbGVJRCA9ICRBcnRpY2xlQmFja2VuZE9iamVjdC0+QXJ0aWNsZVNlbmQoCiAgICAgICAgICAgIE5vQWdlbnROb3RpZnkgICAgICAgID0+ICROb0FnZW50Tm90aWZ5LAogICAgICAgICAgICBBdHRhY2htZW50ICAgICAgICAgICA9PiBcQEF0dGFjaG1lbnRzLAogICAgICAgICAgICBUaWNrZXRJRCAgICAgICAgICAgICA9PiAkVGlja2V0SUQsCiAgICAgICAgICAgIFNlbmRlclR5cGUgICAgICAgICAgID0+ICRDb25maWctPntTZW5kZXJUeXBlfSwKICAgICAgICAgICAgSXNWaXNpYmxlRm9yQ3VzdG9tZXIgPT4gJENvbmZpZy0+e0lzVmlzaWJsZUZvckN1c3RvbWVyfSwKICAgICAgICAgICAgRnJvbSAgICAgICAgICAgICAgICAgPT4gJFNlbmRlciwKICAgICAgICAgICAgVG8gICAgICAgICAgICAgICAgICAgPT4gJEdldFBhcmFte1RvfSwKICAgICAgICAgICAgQ2MgICAgICAgICAgICAgICAgICAgPT4gJEdldFBhcmFte0NjfSwKICAgICAgICAgICAgQmNjICAgICAgICAgICAgICAgICAgPT4gJEdldFBhcmFte0JjY30sCiAgICAgICAgICAgIFN1YmplY3QgICAgICAgICAgICAgID0+ICRHZXRQYXJhbXtTdWJqZWN0fSwKICAgICAgICAgICAgQm9keSAgICAgICAgICAgICAgICAgPT4gJEdldFBhcmFte0JvZHl9LAogICAgICAgICAgICBDaGFyc2V0ICAgICAgICAgICAgICA9PiAkTGF5b3V0T2JqZWN0LT57VXNlckNoYXJzZXR9LAogICAgICAgICAgICBNaW1lVHlwZSAgICAgICAgICAgICA9PiAkTWltZVR5cGUsCiAgICAgICAgICAgIFVzZXJJRCAgICAgICAgICAgICAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgSGlzdG9yeVR5cGUgICAgICAgICAgPT4gJENvbmZpZy0+e0hpc3RvcnlUeXBlfSwKICAgICAgICAgICAgSGlzdG9yeUNvbW1lbnQgICAgICAgPT4gJENvbmZpZy0+e0hpc3RvcnlDb21tZW50fQogICAgICAgICAgICAgICAgfHwgIlwlXCUkR2V0UGFyYW17VG99LCAkR2V0UGFyYW17Q2N9LCAkR2V0UGFyYW17QmNjfSIsCiAgICAgICAgICAgICVBcnRpY2xlUGFyYW0sCiAgICAgICAgKTsKICAgICAgICBpZiAoICEkQXJ0aWNsZUlEICkgewogICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+RXJyb3JTY3JlZW4oKTsKICAgICAgICB9CgogICAgICAgICMgc2V0IGFydGljbGUgZHluYW1pYyBmaWVsZHMKICAgICAgICAjIGN5Y2xlIHRocm91Z2ggdGhlIGFjdGl2YXRlZCBEeW5hbWljIEZpZWxkcyBmb3IgdGhpcyBzY3JlZW4KICAgICAgICBEWU5BTUlDRklFTEQ6CiAgICAgICAgZm9yIG15ICREeW5hbWljRmllbGRDb25maWcgKCBAeyAkU2VsZi0+e0R5bmFtaWNGaWVsZH0gfSApIHsKICAgICAgICAgICAgbmV4dCBEWU5BTUlDRklFTEQgaWYgIUlzSGFzaFJlZldpdGhEYXRhKCREeW5hbWljRmllbGRDb25maWcpOwogICAgICAgICAgICBuZXh0IERZTkFNSUNGSUVMRCBpZiAkRHluYW1pY0ZpZWxkQ29uZmlnLT57T2JqZWN0VHlwZX0gbmUgJ0FydGljbGUnOwoKICAgICAgICAgICAgIyBzZXQgdGhlIHZhbHVlCiAgICAgICAgICAgIG15ICRTdWNjZXNzID0gJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QtPlZhbHVlU2V0KAogICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRDb25maWcsCiAgICAgICAgICAgICAgICBPYmplY3RJRCAgICAgICAgICAgPT4gJEFydGljbGVJRCwKICAgICAgICAgICAgICAgIFZhbHVlICAgICAgICAgICAgICA9PiAkRHluYW1pY0ZpZWxkVmFsdWVzeyAkRHluYW1pY0ZpZWxkQ29uZmlnLT57TmFtZX0gfSwKICAgICAgICAgICAgICAgIFVzZXJJRCAgICAgICAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIHJlbW92ZSBwcmUtc3VibWl0dGVkIGF0dGFjaG1lbnRzCiAgICAgICAgJFVwbG9hZENhY2hlT2JqZWN0LT5Gb3JtSURSZW1vdmUoIEZvcm1JRCA9PiAkU2VsZi0+e0Zvcm1JRH0gKTsKCiAgICAgICAgIyBsaW5rIHRpY2tldHMKICAgICAgICBpZiAoCiAgICAgICAgICAgICRHZXRQYXJhbXtMaW5rVGlja2V0SUR9CiAgICAgICAgICAgICYmICRDb25maWctPntTcGxpdExpbmtUeXBlfQogICAgICAgICAgICAmJiAkQ29uZmlnLT57U3BsaXRMaW5rVHlwZX0tPntMaW5rVHlwZX0KICAgICAgICAgICAgJiYgJENvbmZpZy0+e1NwbGl0TGlua1R5cGV9LT57RGlyZWN0aW9ufQogICAgICAgICAgICApCiAgICAgICAgewogICAgICAgICAgICBteSAkQWNjZXNzID0gJFRpY2tldE9iamVjdC0+VGlja2V0UGVybWlzc2lvbigKICAgICAgICAgICAgICAgIFR5cGUgICAgID0+ICdybycsCiAgICAgICAgICAgICAgICBUaWNrZXRJRCA9PiAkR2V0UGFyYW17TGlua1RpY2tldElEfSwKICAgICAgICAgICAgICAgIFVzZXJJRCAgID0+ICRTZWxmLT57VXNlcklEfQogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKCAhJEFjY2VzcyApIHsKICAgICAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5Ob1Blcm1pc3Npb24oCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSAgICA9PiAiWW91IG5lZWQgcm8gcGVybWlzc2lvbiEiLAogICAgICAgICAgICAgICAgICAgIFdpdGhIZWFkZXIgPT4gJ3llcycsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICBteSAkU291cmNlS2V5ID0gJEdldFBhcmFte0xpbmtUaWNrZXRJRH07CiAgICAgICAgICAgIG15ICRUYXJnZXRLZXkgPSAkVGlja2V0SUQ7CgogICAgICAgICAgICBpZiAoICRDb25maWctPntTcGxpdExpbmtUeXBlfS0+e0RpcmVjdGlvbn0gZXEgJ1NvdXJjZScgKSB7CiAgICAgICAgICAgICAgICAkU291cmNlS2V5ID0gJFRpY2tldElEOwogICAgICAgICAgICAgICAgJFRhcmdldEtleSA9ICRHZXRQYXJhbXtMaW5rVGlja2V0SUR9OwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGxpbmsgdGhlIHRpY2tldHMKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxpbmtPYmplY3QnKS0+TGlua0FkZCgKICAgICAgICAgICAgICAgIFNvdXJjZU9iamVjdCA9PiAnVGlja2V0JywKICAgICAgICAgICAgICAgIFNvdXJjZUtleSAgICA9PiAkU291cmNlS2V5LAogICAgICAgICAgICAgICAgVGFyZ2V0T2JqZWN0ID0+ICdUaWNrZXQnLAogICAgICAgICAgICAgICAgVGFyZ2V0S2V5ICAgID0+ICRUYXJnZXRLZXksCiAgICAgICAgICAgICAgICBUeXBlICAgICAgICAgPT4gJENvbmZpZy0+e1NwbGl0TGlua1R5cGV9LT57TGlua1R5cGV9IHx8ICdOb3JtYWwnLAogICAgICAgICAgICAgICAgU3RhdGUgICAgICAgID0+ICdWYWxpZCcsCiAgICAgICAgICAgICAgICBVc2VySUQgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBzZXQgb3duZXIgKGlmIG5ldyB1c2VyIGlkIGlzIGdpdmVuKQogICAgICAgIGlmICgkTmV3VXNlcklEKSB7CiAgICAgICAgICAgICRUaWNrZXRPYmplY3QtPlRpY2tldE93bmVyU2V0KAogICAgICAgICAgICAgICAgVGlja2V0SUQgID0+ICRUaWNrZXRJRCwKICAgICAgICAgICAgICAgIE5ld1VzZXJJRCA9PiAkTmV3VXNlcklELAogICAgICAgICAgICAgICAgVXNlcklEICAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgc2V0IGxvY2sKICAgICAgICAgICAgJFRpY2tldE9iamVjdC0+VGlja2V0TG9ja1NldCgKICAgICAgICAgICAgICAgIFRpY2tldElEID0+ICRUaWNrZXRJRCwKICAgICAgICAgICAgICAgIExvY2sgICAgID0+ICdsb2NrJywKICAgICAgICAgICAgICAgIFVzZXJJRCAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgZWxzZSBzZXQgb3duZXIgdG8gY3VycmVudCBhZ2VudCBidXQgZG8gbm90IGxvY2sgaXQKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJFRpY2tldE9iamVjdC0+VGlja2V0T3duZXJTZXQoCiAgICAgICAgICAgICAgICBUaWNrZXRJRCAgICAgICAgICAgPT4gJFRpY2tldElELAogICAgICAgICAgICAgICAgTmV3VXNlcklEICAgICAgICAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgICAgIFNlbmROb05vdGlmaWNhdGlvbiA9PiAxLAogICAgICAgICAgICAgICAgVXNlcklEICAgICAgICAgICAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgc2V0IHJlc3BvbnNpYmxlIChpZiBuZXcgdXNlciBpZCBpcyBnaXZlbikKICAgICAgICBpZiAoJE5ld1Jlc3BvbnNpYmxlSUQpIHsKICAgICAgICAgICAgJFRpY2tldE9iamVjdC0+VGlja2V0UmVzcG9uc2libGVTZXQoCiAgICAgICAgICAgICAgICBUaWNrZXRJRCAgPT4gJFRpY2tldElELAogICAgICAgICAgICAgICAgTmV3VXNlcklEID0+ICROZXdSZXNwb25zaWJsZUlELAogICAgICAgICAgICAgICAgVXNlcklEICAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgdGltZSBhY2NvdW50aW5nCiAgICAgICAgaWYgKCAkR2V0UGFyYW17VGltZVVuaXRzfSApIHsKICAgICAgICAgICAgJFRpY2tldE9iamVjdC0+VGlja2V0QWNjb3VudFRpbWUoCiAgICAgICAgICAgICAgICBUaWNrZXRJRCAgPT4gJFRpY2tldElELAogICAgICAgICAgICAgICAgQXJ0aWNsZUlEID0+ICRBcnRpY2xlSUQsCiAgICAgICAgICAgICAgICBUaW1lVW5pdCAgPT4gJEdldFBhcmFte1RpbWVVbml0c30sCiAgICAgICAgICAgICAgICBVc2VySUQgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBzaG91bGQgaSBzZXQgYW4gdW5sb2NrPwogICAgICAgIGlmICggJFN0YXRlRGF0YXtUeXBlTmFtZX0gPX4gL15jbG9zZS9pICkgewoKICAgICAgICAgICAgIyBzZXQgbG9jawogICAgICAgICAgICAkVGlja2V0T2JqZWN0LT5UaWNrZXRMb2NrU2V0KAogICAgICAgICAgICAgICAgVGlja2V0SUQgPT4gJFRpY2tldElELAogICAgICAgICAgICAgICAgTG9jayAgICAgPT4gJ3VubG9jaycsCiAgICAgICAgICAgICAgICBVc2VySUQgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIHNldCBwZW5kaW5nIHRpbWUKICAgICAgICBlbHNpZiAoICRTdGF0ZURhdGF7VHlwZU5hbWV9ID1+IC9ecGVuZGluZy9pICkgewoKICAgICAgICAgICAgIyBzZXQgcGVuZGluZyB0aW1lCiAgICAgICAgICAgICRUaWNrZXRPYmplY3QtPlRpY2tldFBlbmRpbmdUaW1lU2V0KAogICAgICAgICAgICAgICAgVXNlcklEICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICAgICAgVGlja2V0SUQgPT4gJFRpY2tldElELAogICAgICAgICAgICAgICAgJUdldFBhcmFtLAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBnZXQgcmVkaXJlY3Qgc2NyZWVuCiAgICAgICAgbXkgJE5leHRTY3JlZW4gPSAkU2VsZi0+e1VzZXJDcmVhdGVOZXh0TWFza30gfHwgJ0FnZW50VGlja2V0RW1haWwnOwoKICAgICAgICAjIHJlZGlyZWN0CiAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPlJlZGlyZWN0KAogICAgICAgICAgICBPUCA9PiAiQWN0aW9uPSROZXh0U2NyZWVuO1N1YmFjdGlvbj1DcmVhdGVkO1RpY2tldElEPSRUaWNrZXRJRCIsCiAgICAgICAgKTsKICAgIH0KICAgIGVsc2lmICggJFNlbGYtPntTdWJhY3Rpb259IGVxICdBSkFYVXBkYXRlJyApIHsKICAgICAgICBteSAkRGVzdCAgICAgICAgICAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnRGVzdCcgKSB8fCAnJzsKICAgICAgICBteSAkQ3VzdG9tZXJVc2VyICAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnU2VsZWN0ZWRDdXN0b21lclVzZXInICk7CiAgICAgICAgbXkgJEVsZW1lbnRDaGFuZ2VkID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0VsZW1lbnRDaGFuZ2VkJyApIHx8ICcnOwoKICAgICAgICAjIGdldCBGcm9tIGJhc2VkIG9uIHNlbGVjdGVkIHF1ZXVlCiAgICAgICAgbXkgJFF1ZXVlSUQgPSAnJzsKICAgICAgICBpZiAoICREZXN0ID1+IC9eKFxkezEsMTAwfSlcfFx8Lis/JC8gKSB7CiAgICAgICAgICAgICRRdWV1ZUlEID0gJDE7CiAgICAgICAgICAgIG15ICVRdWV1ZSA9ICRRdWV1ZU9iamVjdC0+R2V0U3lzdGVtQWRkcmVzcyggUXVldWVJRCA9PiAkUXVldWVJRCApOwogICAgICAgICAgICAkR2V0UGFyYW17RnJvbX0gPSAkUXVldWV7RW1haWx9OwogICAgICAgIH0KCiAgICAgICAgIyBnZXQgbGlzdCB0eXBlCiAgICAgICAgbXkgJFRyZWVWaWV3ID0gMDsKICAgICAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpGcm9udGVuZDo6TGlzdFR5cGUnKSBlcSAndHJlZScgKSB7CiAgICAgICAgICAgICRUcmVlVmlldyA9IDE7CiAgICAgICAgfQoKICAgICAgICBteSAkVG9zID0gJFNlbGYtPl9HZXRUb3MoCiAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgJUFDTENvbXBhdEdldFBhcmFtLAogICAgICAgICAgICBDdXN0b21lclVzZXJJRCA9PiAkQ3VzdG9tZXJVc2VyIHx8ICcnLAogICAgICAgICAgICBRdWV1ZUlEICAgICAgICA9PiAkUXVldWVJRCwKICAgICAgICApOwoKICAgICAgICBteSAkTmV3VG9zOwoKICAgICAgICBpZiAoJFRvcykgewogICAgICAgICAgICBUT3M6CiAgICAgICAgICAgIGZvciBteSAkS2V5VG8gKCBzb3J0IGtleXMgJXskVG9zfSApIHsKICAgICAgICAgICAgICAgIG5leHQgVE9zIGlmICggJFRvcy0+eyRLZXlUb30gZXEgJy0nICk7CiAgICAgICAgICAgICAgICAkTmV3VG9zLT57IiRLZXlUb3x8JFRvcy0+eyRLZXlUb30ifSA9ICRUb3MtPnskS2V5VG99OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIG15ICRTaWduYXR1cmUgPSAnJzsKICAgICAgICBpZiAoJFF1ZXVlSUQpIHsKICAgICAgICAgICAgJFNpZ25hdHVyZSA9ICRTZWxmLT5fR2V0U2lnbmF0dXJlKAogICAgICAgICAgICAgICAgUXVldWVJRCAgICAgICAgPT4gJFF1ZXVlSUQsCiAgICAgICAgICAgICAgICBDdXN0b21lclVzZXJJRCA9PiAkQ3VzdG9tZXJVc2VyLAogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBteSAkVXNlcnMgPSAkU2VsZi0+X0dldFVzZXJzKAogICAgICAgICAgICAlR2V0UGFyYW0sCiAgICAgICAgICAgICVBQ0xDb21wYXRHZXRQYXJhbSwKICAgICAgICAgICAgUXVldWVJRCAgPT4gJFF1ZXVlSUQsCiAgICAgICAgICAgIEFsbFVzZXJzID0+ICRHZXRQYXJhbXtPd25lckFsbH0sCiAgICAgICAgKTsKICAgICAgICBteSAkUmVzcG9uc2libGVVc2VycyA9ICRTZWxmLT5fR2V0UmVzcG9uc2libGVzKAogICAgICAgICAgICAlR2V0UGFyYW0sCiAgICAgICAgICAgICVBQ0xDb21wYXRHZXRQYXJhbSwKICAgICAgICAgICAgUXVldWVJRCAgPT4gJFF1ZXVlSUQsCiAgICAgICAgICAgIEFsbFVzZXJzID0+ICRHZXRQYXJhbXtSZXNwb25zaWJsZUFsbH0sCiAgICAgICAgKTsKICAgICAgICBteSAkTmV4dFN0YXRlcyA9ICRTZWxmLT5fR2V0TmV4dFN0YXRlcygKICAgICAgICAgICAgJUdldFBhcmFtLAogICAgICAgICAgICAlQUNMQ29tcGF0R2V0UGFyYW0sCiAgICAgICAgICAgIEN1c3RvbWVyVXNlcklEID0+ICRDdXN0b21lclVzZXIgfHwgJycsCiAgICAgICAgICAgIFF1ZXVlSUQgICAgICAgID0+ICRRdWV1ZUlEICAgICAgfHwgMSwKICAgICAgICApOwogICAgICAgIG15ICRQcmlvcml0aWVzID0gJFNlbGYtPl9HZXRQcmlvcml0aWVzKAogICAgICAgICAgICAlR2V0UGFyYW0sCiAgICAgICAgICAgICVBQ0xDb21wYXRHZXRQYXJhbSwKICAgICAgICAgICAgQ3VzdG9tZXJVc2VySUQgPT4gJEN1c3RvbWVyVXNlciB8fCAnJywKICAgICAgICAgICAgUXVldWVJRCAgICAgICAgPT4gJFF1ZXVlSUQgICAgICB8fCAxLAogICAgICAgICk7CiAgICAgICAgbXkgJFNlcnZpY2VzID0gJFNlbGYtPl9HZXRTZXJ2aWNlcygKICAgICAgICAgICAgJUdldFBhcmFtLAogICAgICAgICAgICAlQUNMQ29tcGF0R2V0UGFyYW0sCiAgICAgICAgICAgIEN1c3RvbWVyVXNlcklEID0+ICRDdXN0b21lclVzZXIgfHwgJycsCiAgICAgICAgICAgIFF1ZXVlSUQgICAgICAgID0+ICRRdWV1ZUlEICAgICAgfHwgMSwKICAgICAgICApOwogICAgICAgIG15ICRTTEFzID0gJFNlbGYtPl9HZXRTTEFzKAogICAgICAgICAgICAlR2V0UGFyYW0sCiAgICAgICAgICAgICVBQ0xDb21wYXRHZXRQYXJhbSwKICAgICAgICAgICAgQ3VzdG9tZXJVc2VySUQgPT4gJEN1c3RvbWVyVXNlciB8fCAnJywKICAgICAgICAgICAgUXVldWVJRCAgICAgICAgPT4gJFF1ZXVlSUQgICAgICB8fCAxLAogICAgICAgICAgICBTZXJ2aWNlcyAgICAgICA9PiAkU2VydmljZXMsCiAgICAgICAgKTsKICAgICAgICBteSAkU3RhbmRhcmRUZW1wbGF0ZXMgPSAkU2VsZi0+X0dldFN0YW5kYXJkVGVtcGxhdGVzKAogICAgICAgICAgICAlR2V0UGFyYW0sCiAgICAgICAgICAgICVBQ0xDb21wYXRHZXRQYXJhbSwKICAgICAgICAgICAgUXVldWVJRCA9PiAkUXVldWVJRCB8fCAnJywKICAgICAgICApOwogICAgICAgIG15ICRUeXBlcyA9ICRTZWxmLT5fR2V0VHlwZXMoCiAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgJUFDTENvbXBhdEdldFBhcmFtLAogICAgICAgICAgICBDdXN0b21lclVzZXJJRCA9PiAkQ3VzdG9tZXJVc2VyIHx8ICcnLAogICAgICAgICAgICBRdWV1ZUlEICAgICAgICA9PiAkUXVldWVJRCAgICAgIHx8IDEsCiAgICAgICAgKTsKCiAgICAgICAgIyB1cGRhdGUgRHluYW1pYyBGaWVsZHMgUG9zc2libGUgVmFsdWVzIHZpYSBBSkFYCiAgICAgICAgbXkgQER5bmFtaWNGaWVsZEFKQVg7CgogICAgICAgICMgY3ljbGUgdGhyb3VnaCB0aGUgYWN0aXZhdGVkIER5bmFtaWMgRmllbGRzIGZvciB0aGlzIHNjcmVlbgogICAgICAgIERZTkFNSUNGSUVMRDoKICAgICAgICBmb3IgbXkgJER5bmFtaWNGaWVsZENvbmZpZyAoIEB7ICRTZWxmLT57RHluYW1pY0ZpZWxkfSB9ICkgewogICAgICAgICAgICBuZXh0IERZTkFNSUNGSUVMRCBpZiAhSXNIYXNoUmVmV2l0aERhdGEoJER5bmFtaWNGaWVsZENvbmZpZyk7CgogICAgICAgICAgICBteSAkSXNBQ0xSZWR1Y2libGUgPSAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdC0+SGFzQmVoYXZpb3IoCiAgICAgICAgICAgICAgICBEeW5hbWljRmllbGRDb25maWcgPT4gJER5bmFtaWNGaWVsZENvbmZpZywKICAgICAgICAgICAgICAgIEJlaGF2aW9yICAgICAgICAgICA9PiAnSXNBQ0xSZWR1Y2libGUnLAogICAgICAgICAgICApOwogICAgICAgICAgICBuZXh0IERZTkFNSUNGSUVMRCBpZiAhJElzQUNMUmVkdWNpYmxlOwoKICAgICAgICAgICAgbXkgJFBvc3NpYmxlVmFsdWVzID0gJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QtPlBvc3NpYmxlVmFsdWVzR2V0KAogICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRDb25maWcsCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAjIGNvbnZlcnQgcG9zc2libGUgdmFsdWVzIGtleSA9PiB2YWx1ZSB0byBrZXkgPT4ga2V5IGZvciBBQ0xzIHVzaW5nIGEgSGFzaCBzbGljZQogICAgICAgICAgICBteSAlQWNsRGF0YSA9ICV7JFBvc3NpYmxlVmFsdWVzfTsKICAgICAgICAgICAgQEFjbERhdGF7IGtleXMgJUFjbERhdGEgfSA9IGtleXMgJUFjbERhdGE7CgogICAgICAgICAgICAjIHNldCBwb3NzaWJsZSB2YWx1ZXMgZmlsdGVyIGZyb20gQUNMcwogICAgICAgICAgICBteSAkQUNMID0gJFRpY2tldE9iamVjdC0+VGlja2V0QWNsKAogICAgICAgICAgICAgICAgJUdldFBhcmFtLAogICAgICAgICAgICAgICAgJUFDTENvbXBhdEdldFBhcmFtLAogICAgICAgICAgICAgICAgQ3VzdG9tZXJVc2VySUQgPT4gJEN1c3RvbWVyVXNlciB8fCAnJywKICAgICAgICAgICAgICAgIEFjdGlvbiAgICAgICAgID0+ICRTZWxmLT57QWN0aW9ufSwKICAgICAgICAgICAgICAgIFRpY2tldElEICAgICAgID0+ICRTZWxmLT57VGlja2V0SUR9LAogICAgICAgICAgICAgICAgUXVldWVJRCAgICAgICAgPT4gJFF1ZXVlSUQgfHwgMCwKICAgICAgICAgICAgICAgIFJldHVyblR5cGUgICAgID0+ICdUaWNrZXQnLAogICAgICAgICAgICAgICAgUmV0dXJuU3ViVHlwZSAgPT4gJ0R5bmFtaWNGaWVsZF8nIC4gJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9LAogICAgICAgICAgICAgICAgRGF0YSAgICAgICAgICAgPT4gXCVBY2xEYXRhLAogICAgICAgICAgICAgICAgVXNlcklEICAgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICApOwogICAgICAgICAgICBpZiAoJEFDTCkgewogICAgICAgICAgICAgICAgbXkgJUZpbHRlciA9ICRUaWNrZXRPYmplY3QtPlRpY2tldEFjbERhdGEoKTsKCiAgICAgICAgICAgICAgICAjIGNvbnZlcnQgRmlsZXIga2V5ID0+IGtleSBiYWNrIHRvIGtleSA9PiB2YWx1ZSB1c2luZyBtYXAKICAgICAgICAgICAgICAgICV7JFBvc3NpYmxlVmFsdWVzfSA9IG1hcCB7ICRfID0+ICRQb3NzaWJsZVZhbHVlcy0+eyRffSB9IGtleXMgJUZpbHRlcjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbXkgJERhdGFWYWx1ZXMgPSAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdC0+QnVpbGRTZWxlY3Rpb25EYXRhR2V0KAogICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRDb25maWcsCiAgICAgICAgICAgICAgICBQb3NzaWJsZVZhbHVlcyAgICAgPT4gJFBvc3NpYmxlVmFsdWVzLAogICAgICAgICAgICAgICAgVmFsdWUgICAgICAgICAgICAgID0+ICREeW5hbWljRmllbGRWYWx1ZXN7ICREeW5hbWljRmllbGRDb25maWctPntOYW1lfSB9LAogICAgICAgICAgICApIHx8ICRQb3NzaWJsZVZhbHVlczsKCiAgICAgICAgICAgICMgYWRkIGR5bmFtaWMgZmllbGQgdG8gdGhlIGxpc3Qgb2YgZmllbGRzIHRvIHVwZGF0ZQogICAgICAgICAgICBwdXNoKAogICAgICAgICAgICAgICAgQER5bmFtaWNGaWVsZEFKQVgsCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgTmFtZSAgICAgICAgPT4gJ0R5bmFtaWNGaWVsZF8nIC4gJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9LAogICAgICAgICAgICAgICAgICAgIERhdGEgICAgICAgID0+ICREYXRhVmFsdWVzLAogICAgICAgICAgICAgICAgICAgIFNlbGVjdGVkSUQgID0+ICREeW5hbWljRmllbGRWYWx1ZXN7ICREeW5hbWljRmllbGRDb25maWctPntOYW1lfSB9LAogICAgICAgICAgICAgICAgICAgIFRyYW5zbGF0aW9uID0+ICREeW5hbWljRmllbGRDb25maWctPntDb25maWd9LT57VHJhbnNsYXRhYmxlVmFsdWVzfSB8fCAwLAogICAgICAgICAgICAgICAgICAgIE1heCAgICAgICAgID0+IDEwMCwKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIG15IEBUZW1wbGF0ZUFKQVg7CgogICAgICAgICMgdXBkYXRlIHRpY2tldCBib2R5IGFuZCBhdHRhY2hlbWVudHMgaWYgbmVlZGVkLgogICAgICAgIGlmICggJEVsZW1lbnRDaGFuZ2VkIGVxICdTdGFuZGFyZFRlbXBsYXRlSUQnICkgewogICAgICAgICAgICBteSBAVGlja2V0QXR0YWNobWVudHM7CiAgICAgICAgICAgIG15ICRUZW1wbGF0ZVRleHQ7CgogICAgICAgICAgICAjIHJlbW92ZSBhbGwgYXR0YWNobWVudHMgZnJvbSB0aGUgVXBsb2FkIGNhY2hlCiAgICAgICAgICAgIG15ICRSZW1vdmVTdWNjZXNzID0gJFVwbG9hZENhY2hlT2JqZWN0LT5Gb3JtSURSZW1vdmUoCiAgICAgICAgICAgICAgICBGb3JtSUQgPT4gJFNlbGYtPntGb3JtSUR9LAogICAgICAgICAgICApOwogICAgICAgICAgICBpZiAoICEkUmVtb3ZlU3VjY2VzcyApIHsKICAgICAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIkZvcm0gYXR0YWNobWVudHMgY291bGQgbm90IGJlIGRlbGV0ZWQhIiwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgZ2V0IHRoZSB0ZW1wbGF0ZSB0ZXh0IGFuZCBzZXQgbmV3IGF0dGFjaG1lbnRzIGlmIGEgdGVtcGxhdGUgaXMgc2VsZWN0ZWQKICAgICAgICAgICAgaWYgKCBJc1Bvc2l0aXZlSW50ZWdlciggJEdldFBhcmFte1N0YW5kYXJkVGVtcGxhdGVJRH0gKSApIHsKICAgICAgICAgICAgICAgIG15ICRUZW1wbGF0ZUdlbmVyYXRvciA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpUZW1wbGF0ZUdlbmVyYXRvcicpOwoKICAgICAgICAgICAgICAgICMgc2V0IHRlbXBsYXRlIHRleHQsIHJlcGxhY2Ugc21hcnQgdGFncyAobGltaXRlZCBhcyB0aWNrZXQgaXMgbm90IGNyZWF0ZWQpCiAgICAgICAgICAgICAgICAkVGVtcGxhdGVUZXh0ID0gJFRlbXBsYXRlR2VuZXJhdG9yLT5UZW1wbGF0ZSgKICAgICAgICAgICAgICAgICAgICBUZW1wbGF0ZUlEICAgICA9PiAkR2V0UGFyYW17U3RhbmRhcmRUZW1wbGF0ZUlEfSwKICAgICAgICAgICAgICAgICAgICBVc2VySUQgICAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJVc2VySUQgPT4gJEN1c3RvbWVyVXNlciwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgIyBjcmVhdGUgU3RkQXR0YWNobWVudE9iamVjdAogICAgICAgICAgICAgICAgbXkgJFN0ZEF0dGFjaG1lbnRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6U3RkQXR0YWNobWVudCcpOwoKICAgICAgICAgICAgICAgICMgYWRkIHN0ZC4gYXR0YWNobWVudHMgdG8gdGlja2V0CiAgICAgICAgICAgICAgICBteSAlQWxsU3RkQXR0YWNobWVudHMgPSAkU3RkQXR0YWNobWVudE9iamVjdC0+U3RkQXR0YWNobWVudFN0YW5kYXJkVGVtcGxhdGVNZW1iZXJMaXN0KAogICAgICAgICAgICAgICAgICAgIFN0YW5kYXJkVGVtcGxhdGVJRCA9PiAkR2V0UGFyYW17U3RhbmRhcmRUZW1wbGF0ZUlEfSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBmb3IgbXkgJElEICggc29ydCBrZXlzICVBbGxTdGRBdHRhY2htZW50cyApIHsKICAgICAgICAgICAgICAgICAgICBteSAlQXR0YWNobWVudHNEYXRhID0gJFN0ZEF0dGFjaG1lbnRPYmplY3QtPlN0ZEF0dGFjaG1lbnRHZXQoIElEID0+ICRJRCApOwogICAgICAgICAgICAgICAgICAgICRVcGxvYWRDYWNoZU9iamVjdC0+Rm9ybUlEQWRkRmlsZSgKICAgICAgICAgICAgICAgICAgICAgICAgRm9ybUlEICAgICAgPT4gJFNlbGYtPntGb3JtSUR9LAogICAgICAgICAgICAgICAgICAgICAgICBEaXNwb3NpdGlvbiA9PiAnYXR0YWNobWVudCcsCiAgICAgICAgICAgICAgICAgICAgICAgICVBdHRhY2htZW50c0RhdGEsCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIHNlbmQgYSBsaXN0IG9mIGF0dGFjaG1lbnRzIGluIHRoZSB1cGxvYWQgY2FjaGUgYmFjayB0byB0aGUgY2xpZW50c2lkZSBKYXZhU2NyaXB0CiAgICAgICAgICAgICAgICAjIHdoaWNoIHJlbmRlcnMgdGhlbiB0aGUgbGlzdCBvZiBjdXJyZW50bHkgdXBsb2FkZWQgYXR0YWNobWVudHMKICAgICAgICAgICAgICAgIEBUaWNrZXRBdHRhY2htZW50cyA9ICRVcGxvYWRDYWNoZU9iamVjdC0+Rm9ybUlER2V0QWxsRmlsZXNNZXRhKAogICAgICAgICAgICAgICAgICAgIEZvcm1JRCA9PiAkU2VsZi0+e0Zvcm1JRH0sCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgIGZvciBteSAkQXR0YWNobWVudCAoQFRpY2tldEF0dGFjaG1lbnRzKSB7CiAgICAgICAgICAgICAgICAgICAgJEF0dGFjaG1lbnQtPntGaWxlc2l6ZX0gPSAkTGF5b3V0T2JqZWN0LT5IdW1hblJlYWRhYmxlRGF0YVNpemUoCiAgICAgICAgICAgICAgICAgICAgICAgIFNpemUgPT4gJEF0dGFjaG1lbnQtPntGaWxlc2l6ZX0sCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgQFRlbXBsYXRlQUpBWCA9ICgKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICdVc2VUZW1wbGF0ZUNyZWF0ZScsCiAgICAgICAgICAgICAgICAgICAgRGF0YSA9PiAnMCcsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gJ1JpY2hUZXh0JywKICAgICAgICAgICAgICAgICAgICBEYXRhID0+ICRUZW1wbGF0ZVRleHQgfHwgJycsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIE5hbWUgICAgID0+ICdUaWNrZXRBdHRhY2htZW50cycsCiAgICAgICAgICAgICAgICAgICAgRGF0YSAgICAgPT4gXEBUaWNrZXRBdHRhY2htZW50cywKICAgICAgICAgICAgICAgICAgICBLZWVwRGF0YSA9PiAxLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIG15IEBFeHRlbmRlZERhdGE7CgogICAgICAgICMgcnVuIGNvbXBvc2UgbW9kdWxlcwogICAgICAgIGlmICggcmVmICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpGcm9udGVuZDo6QXJ0aWNsZUNvbXBvc2VNb2R1bGUnKSBlcSAnSEFTSCcgKSB7CgogICAgICAgICAgICAjIHVzZSBRdWV1ZUlEIGZyb20gd2ViIHJlcXVlc3QgaW4gY29tcG9zZSBtb2R1bGVzCiAgICAgICAgICAgICRHZXRQYXJhbXtRdWV1ZUlEfSA9ICRRdWV1ZUlEOwoKICAgICAgICAgICAgbXkgJUpvYnMgPSAleyAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6OkFydGljbGVDb21wb3NlTW9kdWxlJykgfTsKICAgICAgICAgICAgSk9COgogICAgICAgICAgICBmb3IgbXkgJEpvYiAoIHNvcnQga2V5cyAlSm9icyApIHsKCiAgICAgICAgICAgICAgICAjIGxvYWQgbW9kdWxlCiAgICAgICAgICAgICAgICBuZXh0IEpPQiBpZiAhJE1haW5PYmplY3QtPlJlcXVpcmUoICRKb2JzeyRKb2J9LT57TW9kdWxlfSApOwoKICAgICAgICAgICAgICAgIG15ICRPYmplY3QgPSAkSm9ic3skSm9ifS0+e01vZHVsZX0tPm5ldygKICAgICAgICAgICAgICAgICAgICAleyRTZWxmfSwKICAgICAgICAgICAgICAgICAgICBEZWJ1ZyA9PiAkRGVidWcsCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgIG15ICRNdWx0aXBsZTsKCiAgICAgICAgICAgICAgICAjIGdldCBwYXJhbXMKICAgICAgICAgICAgICAgIFBBUkFNRVRFUjoKICAgICAgICAgICAgICAgIGZvciBteSAkUGFyYW1ldGVyICggJE9iamVjdC0+T3B0aW9uKCAlR2V0UGFyYW0sIENvbmZpZyA9PiAkSm9ic3skSm9ifSApICkgewoKICAgICAgICAgICAgICAgICAgICBpZiAoICRKb2JzeyRKb2J9LT57UGFyYW1UeXBlfSAmJiAkSm9ic3skSm9ifS0+e1BhcmFtVHlwZX0gbmUgJ1NpbmdsZScgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIEB7ICRHZXRQYXJhbXskUGFyYW1ldGVyfSB9ID0gJFBhcmFtT2JqZWN0LT5HZXRBcnJheSggUGFyYW0gPT4gJFBhcmFtZXRlciApOwogICAgICAgICAgICAgICAgICAgICAgICAkTXVsdGlwbGUgPSAxOwogICAgICAgICAgICAgICAgICAgICAgICBuZXh0IFBBUkFNRVRFUjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICRHZXRQYXJhbXskUGFyYW1ldGVyfSA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICRQYXJhbWV0ZXIgKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIHJ1biBtb2R1bGUKICAgICAgICAgICAgICAgIG15ICVEYXRhID0gJE9iamVjdC0+RGF0YSggJUdldFBhcmFtLCBDb25maWcgPT4gJEpvYnN7JEpvYn0gKTsKCiAgICAgICAgICAgICAgICAjIGdldCBBSkFYIHBhcmFtIHZhbHVlcwogICAgICAgICAgICAgICAgaWYgKCAkT2JqZWN0LT5jYW4oJ0dldFBhcmFtQUpBWCcpICkgewogICAgICAgICAgICAgICAgICAgICVHZXRQYXJhbSA9ICggJUdldFBhcmFtLCAkT2JqZWN0LT5HZXRQYXJhbUFKQVgoJUdldFBhcmFtKSApOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgZ2V0IG9wdGlvbnMgdGhhdCBoYXZlIHRvIGJlIHJlbW92ZWQgZnJvbSB0aGUgc2VsZWN0aW9uIHZpc2libGUKICAgICAgICAgICAgICAgICMgdG8gdGhlIGFnZW50LiBUaGVzZSBvcHRpb25zIHdpbGwgYmUgYWRkZWQgYWdhaW4gb24gc3VibWl0LgogICAgICAgICAgICAgICAgaWYgKCAkT2JqZWN0LT5jYW4oJ0dldE9wdGlvbnNUb1JlbW92ZUFKQVgnKSApIHsKICAgICAgICAgICAgICAgICAgICBteSBAT3B0aW9uc1RvUmVtb3ZlID0gJE9iamVjdC0+R2V0T3B0aW9uc1RvUmVtb3ZlQUpBWCglR2V0UGFyYW0pOwoKICAgICAgICAgICAgICAgICAgICBmb3IgbXkgJE9wdGlvblRvUmVtb3ZlIChAT3B0aW9uc1RvUmVtb3ZlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSAkRGF0YXskT3B0aW9uVG9SZW1vdmV9OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBteSAkS2V5ID0gJE9iamVjdC0+T3B0aW9uKCAlR2V0UGFyYW0sIENvbmZpZyA9PiAkSm9ic3skSm9ifSApOwoKICAgICAgICAgICAgICAgIGlmICgkS2V5KSB7CiAgICAgICAgICAgICAgICAgICAgcHVzaCgKICAgICAgICAgICAgICAgICAgICAgICAgQEV4dGVuZGVkRGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSAgICAgICAgID0+ICRLZXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEYXRhICAgICAgICAgPT4gXCVEYXRhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VsZWN0ZWRJRCAgID0+ICRHZXRQYXJhbXskS2V5fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRyYW5zbGF0aW9uICA9PiAxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zc2libGVOb25lID0+IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNdWx0aXBsZSAgICAgPT4gJE11bHRpcGxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF4ICAgICAgICAgID0+IDEwMCwKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgY29udmVydCBTaWduYXR1cmUgdG8gQVNDSUksIGlmIFJpY2hUZXh0IGlzIG9uCiAgICAgICAgaWYgKCAkTGF5b3V0T2JqZWN0LT57QnJvd3NlclJpY2hUZXh0fSApIHsKCiAgICAgICAgICAgICMgICAgICAgICAgICAkU2lnbmF0dXJlID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkhUTUxVdGlscycpLT5Ub0FzY2lpKCBTdHJpbmcgPT4gJFNpZ25hdHVyZSwgKTsKICAgICAgICB9CgogICAgICAgIG15ICRKU09OID0gJExheW91dE9iamVjdC0+QnVpbGRTZWxlY3Rpb25KU09OKAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgTmFtZSAgICAgICAgID0+ICdEZXN0JywKICAgICAgICAgICAgICAgICAgICBEYXRhICAgICAgICAgPT4gJE5ld1RvcywKICAgICAgICAgICAgICAgICAgICBTZWxlY3RlZElEICAgPT4gJERlc3QsCiAgICAgICAgICAgICAgICAgICAgVHJhbnNsYXRpb24gID0+IDAsCiAgICAgICAgICAgICAgICAgICAgUG9zc2libGVOb25lID0+IDEsCiAgICAgICAgICAgICAgICAgICAgVHJlZVZpZXcgICAgID0+ICRUcmVlVmlldywKICAgICAgICAgICAgICAgICAgICBNYXggICAgICAgICAgPT4gMTAwLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBOYW1lICAgICAgICAgPT4gJ1NpZ25hdHVyZScsCiAgICAgICAgICAgICAgICAgICAgRGF0YSAgICAgICAgID0+ICRTaWduYXR1cmUsCiAgICAgICAgICAgICAgICAgICAgVHJhbnNsYXRpb24gID0+IDEsCiAgICAgICAgICAgICAgICAgICAgUG9zc2libGVOb25lID0+IDEsCiAgICAgICAgICAgICAgICAgICAgTWF4ICAgICAgICAgID0+IDEwMCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgTmFtZSAgICAgICAgID0+ICdOZXdVc2VySUQnLAogICAgICAgICAgICAgICAgICAgIERhdGEgICAgICAgICA9PiAkVXNlcnMsCiAgICAgICAgICAgICAgICAgICAgU2VsZWN0ZWRJRCAgID0+ICRHZXRQYXJhbXtOZXdVc2VySUR9LAogICAgICAgICAgICAgICAgICAgIFRyYW5zbGF0aW9uICA9PiAwLAogICAgICAgICAgICAgICAgICAgIFBvc3NpYmxlTm9uZSA9PiAxLAogICAgICAgICAgICAgICAgICAgIE1heCAgICAgICAgICA9PiAxMDAsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIE5hbWUgICAgICAgICA9PiAnTmV3UmVzcG9uc2libGVJRCcsCiAgICAgICAgICAgICAgICAgICAgRGF0YSAgICAgICAgID0+ICRSZXNwb25zaWJsZVVzZXJzLAogICAgICAgICAgICAgICAgICAgIFNlbGVjdGVkSUQgICA9PiAkR2V0UGFyYW17TmV3UmVzcG9uc2libGVJRH0sCiAgICAgICAgICAgICAgICAgICAgVHJhbnNsYXRpb24gID0+IDAsCiAgICAgICAgICAgICAgICAgICAgUG9zc2libGVOb25lID0+IDEsCiAgICAgICAgICAgICAgICAgICAgTWF4ICAgICAgICAgID0+IDEwMCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgTmFtZSAgICAgICAgPT4gJ05leHRTdGF0ZUlEJywKICAgICAgICAgICAgICAgICAgICBEYXRhICAgICAgICA9PiAkTmV4dFN0YXRlcywKICAgICAgICAgICAgICAgICAgICBTZWxlY3RlZElEICA9PiAkR2V0UGFyYW17TmV4dFN0YXRlSUR9LAogICAgICAgICAgICAgICAgICAgIFRyYW5zbGF0aW9uID0+IDEsCiAgICAgICAgICAgICAgICAgICAgTWF4ICAgICAgICAgPT4gMTAwLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBOYW1lICAgICAgICA9PiAnUHJpb3JpdHlJRCcsCiAgICAgICAgICAgICAgICAgICAgRGF0YSAgICAgICAgPT4gJFByaW9yaXRpZXMsCiAgICAgICAgICAgICAgICAgICAgU2VsZWN0ZWRJRCAgPT4gJEdldFBhcmFte1ByaW9yaXR5SUR9LAogICAgICAgICAgICAgICAgICAgIFRyYW5zbGF0aW9uID0+IDEsCiAgICAgICAgICAgICAgICAgICAgTWF4ICAgICAgICAgPT4gMTAwLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBOYW1lICAgICAgICAgPT4gJ1NlcnZpY2VJRCcsCiAgICAgICAgICAgICAgICAgICAgRGF0YSAgICAgICAgID0+ICRTZXJ2aWNlcywKICAgICAgICAgICAgICAgICAgICBTZWxlY3RlZElEICAgPT4gJEdldFBhcmFte1NlcnZpY2VJRH0sCiAgICAgICAgICAgICAgICAgICAgUG9zc2libGVOb25lID0+IDEsCiAgICAgICAgICAgICAgICAgICAgVHJhbnNsYXRpb24gID0+IDAsCiAgICAgICAgICAgICAgICAgICAgVHJlZVZpZXcgICAgID0+ICRUcmVlVmlldywKICAgICAgICAgICAgICAgICAgICBNYXggICAgICAgICAgPT4gMTAwLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBOYW1lICAgICAgICAgPT4gJ1NMQUlEJywKICAgICAgICAgICAgICAgICAgICBEYXRhICAgICAgICAgPT4gJFNMQXMsCiAgICAgICAgICAgICAgICAgICAgU2VsZWN0ZWRJRCAgID0+ICRHZXRQYXJhbXtTTEFJRH0sCiAgICAgICAgICAgICAgICAgICAgUG9zc2libGVOb25lID0+IDEsCiAgICAgICAgICAgICAgICAgICAgVHJhbnNsYXRpb24gID0+IDAsCiAgICAgICAgICAgICAgICAgICAgTWF4ICAgICAgICAgID0+IDEwMCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgTmFtZSAgICAgICAgID0+ICdTdGFuZGFyZFRlbXBsYXRlSUQnLAogICAgICAgICAgICAgICAgICAgIERhdGEgICAgICAgICA9PiAkU3RhbmRhcmRUZW1wbGF0ZXMsCiAgICAgICAgICAgICAgICAgICAgU2VsZWN0ZWRJRCAgID0+ICRHZXRQYXJhbXtTdGFuZGFyZFRlbXBsYXRlSUR9LAogICAgICAgICAgICAgICAgICAgIFBvc3NpYmxlTm9uZSA9PiAxLAogICAgICAgICAgICAgICAgICAgIFRyYW5zbGF0aW9uICA9PiAxLAogICAgICAgICAgICAgICAgICAgIE1heCAgICAgICAgICA9PiAxMDAsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIE5hbWUgICAgICAgICA9PiAnVHlwZUlEJywKICAgICAgICAgICAgICAgICAgICBEYXRhICAgICAgICAgPT4gJFR5cGVzLAogICAgICAgICAgICAgICAgICAgIFNlbGVjdGVkSUQgICA9PiAkR2V0UGFyYW17VHlwZUlEfSwKICAgICAgICAgICAgICAgICAgICBQb3NzaWJsZU5vbmUgPT4gMSwKICAgICAgICAgICAgICAgICAgICBUcmFuc2xhdGlvbiAgPT4gMCwKICAgICAgICAgICAgICAgICAgICBNYXggICAgICAgICAgPT4gMTAwLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIEBEeW5hbWljRmllbGRBSkFYLAogICAgICAgICAgICAgICAgQFRlbXBsYXRlQUpBWCwKICAgICAgICAgICAgICAgIEBFeHRlbmRlZERhdGEsCiAgICAgICAgICAgIF0sCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+QXR0YWNobWVudCgKICAgICAgICAgICAgQ29udGVudFR5cGUgPT4gJ2FwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9JyAuICRMYXlvdXRPYmplY3QtPntDaGFyc2V0fSwKICAgICAgICAgICAgQ29udGVudCAgICAgPT4gJEpTT04sCiAgICAgICAgICAgIFR5cGUgICAgICAgID0+ICdpbmxpbmUnLAogICAgICAgICAgICBOb0NhY2hlICAgICA9PiAxLAogICAgICAgICk7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+RXJyb3JTY3JlZW4oCiAgICAgICAgICAgIE1lc3NhZ2UgPT4gVHJhbnNsYXRhYmxlKCdObyBTdWJhY3Rpb24hJyksCiAgICAgICAgICAgIENvbW1lbnQgPT4gVHJhbnNsYXRhYmxlKCdQbGVhc2UgY29udGFjdCB0aGUgYWRtaW5pc3RyYXRvci4nKSwKICAgICAgICApOwogICAgfQp9CgpzdWIgX0dldE5leHRTdGF0ZXMgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAlTmV4dFN0YXRlczsKICAgIGlmICggJFBhcmFte1F1ZXVlSUR9IHx8ICRQYXJhbXtUaWNrZXRJRH0gKSB7CiAgICAgICAgJU5leHRTdGF0ZXMgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGlja2V0JyktPlRpY2tldFN0YXRlTGlzdCgKICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICBBY3Rpb24gPT4gJFNlbGYtPntBY3Rpb259LAogICAgICAgICAgICBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICk7CiAgICB9CiAgICByZXR1cm4gXCVOZXh0U3RhdGVzOwp9CgpzdWIgX0dldFVzZXJzIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBnZXQgdXNlcnMKICAgIG15ICVTaG93blVzZXJzOwogICAgbXkgJUFsbEdyb3Vwc01lbWJlcnMgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VXNlcicpLT5Vc2VyTGlzdCgKICAgICAgICBUeXBlICA9PiAnTG9uZycsCiAgICAgICAgVmFsaWQgPT4gMSwKICAgICk7CgogICAgIyBnZXQgdGlja2V0IG9iamVjdAogICAgbXkgJFRpY2tldE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpUaWNrZXQnKTsKCiAgICAjIGp1c3Qgc2hvdyBvbmx5IHVzZXJzIHdpdGggc2VsZWN0ZWQgY3VzdG9tIHF1ZXVlCiAgICBpZiAoICRQYXJhbXtRdWV1ZUlEfSAmJiAhJFBhcmFte0FsbFVzZXJzfSApIHsKICAgICAgICBteSBAVXNlcklEcyA9ICRUaWNrZXRPYmplY3QtPkdldFN1YnNjcmliZWRVc2VySURzQnlRdWV1ZUlEKCVQYXJhbSk7CiAgICAgICAgZm9yIG15ICRHcm91cE1lbWJlcktleSAoIHNvcnQga2V5cyAlQWxsR3JvdXBzTWVtYmVycyApIHsKICAgICAgICAgICAgbXkgJEhpdCA9IDA7CiAgICAgICAgICAgIGZvciBteSAkVUlEIChAVXNlcklEcykgewogICAgICAgICAgICAgICAgaWYgKCAkVUlEIGVxICRHcm91cE1lbWJlcktleSApIHsKICAgICAgICAgICAgICAgICAgICAkSGl0ID0gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoICEkSGl0ICkgewogICAgICAgICAgICAgICAgZGVsZXRlICRBbGxHcm91cHNNZW1iZXJzeyRHcm91cE1lbWJlcktleX07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgIyBjaGVjayBzaG93IHVzZXJzCiAgICBpZiAoICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnVGlja2V0OjpDaGFuZ2VPd25lclRvRXZlcnlvbmUnKSApIHsKICAgICAgICAlU2hvd25Vc2VycyA9ICVBbGxHcm91cHNNZW1iZXJzOwogICAgfQoKICAgICMgc2hvdyBhbGwgdXNlcnMgd2hvIGFyZSBvd25lciBvciBydyBpbiB0aGUgcXVldWUgZ3JvdXAKICAgIGVsc2lmICggJFBhcmFte1F1ZXVlSUR9ICkgewogICAgICAgIG15ICRHSUQgICAgICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlF1ZXVlJyktPkdldFF1ZXVlR3JvdXBJRCggUXVldWVJRCA9PiAkUGFyYW17UXVldWVJRH0gKTsKICAgICAgICBteSAlTWVtYmVyTGlzdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpHcm91cCcpLT5QZXJtaXNzaW9uR3JvdXBHZXQoCiAgICAgICAgICAgIEdyb3VwSUQgPT4gJEdJRCwKICAgICAgICAgICAgVHlwZSAgICA9PiAnb3duZXInLAogICAgICAgICk7CiAgICAgICAgZm9yIG15ICRNZW1iZXJLZXkgKCBzb3J0IGtleXMgJU1lbWJlckxpc3QgKSB7CiAgICAgICAgICAgIGlmICggJEFsbEdyb3Vwc01lbWJlcnN7JE1lbWJlcktleX0gKSB7CiAgICAgICAgICAgICAgICAkU2hvd25Vc2Vyc3skTWVtYmVyS2V5fSA9ICRBbGxHcm91cHNNZW1iZXJzeyRNZW1iZXJLZXl9OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgICMgd29ya2Zsb3cKICAgIG15ICRBQ0wgPSAkVGlja2V0T2JqZWN0LT5UaWNrZXRBY2woCiAgICAgICAgJVBhcmFtLAogICAgICAgIEFjdGlvbiAgICAgICAgPT4gJFNlbGYtPntBY3Rpb259LAogICAgICAgIFJldHVyblR5cGUgICAgPT4gJ1RpY2tldCcsCiAgICAgICAgUmV0dXJuU3ViVHlwZSA9PiAnT3duZXInLAogICAgICAgIERhdGEgICAgICAgICAgPT4gXCVTaG93blVzZXJzLAogICAgICAgIFVzZXJJRCAgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgKTsKCiAgICByZXR1cm4geyAkVGlja2V0T2JqZWN0LT5UaWNrZXRBY2xEYXRhKCkgfSBpZiAkQUNMOwoKICAgIHJldHVybiBcJVNob3duVXNlcnM7Cn0KCnN1YiBfR2V0UmVzcG9uc2libGVzIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBnZXQgdXNlcnMKICAgIG15ICVTaG93blVzZXJzOwogICAgbXkgJUFsbEdyb3Vwc01lbWJlcnMgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VXNlcicpLT5Vc2VyTGlzdCgKICAgICAgICBUeXBlICA9PiAnTG9uZycsCiAgICAgICAgVmFsaWQgPT4gMSwKICAgICk7CgogICAgIyBnZXQgdGlja2V0IG9iamVjdAogICAgbXkgJFRpY2tldE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpUaWNrZXQnKTsKCiAgICAjIGp1c3Qgc2hvdyBvbmx5IHVzZXJzIHdpdGggc2VsZWN0ZWQgY3VzdG9tIHF1ZXVlCiAgICBpZiAoICRQYXJhbXtRdWV1ZUlEfSAmJiAhJFBhcmFte0FsbFVzZXJzfSApIHsKICAgICAgICBteSBAVXNlcklEcyA9ICRUaWNrZXRPYmplY3QtPkdldFN1YnNjcmliZWRVc2VySURzQnlRdWV1ZUlEKCVQYXJhbSk7CiAgICAgICAgZm9yIG15ICRHcm91cE1lbWJlcktleSAoIHNvcnQga2V5cyAlQWxsR3JvdXBzTWVtYmVycyApIHsKICAgICAgICAgICAgbXkgJEhpdCA9IDA7CiAgICAgICAgICAgIGZvciBteSAkVUlEIChAVXNlcklEcykgewogICAgICAgICAgICAgICAgaWYgKCAkVUlEIGVxICRHcm91cE1lbWJlcktleSApIHsKICAgICAgICAgICAgICAgICAgICAkSGl0ID0gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoICEkSGl0ICkgewogICAgICAgICAgICAgICAgZGVsZXRlICRBbGxHcm91cHNNZW1iZXJzeyRHcm91cE1lbWJlcktleX07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgIyBjaGVjayBzaG93IHVzZXJzCiAgICBpZiAoICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnVGlja2V0OjpDaGFuZ2VPd25lclRvRXZlcnlvbmUnKSApIHsKICAgICAgICAlU2hvd25Vc2VycyA9ICVBbGxHcm91cHNNZW1iZXJzOwogICAgfQoKICAgICMgc2hvdyBhbGwgdXNlcnMgd2hvIGFyZSByZXNwb25zaWJsZSBvciBydyBpbiB0aGUgcXVldWUgZ3JvdXAKICAgIGVsc2lmICggJFBhcmFte1F1ZXVlSUR9ICkgewogICAgICAgIG15ICRHSUQgICAgICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlF1ZXVlJyktPkdldFF1ZXVlR3JvdXBJRCggUXVldWVJRCA9PiAkUGFyYW17UXVldWVJRH0gKTsKICAgICAgICBteSAlTWVtYmVyTGlzdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpHcm91cCcpLT5QZXJtaXNzaW9uR3JvdXBHZXQoCiAgICAgICAgICAgIEdyb3VwSUQgPT4gJEdJRCwKICAgICAgICAgICAgVHlwZSAgICA9PiAncmVzcG9uc2libGUnLAogICAgICAgICk7CiAgICAgICAgZm9yIG15ICRNZW1iZXJLZXkgKCBzb3J0IGtleXMgJU1lbWJlckxpc3QgKSB7CiAgICAgICAgICAgIGlmICggJEFsbEdyb3Vwc01lbWJlcnN7JE1lbWJlcktleX0gKSB7CiAgICAgICAgICAgICAgICAkU2hvd25Vc2Vyc3skTWVtYmVyS2V5fSA9ICRBbGxHcm91cHNNZW1iZXJzeyRNZW1iZXJLZXl9OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgICMgd29ya2Zsb3cKICAgIG15ICRBQ0wgPSAkVGlja2V0T2JqZWN0LT5UaWNrZXRBY2woCiAgICAgICAgJVBhcmFtLAogICAgICAgIEFjdGlvbiAgICAgICAgPT4gJFNlbGYtPntBY3Rpb259LAogICAgICAgIFJldHVyblR5cGUgICAgPT4gJ1RpY2tldCcsCiAgICAgICAgUmV0dXJuU3ViVHlwZSA9PiAnUmVzcG9uc2libGUnLAogICAgICAgIERhdGEgICAgICAgICAgPT4gXCVTaG93blVzZXJzLAogICAgICAgIFVzZXJJRCAgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgKTsKCiAgICByZXR1cm4geyAkVGlja2V0T2JqZWN0LT5UaWNrZXRBY2xEYXRhKCkgfSBpZiAkQUNMOwoKICAgIHJldHVybiBcJVNob3duVXNlcnM7Cn0KCnN1YiBfR2V0UHJpb3JpdGllcyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgZ2V0IHByaW9yaXR5CiAgICBteSAlUHJpb3JpdGllczsKICAgIGlmICggJFBhcmFte1F1ZXVlSUR9IHx8ICRQYXJhbXtUaWNrZXRJRH0gKSB7CiAgICAgICAgJVByaW9yaXRpZXMgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGlja2V0JyktPlRpY2tldFByaW9yaXR5TGlzdCgKICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICBBY3Rpb24gPT4gJFNlbGYtPntBY3Rpb259LAogICAgICAgICAgICBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICk7CiAgICB9CiAgICByZXR1cm4gXCVQcmlvcml0aWVzOwp9CgpzdWIgX0dldFR5cGVzIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBnZXQgdHlwZQogICAgbXkgJVR5cGU7CiAgICBpZiAoICRQYXJhbXtRdWV1ZUlEfSB8fCAkUGFyYW17VGlja2V0SUR9ICkgewogICAgICAgICVUeXBlID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpY2tldCcpLT5UaWNrZXRUeXBlTGlzdCgKICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICBBY3Rpb24gPT4gJFNlbGYtPntBY3Rpb259LAogICAgICAgICAgICBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICk7CiAgICB9CiAgICByZXR1cm4gXCVUeXBlOwp9CgpzdWIgX0dldFNlcnZpY2VzIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBnZXQgc2VydmljZQogICAgbXkgJVNlcnZpY2U7CgogICAgIyBjaGVjayBuZWVkZWQKICAgIHJldHVybiBcJVNlcnZpY2UgaWYgISRQYXJhbXtRdWV1ZUlEfSAmJiAhJFBhcmFte1RpY2tldElEfTsKCiAgICAjIGdldCBvcHRpb25zIGZvciBkZWZhdWx0IHNlcnZpY2VzIGZvciB1bmtub3duIGN1c3RvbWVycwogICAgbXkgJERlZmF1bHRTZXJ2aWNlVW5rbm93bkN1c3RvbWVyCiAgICAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpLT5HZXQoJ1RpY2tldDo6U2VydmljZTo6RGVmYXVsdDo6VW5rbm93bkN1c3RvbWVyJyk7CgogICAgIyBjaGVjayBpZiBubyBDdXN0b21lclVzZXJJRCBpcyBzZWxlY3RlZAogICAgIyBpZiAkRGVmYXVsdFNlcnZpY2VVbmtub3duQ3VzdG9tZXIgPSAwIGxlYXZlIEN1c3RvbWVyVXNlcklEIGVtcHR5LCBpdCB3aWxsIG5vdCBnZXQgYW55IHNlcnZpY2VzCiAgICAjIGlmICREZWZhdWx0U2VydmljZVVua25vd25DdXN0b21lciA9IDEgc2V0IEN1c3RvbWVyVXNlcklEIHRvIGdldCBkZWZhdWx0IHNlcnZpY2VzCiAgICBpZiAoICEkUGFyYW17Q3VzdG9tZXJVc2VySUR9ICYmICREZWZhdWx0U2VydmljZVVua25vd25DdXN0b21lciApIHsKICAgICAgICAkUGFyYW17Q3VzdG9tZXJVc2VySUR9ID0gJzxERUZBVUxUPic7CiAgICB9CgogICAgIyBnZXQgc2VydmljZSBsaXN0CiAgICBpZiAoICRQYXJhbXtDdXN0b21lclVzZXJJRH0gKSB7CiAgICAgICAgJVNlcnZpY2UgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGlja2V0JyktPlRpY2tldFNlcnZpY2VMaXN0KAogICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgIEFjdGlvbiA9PiAkU2VsZi0+e0FjdGlvbn0sCiAgICAgICAgICAgIFVzZXJJRCA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgKTsKICAgIH0KICAgIHJldHVybiBcJVNlcnZpY2U7Cn0KCnN1YiBfR2V0U0xBcyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgZ2V0IHNsYQogICAgbXkgJVNMQTsKICAgIGlmICggJFBhcmFte1NlcnZpY2VJRH0gJiYgJFBhcmFte1NlcnZpY2VzfSAmJiAleyAkUGFyYW17U2VydmljZXN9IH0gKSB7CiAgICAgICAgaWYgKCAkUGFyYW17U2VydmljZXN9LT57ICRQYXJhbXtTZXJ2aWNlSUR9IH0gKSB7CiAgICAgICAgICAgICVTTEEgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGlja2V0JyktPlRpY2tldFNMQUxpc3QoCiAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICBBY3Rpb24gPT4gJFNlbGYtPntBY3Rpb259LAogICAgICAgICAgICAgICAgVXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gXCVTTEE7Cn0KCnN1YiBfR2V0VG9zIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBnZXQgY29uZmlnIG9iamVjdAogICAgbXkgJENvbmZpZ09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CgogICAgIyBjaGVjayBvd24gc2VsZWN0aW9uCiAgICBteSAlTmV3VG9zOwogICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6Ok5ld1F1ZXVlT3duU2VsZWN0aW9uJykgKSB7CiAgICAgICAgJU5ld1RvcyA9ICV7ICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpGcm9udGVuZDo6TmV3UXVldWVPd25TZWxlY3Rpb24nKSB9OwogICAgfQogICAgZWxzZSB7CgogICAgICAgICMgU2VsZWN0aW9uVHlwZSBRdWV1ZSBvciBTeXN0ZW1BZGRyZXNzPwogICAgICAgIG15ICVUb3M7CiAgICAgICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6Ok5ld1F1ZXVlU2VsZWN0aW9uVHlwZScpIGVxICdRdWV1ZScgKSB7CiAgICAgICAgICAgICVUb3MgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGlja2V0JyktPk1vdmVMaXN0KAogICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgVHlwZSAgID0+ICdjcmVhdGUnLAogICAgICAgICAgICAgICAgQWN0aW9uID0+ICRTZWxmLT57QWN0aW9ufSwKICAgICAgICAgICAgICAgIFVzZXJJRCA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAlVG9zID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlN5c3RlbUFkZHJlc3MnKS0+U3lzdGVtQWRkcmVzc1F1ZXVlTGlzdCgpOwogICAgICAgIH0KCiAgICAgICAgIyBnZXQgY3JlYXRlIHBlcm1pc3Npb24gcXVldWVzCiAgICAgICAgbXkgJVVzZXJHcm91cHMgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6R3JvdXAnKS0+UGVybWlzc2lvblVzZXJHZXQoCiAgICAgICAgICAgIFVzZXJJRCA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgIFR5cGUgICA9PiAnY3JlYXRlJywKICAgICAgICApOwoKICAgICAgICAjIGJ1aWxkIHNlbGVjdGlvbiBzdHJpbmcKICAgICAgICBRVUVVRUlEOgogICAgICAgIGZvciBteSAkUXVldWVJRCAoIHNvcnQga2V5cyAlVG9zICkgewogICAgICAgICAgICBteSAlUXVldWVEYXRhID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlF1ZXVlJyktPlF1ZXVlR2V0KCBJRCA9PiAkUXVldWVJRCApOwoKICAgICAgICAgICAgIyBwZXJtaXNzaW9uIGNoZWNrLCBjYW4gd2UgY3JlYXRlIG5ldyB0aWNrZXRzIGluIHF1ZXVlCiAgICAgICAgICAgIG5leHQgUVVFVUVJRCBpZiAhJFVzZXJHcm91cHN7ICRRdWV1ZURhdGF7R3JvdXBJRH0gfTsKCiAgICAgICAgICAgIG15ICRTdHJpbmcgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6Ok5ld1F1ZXVlU2VsZWN0aW9uU3RyaW5nJykKICAgICAgICAgICAgICAgIHx8ICc8UmVhbG5hbWU+IDw8RW1haWw+PiAtIFF1ZXVlOiA8UXVldWU+JzsKICAgICAgICAgICAgJFN0cmluZyA9fiBzLzxRdWV1ZT4vJFF1ZXVlRGF0YXtOYW1lfS9nOwogICAgICAgICAgICAkU3RyaW5nID1+IHMvPFF1ZXVlQ29tbWVudD4vJFF1ZXVlRGF0YXtDb21tZW50fS9nOwoKICAgICAgICAgICAgIyByZW1vdmUgdHJhaWxpbmcgc3BhY2VzCiAgICAgICAgICAgICRTdHJpbmcgPX4gc3tccytcen17fSBpZiAhJFF1ZXVlRGF0YXtDb21tZW50fTsKCiAgICAgICAgICAgIGlmICggJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpOZXdRdWV1ZVNlbGVjdGlvblR5cGUnKSBuZSAnUXVldWUnICkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbXkgJVN5c3RlbUFkZHJlc3NEYXRhID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlN5c3RlbUFkZHJlc3MnKS0+U3lzdGVtQWRkcmVzc0dldCgKICAgICAgICAgICAgICAgICAgICBJRCA9PiAkVG9zeyRRdWV1ZUlEfSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAkU3RyaW5nID1+IHMvPFJlYWxuYW1lPi8kU3lzdGVtQWRkcmVzc0RhdGF7UmVhbG5hbWV9L2c7CiAgICAgICAgICAgICAgICAkU3RyaW5nID1+IHMvPEVtYWlsPi8kU3lzdGVtQWRkcmVzc0RhdGF7TmFtZX0vZzsKICAgICAgICAgICAgfQogICAgICAgICAgICAkTmV3VG9zeyRRdWV1ZUlEfSA9ICRTdHJpbmc7CiAgICAgICAgfQogICAgfQoKICAgICMgYWRkIGVtcHR5IHNlbGVjdGlvbgogICAgJE5ld1Rvc3snJ30gPSAnLSc7CiAgICByZXR1cm4gXCVOZXdUb3M7Cn0KCnN1YiBfR2V0U2lnbmF0dXJlIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBwcmVwYXJlIHNpZ25hdHVyZQogICAgbXkgJFRlbXBsYXRlR2VuZXJhdG9yID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRlbXBsYXRlR2VuZXJhdG9yJyk7CiAgICBteSAkU2lnbmF0dXJlICAgICAgICAgPSAkVGVtcGxhdGVHZW5lcmF0b3ItPlNpZ25hdHVyZSgKICAgICAgICBRdWV1ZUlEID0+ICRQYXJhbXtRdWV1ZUlEfSwKICAgICAgICBEYXRhICAgID0+IFwlUGFyYW0sCiAgICAgICAgVXNlcklEICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICApOwoKICAgIHJldHVybiAkU2lnbmF0dXJlOwp9CgpzdWIgX0dldFRpbWVVbml0cyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRBY2NvdW50ZWRUaW1lID0gJyc7CgogICAgIyBHZXQgYWNjb3VudGVkIHRpbWUgaWYgQWNjb3VudFRpbWUgY29uZmlnIGl0ZW0gaXMgZW5hYmxlZC4KICAgIGlmICggJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKS0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpBY2NvdW50VGltZScpICYmIGRlZmluZWQgJFBhcmFte0FydGljbGVJRH0gKSB7CiAgICAgICAgJEFjY291bnRlZFRpbWUgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGlja2V0OjpBcnRpY2xlJyktPkFydGljbGVBY2NvdW50ZWRUaW1lR2V0KAogICAgICAgICAgICBBcnRpY2xlSUQgPT4gJFBhcmFte0FydGljbGVJRH0sCiAgICAgICAgKTsKICAgIH0KCiAgICByZXR1cm4gJEFjY291bnRlZFRpbWUgPyAkQWNjb3VudGVkVGltZSA6ICcnOwp9CgpzdWIgX0dldFN0YW5kYXJkVGVtcGxhdGVzIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJVRlbXBsYXRlczsKICAgIG15ICRRdWV1ZUlEID0gJFBhcmFte1F1ZXVlSUR9IHx8ICcnOwoKICAgIG15ICRDb25maWdPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpOwogICAgbXkgJFF1ZXVlT2JqZWN0ICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpRdWV1ZScpOwoKICAgIGlmICggISRRdWV1ZUlEICkgewogICAgICAgIG15ICRVc2VyRGVmYXVsdFF1ZXVlID0gJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpVc2VyRGVmYXVsdFF1ZXVlJykgfHwgJyc7CgogICAgICAgIGlmICgkVXNlckRlZmF1bHRRdWV1ZSkgewogICAgICAgICAgICAkUXVldWVJRCA9ICRRdWV1ZU9iamVjdC0+UXVldWVMb29rdXAoIFF1ZXVlID0+ICRVc2VyRGVmYXVsdFF1ZXVlICk7CiAgICAgICAgfQogICAgfQoKICAgICMgY2hlY2sgbmVlZGVkCiAgICByZXR1cm4gXCVUZW1wbGF0ZXMgaWYgISRRdWV1ZUlEICYmICEkUGFyYW17VGlja2V0SUR9OwoKICAgIGlmICggISRRdWV1ZUlEICYmICRQYXJhbXtUaWNrZXRJRH0gKSB7CgogICAgICAgICMgZ2V0IFF1ZXVlSUQgZnJvbSB0aGUgdGlja2V0CiAgICAgICAgbXkgJVRpY2tldCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpUaWNrZXQnKS0+VGlja2V0R2V0KAogICAgICAgICAgICBUaWNrZXRJRCAgICAgID0+ICRQYXJhbXtUaWNrZXRJRH0sCiAgICAgICAgICAgIER5bmFtaWNGaWVsZHMgPT4gMCwKICAgICAgICAgICAgVXNlcklEICAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgKTsKICAgICAgICAkUXVldWVJRCA9ICRUaWNrZXR7UXVldWVJRH0gfHwgJyc7CiAgICB9CgogICAgIyBmZXRjaCBhbGwgc3RkLiB0ZW1wbGF0ZXMKICAgIG15ICVTdGFuZGFyZFRlbXBsYXRlcyA9ICRRdWV1ZU9iamVjdC0+UXVldWVTdGFuZGFyZFRlbXBsYXRlTWVtYmVyTGlzdCgKICAgICAgICBRdWV1ZUlEICAgICAgID0+ICRRdWV1ZUlELAogICAgICAgIFRlbXBsYXRlVHlwZXMgPT4gMSwKICAgICk7CgogICAgIyByZXR1cm4gZW1wdHkgaGFzaCBpZiB0aGVyZSBhcmUgbm8gdGVtcGxhdGVzIGZvciB0aGlzIHNjcmVlbgogICAgcmV0dXJuIFwlVGVtcGxhdGVzIGlmICFJc0hhc2hSZWZXaXRoRGF0YSggJFN0YW5kYXJkVGVtcGxhdGVze0NyZWF0ZX0gKTsKCiAgICAjIHJldHVybiBqdXN0IHRoZSB0ZW1wbGF0ZXMgZm9yIHRoaXMgc2NyZWVuCiAgICByZXR1cm4gJFN0YW5kYXJkVGVtcGxhdGVze0NyZWF0ZX07Cn0KCnN1YiBfTWFza0VtYWlsTmV3IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgJFBhcmFte0Zvcm1JRH0gPSAkU2VsZi0+e0Zvcm1JRH07CgogICAgIyBnZXQgY29uZmlnIG9iamVjdAogICAgbXkgJENvbmZpZ09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CgogICAgIyBnZXQgbGlzdCB0eXBlCiAgICBteSAkVHJlZVZpZXcgPSAwOwogICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6Okxpc3RUeXBlJykgZXEgJ3RyZWUnICkgewogICAgICAgICRUcmVlVmlldyA9IDE7CiAgICB9CgogICAgIyBnZXQgbGF5b3V0IG9iamVjdAogICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKCiAgICAjIHNldCBKUyBkYXRhCiAgICAkTGF5b3V0T2JqZWN0LT5BZGRKU0RhdGEoCiAgICAgICAgS2V5ICAgPT4gJ0N1c3RvbWVyU2VhcmNoJywKICAgICAgICBWYWx1ZSA9PiB7CiAgICAgICAgICAgIFNob3dDdXN0b21lclRpY2tldHMgPT4gJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpTaG93Q3VzdG9tZXJUaWNrZXRzJyksCiAgICAgICAgfSwKICAgICk7CgogICAgIyBidWlsZCBzdHJpbmcKICAgICRQYXJhbXtPcHRpb25TdHJnfSA9ICRMYXlvdXRPYmplY3QtPkJ1aWxkU2VsZWN0aW9uKAogICAgICAgIERhdGEgICAgICAgICA9PiAkUGFyYW17VXNlcnN9LAogICAgICAgIFNlbGVjdGVkSUQgICA9PiAkUGFyYW17VXNlclNlbGVjdGVkfSwKICAgICAgICBUcmFuc2xhdGlvbiAgPT4gMCwKICAgICAgICBQb3NzaWJsZU5vbmUgPT4gMSwKICAgICAgICBOYW1lICAgICAgICAgPT4gJ05ld1VzZXJJRCcsCiAgICAgICAgQ2xhc3MgICAgICAgID0+ICdNb2Rlcm5pemUnLAogICAgKTsKCiAgICBteSAkQ29uZmlnID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKS0+R2V0KCJUaWNrZXQ6OkZyb250ZW5kOjokU2VsZi0+e0FjdGlvbn0iKTsKCiAgICAjIGJ1aWxkIG5leHQgc3RhdGVzIHN0cmluZwogICAgJFBhcmFte05leHRTdGF0ZXNTdHJnfSA9ICRMYXlvdXRPYmplY3QtPkJ1aWxkU2VsZWN0aW9uKAogICAgICAgIERhdGEgICAgICAgICAgPT4gJFBhcmFte05leHRTdGF0ZXN9LAogICAgICAgIE5hbWUgICAgICAgICAgPT4gJ05leHRTdGF0ZUlEJywKICAgICAgICBDbGFzcyAgICAgICAgID0+ICdNb2Rlcm5pemUnLAogICAgICAgIFRyYW5zbGF0aW9uICAgPT4gMSwKICAgICAgICBTZWxlY3RlZFZhbHVlID0+ICRQYXJhbXtOZXh0U3RhdGV9IHx8ICRDb25maWctPntTdGF0ZURlZmF1bHR9LAogICAgKTsKCiAgICAjIGJ1aWxkIERlc3RpbmF0aW9uIHN0cmluZwogICAgbXkgJU5ld1RvOwogICAgaWYgKCAkUGFyYW17RnJvbUxpc3R9ICkgewogICAgICAgIGZvciBteSAkRnJvbUtleSAoIHNvcnQga2V5cyAleyAkUGFyYW17RnJvbUxpc3R9IH0gKSB7CiAgICAgICAgICAgICROZXdUb3siJEZyb21LZXl8fCRQYXJhbXtGcm9tTGlzdH0tPnskRnJvbUtleX0ifSA9ICRQYXJhbXtGcm9tTGlzdH0tPnskRnJvbUtleX07CiAgICAgICAgfQogICAgfQogICAgaWYgKCAhJFBhcmFte0Zyb21TZWxlY3RlZH0gKSB7CiAgICAgICAgbXkgJFVzZXJEZWZhdWx0UXVldWUgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6OlVzZXJEZWZhdWx0UXVldWUnKSB8fCAnJzsKICAgICAgICBpZiAoJFVzZXJEZWZhdWx0UXVldWUpIHsKICAgICAgICAgICAgbXkgJFF1ZXVlSUQgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6UXVldWUnKS0+UXVldWVMb29rdXAoIFF1ZXVlID0+ICRVc2VyRGVmYXVsdFF1ZXVlICk7CiAgICAgICAgICAgIGlmICgkUXVldWVJRCkgewogICAgICAgICAgICAgICAgJFBhcmFte0Zyb21TZWxlY3RlZH0gPSAiJFF1ZXVlSUR8fCRVc2VyRGVmYXVsdFF1ZXVlIjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpGcm9udGVuZDo6TmV3UXVldWVTZWxlY3Rpb25UeXBlJykgZXEgJ1F1ZXVlJyApIHsKICAgICAgICAkUGFyYW17RnJvbVN0cmd9ID0gJExheW91dE9iamVjdC0+QWdlbnRRdWV1ZUxpc3RPcHRpb24oCiAgICAgICAgICAgIERhdGEgICAgICAgICAgID0+IFwlTmV3VG8sCiAgICAgICAgICAgIE11bHRpcGxlICAgICAgID0+IDAsCiAgICAgICAgICAgIFNpemUgICAgICAgICAgID0+IDAsCiAgICAgICAgICAgIENsYXNzICAgICAgICAgID0+ICdWYWxpZGF0ZV9SZXF1aXJlZCBNb2Rlcm5pemUgJyAuICggJFBhcmFte0Vycm9yc30tPntEZXN0aW5hdGlvbkludmFsaWR9IHx8ICcgJyApLAogICAgICAgICAgICBOYW1lICAgICAgICAgICA9PiAnRGVzdCcsCiAgICAgICAgICAgIFRyZWVWaWV3ICAgICAgID0+ICRUcmVlVmlldywKICAgICAgICAgICAgU2VsZWN0ZWRJRCAgICAgPT4gJFBhcmFte0Zyb21TZWxlY3RlZH0sCiAgICAgICAgICAgIE9uQ2hhbmdlU3VibWl0ID0+IDAsCiAgICAgICAgKTsKICAgIH0KICAgIGVsc2UgewogICAgICAgICRQYXJhbXtGcm9tU3RyZ30gPSAkTGF5b3V0T2JqZWN0LT5CdWlsZFNlbGVjdGlvbigKICAgICAgICAgICAgRGF0YSAgICAgICA9PiBcJU5ld1RvLAogICAgICAgICAgICBDbGFzcyAgICAgID0+ICdWYWxpZGF0ZV9SZXF1aXJlZCBNb2Rlcm5pemUgJyAuICggJFBhcmFte0Vycm9yc30tPntEZXN0aW5hdGlvbkludmFsaWR9IHx8ICcgJyApLAogICAgICAgICAgICBOYW1lICAgICAgID0+ICdEZXN0JywKICAgICAgICAgICAgVHJlZVZpZXcgICA9PiAkVHJlZVZpZXcsCiAgICAgICAgICAgIFNlbGVjdGVkSUQgPT4gJFBhcmFte0Zyb21TZWxlY3RlZH0sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGN1c3RvbWVyIGluZm8gc3RyaW5nCiAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpGcm9udGVuZDo6Q3VzdG9tZXJJbmZvQ29tcG9zZScpICkgewogICAgICAgICRQYXJhbXtDdXN0b21lclRhYmxlfSA9ICRMYXlvdXRPYmplY3QtPkFnZW50Q3VzdG9tZXJWaWV3VGFibGUoCiAgICAgICAgICAgIERhdGEgPT4gJFBhcmFte0N1c3RvbWVyRGF0YX0sCiAgICAgICAgICAgIE1heCAgPT4gJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpDdXN0b21lckluZm9Db21wb3NlTWF4U2l6ZScpLAogICAgICAgICk7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ0N1c3RvbWVyVGFibGUnLAogICAgICAgICAgICBEYXRhID0+IFwlUGFyYW0sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIHByZXBhcmUgZXJyb3JzIQogICAgaWYgKCAkUGFyYW17RXJyb3JzfSApIHsKICAgICAgICBmb3IgbXkgJEVycm9yS2V5ICggc29ydCBrZXlzICV7ICRQYXJhbXtFcnJvcnN9IH0gKSB7CiAgICAgICAgICAgICRQYXJhbXskRXJyb3JLZXl9ID0gJExheW91dE9iamVjdC0+QXNjaWkySHRtbCggVGV4dCA9PiAkUGFyYW17RXJyb3JzfS0+eyRFcnJvcktleX0gKTsKICAgICAgICB9CiAgICB9CgogICAgIyBGcm9tIGV4dGVybmFsCiAgICBteSAkU2hvd0Vycm9ycyA9IDE7CiAgICBpZiAoCiAgICAgICAgZGVmaW5lZCAkUGFyYW17RnJvbUV4dGVybmFsQ3VzdG9tZXJ9CiAgICAgICAgJiYKICAgICAgICBkZWZpbmVkICRQYXJhbXtGcm9tRXh0ZXJuYWxDdXN0b21lcn0tPntFbWFpbH0gJiYKICAgICAgICBkZWZpbmVkICRQYXJhbXtGcm9tRXh0ZXJuYWxDdXN0b21lcn0tPntDdXN0b21lcn0KICAgICAgICApCiAgICB7CiAgICAgICAgJFNob3dFcnJvcnMgPSAwOwogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdGcm9tRXh0ZXJuYWxDdXN0b21lcicsCiAgICAgICAgICAgIERhdGEgPT4gJFBhcmFte0Zyb21FeHRlcm5hbEN1c3RvbWVyfSwKICAgICAgICApOwoKICAgICAgICAkTGF5b3V0T2JqZWN0LT5BZGRKU0RhdGEoCiAgICAgICAgICAgIEtleSAgID0+ICdEYXRhRW1haWwnLAogICAgICAgICAgICBWYWx1ZSA9PiAkUGFyYW17RnJvbUV4dGVybmFsQ3VzdG9tZXJ9LT57RW1haWx9LAogICAgICAgICk7CiAgICAgICAgJExheW91dE9iamVjdC0+QWRkSlNEYXRhKAogICAgICAgICAgICBLZXkgICA9PiAnRGF0YUN1c3RvbWVyJywKICAgICAgICAgICAgVmFsdWUgPT4gJFBhcmFte0Zyb21FeHRlcm5hbEN1c3RvbWVyfS0+e0N1c3RvbWVyfSwKICAgICAgICApOwogICAgfQoKICAgICMgQ2MKICAgIG15ICRDdXN0b21lckNvdW50ZXJDYyA9IDA7CiAgICBpZiAoICRQYXJhbXtNdWx0aXBsZUN1c3RvbWVyQ2N9ICkgewogICAgICAgIGZvciBteSAkSXRlbSAoIEB7ICRQYXJhbXtNdWx0aXBsZUN1c3RvbWVyQ2N9IH0gKSB7CiAgICAgICAgICAgIGlmICggISRTaG93RXJyb3JzICkgewoKICAgICAgICAgICAgICAgICMgc2V0IGVtcHR5IHZhbHVlcyBmb3IgZXJyb3JzCiAgICAgICAgICAgICAgICAkSXRlbS0+e0N1c3RvbWVyRXJyb3J9ICAgID0gJyc7CiAgICAgICAgICAgICAgICAkSXRlbS0+e0N1c3RvbWVyRGlzYWJsZWR9ID0gJyc7CiAgICAgICAgICAgICAgICAkSXRlbS0+e0N1c3RvbWVyRXJyb3JNc2d9ID0gJ0N1c3RvbWVyR2VuZXJpY1NlcnZlckVycm9yTXNnJzsKICAgICAgICAgICAgfQogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ0NjTXVsdGlwbGVDdXN0b21lcicsCiAgICAgICAgICAgICAgICBEYXRhID0+ICRJdGVtLAogICAgICAgICAgICApOwogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ0NjJyAuICRJdGVtLT57Q3VzdG9tZXJFcnJvck1zZ30sCiAgICAgICAgICAgICAgICBEYXRhID0+ICRJdGVtLAogICAgICAgICAgICApOwogICAgICAgICAgICBpZiAoICRJdGVtLT57Q3VzdG9tZXJFcnJvcn0gKSB7CiAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICdDY0N1c3RvbWVyRXJyb3JFeHBsYW50aW9uJywKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJEN1c3RvbWVyQ291bnRlckNjKys7CiAgICAgICAgfQogICAgfQoKICAgIGlmICggISRDdXN0b21lckNvdW50ZXJDYyApIHsKICAgICAgICAkUGFyYW17Q2NDdXN0b21lckhpZGRlbkNvbnRhaW5lcn0gPSAnSGlkZGVuJzsKICAgIH0KCiAgICAjIHNldCBjdXN0b21lciBjb3VudGVyCiAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICBOYW1lID0+ICdDY011bHRpcGxlQ3VzdG9tZXJDb3VudGVyJywKICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgQ3VzdG9tZXJDb3VudGVyID0+ICRDdXN0b21lckNvdW50ZXJDYysrLAogICAgICAgIH0sCiAgICApOwoKICAgICMgQmNjCiAgICBteSAkQ3VzdG9tZXJDb3VudGVyQmNjID0gMDsKICAgIGlmICggJFBhcmFte011bHRpcGxlQ3VzdG9tZXJCY2N9ICkgewogICAgICAgIGZvciBteSAkSXRlbSAoIEB7ICRQYXJhbXtNdWx0aXBsZUN1c3RvbWVyQmNjfSB9ICkgewogICAgICAgICAgICBpZiAoICEkU2hvd0Vycm9ycyApIHsKCiAgICAgICAgICAgICAgICAjIHNldCBlbXB0eSB2YWx1ZXMgZm9yIGVycm9ycwogICAgICAgICAgICAgICAgJEl0ZW0tPntDdXN0b21lckVycm9yfSAgICA9ICcnOwogICAgICAgICAgICAgICAgJEl0ZW0tPntDdXN0b21lckRpc2FibGVkfSA9ICcnOwogICAgICAgICAgICAgICAgJEl0ZW0tPntDdXN0b21lckVycm9yTXNnfSA9ICdDdXN0b21lckdlbmVyaWNTZXJ2ZXJFcnJvck1zZyc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdCY2NNdWx0aXBsZUN1c3RvbWVyJywKICAgICAgICAgICAgICAgIERhdGEgPT4gJEl0ZW0sCiAgICAgICAgICAgICk7CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgTmFtZSA9PiAnQmNjJyAuICRJdGVtLT57Q3VzdG9tZXJFcnJvck1zZ30sCiAgICAgICAgICAgICAgICBEYXRhID0+ICRJdGVtLAogICAgICAgICAgICApOwogICAgICAgICAgICBpZiAoICRJdGVtLT57Q3VzdG9tZXJFcnJvcn0gKSB7CiAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICdCY2NDdXN0b21lckVycm9yRXhwbGFudGlvbicsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRDdXN0b21lckNvdW50ZXJCY2MrKzsKICAgICAgICB9CiAgICB9CgogICAgaWYgKCAhJEN1c3RvbWVyQ291bnRlckJjYyApIHsKICAgICAgICAkUGFyYW17QmNjQ3VzdG9tZXJIaWRkZW5Db250YWluZXJ9ID0gJ0hpZGRlbic7CiAgICB9CgogICAgIyBzZXQgY3VzdG9tZXIgY291bnRlcgogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnQmNjTXVsdGlwbGVDdXN0b21lckNvdW50ZXInLAogICAgICAgIERhdGEgPT4gewogICAgICAgICAgICBDdXN0b21lckNvdW50ZXIgPT4gJEN1c3RvbWVyQ291bnRlckJjYysrLAogICAgICAgIH0sCiAgICApOwoKICAgICMgVG8KICAgIG15ICRDdXN0b21lckNvdW50ZXIgPSAwOwogICAgaWYgKCAkUGFyYW17TXVsdGlwbGVDdXN0b21lcn0gKSB7CiAgICAgICAgZm9yIG15ICRJdGVtICggQHsgJFBhcmFte011bHRpcGxlQ3VzdG9tZXJ9IH0gKSB7CiAgICAgICAgICAgIGlmICggISRTaG93RXJyb3JzICkgewoKICAgICAgICAgICAgICAgICMgc2V0IGVtcHR5IHZhbHVlcyBmb3IgZXJyb3JzCiAgICAgICAgICAgICAgICAkSXRlbS0+e0N1c3RvbWVyRXJyb3J9ICAgID0gJyc7CiAgICAgICAgICAgICAgICAkSXRlbS0+e0N1c3RvbWVyRGlzYWJsZWR9ID0gJyc7CiAgICAgICAgICAgICAgICAkSXRlbS0+e0N1c3RvbWVyRXJyb3JNc2d9ID0gJ0N1c3RvbWVyR2VuZXJpY1NlcnZlckVycm9yTXNnJzsKICAgICAgICAgICAgfQogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ011bHRpcGxlQ3VzdG9tZXInLAogICAgICAgICAgICAgICAgRGF0YSA9PiAkSXRlbSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICRJdGVtLT57Q3VzdG9tZXJFcnJvck1zZ30sCiAgICAgICAgICAgICAgICBEYXRhID0+ICRJdGVtLAogICAgICAgICAgICApOwogICAgICAgICAgICBpZiAoICRJdGVtLT57Q3VzdG9tZXJFcnJvcn0gKSB7CiAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICdDdXN0b21lckVycm9yRXhwbGFudGlvbicsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRDdXN0b21lckNvdW50ZXIrKzsKICAgICAgICB9CiAgICB9CgogICAgaWYgKCAhJEN1c3RvbWVyQ291bnRlciApIHsKICAgICAgICAkUGFyYW17Q3VzdG9tZXJIaWRkZW5Db250YWluZXJ9ID0gJ0hpZGRlbic7CiAgICB9CgogICAgIyBzZXQgY3VzdG9tZXIgY291bnRlcgogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnTXVsdGlwbGVDdXN0b21lckNvdW50ZXInLAogICAgICAgIERhdGEgPT4gewogICAgICAgICAgICBDdXN0b21lckNvdW50ZXIgPT4gJEN1c3RvbWVyQ291bnRlcisrLAogICAgICAgIH0sCiAgICApOwoKICAgIGlmICggJFBhcmFte1RvSW52YWxpZH0gJiYgJFBhcmFte0Vycm9yc30gJiYgISRQYXJhbXtFcnJvcnN9LT57VG9FcnJvclR5cGV9ICkgewogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdUb1NlcnZlckVycm9yTXNnJywKICAgICAgICApOwogICAgfQogICAgaWYgKCAkUGFyYW17RXJyb3JzfS0+e1RvRXJyb3JUeXBlfSB8fCAhJFNob3dFcnJvcnMgKSB7CiAgICAgICAgJFBhcmFte1RvSW52YWxpZH0gPSAnJzsKICAgIH0KCiAgICBpZiAoICRQYXJhbXtDY0ludmFsaWR9ICYmICRQYXJhbXtFcnJvcnN9ICYmICEkUGFyYW17RXJyb3JzfS0+e0NjRXJyb3JUeXBlfSApIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnQ2NTZXJ2ZXJFcnJvck1zZycsCiAgICAgICAgKTsKICAgIH0KICAgIGlmICggJFBhcmFte0Vycm9yc30tPntDY0Vycm9yVHlwZX0gfHwgISRTaG93RXJyb3JzICkgewogICAgICAgICRQYXJhbXtDY0ludmFsaWR9ID0gJyc7CiAgICB9CgogICAgaWYgKCAkUGFyYW17QmNjSW52YWxpZH0gJiYgJFBhcmFte0Vycm9yc30gJiYgISRQYXJhbXtFcnJvcnN9LT57QmNjRXJyb3JUeXBlfSApIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnQmNjU2VydmVyRXJyb3JNc2cnLAogICAgICAgICk7CiAgICB9CiAgICBpZiAoICRQYXJhbXtFcnJvcnN9LT57QmNjRXJyb3JUeXBlfSB8fCAhJFNob3dFcnJvcnMgKSB7CiAgICAgICAgJFBhcmFte0JjY0ludmFsaWR9ID0gJyc7CiAgICB9CgogICAgbXkgJER5bmFtaWNGaWVsZE5hbWVzID0gJFNlbGYtPl9HZXRGaWVsZHNUb1VwZGF0ZSgKICAgICAgICBPbmx5RHluYW1pY0ZpZWxkcyA9PiAxCiAgICApOwoKICAgICRMYXlvdXRPYmplY3QtPkFkZEpTRGF0YSgKICAgICAgICBLZXkgICA9PiAnRHluYW1pY0ZpZWxkTmFtZXMnLAogICAgICAgIFZhbHVlID0+ICREeW5hbWljRmllbGROYW1lcywKICAgICk7CgogICAgIyBidWlsZCB0eXBlIHN0cmluZwogICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6VHlwZScpICkgewogICAgICAgICRQYXJhbXtUeXBlU3RyZ30gPSAkTGF5b3V0T2JqZWN0LT5CdWlsZFNlbGVjdGlvbigKICAgICAgICAgICAgRGF0YSAgICAgICAgID0+ICRQYXJhbXtUeXBlc30sCiAgICAgICAgICAgIE5hbWUgICAgICAgICA9PiAnVHlwZUlEJywKICAgICAgICAgICAgQ2xhc3MgICAgICAgID0+ICdWYWxpZGF0ZV9SZXF1aXJlZCBNb2Rlcm5pemUgJyAuICggJFBhcmFte0Vycm9yc30tPntUeXBlSW52YWxpZH0gfHwgJyAnICksCiAgICAgICAgICAgIFNlbGVjdGVkSUQgICA9PiAkUGFyYW17VHlwZUlEfSwKICAgICAgICAgICAgUG9zc2libGVOb25lID0+IDEsCiAgICAgICAgICAgIFNvcnQgICAgICAgICA9PiAnQWxwaGFudW1lcmljVmFsdWUnLAogICAgICAgICAgICBUcmFuc2xhdGlvbiAgPT4gMCwKICAgICAgICApOwogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdUaWNrZXRUeXBlJywKICAgICAgICAgICAgRGF0YSA9PiB7JVBhcmFtfSwKICAgICAgICApOwogICAgfQoKICAgICMgYnVpbGQgc2VydmljZSBzdHJpbmcKICAgIGlmICggJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OlNlcnZpY2UnKSApIHsKCiAgICAgICAgJFBhcmFte1NlcnZpY2VTdHJnfSA9ICRMYXlvdXRPYmplY3QtPkJ1aWxkU2VsZWN0aW9uKAogICAgICAgICAgICBEYXRhICA9PiAkUGFyYW17U2VydmljZXN9LAogICAgICAgICAgICBOYW1lICA9PiAnU2VydmljZUlEJywKICAgICAgICAgICAgQ2xhc3MgPT4gJ01vZGVybml6ZSAnCiAgICAgICAgICAgICAgICAuICggJENvbmZpZy0+e1NlcnZpY2VNYW5kYXRvcnl9ID8gJ1ZhbGlkYXRlX1JlcXVpcmVkICcgOiAnJyApCiAgICAgICAgICAgICAgICAuICggJFBhcmFte0Vycm9yc30tPntTZXJ2aWNlSW52YWxpZH0gfHwgJycgKSwKICAgICAgICAgICAgU2VsZWN0ZWRJRCAgID0+ICRQYXJhbXtTZXJ2aWNlSUR9LAogICAgICAgICAgICBQb3NzaWJsZU5vbmUgPT4gMSwKICAgICAgICAgICAgVHJlZVZpZXcgICAgID0+ICRUcmVlVmlldywKICAgICAgICAgICAgU29ydCAgICAgICAgID0+ICdUcmVlVmlldycsCiAgICAgICAgICAgIFRyYW5zbGF0aW9uICA9PiAwLAogICAgICAgICAgICBNYXggICAgICAgICAgPT4gMjAwLAogICAgICAgICk7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ1RpY2tldFNlcnZpY2UnLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgIFNlcnZpY2VNYW5kYXRvcnkgPT4gJENvbmZpZy0+e1NlcnZpY2VNYW5kYXRvcnl9IHx8IDAsCiAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKCiAgICAgICAgJFBhcmFte1NMQVN0cmd9ID0gJExheW91dE9iamVjdC0+QnVpbGRTZWxlY3Rpb24oCiAgICAgICAgICAgIERhdGEgICAgICAgPT4gJFBhcmFte1NMQXN9LAogICAgICAgICAgICBOYW1lICAgICAgID0+ICdTTEFJRCcsCiAgICAgICAgICAgIFNlbGVjdGVkSUQgPT4gJFBhcmFte1NMQUlEfSwKICAgICAgICAgICAgQ2xhc3MgICAgICA9PiAnTW9kZXJuaXplICcKICAgICAgICAgICAgICAgIC4gKCAkQ29uZmlnLT57U0xBTWFuZGF0b3J5fSA/ICdWYWxpZGF0ZV9SZXF1aXJlZCAnIDogJycgKQogICAgICAgICAgICAgICAgLiAoICRQYXJhbXtFcnJvcnN9LT57U0xBSW52YWxpZH0gfHwgJycgKSwKICAgICAgICAgICAgUG9zc2libGVOb25lID0+IDEsCiAgICAgICAgICAgIFNvcnQgICAgICAgICA9PiAnQWxwaGFudW1lcmljVmFsdWUnLAogICAgICAgICAgICBUcmFuc2xhdGlvbiAgPT4gMCwKICAgICAgICAgICAgTWF4ICAgICAgICAgID0+IDIwMCwKICAgICAgICApOwogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdUaWNrZXRTTEEnLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgIFNMQU1hbmRhdG9yeSA9PiAkQ29uZmlnLT57U0xBTWFuZGF0b3J5fSB8fCAwLAogICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICB9CgogICAgIyBjaGVjayBpZiBleGlzdHMgY3JlYXRlIHRlbXBsYXRlcyByZWdhcmRsZXNzIHRoZSBxdWV1ZQogICAgbXkgJVN0YW5kYXJkVGVtcGxhdGVzID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlN0YW5kYXJkVGVtcGxhdGUnKS0+U3RhbmRhcmRUZW1wbGF0ZUxpc3QoCiAgICAgICAgVmFsaWQgPT4gMSwKICAgICAgICBUeXBlICA9PiAnQ3JlYXRlJywKICAgICk7CgogICAgIyBidWlsZCB0ZXh0IHRlbXBsYXRlIHN0cmluZwogICAgaWYgKCBJc0hhc2hSZWZXaXRoRGF0YSggXCVTdGFuZGFyZFRlbXBsYXRlcyApICkgewogICAgICAgICRQYXJhbXtTdGFuZGFyZFRlbXBsYXRlU3RyZ30gPSAkTGF5b3V0T2JqZWN0LT5CdWlsZFNlbGVjdGlvbigKICAgICAgICAgICAgRGF0YSAgICAgICAgID0+ICRQYXJhbXtTdGFuZGFyZFRlbXBsYXRlc30gfHwge30sCiAgICAgICAgICAgIE5hbWUgICAgICAgICA9PiAnU3RhbmRhcmRUZW1wbGF0ZUlEJywKICAgICAgICAgICAgU2VsZWN0ZWRJRCAgID0+ICRQYXJhbXtTdGFuZGFyZFRlbXBsYXRlSUR9IHx8ICcnLAogICAgICAgICAgICBDbGFzcyAgICAgICAgPT4gJ01vZGVybml6ZScsCiAgICAgICAgICAgIFBvc3NpYmxlTm9uZSA9PiAxLAogICAgICAgICAgICBTb3J0ICAgICAgICAgPT4gJ0FscGhhbnVtZXJpY1ZhbHVlJywKICAgICAgICAgICAgVHJhbnNsYXRpb24gID0+IDEsCiAgICAgICAgICAgIE1heCAgICAgICAgICA9PiAyMDAsCiAgICAgICAgKTsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnU3RhbmRhcmRUZW1wbGF0ZScsCiAgICAgICAgICAgIERhdGEgPT4geyVQYXJhbX0sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGJ1aWxkIHByaW9yaXR5IHN0cmluZwogICAgaWYgKCAhJFBhcmFte1ByaW9yaXR5SUR9ICkgewogICAgICAgICRQYXJhbXtQcmlvcml0eX0gPSAkQ29uZmlnLT57UHJpb3JpdHl9OwogICAgfQogICAgJFBhcmFte1ByaW9yaXR5U3RyZ30gPSAkTGF5b3V0T2JqZWN0LT5CdWlsZFNlbGVjdGlvbigKICAgICAgICBEYXRhICAgICAgICAgID0+ICRQYXJhbXtQcmlvcml0aWVzfSwKICAgICAgICBOYW1lICAgICAgICAgID0+ICdQcmlvcml0eUlEJywKICAgICAgICBTZWxlY3RlZElEICAgID0+ICRQYXJhbXtQcmlvcml0eUlEfSwKICAgICAgICBDbGFzcyAgICAgICAgID0+ICdNb2Rlcm5pemUnLAogICAgICAgIFNlbGVjdGVkVmFsdWUgPT4gJFBhcmFte1ByaW9yaXR5fSwKICAgICAgICBUcmFuc2xhdGlvbiAgID0+IDEsCiAgICApOwoKICAgICMgcGVuZGluZyBkYXRhIHN0cmluZwogICAgJFBhcmFte1BlbmRpbmdEYXRlU3RyaW5nfSA9ICRMYXlvdXRPYmplY3QtPkJ1aWxkRGF0ZVNlbGVjdGlvbigKICAgICAgICAlUGFyYW0sCiAgICAgICAgRm9ybWF0ICAgICAgICAgICAgICAgPT4gJ0RhdGVJbnB1dEZvcm1hdExvbmcnLAogICAgICAgIFllYXJQZXJpb2RQYXN0ICAgICAgID0+IDAsCiAgICAgICAgWWVhclBlcmlvZEZ1dHVyZSAgICAgPT4gNSwKICAgICAgICBEaWZmVGltZSAgICAgICAgICAgICA9PiAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6OlBlbmRpbmdEaWZmVGltZScpIHx8IDAsCiAgICAgICAgQ2xhc3MgICAgICAgICAgICAgICAgPT4gJFBhcmFte0Vycm9yc30tPntEYXRlSW52YWxpZH0gfHwgJyAnLAogICAgICAgIFZhbGlkYXRlICAgICAgICAgICAgID0+IDEsCiAgICAgICAgVmFsaWRhdGVEYXRlSW5GdXR1cmUgPT4gMSwKICAgICk7CgogICAgIyBzaG93IG93bmVyIHNlbGVjdGlvbgogICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6Ok5ld093bmVyU2VsZWN0aW9uJykgKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ093bmVyU2VsZWN0aW9uJywKICAgICAgICAgICAgRGF0YSA9PiBcJVBhcmFtLAogICAgICAgICk7CiAgICB9CgogICAgIyBzaG93IHJlc3BvbnNpYmxlIHNlbGVjdGlvbgogICAgaWYgKAogICAgICAgICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpSZXNwb25zaWJsZScpCiAgICAgICAgJiYgJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpOZXdSZXNwb25zaWJsZVNlbGVjdGlvbicpCiAgICAgICAgKQogICAgewogICAgICAgICRQYXJhbXtSZXNwb25zaWJsZVVzZXJzfS0+eycnfSA9ICctJzsKICAgICAgICAkUGFyYW17UmVzcG9uc2libGVPcHRpb25TdHJnfSA9ICRMYXlvdXRPYmplY3QtPkJ1aWxkU2VsZWN0aW9uKAogICAgICAgICAgICBEYXRhICAgICAgID0+ICRQYXJhbXtSZXNwb25zaWJsZVVzZXJzfSwKICAgICAgICAgICAgU2VsZWN0ZWRJRCA9PiAkUGFyYW17UmVzcG9uc2libGVVc2VyU2VsZWN0ZWR9LAogICAgICAgICAgICBOYW1lICAgICAgID0+ICdOZXdSZXNwb25zaWJsZUlEJywKICAgICAgICAgICAgQ2xhc3MgICAgICA9PiAnTW9kZXJuaXplJywKICAgICAgICApOwogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdSZXNwb25zaWJsZVNlbGVjdGlvbicsCiAgICAgICAgICAgIERhdGEgPT4gXCVQYXJhbSwKICAgICAgICApOwogICAgfQoKICAgICMgRHluYW1pYyBmaWVsZHMKICAgICMgY3ljbGUgdGhyb3VnaCB0aGUgYWN0aXZhdGVkIER5bmFtaWMgRmllbGRzIGZvciB0aGlzIHNjcmVlbgogICAgRFlOQU1JQ0ZJRUxEOgogICAgZm9yIG15ICREeW5hbWljRmllbGRDb25maWcgKCBAeyAkU2VsZi0+e0R5bmFtaWNGaWVsZH0gfSApIHsKICAgICAgICBuZXh0IERZTkFNSUNGSUVMRCBpZiAhSXNIYXNoUmVmV2l0aERhdGEoJER5bmFtaWNGaWVsZENvbmZpZyk7CgogICAgICAgICMgc2tpcCBmaWVsZHMgdGhhdCBIVE1MIGNvdWxkIG5vdCBiZSByZXRyaWV2ZWQKICAgICAgICBuZXh0IERZTkFNSUNGSUVMRCBpZiAhSXNIYXNoUmVmV2l0aERhdGEoCiAgICAgICAgICAgICRQYXJhbXtEeW5hbWljRmllbGRIVE1MfS0+eyAkRHluYW1pY0ZpZWxkQ29uZmlnLT57TmFtZX0gfQogICAgICAgICk7CgogICAgICAgICMgZ2V0IHRoZSBodG1sIHN0cmluZ3MgZm9ybSAkUGFyYW0KICAgICAgICBteSAkRHluYW1pY0ZpZWxkSFRNTCA9ICRQYXJhbXtEeW5hbWljRmllbGRIVE1MfS0+eyAkRHluYW1pY0ZpZWxkQ29uZmlnLT57TmFtZX0gfTsKCiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ0R5bmFtaWNGaWVsZCcsCiAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgTmFtZSAgPT4gJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9LAogICAgICAgICAgICAgICAgTGFiZWwgPT4gJER5bmFtaWNGaWVsZEhUTUwtPntMYWJlbH0sCiAgICAgICAgICAgICAgICBGaWVsZCA9PiAkRHluYW1pY0ZpZWxkSFRNTC0+e0ZpZWxkfSwKICAgICAgICAgICAgfSwKICAgICAgICApOwoKICAgICAgICAjIGV4YW1wbGUgb2YgZHluYW1pYyBmaWVsZHMgb3JkZXIgY3VzdG9taXphdGlvbgogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdEeW5hbWljRmllbGRfJyAuICREeW5hbWljRmllbGRDb25maWctPntOYW1lfSwKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBOYW1lICA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnLT57TmFtZX0sCiAgICAgICAgICAgICAgICBMYWJlbCA9PiAkRHluYW1pY0ZpZWxkSFRNTC0+e0xhYmVsfSwKICAgICAgICAgICAgICAgIEZpZWxkID0+ICREeW5hbWljRmllbGRIVE1MLT57RmllbGR9LAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICB9CgogICAgIyBzaG93IHRpbWUgYWNjb3VudGluZyBib3gKICAgIGlmICggJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpBY2NvdW50VGltZScpICkgewogICAgICAgICRQYXJhbXtUaW1lVW5pdHNCbG9ja30gPSAkTGF5b3V0T2JqZWN0LT5UaW1lVW5pdHMoCiAgICAgICAgICAgICVQYXJhbSwKICAgICAgICApOwogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdUaW1lVW5pdHMnLAogICAgICAgICAgICBEYXRhID0+IFwlUGFyYW0sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIFNob3cgdGhlIGN1c3RvbWVyIHVzZXIgYWRkcmVzcyBib29rIGlmIHRoZSBtb2R1bGUgaXMgcmVnaXN0ZXJlZCBhbmQgamF2YSBzY3JpcHQgc3VwcG9ydCBpcyBhdmFpbGFibGUuCiAgICBpZiAoCiAgICAgICAgJENvbmZpZ09iamVjdC0+R2V0KCdGcm9udGVuZDo6TW9kdWxlJyktPntBZ2VudEN1c3RvbWVyVXNlckFkZHJlc3NCb29rfQogICAgICAgICYmICRMYXlvdXRPYmplY3QtPntCcm93c2VySmF2YVNjcmlwdFN1cHBvcnR9CiAgICAgICAgKQogICAgewogICAgICAgICRQYXJhbXtPcHRpb25DdXN0b21lclVzZXJBZGRyZXNzQm9va30gPSAxOwogICAgfQoKICAgICMgc2hvdyBjdXN0b21lciBlZGl0IGxpbmsKICAgIG15ICRPcHRpb25DdXN0b21lciA9ICRMYXlvdXRPYmplY3QtPlBlcm1pc3Npb24oCiAgICAgICAgQWN0aW9uID0+ICdBZG1pbkN1c3RvbWVyVXNlcicsCiAgICAgICAgVHlwZSAgID0+ICdydycsCiAgICApOwoKICAgIG15ICRTaG93bk9wdGlvbnNCbG9jazsKCiAgICBpZiAoJE9wdGlvbkN1c3RvbWVyKSB7CgogICAgICAgICMgY2hlY2sgaWYgbmVlZCB0byBjYWxsIE9wdGlvbnMgYmxvY2sKICAgICAgICBpZiAoICEkU2hvd25PcHRpb25zQmxvY2sgKSB7CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgTmFtZSA9PiAnVGlja2V0T3B0aW9ucycsCiAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICApOwoKICAgICAgICAgICAgIyBzZXQgZmxhZyB0byAidHJ1ZSIgaW4gb3JkZXIgdG8gcHJldmVudCBjYWxsaW5nIHRoZSBPcHRpb25zIGJsb2NrIGFnYWluCiAgICAgICAgICAgICRTaG93bk9wdGlvbnNCbG9jayA9IDE7CiAgICAgICAgfQoKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnT3B0aW9uQ3VzdG9tZXInLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgfSwKICAgICAgICApOwogICAgfQoKICAgICMgc2hvdyBhdHRhY2htZW50cwogICAgQVRUQUNITUVOVDoKICAgIGZvciBteSAkQXR0YWNobWVudCAoIEB7ICRQYXJhbXtBdHRhY2htZW50c30gfSApIHsKICAgICAgICBpZiAoCiAgICAgICAgICAgICRBdHRhY2htZW50LT57Q29udGVudElEfQogICAgICAgICAgICAmJiAkTGF5b3V0T2JqZWN0LT57QnJvd3NlclJpY2hUZXh0fQogICAgICAgICAgICAmJiAoICRBdHRhY2htZW50LT57Q29udGVudFR5cGV9ID1+IC9pbWFnZS9pICkKICAgICAgICAgICAgJiYgKCAkQXR0YWNobWVudC0+e0Rpc3Bvc2l0aW9ufSBlcSAnaW5saW5lJyApCiAgICAgICAgICAgICkKICAgICAgICB7CiAgICAgICAgICAgIG5leHQgQVRUQUNITUVOVDsKICAgICAgICB9CgogICAgICAgIHB1c2ggQHsgJFBhcmFte0F0dGFjaG1lbnRMaXN0fSB9LCAkQXR0YWNobWVudDsKICAgIH0KCiAgICAjIGFkZCByaWNoIHRleHQgZWRpdG9yCiAgICBpZiAoICRMYXlvdXRPYmplY3QtPntCcm93c2VyUmljaFRleHR9ICkgewoKICAgICAgICAjIHVzZSBoZWlnaHQvd2lkdGggZGVmaW5lZCBmb3IgdGhpcyBzY3JlZW4KICAgICAgICAkUGFyYW17UmljaFRleHRIZWlnaHR9ID0gJENvbmZpZy0+e1JpY2hUZXh0SGVpZ2h0fSB8fCAwOwogICAgICAgICRQYXJhbXtSaWNoVGV4dFdpZHRofSAgPSAkQ29uZmlnLT57UmljaFRleHRXaWR0aH0gIHx8IDA7CgogICAgICAgICMgc2V0IHVwIHJpY2ggdGV4dCBlZGl0b3IKICAgICAgICAkTGF5b3V0T2JqZWN0LT5TZXRSaWNoVGV4dFBhcmFtZXRlcnMoCiAgICAgICAgICAgIERhdGEgPT4gXCVQYXJhbSwKICAgICAgICApOwogICAgfQoKICAgICMgZ2V0IG91dHB1dCBiYWNrCiAgICByZXR1cm4gJExheW91dE9iamVjdC0+T3V0cHV0KAogICAgICAgIFRlbXBsYXRlRmlsZSA9PiAnQWdlbnRUaWNrZXRFbWFpbCcsCiAgICAgICAgRGF0YSAgICAgICAgID0+IFwlUGFyYW0KICAgICk7Cn0KCnN1YiBfR2V0RmllbGRzVG9VcGRhdGUgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSBAVXBkYXRhYmxlRmllbGRzOwoKICAgICMgc2V0IHRoZSBmaWVsZHMgdGhhdCBjYW4gYmUgdXBkYXRlYWJsZSB2aWEgQUpBWFVwZGF0ZQogICAgaWYgKCAhJFBhcmFte09ubHlEeW5hbWljRmllbGRzfSApIHsKICAgICAgICBAVXBkYXRhYmxlRmllbGRzID0gcXcoCiAgICAgICAgICAgIFR5cGVJRCBEZXN0IE5leHRTdGF0ZUlEIFByaW9yaXR5SUQgU2VydmljZUlEIFNMQUlEIFNpZ25LZXlJRCBDcnlwdEtleUlEIFRvIENjIEJjYwogICAgICAgICAgICBTdGFuZGFyZFRlbXBsYXRlSUQKICAgICAgICApOwogICAgfQoKICAgICMgY3ljbGUgdGhyb3VnaCB0aGUgYWN0aXZhdGVkIER5bmFtaWMgRmllbGRzIGZvciB0aGlzIHNjcmVlbgogICAgRFlOQU1JQ0ZJRUxEOgogICAgZm9yIG15ICREeW5hbWljRmllbGRDb25maWcgKCBAeyAkU2VsZi0+e0R5bmFtaWNGaWVsZH0gfSApIHsKICAgICAgICBuZXh0IERZTkFNSUNGSUVMRCBpZiAhSXNIYXNoUmVmV2l0aERhdGEoJER5bmFtaWNGaWVsZENvbmZpZyk7CgogICAgICAgIG15ICRJc0FDTFJlZHVjaWJsZSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEeW5hbWljRmllbGQ6OkJhY2tlbmQnKS0+SGFzQmVoYXZpb3IoCiAgICAgICAgICAgIER5bmFtaWNGaWVsZENvbmZpZyA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnLAogICAgICAgICAgICBCZWhhdmlvciAgICAgICAgICAgPT4gJ0lzQUNMUmVkdWNpYmxlJywKICAgICAgICApOwogICAgICAgIG5leHQgRFlOQU1JQ0ZJRUxEIGlmICEkSXNBQ0xSZWR1Y2libGU7CgogICAgICAgIHB1c2ggQFVwZGF0YWJsZUZpZWxkcywgJ0R5bmFtaWNGaWVsZF8nIC4gJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9OwogICAgfQoKICAgIHJldHVybiBcQFVwZGF0YWJsZUZpZWxkczsKfQoKMTsK</File>
        <File Location="Custom/Kernel/Modules/AgentTicketEmailResend.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxLTIwMjIgWm51bnkgR21iSCwgaHR0cHM6Ly96bnVueS5vcmcvCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6TW9kdWxlczo6QWdlbnRUaWNrZXRFbWFpbFJlc2VuZDsKCnVzZSBzdHJpY3Q7CnVzZSB3YXJuaW5nczsKCnVzZSBLZXJuZWw6OlN5c3RlbTo6VmFyaWFibGVDaGVjayBxdyg6YWxsKTsKdXNlIEtlcm5lbDo6TGFuZ3VhZ2UgcXcoVHJhbnNsYXRhYmxlKTsKdXNlIE1haWw6OkFkZHJlc3M7CgpvdXIgJE9iamVjdE1hbmFnZXJEaXNhYmxlZCA9IDE7CgpzdWIgbmV3IHsKICAgIG15ICggJFR5cGUsICVQYXJhbSApID0gQF87CgogICAgbXkgJFNlbGYgPSB7JVBhcmFtfTsKICAgIGJsZXNzKCAkU2VsZiwgJFR5cGUgKTsKCiAgICAkU2VsZi0+e0RlYnVnfSA9ICRQYXJhbXtEZWJ1Z30gfHwgMDsKCiAgICAjIEdldCBmb3JtIElELgogICAgJFNlbGYtPntGb3JtSUR9ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OldlYjo6UmVxdWVzdCcpLT5HZXRQYXJhbSggUGFyYW0gPT4gJ0Zvcm1JRCcgKTsKCiAgICAjIENyZWF0ZSBuZXcgZm9ybSBJRC4KICAgIGlmICggISRTZWxmLT57Rm9ybUlEfSApIHsKICAgICAgICAkU2VsZi0+e0Zvcm1JRH0gPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6V2ViOjpVcGxvYWRDYWNoZScpLT5Gb3JtSURDcmVhdGUoKTsKICAgIH0KCiAgICByZXR1cm4gJFNlbGY7Cn0KCnN1YiBSdW4gewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwoKICAgIGlmICggISRTZWxmLT57VGlja2V0SUR9ICkgewogICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5FcnJvclNjcmVlbigKICAgICAgICAgICAgTWVzc2FnZSA9PiBUcmFuc2xhdGFibGUoJ05vIFRpY2tldElEIGlzIGdpdmVuIScpLAogICAgICAgICAgICBDb21tZW50ID0+IFRyYW5zbGF0YWJsZSgnUGxlYXNlIGNvbnRhY3QgdGhlIGFkbWluaXN0cmF0b3IuJyksCiAgICAgICAgKTsKICAgIH0KCiAgICBteSAkQ29uZmlnT2JqZWN0ICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CiAgICBteSAkVGlja2V0T2JqZWN0ICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpUaWNrZXQnKTsKICAgIG15ICRBcnRpY2xlT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpY2tldDo6QXJ0aWNsZScpOwoKICAgIG15ICRBcnRpY2xlQmFja2VuZE9iamVjdCA9ICRBcnRpY2xlT2JqZWN0LT5CYWNrZW5kRm9yQ2hhbm5lbCggQ2hhbm5lbE5hbWUgPT4gJ0VtYWlsJyApOwoKICAgICMgR2V0IGNvbmZpZyBmb3IgZnJvbnRlbmQgbW9kdWxlLgogICAgbXkgJENvbmZpZyA9ICRDb25maWdPYmplY3QtPkdldCgiVGlja2V0OjpGcm9udGVuZDo6JFNlbGYtPntBY3Rpb259Iik7CgogICAgIyBDaGVjayBwZXJtaXNzaW9ucy4KICAgIG15ICRBY2Nlc3MgPSAkVGlja2V0T2JqZWN0LT5UaWNrZXRQZXJtaXNzaW9uKAogICAgICAgIFR5cGUgICAgID0+ICRDb25maWctPntQZXJtaXNzaW9ufSwKICAgICAgICBUaWNrZXRJRCA9PiAkU2VsZi0+e1RpY2tldElEfSwKICAgICAgICBVc2VySUQgICA9PiAkU2VsZi0+e1VzZXJJRH0KICAgICk7CgogICAgIyBFcnJvciBzY3JlZW4sIGRvbid0IHNob3cgYXJ0aWNsZSBhY3Rpb24uCiAgICBpZiAoICEkQWNjZXNzICkgewogICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5Ob1Blcm1pc3Npb24oCiAgICAgICAgICAgIE1lc3NhZ2UgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCAnWW91IG5lZWQgJXMgcGVybWlzc2lvbnMhJywgJENvbmZpZy0+e1Blcm1pc3Npb259ICksCiAgICAgICAgICAgIFdpdGhIZWFkZXIgPT4gJ3llcycsCiAgICAgICAgKTsKICAgIH0KCiAgICAjIEdldCBBQ0wgcmVzdHJpY3Rpb25zLgogICAgbXkgJVBvc3NpYmxlQWN0aW9ucyA9ICggMSA9PiAkU2VsZi0+e0FjdGlvbn0gKTsKCiAgICBteSAkQUNMID0gJFRpY2tldE9iamVjdC0+VGlja2V0QWNsKAogICAgICAgIERhdGEgICAgICAgICAgPT4gXCVQb3NzaWJsZUFjdGlvbnMsCiAgICAgICAgQWN0aW9uICAgICAgICA9PiAkU2VsZi0+e0FjdGlvbn0sCiAgICAgICAgVGlja2V0SUQgICAgICA9PiAkU2VsZi0+e1RpY2tldElEfSwKICAgICAgICBSZXR1cm5UeXBlICAgID0+ICdBY3Rpb24nLAogICAgICAgIFJldHVyblN1YlR5cGUgPT4gJy0nLAogICAgICAgIFVzZXJJRCAgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgKTsKICAgIG15ICVBY2xBY3Rpb24gPSAkVGlja2V0T2JqZWN0LT5UaWNrZXRBY2xBY3Rpb25EYXRhKCk7CgogICAgIyBDaGVjayBpZiBBQ0wgcmVzdHJpY3Rpb25zIGV4aXN0LgogICAgaWYgKCAkQUNMIHx8IElzSGFzaFJlZldpdGhEYXRhKCBcJUFjbEFjdGlvbiApICkgewoKICAgICAgICBteSAlQWNsQWN0aW9uTG9va3VwID0gcmV2ZXJzZSAlQWNsQWN0aW9uOwoKICAgICAgICAjIFNob3cgZXJyb3Igc2NyZWVuIGlmIEFDTCBwcm9oaWJpdHMgdGhpcyBhY3Rpb24uCiAgICAgICAgaWYgKCAhJEFjbEFjdGlvbkxvb2t1cHsgJFNlbGYtPntBY3Rpb259IH0gKSB7CiAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5Ob1Blcm1pc3Npb24oIFdpdGhIZWFkZXIgPT4gJ3llcycgKTsKICAgICAgICB9CiAgICB9CgogICAgbXkgJVRpY2tldCA9ICRUaWNrZXRPYmplY3QtPlRpY2tldEdldCgKICAgICAgICBUaWNrZXRJRCAgICAgID0+ICRTZWxmLT57VGlja2V0SUR9LAogICAgICAgIER5bmFtaWNGaWVsZHMgPT4gMQogICAgKTsKCiAgICAjIEdldCBsb2NrIHN0YXRlLgogICAgbXkgJFRpY2tldEJhY2tUeXBlID0gJ1RpY2tldEJhY2snOwogICAgaWYgKCAkQ29uZmlnLT57UmVxdWlyZWRMb2NrfSApIHsKICAgICAgICBpZiAoICEkVGlja2V0T2JqZWN0LT5UaWNrZXRMb2NrR2V0KCBUaWNrZXRJRCA9PiAkU2VsZi0+e1RpY2tldElEfSApICkgewoKICAgICAgICAgICAgbXkgJExvY2sgPSAkVGlja2V0T2JqZWN0LT5UaWNrZXRMb2NrU2V0KAogICAgICAgICAgICAgICAgVGlja2V0SUQgPT4gJFNlbGYtPntUaWNrZXRJRH0sCiAgICAgICAgICAgICAgICBMb2NrICAgICA9PiAnbG9jaycsCiAgICAgICAgICAgICAgICBVc2VySUQgICA9PiAkU2VsZi0+e1VzZXJJRH0KICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgU2V0IG5ldyBvd25lciBpZiB0aWNrZXQgb3duZXIgaXMgZGlmZmVyZW50IHRoZW4gbG9nZ2VkIHVzZXIuCiAgICAgICAgICAgIGlmICggJExvY2sgJiYgKCAkVGlja2V0e093bmVySUR9ICE9ICRTZWxmLT57VXNlcklEfSApICkgewoKICAgICAgICAgICAgICAgICMgUmVtZW1iZXIgcHJldmlvdXMgb3duZXIsIHdoaWNoIHdpbGwgYmUgdXNlZCB0byByZXN0b3JlIHRpY2tldCBvd25lciBvbiB1bmRvIGFjdGlvbi4KICAgICAgICAgICAgICAgICRUaWNrZXR7UHJldmlvdXNPd25lcn0gPSAkVGlja2V0e093bmVySUR9OwoKICAgICAgICAgICAgICAgIG15ICRTdWNjZXNzID0gJFRpY2tldE9iamVjdC0+VGlja2V0T3duZXJTZXQoCiAgICAgICAgICAgICAgICAgICAgVGlja2V0SUQgID0+ICRTZWxmLT57VGlja2V0SUR9LAogICAgICAgICAgICAgICAgICAgIFVzZXJJRCAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICAgICAgICAgTmV3VXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgIyBTaG93IGxvY2sgc3RhdGUuCiAgICAgICAgICAgICAgICBpZiAoICEkU3VjY2VzcyApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAkVGlja2V0QmFja1R5cGUgLj0gJ1VuZG8nOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgbXkgJEFjY2Vzc09rID0gJFRpY2tldE9iamVjdC0+T3duZXJDaGVjaygKICAgICAgICAgICAgICAgIFRpY2tldElEID0+ICRTZWxmLT57VGlja2V0SUR9LAogICAgICAgICAgICAgICAgT3duZXJJRCAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICApOwogICAgICAgICAgICBpZiAoICEkQWNjZXNzT2sgKSB7CiAgICAgICAgICAgICAgICBteSAkT3V0cHV0ID0gJExheW91dE9iamVjdC0+SGVhZGVyKAogICAgICAgICAgICAgICAgICAgIFZhbHVlICAgICA9PiAkVGlja2V0e051bWJlcn0sCiAgICAgICAgICAgICAgICAgICAgVHlwZSAgICAgID0+ICdTbWFsbCcsCiAgICAgICAgICAgICAgICAgICAgQm9keUNsYXNzID0+ICdQb3B1cCcsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5XYXJuaW5nKAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gVHJhbnNsYXRhYmxlKCdTb3JyeSwgeW91IG5lZWQgdG8gYmUgdGhlIHRpY2tldCBvd25lciB0byBwZXJmb3JtIHRoaXMgYWN0aW9uLicpLAogICAgICAgICAgICAgICAgICAgIENvbW1lbnQgPT4gVHJhbnNsYXRhYmxlKCdQbGVhc2UgY2hhbmdlIHRoZSBvd25lciBmaXJzdC4nKSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPkZvb3RlcigKICAgICAgICAgICAgICAgICAgICBUeXBlID0+ICdTbWFsbCcsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgcmV0dXJuICRPdXRwdXQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgbXkgJFBhcmFtT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OldlYjo6UmVxdWVzdCcpOwoKICAgIG15ICVHZXRQYXJhbTsKICAgIGZvciBteSAkUGFyYW0gKAogICAgICAgIHF3KCBGcm9tIFRvIENjIEJjYyBTdWJqZWN0IEJvZHkgSW5SZXBseVRvIFJlZmVyZW5jZXMgQXJ0aWNsZUlEIElzVmlzaWJsZUZvckN1c3RvbWVyUHJlc2VudCBJc1Zpc2libGVGb3JDdXN0b21lciBUaW1lVW5pdHMgRm9ybUlEKQogICAgICAgICkKICAgIHsKICAgICAgICAkR2V0UGFyYW17JFBhcmFtfSA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICRQYXJhbSApOwogICAgfQoKICAgIGlmICggISRHZXRQYXJhbXtBcnRpY2xlSUR9ICkgewogICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5FcnJvclNjcmVlbigKICAgICAgICAgICAgTWVzc2FnZSA9PiBUcmFuc2xhdGFibGUoJ05vIEFydGljbGVJRCBpcyBnaXZlbiEnKSwKICAgICAgICAgICAgQ29tbWVudCA9PiBUcmFuc2xhdGFibGUoJ1BsZWFzZSBjb250YWN0IHRoZSBhZG1pbmlzdHJhdG9yLicpLAogICAgICAgICk7CiAgICB9CgogICAgIyBIYXNoIGZvciBsb29rdXAgb2YgZHVwbGljYXRlZCBlbnRyaWVzLgogICAgbXkgJUFkZHJlc3Nlc0xpc3Q7CgogICAgbXkgQE11bHRpcGxlQ3VzdG9tZXI7CiAgICBteSAkQ3VzdG9tZXJzTnVtYmVyID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0N1c3RvbWVyVGlja2V0Q291bnRlclRvQ3VzdG9tZXInICkgfHwgMDsKICAgIG15ICRTZWxlY3RlZCAgICAgICAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQ3VzdG9tZXJTZWxlY3RlZCcgKSAgICAgICAgICAgICAgICB8fCAnJzsKCiAgICBteSAkQ2hlY2tJdGVtT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNoZWNrSXRlbScpOwoKICAgIGlmICgkQ3VzdG9tZXJzTnVtYmVyKSB7CgogICAgICAgIG15ICRDdXN0b21lckNvdW50ZXIgPSAxOwogICAgICAgIGZvciBteSAkQ291bnQgKCAxIC4uLiAkQ3VzdG9tZXJzTnVtYmVyICkgewogICAgICAgICAgICBteSAkQ3VzdG9tZXJFbGVtZW50ICA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdDdXN0b21lclRpY2tldFRleHRfJyAuICRDb3VudCApOwogICAgICAgICAgICBteSAkQ3VzdG9tZXJTZWxlY3RlZCA9ICggJFNlbGVjdGVkIGVxICRDb3VudCA/ICdjaGVja2VkPSJjaGVja2VkIicgOiAnJyApOwogICAgICAgICAgICBteSAkQ3VzdG9tZXJLZXkgICAgICA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdDdXN0b21lcktleV8nIC4gJENvdW50ICkKICAgICAgICAgICAgICAgIHx8ICcnOwogICAgICAgICAgICBteSAkQ3VzdG9tZXJRdWV1ZSA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdDdXN0b21lclF1ZXVlXycgLiAkQ291bnQgKQogICAgICAgICAgICAgICAgfHwgJyc7CiAgICAgICAgICAgIGlmICgkQ3VzdG9tZXJFbGVtZW50KSB7CgogICAgICAgICAgICAgICAgaWYgKCAkR2V0UGFyYW17VG99ICkgewogICAgICAgICAgICAgICAgICAgICRHZXRQYXJhbXtUb30gLj0gJywgJyAuICRDdXN0b21lckVsZW1lbnQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkR2V0UGFyYW17VG99ID0gJEN1c3RvbWVyRWxlbWVudDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIENoZWNrIGVtYWlsIGFkZHJlc3MuCiAgICAgICAgICAgICAgICBteSAkQ3VzdG9tZXJFcnJvck1zZyA9ICdDdXN0b21lckdlbmVyaWNTZXJ2ZXJFcnJvck1zZyc7CiAgICAgICAgICAgICAgICBteSAkQ3VzdG9tZXJFcnJvciAgICA9ICcnOwogICAgICAgICAgICAgICAgZm9yIG15ICRFbWFpbCAoIE1haWw6OkFkZHJlc3MtPnBhcnNlKCRDdXN0b21lckVsZW1lbnQpICkgewogICAgICAgICAgICAgICAgICAgIGlmICggISRDaGVja0l0ZW1PYmplY3QtPkNoZWNrRW1haWwoIEFkZHJlc3MgPT4gJEVtYWlsLT5hZGRyZXNzKCkgKSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJEN1c3RvbWVyRXJyb3JNc2cgPSAkQ2hlY2tJdGVtT2JqZWN0LT5DaGVja0Vycm9yVHlwZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuICdTZXJ2ZXJFcnJvck1zZyc7CiAgICAgICAgICAgICAgICAgICAgICAgICRDdXN0b21lckVycm9yID0gJ1NlcnZlckVycm9yJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBDaGVjayBmb3IgZHVwbGljYXRlZCBlbnRyaWVzLgogICAgICAgICAgICAgICAgaWYgKCBkZWZpbmVkICRBZGRyZXNzZXNMaXN0eyRDdXN0b21lckVsZW1lbnR9ICYmICRDdXN0b21lckVycm9yIGVxICcnICkgewogICAgICAgICAgICAgICAgICAgICRDdXN0b21lckVycm9yTXNnID0gJ0lzRHVwbGljYXRlZFNlcnZlckVycm9yTXNnJzsKICAgICAgICAgICAgICAgICAgICAkQ3VzdG9tZXJFcnJvciAgICA9ICdTZXJ2ZXJFcnJvcic7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbXkgJEN1c3RvbWVyRGlzYWJsZWQgPSAnJzsKICAgICAgICAgICAgICAgIG15ICRDb3VudEF1eCAgICAgICAgID0gJEN1c3RvbWVyQ291bnRlcisrOwogICAgICAgICAgICAgICAgaWYgKCAkQ3VzdG9tZXJFcnJvciBuZSAnJyApIHsKICAgICAgICAgICAgICAgICAgICAkQ3VzdG9tZXJEaXNhYmxlZCA9ICdkaXNhYmxlZD0iZGlzYWJsZWQiJzsKICAgICAgICAgICAgICAgICAgICAkQ291bnRBdXggICAgICAgICA9ICRDb3VudCAuICdFcnJvcic7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCAkQ3VzdG9tZXJRdWV1ZSBuZSAnJyApIHsKICAgICAgICAgICAgICAgICAgICAkQ3VzdG9tZXJRdWV1ZSA9ICRDb3VudDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBwdXNoIEBNdWx0aXBsZUN1c3RvbWVyLCB7CiAgICAgICAgICAgICAgICAgICAgQ291bnQgICAgICAgICAgICA9PiAkQ291bnRBdXgsCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJFbGVtZW50ICA9PiAkQ3VzdG9tZXJFbGVtZW50LAogICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyU2VsZWN0ZWQgPT4gJEN1c3RvbWVyU2VsZWN0ZWQsCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJLZXkgICAgICA9PiAkQ3VzdG9tZXJLZXksCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJFcnJvciAgICA9PiAkQ3VzdG9tZXJFcnJvciwKICAgICAgICAgICAgICAgICAgICBDdXN0b21lckVycm9yTXNnID0+ICRDdXN0b21lckVycm9yTXNnLAogICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyRGlzYWJsZWQgPT4gJEN1c3RvbWVyRGlzYWJsZWQsCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJRdWV1ZSAgICA9PiAkQ3VzdG9tZXJRdWV1ZSwKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAkQWRkcmVzc2VzTGlzdHskQ3VzdG9tZXJFbGVtZW50fSA9IDE7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgbXkgQE11bHRpcGxlQ3VzdG9tZXJDYzsKICAgIG15ICRDdXN0b21lcnNOdW1iZXJDYyA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdDdXN0b21lclRpY2tldENvdW50ZXJDY0N1c3RvbWVyJyApIHx8IDA7CgogICAgaWYgKCRDdXN0b21lcnNOdW1iZXJDYykgewogICAgICAgIG15ICRDdXN0b21lckNvdW50ZXJDYyA9IDE7CiAgICAgICAgZm9yIG15ICRDb3VudCAoIDEgLi4uICRDdXN0b21lcnNOdW1iZXJDYyApIHsKICAgICAgICAgICAgbXkgJEN1c3RvbWVyRWxlbWVudENjID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0NjQ3VzdG9tZXJUaWNrZXRUZXh0XycgLiAkQ291bnQgKTsKICAgICAgICAgICAgbXkgJEN1c3RvbWVyS2V5Q2MgICAgID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0NjQ3VzdG9tZXJLZXlfJyAuICRDb3VudCApCiAgICAgICAgICAgICAgICB8fCAnJzsKICAgICAgICAgICAgbXkgJEN1c3RvbWVyUXVldWVDYyA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdDY0N1c3RvbWVyUXVldWVfJyAuICRDb3VudCApCiAgICAgICAgICAgICAgICB8fCAnJzsKCiAgICAgICAgICAgIGlmICgkQ3VzdG9tZXJFbGVtZW50Q2MpIHsKCiAgICAgICAgICAgICAgICBpZiAoICRHZXRQYXJhbXtDY30gKSB7CiAgICAgICAgICAgICAgICAgICAgJEdldFBhcmFte0NjfSAuPSAnLCAnIC4gJEN1c3RvbWVyRWxlbWVudENjOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJEdldFBhcmFte0NjfSA9ICRDdXN0b21lckVsZW1lbnRDYzsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIGNoZWNrIGVtYWlsIGFkZHJlc3MKICAgICAgICAgICAgICAgIG15ICRDdXN0b21lckVycm9yTXNnQ2MgPSAnQ3VzdG9tZXJHZW5lcmljU2VydmVyRXJyb3JNc2cnOwogICAgICAgICAgICAgICAgbXkgJEN1c3RvbWVyRXJyb3JDYyAgICA9ICcnOwogICAgICAgICAgICAgICAgZm9yIG15ICRFbWFpbCAoIE1haWw6OkFkZHJlc3MtPnBhcnNlKCRDdXN0b21lckVsZW1lbnRDYykgKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCAhJENoZWNrSXRlbU9iamVjdC0+Q2hlY2tFbWFpbCggQWRkcmVzcyA9PiAkRW1haWwtPmFkZHJlc3MoKSApICkgewogICAgICAgICAgICAgICAgICAgICAgICAkQ3VzdG9tZXJFcnJvck1zZ0NjID0gJENoZWNrSXRlbU9iamVjdC0+Q2hlY2tFcnJvclR5cGUoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLiAnU2VydmVyRXJyb3JNc2cnOwogICAgICAgICAgICAgICAgICAgICAgICAkQ3VzdG9tZXJFcnJvckNjID0gJ1NlcnZlckVycm9yJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBjaGVjayBmb3IgZHVwbGljYXRlZCBlbnRyaWVzCiAgICAgICAgICAgICAgICBpZiAoIGRlZmluZWQgJEFkZHJlc3Nlc0xpc3R7JEN1c3RvbWVyRWxlbWVudENjfSAmJiAkQ3VzdG9tZXJFcnJvckNjIGVxICcnICkgewogICAgICAgICAgICAgICAgICAgICRDdXN0b21lckVycm9yTXNnQ2MgPSAnSXNEdXBsaWNhdGVkU2VydmVyRXJyb3JNc2cnOwogICAgICAgICAgICAgICAgICAgICRDdXN0b21lckVycm9yQ2MgICAgPSAnU2VydmVyRXJyb3InOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG15ICRDdXN0b21lckRpc2FibGVkQ2MgPSAnJzsKICAgICAgICAgICAgICAgIG15ICRDb3VudEF1eENjICAgICAgICAgPSAkQ3VzdG9tZXJDb3VudGVyQ2MrKzsKICAgICAgICAgICAgICAgIGlmICggJEN1c3RvbWVyRXJyb3JDYyBuZSAnJyApIHsKICAgICAgICAgICAgICAgICAgICAkQ3VzdG9tZXJEaXNhYmxlZENjID0gJ2Rpc2FibGVkPSJkaXNhYmxlZCInOwogICAgICAgICAgICAgICAgICAgICRDb3VudEF1eENjICAgICAgICAgPSAkQ291bnQgLiAnRXJyb3InOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICggJEN1c3RvbWVyUXVldWVDYyBuZSAnJyApIHsKICAgICAgICAgICAgICAgICAgICAkQ3VzdG9tZXJRdWV1ZUNjID0gJENvdW50OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHB1c2ggQE11bHRpcGxlQ3VzdG9tZXJDYywgewogICAgICAgICAgICAgICAgICAgIENvdW50ICAgICAgICAgICAgPT4gJENvdW50QXV4Q2MsCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJFbGVtZW50ICA9PiAkQ3VzdG9tZXJFbGVtZW50Q2MsCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJLZXkgICAgICA9PiAkQ3VzdG9tZXJLZXlDYywKICAgICAgICAgICAgICAgICAgICBDdXN0b21lckVycm9yICAgID0+ICRDdXN0b21lckVycm9yQ2MsCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJFcnJvck1zZyA9PiAkQ3VzdG9tZXJFcnJvck1zZ0NjLAogICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyRGlzYWJsZWQgPT4gJEN1c3RvbWVyRGlzYWJsZWRDYywKICAgICAgICAgICAgICAgICAgICBDdXN0b21lclF1ZXVlICAgID0+ICRDdXN0b21lclF1ZXVlQ2MsCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgJEFkZHJlc3Nlc0xpc3R7JEN1c3RvbWVyRWxlbWVudENjfSA9IDE7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgbXkgQE11bHRpcGxlQ3VzdG9tZXJCY2M7CiAgICBteSAkQ3VzdG9tZXJzTnVtYmVyQmNjID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0N1c3RvbWVyVGlja2V0Q291bnRlckJjY0N1c3RvbWVyJyApIHx8IDA7CgogICAgaWYgKCRDdXN0b21lcnNOdW1iZXJCY2MpIHsKICAgICAgICBteSAkQ3VzdG9tZXJDb3VudGVyQmNjID0gMTsKICAgICAgICBmb3IgbXkgJENvdW50ICggMSAuLi4gJEN1c3RvbWVyc051bWJlckJjYyApIHsKICAgICAgICAgICAgbXkgJEN1c3RvbWVyRWxlbWVudEJjYyA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdCY2NDdXN0b21lclRpY2tldFRleHRfJyAuICRDb3VudCApOwogICAgICAgICAgICBteSAkQ3VzdG9tZXJLZXlCY2MgICAgID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0JjY0N1c3RvbWVyS2V5XycgLiAkQ291bnQgKQogICAgICAgICAgICAgICAgfHwgJyc7CiAgICAgICAgICAgIG15ICRDdXN0b21lclF1ZXVlQmNjID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0JjY0N1c3RvbWVyUXVldWVfJyAuICRDb3VudCApCiAgICAgICAgICAgICAgICB8fCAnJzsKCiAgICAgICAgICAgIGlmICgkQ3VzdG9tZXJFbGVtZW50QmNjKSB7CgogICAgICAgICAgICAgICAgaWYgKCAkR2V0UGFyYW17QmNjfSApIHsKICAgICAgICAgICAgICAgICAgICAkR2V0UGFyYW17QmNjfSAuPSAnLCAnIC4gJEN1c3RvbWVyRWxlbWVudEJjYzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRHZXRQYXJhbXtCY2N9ID0gJEN1c3RvbWVyRWxlbWVudEJjYzsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIENoZWNrIGVtYWlsIGFkZHJlc3MuCiAgICAgICAgICAgICAgICBteSAkQ3VzdG9tZXJFcnJvck1zZ0JjYyA9ICdDdXN0b21lckdlbmVyaWNTZXJ2ZXJFcnJvck1zZyc7CiAgICAgICAgICAgICAgICBteSAkQ3VzdG9tZXJFcnJvckJjYyAgICA9ICcnOwogICAgICAgICAgICAgICAgZm9yIG15ICRFbWFpbCAoIE1haWw6OkFkZHJlc3MtPnBhcnNlKCRDdXN0b21lckVsZW1lbnRCY2MpICkgewogICAgICAgICAgICAgICAgICAgIGlmICggISRDaGVja0l0ZW1PYmplY3QtPkNoZWNrRW1haWwoIEFkZHJlc3MgPT4gJEVtYWlsLT5hZGRyZXNzKCkgKSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJEN1c3RvbWVyRXJyb3JNc2dCY2MgPSAkQ2hlY2tJdGVtT2JqZWN0LT5DaGVja0Vycm9yVHlwZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuICdTZXJ2ZXJFcnJvck1zZyc7CiAgICAgICAgICAgICAgICAgICAgICAgICRDdXN0b21lckVycm9yQmNjID0gJ1NlcnZlckVycm9yJzsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBDaGVjayBmb3IgZHVwbGljYXRlZCBlbnRyaWVzLgogICAgICAgICAgICAgICAgaWYgKCBkZWZpbmVkICRBZGRyZXNzZXNMaXN0eyRDdXN0b21lckVsZW1lbnRCY2N9ICYmICRDdXN0b21lckVycm9yQmNjIGVxICcnICkgewogICAgICAgICAgICAgICAgICAgICRDdXN0b21lckVycm9yTXNnQmNjID0gJ0lzRHVwbGljYXRlZFNlcnZlckVycm9yTXNnJzsKICAgICAgICAgICAgICAgICAgICAkQ3VzdG9tZXJFcnJvckJjYyAgICA9ICdTZXJ2ZXJFcnJvcic7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbXkgJEN1c3RvbWVyRGlzYWJsZWRCY2MgPSAnJzsKICAgICAgICAgICAgICAgIG15ICRDb3VudEF1eEJjYyAgICAgICAgID0gJEN1c3RvbWVyQ291bnRlckJjYysrOwogICAgICAgICAgICAgICAgaWYgKCAkQ3VzdG9tZXJFcnJvckJjYyBuZSAnJyApIHsKICAgICAgICAgICAgICAgICAgICAkQ3VzdG9tZXJEaXNhYmxlZEJjYyA9ICdkaXNhYmxlZD0iZGlzYWJsZWQiJzsKICAgICAgICAgICAgICAgICAgICAkQ291bnRBdXhCY2MgICAgICAgICA9ICRDb3VudCAuICdFcnJvcic7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCAkQ3VzdG9tZXJRdWV1ZUJjYyBuZSAnJyApIHsKICAgICAgICAgICAgICAgICAgICAkQ3VzdG9tZXJRdWV1ZUJjYyA9ICRDb3VudDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBwdXNoIEBNdWx0aXBsZUN1c3RvbWVyQmNjLCB7CiAgICAgICAgICAgICAgICAgICAgQ291bnQgICAgICAgICAgICA9PiAkQ291bnRBdXhCY2MsCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJFbGVtZW50ICA9PiAkQ3VzdG9tZXJFbGVtZW50QmNjLAogICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyS2V5ICAgICAgPT4gJEN1c3RvbWVyS2V5QmNjLAogICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyRXJyb3IgICAgPT4gJEN1c3RvbWVyRXJyb3JCY2MsCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJFcnJvck1zZyA9PiAkQ3VzdG9tZXJFcnJvck1zZ0JjYywKICAgICAgICAgICAgICAgICAgICBDdXN0b21lckRpc2FibGVkID0+ICRDdXN0b21lckRpc2FibGVkQmNjLAogICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyUXVldWUgICAgPT4gJEN1c3RvbWVyUXVldWVCY2MsCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgJEFkZHJlc3Nlc0xpc3R7JEN1c3RvbWVyRWxlbWVudEJjY30gPSAxOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIG15ICRVcGxvYWRDYWNoZU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpXZWI6OlVwbG9hZENhY2hlJyk7CiAgICBteSAkTWFpbk9iamVjdCAgICAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TWFpbicpOwoKICAgICMgU2VuZCBlbWFpbC4KICAgIGlmICggJFNlbGYtPntTdWJhY3Rpb259IGVxICdTZW5kRW1haWwnICkgewoKICAgICAgICAjIENoYWxsZW5nZSB0b2tlbiBjaGVjayBmb3Igd3JpdGUgYWN0aW9uLgogICAgICAgICRMYXlvdXRPYmplY3QtPkNoYWxsZW5nZVRva2VuQ2hlY2soKTsKCiAgICAgICAgbXkgJUVycm9yOwoKICAgICAgICBteSAkQ2hlY2tJdGVtT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNoZWNrSXRlbScpOwoKICAgICAgICAjIENoZWNrIHNvbWUgdmFsdWVzLgogICAgICAgIExJTkU6CiAgICAgICAgZm9yIG15ICRMaW5lIChxdyhUbyBDYyBCY2MpKSB7CiAgICAgICAgICAgIG5leHQgTElORSBpZiAhJEdldFBhcmFteyRMaW5lfTsKICAgICAgICAgICAgZm9yIG15ICRFbWFpbCAoIE1haWw6OkFkZHJlc3MtPnBhcnNlKCAkR2V0UGFyYW17JExpbmV9ICkgKSB7CiAgICAgICAgICAgICAgICBpZiAoICEkQ2hlY2tJdGVtT2JqZWN0LT5DaGVja0VtYWlsKCBBZGRyZXNzID0+ICRFbWFpbC0+YWRkcmVzcygpICkgKSB7CiAgICAgICAgICAgICAgICAgICAgJEVycm9yeyAkTGluZSAuICdFcnJvclR5cGUnIH0gPSAkTGluZSAuICRDaGVja0l0ZW1PYmplY3QtPkNoZWNrRXJyb3JUeXBlKCkgLiAnU2VydmVyRXJyb3JNc2cnOwogICAgICAgICAgICAgICAgICAgICRFcnJvcnsgJExpbmUgLiAnSW52YWxpZCcgfSAgID0gJ1NlcnZlckVycm9yJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG15ICRJc0xvY2FsID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlN5c3RlbUFkZHJlc3MnKS0+U3lzdGVtQWRkcmVzc0lzTG9jYWxBZGRyZXNzKAogICAgICAgICAgICAgICAgICAgIEFkZHJlc3MgPT4gJEVtYWlsLT5hZGRyZXNzKCkKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBpZiAoJElzTG9jYWwpIHsKICAgICAgICAgICAgICAgICAgICAkRXJyb3J7ICRMaW5lIC4gJ0lzTG9jYWxBZGRyZXNzJyB9ID0gJ1NlcnZlckVycm9yJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCAkRXJyb3J7VG9Jc0xvY2FsQWRkcmVzc30gKSB7CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgTmFtZSA9PiAnVG9Jc0xvY2FsQWRkcmVzc1NlcnZlckVycm9yTXNnJywKICAgICAgICAgICAgICAgIERhdGEgPT4gXCVHZXRQYXJhbSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIGlmICggJEVycm9ye0NjSXNMb2NhbEFkZHJlc3N9ICkgewogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ0NjSXNMb2NhbEFkZHJlc3NTZXJ2ZXJFcnJvck1zZycsCiAgICAgICAgICAgICAgICBEYXRhID0+IFwlR2V0UGFyYW0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICBpZiAoICRFcnJvcntCY2NJc0xvY2FsQWRkcmVzc30gKSB7CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgTmFtZSA9PiAnQmNjSXNMb2NhbEFkZHJlc3NTZXJ2ZXJFcnJvck1zZycsCiAgICAgICAgICAgICAgICBEYXRhID0+IFwlR2V0UGFyYW0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIEdldCBhbGwgYXR0YWNobWVudHMgbWV0YSBkYXRhLgogICAgICAgIG15IEBBdHRhY2htZW50cyA9ICRVcGxvYWRDYWNoZU9iamVjdC0+Rm9ybUlER2V0QWxsRmlsZXNNZXRhKAogICAgICAgICAgICBGb3JtSUQgPT4gJFNlbGYtPntGb3JtSUR9LAogICAgICAgICk7CgogICAgICAgICMgQ2hlY2sgc29tZSB2YWx1ZXMuCiAgICAgICAgTElORToKICAgICAgICBmb3IgbXkgJExpbmUgKHF3KFRvIENjIEJjYykpIHsKICAgICAgICAgICAgbmV4dCBMSU5FIGlmICEkR2V0UGFyYW17JExpbmV9OwogICAgICAgICAgICBmb3IgbXkgJEVtYWlsICggTWFpbDo6QWRkcmVzcy0+cGFyc2UoICRHZXRQYXJhbXskTGluZX0gKSApIHsKICAgICAgICAgICAgICAgIGlmICggISRDaGVja0l0ZW1PYmplY3QtPkNoZWNrRW1haWwoIEFkZHJlc3MgPT4gJEVtYWlsLT5hZGRyZXNzKCkgKSApIHsKICAgICAgICAgICAgICAgICAgICAkRXJyb3J7ICRMaW5lIC4gJ0ludmFsaWQnIH0gPSAnU2VydmVyRXJyb3InOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIENoZWNrIHN1YmplY3QuCiAgICAgICAgaWYgKCAhJEdldFBhcmFte1N1YmplY3R9ICkgewogICAgICAgICAgICAkRXJyb3J7U3ViamVjdEludmFsaWR9ID0gJyBTZXJ2ZXJFcnJvcic7CiAgICAgICAgfQoKICAgICAgICAjIENoZWNrIGJvZHkuCiAgICAgICAgaWYgKCAhJEdldFBhcmFte0JvZHl9ICkgewogICAgICAgICAgICAkRXJyb3J7Qm9keUludmFsaWR9ID0gJyBTZXJ2ZXJFcnJvcic7CiAgICAgICAgfQoKICAgICAgICAjIENoZWNrIHRpbWUgdW5pdHMuCiAgICAgICAgaWYgKAogICAgICAgICAgICAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6OkFjY291bnRUaW1lJykKICAgICAgICAgICAgJiYgJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpOZWVkQWNjb3VudGVkVGltZScpCiAgICAgICAgICAgICYmICRHZXRQYXJhbXtUaW1lVW5pdHN9IGVxICcnCiAgICAgICAgICAgICkKICAgICAgICB7CiAgICAgICAgICAgICRFcnJvcntUaW1lVW5pdHNJbnZhbGlkfSA9ICdTZXJ2ZXJFcnJvcic7CiAgICAgICAgfQoKICAgICAgICAjIFByZXBhcmUgc3ViamVjdC4KICAgICAgICBteSAkVG4gPSAkVGlja2V0T2JqZWN0LT5UaWNrZXROdW1iZXJMb29rdXAoIFRpY2tldElEID0+ICRTZWxmLT57VGlja2V0SUR9ICk7CiAgICAgICAgJEdldFBhcmFte1N1YmplY3R9ID0gJFRpY2tldE9iamVjdC0+VGlja2V0U3ViamVjdEJ1aWxkKAogICAgICAgICAgICBUaWNrZXROdW1iZXIgPT4gJFRuLAogICAgICAgICAgICBTdWJqZWN0ICAgICAgPT4gJEdldFBhcmFte1N1YmplY3R9IHx8ICcnLAogICAgICAgICk7CgogICAgICAgIG15ICVBcnRpY2xlUGFyYW07CgogICAgICAgICMgUnVuIGNvbXBvc2UgbW9kdWxlcy4KICAgICAgICBpZiAoIHJlZiAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6OkFydGljbGVDb21wb3NlTW9kdWxlJykgZXEgJ0hBU0gnICkgewoKICAgICAgICAgICAgIyBVc2UgdGlja2V0IFF1ZXVlSUQgaW4gY29tcG9zZSBtb2R1bGVzLgogICAgICAgICAgICAkR2V0UGFyYW17UXVldWVJRH0gPSAkVGlja2V0e1F1ZXVlSUR9OwoKICAgICAgICAgICAgbXkgJUpvYnMgPSAleyAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6OkFydGljbGVDb21wb3NlTW9kdWxlJykgfTsKICAgICAgICAgICAgZm9yIG15ICRKb2IgKCBzb3J0IGtleXMgJUpvYnMgKSB7CgogICAgICAgICAgICAgICAgIyBsb2FkIG1vZHVsZQogICAgICAgICAgICAgICAgaWYgKCAhJE1haW5PYmplY3QtPlJlcXVpcmUoICRKb2JzeyRKb2J9LT57TW9kdWxlfSApICkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5GYXRhbEVycm9yKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBteSAkT2JqZWN0ID0gJEpvYnN7JEpvYn0tPntNb2R1bGV9LT5uZXcoICV7JFNlbGZ9LCBEZWJ1ZyA9PiAkU2VsZi0+e0RlYnVnfSApOwoKICAgICAgICAgICAgICAgIG15ICRNdWx0aXBsZTsKCiAgICAgICAgICAgICAgICAjIGdldCBwYXJhbXMKICAgICAgICAgICAgICAgIFBBUkFNRVRFUjoKICAgICAgICAgICAgICAgIGZvciBteSAkUGFyYW1ldGVyICggJE9iamVjdC0+T3B0aW9uKCAlR2V0UGFyYW0sIENvbmZpZyA9PiAkSm9ic3skSm9ifSApICkgewogICAgICAgICAgICAgICAgICAgIGlmICggJEpvYnN7JEpvYn0tPntQYXJhbVR5cGV9ICYmICRKb2JzeyRKb2J9LT57UGFyYW1UeXBlfSBuZSAnU2luZ2xlJyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgQHsgJEdldFBhcmFteyRQYXJhbWV0ZXJ9IH0gPSAkUGFyYW1PYmplY3QtPkdldEFycmF5KCBQYXJhbSA9PiAkUGFyYW1ldGVyICk7CiAgICAgICAgICAgICAgICAgICAgICAgICRNdWx0aXBsZSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIG5leHQgUEFSQU1FVEVSOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJEdldFBhcmFteyRQYXJhbWV0ZXJ9ID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJFBhcmFtZXRlciApOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgUnVuIG1vZHVsZS4KICAgICAgICAgICAgICAgICRPYmplY3QtPlJ1bigKICAgICAgICAgICAgICAgICAgICAlR2V0UGFyYW0sCiAgICAgICAgICAgICAgICAgICAgU3RvcmVOZXcgPT4gMSwKICAgICAgICAgICAgICAgICAgICBDb25maWcgICA9PiAkSm9ic3skSm9ifSwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgIyBHZXQgb3B0aW9ucyB0aGF0IGhhdmUgYmVlbiByZW1vdmVkIGZyb20gdGhlIHNlbGVjdGlvbiBhbmQgYWRkIHRoZW0gYmFjayB0byB0aGUgc2VsZWN0aW9uIHNvIHRoYXQgdGhlCiAgICAgICAgICAgICAgICAjICAgc3VibWl0IHdpbGwgY29udGFpbiBvcHRpb25zIHRoYXQgd2VyZSBoaWRkZW4gZnJvbSB0aGUgYWdlbnQuCiAgICAgICAgICAgICAgICBteSAkS2V5ID0gJE9iamVjdC0+T3B0aW9uKCAlR2V0UGFyYW0sIENvbmZpZyA9PiAkSm9ic3skSm9ifSApOwoKICAgICAgICAgICAgICAgIGlmICggJE9iamVjdC0+Y2FuKCdHZXRPcHRpb25zVG9SZW1vdmVBSkFYJykgKSB7CiAgICAgICAgICAgICAgICAgICAgbXkgQFJlbW92ZWRPcHRpb25zID0gJE9iamVjdC0+R2V0T3B0aW9uc1RvUmVtb3ZlQUpBWCglR2V0UGFyYW0pOwogICAgICAgICAgICAgICAgICAgIGlmIChAUmVtb3ZlZE9wdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRNdWx0aXBsZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIG15ICRSZW1vdmVkT3B0aW9uIChAUmVtb3ZlZE9wdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoIEB7ICRHZXRQYXJhbXskS2V5fSB9LCAkUmVtb3ZlZE9wdGlvbjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRHZXRQYXJhbXskS2V5fSA9IHNoaWZ0IEBSZW1vdmVkT3B0aW9uczsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIFRpY2tldCBwYXJhbXMuCiAgICAgICAgICAgICAgICAlQXJ0aWNsZVBhcmFtID0gKAogICAgICAgICAgICAgICAgICAgICVBcnRpY2xlUGFyYW0sCiAgICAgICAgICAgICAgICAgICAgJE9iamVjdC0+QXJ0aWNsZU9wdGlvbiggJUdldFBhcmFtLCAlQXJ0aWNsZVBhcmFtLCBDb25maWcgPT4gJEpvYnN7JEpvYn0gKSwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgIyBHZXQgZXJyb3JzLgogICAgICAgICAgICAgICAgJUVycm9yID0gKAogICAgICAgICAgICAgICAgICAgICVFcnJvciwKICAgICAgICAgICAgICAgICAgICAkT2JqZWN0LT5FcnJvciggJUdldFBhcmFtLCBDb25maWcgPT4gJEpvYnN7JEpvYn0gKSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgQ2hlY2sgaWYgdGhlcmUgaXMgYW4gZXJyb3IuCiAgICAgICAgaWYgKCVFcnJvcikgewoKICAgICAgICAgICAgbXkgJE91dHB1dCA9ICRMYXlvdXRPYmplY3QtPkhlYWRlcigKICAgICAgICAgICAgICAgIFZhbHVlICAgICA9PiAkVGlja2V0e1RpY2tldE51bWJlcn0sCiAgICAgICAgICAgICAgICBUeXBlICAgICAgPT4gJ1NtYWxsJywKICAgICAgICAgICAgICAgIEJvZHlDbGFzcyA9PiAnUG9wdXAnLAogICAgICAgICAgICApOwogICAgICAgICAgICAkR2V0UGFyYW17U3RhbmRhcmRSZXNwb25zZX0gPSAkR2V0UGFyYW17Qm9keX07CiAgICAgICAgICAgICRPdXRwdXQgLj0gJFNlbGYtPl9NYXNrKAogICAgICAgICAgICAgICAgVGlja2V0SUQgICAgICAgICAgICA9PiAkU2VsZi0+e1RpY2tldElEfSwKICAgICAgICAgICAgICAgIEVycm9ycyAgICAgICAgICAgICAgPT4gXCVFcnJvciwKICAgICAgICAgICAgICAgIE11bHRpcGxlQ3VzdG9tZXIgICAgPT4gXEBNdWx0aXBsZUN1c3RvbWVyLAogICAgICAgICAgICAgICAgTXVsdGlwbGVDdXN0b21lckNjICA9PiBcQE11bHRpcGxlQ3VzdG9tZXJDYywKICAgICAgICAgICAgICAgIE11bHRpcGxlQ3VzdG9tZXJCY2MgPT4gXEBNdWx0aXBsZUN1c3RvbWVyQmNjLAogICAgICAgICAgICAgICAgQXR0YWNobWVudHMgICAgICAgICA9PiBcQEF0dGFjaG1lbnRzLAogICAgICAgICAgICAgICAgR2V0UGFyYW0gICAgICAgICAgICA9PiBcJUdldFBhcmFtLAogICAgICAgICAgICAgICAgVGlja2V0QmFja1R5cGUgICAgICA9PiAkVGlja2V0QmFja1R5cGUsCiAgICAgICAgICAgICAgICAlVGlja2V0LAogICAgICAgICAgICAgICAgJUdldFBhcmFtLAogICAgICAgICAgICApOwogICAgICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPkZvb3RlcigKICAgICAgICAgICAgICAgIFR5cGUgPT4gJ1NtYWxsJywKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuICRPdXRwdXQ7CiAgICAgICAgfQoKICAgICAgICAjIEdldCBwcmUtbG9hZGVkIGF0dGFjaG1lbnRzLgogICAgICAgIG15IEBBdHRhY2htZW50RGF0YSA9ICRVcGxvYWRDYWNoZU9iamVjdC0+Rm9ybUlER2V0QWxsRmlsZXNEYXRhKAogICAgICAgICAgICBGb3JtSUQgPT4gJFNlbGYtPntGb3JtSUR9LAogICAgICAgICk7CgogICAgICAgICMgR2V0IHN1Ym1pdCBhdHRhY2htZW50LgogICAgICAgIG15ICVVcGxvYWRTdHVmZiA9ICRQYXJhbU9iamVjdC0+R2V0VXBsb2FkQWxsKAogICAgICAgICAgICBQYXJhbSA9PiAnRmlsZVVwbG9hZCcsCiAgICAgICAgKTsKICAgICAgICBpZiAoJVVwbG9hZFN0dWZmKSB7CiAgICAgICAgICAgIHB1c2ggQEF0dGFjaG1lbnREYXRhLCBcJVVwbG9hZFN0dWZmOwogICAgICAgIH0KCiAgICAgICAgIyBHZXQgcmVjaXBpZW50cy4KICAgICAgICBteSAkUmVjaXBpZW50cyA9ICcnOwogICAgICAgIExJTkU6CiAgICAgICAgZm9yIG15ICRMaW5lIChxdyhUbyBDYyBCY2MpKSB7CgogICAgICAgICAgICBuZXh0IExJTkUgaWYgISRHZXRQYXJhbXskTGluZX07CgogICAgICAgICAgICBpZiAoJFJlY2lwaWVudHMpIHsKICAgICAgICAgICAgICAgICRSZWNpcGllbnRzIC49ICcsICc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJFJlY2lwaWVudHMgLj0gJEdldFBhcmFteyRMaW5lfTsKICAgICAgICB9CgogICAgICAgIG15ICRNaW1lVHlwZSA9ICd0ZXh0L3BsYWluJzsKICAgICAgICBpZiAoICRMYXlvdXRPYmplY3QtPntCcm93c2VyUmljaFRleHR9ICkgewogICAgICAgICAgICAkTWltZVR5cGUgPSAndGV4dC9odG1sJzsKCiAgICAgICAgICAgICMgUmVtb3ZlIHVudXNlZCBpbmxpbmUgaW1hZ2VzLgogICAgICAgICAgICBteSBATmV3QXR0YWNobWVudERhdGE7CiAgICAgICAgICAgIEFUVEFDSE1FTlQ6CiAgICAgICAgICAgIGZvciBteSAkQXR0YWNobWVudCAoQEF0dGFjaG1lbnREYXRhKSB7CiAgICAgICAgICAgICAgICBteSAkQ29udGVudElEID0gJEF0dGFjaG1lbnQtPntDb250ZW50SUR9OwogICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICRDb250ZW50SUQKICAgICAgICAgICAgICAgICAgICAmJiAoICRBdHRhY2htZW50LT57Q29udGVudFR5cGV9ID1+IC9pbWFnZS9pICkKICAgICAgICAgICAgICAgICAgICAmJiAoICRBdHRhY2htZW50LT57RGlzcG9zaXRpb259IGVxICdpbmxpbmUnICkKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgbXkgJENvbnRlbnRJREhUTUxRdW90ZSA9ICRMYXlvdXRPYmplY3QtPkFzY2lpMkh0bWwoCiAgICAgICAgICAgICAgICAgICAgICAgIFRleHQgPT4gJENvbnRlbnRJRCwKICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICAgICAjIFdvcmthcm91bmQgZm9yIGxpbmsgZW5jb2RlIG9mIHJpY2ggdGV4dCBlZGl0b3IsIHNlZSBidWcjNTA1My4KICAgICAgICAgICAgICAgICAgICBteSAkQ29udGVudElETGlua0VuY29kZSA9ICRMYXlvdXRPYmplY3QtPkxpbmtFbmNvZGUoJENvbnRlbnRJRCk7CiAgICAgICAgICAgICAgICAgICAgJEdldFBhcmFte0JvZHl9ID1+IHMvKENvbnRlbnRJRD0pJENvbnRlbnRJRExpbmtFbmNvZGUvJDEkQ29udGVudElEL2c7CgogICAgICAgICAgICAgICAgICAgICMgSWdub3JlIGF0dGFjaG1lbnQgaWYgbm90IGxpbmtlZCBpbiBib2R5LgogICAgICAgICAgICAgICAgICAgIG5leHQgQVRUQUNITUVOVAogICAgICAgICAgICAgICAgICAgICAgICBpZiAkR2V0UGFyYW17Qm9keX0gIX4gLyhcUSRDb250ZW50SURIVE1MUXVvdGVcRXxcUSRDb250ZW50SURcRSkvaTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIFJlbWVtYmVyIGlubGluZSBpbWFnZXMgYW5kIG5vcm1hbCBhdHRhY2htZW50cy4KICAgICAgICAgICAgICAgIHB1c2ggQE5ld0F0dGFjaG1lbnREYXRhLCBcJXskQXR0YWNobWVudH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgQEF0dGFjaG1lbnREYXRhID0gQE5ld0F0dGFjaG1lbnREYXRhOwoKICAgICAgICAgICAgIyBWZXJpZnkgSFRNTCBkb2N1bWVudC4KICAgICAgICAgICAgJEdldFBhcmFte0JvZHl9ID0gJExheW91dE9iamVjdC0+UmljaFRleHREb2N1bWVudENvbXBsZXRlKAogICAgICAgICAgICAgICAgU3RyaW5nID0+ICRHZXRQYXJhbXtCb2R5fSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIG15ICRJc1Zpc2libGVGb3JDdXN0b21lciA9ICRDb25maWctPntJc1Zpc2libGVGb3JDdXN0b21lckRlZmF1bHR9OwogICAgICAgIGlmICggJEdldFBhcmFte0lzVmlzaWJsZUZvckN1c3RvbWVyUHJlc2VudH0gKSB7CiAgICAgICAgICAgICRJc1Zpc2libGVGb3JDdXN0b21lciA9ICRHZXRQYXJhbXtJc1Zpc2libGVGb3JDdXN0b21lcn0gPyAxIDogMDsKICAgICAgICB9CgogICAgICAgICMgU2VuZCBlbWFpbC4KICAgICAgICBteSAkQXJ0aWNsZUlEID0gJEFydGljbGVCYWNrZW5kT2JqZWN0LT5BcnRpY2xlU2VuZCgKICAgICAgICAgICAgSXNWaXNpYmxlRm9yQ3VzdG9tZXIgPT4gJElzVmlzaWJsZUZvckN1c3RvbWVyLAogICAgICAgICAgICBTZW5kZXJUeXBlICAgICAgICAgICA9PiAnYWdlbnQnLAogICAgICAgICAgICBUaWNrZXRJRCAgICAgICAgICAgICA9PiAkU2VsZi0+e1RpY2tldElEfSwKICAgICAgICAgICAgSGlzdG9yeVR5cGUgICAgICAgICAgPT4gJ0VtYWlsUmVzZW5kJywKICAgICAgICAgICAgSGlzdG9yeUNvbW1lbnQgICAgICAgPT4gIlwlXCUkUmVjaXBpZW50cyIsCiAgICAgICAgICAgIEZyb20gICAgICAgICAgICAgICAgID0+ICRHZXRQYXJhbXtGcm9tfSwKICAgICAgICAgICAgVG8gICAgICAgICAgICAgICAgICAgPT4gJEdldFBhcmFte1RvfSwKICAgICAgICAgICAgQ2MgICAgICAgICAgICAgICAgICAgPT4gJEdldFBhcmFte0NjfSwKICAgICAgICAgICAgQmNjICAgICAgICAgICAgICAgICAgPT4gJEdldFBhcmFte0JjY30sCiAgICAgICAgICAgIFN1YmplY3QgICAgICAgICAgICAgID0+ICRHZXRQYXJhbXtTdWJqZWN0fSwKICAgICAgICAgICAgVXNlcklEICAgICAgICAgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICBCb2R5ICAgICAgICAgICAgICAgICA9PiAkR2V0UGFyYW17Qm9keX0sCiAgICAgICAgICAgIEluUmVwbHlUbyAgICAgICAgICAgID0+ICRHZXRQYXJhbXtJblJlcGx5VG99LAogICAgICAgICAgICBSZWZlcmVuY2VzICAgICAgICAgICA9PiAkR2V0UGFyYW17UmVmZXJlbmNlc30sCiAgICAgICAgICAgIENoYXJzZXQgICAgICAgICAgICAgID0+ICRMYXlvdXRPYmplY3QtPntVc2VyQ2hhcnNldH0sCiAgICAgICAgICAgIE1pbWVUeXBlICAgICAgICAgICAgID0+ICRNaW1lVHlwZSwKICAgICAgICAgICAgQXR0YWNobWVudCAgICAgICAgICAgPT4gXEBBdHRhY2htZW50RGF0YSwKICAgICAgICAgICAgJUFydGljbGVQYXJhbSwKICAgICAgICApOwoKICAgICAgICAjIEVycm9yIHBhZ2UuCiAgICAgICAgaWYgKCAhJEFydGljbGVJRCApIHsKICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkVycm9yU2NyZWVuKCk7CiAgICAgICAgfQoKICAgICAgICAjIFRpbWUgYWNjb3VudGluZy4KICAgICAgICBpZiAoICRHZXRQYXJhbXtUaW1lVW5pdHN9ICkgewogICAgICAgICAgICAkVGlja2V0T2JqZWN0LT5UaWNrZXRBY2NvdW50VGltZSgKICAgICAgICAgICAgICAgIFRpY2tldElEICA9PiAkU2VsZi0+e1RpY2tldElEfSwKICAgICAgICAgICAgICAgIEFydGljbGVJRCA9PiAkQXJ0aWNsZUlELAogICAgICAgICAgICAgICAgVGltZVVuaXQgID0+ICRHZXRQYXJhbXtUaW1lVW5pdHN9LAogICAgICAgICAgICAgICAgVXNlcklEICAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgUmVtb3ZlIHByZS1zdWJtaXR0ZWQgYXR0YWNobWVudHMuCiAgICAgICAgJFVwbG9hZENhY2hlT2JqZWN0LT5Gb3JtSURSZW1vdmUoIEZvcm1JRCA9PiAkR2V0UGFyYW17Rm9ybUlEfSApOwoKICAgICAgICAjIExvYWQgbmV3IFVSTCBpbiBwYXJlbnQgd2luZG93IGFuZCBjbG9zZSBwb3B1cC4KICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+UG9wdXBDbG9zZSgKICAgICAgICAgICAgVVJMID0+ICJBY3Rpb249QWdlbnRUaWNrZXRab29tO1RpY2tldElEPSRTZWxmLT57VGlja2V0SUR9O0FydGljbGVJRD0kQXJ0aWNsZUlEIiwKICAgICAgICApOwogICAgfQoKICAgICMgQ2hlY2sgZm9yIFNNSU1FIC8gUEdQIGlmIGN1c3RvbWVyIGhhcyBjaGFuZ2VkLgogICAgZWxzaWYgKCAkU2VsZi0+e1N1YmFjdGlvbn0gZXEgJ0FKQVhVcGRhdGUnICkgewoKICAgICAgICBteSBARXh0ZW5kZWREYXRhOwoKICAgICAgICAjIFJ1biBjb21wb3NlIG1vZHVsZXMuCiAgICAgICAgaWYgKCByZWYgJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpBcnRpY2xlQ29tcG9zZU1vZHVsZScpIGVxICdIQVNIJyApIHsKCiAgICAgICAgICAgICMgVXNlIHRpY2tldCBRdWV1ZUlEIGluIGNvbXBvc2UgbW9kdWxlcy4KICAgICAgICAgICAgJEdldFBhcmFte1F1ZXVlSUR9ID0gJFRpY2tldHtRdWV1ZUlEfTsKCiAgICAgICAgICAgIG15ICVKb2JzID0gJXsgJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpBcnRpY2xlQ29tcG9zZU1vZHVsZScpIH07CiAgICAgICAgICAgIEpPQjoKICAgICAgICAgICAgZm9yIG15ICRKb2IgKCBzb3J0IGtleXMgJUpvYnMgKSB7CgogICAgICAgICAgICAgICAgIyBMb2FkIG1vZHVsZS4KICAgICAgICAgICAgICAgIG5leHQgSk9CIGlmICEkTWFpbk9iamVjdC0+UmVxdWlyZSggJEpvYnN7JEpvYn0tPntNb2R1bGV9ICk7CgogICAgICAgICAgICAgICAgbXkgJE9iamVjdCA9ICRKb2JzeyRKb2J9LT57TW9kdWxlfS0+bmV3KAogICAgICAgICAgICAgICAgICAgICV7JFNlbGZ9LAogICAgICAgICAgICAgICAgICAgIERlYnVnID0+ICRTZWxmLT57RGVidWd9LAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICBteSAkTXVsdGlwbGU7CgogICAgICAgICAgICAgICAgUEFSQU1FVEVSOgogICAgICAgICAgICAgICAgZm9yIG15ICRQYXJhbWV0ZXIgKCAkT2JqZWN0LT5PcHRpb24oICVHZXRQYXJhbSwgQ29uZmlnID0+ICRKb2JzeyRKb2J9ICkgKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCAkSm9ic3skSm9ifS0+e1BhcmFtVHlwZX0gJiYgJEpvYnN7JEpvYn0tPntQYXJhbVR5cGV9IG5lICdTaW5nbGUnICkgewogICAgICAgICAgICAgICAgICAgICAgICBAeyAkR2V0UGFyYW17JFBhcmFtZXRlcn0gfSA9ICRQYXJhbU9iamVjdC0+R2V0QXJyYXkoIFBhcmFtID0+ICRQYXJhbWV0ZXIgKTsKICAgICAgICAgICAgICAgICAgICAgICAgJE11bHRpcGxlID0gMTsKICAgICAgICAgICAgICAgICAgICAgICAgbmV4dCBQQVJBTUVURVI7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAkR2V0UGFyYW17JFBhcmFtZXRlcn0gPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAkUGFyYW1ldGVyICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBSdW4gbW9kdWxlLgogICAgICAgICAgICAgICAgbXkgJURhdGEgPSAkT2JqZWN0LT5EYXRhKCAlR2V0UGFyYW0sIENvbmZpZyA9PiAkSm9ic3skSm9ifSApOwoKICAgICAgICAgICAgICAgICMgR2V0IEFKQVggcGFyYW0gdmFsdWVzLgogICAgICAgICAgICAgICAgaWYgKCAkT2JqZWN0LT5jYW4oJ0dldFBhcmFtQUpBWCcpICkgewogICAgICAgICAgICAgICAgICAgICVHZXRQYXJhbSA9ICggJUdldFBhcmFtLCAkT2JqZWN0LT5HZXRQYXJhbUFKQVgoJUdldFBhcmFtKSApOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgR2V0IG9wdGlvbnMgdGhhdCBoYXZlIHRvIGJlIHJlbW92ZWQgZnJvbSB0aGUgc2VsZWN0aW9uIHZpc2libGUgdG8gdGhlIGFnZW50LiBUaGVzZSBvcHRpb25zIHdpbGwgYmUKICAgICAgICAgICAgICAgICMgICBhZGRlZCBhZ2FpbiBvbiBzdWJtaXQuCiAgICAgICAgICAgICAgICBpZiAoICRPYmplY3QtPmNhbignR2V0T3B0aW9uc1RvUmVtb3ZlQUpBWCcpICkgewogICAgICAgICAgICAgICAgICAgIG15IEBPcHRpb25zVG9SZW1vdmUgPSAkT2JqZWN0LT5HZXRPcHRpb25zVG9SZW1vdmVBSkFYKCVHZXRQYXJhbSk7CgogICAgICAgICAgICAgICAgICAgIGZvciBteSAkT3B0aW9uVG9SZW1vdmUgKEBPcHRpb25zVG9SZW1vdmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlICREYXRheyRPcHRpb25Ub1JlbW92ZX07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG15ICRLZXkgPSAkT2JqZWN0LT5PcHRpb24oICVHZXRQYXJhbSwgQ29uZmlnID0+ICRKb2JzeyRKb2J9ICk7CiAgICAgICAgICAgICAgICBpZiAoJEtleSkgewogICAgICAgICAgICAgICAgICAgIHB1c2goCiAgICAgICAgICAgICAgICAgICAgICAgIEBFeHRlbmRlZERhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgICAgICAgICA9PiAkS2V5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgRGF0YSAgICAgICAgID0+IFwlRGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlbGVjdGVkSUQgICA9PiAkR2V0UGFyYW17JEtleX0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUcmFuc2xhdGlvbiAgPT4gMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvc3NpYmxlTm9uZSA9PiAxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTXVsdGlwbGUgICAgID0+ICRNdWx0aXBsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1heCAgICAgICAgICA9PiAxNTAsCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBteSAkSlNPTiA9ICRMYXlvdXRPYmplY3QtPkJ1aWxkU2VsZWN0aW9uSlNPTigKICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgQEV4dGVuZGVkRGF0YSwKICAgICAgICAgICAgXSwKICAgICAgICApOwogICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5BdHRhY2htZW50KAogICAgICAgICAgICBDb250ZW50VHlwZSA9PiAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD0nIC4gJExheW91dE9iamVjdC0+e0NoYXJzZXR9LAogICAgICAgICAgICBDb250ZW50ICAgICA9PiAkSlNPTiwKICAgICAgICAgICAgVHlwZSAgICAgICAgPT4gJ2lubGluZScsCiAgICAgICAgICAgIE5vQ2FjaGUgICAgID0+IDEsCiAgICAgICAgKTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIG15ICRPdXRwdXQgPSAkTGF5b3V0T2JqZWN0LT5IZWFkZXIoCiAgICAgICAgICAgIFZhbHVlICAgICA9PiAkVGlja2V0e1RpY2tldE51bWJlcn0sCiAgICAgICAgICAgIFR5cGUgICAgICA9PiAnU21hbGwnLAogICAgICAgICAgICBCb2R5Q2xhc3MgPT4gJ1BvcHVwJywKICAgICAgICApOwoKICAgICAgICAjIEdldCBhcnRpY2xlIGRhdGEuCiAgICAgICAgbXkgJEFydGljbGVCYWNrZW5kT2JqZWN0ID0gJEFydGljbGVPYmplY3QtPkJhY2tlbmRGb3JBcnRpY2xlKAogICAgICAgICAgICBUaWNrZXRJRCAgPT4gJFNlbGYtPntUaWNrZXRJRH0sCiAgICAgICAgICAgIEFydGljbGVJRCA9PiAkR2V0UGFyYW17QXJ0aWNsZUlEfSwKICAgICAgICApOwogICAgICAgIG15ICVEYXRhID0gJEFydGljbGVCYWNrZW5kT2JqZWN0LT5BcnRpY2xlR2V0KAogICAgICAgICAgICBUaWNrZXRJRCAgPT4gJFNlbGYtPntUaWNrZXRJRH0sCiAgICAgICAgICAgIEFydGljbGVJRCA9PiAkR2V0UGFyYW17QXJ0aWNsZUlEfSwKICAgICAgICApOwoKICAgICAgICAjIEdldCBhcnRpY2xlIHRvIHF1b3RlLgogICAgICAgICREYXRhe0JvZHl9ID0gJExheW91dE9iamVjdC0+QXJ0aWNsZVF1b3RlKAogICAgICAgICAgICBUaWNrZXRJRCAgICAgICAgICAgPT4gJFNlbGYtPntUaWNrZXRJRH0sCiAgICAgICAgICAgIEFydGljbGVJRCAgICAgICAgICA9PiAkRGF0YXtBcnRpY2xlSUR9LAogICAgICAgICAgICBGb3JtSUQgICAgICAgICAgICAgPT4gJFNlbGYtPntGb3JtSUR9LAogICAgICAgICAgICBVcGxvYWRDYWNoZU9iamVjdCAgPT4gJFVwbG9hZENhY2hlT2JqZWN0LAogICAgICAgICAgICBBdHRhY2htZW50c0luY2x1ZGUgPT4gMSwKICAgICAgICApOwoKICAgICAgICAjIEdldCBhbGwgYXR0YWNobWVudHMgbWV0YSBkYXRhLgogICAgICAgIG15IEBBdHRhY2htZW50cyA9ICRVcGxvYWRDYWNoZU9iamVjdC0+Rm9ybUlER2V0QWxsRmlsZXNNZXRhKAogICAgICAgICAgICBGb3JtSUQgPT4gJFNlbGYtPntGb3JtSUR9LAogICAgICAgICk7CgogICAgICAgIG15ICRTeXN0ZW1BZGRyZXNzID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlN5c3RlbUFkZHJlc3MnKTsKCiAgICAgICAgIyBHZXQgb25seSBlbWFpbCBhZGRyZXNzIGluICdUbycgKGp1c3QgJ3NvbWVAZXhhbXBsZS5jb20nKS4KICAgICAgICBmb3IgbXkgJEVtYWlsICggTWFpbDo6QWRkcmVzcy0+cGFyc2UoICREYXRhe1RvfSApICkgewogICAgICAgICAgICAkRGF0YXtUb0VtYWlsfSA9ICRFbWFpbC0+YWRkcmVzcygpOwogICAgICAgIH0KCiAgICAgICAgIyBGaW5kIGR1cGxpY2F0ZSBhZGRyZXNzZXMuCiAgICAgICAgbXkgJVJlY2lwaWVudDsKICAgICAgICBmb3IgbXkgJFR5cGUgKHF3KFRvIENjIEJjYykpIHsKICAgICAgICAgICAgaWYgKCAkRGF0YXskVHlwZX0gKSB7CiAgICAgICAgICAgICAgICBteSAkTmV3TGluZSA9ICcnOwogICAgICAgICAgICAgICAgZm9yIG15ICRFbWFpbCAoIE1haWw6OkFkZHJlc3MtPnBhcnNlKCAkRGF0YXskVHlwZX0gKSApIHsKICAgICAgICAgICAgICAgICAgICBteSAkQWRkcmVzcyA9IGxjICRFbWFpbC0+YWRkcmVzcygpOwoKICAgICAgICAgICAgICAgICAgICAjIE9ubHkgdXNlIGVtYWlsIGFkZHJlc3NlcyB3aXRoICdAJyBpbnNpZGUuCiAgICAgICAgICAgICAgICAgICAgaWYgKCAkQWRkcmVzcyAmJiAkQWRkcmVzcyA9fiAvQC8gJiYgISRSZWNpcGllbnR7JEFkZHJlc3N9ICkgewogICAgICAgICAgICAgICAgICAgICAgICAkUmVjaXBpZW50eyRBZGRyZXNzfSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIG15ICRJc0xvY2FsID0gJFN5c3RlbUFkZHJlc3MtPlN5c3RlbUFkZHJlc3NJc0xvY2FsQWRkcmVzcygKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFkZHJlc3MgPT4gJEFkZHJlc3MsCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggISRJc0xvY2FsICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCROZXdMaW5lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJE5ld0xpbmUgLj0gJywgJzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICROZXdMaW5lIC49ICRFbWFpbC0+Zm9ybWF0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkRGF0YXskVHlwZX0gPSAkTmV3TGluZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBDaGVjayBzb21lIHZhbHVlcy4KICAgICAgICBteSAlRXJyb3I7CiAgICAgICAgTElORToKICAgICAgICBmb3IgbXkgJExpbmUgKHF3KFRvIENjIEJjYykpIHsKICAgICAgICAgICAgbmV4dCBMSU5FIGlmICEkRGF0YXskTGluZX07CiAgICAgICAgICAgIGZvciBteSAkRW1haWwgKCBNYWlsOjpBZGRyZXNzLT5wYXJzZSggJERhdGF7JExpbmV9ICkgKSB7CiAgICAgICAgICAgICAgICBpZiAoICEkQ2hlY2tJdGVtT2JqZWN0LT5DaGVja0VtYWlsKCBBZGRyZXNzID0+ICRFbWFpbC0+YWRkcmVzcygpICkgKSB7CiAgICAgICAgICAgICAgICAgICAgJEVycm9yeyAkTGluZSAuICJJbnZhbGlkIiB9ID0gIiBTZXJ2ZXJFcnJvciI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCAkRGF0YXtGcm9tfSApIHsKICAgICAgICAgICAgZm9yIG15ICRFbWFpbCAoIE1haWw6OkFkZHJlc3MtPnBhcnNlKCAkRGF0YXtGcm9tfSApICkgewogICAgICAgICAgICAgICAgaWYgKCAhJENoZWNrSXRlbU9iamVjdC0+Q2hlY2tFbWFpbCggQWRkcmVzcyA9PiAkRW1haWwtPmFkZHJlc3MoKSApICkgewogICAgICAgICAgICAgICAgICAgICRFcnJvcnsiRnJvbUludmFsaWQifSAuPSAkQ2hlY2tJdGVtT2JqZWN0LT5DaGVja0Vycm9yKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgUnVuIGNvbXBvc2UgbW9kdWxlcy4KICAgICAgICBpZiAoIHJlZiAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6OkFydGljbGVDb21wb3NlTW9kdWxlJykgZXEgJ0hBU0gnICkgewoKICAgICAgICAgICAgIyB1c2UgdGlja2V0IFF1ZXVlSUQgaW4gY29tcG9zZSBtb2R1bGVzCiAgICAgICAgICAgICRHZXRQYXJhbXtRdWV1ZUlEfSA9ICRUaWNrZXR7UXVldWVJRH07CgogICAgICAgICAgICBteSAlSm9icyA9ICV7ICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpGcm9udGVuZDo6QXJ0aWNsZUNvbXBvc2VNb2R1bGUnKSB9OwogICAgICAgICAgICBmb3IgbXkgJEpvYiAoIHNvcnQga2V5cyAlSm9icyApIHsKCiAgICAgICAgICAgICAgICAjIExvYWQgbW9kdWxlLgogICAgICAgICAgICAgICAgaWYgKCAhJE1haW5PYmplY3QtPlJlcXVpcmUoICRKb2JzeyRKb2J9LT57TW9kdWxlfSApICkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5GYXRhbEVycm9yKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBteSAkT2JqZWN0ID0gJEpvYnN7JEpvYn0tPntNb2R1bGV9LT5uZXcoICV7JFNlbGZ9LCBEZWJ1ZyA9PiAkU2VsZi0+e0RlYnVnfSApOwoKICAgICAgICAgICAgICAgIFBBUkFNRVRFUjoKICAgICAgICAgICAgICAgIGZvciBteSAkUGFyYW1ldGVyICggJE9iamVjdC0+T3B0aW9uKCAlR2V0UGFyYW0sIENvbmZpZyA9PiAkSm9ic3skSm9ifSApICkgewogICAgICAgICAgICAgICAgICAgIGlmICggJEpvYnN7JEpvYn0tPntQYXJhbVR5cGV9ICYmICRKb2JzeyRKb2J9LT57UGFyYW1UeXBlfSBuZSAnU2luZ2xlJyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgQHsgJEdldFBhcmFteyRQYXJhbWV0ZXJ9IH0gPSAkUGFyYW1PYmplY3QtPkdldEFycmF5KCBQYXJhbSA9PiAkUGFyYW1ldGVyICk7CiAgICAgICAgICAgICAgICAgICAgICAgIG5leHQgUEFSQU1FVEVSOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJEdldFBhcmFteyRQYXJhbWV0ZXJ9ID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJFBhcmFtZXRlciApOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgUnVuIG1vZHVsZS4KICAgICAgICAgICAgICAgIG15ICROZXdQYXJhbXMgPSAkT2JqZWN0LT5SdW4oICVHZXRQYXJhbSwgQ29uZmlnID0+ICRKb2JzeyRKb2J9ICk7CgogICAgICAgICAgICAgICAgaWYgKCROZXdQYXJhbXMpIHsKICAgICAgICAgICAgICAgICAgICBmb3IgbXkgJFBhcmFtZXRlciAoICRPYmplY3QtPk9wdGlvbiggJUdldFBhcmFtLCBDb25maWcgPT4gJEpvYnN7JEpvYn0gKSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJEdldFBhcmFteyRQYXJhbWV0ZXJ9ID0gJE5ld1BhcmFtczsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBHZXQgZXJyb3JzLgogICAgICAgICAgICAgICAgJUVycm9yID0gKAogICAgICAgICAgICAgICAgICAgICVFcnJvciwKICAgICAgICAgICAgICAgICAgICAkT2JqZWN0LT5FcnJvciggJUdldFBhcmFtLCBDb25maWcgPT4gJEpvYnN7JEpvYn0gKSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgQnVpbGQgdmlldy4KICAgICAgICAkT3V0cHV0IC49ICRTZWxmLT5fTWFzaygKICAgICAgICAgICAgVGlja2V0SUQgICAgICAgICAgICA9PiAkU2VsZi0+e1RpY2tldElEfSwKICAgICAgICAgICAgQXR0YWNobWVudHMgICAgICAgICA9PiBcQEF0dGFjaG1lbnRzLAogICAgICAgICAgICBFcnJvcnMgICAgICAgICAgICAgID0+IFwlRXJyb3IsCiAgICAgICAgICAgIE11bHRpcGxlQ3VzdG9tZXIgICAgPT4gXEBNdWx0aXBsZUN1c3RvbWVyLAogICAgICAgICAgICBNdWx0aXBsZUN1c3RvbWVyQ2MgID0+IFxATXVsdGlwbGVDdXN0b21lckNjLAogICAgICAgICAgICBNdWx0aXBsZUN1c3RvbWVyQmNjID0+IFxATXVsdGlwbGVDdXN0b21lckJjYywKICAgICAgICAgICAgR2V0UGFyYW0gICAgICAgICAgICA9PiBcJUdldFBhcmFtLAogICAgICAgICAgICAlVGlja2V0LAogICAgICAgICAgICAlRGF0YSwKICAgICAgICAgICAgVGlja2V0QmFja1R5cGUgPT4gJFRpY2tldEJhY2tUeXBlLAogICAgICAgICk7CiAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5Gb290ZXIoCiAgICAgICAgICAgIFR5cGUgPT4gJ1NtYWxsJywKICAgICAgICApOwogICAgICAgIHJldHVybiAkT3V0cHV0OwogICAgfQp9CgpzdWIgX01hc2sgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwogICAgbXkgJENvbmZpZ09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CgogICAgbXkgJENvbmZpZyA9ICRDb25maWdPYmplY3QtPkdldCgiVGlja2V0OjpGcm9udGVuZDo6JFNlbGYtPntBY3Rpb259Iik7CgogICAgbXkgJElzVmlzaWJsZUZvckN1c3RvbWVyID0gJFBhcmFte0lzVmlzaWJsZUZvckN1c3RvbWVyfTsKICAgIGlmICggJFBhcmFte0dldFBhcmFtfS0+e0lzVmlzaWJsZUZvckN1c3RvbWVyUHJlc2VudH0gKSB7CiAgICAgICAgJElzVmlzaWJsZUZvckN1c3RvbWVyID0gJFBhcmFte0dldFBhcmFtfS0+e0lzVmlzaWJsZUZvckN1c3RvbWVyfSA/IDEgOiAwOwogICAgfQoKICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgIE5hbWUgPT4gJ0lzVmlzaWJsZUZvckN1c3RvbWVyJywKICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgSXNWaXNpYmxlRm9yQ3VzdG9tZXIgPT4gJElzVmlzaWJsZUZvckN1c3RvbWVyLAogICAgICAgIH0sCiAgICApOwoKICAgICMgUHJlcGFyZSBlcnJvcnMgZm9yIHRoZSBvdXRwdXQuCiAgICBpZiAoICRQYXJhbXtFcnJvcnN9ICkgewogICAgICAgIGZvciBteSAkRXJyb3IgKCBzb3J0IGtleXMgJXsgJFBhcmFte0Vycm9yc30gfSApIHsKICAgICAgICAgICAgJFBhcmFteyRFcnJvcn0gPSAkTGF5b3V0T2JqZWN0LT5Bc2NpaTJIdG1sKAogICAgICAgICAgICAgICAgVGV4dCA9PiAkUGFyYW17RXJyb3JzfS0+eyRFcnJvcn0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgICMgSGFuZGxlIG11bHRpcGxlIGF1dG9jb21wbGV0ZSBpbiByZWNpcGllbnQgZmllbGRzLgogICAgJFBhcmFte1RvfSA9ICggc2NhbGFyIEB7ICRQYXJhbXtNdWx0aXBsZUN1c3RvbWVyfSB9ID8gJycgOiAkUGFyYW17VG99ICk7CiAgICBpZiAoIGRlZmluZWQgJFBhcmFte1RvfSAmJiAkUGFyYW17VG99IG5lICcnICkgewogICAgICAgICRQYXJhbXtUb0ludmFsaWR9ID0gJyc7CiAgICB9CiAgICAkUGFyYW17Q2N9ID0gKCBzY2FsYXIgQHsgJFBhcmFte011bHRpcGxlQ3VzdG9tZXJDY30gfSA/ICcnIDogJFBhcmFte0NjfSApOwogICAgaWYgKCBkZWZpbmVkICRQYXJhbXtDY30gJiYgJFBhcmFte0NjfSBuZSAnJyApIHsKICAgICAgICAkUGFyYW17Q2NJbnZhbGlkfSA9ICcnOwogICAgfQogICAgJFBhcmFte0JjY30gPSAoIHNjYWxhciBAeyAkUGFyYW17TXVsdGlwbGVDdXN0b21lckJjY30gfSA/ICcnIDogJFBhcmFte0JjY30gKTsKICAgIGlmICggZGVmaW5lZCAkUGFyYW17QmNjfSAmJiAkUGFyYW17QmNjfSBuZSAnJyApIHsKICAgICAgICAkUGFyYW17QmNjSW52YWxpZH0gPSAnJzsKICAgIH0KCiAgICAjIFByb2Nlc3MgdGhlICdDYycgZmllbGQuCiAgICBteSAkQ3VzdG9tZXJDb3VudGVyQ2MgPSAwOwogICAgaWYgKCAkUGFyYW17TXVsdGlwbGVDdXN0b21lckNjfSApIHsKICAgICAgICBmb3IgbXkgJEl0ZW0gKCBAeyAkUGFyYW17TXVsdGlwbGVDdXN0b21lckNjfSB9ICkgewogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ0NjTXVsdGlwbGVDdXN0b21lcicsCiAgICAgICAgICAgICAgICBEYXRhID0+ICRJdGVtLAogICAgICAgICAgICApOwogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ0NjJyAuICRJdGVtLT57Q3VzdG9tZXJFcnJvck1zZ30sCiAgICAgICAgICAgICAgICBEYXRhID0+ICRJdGVtLAogICAgICAgICAgICApOwogICAgICAgICAgICBpZiAoICRJdGVtLT57Q3VzdG9tZXJFcnJvcn0gKSB7CiAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICdDY0N1c3RvbWVyRXJyb3JFeHBsYW50aW9uJywKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJEN1c3RvbWVyQ291bnRlckNjKys7CiAgICAgICAgfQogICAgfQoKICAgIGlmICggISRDdXN0b21lckNvdW50ZXJDYyApIHsKICAgICAgICAkUGFyYW17Q2NDdXN0b21lckhpZGRlbkNvbnRhaW5lcn0gPSAnSGlkZGVuJzsKICAgIH0KCiAgICAjIFNldCBjdXN0b21lciBjb3VudGVyLgogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnQ2NNdWx0aXBsZUN1c3RvbWVyQ291bnRlcicsCiAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgIEN1c3RvbWVyQ291bnRlciA9PiAkQ3VzdG9tZXJDb3VudGVyQ2MsCiAgICAgICAgfSwKICAgICk7CgogICAgIyBQcm9jZXNzIHRoZSAnQmNjJyBmaWVsZC4KICAgIG15ICRDdXN0b21lckNvdW50ZXJCY2MgPSAwOwogICAgaWYgKCAkUGFyYW17TXVsdGlwbGVDdXN0b21lckJjY30gKSB7CiAgICAgICAgZm9yIG15ICRJdGVtICggQHsgJFBhcmFte011bHRpcGxlQ3VzdG9tZXJCY2N9IH0gKSB7CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgTmFtZSA9PiAnQmNjTXVsdGlwbGVDdXN0b21lcicsCiAgICAgICAgICAgICAgICBEYXRhID0+ICRJdGVtLAogICAgICAgICAgICApOwogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ0JjYycgLiAkSXRlbS0+e0N1c3RvbWVyRXJyb3JNc2d9LAogICAgICAgICAgICAgICAgRGF0YSA9PiAkSXRlbSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgaWYgKCAkSXRlbS0+e0N1c3RvbWVyRXJyb3J9ICkgewogICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAnQmNjQ3VzdG9tZXJFcnJvckV4cGxhbnRpb24nLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkQ3VzdG9tZXJDb3VudGVyQmNjKys7CiAgICAgICAgfQogICAgfQoKICAgIGlmICggISRDdXN0b21lckNvdW50ZXJCY2MgKSB7CiAgICAgICAgJFBhcmFte0JjY0N1c3RvbWVySGlkZGVuQ29udGFpbmVyfSA9ICdIaWRkZW4nOwogICAgfQoKICAgICMgU2V0IGN1c3RvbWVyIGNvdW50ZXIuCiAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICBOYW1lID0+ICdCY2NNdWx0aXBsZUN1c3RvbWVyQ291bnRlcicsCiAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgIEN1c3RvbWVyQ291bnRlciA9PiAkQ3VzdG9tZXJDb3VudGVyQmNjLAogICAgICAgIH0sCiAgICApOwoKICAgICMgUHJvY2VzcyB0aGUgJ1RvJyBmaWVsZC4KICAgIG15ICRDdXN0b21lckNvdW50ZXIgPSAwOwogICAgaWYgKCAkUGFyYW17TXVsdGlwbGVDdXN0b21lcn0gKSB7CiAgICAgICAgZm9yIG15ICRJdGVtICggQHsgJFBhcmFte011bHRpcGxlQ3VzdG9tZXJ9IH0gKSB7CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgTmFtZSA9PiAnTXVsdGlwbGVDdXN0b21lcicsCiAgICAgICAgICAgICAgICBEYXRhID0+ICRJdGVtLAogICAgICAgICAgICApOwogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJEl0ZW0tPntDdXN0b21lckVycm9yTXNnfSwKICAgICAgICAgICAgICAgIERhdGEgPT4gJEl0ZW0sCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGlmICggJEl0ZW0tPntDdXN0b21lckVycm9yfSApIHsKICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gJ0N1c3RvbWVyRXJyb3JFeHBsYW50aW9uJywKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJEN1c3RvbWVyQ291bnRlcisrOwogICAgICAgIH0KICAgIH0KCiAgICBpZiAoICEkQ3VzdG9tZXJDb3VudGVyICkgewogICAgICAgICRQYXJhbXtDdXN0b21lckhpZGRlbkNvbnRhaW5lcn0gPSAnSGlkZGVuJzsKICAgIH0KCiAgICAjIFNldCBjdXN0b21lciBjb3VudGVyLgogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnTXVsdGlwbGVDdXN0b21lckNvdW50ZXInLAogICAgICAgIERhdGEgPT4gewogICAgICAgICAgICBDdXN0b21lckNvdW50ZXIgPT4gJEN1c3RvbWVyQ291bnRlciwKICAgICAgICB9LAogICAgKTsKCiAgICBpZiAoICRQYXJhbXtUb0ludmFsaWR9ICYmICRQYXJhbXtFcnJvcnN9ICkgewogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdUb1NlcnZlckVycm9yTXNnJywKICAgICAgICApOwogICAgfQoKICAgIG15ICRDdXN0b21lclVzZXJPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q3VzdG9tZXJVc2VyJyk7CgogICAgIyBTZXQgcHJlc2VsZWN0ZWQgdmFsdWVzIGZvciAnQmNjJyBmaWVsZC4KICAgIGlmICggJFBhcmFte0JjY30gJiYgJFBhcmFte0JjY30gbmUgJycgJiYgISRDdXN0b21lckNvdW50ZXJCY2MgKSB7CgogICAgICAgICMgc3BsaXQgQ2MgdmFsdWVzCiAgICAgICAgbXkgQEVtYWlsQWRkcmVzc2VzQmNjOwogICAgICAgIGZvciBteSAkRW1haWwgKCBNYWlsOjpBZGRyZXNzLT5wYXJzZSggJFBhcmFte0JjY30gKSApIHsKCiAgICAgICAgICAgIG15ICVDdXN0b21lclNlYXJjaCA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyU2VhcmNoKAogICAgICAgICAgICAgICAgUG9zdE1hc3RlclNlYXJjaCA9PiAkRW1haWwtPmFkZHJlc3MoKSwKICAgICAgICAgICAgICAgIExpbWl0ICAgICAgICAgICAgPT4gMSwKICAgICAgICAgICAgICAgIFVzZXJJRCA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBpZiAoJUN1c3RvbWVyU2VhcmNoKSB7CiAgICAgICAgICAgICAgICBmb3IgbXkgJEN1c3RvbWVyVXNlcklEICggc29ydCBrZXlzICVDdXN0b21lclNlYXJjaCApIHsKICAgICAgICAgICAgICAgICAgICBwdXNoIEBFbWFpbEFkZHJlc3Nlc0JjYywgewogICAgICAgICAgICAgICAgICAgICAgICBDdXN0b21lcktleSAgICAgICAgPT4gJEN1c3RvbWVyVXNlcklELAogICAgICAgICAgICAgICAgICAgICAgICBDdXN0b21lclRpY2tldFRleHQgPT4gJEN1c3RvbWVyU2VhcmNoeyRDdXN0b21lclVzZXJJRH0sCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHB1c2ggQEVtYWlsQWRkcmVzc2VzQmNjLCB7CiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJLZXkgICAgICAgID0+ICcnLAogICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyVGlja2V0VGV4dCA9PiAkRW1haWwtPlswXSA/ICIkRW1haWwtPlswXSA8JEVtYWlsLT5bMV0+IiA6ICIkRW1haWwtPlsxXSIsCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAkTGF5b3V0T2JqZWN0LT5BZGRKU0RhdGEoCiAgICAgICAgICAgIEtleSAgID0+ICdFbWFpbEFkZHJlc3Nlc0JjYycsCiAgICAgICAgICAgIFZhbHVlID0+IFxARW1haWxBZGRyZXNzZXNCY2MsCiAgICAgICAgKTsKCiAgICAgICAgJFBhcmFte0JjY30gPSAnJzsKICAgIH0KCiAgICAjIHNldCBwcmVzZWxlY3RlZCB2YWx1ZXMgZm9yIENjIGZpZWxkCiAgICBpZiAoICRQYXJhbXtDY30gJiYgJFBhcmFte0NjfSBuZSAnJyAmJiAhJEN1c3RvbWVyQ291bnRlckNjICkgewoKICAgICAgICAjIHNwbGl0IENjIHZhbHVlcwogICAgICAgIG15IEBFbWFpbEFkZHJlc3Nlc0NjOwogICAgICAgIGZvciBteSAkRW1haWwgKCBNYWlsOjpBZGRyZXNzLT5wYXJzZSggJFBhcmFte0NjfSApICkgewoKICAgICAgICAgICAgbXkgJUN1c3RvbWVyU2VhcmNoID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJTZWFyY2goCiAgICAgICAgICAgICAgICBQb3N0TWFzdGVyU2VhcmNoID0+ICRFbWFpbC0+YWRkcmVzcygpLAogICAgICAgICAgICAgICAgTGltaXQgICAgICAgICAgICA9PiAxLAogICAgICAgICAgICAgICAgVXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGlmICglQ3VzdG9tZXJTZWFyY2gpIHsKICAgICAgICAgICAgICAgIGZvciBteSAkQ3VzdG9tZXJVc2VySUQgKCBzb3J0IGtleXMgJUN1c3RvbWVyU2VhcmNoICkgewogICAgICAgICAgICAgICAgICAgIHB1c2ggQEVtYWlsQWRkcmVzc2VzQ2MsIHsKICAgICAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJLZXkgICAgICAgID0+ICRDdXN0b21lclVzZXJJRCwKICAgICAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJUaWNrZXRUZXh0ID0+ICRDdXN0b21lclNlYXJjaHskQ3VzdG9tZXJVc2VySUR9LAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBwdXNoIEBFbWFpbEFkZHJlc3Nlc0NjLCB7CiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJLZXkgICAgICAgID0+ICcnLAogICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyVGlja2V0VGV4dCA9PiAkRW1haWwtPlswXSA/ICIkRW1haWwtPlswXSA8JEVtYWlsLT5bMV0+IiA6ICIkRW1haWwtPlsxXSIsCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAkTGF5b3V0T2JqZWN0LT5BZGRKU0RhdGEoCiAgICAgICAgICAgIEtleSAgID0+ICdFbWFpbEFkZHJlc3Nlc0NjJywKICAgICAgICAgICAgVmFsdWUgPT4gXEBFbWFpbEFkZHJlc3Nlc0NjLAogICAgICAgICk7CgogICAgICAgICRQYXJhbXtDY30gPSAnJzsKICAgIH0KCiAgICAjIHNldCBwcmVzZWxlY3RlZCB2YWx1ZXMgZm9yIFRvIGZpZWxkCiAgICBpZiAoIGRlZmluZWQgJFBhcmFte1RvfSAmJiAkUGFyYW17VG99IG5lICcnICYmICEkQ3VzdG9tZXJDb3VudGVyICkgewoKICAgICAgICAjIHNwbGl0IFRvIHZhbHVlcwogICAgICAgIG15IEBFbWFpbEFkZHJlc3Nlc1RvOwogICAgICAgIGZvciBteSAkRW1haWwgKCBNYWlsOjpBZGRyZXNzLT5wYXJzZSggJFBhcmFte1RvfSApICkgewoKICAgICAgICAgICAgbXkgJUN1c3RvbWVyU2VhcmNoID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJTZWFyY2goCiAgICAgICAgICAgICAgICBQb3N0TWFzdGVyU2VhcmNoID0+ICRFbWFpbC0+YWRkcmVzcygpLAogICAgICAgICAgICAgICAgTGltaXQgICAgICAgICAgICA9PiAxLAogICAgICAgICAgICAgICAgVXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGlmICglQ3VzdG9tZXJTZWFyY2gpIHsKICAgICAgICAgICAgICAgIGZvciBteSAkQ3VzdG9tZXJVc2VySUQgKCBzb3J0IGtleXMgJUN1c3RvbWVyU2VhcmNoICkgewogICAgICAgICAgICAgICAgICAgIHB1c2ggQEVtYWlsQWRkcmVzc2VzVG8sIHsKICAgICAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJLZXkgICAgICAgID0+ICRDdXN0b21lclVzZXJJRCwKICAgICAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJUaWNrZXRUZXh0ID0+ICRDdXN0b21lclNlYXJjaHskQ3VzdG9tZXJVc2VySUR9LAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBwdXNoIEBFbWFpbEFkZHJlc3Nlc1RvLCB7CiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJLZXkgICAgICAgID0+ICcnLAogICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyVGlja2V0VGV4dCA9PiAkRW1haWwtPlswXSA/ICIkRW1haWwtPlswXSA8JEVtYWlsLT5bMV0+IiA6ICIkRW1haWwtPlsxXSIsCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAkTGF5b3V0T2JqZWN0LT5BZGRKU0RhdGEoCiAgICAgICAgICAgIEtleSAgID0+ICdFbWFpbEFkZHJlc3Nlc1RvJywKICAgICAgICAgICAgVmFsdWUgPT4gXEBFbWFpbEFkZHJlc3Nlc1RvLAogICAgICAgICk7CgogICAgICAgICRQYXJhbXtUb30gPSAnJzsKICAgIH0KCiAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICBOYW1lID0+ICRQYXJhbXtUaWNrZXRCYWNrVHlwZX0sCiAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICVQYXJhbSwKICAgICAgICB9LAogICAgKTsKCiAgICAjIFNob3cgdGltZSBhY2NvdW50aW5nIGJveC4KICAgIGlmICggJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpBY2NvdW50VGltZScpICkgewogICAgICAgICRQYXJhbXtUaW1lVW5pdHNCbG9ja30gPSAkTGF5b3V0T2JqZWN0LT5UaW1lVW5pdHMoCiAgICAgICAgICAgICVQYXJhbSwKICAgICAgICApOwogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdUaW1lVW5pdHMnLAogICAgICAgICAgICBEYXRhID0+IFwlUGFyYW0sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIFNob3cgdGhlIGN1c3RvbWVyIHVzZXIgYWRkcmVzcyBib29rIGlmIHRoZSBtb2R1bGUgaXMgcmVnaXN0ZXJlZCBhbmQgamF2YSBzY3JpcHQgc3VwcG9ydCBpcyBhdmFpbGFibGUuCiAgICBpZiAoCiAgICAgICAgJENvbmZpZ09iamVjdC0+R2V0KCdGcm9udGVuZDo6TW9kdWxlJyktPntBZ2VudEN1c3RvbWVyVXNlckFkZHJlc3NCb29rfQogICAgICAgICYmICRMYXlvdXRPYmplY3QtPntCcm93c2VySmF2YVNjcmlwdFN1cHBvcnR9CiAgICAgICAgKQogICAgewogICAgICAgICRQYXJhbXtPcHRpb25DdXN0b21lclVzZXJBZGRyZXNzQm9va30gPSAxOwogICAgfQoKICAgICMgQWRkIHJpY2ggdGV4dCBlZGl0b3IuCiAgICBpZiAoICRMYXlvdXRPYmplY3QtPntCcm93c2VyUmljaFRleHR9ICkgewoKICAgICAgICAjIFVzZSBoZWlnaHQvd2lkdGggZGVmaW5lZCBmb3IgdGhpcyBzY3JlZW4uCiAgICAgICAgJFBhcmFte1JpY2hUZXh0SGVpZ2h0fSA9ICRDb25maWctPntSaWNoVGV4dEhlaWdodH0gfHwgMDsKICAgICAgICAkUGFyYW17UmljaFRleHRXaWR0aH0gID0gJENvbmZpZy0+e1JpY2hUZXh0V2lkdGh9ICB8fCAwOwoKICAgICAgICAjIFNldCB1cCByaWNoIHRleHQgZWRpdG9yLgogICAgICAgICRMYXlvdXRPYmplY3QtPlNldFJpY2hUZXh0UGFyYW1ldGVycygKICAgICAgICAgICAgRGF0YSA9PiBcJVBhcmFtLAogICAgICAgICk7CiAgICB9CgogICAgIyBTaG93IGF0dGFjaG1lbnRzLgogICAgQVRUQUNITUVOVDoKICAgIGZvciBteSAkQXR0YWNobWVudCAoIEB7ICRQYXJhbXtBdHRhY2htZW50c30gfSApIHsKICAgICAgICBpZiAoCiAgICAgICAgICAgICRBdHRhY2htZW50LT57Q29udGVudElEfQogICAgICAgICAgICAmJiAkTGF5b3V0T2JqZWN0LT57QnJvd3NlclJpY2hUZXh0fQogICAgICAgICAgICAmJiAoICRBdHRhY2htZW50LT57Q29udGVudFR5cGV9ID1+IC9pbWFnZS9pICkKICAgICAgICAgICAgJiYgKCAkQXR0YWNobWVudC0+e0Rpc3Bvc2l0aW9ufSBlcSAnaW5saW5lJyApCiAgICAgICAgICAgICkKICAgICAgICB7CiAgICAgICAgICAgIG5leHQgQVRUQUNITUVOVDsKICAgICAgICB9CgogICAgICAgIHB1c2ggQHsgJFBhcmFte0F0dGFjaG1lbnRMaXN0fSB9LCAkQXR0YWNobWVudDsKICAgIH0KCiAgICAjIENyZWF0ZSAmIHJldHVybiBvdXRwdXQuCiAgICByZXR1cm4gJExheW91dE9iamVjdC0+T3V0cHV0KAogICAgICAgIFRlbXBsYXRlRmlsZSA9PiAnQWdlbnRUaWNrZXRFbWFpbFJlc2VuZCcsCiAgICAgICAgRGF0YSAgICAgICAgID0+IHsKICAgICAgICAgICAgRm9ybUlEID0+ICRTZWxmLT57Rm9ybUlEfSwKICAgICAgICAgICAgJVBhcmFtLAogICAgICAgIH0sCiAgICApOwp9CgoxOwo=</File>
        <File Location="Custom/Kernel/Modules/AgentTicketPhone.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxLTIwMjIgWm51bnkgR21iSCwgaHR0cHM6Ly96bnVueS5vcmcvCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6TW9kdWxlczo6QWdlbnRUaWNrZXRQaG9uZTsKIyMgbm9maWx0ZXIoVGlkeUFsbDo6UGx1Z2luOjpPVFJTOjpQZXJsOjpEQk9iamVjdCkKCnVzZSBzdHJpY3Q7CnVzZSB3YXJuaW5nczsKCnVzZSBNYWlsOjpBZGRyZXNzOwoKdXNlIEtlcm5lbDo6U3lzdGVtOjpWYXJpYWJsZUNoZWNrIHF3KDphbGwpOwp1c2UgS2VybmVsOjpMYW5ndWFnZSBxdyhUcmFuc2xhdGFibGUpOwoKb3VyICRPYmplY3RNYW5hZ2VyRGlzYWJsZWQgPSAxOwoKc3ViIG5ldyB7CiAgICBteSAoICRUeXBlLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgYWxsb2NhdGUgbmV3IGhhc2ggZm9yIG9iamVjdAogICAgbXkgJFNlbGYgPSB7JVBhcmFtfTsKICAgIGJsZXNzKCAkU2VsZiwgJFR5cGUgKTsKCiAgICAjZ2V0IGNvbmZpZyBvYmplY3QKICAgIG15ICRDb25maWdPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpOwoKICAgICMgZ2V0IHRoZSBkeW5hbWljIGZpZWxkcyBmb3IgdGhpcyBzY3JlZW4KICAgICRTZWxmLT57RHluYW1pY0ZpZWxkfSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEeW5hbWljRmllbGQnKS0+RHluYW1pY0ZpZWxkTGlzdEdldCgKICAgICAgICBWYWxpZCAgICAgICA9PiAxLAogICAgICAgIE9iamVjdFR5cGUgID0+IFsgJ1RpY2tldCcsICdBcnRpY2xlJyBdLAogICAgICAgIEZpZWxkRmlsdGVyID0+ICRDb25maWdPYmplY3QtPkdldCgiVGlja2V0OjpGcm9udGVuZDo6JFNlbGYtPntBY3Rpb259IiktPntEeW5hbWljRmllbGR9IHx8IHt9LAogICAgKTsKCiAgICAjIGdldCBmb3JtIGlkCiAgICAkU2VsZi0+e0Zvcm1JRH0gPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6V2ViOjpSZXF1ZXN0JyktPkdldFBhcmFtKCBQYXJhbSA9PiAnRm9ybUlEJyApOwoKICAgICMgY3JlYXRlIGZvcm0gaWQKICAgIGlmICggISRTZWxmLT57Rm9ybUlEfSApIHsKICAgICAgICAkU2VsZi0+e0Zvcm1JRH0gPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6V2ViOjpVcGxvYWRDYWNoZScpLT5Gb3JtSURDcmVhdGUoKTsKICAgIH0KCiAgICByZXR1cm4gJFNlbGY7Cn0KCnN1YiBSdW4gewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGdldCBwYXJhbXMKICAgIG15ICVHZXRQYXJhbTsKCiAgICAjIGdldCBwYXJhbSBvYmplY3QKICAgIG15ICRQYXJhbU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpXZWI6OlJlcXVlc3QnKTsKCiAgICBmb3IgbXkgJEtleSAoCiAgICAgICAgcXcoQXJ0aWNsZUlEIExpbmtUaWNrZXRJRCBQcmlvcml0eUlEIE5ld1VzZXJJRAogICAgICAgIEZyb20gU3ViamVjdCBCb2R5IE5leHRTdGF0ZUlEIFRpbWVVbml0cwogICAgICAgIFllYXIgTW9udGggRGF5IEhvdXIgTWludXRlCiAgICAgICAgTmV3UmVzcG9uc2libGVJRCBSZXNwb25zaWJsZUFsbCBPd25lckFsbCBUeXBlSUQgU2VydmljZUlEIFNMQUlECiAgICAgICAgU3RhbmRhcmRUZW1wbGF0ZUlEIEZyb21DaGF0SUQgRGVzdAogICAgICAgICkKICAgICAgICApCiAgICB7CiAgICAgICAgJEdldFBhcmFteyRLZXl9ID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJEtleSApOwogICAgfQoKICAgICMgQUNMIGNvbXBhdGliaWxpdHkgdHJhbnNsYXRpb24KICAgIG15ICVBQ0xDb21wYXRHZXRQYXJhbTsKICAgICRBQ0xDb21wYXRHZXRQYXJhbXtPd25lcklEfSA9ICRHZXRQYXJhbXtOZXdVc2VySUR9OwoKICAgICMgTXVsdGlwbGVDdXN0b21lciBGcm9tLWZpZWxkCiAgICBteSBATXVsdGlwbGVDdXN0b21lcjsKICAgIG15ICRDdXN0b21lcnNOdW1iZXIgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQ3VzdG9tZXJUaWNrZXRDb3VudGVyRnJvbUN1c3RvbWVyJyApIHx8IDA7CiAgICBteSAkU2VsZWN0ZWQgICAgICAgID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0N1c3RvbWVyU2VsZWN0ZWQnICkgICAgICAgICAgICAgICAgICB8fCAnJzsKCiAgICAjIGhhc2ggZm9yIGNoZWNrIGR1cGxpY2F0ZWQgZW50cmllcwogICAgbXkgJUFkZHJlc3Nlc0xpc3Q7CgogICAgIyBnZXQgY2hlY2sgaXRlbSBvYmplY3QKICAgIG15ICRDaGVja0l0ZW1PYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2hlY2tJdGVtJyk7CgogICAgaWYgKCRDdXN0b21lcnNOdW1iZXIpIHsKICAgICAgICBteSAkQ3VzdG9tZXJDb3VudGVyID0gMTsKICAgICAgICBmb3IgbXkgJENvdW50ICggMSAuLi4gJEN1c3RvbWVyc051bWJlciApIHsKICAgICAgICAgICAgbXkgJEN1c3RvbWVyRWxlbWVudCAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQ3VzdG9tZXJUaWNrZXRUZXh0XycgLiAkQ291bnQgKTsKICAgICAgICAgICAgbXkgJEN1c3RvbWVyU2VsZWN0ZWQgPSAoICRTZWxlY3RlZCBlcSAkQ291bnQgPyAnY2hlY2tlZD0iY2hlY2tlZCInIDogJycgKTsKICAgICAgICAgICAgbXkgJEN1c3RvbWVyS2V5ICAgICAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQ3VzdG9tZXJLZXlfJyAuICRDb3VudCApCiAgICAgICAgICAgICAgICB8fCAnJzsKCiAgICAgICAgICAgIGlmICgkQ3VzdG9tZXJFbGVtZW50KSB7CgogICAgICAgICAgICAgICAgbXkgJENvdW50QXV4ICAgICAgICAgPSAkQ3VzdG9tZXJDb3VudGVyKys7CiAgICAgICAgICAgICAgICBteSAkQ3VzdG9tZXJFcnJvciAgICA9ICcnOwogICAgICAgICAgICAgICAgbXkgJEN1c3RvbWVyRXJyb3JNc2cgPSAnQ3VzdG9tZXJHZW5lcmljU2VydmVyRXJyb3JNc2cnOwogICAgICAgICAgICAgICAgbXkgJEN1c3RvbWVyRGlzYWJsZWQgPSAnJzsKCiAgICAgICAgICAgICAgICBpZiAoICRHZXRQYXJhbXtGcm9tfSApIHsKICAgICAgICAgICAgICAgICAgICAkR2V0UGFyYW17RnJvbX0gLj0gJywgJyAuICRDdXN0b21lckVsZW1lbnQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkR2V0UGFyYW17RnJvbX0gPSAkQ3VzdG9tZXJFbGVtZW50OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgY2hlY2sgZW1haWwgYWRkcmVzcwogICAgICAgICAgICAgICAgZm9yIG15ICRFbWFpbCAoIE1haWw6OkFkZHJlc3MtPnBhcnNlKCRDdXN0b21lckVsZW1lbnQpICkgewogICAgICAgICAgICAgICAgICAgIGlmICggISRDaGVja0l0ZW1PYmplY3QtPkNoZWNrRW1haWwoIEFkZHJlc3MgPT4gJEVtYWlsLT5hZGRyZXNzKCkgKSApCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAkQ3VzdG9tZXJFcnJvck1zZyA9ICRDaGVja0l0ZW1PYmplY3QtPkNoZWNrRXJyb3JUeXBlKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4gJ1NlcnZlckVycm9yTXNnJzsKICAgICAgICAgICAgICAgICAgICAgICAgJEN1c3RvbWVyRXJyb3IgPSAnU2VydmVyRXJyb3InOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIGNoZWNrIGZvciBkdXBsaWNhdGVkIGVudHJpZXMKICAgICAgICAgICAgICAgIGlmICggZGVmaW5lZCAkQWRkcmVzc2VzTGlzdHskQ3VzdG9tZXJFbGVtZW50fSAmJiAkQ3VzdG9tZXJFcnJvciBlcSAnJyApIHsKICAgICAgICAgICAgICAgICAgICAkQ3VzdG9tZXJFcnJvck1zZyA9ICdJc0R1cGxpY2F0ZWRTZXJ2ZXJFcnJvck1zZyc7CiAgICAgICAgICAgICAgICAgICAgJEN1c3RvbWVyRXJyb3IgICAgPSAnU2VydmVyRXJyb3InOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICggJEN1c3RvbWVyRXJyb3IgbmUgJycgKSB7CiAgICAgICAgICAgICAgICAgICAgJEN1c3RvbWVyRGlzYWJsZWQgPSAnZGlzYWJsZWQ9ImRpc2FibGVkIic7CiAgICAgICAgICAgICAgICAgICAgJENvdW50QXV4ICAgICAgICAgPSAkQ291bnQgLiAnRXJyb3InOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHB1c2ggQE11bHRpcGxlQ3VzdG9tZXIsIHsKICAgICAgICAgICAgICAgICAgICBDb3VudCAgICAgICAgICAgID0+ICRDb3VudEF1eCwKICAgICAgICAgICAgICAgICAgICBDdXN0b21lckVsZW1lbnQgID0+ICRDdXN0b21lckVsZW1lbnQsCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJTZWxlY3RlZCA9PiAkQ3VzdG9tZXJTZWxlY3RlZCwKICAgICAgICAgICAgICAgICAgICBDdXN0b21lcktleSAgICAgID0+ICRDdXN0b21lcktleSwKICAgICAgICAgICAgICAgICAgICBDdXN0b21lckVycm9yICAgID0+ICRDdXN0b21lckVycm9yLAogICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyRXJyb3JNc2cgPT4gJEN1c3RvbWVyRXJyb3JNc2csCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJEaXNhYmxlZCA9PiAkQ3VzdG9tZXJEaXNhYmxlZCwKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAkQWRkcmVzc2VzTGlzdHskQ3VzdG9tZXJFbGVtZW50fSA9IDE7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgIyBnZXQgRHluYW1pYyBmaWVsZHMgZm9ybSBQYXJhbU9iamVjdAogICAgbXkgJUR5bmFtaWNGaWVsZFZhbHVlczsKCiAgICAjIGdldCBuZWVkZWQgb2JqZWN0cwogICAgbXkgJExheW91dE9iamVjdCAgICAgICAgICAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CiAgICBteSAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEeW5hbWljRmllbGQ6OkJhY2tlbmQnKTsKICAgIG15ICRDb25maWdPYmplY3QgICAgICAgICAgICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKTsKICAgIG15ICRDdXN0b21lclVzZXJPYmplY3QgICAgICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyVXNlcicpOwogICAgbXkgJFVwbG9hZENhY2hlT2JqZWN0ICAgICAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6V2ViOjpVcGxvYWRDYWNoZScpOwogICAgbXkgJFRpY2tldE9iamVjdCAgICAgICAgICAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGlja2V0Jyk7CiAgICBteSAkUXVldWVPYmplY3QgICAgICAgICAgICAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpRdWV1ZScpOwoKICAgIG15ICRDb25maWcgPSAkQ29uZmlnT2JqZWN0LT5HZXQoIlRpY2tldDo6RnJvbnRlbmQ6OiRTZWxmLT57QWN0aW9ufSIpOwoKICAgICMgY3ljbGUgdHJvdWdoIHRoZSBhY3RpdmF0ZWQgRHluYW1pYyBGaWVsZHMgZm9yIHRoaXMgc2NyZWVuCiAgICBEWU5BTUlDRklFTEQ6CiAgICBmb3IgbXkgJER5bmFtaWNGaWVsZENvbmZpZyAoIEB7ICRTZWxmLT57RHluYW1pY0ZpZWxkfSB9ICkgewogICAgICAgIG5leHQgRFlOQU1JQ0ZJRUxEIGlmICFJc0hhc2hSZWZXaXRoRGF0YSgkRHluYW1pY0ZpZWxkQ29uZmlnKTsKCiAgICAgICAgIyBleHRyYWN0IHRoZSBkeW5hbWljIGZpZWxkIHZhbHVlIGZyb20gdGhlIHdlYiByZXF1ZXN0CiAgICAgICAgJER5bmFtaWNGaWVsZFZhbHVlc3sgJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9IH0gPSAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdC0+RWRpdEZpZWxkVmFsdWVHZXQoCiAgICAgICAgICAgIER5bmFtaWNGaWVsZENvbmZpZyA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnLAogICAgICAgICAgICBQYXJhbU9iamVjdCAgICAgICAgPT4gJFBhcmFtT2JqZWN0LAogICAgICAgICAgICBMYXlvdXRPYmplY3QgICAgICAgPT4gJExheW91dE9iamVjdCwKICAgICAgICApOwogICAgfQoKICAgICMgY29udmVydCBkeW5hbWljIGZpZWxkIHZhbHVlcyBpbnRvIGEgc3RydWN0dXJlIGZvciBBQ0xzCiAgICBteSAlRHluYW1pY0ZpZWxkQUNMUGFyYW1ldGVyczsKICAgIERZTkFNSUNGSUVMRDoKICAgIGZvciBteSAkRHluYW1pY0ZpZWxkICggc29ydCBrZXlzICVEeW5hbWljRmllbGRWYWx1ZXMgKSB7CiAgICAgICAgbmV4dCBEWU5BTUlDRklFTEQgaWYgISREeW5hbWljRmllbGQ7CiAgICAgICAgbmV4dCBEWU5BTUlDRklFTEQgaWYgISREeW5hbWljRmllbGRWYWx1ZXN7JER5bmFtaWNGaWVsZH07CgogICAgICAgICREeW5hbWljRmllbGRBQ0xQYXJhbWV0ZXJzeyAnRHluYW1pY0ZpZWxkXycgLiAkRHluYW1pY0ZpZWxkIH0gPSAkRHluYW1pY0ZpZWxkVmFsdWVzeyREeW5hbWljRmllbGR9OwogICAgfQogICAgJEdldFBhcmFte0R5bmFtaWNGaWVsZH0gPSBcJUR5bmFtaWNGaWVsZEFDTFBhcmFtZXRlcnM7CgogICAgIyB0cmFuc2Zvcm0gcGVuZGluZyB0aW1lLCB0aW1lIHN0YW1wIGJhc2VkIG9uIHVzZXIgdGltZSB6b25lCiAgICBpZiAoCiAgICAgICAgZGVmaW5lZCAkR2V0UGFyYW17WWVhcn0KICAgICAgICAmJiBkZWZpbmVkICRHZXRQYXJhbXtNb250aH0KICAgICAgICAmJiBkZWZpbmVkICRHZXRQYXJhbXtEYXl9CiAgICAgICAgJiYgZGVmaW5lZCAkR2V0UGFyYW17SG91cn0KICAgICAgICAmJiBkZWZpbmVkICRHZXRQYXJhbXtNaW51dGV9CiAgICAgICAgKQogICAgewogICAgICAgICVHZXRQYXJhbSA9ICRMYXlvdXRPYmplY3QtPlRyYW5zZm9ybURhdGVTZWxlY3Rpb24oCiAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICApOwogICAgfQoKICAgIGlmICggJEdldFBhcmFte0Zyb21DaGF0SUR9ICkgewogICAgICAgIGlmICggISRDb25maWdPYmplY3QtPkdldCgnQ2hhdEVuZ2luZTo6QWN0aXZlJykgKSB7CiAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5GYXRhbEVycm9yKAogICAgICAgICAgICAgICAgTWVzc2FnZSA9PiBUcmFuc2xhdGFibGUoJ0NoYXQgaXMgbm90IGFjdGl2ZS4nKSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgT2ssIHRha2UgdGhlIGNoYXQKICAgICAgICBteSAlQ2hhdFBhcnRpY2lwYW50ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNoYXQnKS0+Q2hhdFBhcnRpY2lwYW50Q2hlY2soCiAgICAgICAgICAgIENoYXRJRCAgICAgICAgPT4gJEdldFBhcmFte0Zyb21DaGF0SUR9LAogICAgICAgICAgICBDaGF0dGVyVHlwZSAgID0+ICdVc2VyJywKICAgICAgICAgICAgQ2hhdHRlcklEICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgIENoYXR0ZXJBY3RpdmUgPT4gMSwKICAgICAgICApOwoKICAgICAgICBpZiAoICElQ2hhdFBhcnRpY2lwYW50ICkgewogICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigKICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gVHJhbnNsYXRhYmxlKCdObyBwZXJtaXNzaW9uLicpLAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBHZXQgcGVybWlzc2lvbnMKICAgICAgICBteSAkUGVybWlzc2lvbkxldmVsID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNoYXQnKS0+Q2hhdFBlcm1pc3Npb25MZXZlbEdldCgKICAgICAgICAgICAgQ2hhdElEID0+ICRHZXRQYXJhbXtGcm9tQ2hhdElEfSwKICAgICAgICAgICAgVXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICApOwoKICAgICAgICAjIENoZWNrIGlmIG9ic2VydmVyCiAgICAgICAgaWYgKCAkUGVybWlzc2lvbkxldmVsIG5lICdPd25lcicgJiYgJFBlcm1pc3Npb25MZXZlbCBuZSAnUGFydGljaXBhbnQnICkgewogICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigKICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gVHJhbnNsYXRhYmxlKCdObyBwZXJtaXNzaW9uLicpLAogICAgICAgICAgICAgICAgQ29tbWVudCA9PiAkUGVybWlzc2lvbkxldmVsLAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICBpZiAoICEkU2VsZi0+e1N1YmFjdGlvbn0gfHwgJFNlbGYtPntTdWJhY3Rpb259IGVxICdDcmVhdGVkJyApIHsKICAgICAgICBteSAlVGlja2V0OwogICAgICAgIGlmICggJFNlbGYtPntUaWNrZXRJRH0gKSB7CiAgICAgICAgICAgICVUaWNrZXQgPSAkVGlja2V0T2JqZWN0LT5UaWNrZXRHZXQoIFRpY2tldElEID0+ICRTZWxmLT57VGlja2V0SUR9ICk7CiAgICAgICAgfQoKICAgICAgICAjIGhlYWRlcgogICAgICAgIG15ICRPdXRwdXQgPSAkTGF5b3V0T2JqZWN0LT5IZWFkZXIoKTsKICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk5hdmlnYXRpb25CYXIoKTsKCiAgICAgICAgIyBpZiB0aGVyZSBpcyBubyB0aWNrZXQgaWQhCiAgICAgICAgaWYgKCAkU2VsZi0+e1RpY2tldElEfSAmJiAkU2VsZi0+e1N1YmFjdGlvbn0gZXEgJ0NyZWF0ZWQnICkgewoKICAgICAgICAgICAgIyBub3RpZnkgaW5mbwogICAgICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk5vdGlmeSgKICAgICAgICAgICAgICAgIEluZm8gPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKAogICAgICAgICAgICAgICAgICAgICdUaWNrZXQgIiVzIiBjcmVhdGVkIScsCiAgICAgICAgICAgICAgICAgICAgJFRpY2tldHtUaWNrZXROdW1iZXJ9LAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgIExpbmsgPT4gJExheW91dE9iamVjdC0+e0Jhc2VsaW5rfQogICAgICAgICAgICAgICAgICAgIC4gJ0FjdGlvbj1BZ2VudFRpY2tldFpvb207VGlja2V0SUQ9JwogICAgICAgICAgICAgICAgICAgIC4gJFRpY2tldHtUaWNrZXRJRH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIHN0b3JlIGxhc3QgcXVldWUgc2NyZWVuCiAgICAgICAgaWYgKAogICAgICAgICAgICAkU2VsZi0+e0xhc3RTY3JlZW5PdmVydmlld30KICAgICAgICAgICAgJiYgJFNlbGYtPntMYXN0U2NyZWVuT3ZlcnZpZXd9ICF+IC9BY3Rpb249QWdlbnRUaWNrZXRQaG9uZS8KICAgICAgICAgICAgJiYgJFNlbGYtPntSZXF1ZXN0ZWRVUkx9ICAgICAgICF+IC9BY3Rpb249QWdlbnRUaWNrZXRQaG9uZS4qTGlua1RpY2tldElEPS8KICAgICAgICAgICAgKQogICAgICAgIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkF1dGhTZXNzaW9uJyktPlVwZGF0ZVNlc3Npb25JRCgKICAgICAgICAgICAgICAgIFNlc3Npb25JRCA9PiAkU2VsZi0+e1Nlc3Npb25JRH0sCiAgICAgICAgICAgICAgICBLZXkgICAgICAgPT4gJ0xhc3RTY3JlZW5PdmVydmlldycsCiAgICAgICAgICAgICAgICBWYWx1ZSAgICAgPT4gJFNlbGYtPntSZXF1ZXN0ZWRVUkx9LAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBnZXQgc3BsaXQgYXJ0aWNsZSBpZiBnaXZlbgogICAgICAgICMgZ2V0IEFydGljbGVJRAogICAgICAgIG15ICVBcnRpY2xlOwogICAgICAgIG15ICVDdXN0b21lckRhdGE7CiAgICAgICAgbXkgJEFydGljbGVGcm9tID0gJyc7CiAgICAgICAgbXkgJVNwbGl0VGlja2V0RGF0YTsKICAgICAgICBpZiAoICRHZXRQYXJhbXtBcnRpY2xlSUR9ICkgewoKICAgICAgICAgICAgbXkgJEFjY2VzcyA9ICRUaWNrZXRPYmplY3QtPlRpY2tldFBlcm1pc3Npb24oCiAgICAgICAgICAgICAgICBUeXBlICAgICA9PiAncm8nLAogICAgICAgICAgICAgICAgVGlja2V0SUQgPT4gJFNlbGYtPntUaWNrZXRJRH0sCiAgICAgICAgICAgICAgICBVc2VySUQgICA9PiAkU2VsZi0+e1VzZXJJRH0KICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGlmICggISRBY2Nlc3MgKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+Tm9QZXJtaXNzaW9uKAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgICAgPT4gVHJhbnNsYXRhYmxlKCdZb3UgbmVlZCBybyBwZXJtaXNzaW9uIScpLAogICAgICAgICAgICAgICAgICAgIFdpdGhIZWFkZXIgPT4gJ3llcycsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIEdldCBpbmZvcm1hdGlvbiBmcm9tIG9yaWdpbmFsIHRpY2tldCAoU3BsaXRUaWNrZXQpLgogICAgICAgICAgICAlU3BsaXRUaWNrZXREYXRhID0gJFRpY2tldE9iamVjdC0+VGlja2V0R2V0KAogICAgICAgICAgICAgICAgVGlja2V0SUQgICAgICA9PiAkU2VsZi0+e1RpY2tldElEfSwKICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZHMgPT4gMSwKICAgICAgICAgICAgICAgIFVzZXJJRCAgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICApOwoKICAgICAgICAgICAgbXkgJEFydGljbGVCYWNrZW5kT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpY2tldDo6QXJ0aWNsZScpLT5CYWNrZW5kRm9yQXJ0aWNsZSgKICAgICAgICAgICAgICAgIFRpY2tldElEICA9PiAkU2VsZi0+e1RpY2tldElEfSwKICAgICAgICAgICAgICAgIEFydGljbGVJRCA9PiAkR2V0UGFyYW17QXJ0aWNsZUlEfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICVBcnRpY2xlID0gJEFydGljbGVCYWNrZW5kT2JqZWN0LT5BcnRpY2xlR2V0KAogICAgICAgICAgICAgICAgVGlja2V0SUQgID0+ICRTZWxmLT57VGlja2V0SUR9LAogICAgICAgICAgICAgICAgQXJ0aWNsZUlEID0+ICRHZXRQYXJhbXtBcnRpY2xlSUR9LAogICAgICAgICAgICApOwoKICAgICAgICAgICAgIyBjaGVjayBpZiBhcnRpY2xlIGlzIGZyb20gdGhlIHNhbWUgVGlja2V0SUQgYXMgd2UgY2hlY2tlZCBwZXJtaXNzaW9ucyBmb3IuCiAgICAgICAgICAgIGlmICggJEFydGljbGV7VGlja2V0SUR9IG5lICRTZWxmLT57VGlja2V0SUR9ICkgewogICAgICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkVycm9yU2NyZWVuKAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fQogICAgICAgICAgICAgICAgICAgICAgICAtPlRyYW5zbGF0ZSggJ0FydGljbGUgZG9lcyBub3QgYmVsb25nIHRvIHRpY2tldCAlcyEnLCAkU2VsZi0+e1RpY2tldElEfSApLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJEFydGljbGV7U3ViamVjdH0gPSAkVGlja2V0T2JqZWN0LT5UaWNrZXRTdWJqZWN0Q2xlYW4oCiAgICAgICAgICAgICAgICBUaWNrZXROdW1iZXIgPT4gJFRpY2tldHtUaWNrZXROdW1iZXJ9LAogICAgICAgICAgICAgICAgU3ViamVjdCAgICAgID0+ICRBcnRpY2xle1N1YmplY3R9IHx8ICcnLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgIyBzYXZlIGFydGljbGUgZnJvbSBmb3IgYWRkcmVzc2VzIGxpc3QKICAgICAgICAgICAgJEFydGljbGVGcm9tID0gJEFydGljbGV7RnJvbX07CgogICAgICAgICAgICAjIGlmIFRvIGlzIHByZXNlbnQKICAgICAgICAgICAgIyBhbmQgaXMgbm8gYSBxdWV1ZQogICAgICAgICAgICAjIGFuZCBhbHNvIGlzIG5vIGEgc3lzdGVtIGFkZHJlc3MKICAgICAgICAgICAgIyBzZXQgVG8gYXMgYXJ0aWNsZSBmcm9tCiAgICAgICAgICAgIGlmICggSXNTdHJpbmdXaXRoRGF0YSggJEFydGljbGV7VG99ICkgKSB7CiAgICAgICAgICAgICAgICBteSAlUXVldWVzID0gJFF1ZXVlT2JqZWN0LT5RdWV1ZUxpc3QoKTsKCiAgICAgICAgICAgICAgICBpZiAoICRDb25maWdPYmplY3QtPntDdXN0b21lclBhbmVsT3duU2VsZWN0aW9ufSApIHsKICAgICAgICAgICAgICAgICAgICBmb3IgbXkgJFF1ZXVlICggc29ydCBrZXlzICV7ICRDb25maWdPYmplY3QtPntDdXN0b21lclBhbmVsT3duU2VsZWN0aW9ufSB9ICkgewogICAgICAgICAgICAgICAgICAgICAgICBteSAkVmFsdWUgPSAkQ29uZmlnT2JqZWN0LT57Q3VzdG9tZXJQYW5lbE93blNlbGVjdGlvbn0tPnskUXVldWV9OwogICAgICAgICAgICAgICAgICAgICAgICAkUXVldWVzeyRRdWV1ZX0gPSAkVmFsdWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG15ICVRdWV1ZUxvb2t1cCA9IHJldmVyc2UgJVF1ZXVlczsKICAgICAgICAgICAgICAgIG15ICVTeXN0ZW1BZGRyZXNzTG9va3VwCiAgICAgICAgICAgICAgICAgICAgPSByZXZlcnNlICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpTeXN0ZW1BZGRyZXNzJyktPlN5c3RlbUFkZHJlc3NMaXN0KCk7CiAgICAgICAgICAgICAgICBteSBAQXJ0aWNsZUZyb21BZGRyZXNzOwogICAgICAgICAgICAgICAgbXkgJFN5c3RlbUFkZHJlc3NFbWFpbDsKCiAgICAgICAgICAgICAgICBpZiAoJEFydGljbGVGcm9tKSB7CiAgICAgICAgICAgICAgICAgICAgQEFydGljbGVGcm9tQWRkcmVzcyA9IE1haWw6OkFkZHJlc3MtPnBhcnNlKCRBcnRpY2xlRnJvbSk7CiAgICAgICAgICAgICAgICAgICAgJFN5c3RlbUFkZHJlc3NFbWFpbCA9ICRBcnRpY2xlRnJvbUFkZHJlc3NbMF0tPmFkZHJlc3MoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoICFkZWZpbmVkICRRdWV1ZUxvb2t1cHsgJEFydGljbGV7VG99IH0gJiYgZGVmaW5lZCAkU3lzdGVtQWRkcmVzc0xvb2t1cHskU3lzdGVtQWRkcmVzc0VtYWlsfSApIHsKICAgICAgICAgICAgICAgICAgICAkQXJ0aWNsZUZyb20gPSAkQXJ0aWNsZXtUb307CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgYm9keSBwcmVwYXJhdGlvbiBmb3IgcGxhaW4gdGV4dCBwcm9jZXNzaW5nCiAgICAgICAgICAgICRBcnRpY2xle0JvZHl9ID0gJExheW91dE9iamVjdC0+QXJ0aWNsZVF1b3RlKAogICAgICAgICAgICAgICAgVGlja2V0SUQgICAgICAgICAgID0+ICRBcnRpY2xle1RpY2tldElEfSwKICAgICAgICAgICAgICAgIEFydGljbGVJRCAgICAgICAgICA9PiAkR2V0UGFyYW17QXJ0aWNsZUlEfSwKICAgICAgICAgICAgICAgIEZvcm1JRCAgICAgICAgICAgICA9PiAkU2VsZi0+e0Zvcm1JRH0sCiAgICAgICAgICAgICAgICBVcGxvYWRDYWNoZU9iamVjdCAgPT4gJFVwbG9hZENhY2hlT2JqZWN0LAogICAgICAgICAgICAgICAgQXR0YWNobWVudHNJbmNsdWRlID0+IDEsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGlmICggJExheW91dE9iamVjdC0+e0Jyb3dzZXJSaWNoVGV4dH0gKSB7CiAgICAgICAgICAgICAgICAkQXJ0aWNsZXtDb250ZW50VHlwZX0gPSAndGV4dC9odG1sJzsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRBcnRpY2xle0NvbnRlbnRUeXBlfSA9ICd0ZXh0L3BsYWluJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbXkgJVNhZmV0eUNoZWNrUmVzdWx0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkhUTUxVdGlscycpLT5TYWZldHkoCiAgICAgICAgICAgICAgICBTdHJpbmcgPT4gJEFydGljbGV7Qm9keX0sCgogICAgICAgICAgICAgICAgIyBTdHJpcCBvdXQgZXh0ZXJuYWwgY29udGVudCBpZiBCbG9ja0xvYWRpbmdSZW1vdGVDb250ZW50IGlzIGVuYWJsZWQuCiAgICAgICAgICAgICAgICBOb0V4dFNyY0xvYWQgPT4gJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpCbG9ja0xvYWRpbmdSZW1vdGVDb250ZW50JyksCgogICAgICAgICAgICAgICAgIyBEaXNhbGxvdyBwb3RlbnRpYWxseSB1bnNhZmUgY29udGVudC4KICAgICAgICAgICAgICAgIE5vQXBwbGV0ICAgICA9PiAxLAogICAgICAgICAgICAgICAgTm9PYmplY3QgICAgID0+IDEsCiAgICAgICAgICAgICAgICBOb0VtYmVkICAgICAgPT4gMSwKICAgICAgICAgICAgICAgIE5vU1ZHICAgICAgICA9PiAxLAogICAgICAgICAgICAgICAgTm9KYXZhU2NyaXB0ID0+IDEsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgICRBcnRpY2xle0JvZHl9ID0gJFNhZmV0eUNoZWNrUmVzdWx0e1N0cmluZ307CgogICAgICAgICAgICAjIHNob3cgY3VzdG9tZXIgaW5mbwogICAgICAgICAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpGcm9udGVuZDo6Q3VzdG9tZXJJbmZvQ29tcG9zZScpICkgewogICAgICAgICAgICAgICAgaWYgKCAkU3BsaXRUaWNrZXREYXRhe0N1c3RvbWVyVXNlcklEfSApIHsKICAgICAgICAgICAgICAgICAgICAlQ3VzdG9tZXJEYXRhID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJVc2VyRGF0YUdldCgKICAgICAgICAgICAgICAgICAgICAgICAgVXNlciA9PiAkU3BsaXRUaWNrZXREYXRhe0N1c3RvbWVyVXNlcklEfSwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzaWYgKCAkU3BsaXRUaWNrZXREYXRhe0N1c3RvbWVySUR9ICkgewogICAgICAgICAgICAgICAgICAgICVDdXN0b21lckRhdGEgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJEYXRhR2V0KAogICAgICAgICAgICAgICAgICAgICAgICBDdXN0b21lcklEID0+ICRTcGxpdFRpY2tldERhdGF7Q3VzdG9tZXJJRH0sCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoICRTcGxpdFRpY2tldERhdGF7Q3VzdG9tZXJVc2VySUR9ICkgewogICAgICAgICAgICAgICAgbXkgJUN1c3RvbWVyVXNlckxpc3QgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclNlYXJjaCgKICAgICAgICAgICAgICAgICAgICBVc2VyTG9naW4gPT4gJFNwbGl0VGlja2V0RGF0YXtDdXN0b21lclVzZXJJRH0sCiAgICAgICAgICAgICAgICAgICAgVXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBmb3IgbXkgJEtleUN1c3RvbWVyVXNlckxpc3QgKCBzb3J0IGtleXMgJUN1c3RvbWVyVXNlckxpc3QgKSB7CiAgICAgICAgICAgICAgICAgICAgJEFydGljbGV7RnJvbX0gPSAkQ3VzdG9tZXJVc2VyTGlzdHskS2V5Q3VzdG9tZXJVc2VyTGlzdH07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgbXVsdGlwbGUgYWRkcmVzc2VzIGxpc3QKICAgICAgICAjIGNoZWNrIGVtYWlsIGFkZHJlc3MKICAgICAgICBteSAkQ291bnRGcm9tID0gc2NhbGFyIEBNdWx0aXBsZUN1c3RvbWVyIHx8IDE7CiAgICAgICAgbXkgJUN1c3RvbWVyRGF0YUZyb207CiAgICAgICAgaWYgKCAkQXJ0aWNsZXtDdXN0b21lclVzZXJJRH0gKSB7CiAgICAgICAgICAgICVDdXN0b21lckRhdGFGcm9tID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJVc2VyRGF0YUdldCgKICAgICAgICAgICAgICAgIFVzZXIgPT4gJEFydGljbGV7Q3VzdG9tZXJVc2VySUR9LAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgZm9yIG15ICRFbWFpbCAoIE1haWw6OkFkZHJlc3MtPnBhcnNlKCRBcnRpY2xlRnJvbSkgKSB7CgogICAgICAgICAgICBteSAkQ291bnRBdXggICAgICAgICA9ICRDb3VudEZyb207CiAgICAgICAgICAgIG15ICRDdXN0b21lckVycm9yICAgID0gJyc7CiAgICAgICAgICAgIG15ICRDdXN0b21lckVycm9yTXNnID0gJ0N1c3RvbWVyR2VuZXJpY1NlcnZlckVycm9yTXNnJzsKICAgICAgICAgICAgbXkgJEN1c3RvbWVyRGlzYWJsZWQgPSAnJzsKICAgICAgICAgICAgbXkgJEN1c3RvbWVyU2VsZWN0ZWQgPSAkQ291bnRGcm9tIGVxICcxJyA/ICdjaGVja2VkPSJjaGVja2VkIicgOiAnJzsKICAgICAgICAgICAgbXkgJEVtYWlsQWRkcmVzcyAgICAgPSAkRW1haWwtPmFkZHJlc3MoKTsKICAgICAgICAgICAgaWYgKCAhJENoZWNrSXRlbU9iamVjdC0+Q2hlY2tFbWFpbCggQWRkcmVzcyA9PiAkRW1haWxBZGRyZXNzICkgKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkQ3VzdG9tZXJFcnJvck1zZyA9ICRDaGVja0l0ZW1PYmplY3QtPkNoZWNrRXJyb3JUeXBlKCkKICAgICAgICAgICAgICAgICAgICAuICdTZXJ2ZXJFcnJvck1zZyc7CiAgICAgICAgICAgICAgICAkQ3VzdG9tZXJFcnJvciA9ICdTZXJ2ZXJFcnJvcic7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgY2hlY2sgZm9yIGR1cGxpY2F0ZWQgZW50cmllcwogICAgICAgICAgICBpZiAoIGRlZmluZWQgJEFkZHJlc3Nlc0xpc3R7JEVtYWlsfSAmJiAkQ3VzdG9tZXJFcnJvciBlcSAnJyApIHsKICAgICAgICAgICAgICAgICRDdXN0b21lckVycm9yTXNnID0gJ0lzRHVwbGljYXRlZFNlcnZlckVycm9yTXNnJzsKICAgICAgICAgICAgICAgICRDdXN0b21lckVycm9yICAgID0gJ1NlcnZlckVycm9yJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCAkQ3VzdG9tZXJFcnJvciBuZSAnJyApIHsKICAgICAgICAgICAgICAgICRDdXN0b21lckRpc2FibGVkID0gJ2Rpc2FibGVkPSJkaXNhYmxlZCInOwogICAgICAgICAgICAgICAgJENvdW50QXV4ICAgICAgICAgPSAkQ291bnRGcm9tIC4gJ0Vycm9yJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbXkgJFBocmFzZSA9ICcnOwogICAgICAgICAgICBpZiAoICRFbWFpbC0+cGhyYXNlKCkgKSB7CiAgICAgICAgICAgICAgICAkUGhyYXNlID0gJEVtYWlsLT5waHJhc2UoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbXkgJEN1c3RvbWVyS2V5ID0gJyc7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIGRlZmluZWQgJEN1c3RvbWVyRGF0YUZyb217VXNlckVtYWlsfQogICAgICAgICAgICAgICAgJiYgJEN1c3RvbWVyRGF0YUZyb217VXNlckVtYWlsfSBlcSAkRW1haWxBZGRyZXNzCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRDdXN0b21lcktleSA9ICRBcnRpY2xle0N1c3RvbWVyVXNlcklEfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNpZiAoJEVtYWlsQWRkcmVzcykgewogICAgICAgICAgICAgICAgbXkgJUxpc3QgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclNlYXJjaCgKICAgICAgICAgICAgICAgICAgICBQb3N0TWFzdGVyU2VhcmNoID0+ICRFbWFpbEFkZHJlc3MsCiAgICAgICAgICAgICAgICAgICAgVXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgZm9yIG15ICRVc2VyTG9naW4gKCBzb3J0IGtleXMgJUxpc3QgKSB7CgogICAgICAgICAgICAgICAgICAgICMgU2V0IHJpZ2h0IG9uZSBpZiB0aGVyZSBpcyBtb3JlIHRoYW4gb25lIGN1c3RvbWVyIHVzZXIgd2l0aCB0aGUgc2FtZSBlbWFpbCBhZGRyZXNzLgogICAgICAgICAgICAgICAgICAgIGlmICggJFBocmFzZSAmJiAkTGlzdHskVXNlckxvZ2lufSA9fiAvJFBocmFzZS8gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRDdXN0b21lcktleSA9ICRVc2VyTG9naW47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBteSAkQ3VzdG9tZXJFbGVtZW50ID0gJEVtYWlsQWRkcmVzczsKICAgICAgICAgICAgaWYgKCRQaHJhc2UpIHsKICAgICAgICAgICAgICAgICRDdXN0b21lckVsZW1lbnQgPSAkUGhyYXNlIC4gIiA8JEVtYWlsQWRkcmVzcz4iOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoICRDdXN0b21lclNlbGVjdGVkICYmICRDdXN0b21lcktleSApIHsKICAgICAgICAgICAgICAgICVDdXN0b21lckRhdGEgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJEYXRhR2V0KAogICAgICAgICAgICAgICAgICAgIFVzZXIgPT4gJEN1c3RvbWVyS2V5LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVzaCBATXVsdGlwbGVDdXN0b21lciwgewogICAgICAgICAgICAgICAgQ291bnQgICAgICAgICAgICA9PiAkQ291bnRBdXgsCiAgICAgICAgICAgICAgICBDdXN0b21lckVsZW1lbnQgID0+ICRDdXN0b21lckVsZW1lbnQsCiAgICAgICAgICAgICAgICBDdXN0b21lclNlbGVjdGVkID0+ICRDdXN0b21lclNlbGVjdGVkLAogICAgICAgICAgICAgICAgQ3VzdG9tZXJLZXkgICAgICA9PiAkQ3VzdG9tZXJLZXksCiAgICAgICAgICAgICAgICBDdXN0b21lckVycm9yICAgID0+ICRDdXN0b21lckVycm9yLAogICAgICAgICAgICAgICAgQ3VzdG9tZXJFcnJvck1zZyA9PiAkQ3VzdG9tZXJFcnJvck1zZywKICAgICAgICAgICAgICAgIEN1c3RvbWVyRGlzYWJsZWQgPT4gJEN1c3RvbWVyRGlzYWJsZWQsCiAgICAgICAgICAgIH07CiAgICAgICAgICAgICRBZGRyZXNzZXNMaXN0eyRFbWFpbEFkZHJlc3N9ID0gMTsKICAgICAgICAgICAgJENvdW50RnJvbSsrOwogICAgICAgIH0KCiAgICAgICAgIyBnZXQgdXNlciBwcmVmZXJlbmNlcwogICAgICAgIG15ICVVc2VyUHJlZmVyZW5jZXMgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VXNlcicpLT5HZXRVc2VyRGF0YSgKICAgICAgICAgICAgVXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICApOwoKICAgICAgICAjIHN0b3JlIHRoZSBkeW5hbWljIGZpZWxkcyBkZWZhdWx0IHZhbHVlcyBvciB1c2VkIHNwZWNpZmljIGRlZmF1bHQgdmFsdWVzIHRvIGJlIHVzZWQgYXMKICAgICAgICAjIEFDTHMgaW5mbyBmb3IgYWxsIGZpZWxkcwogICAgICAgIG15ICVEeW5hbWljRmllbGREZWZhdWx0czsKCiAgICAgICAgIyBjeWNsZSB0cm91Z2ggdGhlIGFjdGl2YXRlZCBEeW5hbWljIEZpZWxkcyBmb3IgdGhpcyBzY3JlZW4KICAgICAgICBEWU5BTUlDRklFTEQ6CiAgICAgICAgZm9yIG15ICREeW5hbWljRmllbGRDb25maWcgKCBAeyAkU2VsZi0+e0R5bmFtaWNGaWVsZH0gfSApIHsKICAgICAgICAgICAgbmV4dCBEWU5BTUlDRklFTEQgaWYgIUlzSGFzaFJlZldpdGhEYXRhKCREeW5hbWljRmllbGRDb25maWcpOwogICAgICAgICAgICBuZXh0IERZTkFNSUNGSUVMRCBpZiAhSXNIYXNoUmVmV2l0aERhdGEoICREeW5hbWljRmllbGRDb25maWctPntDb25maWd9ICk7CiAgICAgICAgICAgIG5leHQgRFlOQU1JQ0ZJRUxEIGlmICEkRHluYW1pY0ZpZWxkQ29uZmlnLT57TmFtZX07CgogICAgICAgICAgICAjIGdldCBkZWZhdWx0IHZhbHVlIGZyb20gZHluYW1pYyBmaWVsZCBjb25maWcgKGlmIGFueSkKICAgICAgICAgICAgbXkgJERlZmF1bHRWYWx1ZSA9ICREeW5hbWljRmllbGRDb25maWctPntDb25maWd9LT57RGVmYXVsdFZhbHVlfSB8fCAnJzsKCiAgICAgICAgICAgICMgb3ZlcnJpZGUgdGhlIHZhbHVlIGZyb20gdXNlciBwcmVmZXJlbmNlcyBpZiBpcyBzZXQKICAgICAgICAgICAgaWYgKCAkVXNlclByZWZlcmVuY2VzeyAnVXNlckR5bmFtaWNGaWVsZF8nIC4gJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9IH0gKSB7CiAgICAgICAgICAgICAgICAkRGVmYXVsdFZhbHVlID0gJFVzZXJQcmVmZXJlbmNlc3sgJ1VzZXJEeW5hbWljRmllbGRfJyAuICREeW5hbWljRmllbGRDb25maWctPntOYW1lfSB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBuZXh0IERZTkFNSUNGSUVMRCBpZiAkRGVmYXVsdFZhbHVlIGVxICcnOwogICAgICAgICAgICBuZXh0IERZTkFNSUNGSUVMRCBpZiByZWYgJERlZmF1bHRWYWx1ZSBlcSAnQVJSQVknICYmICFJc0FycmF5UmVmV2l0aERhdGEoJERlZmF1bHRWYWx1ZSk7CgogICAgICAgICAgICAkRHluYW1pY0ZpZWxkRGVmYXVsdHN7ICdEeW5hbWljRmllbGRfJyAuICREeW5hbWljRmllbGRDb25maWctPntOYW1lfSB9ID0gJERlZmF1bHRWYWx1ZTsKICAgICAgICB9CiAgICAgICAgJEdldFBhcmFte0R5bmFtaWNGaWVsZH0gPSBcJUR5bmFtaWNGaWVsZERlZmF1bHRzOwoKICAgICAgICAjIGNyZWF0ZSBodG1sIHN0cmluZ3MgZm9yIGFsbCBkeW5hbWljIGZpZWxkcwogICAgICAgIG15ICVEeW5hbWljRmllbGRIVE1MOwoKICAgICAgICBteSAlU3BsaXRUaWNrZXRQYXJhbTsKCiAgICAgICAgIyBpbiBjYXNlIG9mIHNwbGl0IGEgVGlja2V0SUQgYW5kIEFydGljbGVJRCBhcmUgYWx3YXlzIGdpdmVuLCBzZW5kIHRoZSBUaWNrZXRJRCB0byBjYWxjdWxhdGUKICAgICAgICAjIEFDTHMgYmFzZWQgb24gcGFyZW50IGluZm9ybWF0aW9uCiAgICAgICAgaWYgKCAkU2VsZi0+e1RpY2tldElEfSAmJiAkQXJ0aWNsZXtBcnRpY2xlSUR9ICkgewogICAgICAgICAgICAkU3BsaXRUaWNrZXRQYXJhbXtUaWNrZXRJRH0gPSAkU2VsZi0+e1RpY2tldElEfTsKICAgICAgICB9CgogICAgICAgICMgZml4IHRvIGJ1ZyMgODA2OCBGaWVsZCAmIER5bmFtaWNGaWVsZCBwcmVzZWxlY3Rpb24gb24gVGlja2V0U3BsaXQKICAgICAgICAjIHdoZW4gc3BsaXR0aW5nIGEgdGlja2V0IHRoZSBzZWxlY3RlZCBhdHRyaWJ1dGVzIG11c3QgcmVtYWluIGluIHRoZSBuZXcgdGlja2V0IHNjcmVlbgogICAgICAgICMgdGhpcyBpbmZvcm1hdGlvbiB3aWxsIGJlIGF2YWlsYWJsZSBpbiB0aGUgU3BsaXRUaWNrZXRQYXJhbSBoYXNoCiAgICAgICAgaWYgKCAkU3BsaXRUaWNrZXRQYXJhbXtUaWNrZXRJRH0gKSB7CgogICAgICAgICAgICAjIEdldCBpbmZvcm1hdGlvbiBmcm9tIG9yaWdpbmFsIHRpY2tldCAoU3BsaXRUaWNrZXQpLgogICAgICAgICAgICBteSAlU3BsaXRUaWNrZXREYXRhID0gJFRpY2tldE9iamVjdC0+VGlja2V0R2V0KAogICAgICAgICAgICAgICAgVGlja2V0SUQgICAgICA9PiAkU3BsaXRUaWNrZXRQYXJhbXtUaWNrZXRJRH0sCiAgICAgICAgICAgICAgICBEeW5hbWljRmllbGRzID0+IDEsCiAgICAgICAgICAgICAgICBVc2VySUQgICAgICAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgc2V0IHNpbXBsZSBJRHMgdG8gcGFzcyB0aGVtIHRvIHRoZSBtYXNrCiAgICAgICAgICAgIGZvciBteSAkU3BsaXRlZFBhcmFtIChxdyhUeXBlSUQgU2VydmljZUlEIFNMQUlEIFByaW9yaXR5SUQpKSB7CiAgICAgICAgICAgICAgICAkU3BsaXRUaWNrZXRQYXJhbXskU3BsaXRlZFBhcmFtfSA9ICRTcGxpdFRpY2tldERhdGF7JFNwbGl0ZWRQYXJhbX07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgc2V0IFN0YXRlSUQgYXMgTmV4dFN0YXRlSUQKICAgICAgICAgICAgJFNwbGl0VGlja2V0UGFyYW17TmV4dFN0YXRlSUR9ID0gJFNwbGl0VGlja2V0RGF0YXtTdGF0ZUlEfTsKCiAgICAgICAgICAgICMgc2V0IE93bmVyIGFuZCBSZXNwb25zaWJsZQogICAgICAgICAgICAkU3BsaXRUaWNrZXRQYXJhbXtVc2VyU2VsZWN0ZWR9ICAgICAgICAgICAgPSAkU3BsaXRUaWNrZXREYXRhe093bmVySUR9OwogICAgICAgICAgICAkU3BsaXRUaWNrZXRQYXJhbXtSZXNwb25zaWJsZVVzZXJTZWxlY3RlZH0gPSAkU3BsaXRUaWNrZXREYXRhe1Jlc3BvbnNpYmxlSUR9OwoKICAgICAgICAgICAgIyBzZXQgYWRkaXRpb25hbCBpbmZvcm1hdGlvbiBuZWVkZWQgZm9yIE93bmVyIGFuZCBSZXNwb25zaWJsZQogICAgICAgICAgICBpZiAoICRTcGxpdFRpY2tldERhdGF7UXVldWVJRH0gKSB7CiAgICAgICAgICAgICAgICAkU3BsaXRUaWNrZXRQYXJhbXtRdWV1ZUlEfSA9ICRTcGxpdFRpY2tldERhdGF7UXVldWVJRH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJFNwbGl0VGlja2V0UGFyYW17QWxsVXNlcnN9ID0gMTsKCiAgICAgICAgICAgICMgc2V0IHRoZSBzZWxlY3RlZCBxdWV1ZSBpbiBmb3JtYXQgSUR8fE5hbWUKICAgICAgICAgICAgJFNwbGl0VGlja2V0UGFyYW17VG9TZWxlY3RlZH0gPSAkU3BsaXRUaWNrZXREYXRhe1F1ZXVlSUR9IC4gJ3x8JyAuICRTcGxpdFRpY2tldERhdGF7UXVldWV9OwoKICAgICAgICAgICAgZm9yIG15ICRLZXkgKCBzb3J0IGtleXMgJVNwbGl0VGlja2V0RGF0YSApIHsKICAgICAgICAgICAgICAgIGlmICggJEtleSA9fiAvRHluYW1pY0ZpZWxkXF8oLiopLyApIHsKICAgICAgICAgICAgICAgICAgICAkU3BsaXRUaWNrZXRQYXJhbXtEeW5hbWljRmllbGR9eyQxfSA9ICRTcGxpdFRpY2tldERhdGF7JEtleX07CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlICRTcGxpdFRpY2tldFBhcmFteyRLZXl9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIGN5Y2xlIHRocm91Z2ggdGhlIGFjdGl2YXRlZCBEeW5hbWljIEZpZWxkcyBmb3IgdGhpcyBzY3JlZW4KICAgICAgICBEWU5BTUlDRklFTEQ6CiAgICAgICAgZm9yIG15ICREeW5hbWljRmllbGRDb25maWcgKCBAeyAkU2VsZi0+e0R5bmFtaWNGaWVsZH0gfSApIHsKICAgICAgICAgICAgbmV4dCBEWU5BTUlDRklFTEQgaWYgIUlzSGFzaFJlZldpdGhEYXRhKCREeW5hbWljRmllbGRDb25maWcpOwoKICAgICAgICAgICAgbXkgJFBvc3NpYmxlVmFsdWVzRmlsdGVyOwoKICAgICAgICAgICAgbXkgJElzQUNMUmVkdWNpYmxlID0gJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QtPkhhc0JlaGF2aW9yKAogICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRDb25maWcsCiAgICAgICAgICAgICAgICBCZWhhdmlvciAgICAgICAgICAgPT4gJ0lzQUNMUmVkdWNpYmxlJywKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGlmICgkSXNBQ0xSZWR1Y2libGUpIHsKCiAgICAgICAgICAgICAgICAjIGdldCBQb3NzaWJsZVZhbHVlcwogICAgICAgICAgICAgICAgbXkgJFBvc3NpYmxlVmFsdWVzID0gJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QtPlBvc3NpYmxlVmFsdWVzR2V0KAogICAgICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZENvbmZpZyA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnLAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAjIGNoZWNrIGlmIGZpZWxkIGhhcyBQb3NzaWJsZVZhbHVlcyBwcm9wZXJ0eSBpbiBpdHMgY29uZmlndXJhdGlvbgogICAgICAgICAgICAgICAgaWYgKCBJc0hhc2hSZWZXaXRoRGF0YSgkUG9zc2libGVWYWx1ZXMpICkgewoKICAgICAgICAgICAgICAgICAgICAjIGNvbnZlcnQgcG9zc2libGUgdmFsdWVzIGtleSA9PiB2YWx1ZSB0byBrZXkgPT4ga2V5IGZvciBBQ0xzIHVzaW5nIGEgSGFzaCBzbGljZQogICAgICAgICAgICAgICAgICAgIG15ICVBY2xEYXRhID0gJXskUG9zc2libGVWYWx1ZXN9OwogICAgICAgICAgICAgICAgICAgIEBBY2xEYXRheyBrZXlzICVBY2xEYXRhIH0gPSBrZXlzICVBY2xEYXRhOwoKICAgICAgICAgICAgICAgICAgICAjIHNldCBwb3NzaWJsZSB2YWx1ZXMgZmlsdGVyIGZyb20gQUNMcwogICAgICAgICAgICAgICAgICAgIG15ICRBQ0wgPSAkVGlja2V0T2JqZWN0LT5UaWNrZXRBY2woCiAgICAgICAgICAgICAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgICAgICAgICAgICAgJUFDTENvbXBhdEdldFBhcmFtLAogICAgICAgICAgICAgICAgICAgICAgICAlU3BsaXRUaWNrZXRQYXJhbSwKICAgICAgICAgICAgICAgICAgICAgICAgQWN0aW9uICAgICAgICA9PiAkU2VsZi0+e0FjdGlvbn0sCiAgICAgICAgICAgICAgICAgICAgICAgIFJldHVyblR5cGUgICAgPT4gJ1RpY2tldCcsCiAgICAgICAgICAgICAgICAgICAgICAgIFJldHVyblN1YlR5cGUgPT4gJ0R5bmFtaWNGaWVsZF8nIC4gJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9LAogICAgICAgICAgICAgICAgICAgICAgICBEYXRhICAgICAgICAgID0+IFwlQWNsRGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgVXNlcklEICAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICBpZiAoJEFDTCkgewogICAgICAgICAgICAgICAgICAgICAgICBteSAlRmlsdGVyID0gJFRpY2tldE9iamVjdC0+VGlja2V0QWNsRGF0YSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgIyBjb252ZXJ0IEZpbGVyIGtleSA9PiBrZXkgYmFjayB0byBrZXkgPT4gdmFsdWUgdXNpbmcgbWFwCiAgICAgICAgICAgICAgICAgICAgICAgICV7JFBvc3NpYmxlVmFsdWVzRmlsdGVyfSA9IG1hcCB7ICRfID0+ICRQb3NzaWJsZVZhbHVlcy0+eyRffSB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXlzICVGaWx0ZXI7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIHRvIHN0b3JlIGR5bmFtaWMgZmllbGQgdmFsdWUgZnJvbSBkYXRhYmFzZSAob3IgdW5kZWZpbmVkKQogICAgICAgICAgICBteSAkVmFsdWU7CgogICAgICAgICAgICAjIGluIGNhc2Ugb2Ygc3BsaXQgYSBUaWNrZXRJRCBhbmQgQXJ0aWNsZUlEIGFyZSBhbHdheXMgZ2l2ZW4sIEdldCB0aGUgdmFsdWUKICAgICAgICAgICAgIyBmcm9tIERCIHRoaXMgY2FzZXMKICAgICAgICAgICAgaWYgKCAkU2VsZi0+e1RpY2tldElEfSAmJiAkQXJ0aWNsZXtBcnRpY2xlSUR9ICkgewoKICAgICAgICAgICAgICAgICMgc2VsZWN0IFRpY2tldElEIG9yIEFydGljbGVJRCB0byBnZXQgdGhlIHZhbHVlIGRlcGVuZGluZyBvbiBkeW5hbWljIGZpZWxkIGNvbmZpZ3VyYXRpb24KICAgICAgICAgICAgICAgIG15ICRPYmplY3RJRCA9ICREeW5hbWljRmllbGRDb25maWctPntPYmplY3RUeXBlfSBlcSAnVGlja2V0JwogICAgICAgICAgICAgICAgICAgID8gJFNlbGYtPntUaWNrZXRJRH0KICAgICAgICAgICAgICAgICAgICA6ICRBcnRpY2xle0FydGljbGVJRH07CgogICAgICAgICAgICAgICAgIyBnZXQgdmFsdWUgc3RvcmVkIG9uIHRoZSBkYXRhYmFzZSAoc3BsaXQpCiAgICAgICAgICAgICAgICAkVmFsdWUgPSAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdC0+VmFsdWVHZXQoCiAgICAgICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRDb25maWcsCiAgICAgICAgICAgICAgICAgICAgT2JqZWN0SUQgICAgICAgICAgID0+ICRPYmplY3RJRCwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgb3RoZXJ3aXNlIChvbiBhIG5ldyB0aWNrZXQpLiBDaGVjayBpZiB0aGUgdXNlciBoYXMgYSB1c2VyIHNwZWNpZmljIGRlZmF1bHQgdmFsdWUgZm9yCiAgICAgICAgICAgICMgdGhlIGR5bmFtaWMgZmllbGQsIG90aGVyd2lzZSB3aWxsIHVzZSBEeW5hbWljIEZpZWxkIGRlZmF1bHQgdmFsdWUKICAgICAgICAgICAgZWxzZSB7CgogICAgICAgICAgICAgICAgIyBvdmVycmlkZSB0aGUgdmFsdWUgZnJvbSB1c2VyIHByZWZlcmVuY2VzIGlmIGlzIHNldAogICAgICAgICAgICAgICAgaWYgKCAkVXNlclByZWZlcmVuY2VzeyAnVXNlckR5bmFtaWNGaWVsZF8nIC4gJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9IH0gKSB7CiAgICAgICAgICAgICAgICAgICAgJFZhbHVlID0gJFVzZXJQcmVmZXJlbmNlc3sgJ1VzZXJEeW5hbWljRmllbGRfJyAuICREeW5hbWljRmllbGRDb25maWctPntOYW1lfSB9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGdldCBmaWVsZCBodG1sCiAgICAgICAgICAgICREeW5hbWljRmllbGRIVE1MeyAkRHluYW1pY0ZpZWxkQ29uZmlnLT57TmFtZX0gfSA9ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0LT5FZGl0RmllbGRSZW5kZXIoCiAgICAgICAgICAgICAgICBEeW5hbWljRmllbGRDb25maWcgICA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnLAogICAgICAgICAgICAgICAgUG9zc2libGVWYWx1ZXNGaWx0ZXIgPT4gJFBvc3NpYmxlVmFsdWVzRmlsdGVyLAogICAgICAgICAgICAgICAgVmFsdWUgICAgICAgICAgICAgICAgPT4gJFZhbHVlLAogICAgICAgICAgICAgICAgTGF5b3V0T2JqZWN0ICAgICAgICAgPT4gJExheW91dE9iamVjdCwKICAgICAgICAgICAgICAgIFBhcmFtT2JqZWN0ICAgICAgICAgID0+ICRQYXJhbU9iamVjdCwKICAgICAgICAgICAgICAgIEFKQVhVcGRhdGUgICAgICAgICAgID0+IDEsCiAgICAgICAgICAgICAgICBVcGRhdGFibGVGaWVsZHMgICAgICA9PiAkU2VsZi0+X0dldEZpZWxkc1RvVXBkYXRlKCksCiAgICAgICAgICAgICAgICBNYW5kYXRvcnkgICAgICAgICAgICA9PiAkQ29uZmlnLT57RHluYW1pY0ZpZWxkfS0+eyAkRHluYW1pY0ZpZWxkQ29uZmlnLT57TmFtZX0gfSA9PSAyLAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBnZXQgYWxsIGF0dGFjaG1lbnRzIG1ldGEgZGF0YQogICAgICAgIG15IEBBdHRhY2htZW50cyA9ICRVcGxvYWRDYWNoZU9iamVjdC0+Rm9ybUlER2V0QWxsRmlsZXNNZXRhKAogICAgICAgICAgICBGb3JtSUQgPT4gJFNlbGYtPntGb3JtSUR9LAogICAgICAgICk7CgogICAgICAgICMgZ2V0IGFuZCBmb3JtYXQgZGVmYXVsdCBzdWJqZWN0IGFuZCBib2R5CiAgICAgICAgbXkgJFN1YmplY3QgPSAkQXJ0aWNsZXtTdWJqZWN0fTsKICAgICAgICBpZiAoICEkU3ViamVjdCApIHsKICAgICAgICAgICAgJFN1YmplY3QgPSAkTGF5b3V0T2JqZWN0LT5PdXRwdXQoCiAgICAgICAgICAgICAgICBUZW1wbGF0ZSA9PiAkQ29uZmlnLT57U3ViamVjdH0gfHwgJycsCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIG15ICRCb2R5ID0gJEFydGljbGV7Qm9keX0gfHwgJyc7CiAgICAgICAgaWYgKCAhJEJvZHkgKSB7CiAgICAgICAgICAgICRCb2R5ID0gJExheW91dE9iamVjdC0+T3V0cHV0KAogICAgICAgICAgICAgICAgVGVtcGxhdGUgPT4gJENvbmZpZy0+e0JvZHl9IHx8ICcnLAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBtYWtlIHN1cmUgYm9keSBpcyByaWNoIHRleHQgKGlmIGJvZHkgaXMgYmFzZWQgb24gY29uZmlnKQogICAgICAgIGlmICggISRHZXRQYXJhbXtBcnRpY2xlSUR9ICYmICRMYXlvdXRPYmplY3QtPntCcm93c2VyUmljaFRleHR9ICkgewogICAgICAgICAgICAkQm9keSA9ICRMYXlvdXRPYmplY3QtPkFzY2lpMlJpY2hUZXh0KAogICAgICAgICAgICAgICAgU3RyaW5nID0+ICRCb2R5LAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBpbiBjYXNlIG9mIHRpY2tldCBzcGxpdCBzZXQgJFNlbGYtPntRdWV1ZUlEfSBhcyB0aGUgUXVldWVJRCBvZiB0aGUgb3JpZ2luYWwgdGlja2V0LAogICAgICAgICMgaW4gb3JkZXIgdG8gc2V0IGNvcnJlY3QgQUNMcyBvbiBwYWdlIGxvYWQgKGluaXRpYWwpLiBTZWUgYnVnIDg2ODcuCiAgICAgICAgaWYgKAogICAgICAgICAgICBJc0hhc2hSZWZXaXRoRGF0YSggXCVTcGxpdFRpY2tldFBhcmFtICkKICAgICAgICAgICAgJiYgJFNwbGl0VGlja2V0UGFyYW17UXVldWVJRH0KICAgICAgICAgICAgJiYgISRTZWxmLT57UXVldWVJRH0KICAgICAgICAgICAgKQogICAgICAgIHsKICAgICAgICAgICAgJFNlbGYtPntRdWV1ZUlEfSA9ICRTcGxpdFRpY2tldFBhcmFte1F1ZXVlSUR9OwogICAgICAgIH0KCiAgICAgICAgIyBHZXQgcHJlZGVmaW5lZCBRdWV1ZUlEIChpZiBubyBxdWV1ZSBmcm9tIHNwbGl0IHRpY2tldCBpcyBzZXQpLgogICAgICAgIGlmICggISRTZWxmLT57UXVldWVJRH0gJiYgJEdldFBhcmFte0Rlc3R9ICkgewoKICAgICAgICAgICAgbXkgQFF1ZXVlUGFydHMgPSBzcGxpdCggL1x8XHwvLCAkR2V0UGFyYW17RGVzdH0gKTsKICAgICAgICAgICAgJFNlbGYtPntRdWV1ZUlEfSA9ICRRdWV1ZVBhcnRzWzBdOwogICAgICAgICAgICAkU3BsaXRUaWNrZXRQYXJhbXtUb1NlbGVjdGVkfSA9ICRHZXRQYXJhbXtEZXN0fTsKICAgICAgICB9CgogICAgICAgICMgaHRtbCBvdXRwdXQKICAgICAgICBteSAkU2VydmljZXMgPSAkU2VsZi0+X0dldFNlcnZpY2VzKAogICAgICAgICAgICAlR2V0UGFyYW0sCiAgICAgICAgICAgICVBQ0xDb21wYXRHZXRQYXJhbSwKICAgICAgICAgICAgJVNwbGl0VGlja2V0UGFyYW0sCiAgICAgICAgICAgIEN1c3RvbWVyVXNlcklEID0+ICRDdXN0b21lckRhdGF7VXNlckxvZ2lufSB8fCAnJywKICAgICAgICAgICAgUXVldWVJRCAgICAgICAgPT4gJFNlbGYtPntRdWV1ZUlEfSAgICAgICAgIHx8IDEsCiAgICAgICAgKTsKICAgICAgICBteSAkU0xBcyA9ICRTZWxmLT5fR2V0U0xBcygKICAgICAgICAgICAgJUdldFBhcmFtLAogICAgICAgICAgICAlQUNMQ29tcGF0R2V0UGFyYW0sCiAgICAgICAgICAgICVTcGxpdFRpY2tldFBhcmFtLAogICAgICAgICAgICBDdXN0b21lclVzZXJJRCA9PiAkQ3VzdG9tZXJEYXRhe1VzZXJMb2dpbn0gfHwgJycsCiAgICAgICAgICAgIFF1ZXVlSUQgICAgICAgID0+ICRTZWxmLT57UXVldWVJRH0gICAgICAgICB8fCAxLAogICAgICAgICAgICBTZXJ2aWNlcyAgICAgICA9PiAkU2VydmljZXMsCiAgICAgICAgKTsKICAgICAgICAkT3V0cHV0IC49ICRTZWxmLT5fTWFza1Bob25lTmV3KAogICAgICAgICAgICBRdWV1ZUlEICAgID0+ICRTZWxmLT57UXVldWVJRH0sCiAgICAgICAgICAgIE5leHRTdGF0ZXMgPT4gJFNlbGYtPl9HZXROZXh0U3RhdGVzKAogICAgICAgICAgICAgICAgJUdldFBhcmFtLAogICAgICAgICAgICAgICAgJUFDTENvbXBhdEdldFBhcmFtLAogICAgICAgICAgICAgICAgJVNwbGl0VGlja2V0UGFyYW0sCiAgICAgICAgICAgICAgICBDdXN0b21lclVzZXJJRCA9PiAkQ3VzdG9tZXJEYXRhe1VzZXJMb2dpbn0gfHwgJycsCiAgICAgICAgICAgICAgICBRdWV1ZUlEICAgICAgICA9PiAkU2VsZi0+e1F1ZXVlSUR9ICAgICAgICAgfHwgMSwKICAgICAgICAgICAgKSwKICAgICAgICAgICAgUHJpb3JpdGllcyA9PiAkU2VsZi0+X0dldFByaW9yaXRpZXMoCiAgICAgICAgICAgICAgICAlR2V0UGFyYW0sCiAgICAgICAgICAgICAgICAlQUNMQ29tcGF0R2V0UGFyYW0sCiAgICAgICAgICAgICAgICAlU3BsaXRUaWNrZXRQYXJhbSwKICAgICAgICAgICAgICAgIEN1c3RvbWVyVXNlcklEID0+ICRDdXN0b21lckRhdGF7VXNlckxvZ2lufSB8fCAnJywKICAgICAgICAgICAgICAgIFF1ZXVlSUQgICAgICAgID0+ICRTZWxmLT57UXVldWVJRH0gICAgICAgICB8fCAxLAogICAgICAgICAgICApLAogICAgICAgICAgICBUeXBlcyA9PiAkU2VsZi0+X0dldFR5cGVzKAogICAgICAgICAgICAgICAgJUdldFBhcmFtLAogICAgICAgICAgICAgICAgJUFDTENvbXBhdEdldFBhcmFtLAogICAgICAgICAgICAgICAgJVNwbGl0VGlja2V0UGFyYW0sCiAgICAgICAgICAgICAgICBDdXN0b21lclVzZXJJRCA9PiAkQ3VzdG9tZXJEYXRhe1VzZXJMb2dpbn0gfHwgJycsCiAgICAgICAgICAgICAgICBRdWV1ZUlEICAgICAgICA9PiAkU2VsZi0+e1F1ZXVlSUR9ICAgICAgICAgfHwgMSwKICAgICAgICAgICAgKSwKICAgICAgICAgICAgU2VydmljZXMgICAgICAgICAgPT4gJFNlcnZpY2VzLAogICAgICAgICAgICBTTEFzICAgICAgICAgICAgICA9PiAkU0xBcywKICAgICAgICAgICAgU3RhbmRhcmRUZW1wbGF0ZXMgPT4gJFNlbGYtPl9HZXRTdGFuZGFyZFRlbXBsYXRlcygKICAgICAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgICAgICVBQ0xDb21wYXRHZXRQYXJhbSwKICAgICAgICAgICAgICAgICVTcGxpdFRpY2tldFBhcmFtLAogICAgICAgICAgICAgICAgUXVldWVJRCA9PiAkU2VsZi0+e1F1ZXVlSUR9IHx8ICcnLAogICAgICAgICAgICApLAogICAgICAgICAgICBVc2VycyA9PiAkU2VsZi0+X0dldFVzZXJzKAogICAgICAgICAgICAgICAgJUdldFBhcmFtLAogICAgICAgICAgICAgICAgJUFDTENvbXBhdEdldFBhcmFtLAogICAgICAgICAgICAgICAgUXVldWVJRCA9PiAkU2VsZi0+e1F1ZXVlSUR9LAogICAgICAgICAgICAgICAgJVNwbGl0VGlja2V0UGFyYW0sCiAgICAgICAgICAgICksCiAgICAgICAgICAgIFJlc3BvbnNpYmxlVXNlcnMgPT4gJFNlbGYtPl9HZXRSZXNwb25zaWJsZXMoCiAgICAgICAgICAgICAgICAlR2V0UGFyYW0sCiAgICAgICAgICAgICAgICAlQUNMQ29tcGF0R2V0UGFyYW0sCiAgICAgICAgICAgICAgICBRdWV1ZUlEID0+ICRTZWxmLT57UXVldWVJRH0sCiAgICAgICAgICAgICAgICAlU3BsaXRUaWNrZXRQYXJhbSwKICAgICAgICAgICAgKSwKICAgICAgICAgICAgVG8gPT4gJFNlbGYtPl9HZXRUb3MoCiAgICAgICAgICAgICAgICAlR2V0UGFyYW0sCiAgICAgICAgICAgICAgICAlQUNMQ29tcGF0R2V0UGFyYW0sCiAgICAgICAgICAgICAgICAlU3BsaXRUaWNrZXRQYXJhbSwKICAgICAgICAgICAgICAgIEN1c3RvbWVyVXNlcklEID0+ICRDdXN0b21lckRhdGF7VXNlckxvZ2lufSB8fCAnJywKICAgICAgICAgICAgICAgIFF1ZXVlSUQgICAgICAgID0+ICRTZWxmLT57UXVldWVJRH0sCiAgICAgICAgICAgICksCiAgICAgICAgICAgIFRpbWVVbml0cyA9PiAkU2VsZi0+X0dldFRpbWVVbml0cygKICAgICAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgICAgICVBQ0xDb21wYXRHZXRQYXJhbSwKICAgICAgICAgICAgICAgICVTcGxpdFRpY2tldFBhcmFtLAogICAgICAgICAgICAgICAgQXJ0aWNsZUlEID0+ICRBcnRpY2xle0FydGljbGVJRH0sCiAgICAgICAgICAgICksCiAgICAgICAgICAgIEZyb20gICAgICAgICA9PiAkQXJ0aWNsZXtGcm9tfSwKICAgICAgICAgICAgU3ViamVjdCAgICAgID0+ICRTdWJqZWN0LAogICAgICAgICAgICBCb2R5ICAgICAgICAgPT4gJEJvZHksCiAgICAgICAgICAgIEN1c3RvbWVyVXNlciA9PiAkU3BsaXRUaWNrZXREYXRhe0N1c3RvbWVyVXNlcklEfSwKICAgICAgICAgICAgQ3VzdG9tZXJJRCAgID0+ICRTcGxpdFRpY2tldERhdGF7Q3VzdG9tZXJJRH0sCiAgICAgICAgICAgIEN1c3RvbWVyRGF0YSA9PiBcJUN1c3RvbWVyRGF0YSwKICAgICAgICAgICAgQXR0YWNobWVudHMgID0+IFxAQXR0YWNobWVudHMsCiAgICAgICAgICAgIExpbmtUaWNrZXRJRCA9PiAkR2V0UGFyYW17TGlua1RpY2tldElEfSB8fCAnJywKICAgICAgICAgICAgRnJvbUNoYXRJRCAgID0+ICRHZXRQYXJhbXtGcm9tQ2hhdElEfSB8fCAnJywKICAgICAgICAgICAgJVNwbGl0VGlja2V0UGFyYW0sCiAgICAgICAgICAgIER5bmFtaWNGaWVsZEhUTUwgPT4gXCVEeW5hbWljRmllbGRIVE1MLAogICAgICAgICAgICBNdWx0aXBsZUN1c3RvbWVyID0+IFxATXVsdGlwbGVDdXN0b21lciwKICAgICAgICApOwogICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Rm9vdGVyKCk7CiAgICAgICAgcmV0dXJuICRPdXRwdXQ7CiAgICB9CgogICAgIyBjcmVhdGUgbmV3IHRpY2tldCBhbmQgYXJ0aWNsZQogICAgZWxzaWYgKCAkU2VsZi0+e1N1YmFjdGlvbn0gZXEgJ1N0b3JlTmV3JyApIHsKCiAgICAgICAgbXkgJUVycm9yOwogICAgICAgIG15ICVTdGF0ZURhdGE7CiAgICAgICAgaWYgKCAkR2V0UGFyYW17TmV4dFN0YXRlSUR9ICkgewogICAgICAgICAgICAlU3RhdGVEYXRhID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlN0YXRlJyktPlN0YXRlR2V0KAogICAgICAgICAgICAgICAgSUQgPT4gJEdldFBhcmFte05leHRTdGF0ZUlEfSwKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgbXkgJE5leHRTdGF0ZSA9ICRTdGF0ZURhdGF7TmFtZX0gICAgICAgICAgICAgICAgICAgICAgICAgIHx8ICcnOwogICAgICAgIG15ICREZXN0ICAgICAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnRGVzdCcgKSB8fCAnJzsKCiAgICAgICAgIyBzZWUgaWYgb25seSBhIG5hbWUgaGFzIGJlZW4gcGFzc2VkCiAgICAgICAgaWYgKCAkRGVzdCAmJiAkRGVzdCAhfiBteyBcQSAoXGQrKT8gXHwgXHwgLisgXHogfXhtcyApIHsKCiAgICAgICAgICAgICMgc2VlIGlmIHdlIGNhbiBnZXQgYW4gSUQgZm9yIHRoaXMgcXVldWUgbmFtZQogICAgICAgICAgICBteSAkRGVzdElEID0gJFF1ZXVlT2JqZWN0LT5RdWV1ZUxvb2t1cCgKICAgICAgICAgICAgICAgIFF1ZXVlID0+ICREZXN0LAogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKCREZXN0SUQpIHsKICAgICAgICAgICAgICAgICREZXN0ID0gJERlc3RJRCAuICd8fCcgLiAkRGVzdDsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICREZXN0ID0gJyc7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIG15ICggJE5ld1F1ZXVlSUQsICRUbyApID0gc3BsaXQoIC9cfFx8LywgJERlc3QgKTsKICAgICAgICAkR2V0UGFyYW17UXVldWVJRH0gPSAkTmV3UXVldWVJRDsKCiAgICAgICAgbXkgJEN1c3RvbWVyVXNlciA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdDdXN0b21lclVzZXInICkKICAgICAgICAgICAgfHwgJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ1ByZVNlbGVjdGVkQ3VzdG9tZXJVc2VyJyApCiAgICAgICAgICAgIHx8ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdTZWxlY3RlZEN1c3RvbWVyVXNlcicgKQogICAgICAgICAgICB8fCAnJzsKICAgICAgICBteSAkU2VsZWN0ZWRDdXN0b21lclVzZXIgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnU2VsZWN0ZWRDdXN0b21lclVzZXInICkKICAgICAgICAgICAgfHwgJyc7CiAgICAgICAgbXkgJEN1c3RvbWVySUQgICAgICAgICA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdDdXN0b21lcklEJyApIHx8ICcnOwogICAgICAgIG15ICRFeHBhbmRDdXN0b21lck5hbWUgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnRXhwYW5kQ3VzdG9tZXJOYW1lJyApCiAgICAgICAgICAgIHx8IDA7CiAgICAgICAgbXkgJUZyb21FeHRlcm5hbEN1c3RvbWVyOwogICAgICAgICRGcm9tRXh0ZXJuYWxDdXN0b21lcntDdXN0b21lcn0gPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnUHJlU2VsZWN0ZWRDdXN0b21lclVzZXInICkKICAgICAgICAgICAgfHwgJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0N1c3RvbWVyVXNlcicgKQogICAgICAgICAgICB8fCAnJzsKCiAgICAgICAgaWYgKCAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnT3duZXJBbGxSZWZyZXNoJyApICkgewogICAgICAgICAgICAkR2V0UGFyYW17T3duZXJBbGx9ID0gMTsKICAgICAgICAgICAgJEV4cGFuZEN1c3RvbWVyTmFtZSA9IDM7CiAgICAgICAgfQogICAgICAgIGlmICggJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ1Jlc3BvbnNpYmxlQWxsUmVmcmVzaCcgKSApIHsKICAgICAgICAgICAgJEdldFBhcmFte1Jlc3BvbnNpYmxlQWxsfSA9IDE7CiAgICAgICAgICAgICRFeHBhbmRDdXN0b21lck5hbWUgPSAzOwogICAgICAgIH0KICAgICAgICBpZiAoICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdDbGVhckZyb20nICkgKSB7CiAgICAgICAgICAgICRHZXRQYXJhbXtGcm9tfSA9ICcnOwogICAgICAgICAgICAkRXhwYW5kQ3VzdG9tZXJOYW1lID0gMzsKICAgICAgICB9CiAgICAgICAgZm9yIG15ICRDb3VudCAoIDEgLi4gMiApIHsKICAgICAgICAgICAgbXkgJEl0ZW0gPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAiRXhwYW5kQ3VzdG9tZXJOYW1lJENvdW50IiApIHx8IDA7CiAgICAgICAgICAgIGlmICggJENvdW50ID09IDEgJiYgJEl0ZW0gKSB7CiAgICAgICAgICAgICAgICAkRXhwYW5kQ3VzdG9tZXJOYW1lID0gMTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNpZiAoICRDb3VudCA9PSAyICYmICRJdGVtICkgewogICAgICAgICAgICAgICAgJEV4cGFuZEN1c3RvbWVyTmFtZSA9IDI7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgcmV3cmFwIGJvZHkgaWYgbm8gcmljaCB0ZXh0IGlzIHVzZWQKICAgICAgICBpZiAoICRHZXRQYXJhbXtCb2R5fSAmJiAhJExheW91dE9iamVjdC0+e0Jyb3dzZXJSaWNoVGV4dH0gKSB7CiAgICAgICAgICAgICRHZXRQYXJhbXtCb2R5fSA9ICRMYXlvdXRPYmplY3QtPldyYXBQbGFpblRleHQoCiAgICAgICAgICAgICAgICBNYXhDaGFyYWN0ZXJzID0+ICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpGcm9udGVuZDo6VGV4dEFyZWFOb3RlJyksCiAgICAgICAgICAgICAgICBQbGFpblRleHQgICAgID0+ICRHZXRQYXJhbXtCb2R5fSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgZ2V0IGFsbCBhdHRhY2htZW50cyBtZXRhIGRhdGEKICAgICAgICBteSBAQXR0YWNobWVudHMgPSAkVXBsb2FkQ2FjaGVPYmplY3QtPkZvcm1JREdldEFsbEZpbGVzTWV0YSgKICAgICAgICAgICAgRm9ybUlEID0+ICRTZWxmLT57Rm9ybUlEfSwKICAgICAgICApOwoKICAgICAgICAjIGNoZWNrIHBlbmRpbmcgZGF0ZQogICAgICAgIGlmICggISRFeHBhbmRDdXN0b21lck5hbWUgJiYgJFN0YXRlRGF0YXtUeXBlTmFtZX0gJiYgJFN0YXRlRGF0YXtUeXBlTmFtZX0gPX4gL15wZW5kaW5nL2kgKSB7CgogICAgICAgICAgICAjIGNyZWF0ZSBhIGRhdGV0aW1lIG9iamVjdCBiYXNlZCBvbiBwZW5kaW5nIGRhdGUKICAgICAgICAgICAgbXkgJFBlbmRpbmdEYXRlVGltZU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5DcmVhdGUoCiAgICAgICAgICAgICAgICAnS2VybmVsOjpTeXN0ZW06OkRhdGVUaW1lJywKICAgICAgICAgICAgICAgIE9iamVjdFBhcmFtcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgJUdldFBhcmFtLAogICAgICAgICAgICAgICAgICAgIFNlY29uZCA9PiAwLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgZ2V0IGN1cnJlbnQgc3lzdGVtIGVwb2NoCiAgICAgICAgICAgIG15ICRDdXJTeXN0ZW1EYXRlVGltZU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5DcmVhdGUoJ0tlcm5lbDo6U3lzdGVtOjpEYXRlVGltZScpOwogICAgICAgICAgICBpZiAoICEkUGVuZGluZ0RhdGVUaW1lT2JqZWN0IHx8ICRQZW5kaW5nRGF0ZVRpbWVPYmplY3QgPCAkQ3VyU3lzdGVtRGF0ZVRpbWVPYmplY3QgKSB7CiAgICAgICAgICAgICAgICAkRXJyb3J7J0RhdGVJbnZhbGlkJ30gPSAnU2VydmVyRXJyb3InOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIGNyZWF0ZSBodG1sIHN0cmluZ3MgZm9yIGFsbCBkeW5hbWljIGZpZWxkcwogICAgICAgIG15ICVEeW5hbWljRmllbGRIVE1MOwoKICAgICAgICAjIGN5Y2xlIHRocm91Z2ggdGhlIGFjdGl2YXRlZCBEeW5hbWljIEZpZWxkcyBmb3IgdGhpcyBzY3JlZW4KICAgICAgICBEWU5BTUlDRklFTEQ6CiAgICAgICAgZm9yIG15ICREeW5hbWljRmllbGRDb25maWcgKCBAeyAkU2VsZi0+e0R5bmFtaWNGaWVsZH0gfSApIHsKICAgICAgICAgICAgbmV4dCBEWU5BTUlDRklFTEQgaWYgIUlzSGFzaFJlZldpdGhEYXRhKCREeW5hbWljRmllbGRDb25maWcpOwoKICAgICAgICAgICAgbXkgJFBvc3NpYmxlVmFsdWVzRmlsdGVyOwoKICAgICAgICAgICAgbXkgJElzQUNMUmVkdWNpYmxlID0gJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QtPkhhc0JlaGF2aW9yKAogICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRDb25maWcsCiAgICAgICAgICAgICAgICBCZWhhdmlvciAgICAgICAgICAgPT4gJ0lzQUNMUmVkdWNpYmxlJywKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGlmICgkSXNBQ0xSZWR1Y2libGUpIHsKCiAgICAgICAgICAgICAgICAjIGdldCBQb3NzaWJsZVZhbHVlcwogICAgICAgICAgICAgICAgbXkgJFBvc3NpYmxlVmFsdWVzID0gJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QtPlBvc3NpYmxlVmFsdWVzR2V0KAogICAgICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZENvbmZpZyA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnLAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAjIGNoZWNrIGlmIGZpZWxkIGhhcyBQb3NzaWJsZVZhbHVlcyBwcm9wZXJ0eSBpbiBpdHMgY29uZmlndXJhdGlvbgogICAgICAgICAgICAgICAgaWYgKCBJc0hhc2hSZWZXaXRoRGF0YSgkUG9zc2libGVWYWx1ZXMpICkgewoKICAgICAgICAgICAgICAgICAgICAjIGNvbnZlcnQgcG9zc2libGUgdmFsdWVzIGtleSA9PiB2YWx1ZSB0byBrZXkgPT4ga2V5IGZvciBBQ0xzIHVzaW5nIGEgSGFzaCBzbGljZQogICAgICAgICAgICAgICAgICAgIG15ICVBY2xEYXRhID0gJXskUG9zc2libGVWYWx1ZXN9OwogICAgICAgICAgICAgICAgICAgIEBBY2xEYXRheyBrZXlzICVBY2xEYXRhIH0gPSBrZXlzICVBY2xEYXRhOwoKICAgICAgICAgICAgICAgICAgICAjIHNldCBwb3NzaWJsZSB2YWx1ZXMgZmlsdGVyIGZyb20gQUNMcwogICAgICAgICAgICAgICAgICAgIG15ICRBQ0wgPSAkVGlja2V0T2JqZWN0LT5UaWNrZXRBY2woCiAgICAgICAgICAgICAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJVc2VySUQgPT4gJEN1c3RvbWVyVXNlciB8fCAnJywKICAgICAgICAgICAgICAgICAgICAgICAgQWN0aW9uICAgICAgICAgPT4gJFNlbGYtPntBY3Rpb259LAogICAgICAgICAgICAgICAgICAgICAgICBSZXR1cm5UeXBlICAgICA9PiAnVGlja2V0JywKICAgICAgICAgICAgICAgICAgICAgICAgUmV0dXJuU3ViVHlwZSAgPT4gJ0R5bmFtaWNGaWVsZF8nIC4gJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9LAogICAgICAgICAgICAgICAgICAgICAgICBEYXRhICAgICAgICAgICA9PiBcJUFjbERhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgIFVzZXJJRCAgICAgICAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIGlmICgkQUNMKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG15ICVGaWx0ZXIgPSAkVGlja2V0T2JqZWN0LT5UaWNrZXRBY2xEYXRhKCk7CgogICAgICAgICAgICAgICAgICAgICAgICAjIGNvbnZlcnQgRmlsZXIga2V5ID0+IGtleSBiYWNrIHRvIGtleSA9PiB2YWx1ZSB1c2luZyBtYXAKICAgICAgICAgICAgICAgICAgICAgICAgJXskUG9zc2libGVWYWx1ZXNGaWx0ZXJ9ID0gbWFwIHsgJF8gPT4gJFBvc3NpYmxlVmFsdWVzLT57JF99IH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleXMgJUZpbHRlcjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG15ICRWYWxpZGF0aW9uUmVzdWx0OwoKICAgICAgICAgICAgIyBkbyBub3QgdmFsaWRhdGUgb24gYXR0YWNobWVudCB1cGxvYWQKICAgICAgICAgICAgaWYgKCAhJEV4cGFuZEN1c3RvbWVyTmFtZSApIHsKCiAgICAgICAgICAgICAgICAkVmFsaWRhdGlvblJlc3VsdCA9ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0LT5FZGl0RmllbGRWYWx1ZVZhbGlkYXRlKAogICAgICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZENvbmZpZyAgID0+ICREeW5hbWljRmllbGRDb25maWcsCiAgICAgICAgICAgICAgICAgICAgUG9zc2libGVWYWx1ZXNGaWx0ZXIgPT4gJFBvc3NpYmxlVmFsdWVzRmlsdGVyLAogICAgICAgICAgICAgICAgICAgIFBhcmFtT2JqZWN0ICAgICAgICAgID0+ICRQYXJhbU9iamVjdCwKICAgICAgICAgICAgICAgICAgICBNYW5kYXRvcnkgPT4KICAgICAgICAgICAgICAgICAgICAgICAgJENvbmZpZy0+e0R5bmFtaWNGaWVsZH0tPnsgJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9IH0gPT0gMiwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgaWYgKCAhSXNIYXNoUmVmV2l0aERhdGEoJFZhbGlkYXRpb25SZXN1bHQpICkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5FcnJvclNjcmVlbigKICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLT5UcmFuc2xhdGUoICdDb3VsZCBub3QgcGVyZm9ybSB2YWxpZGF0aW9uIG9uIGZpZWxkICVzIScsICREeW5hbWljRmllbGRDb25maWctPntMYWJlbH0gKSwKICAgICAgICAgICAgICAgICAgICAgICAgQ29tbWVudCA9PiBUcmFuc2xhdGFibGUoJ1BsZWFzZSBjb250YWN0IHRoZSBhZG1pbmlzdHJhdG9yLicpLAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBwcm9wYWdhdGUgdmFsaWRhdGlvbiBlcnJvciB0byB0aGUgRXJyb3IgdmFyaWFibGUgdG8gYmUgZGV0ZWN0ZWQgYnkgdGhlIGZyb250ZW5kCiAgICAgICAgICAgICAgICBpZiAoICRWYWxpZGF0aW9uUmVzdWx0LT57U2VydmVyRXJyb3J9ICkgewogICAgICAgICAgICAgICAgICAgICRFcnJvcnsgJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9IH0gPSAnIFNlcnZlckVycm9yJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBnZXQgZmllbGQgaHRtbAogICAgICAgICAgICAkRHluYW1pY0ZpZWxkSFRNTHsgJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9IH0gPSAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdC0+RWRpdEZpZWxkUmVuZGVyKAogICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnICAgPT4gJER5bmFtaWNGaWVsZENvbmZpZywKICAgICAgICAgICAgICAgIFBvc3NpYmxlVmFsdWVzRmlsdGVyID0+ICRQb3NzaWJsZVZhbHVlc0ZpbHRlciwKICAgICAgICAgICAgICAgIFNlcnZlckVycm9yICAgICAgICAgID0+ICRWYWxpZGF0aW9uUmVzdWx0LT57U2VydmVyRXJyb3J9IHx8ICcnLAogICAgICAgICAgICAgICAgRXJyb3JNZXNzYWdlICAgICAgICAgPT4gJFZhbGlkYXRpb25SZXN1bHQtPntFcnJvck1lc3NhZ2V9IHx8ICcnLAogICAgICAgICAgICAgICAgTGF5b3V0T2JqZWN0ICAgICAgICAgPT4gJExheW91dE9iamVjdCwKICAgICAgICAgICAgICAgIFBhcmFtT2JqZWN0ICAgICAgICAgID0+ICRQYXJhbU9iamVjdCwKICAgICAgICAgICAgICAgIEFKQVhVcGRhdGUgICAgICAgICAgID0+IDEsCiAgICAgICAgICAgICAgICBVcGRhdGFibGVGaWVsZHMgICAgICA9PiAkU2VsZi0+X0dldEZpZWxkc1RvVXBkYXRlKCksCiAgICAgICAgICAgICAgICBNYW5kYXRvcnkgICAgICAgICAgICA9PiAkQ29uZmlnLT57RHluYW1pY0ZpZWxkfS0+eyAkRHluYW1pY0ZpZWxkQ29uZmlnLT57TmFtZX0gfSA9PSAyLAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBleHBhbmQgY3VzdG9tZXIgbmFtZQogICAgICAgIG15ICVDdXN0b21lclVzZXJEYXRhOwogICAgICAgIGlmICggJEV4cGFuZEN1c3RvbWVyTmFtZSA9PSAxICkgewoKICAgICAgICAgICAgIyBzZWFyY2ggY3VzdG9tZXIKICAgICAgICAgICAgbXkgJUN1c3RvbWVyVXNlckxpc3Q7CiAgICAgICAgICAgICVDdXN0b21lclVzZXJMaXN0ID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJTZWFyY2goCiAgICAgICAgICAgICAgICBTZWFyY2ggICAgICAgICAgID0+ICRHZXRQYXJhbXtGcm9tfSwKICAgICAgICAgICAgICAgIEN1c3RvbWVyVXNlck9ubHkgPT4gMSwKICAgICAgICAgICAgICAgIFVzZXJJRCA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAjIGNoZWNrIGlmIGp1c3Qgb25lIGN1c3RvbWVyIHVzZXIgZXhpc3RzCiAgICAgICAgICAgICMgaWYganVzdCBvbmUsIGZpbGx1cCBDdXN0b21lclVzZXJJRCBhbmQgQ3VzdG9tZXJJRAogICAgICAgICAgICAkUGFyYW17Q3VzdG9tZXJVc2VyTGlzdENvdW50fSA9IDA7CiAgICAgICAgICAgIGZvciBteSAkS2V5Q3VzdG9tZXJVc2VyICggc29ydCBrZXlzICVDdXN0b21lclVzZXJMaXN0ICkgewogICAgICAgICAgICAgICAgJFBhcmFte0N1c3RvbWVyVXNlckxpc3RDb3VudH0rKzsKICAgICAgICAgICAgICAgICRQYXJhbXtDdXN0b21lclVzZXJMaXN0TGFzdH0gICAgID0gJEN1c3RvbWVyVXNlckxpc3R7JEtleUN1c3RvbWVyVXNlcn07CiAgICAgICAgICAgICAgICAkUGFyYW17Q3VzdG9tZXJVc2VyTGlzdExhc3RVc2VyfSA9ICRLZXlDdXN0b21lclVzZXI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCAkUGFyYW17Q3VzdG9tZXJVc2VyTGlzdENvdW50fSA9PSAxICkgewogICAgICAgICAgICAgICAgJEdldFBhcmFte0Zyb219ICAgICAgICAgICAgPSAkUGFyYW17Q3VzdG9tZXJVc2VyTGlzdExhc3R9OwogICAgICAgICAgICAgICAgJEVycm9ye0V4cGFuZEN1c3RvbWVyTmFtZX0gPSAxOwogICAgICAgICAgICAgICAgbXkgJUN1c3RvbWVyVXNlckRhdGEgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJEYXRhR2V0KAogICAgICAgICAgICAgICAgICAgIFVzZXIgPT4gJFBhcmFte0N1c3RvbWVyVXNlckxpc3RMYXN0VXNlcn0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgaWYgKCAkQ3VzdG9tZXJVc2VyRGF0YXtVc2VyQ3VzdG9tZXJJRH0gKSB7CiAgICAgICAgICAgICAgICAgICAgJEN1c3RvbWVySUQgPSAkQ3VzdG9tZXJVc2VyRGF0YXtVc2VyQ3VzdG9tZXJJRH07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoICRDdXN0b21lclVzZXJEYXRhe1VzZXJMb2dpbn0gKSB7CiAgICAgICAgICAgICAgICAgICAgJEN1c3RvbWVyVXNlciA9ICRDdXN0b21lclVzZXJEYXRhe1VzZXJMb2dpbn07CiAgICAgICAgICAgICAgICAgICAgJEZyb21FeHRlcm5hbEN1c3RvbWVye0N1c3RvbWVyfSA9ICRDdXN0b21lclVzZXJEYXRhe1VzZXJMb2dpbn07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoICRGcm9tRXh0ZXJuYWxDdXN0b21lcntDdXN0b21lcn0gKSB7CiAgICAgICAgICAgICAgICAgICAgbXkgJUV4dGVybmFsQ3VzdG9tZXJVc2VyRGF0YSA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyVXNlckRhdGFHZXQoCiAgICAgICAgICAgICAgICAgICAgICAgIFVzZXIgPT4gJEZyb21FeHRlcm5hbEN1c3RvbWVye0N1c3RvbWVyfSwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICRGcm9tRXh0ZXJuYWxDdXN0b21lcntFbWFpbH0gPSAkRXh0ZXJuYWxDdXN0b21lclVzZXJEYXRhe1VzZXJFbWFpbH07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgaWYgbW9yZSB0aGFuIG9uZSBjdXN0b21lciB1c2VyIGV4aXN0LCBzaG93IGxpc3QKICAgICAgICAgICAgIyBhbmQgY2xlYW4gQ3VzdG9tZXJVc2VySUQgYW5kIEN1c3RvbWVySUQKICAgICAgICAgICAgZWxzZSB7CgogICAgICAgICAgICAgICAgIyBkb24ndCBjaGVjayBlbWFpbCBzeW50YXggb24gbXVsdGkgY3VzdG9tZXIgc2VsZWN0CiAgICAgICAgICAgICAgICAkQ29uZmlnT2JqZWN0LT5TZXQoCiAgICAgICAgICAgICAgICAgICAgS2V5ICAgPT4gJ0NoZWNrRW1haWxBZGRyZXNzZXMnLAogICAgICAgICAgICAgICAgICAgIFZhbHVlID0+IDAKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAkQ3VzdG9tZXJJRCA9ICcnOwoKICAgICAgICAgICAgICAgICMgY2xlYXIgZnJvbSBpZiB0aGVyZSBpcyBubyBjdXN0b21lciBmb3VuZAogICAgICAgICAgICAgICAgaWYgKCAhJUN1c3RvbWVyVXNlckxpc3QgKSB7CiAgICAgICAgICAgICAgICAgICAgJEdldFBhcmFte0Zyb219ID0gJyc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkRXJyb3J7RXhwYW5kQ3VzdG9tZXJOYW1lfSA9IDE7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgZ2V0IGZyb20gYW5kIGN1c3RvbWVyIGlkIGlmIGN1c3RvbWVyIHVzZXIgaXMgZ2l2ZW4KICAgICAgICBlbHNpZiAoICRFeHBhbmRDdXN0b21lck5hbWUgPT0gMiApIHsKICAgICAgICAgICAgJUN1c3RvbWVyVXNlckRhdGEgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJEYXRhR2V0KAogICAgICAgICAgICAgICAgVXNlciA9PiAkQ3VzdG9tZXJVc2VyLAogICAgICAgICAgICApOwogICAgICAgICAgICBteSAlQ3VzdG9tZXJVc2VyTGlzdCA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyU2VhcmNoKAogICAgICAgICAgICAgICAgVXNlckxvZ2luID0+ICRDdXN0b21lclVzZXIsCiAgICAgICAgICAgICAgICBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICApOwogICAgICAgICAgICBmb3IgbXkgJEtleUN1c3RvbWVyVXNlciAoIHNvcnQga2V5cyAlQ3VzdG9tZXJVc2VyTGlzdCApIHsKICAgICAgICAgICAgICAgICRHZXRQYXJhbXtGcm9tfSA9ICRDdXN0b21lclVzZXJMaXN0eyRLZXlDdXN0b21lclVzZXJ9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICggJEN1c3RvbWVyVXNlckRhdGF7VXNlckN1c3RvbWVySUR9ICkgewogICAgICAgICAgICAgICAgJEN1c3RvbWVySUQgPSAkQ3VzdG9tZXJVc2VyRGF0YXtVc2VyQ3VzdG9tZXJJRH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCAkQ3VzdG9tZXJVc2VyRGF0YXtVc2VyTG9naW59ICkgewogICAgICAgICAgICAgICAgJEN1c3RvbWVyVXNlciA9ICRDdXN0b21lclVzZXJEYXRhe1VzZXJMb2dpbn07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCAkRnJvbUV4dGVybmFsQ3VzdG9tZXJ7Q3VzdG9tZXJ9ICkgewogICAgICAgICAgICAgICAgbXkgJUV4dGVybmFsQ3VzdG9tZXJVc2VyRGF0YSA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyVXNlckRhdGFHZXQoCiAgICAgICAgICAgICAgICAgICAgVXNlciA9PiAkRnJvbUV4dGVybmFsQ3VzdG9tZXJ7Q3VzdG9tZXJ9LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICRGcm9tRXh0ZXJuYWxDdXN0b21lcntFbWFpbH0gPSAkRXh0ZXJuYWxDdXN0b21lclVzZXJEYXRhe1VzZXJNYWlsU3RyaW5nfTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkRXJyb3J7RXhwYW5kQ3VzdG9tZXJOYW1lfSA9IDE7CiAgICAgICAgfQoKICAgICAgICAjIGlmIGEgbmV3IGRlc3RpbmF0aW9uIHF1ZXVlIGlzIHNlbGVjdGVkCiAgICAgICAgZWxzaWYgKCAkRXhwYW5kQ3VzdG9tZXJOYW1lID09IDMgKSB7CiAgICAgICAgICAgICRFcnJvcntOb1N1Ym1pdH0gPSAxOwogICAgICAgICAgICAkQ3VzdG9tZXJVc2VyID0gJFNlbGVjdGVkQ3VzdG9tZXJVc2VyOwogICAgICAgIH0KCiAgICAgICAgIyAnanVzdCcgbm8gc3VibWl0CiAgICAgICAgZWxzaWYgKCAkRXhwYW5kQ3VzdG9tZXJOYW1lID09IDQgKSB7CiAgICAgICAgICAgICRFcnJvcntOb1N1Ym1pdH0gPSAxOwogICAgICAgIH0KCiAgICAgICAgIyBzaG93IGN1c3RvbWVyIGluZm8KICAgICAgICBteSAlQ3VzdG9tZXJEYXRhOwogICAgICAgIGlmICggJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpDdXN0b21lckluZm9Db21wb3NlJykgKSB7CiAgICAgICAgICAgIGlmICggJEN1c3RvbWVyVXNlciB8fCAkU2VsZWN0ZWRDdXN0b21lclVzZXIgKSB7CiAgICAgICAgICAgICAgICAlQ3VzdG9tZXJEYXRhID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJVc2VyRGF0YUdldCgKICAgICAgICAgICAgICAgICAgICBVc2VyID0+ICRDdXN0b21lclVzZXIgfHwgJFNlbGVjdGVkQ3VzdG9tZXJVc2VyLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNpZiAoJEN1c3RvbWVySUQpIHsKICAgICAgICAgICAgICAgICVDdXN0b21lckRhdGEgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJEYXRhR2V0KAogICAgICAgICAgICAgICAgICAgIEN1c3RvbWVySUQgPT4gJEN1c3RvbWVySUQsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIGNoZWNrIGVtYWlsIGFkZHJlc3MKICAgICAgICBmb3IgbXkgJEVtYWlsICggTWFpbDo6QWRkcmVzcy0+cGFyc2UoICRHZXRQYXJhbXtGcm9tfSApICkgewogICAgICAgICAgICBpZiAoICEkQ2hlY2tJdGVtT2JqZWN0LT5DaGVja0VtYWlsKCBBZGRyZXNzID0+ICRFbWFpbC0+YWRkcmVzcygpICkgKSB7CiAgICAgICAgICAgICAgICAkRXJyb3J7RXJyb3JUeXBlfSAgID0gJENoZWNrSXRlbU9iamVjdC0+Q2hlY2tFcnJvclR5cGUoKSAuICdTZXJ2ZXJFcnJvck1zZyc7CiAgICAgICAgICAgICAgICAkRXJyb3J7RnJvbUludmFsaWR9ID0gJyBTZXJ2ZXJFcnJvcic7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICggISRFeHBhbmRDdXN0b21lck5hbWUgKSB7CiAgICAgICAgICAgIGlmICggISRHZXRQYXJhbXtGcm9tfSApCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRFcnJvcnsnRnJvbUludmFsaWQnfSA9ICcgU2VydmVyRXJyb3InOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICggISRHZXRQYXJhbXtTdWJqZWN0fSApIHsKICAgICAgICAgICAgICAgICRFcnJvcnsnU3ViamVjdEludmFsaWQnfSA9ICcgU2VydmVyRXJyb3InOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICggISROZXdRdWV1ZUlEICkgewogICAgICAgICAgICAgICAgJEVycm9yeydEZXN0aW5hdGlvbkludmFsaWQnfSA9ICcgU2VydmVyRXJyb3InOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpTZXJ2aWNlJykKICAgICAgICAgICAgICAgICYmICRHZXRQYXJhbXtTTEFJRH0KICAgICAgICAgICAgICAgICYmICEkR2V0UGFyYW17U2VydmljZUlEfQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkRXJyb3J7J1NlcnZpY2VJbnZhbGlkJ30gPSAnIFNlcnZlckVycm9yJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBjaGVjayBtYW5kYXRvcnkgc2VydmljZQogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6U2VydmljZScpCiAgICAgICAgICAgICAgICAmJiAkQ29uZmlnLT57U2VydmljZU1hbmRhdG9yeX0KICAgICAgICAgICAgICAgICYmICEkR2V0UGFyYW17U2VydmljZUlEfQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkRXJyb3J7J1NlcnZpY2VJbnZhbGlkJ30gPSAnIFNlcnZlckVycm9yJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBjaGVjayBtYW5kYXRvcnkgc2xhCiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpTZXJ2aWNlJykKICAgICAgICAgICAgICAgICYmICRDb25maWctPntTTEFNYW5kYXRvcnl9CiAgICAgICAgICAgICAgICAmJiAhJEdldFBhcmFte1NMQUlEfQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkRXJyb3J7J1NMQUludmFsaWQnfSA9ICcgU2VydmVyRXJyb3InOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoICggISRHZXRQYXJhbXtUeXBlSUR9ICkgJiYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6VHlwZScpICkgKSB7CiAgICAgICAgICAgICAgICAkRXJyb3J7J1R5cGVJREludmFsaWQnfSA9ICcgU2VydmVyRXJyb3InOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICggISRHZXRQYXJhbXtCb2R5fSApIHsKICAgICAgICAgICAgICAgICRFcnJvcnsnUmljaFRleHRJbnZhbGlkJ30gPSAnIFNlcnZlckVycm9yJzsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6OkFjY291bnRUaW1lJykKICAgICAgICAgICAgICAgICYmICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpGcm9udGVuZDo6TmVlZEFjY291bnRlZFRpbWUnKQogICAgICAgICAgICAgICAgJiYgJEdldFBhcmFte1RpbWVVbml0c30gZXEgJycKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJEVycm9yeydUaW1lVW5pdHNJbnZhbGlkJ30gPSAnIFNlcnZlckVycm9yJzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCVFcnJvcikgewoKICAgICAgICAgICAgIyBnZXQgYW5kIGZvcm1hdCBkZWZhdWx0IHN1YmplY3QgYW5kIGJvZHkKICAgICAgICAgICAgbXkgJFN1YmplY3QgPSAkTGF5b3V0T2JqZWN0LT5PdXRwdXQoCiAgICAgICAgICAgICAgICBUZW1wbGF0ZSA9PiAkQ29uZmlnLT57U3ViamVjdH0gfHwgJycsCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBteSAkQm9keSA9ICRMYXlvdXRPYmplY3QtPk91dHB1dCgKICAgICAgICAgICAgICAgIFRlbXBsYXRlID0+ICRDb25maWctPntCb2R5fSB8fCAnJywKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgbWFrZSBzdXJlIGJvZHkgaXMgcmljaCB0ZXh0CiAgICAgICAgICAgIGlmICggJExheW91dE9iamVjdC0+e0Jyb3dzZXJSaWNoVGV4dH0gKSB7CiAgICAgICAgICAgICAgICAkQm9keSA9ICRMYXlvdXRPYmplY3QtPkFzY2lpMlJpY2hUZXh0KAogICAgICAgICAgICAgICAgICAgIFN0cmluZyA9PiAkQm9keSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICNzZXQgQm9keSBhbmQgU3ViamVjdCBwYXJhbWV0ZXJzIGZvciBPdXRwdXQKICAgICAgICAgICAgaWYgKCAhJEdldFBhcmFte1N1YmplY3R9ICkgewogICAgICAgICAgICAgICAgJEdldFBhcmFte1N1YmplY3R9ID0gJFN1YmplY3Q7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICggISRHZXRQYXJhbXtCb2R5fSApIHsKICAgICAgICAgICAgICAgICRHZXRQYXJhbXtCb2R5fSA9ICRCb2R5OwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGdldCBzZXJ2aWNlcwogICAgICAgICAgICBteSAkU2VydmljZXMgPSAkU2VsZi0+X0dldFNlcnZpY2VzKAogICAgICAgICAgICAgICAgJUdldFBhcmFtLAogICAgICAgICAgICAgICAgJUFDTENvbXBhdEdldFBhcmFtLAogICAgICAgICAgICAgICAgQ3VzdG9tZXJVc2VySUQgPT4gJEN1c3RvbWVyVXNlciB8fCAnJywKICAgICAgICAgICAgICAgIFF1ZXVlSUQgICAgICAgID0+ICROZXdRdWV1ZUlEICAgfHwgMSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgcmVzZXQgcHJldmlvdXMgU2VydmljZUlEIHRvIHJlc2V0IFNMQS1MaXN0IGlmIG5vIHNlcnZpY2UgaXMgc2VsZWN0ZWQKICAgICAgICAgICAgaWYgKCAhJEdldFBhcmFte1NlcnZpY2VJRH0gfHwgISRTZXJ2aWNlcy0+eyAkR2V0UGFyYW17U2VydmljZUlEfSB9ICkgewogICAgICAgICAgICAgICAgJEdldFBhcmFte1NlcnZpY2VJRH0gPSAnJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbXkgJFNMQXMgPSAkU2VsZi0+X0dldFNMQXMoCiAgICAgICAgICAgICAgICAlR2V0UGFyYW0sCiAgICAgICAgICAgICAgICAlQUNMQ29tcGF0R2V0UGFyYW0sCiAgICAgICAgICAgICAgICBDdXN0b21lclVzZXJJRCA9PiAkQ3VzdG9tZXJVc2VyIHx8ICRTZWxlY3RlZEN1c3RvbWVyVXNlciB8fCAnJywKICAgICAgICAgICAgICAgIFF1ZXVlSUQgICAgICAgID0+ICROZXdRdWV1ZUlEICAgfHwgMSwKICAgICAgICAgICAgICAgIFNlcnZpY2VzICAgICAgID0+ICRTZXJ2aWNlcywKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgaGVhZGVyCiAgICAgICAgICAgIG15ICRPdXRwdXQgPSAkTGF5b3V0T2JqZWN0LT5IZWFkZXIoKTsKICAgICAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5OYXZpZ2F0aW9uQmFyKCk7CgogICAgICAgICAgICAjIGh0bWwgb3V0cHV0CiAgICAgICAgICAgICRPdXRwdXQgLj0gJFNlbGYtPl9NYXNrUGhvbmVOZXcoCiAgICAgICAgICAgICAgICBRdWV1ZUlEID0+ICRTZWxmLT57UXVldWVJRH0sCiAgICAgICAgICAgICAgICBVc2VycyAgID0+ICRTZWxmLT5fR2V0VXNlcnMoCiAgICAgICAgICAgICAgICAgICAgJUdldFBhcmFtLAogICAgICAgICAgICAgICAgICAgICVBQ0xDb21wYXRHZXRQYXJhbSwKICAgICAgICAgICAgICAgICAgICBRdWV1ZUlEICA9PiAkTmV3UXVldWVJRCwKICAgICAgICAgICAgICAgICAgICBBbGxVc2VycyA9PiAkR2V0UGFyYW17T3duZXJBbGx9LAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgIFVzZXJTZWxlY3RlZCAgICAgPT4gJEdldFBhcmFte05ld1VzZXJJRH0sCiAgICAgICAgICAgICAgICBSZXNwb25zaWJsZVVzZXJzID0+ICRTZWxmLT5fR2V0UmVzcG9uc2libGVzKAogICAgICAgICAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgICAgICAgICAlQUNMQ29tcGF0R2V0UGFyYW0sCiAgICAgICAgICAgICAgICAgICAgUXVldWVJRCAgPT4gJE5ld1F1ZXVlSUQsCiAgICAgICAgICAgICAgICAgICAgQWxsVXNlcnMgPT4gJEdldFBhcmFte1Jlc3BvbnNpYmxlQWxsfQogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgIFJlc3BvbnNpYmxlVXNlclNlbGVjdGVkID0+ICRHZXRQYXJhbXtOZXdSZXNwb25zaWJsZUlEfSwKICAgICAgICAgICAgICAgIE5leHRTdGF0ZXMgICAgICAgICAgICAgID0+ICRTZWxmLT5fR2V0TmV4dFN0YXRlcygKICAgICAgICAgICAgICAgICAgICAlR2V0UGFyYW0sCiAgICAgICAgICAgICAgICAgICAgJUFDTENvbXBhdEdldFBhcmFtLAogICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyVXNlcklEID0+ICRDdXN0b21lclVzZXIgfHwgJFNlbGVjdGVkQ3VzdG9tZXJVc2VyIHx8ICcnLAogICAgICAgICAgICAgICAgICAgIFF1ZXVlSUQgICAgICAgID0+ICROZXdRdWV1ZUlEICAgfHwgMSwKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICBOZXh0U3RhdGUgID0+ICROZXh0U3RhdGUsCiAgICAgICAgICAgICAgICBQcmlvcml0aWVzID0+ICRTZWxmLT5fR2V0UHJpb3JpdGllcygKICAgICAgICAgICAgICAgICAgICAlR2V0UGFyYW0sCiAgICAgICAgICAgICAgICAgICAgJUFDTENvbXBhdEdldFBhcmFtLAogICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyVXNlcklEID0+ICRDdXN0b21lclVzZXIgfHwgJFNlbGVjdGVkQ3VzdG9tZXJVc2VyIHx8ICcnLAogICAgICAgICAgICAgICAgICAgIFF1ZXVlSUQgICAgICAgID0+ICROZXdRdWV1ZUlEICAgfHwgMSwKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICBUeXBlcyA9PiAkU2VsZi0+X0dldFR5cGVzKAogICAgICAgICAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgICAgICAgICAlQUNMQ29tcGF0R2V0UGFyYW0sCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJVc2VySUQgPT4gJEN1c3RvbWVyVXNlciB8fCAkU2VsZWN0ZWRDdXN0b21lclVzZXIgfHwgJycsCiAgICAgICAgICAgICAgICAgICAgUXVldWVJRCAgICAgICAgPT4gJE5ld1F1ZXVlSUQgICB8fCAxLAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgIFNlcnZpY2VzICAgICAgICAgID0+ICRTZXJ2aWNlcywKICAgICAgICAgICAgICAgIFNMQXMgICAgICAgICAgICAgID0+ICRTTEFzLAogICAgICAgICAgICAgICAgU3RhbmRhcmRUZW1wbGF0ZXMgPT4gJFNlbGYtPl9HZXRTdGFuZGFyZFRlbXBsYXRlcygKICAgICAgICAgICAgICAgICAgICAlR2V0UGFyYW0sCiAgICAgICAgICAgICAgICAgICAgJUFDTENvbXBhdEdldFBhcmFtLAogICAgICAgICAgICAgICAgICAgIFF1ZXVlSUQgPT4gJE5ld1F1ZXVlSUQgfHwgJycsCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgQ3VzdG9tZXJJRCAgID0+ICRMYXlvdXRPYmplY3QtPkFzY2lpMkh0bWwoIFRleHQgPT4gJEN1c3RvbWVySUQgKSwKICAgICAgICAgICAgICAgIEN1c3RvbWVyVXNlciA9PiAkQ3VzdG9tZXJVc2VyLAogICAgICAgICAgICAgICAgQ3VzdG9tZXJEYXRhID0+IFwlQ3VzdG9tZXJEYXRhLAogICAgICAgICAgICAgICAgVG8gICAgICAgICAgID0+ICRTZWxmLT5fR2V0VG9zKAogICAgICAgICAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgICAgICAgICAlQUNMQ29tcGF0R2V0UGFyYW0sCiAgICAgICAgICAgICAgICAgICAgUXVldWVJRCA9PiAkTmV3UXVldWVJRAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgIFRvU2VsZWN0ZWQgID0+ICREZXN0LAogICAgICAgICAgICAgICAgRXJyb3JzICAgICAgPT4gXCVFcnJvciwKICAgICAgICAgICAgICAgIEF0dGFjaG1lbnRzID0+IFxAQXR0YWNobWVudHMsCiAgICAgICAgICAgICAgICAlR2V0UGFyYW0sCiAgICAgICAgICAgICAgICBEeW5hbWljRmllbGRIVE1MICAgICA9PiBcJUR5bmFtaWNGaWVsZEhUTUwsCiAgICAgICAgICAgICAgICBNdWx0aXBsZUN1c3RvbWVyICAgICA9PiBcQE11bHRpcGxlQ3VzdG9tZXIsCiAgICAgICAgICAgICAgICBGcm9tRXh0ZXJuYWxDdXN0b21lciA9PiBcJUZyb21FeHRlcm5hbEN1c3RvbWVyLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5Gb290ZXIoKTsKICAgICAgICAgICAgcmV0dXJuICRPdXRwdXQ7CiAgICAgICAgfQoKICAgICAgICAjIGNoYWxsZW5nZSB0b2tlbiBjaGVjayBmb3Igd3JpdGUgYWN0aW9uCiAgICAgICAgJExheW91dE9iamVjdC0+Q2hhbGxlbmdlVG9rZW5DaGVjaygpOwoKICAgICAgICAjIGNyZWF0ZSBuZXcgdGlja2V0LCBkbyBkYiBpbnNlcnQKICAgICAgICBteSAkVGlja2V0SUQgPSAkVGlja2V0T2JqZWN0LT5UaWNrZXRDcmVhdGUoCiAgICAgICAgICAgIFRpdGxlICAgICAgICA9PiAkR2V0UGFyYW17U3ViamVjdH0sCiAgICAgICAgICAgIFF1ZXVlSUQgICAgICA9PiAkTmV3UXVldWVJRCwKICAgICAgICAgICAgU3ViamVjdCAgICAgID0+ICRHZXRQYXJhbXtTdWJqZWN0fSwKICAgICAgICAgICAgTG9jayAgICAgICAgID0+ICd1bmxvY2snLAogICAgICAgICAgICBUeXBlSUQgICAgICAgPT4gJEdldFBhcmFte1R5cGVJRH0sCiAgICAgICAgICAgIFNlcnZpY2VJRCAgICA9PiAkR2V0UGFyYW17U2VydmljZUlEfSwKICAgICAgICAgICAgU0xBSUQgICAgICAgID0+ICRHZXRQYXJhbXtTTEFJRH0sCiAgICAgICAgICAgIFN0YXRlSUQgICAgICA9PiAkR2V0UGFyYW17TmV4dFN0YXRlSUR9LAogICAgICAgICAgICBQcmlvcml0eUlEICAgPT4gJEdldFBhcmFte1ByaW9yaXR5SUR9LAogICAgICAgICAgICBPd25lcklEICAgICAgPT4gMSwKICAgICAgICAgICAgQ3VzdG9tZXJObyAgID0+ICRDdXN0b21lcklELAogICAgICAgICAgICBDdXN0b21lclVzZXIgPT4gJFNlbGVjdGVkQ3VzdG9tZXJVc2VyLAogICAgICAgICAgICBVc2VySUQgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICk7CgogICAgICAgICMgc2V0IHRpY2tldCBkeW5hbWljIGZpZWxkcwogICAgICAgICMgY3ljbGUgdGhyb3VnaCB0aGUgYWN0aXZhdGVkIER5bmFtaWMgRmllbGRzIGZvciB0aGlzIHNjcmVlbgogICAgICAgIERZTkFNSUNGSUVMRDoKICAgICAgICBmb3IgbXkgJER5bmFtaWNGaWVsZENvbmZpZyAoIEB7ICRTZWxmLT57RHluYW1pY0ZpZWxkfSB9ICkgewogICAgICAgICAgICBuZXh0IERZTkFNSUNGSUVMRCBpZiAhSXNIYXNoUmVmV2l0aERhdGEoJER5bmFtaWNGaWVsZENvbmZpZyk7CiAgICAgICAgICAgIG5leHQgRFlOQU1JQ0ZJRUxEIGlmICREeW5hbWljRmllbGRDb25maWctPntPYmplY3RUeXBlfSBuZSAnVGlja2V0JzsKCiAgICAgICAgICAgICMgc2V0IHRoZSB2YWx1ZQogICAgICAgICAgICBteSAkU3VjY2VzcyA9ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0LT5WYWx1ZVNldCgKICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZENvbmZpZyA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnLAogICAgICAgICAgICAgICAgT2JqZWN0SUQgICAgICAgICAgID0+ICRUaWNrZXRJRCwKICAgICAgICAgICAgICAgIFZhbHVlICAgICAgICAgICAgICA9PiAkRHluYW1pY0ZpZWxkVmFsdWVzeyAkRHluYW1pY0ZpZWxkQ29uZmlnLT57TmFtZX0gfSwKICAgICAgICAgICAgICAgIFVzZXJJRCAgICAgICAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIGdldCBwcmUgbG9hZGVkIGF0dGFjaG1lbnQKICAgICAgICBteSBAQXR0YWNobWVudERhdGEgPSAkVXBsb2FkQ2FjaGVPYmplY3QtPkZvcm1JREdldEFsbEZpbGVzRGF0YSgKICAgICAgICAgICAgRm9ybUlEID0+ICRTZWxmLT57Rm9ybUlEfSwKICAgICAgICApOwoKICAgICAgICAjIGdldCBzdWJtaXQgYXR0YWNobWVudAogICAgICAgIG15ICVVcGxvYWRTdHVmZiA9ICRQYXJhbU9iamVjdC0+R2V0VXBsb2FkQWxsKAogICAgICAgICAgICBQYXJhbSA9PiAnRmlsZVVwbG9hZCcsCiAgICAgICAgKTsKICAgICAgICBpZiAoJVVwbG9hZFN0dWZmKSB7CiAgICAgICAgICAgIHB1c2ggQEF0dGFjaG1lbnREYXRhLCBcJVVwbG9hZFN0dWZmOwogICAgICAgIH0KCiAgICAgICAgbXkgJE1pbWVUeXBlID0gJ3RleHQvcGxhaW4nOwogICAgICAgIGlmICggJExheW91dE9iamVjdC0+e0Jyb3dzZXJSaWNoVGV4dH0gKSB7CiAgICAgICAgICAgICRNaW1lVHlwZSA9ICd0ZXh0L2h0bWwnOwoKICAgICAgICAgICAgIyByZW1vdmUgdW51c2VkIGlubGluZSBpbWFnZXMKICAgICAgICAgICAgbXkgQE5ld0F0dGFjaG1lbnREYXRhOwogICAgICAgICAgICBBVFRBQ0hNRU5UOgogICAgICAgICAgICBmb3IgbXkgJEF0dGFjaG1lbnQgKEBBdHRhY2htZW50RGF0YSkgewogICAgICAgICAgICAgICAgbXkgJENvbnRlbnRJRCA9ICRBdHRhY2htZW50LT57Q29udGVudElEfTsKICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAkQ29udGVudElECiAgICAgICAgICAgICAgICAgICAgJiYgKCAkQXR0YWNobWVudC0+e0NvbnRlbnRUeXBlfSA9fiAvaW1hZ2UvaSApCiAgICAgICAgICAgICAgICAgICAgJiYgKCAkQXR0YWNobWVudC0+e0Rpc3Bvc2l0aW9ufSBlcSAnaW5saW5lJyApCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIG15ICRDb250ZW50SURIVE1MUXVvdGUgPSAkTGF5b3V0T2JqZWN0LT5Bc2NpaTJIdG1sKAogICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0+ICRDb250ZW50SUQsCiAgICAgICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAgICAgIyB3b3JrYXJvdW5kIGZvciBsaW5rIGVuY29kZSBvZiByaWNoIHRleHQgZWRpdG9yLCBzZWUgYnVnIzUwNTMKICAgICAgICAgICAgICAgICAgICBteSAkQ29udGVudElETGlua0VuY29kZSA9ICRMYXlvdXRPYmplY3QtPkxpbmtFbmNvZGUoJENvbnRlbnRJRCk7CiAgICAgICAgICAgICAgICAgICAgJEdldFBhcmFte0JvZHl9ID1+IHMvKENvbnRlbnRJRD0pJENvbnRlbnRJRExpbmtFbmNvZGUvJDEkQ29udGVudElEL2c7CgogICAgICAgICAgICAgICAgICAgICMgaWdub3JlIGF0dGFjaG1lbnQgaWYgbm90IGxpbmtlZCBpbiBib2R5CiAgICAgICAgICAgICAgICAgICAgbmV4dCBBVFRBQ0hNRU5UCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICRHZXRQYXJhbXtCb2R5fSAhfiAvKFxRJENvbnRlbnRJREhUTUxRdW90ZVxFfFxRJENvbnRlbnRJRFxFKS9pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgcmVtZW1iZXIgaW5saW5lIGltYWdlcyBhbmQgbm9ybWFsIGF0dGFjaG1lbnRzCiAgICAgICAgICAgICAgICBwdXNoIEBOZXdBdHRhY2htZW50RGF0YSwgXCV7JEF0dGFjaG1lbnR9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIEBBdHRhY2htZW50RGF0YSA9IEBOZXdBdHRhY2htZW50RGF0YTsKCiAgICAgICAgICAgICMgdmVyaWZ5IGh0bWwgZG9jdW1lbnQKICAgICAgICAgICAgJEdldFBhcmFte0JvZHl9ID0gJExheW91dE9iamVjdC0+UmljaFRleHREb2N1bWVudENvbXBsZXRlKAogICAgICAgICAgICAgICAgU3RyaW5nID0+ICRHZXRQYXJhbXtCb2R5fSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIG15ICRQbGFpbkJvZHkgPSAkR2V0UGFyYW17Qm9keX07CgogICAgICAgIGlmICggJExheW91dE9iamVjdC0+e0Jyb3dzZXJSaWNoVGV4dH0gKSB7CiAgICAgICAgICAgICRQbGFpbkJvZHkgPSAkTGF5b3V0T2JqZWN0LT5SaWNoVGV4dDJBc2NpaSggU3RyaW5nID0+ICRHZXRQYXJhbXtCb2R5fSApOwogICAgICAgIH0KCiAgICAgICAgIyBjaGVjayBpZiBuZXcgb3duZXIgaXMgZ2l2ZW4gKHRoZW4gc2VuZCBubyBhZ2VudCBub3RpZnkpCiAgICAgICAgbXkgJE5vQWdlbnROb3RpZnkgPSAwOwogICAgICAgIGlmICggJEdldFBhcmFte05ld1VzZXJJRH0gKSB7CiAgICAgICAgICAgICROb0FnZW50Tm90aWZ5ID0gMTsKICAgICAgICB9CiAgICAgICAgbXkgJEFydGljbGVPYmplY3QgICAgICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpY2tldDo6QXJ0aWNsZScpOwogICAgICAgIG15ICRBcnRpY2xlQmFja2VuZE9iamVjdCA9ICRBcnRpY2xlT2JqZWN0LT5CYWNrZW5kRm9yQ2hhbm5lbCggQ2hhbm5lbE5hbWUgPT4gJ1Bob25lJyApOwogICAgICAgIG15ICRBcnRpY2xlSUQgICAgICAgICAgICA9ICRBcnRpY2xlQmFja2VuZE9iamVjdC0+QXJ0aWNsZUNyZWF0ZSgKICAgICAgICAgICAgTm9BZ2VudE5vdGlmeSAgICAgICAgPT4gJE5vQWdlbnROb3RpZnksCiAgICAgICAgICAgIFRpY2tldElEICAgICAgICAgICAgID0+ICRUaWNrZXRJRCwKICAgICAgICAgICAgU2VuZGVyVHlwZSAgICAgICAgICAgPT4gJENvbmZpZy0+e1NlbmRlclR5cGV9LAogICAgICAgICAgICBJc1Zpc2libGVGb3JDdXN0b21lciA9PiAkQ29uZmlnLT57SXNWaXNpYmxlRm9yQ3VzdG9tZXJ9LAogICAgICAgICAgICBGcm9tICAgICAgICAgICAgICAgICA9PiAkR2V0UGFyYW17RnJvbX0sCiAgICAgICAgICAgIFRvICAgICAgICAgICAgICAgICAgID0+ICRUbywKICAgICAgICAgICAgU3ViamVjdCAgICAgICAgICAgICAgPT4gJEdldFBhcmFte1N1YmplY3R9LAogICAgICAgICAgICBCb2R5ICAgICAgICAgICAgICAgICA9PiAkR2V0UGFyYW17Qm9keX0sCiAgICAgICAgICAgIE1pbWVUeXBlICAgICAgICAgICAgID0+ICRNaW1lVHlwZSwKICAgICAgICAgICAgQ2hhcnNldCAgICAgICAgICAgICAgPT4gJExheW91dE9iamVjdC0+e1VzZXJDaGFyc2V0fSwKICAgICAgICAgICAgVXNlcklEICAgICAgICAgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICBIaXN0b3J5VHlwZSAgICAgICAgICA9PiAkQ29uZmlnLT57SGlzdG9yeVR5cGV9LAogICAgICAgICAgICBIaXN0b3J5Q29tbWVudCAgICAgICA9PiAkQ29uZmlnLT57SGlzdG9yeUNvbW1lbnR9IHx8ICclJScsCiAgICAgICAgICAgIEF1dG9SZXNwb25zZVR5cGUgICAgID0+ICggJENvbmZpZ09iamVjdC0+R2V0KCdBdXRvUmVzcG9uc2VGb3JXZWJUaWNrZXRzJykgKQogICAgICAgICAgICA/ICdhdXRvIHJlcGx5JwogICAgICAgICAgICA6ICcnLAogICAgICAgICAgICBPcmlnSGVhZGVyID0+IHsKICAgICAgICAgICAgICAgIEZyb20gICAgPT4gJEdldFBhcmFte0Zyb219LAogICAgICAgICAgICAgICAgVG8gICAgICA9PiAkR2V0UGFyYW17VG99LAogICAgICAgICAgICAgICAgU3ViamVjdCA9PiAkR2V0UGFyYW17U3ViamVjdH0sCiAgICAgICAgICAgICAgICBCb2R5ICAgID0+ICRQbGFpbkJvZHksCgogICAgICAgICAgICB9LAogICAgICAgICAgICBRdWV1ZSA9PiAkUXVldWVPYmplY3QtPlF1ZXVlTG9va3VwKCBRdWV1ZUlEID0+ICROZXdRdWV1ZUlEICksCiAgICAgICAgKTsKICAgICAgICBpZiAoICEkQXJ0aWNsZUlEICkgewogICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+RXJyb3JTY3JlZW4oKTsKICAgICAgICB9CgogICAgICAgICMgc2V0IGFydGljbGUgZHluYW1pYyBmaWVsZHMKICAgICAgICAjIGN5Y2xlIHRocm91Z2ggdGhlIGFjdGl2YXRlZCBEeW5hbWljIEZpZWxkcyBmb3IgdGhpcyBzY3JlZW4KICAgICAgICBEWU5BTUlDRklFTEQ6CiAgICAgICAgZm9yIG15ICREeW5hbWljRmllbGRDb25maWcgKCBAeyAkU2VsZi0+e0R5bmFtaWNGaWVsZH0gfSApIHsKICAgICAgICAgICAgbmV4dCBEWU5BTUlDRklFTEQgaWYgIUlzSGFzaFJlZldpdGhEYXRhKCREeW5hbWljRmllbGRDb25maWcpOwogICAgICAgICAgICBuZXh0IERZTkFNSUNGSUVMRCBpZiAkRHluYW1pY0ZpZWxkQ29uZmlnLT57T2JqZWN0VHlwZX0gbmUgJ0FydGljbGUnOwoKICAgICAgICAgICAgIyBzZXQgdGhlIHZhbHVlCiAgICAgICAgICAgIG15ICRTdWNjZXNzID0gJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QtPlZhbHVlU2V0KAogICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRDb25maWcsCiAgICAgICAgICAgICAgICBPYmplY3RJRCAgICAgICAgICAgPT4gJEFydGljbGVJRCwKICAgICAgICAgICAgICAgIFZhbHVlICAgICAgICAgICAgICA9PiAkRHluYW1pY0ZpZWxkVmFsdWVzeyAkRHluYW1pY0ZpZWxkQ29uZmlnLT57TmFtZX0gfSwKICAgICAgICAgICAgICAgIFVzZXJJRCAgICAgICAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIFBlcm1pc3Npb25zIGNoZWNrIHdlcmUgZG9uZSBlYXJsaWVyCiAgICAgICAgaWYgKCAkR2V0UGFyYW17RnJvbUNoYXRJRH0gKSB7CiAgICAgICAgICAgIG15ICRDaGF0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNoYXQnKTsKICAgICAgICAgICAgbXkgJUNoYXQgICAgICAgPSAkQ2hhdE9iamVjdC0+Q2hhdEdldCgKICAgICAgICAgICAgICAgIENoYXRJRCA9PiAkR2V0UGFyYW17RnJvbUNoYXRJRH0sCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIG15IEBDaGF0TWVzc2FnZUxpc3QgPSAkQ2hhdE9iamVjdC0+Q2hhdE1lc3NhZ2VMaXN0KAogICAgICAgICAgICAgICAgQ2hhdElEID0+ICRHZXRQYXJhbXtGcm9tQ2hhdElEfSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgbXkgJENoYXRBcnRpY2xlSUQ7CgogICAgICAgICAgICBpZiAoQENoYXRNZXNzYWdlTGlzdCkgewogICAgICAgICAgICAgICAgZm9yIG15ICRNZXNzYWdlIChAQ2hhdE1lc3NhZ2VMaXN0KSB7CiAgICAgICAgICAgICAgICAgICAgJE1lc3NhZ2UtPntNZXNzYWdlVGV4dH0gPSAkTGF5b3V0T2JqZWN0LT5Bc2NpaTJIdG1sKAogICAgICAgICAgICAgICAgICAgICAgICBUZXh0ICAgICAgICA9PiAkTWVzc2FnZS0+e01lc3NhZ2VUZXh0fSwKICAgICAgICAgICAgICAgICAgICAgICAgTGlua0ZlYXR1cmUgPT4gMSwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG15ICRBcnRpY2xlQ2hhdEJhY2tlbmQgPSAkQXJ0aWNsZU9iamVjdC0+QmFja2VuZEZvckNoYW5uZWwoIENoYW5uZWxOYW1lID0+ICdDaGF0JyApOwogICAgICAgICAgICAgICAgJENoYXRBcnRpY2xlSUQgPSAkQXJ0aWNsZUNoYXRCYWNrZW5kLT5BcnRpY2xlQ3JlYXRlKAogICAgICAgICAgICAgICAgICAgIFRpY2tldElEICAgICAgICAgICAgID0+ICRUaWNrZXRJRCwKICAgICAgICAgICAgICAgICAgICBTZW5kZXJUeXBlICAgICAgICAgICA9PiAkQ29uZmlnLT57U2VuZGVyVHlwZX0sCiAgICAgICAgICAgICAgICAgICAgQ2hhdE1lc3NhZ2VMaXN0ICAgICAgPT4gXEBDaGF0TWVzc2FnZUxpc3QsCiAgICAgICAgICAgICAgICAgICAgSXNWaXNpYmxlRm9yQ3VzdG9tZXIgPT4gJENvbmZpZy0+e0lzVmlzaWJsZUZvckN1c3RvbWVyfSwKICAgICAgICAgICAgICAgICAgICBVc2VySUQgICAgICAgICAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICAgICAgICAgSGlzdG9yeVR5cGUgICAgICAgICAgPT4gJENvbmZpZy0+e0hpc3RvcnlUeXBlfSwKICAgICAgICAgICAgICAgICAgICBIaXN0b3J5Q29tbWVudCAgICAgICA9PiAkQ29uZmlnLT57SGlzdG9yeUNvbW1lbnR9IHx8ICclJScsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgkQ2hhdEFydGljbGVJRCkgewoKICAgICAgICAgICAgICAgICMgY2hlY2sgaXMgY3VzdG9tZXIgYWN0aXZlbHkgcHJlc2VudAogICAgICAgICAgICAgICAgIyBpdCBtZWFucyBjdXN0b21lciBoYXMgYWNjZXB0ZWQgdGhpcyBjaGF0IGFuZCBub3QgbGVmdCBpdCEKICAgICAgICAgICAgICAgIG15ICRDdXN0b21lclByZXNlbnQgPSAkQ2hhdE9iamVjdC0+Q3VzdG9tZXJQcmVzZW50KAogICAgICAgICAgICAgICAgICAgIENoYXRJRCA9PiAkR2V0UGFyYW17RnJvbUNoYXRJRH0sCiAgICAgICAgICAgICAgICAgICAgQWN0aXZlID0+IDEsCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgIG15ICRTdWNjZXNzOwoKICAgICAgICAgICAgICAgICMgaWYgdGhlcmUgaXMgbm8gY3VzdG9tZXIgcHJlc2VudCBpbiB0aGUgY2hhdAogICAgICAgICAgICAgICAgIyBqdXN0IHJlbW92ZSB0aGUgY2hhdAogICAgICAgICAgICAgICAgaWYgKCAhJEN1c3RvbWVyUHJlc2VudCApIHsKICAgICAgICAgICAgICAgICAgICAkU3VjY2VzcyA9ICRDaGF0T2JqZWN0LT5DaGF0RGVsZXRlKAogICAgICAgICAgICAgICAgICAgICAgICBDaGF0SUQgPT4gJEdldFBhcmFte0Zyb21DaGF0SUR9LAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBvdGhlcndpc2Ugc2V0IGNoYXQgc3RhdHVzIHRvIGNsb3NlZCBhbmQgaW5mb3JtIG90aGVyIGFnZW50cwogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJFN1Y2Nlc3MgPSAkQ2hhdE9iamVjdC0+Q2hhdFVwZGF0ZSgKICAgICAgICAgICAgICAgICAgICAgICAgQ2hhdElEICAgICA9PiAkR2V0UGFyYW17RnJvbUNoYXRJRH0sCiAgICAgICAgICAgICAgICAgICAgICAgIFN0YXR1cyAgICAgPT4gJ2Nsb3NlZCcsCiAgICAgICAgICAgICAgICAgICAgICAgIERlcHJlY2F0ZWQgPT4gMSwKICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICAgICAjIGdldCB1c2VyIGRhdGEKICAgICAgICAgICAgICAgICAgICBteSAlVXNlciA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpVc2VyJyktPkdldFVzZXJEYXRhKAogICAgICAgICAgICAgICAgICAgICAgICBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgICAgIG15ICRSZXF1ZXN0ZXJOYW1lID0gJFVzZXJ7VXNlckZ1bGxuYW1lfTsKICAgICAgICAgICAgICAgICAgICAkUmVxdWVzdGVyTmFtZSB8fD0gJFNlbGYtPntVc2VySUR9OwoKICAgICAgICAgICAgICAgICAgICBteSAkTGVhdmVNZXNzYWdlID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpMYW5ndWFnZScpLT5UcmFuc2xhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgICIlcyBoYXMgbGVmdCB0aGUgY2hhdC4iLAogICAgICAgICAgICAgICAgICAgICAgICAkUmVxdWVzdGVyTmFtZSwKICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICAgICAkU3VjY2VzcyA9ICRDaGF0T2JqZWN0LT5DaGF0TWVzc2FnZUFkZCgKICAgICAgICAgICAgICAgICAgICAgICAgQ2hhdElEICAgICAgICAgID0+ICRHZXRQYXJhbXtGcm9tQ2hhdElEfSwKICAgICAgICAgICAgICAgICAgICAgICAgQ2hhdHRlcklEICAgICAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgICAgICAgICAgICAgQ2hhdHRlclR5cGUgICAgID0+ICdVc2VyJywKICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZVRleHQgICAgID0+ICRMZWF2ZU1lc3NhZ2UsCiAgICAgICAgICAgICAgICAgICAgICAgIFN5c3RlbUdlbmVyYXRlZCA9PiAxLAogICAgICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgICAgICMgdGltZSBhZnRlciBjaGF0IHdpbGwgYmUgcmVtb3ZlZAogICAgICAgICAgICAgICAgICAgIG15ICRDaGF0VFRMID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKS0+R2V0KCdDaGF0RW5naW5lOjpDaGF0VFRMJyk7CgogICAgICAgICAgICAgICAgICAgIG15ICRDaGF0Q2xvc2VkTWVzc2FnZSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6TGFuZ3VhZ2UnKS0+VHJhbnNsYXRlKAogICAgICAgICAgICAgICAgICAgICAgICAiVGhpcyBjaGF0IGhhcyBiZWVuIGNsb3NlZCBhbmQgd2lsbCBiZSByZW1vdmVkIGluICVzIGhvdXJzLiIsCiAgICAgICAgICAgICAgICAgICAgICAgICRDaGF0VFRMLAogICAgICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgICAgICRTdWNjZXNzID0gJENoYXRPYmplY3QtPkNoYXRNZXNzYWdlQWRkKAogICAgICAgICAgICAgICAgICAgICAgICBDaGF0SUQgICAgICAgICAgPT4gJEdldFBhcmFte0Zyb21DaGF0SUR9LAogICAgICAgICAgICAgICAgICAgICAgICBDaGF0dGVySUQgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICAgICAgICAgICAgICBDaGF0dGVyVHlwZSAgICAgPT4gJ1VzZXInLAogICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlVGV4dCAgICAgPT4gJENoYXRDbG9zZWRNZXNzYWdlLAogICAgICAgICAgICAgICAgICAgICAgICBTeXN0ZW1HZW5lcmF0ZWQgPT4gMSwKICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICAgICAjIHJlbW92ZSBhbGwgQUdFTlQgcGFydGljaXBhbnRzIGZyb20gY2hhdAogICAgICAgICAgICAgICAgICAgIG15IEBQYXJ0aWNpcGFudHNMaXN0ID0gJENoYXRPYmplY3QtPkNoYXRQYXJ0aWNpcGFudExpc3QoCiAgICAgICAgICAgICAgICAgICAgICAgIENoYXRJRCA9PiAkR2V0UGFyYW17RnJvbUNoYXRJRH0sCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICBDSEFUUEFSVElDSVBBTlQ6CiAgICAgICAgICAgICAgICAgICAgZm9yIG15ICRDaGF0UGFydGljaXBhbnQgKEBQYXJ0aWNpcGFudHNMaXN0KSB7CgogICAgICAgICAgICAgICAgICAgICAgICAjIHNraXAgaXQgdGhpcyBwYXJ0aWNpcGFudCBpcyBub3QgYWdlbnQKICAgICAgICAgICAgICAgICAgICAgICAgbmV4dCBDSEFUUEFSVElDSVBBTlQgaWYgJENoYXRQYXJ0aWNpcGFudC0+e0NoYXR0ZXJUeXBlfSBuZSAnVXNlcic7CgogICAgICAgICAgICAgICAgICAgICAgICAjIHJlbW92ZSB0aGlzIHBhcnRpY2lwYW50cyBmcm9tIHRoZSBjaGF0CiAgICAgICAgICAgICAgICAgICAgICAgICRTdWNjZXNzID0gJENoYXRPYmplY3QtPkNoYXRQYXJ0aWNpcGFudFJlbW92ZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENoYXRJRCAgICAgID0+ICRHZXRQYXJhbXtGcm9tQ2hhdElEfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENoYXR0ZXJJRCAgID0+ICRDaGF0UGFydGljaXBhbnQtPntDaGF0dGVySUR9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2hhdHRlclR5cGUgPT4gJ1VzZXInLAogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBzZXQgb3duZXIgKGlmIG5ldyB1c2VyIGlkIGlzIGdpdmVuKQogICAgICAgIGlmICggJEdldFBhcmFte05ld1VzZXJJRH0gKSB7CiAgICAgICAgICAgICRUaWNrZXRPYmplY3QtPlRpY2tldE93bmVyU2V0KAogICAgICAgICAgICAgICAgVGlja2V0SUQgID0+ICRUaWNrZXRJRCwKICAgICAgICAgICAgICAgIE5ld1VzZXJJRCA9PiAkR2V0UGFyYW17TmV3VXNlcklEfSwKICAgICAgICAgICAgICAgIFVzZXJJRCAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAjIHNldCBsb2NrCiAgICAgICAgICAgICRUaWNrZXRPYmplY3QtPlRpY2tldExvY2tTZXQoCiAgICAgICAgICAgICAgICBUaWNrZXRJRCA9PiAkVGlja2V0SUQsCiAgICAgICAgICAgICAgICBMb2NrICAgICA9PiAnbG9jaycsCiAgICAgICAgICAgICAgICBVc2VySUQgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIGVsc2Ugc2V0IG93bmVyIHRvIGN1cnJlbnQgYWdlbnQgYnV0IGRvIG5vdCBsb2NrIGl0CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRUaWNrZXRPYmplY3QtPlRpY2tldE93bmVyU2V0KAogICAgICAgICAgICAgICAgVGlja2V0SUQgICAgICAgICAgID0+ICRUaWNrZXRJRCwKICAgICAgICAgICAgICAgIE5ld1VzZXJJRCAgICAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICAgICBTZW5kTm9Ob3RpZmljYXRpb24gPT4gMSwKICAgICAgICAgICAgICAgIFVzZXJJRCAgICAgICAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIHNldCByZXNwb25zaWJsZSAoaWYgbmV3IHVzZXIgaWQgaXMgZ2l2ZW4pCiAgICAgICAgaWYgKCAkR2V0UGFyYW17TmV3UmVzcG9uc2libGVJRH0gKSB7CiAgICAgICAgICAgICRUaWNrZXRPYmplY3QtPlRpY2tldFJlc3BvbnNpYmxlU2V0KAogICAgICAgICAgICAgICAgVGlja2V0SUQgID0+ICRUaWNrZXRJRCwKICAgICAgICAgICAgICAgIE5ld1VzZXJJRCA9PiAkR2V0UGFyYW17TmV3UmVzcG9uc2libGVJRH0sCiAgICAgICAgICAgICAgICBVc2VySUQgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyB0aW1lIGFjY291bnRpbmcKICAgICAgICBpZiAoICRHZXRQYXJhbXtUaW1lVW5pdHN9ICkgewogICAgICAgICAgICAkVGlja2V0T2JqZWN0LT5UaWNrZXRBY2NvdW50VGltZSgKICAgICAgICAgICAgICAgIFRpY2tldElEICA9PiAkVGlja2V0SUQsCiAgICAgICAgICAgICAgICBBcnRpY2xlSUQgPT4gJEFydGljbGVJRCwKICAgICAgICAgICAgICAgIFRpbWVVbml0ICA9PiAkR2V0UGFyYW17VGltZVVuaXRzfSwKICAgICAgICAgICAgICAgIFVzZXJJRCAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIHdyaXRlIGF0dGFjaG1lbnRzCiAgICAgICAgZm9yIG15ICRBdHRhY2htZW50IChAQXR0YWNobWVudERhdGEpIHsKICAgICAgICAgICAgJEFydGljbGVCYWNrZW5kT2JqZWN0LT5BcnRpY2xlV3JpdGVBdHRhY2htZW50KAogICAgICAgICAgICAgICAgJXskQXR0YWNobWVudH0sCiAgICAgICAgICAgICAgICBUaWNrZXRJRCAgPT4gJFRpY2tldElELAogICAgICAgICAgICAgICAgQXJ0aWNsZUlEID0+ICRBcnRpY2xlSUQsCiAgICAgICAgICAgICAgICBVc2VySUQgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyByZW1vdmUgcHJlIHN1Ym1pdGVkIGF0dGFjaG1lbnRzCiAgICAgICAgJFVwbG9hZENhY2hlT2JqZWN0LT5Gb3JtSURSZW1vdmUoIEZvcm1JRCA9PiAkU2VsZi0+e0Zvcm1JRH0gKTsKCiAgICAgICAgIyBsaW5rIHRpY2tldHMKICAgICAgICBpZiAoCiAgICAgICAgICAgICRHZXRQYXJhbXtMaW5rVGlja2V0SUR9CiAgICAgICAgICAgICYmICRDb25maWctPntTcGxpdExpbmtUeXBlfQogICAgICAgICAgICAmJiAkQ29uZmlnLT57U3BsaXRMaW5rVHlwZX0tPntMaW5rVHlwZX0KICAgICAgICAgICAgJiYgJENvbmZpZy0+e1NwbGl0TGlua1R5cGV9LT57RGlyZWN0aW9ufQogICAgICAgICAgICApCiAgICAgICAgewogICAgICAgICAgICBteSAkQWNjZXNzID0gJFRpY2tldE9iamVjdC0+VGlja2V0UGVybWlzc2lvbigKICAgICAgICAgICAgICAgIFR5cGUgICAgID0+ICdybycsCiAgICAgICAgICAgICAgICBUaWNrZXRJRCA9PiAkR2V0UGFyYW17TGlua1RpY2tldElEfSwKICAgICAgICAgICAgICAgIFVzZXJJRCAgID0+ICRTZWxmLT57VXNlcklEfQogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKCAhJEFjY2VzcyApIHsKICAgICAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5Ob1Blcm1pc3Npb24oCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSAgICA9PiBUcmFuc2xhdGFibGUoJ1lvdSBuZWVkIHJvIHBlcm1pc3Npb24hJyksCiAgICAgICAgICAgICAgICAgICAgV2l0aEhlYWRlciA9PiAneWVzJywKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG15ICRTb3VyY2VLZXkgPSAkR2V0UGFyYW17TGlua1RpY2tldElEfTsKICAgICAgICAgICAgbXkgJFRhcmdldEtleSA9ICRUaWNrZXRJRDsKCiAgICAgICAgICAgIGlmICggJENvbmZpZy0+e1NwbGl0TGlua1R5cGV9LT57RGlyZWN0aW9ufSBlcSAnU291cmNlJyApIHsKICAgICAgICAgICAgICAgICRTb3VyY2VLZXkgPSAkVGlja2V0SUQ7CiAgICAgICAgICAgICAgICAkVGFyZ2V0S2V5ID0gJEdldFBhcmFte0xpbmtUaWNrZXRJRH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgbGluayB0aGUgdGlja2V0cwogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TGlua09iamVjdCcpLT5MaW5rQWRkKAogICAgICAgICAgICAgICAgU291cmNlT2JqZWN0ID0+ICdUaWNrZXQnLAogICAgICAgICAgICAgICAgU291cmNlS2V5ICAgID0+ICRTb3VyY2VLZXksCiAgICAgICAgICAgICAgICBUYXJnZXRPYmplY3QgPT4gJ1RpY2tldCcsCiAgICAgICAgICAgICAgICBUYXJnZXRLZXkgICAgPT4gJFRhcmdldEtleSwKICAgICAgICAgICAgICAgIFR5cGUgICAgICAgICA9PiAkQ29uZmlnLT57U3BsaXRMaW5rVHlwZX0tPntMaW5rVHlwZX0gfHwgJ05vcm1hbCcsCiAgICAgICAgICAgICAgICBTdGF0ZSAgICAgICAgPT4gJ1ZhbGlkJywKICAgICAgICAgICAgICAgIFVzZXJJRCAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIGNsb3NlZCB0aWNrZXRzIGdldCB1bmxvY2tlZAogICAgICAgIGlmICggJFN0YXRlRGF0YXtUeXBlTmFtZX0gPX4gL15jbG9zZS9pICkgewoKICAgICAgICAgICAgIyBzZXQgbG9jawogICAgICAgICAgICAkVGlja2V0T2JqZWN0LT5UaWNrZXRMb2NrU2V0KAogICAgICAgICAgICAgICAgVGlja2V0SUQgPT4gJFRpY2tldElELAogICAgICAgICAgICAgICAgTG9jayAgICAgPT4gJ3VubG9jaycsCiAgICAgICAgICAgICAgICBVc2VySUQgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIHNldCBwZW5kaW5nIHRpbWUKICAgICAgICBlbHNpZiAoICRTdGF0ZURhdGF7VHlwZU5hbWV9ID1+IC9ecGVuZGluZy9pICkgewoKICAgICAgICAgICAgIyBzZXQgcGVuZGluZyB0aW1lCiAgICAgICAgICAgICRUaWNrZXRPYmplY3QtPlRpY2tldFBlbmRpbmdUaW1lU2V0KAogICAgICAgICAgICAgICAgVXNlcklEICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICAgICAgVGlja2V0SUQgPT4gJFRpY2tldElELAogICAgICAgICAgICAgICAgJUdldFBhcmFtLAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBnZXQgcmVkaXJlY3Qgc2NyZWVuCiAgICAgICAgbXkgJE5leHRTY3JlZW4gPSAkU2VsZi0+e1VzZXJDcmVhdGVOZXh0TWFza30gfHwgJ0FnZW50VGlja2V0UGhvbmUnOwoKICAgICAgICAjIHJlZGlyZWN0CiAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPlJlZGlyZWN0KAogICAgICAgICAgICBPUCA9PiAiQWN0aW9uPSROZXh0U2NyZWVuO1N1YmFjdGlvbj1DcmVhdGVkO1RpY2tldElEPSRUaWNrZXRJRCIsCiAgICAgICAgKTsKICAgIH0KICAgIGVsc2lmICggJFNlbGYtPntTdWJhY3Rpb259IGVxICdBSkFYVXBkYXRlJyApIHsKICAgICAgICBteSAkRGVzdCAgICAgICAgICAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnRGVzdCcgKSB8fCAnJzsKICAgICAgICBteSAkQ3VzdG9tZXJVc2VyICAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnU2VsZWN0ZWRDdXN0b21lclVzZXInICk7CiAgICAgICAgbXkgJEVsZW1lbnRDaGFuZ2VkID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0VsZW1lbnRDaGFuZ2VkJyApIHx8ICcnOwogICAgICAgIG15ICRRdWV1ZUlEID0gJyc7CiAgICAgICAgaWYgKCAkRGVzdCA9fiAvXihcZHsxLDEwMH0pXHxcfC4rPyQvICkgewogICAgICAgICAgICAkUXVldWVJRCA9ICQxOwogICAgICAgIH0KCiAgICAgICAgIyBnZXQgbGlzdCB0eXBlCiAgICAgICAgbXkgJFRyZWVWaWV3ID0gMDsKICAgICAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpGcm9udGVuZDo6TGlzdFR5cGUnKSBlcSAndHJlZScgKSB7CiAgICAgICAgICAgICRUcmVlVmlldyA9IDE7CiAgICAgICAgfQoKICAgICAgICBteSAkVG9zID0gJFNlbGYtPl9HZXRUb3MoCiAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgJUFDTENvbXBhdEdldFBhcmFtLAogICAgICAgICAgICBDdXN0b21lclVzZXJJRCA9PiAkQ3VzdG9tZXJVc2VyIHx8ICcnLAogICAgICAgICAgICBRdWV1ZUlEICAgICAgICA9PiAkUXVldWVJRCwKICAgICAgICApOwoKICAgICAgICBteSAkTmV3VG9zOwoKICAgICAgICBpZiAoJFRvcykgewogICAgICAgICAgICBUT3M6CiAgICAgICAgICAgIGZvciBteSAkS2V5VG8gKCBzb3J0IGtleXMgJXskVG9zfSApIHsKICAgICAgICAgICAgICAgIG5leHQgVE9zIGlmICggJFRvcy0+eyRLZXlUb30gZXEgJy0nICk7CiAgICAgICAgICAgICAgICAkTmV3VG9zLT57IiRLZXlUb3x8JFRvcy0+eyRLZXlUb30ifSA9ICRUb3MtPnskS2V5VG99OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIG15ICRVc2VycyA9ICRTZWxmLT5fR2V0VXNlcnMoCiAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgJUFDTENvbXBhdEdldFBhcmFtLAogICAgICAgICAgICBRdWV1ZUlEICA9PiAkUXVldWVJRCwKICAgICAgICAgICAgQWxsVXNlcnMgPT4gJEdldFBhcmFte093bmVyQWxsfSwKICAgICAgICApOwogICAgICAgIG15ICRSZXNwb25zaWJsZVVzZXJzID0gJFNlbGYtPl9HZXRSZXNwb25zaWJsZXMoCiAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgJUFDTENvbXBhdEdldFBhcmFtLAogICAgICAgICAgICBRdWV1ZUlEICA9PiAkUXVldWVJRCwKICAgICAgICAgICAgQWxsVXNlcnMgPT4gJEdldFBhcmFte1Jlc3BvbnNpYmxlQWxsfSwKICAgICAgICApOwogICAgICAgIG15ICROZXh0U3RhdGVzID0gJFNlbGYtPl9HZXROZXh0U3RhdGVzKAogICAgICAgICAgICAlR2V0UGFyYW0sCiAgICAgICAgICAgICVBQ0xDb21wYXRHZXRQYXJhbSwKICAgICAgICAgICAgQ3VzdG9tZXJVc2VySUQgPT4gJEN1c3RvbWVyVXNlciB8fCAnJywKICAgICAgICAgICAgUXVldWVJRCAgICAgICAgPT4gJFF1ZXVlSUQgICAgICB8fCAxLAogICAgICAgICk7CiAgICAgICAgbXkgJFByaW9yaXRpZXMgPSAkU2VsZi0+X0dldFByaW9yaXRpZXMoCiAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgJUFDTENvbXBhdEdldFBhcmFtLAogICAgICAgICAgICBDdXN0b21lclVzZXJJRCA9PiAkQ3VzdG9tZXJVc2VyIHx8ICcnLAogICAgICAgICAgICBRdWV1ZUlEICAgICAgICA9PiAkUXVldWVJRCAgICAgIHx8IDEsCiAgICAgICAgKTsKICAgICAgICBteSAkU2VydmljZXMgPSAkU2VsZi0+X0dldFNlcnZpY2VzKAogICAgICAgICAgICAlR2V0UGFyYW0sCiAgICAgICAgICAgICVBQ0xDb21wYXRHZXRQYXJhbSwKICAgICAgICAgICAgQ3VzdG9tZXJVc2VySUQgPT4gJEN1c3RvbWVyVXNlciB8fCAnJywKICAgICAgICAgICAgUXVldWVJRCAgICAgICAgPT4gJFF1ZXVlSUQgICAgICB8fCAxLAogICAgICAgICk7CiAgICAgICAgbXkgJFNMQXMgPSAkU2VsZi0+X0dldFNMQXMoCiAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgJUFDTENvbXBhdEdldFBhcmFtLAogICAgICAgICAgICBDdXN0b21lclVzZXJJRCA9PiAkQ3VzdG9tZXJVc2VyIHx8ICcnLAogICAgICAgICAgICBRdWV1ZUlEICAgICAgICA9PiAkUXVldWVJRCAgICAgIHx8IDEsCiAgICAgICAgICAgIFNlcnZpY2VzICAgICAgID0+ICRTZXJ2aWNlcywKICAgICAgICApOwogICAgICAgIG15ICRTdGFuZGFyZFRlbXBsYXRlcyA9ICRTZWxmLT5fR2V0U3RhbmRhcmRUZW1wbGF0ZXMoCiAgICAgICAgICAgICVHZXRQYXJhbSwKICAgICAgICAgICAgJUFDTENvbXBhdEdldFBhcmFtLAogICAgICAgICAgICBRdWV1ZUlEID0+ICRRdWV1ZUlEIHx8ICcnLAogICAgICAgICk7CiAgICAgICAgbXkgJFR5cGVzID0gJFNlbGYtPl9HZXRUeXBlcygKICAgICAgICAgICAgJUdldFBhcmFtLAogICAgICAgICAgICAlQUNMQ29tcGF0R2V0UGFyYW0sCiAgICAgICAgICAgIEN1c3RvbWVyVXNlcklEID0+ICRDdXN0b21lclVzZXIgfHwgJycsCiAgICAgICAgICAgIFF1ZXVlSUQgICAgICAgID0+ICRRdWV1ZUlEICAgICAgfHwgMSwKICAgICAgICApOwoKICAgICAgICAjIHVwZGF0ZSBEeW5hbWljIEZpZWxkcyBQb3NzaWJsZSBWYWx1ZXMgdmlhIEFKQVgKICAgICAgICBteSBARHluYW1pY0ZpZWxkQUpBWDsKCiAgICAgICAgIyBjeWNsZSB0aHJvdWdoIHRoZSBhY3RpdmF0ZWQgRHluYW1pYyBGaWVsZHMgZm9yIHRoaXMgc2NyZWVuCiAgICAgICAgRFlOQU1JQ0ZJRUxEOgogICAgICAgIGZvciBteSAkRHluYW1pY0ZpZWxkQ29uZmlnICggQHsgJFNlbGYtPntEeW5hbWljRmllbGR9IH0gKSB7CiAgICAgICAgICAgIG5leHQgRFlOQU1JQ0ZJRUxEIGlmICFJc0hhc2hSZWZXaXRoRGF0YSgkRHluYW1pY0ZpZWxkQ29uZmlnKTsKCiAgICAgICAgICAgIG15ICRJc0FDTFJlZHVjaWJsZSA9ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0LT5IYXNCZWhhdmlvcigKICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZENvbmZpZyA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnLAogICAgICAgICAgICAgICAgQmVoYXZpb3IgICAgICAgICAgID0+ICdJc0FDTFJlZHVjaWJsZScsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIG5leHQgRFlOQU1JQ0ZJRUxEIGlmICEkSXNBQ0xSZWR1Y2libGU7CgogICAgICAgICAgICBteSAkUG9zc2libGVWYWx1ZXMgPSAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdC0+UG9zc2libGVWYWx1ZXNHZXQoCiAgICAgICAgICAgICAgICBEeW5hbWljRmllbGRDb25maWcgPT4gJER5bmFtaWNGaWVsZENvbmZpZywKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgY29udmVydCBwb3NzaWJsZSB2YWx1ZXMga2V5ID0+IHZhbHVlIHRvIGtleSA9PiBrZXkgZm9yIEFDTHMgdXNpbmcgYSBIYXNoIHNsaWNlCiAgICAgICAgICAgIG15ICVBY2xEYXRhID0gJXskUG9zc2libGVWYWx1ZXN9OwogICAgICAgICAgICBAQWNsRGF0YXsga2V5cyAlQWNsRGF0YSB9ID0ga2V5cyAlQWNsRGF0YTsKCiAgICAgICAgICAgICMgc2V0IHBvc3NpYmxlIHZhbHVlcyBmaWx0ZXIgZnJvbSBBQ0xzCiAgICAgICAgICAgIG15ICRBQ0wgPSAkVGlja2V0T2JqZWN0LT5UaWNrZXRBY2woCiAgICAgICAgICAgICAgICAlR2V0UGFyYW0sCiAgICAgICAgICAgICAgICAlQUNMQ29tcGF0R2V0UGFyYW0sCiAgICAgICAgICAgICAgICBDdXN0b21lclVzZXJJRCA9PiAkQ3VzdG9tZXJVc2VyIHx8ICcnLAogICAgICAgICAgICAgICAgQWN0aW9uICAgICAgICAgPT4gJFNlbGYtPntBY3Rpb259LAogICAgICAgICAgICAgICAgUXVldWVJRCAgICAgICAgPT4gJFF1ZXVlSUQgfHwgMCwKICAgICAgICAgICAgICAgIFJldHVyblR5cGUgICAgID0+ICdUaWNrZXQnLAogICAgICAgICAgICAgICAgUmV0dXJuU3ViVHlwZSAgPT4gJ0R5bmFtaWNGaWVsZF8nIC4gJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9LAogICAgICAgICAgICAgICAgRGF0YSAgICAgICAgICAgPT4gXCVBY2xEYXRhLAogICAgICAgICAgICAgICAgVXNlcklEICAgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICApOwogICAgICAgICAgICBpZiAoJEFDTCkgewogICAgICAgICAgICAgICAgbXkgJUZpbHRlciA9ICRUaWNrZXRPYmplY3QtPlRpY2tldEFjbERhdGEoKTsKCiAgICAgICAgICAgICAgICAjIGNvbnZlcnQgRmlsZXIga2V5ID0+IGtleSBiYWNrIHRvIGtleSA9PiB2YWx1ZSB1c2luZyBtYXAKICAgICAgICAgICAgICAgICV7JFBvc3NpYmxlVmFsdWVzfSA9IG1hcCB7ICRfID0+ICRQb3NzaWJsZVZhbHVlcy0+eyRffSB9IGtleXMgJUZpbHRlcjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbXkgJERhdGFWYWx1ZXMgPSAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdC0+QnVpbGRTZWxlY3Rpb25EYXRhR2V0KAogICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRDb25maWcsCiAgICAgICAgICAgICAgICBQb3NzaWJsZVZhbHVlcyAgICAgPT4gJFBvc3NpYmxlVmFsdWVzLAogICAgICAgICAgICAgICAgVmFsdWUgICAgICAgICAgICAgID0+ICREeW5hbWljRmllbGRWYWx1ZXN7ICREeW5hbWljRmllbGRDb25maWctPntOYW1lfSB9LAogICAgICAgICAgICApIHx8ICRQb3NzaWJsZVZhbHVlczsKCiAgICAgICAgICAgICMgYWRkIGR5bmFtaWMgZmllbGQgdG8gdGhlIGxpc3Qgb2YgZmllbGRzIHRvIHVwZGF0ZQogICAgICAgICAgICBwdXNoIEBEeW5hbWljRmllbGRBSkFYLCB7CiAgICAgICAgICAgICAgICBOYW1lICAgICAgICA9PiAnRHluYW1pY0ZpZWxkXycgLiAkRHluYW1pY0ZpZWxkQ29uZmlnLT57TmFtZX0sCiAgICAgICAgICAgICAgICBEYXRhICAgICAgICA9PiAkRGF0YVZhbHVlcywKICAgICAgICAgICAgICAgIFNlbGVjdGVkSUQgID0+ICREeW5hbWljRmllbGRWYWx1ZXN7ICREeW5hbWljRmllbGRDb25maWctPntOYW1lfSB9LAogICAgICAgICAgICAgICAgVHJhbnNsYXRpb24gPT4gJER5bmFtaWNGaWVsZENvbmZpZy0+e0NvbmZpZ30tPntUcmFuc2xhdGFibGVWYWx1ZXN9IHx8IDAsCiAgICAgICAgICAgICAgICBNYXggICAgICAgICA9PiAxMDAsCiAgICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICBteSBAVGVtcGxhdGVBSkFYOwoKICAgICAgICAjIHVwZGF0ZSB0aWNrZXQgYm9keSBhbmQgYXR0YWNoZW1lbnRzIGlmIG5lZWRlZC4KICAgICAgICBpZiAoICRFbGVtZW50Q2hhbmdlZCBlcSAnU3RhbmRhcmRUZW1wbGF0ZUlEJyApIHsKICAgICAgICAgICAgbXkgQFRpY2tldEF0dGFjaG1lbnRzOwogICAgICAgICAgICBteSAkVGVtcGxhdGVUZXh0OwoKICAgICAgICAgICAgIyByZW1vdmUgYWxsIGF0dGFjaG1lbnRzIGZyb20gdGhlIFVwbG9hZCBjYWNoZQogICAgICAgICAgICBteSAkUmVtb3ZlU3VjY2VzcyA9ICRVcGxvYWRDYWNoZU9iamVjdC0+Rm9ybUlEUmVtb3ZlKAogICAgICAgICAgICAgICAgRm9ybUlEID0+ICRTZWxmLT57Rm9ybUlEfSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgaWYgKCAhJFJlbW92ZVN1Y2Nlc3MgKSB7CiAgICAgICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJGb3JtIGF0dGFjaG1lbnRzIGNvdWxkIG5vdCBiZSBkZWxldGVkISIsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGdldCB0aGUgdGVtcGxhdGUgdGV4dCBhbmQgc2V0IG5ldyBhdHRhY2htZW50cyBpZiBhIHRlbXBsYXRlIGlzIHNlbGVjdGVkCiAgICAgICAgICAgIGlmICggSXNQb3NpdGl2ZUludGVnZXIoICRHZXRQYXJhbXtTdGFuZGFyZFRlbXBsYXRlSUR9ICkgKSB7CiAgICAgICAgICAgICAgICBteSAkVGVtcGxhdGVHZW5lcmF0b3IgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGVtcGxhdGVHZW5lcmF0b3InKTsKCiAgICAgICAgICAgICAgICAjIHNldCB0ZW1wbGF0ZSB0ZXh0LCByZXBsYWNlIHNtYXJ0IHRhZ3MgKGxpbWl0ZWQgYXMgdGlja2V0IGlzIG5vdCBjcmVhdGVkKQogICAgICAgICAgICAgICAgJFRlbXBsYXRlVGV4dCA9ICRUZW1wbGF0ZUdlbmVyYXRvci0+VGVtcGxhdGUoCiAgICAgICAgICAgICAgICAgICAgVGVtcGxhdGVJRCAgICAgPT4gJEdldFBhcmFte1N0YW5kYXJkVGVtcGxhdGVJRH0sCiAgICAgICAgICAgICAgICAgICAgVXNlcklEICAgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyVXNlcklEID0+ICRDdXN0b21lclVzZXIsCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICMgY3JlYXRlIFN0ZEF0dGFjaG1lbnRPYmplY3QKICAgICAgICAgICAgICAgIG15ICRTdGRBdHRhY2htZW50T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlN0ZEF0dGFjaG1lbnQnKTsKCiAgICAgICAgICAgICAgICAjIGFkZCBzdGQuIGF0dGFjaG1lbnRzIHRvIHRpY2tldAogICAgICAgICAgICAgICAgbXkgJUFsbFN0ZEF0dGFjaG1lbnRzID0gJFN0ZEF0dGFjaG1lbnRPYmplY3QtPlN0ZEF0dGFjaG1lbnRTdGFuZGFyZFRlbXBsYXRlTWVtYmVyTGlzdCgKICAgICAgICAgICAgICAgICAgICBTdGFuZGFyZFRlbXBsYXRlSUQgPT4gJEdldFBhcmFte1N0YW5kYXJkVGVtcGxhdGVJRH0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgZm9yIG15ICRJRCAoIHNvcnQga2V5cyAlQWxsU3RkQXR0YWNobWVudHMgKSB7CiAgICAgICAgICAgICAgICAgICAgbXkgJUF0dGFjaG1lbnRzRGF0YSA9ICRTdGRBdHRhY2htZW50T2JqZWN0LT5TdGRBdHRhY2htZW50R2V0KCBJRCA9PiAkSUQgKTsKICAgICAgICAgICAgICAgICAgICAkVXBsb2FkQ2FjaGVPYmplY3QtPkZvcm1JREFkZEZpbGUoCiAgICAgICAgICAgICAgICAgICAgICAgIEZvcm1JRCAgICAgID0+ICRTZWxmLT57Rm9ybUlEfSwKICAgICAgICAgICAgICAgICAgICAgICAgRGlzcG9zaXRpb24gPT4gJ2F0dGFjaG1lbnQnLAogICAgICAgICAgICAgICAgICAgICAgICAlQXR0YWNobWVudHNEYXRhLAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBzZW5kIGEgbGlzdCBvZiBhdHRhY2htZW50cyBpbiB0aGUgdXBsb2FkIGNhY2hlIGJhY2sgdG8gdGhlIGNsaWVudHNpZGUgSmF2YVNjcmlwdAogICAgICAgICAgICAgICAgIyB3aGljaCByZW5kZXJzIHRoZW4gdGhlIGxpc3Qgb2YgY3VycmVudGx5IHVwbG9hZGVkIGF0dGFjaG1lbnRzCiAgICAgICAgICAgICAgICBAVGlja2V0QXR0YWNobWVudHMgPSAkVXBsb2FkQ2FjaGVPYmplY3QtPkZvcm1JREdldEFsbEZpbGVzTWV0YSgKICAgICAgICAgICAgICAgICAgICBGb3JtSUQgPT4gJFNlbGYtPntGb3JtSUR9LAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICBmb3IgbXkgJEF0dGFjaG1lbnQgKEBUaWNrZXRBdHRhY2htZW50cykgewogICAgICAgICAgICAgICAgICAgICRBdHRhY2htZW50LT57RmlsZXNpemV9ID0gJExheW91dE9iamVjdC0+SHVtYW5SZWFkYWJsZURhdGFTaXplKAogICAgICAgICAgICAgICAgICAgICAgICBTaXplID0+ICRBdHRhY2htZW50LT57RmlsZXNpemV9LAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEBUZW1wbGF0ZUFKQVggPSAoCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAnVXNlVGVtcGxhdGVDcmVhdGUnLAogICAgICAgICAgICAgICAgICAgIERhdGEgPT4gJzAnLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICdSaWNoVGV4dCcsCiAgICAgICAgICAgICAgICAgICAgRGF0YSA9PiAkVGVtcGxhdGVUZXh0IHx8ICcnLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBOYW1lICAgICA9PiAnVGlja2V0QXR0YWNobWVudHMnLAogICAgICAgICAgICAgICAgICAgIERhdGEgICAgID0+IFxAVGlja2V0QXR0YWNobWVudHMsCiAgICAgICAgICAgICAgICAgICAgS2VlcERhdGEgPT4gMSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICBteSAkSlNPTiA9ICRMYXlvdXRPYmplY3QtPkJ1aWxkU2VsZWN0aW9uSlNPTigKICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIE5hbWUgICAgICAgICA9PiAnRGVzdCcsCiAgICAgICAgICAgICAgICAgICAgRGF0YSAgICAgICAgID0+ICROZXdUb3MsCiAgICAgICAgICAgICAgICAgICAgU2VsZWN0ZWRJRCAgID0+ICREZXN0LAogICAgICAgICAgICAgICAgICAgIFRyYW5zbGF0aW9uICA9PiAwLAogICAgICAgICAgICAgICAgICAgIFBvc3NpYmxlTm9uZSA9PiAxLAogICAgICAgICAgICAgICAgICAgIFRyZWVWaWV3ICAgICA9PiAkVHJlZVZpZXcsCiAgICAgICAgICAgICAgICAgICAgTWF4ICAgICAgICAgID0+IDEwMCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgTmFtZSAgICAgICAgID0+ICdOZXdVc2VySUQnLAogICAgICAgICAgICAgICAgICAgIERhdGEgICAgICAgICA9PiAkVXNlcnMsCiAgICAgICAgICAgICAgICAgICAgU2VsZWN0ZWRJRCAgID0+ICRHZXRQYXJhbXtOZXdVc2VySUR9LAogICAgICAgICAgICAgICAgICAgIFRyYW5zbGF0aW9uICA9PiAwLAogICAgICAgICAgICAgICAgICAgIFBvc3NpYmxlTm9uZSA9PiAxLAogICAgICAgICAgICAgICAgICAgIE1heCAgICAgICAgICA9PiAxMDAsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIE5hbWUgICAgICAgICA9PiAnTmV3UmVzcG9uc2libGVJRCcsCiAgICAgICAgICAgICAgICAgICAgRGF0YSAgICAgICAgID0+ICRSZXNwb25zaWJsZVVzZXJzLAogICAgICAgICAgICAgICAgICAgIFNlbGVjdGVkSUQgICA9PiAkR2V0UGFyYW17TmV3UmVzcG9uc2libGVJRH0sCiAgICAgICAgICAgICAgICAgICAgVHJhbnNsYXRpb24gID0+IDAsCiAgICAgICAgICAgICAgICAgICAgUG9zc2libGVOb25lID0+IDEsCiAgICAgICAgICAgICAgICAgICAgTWF4ICAgICAgICAgID0+IDEwMCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgTmFtZSAgICAgICAgPT4gJ05leHRTdGF0ZUlEJywKICAgICAgICAgICAgICAgICAgICBEYXRhICAgICAgICA9PiAkTmV4dFN0YXRlcywKICAgICAgICAgICAgICAgICAgICBTZWxlY3RlZElEICA9PiAkR2V0UGFyYW17TmV4dFN0YXRlSUR9LAogICAgICAgICAgICAgICAgICAgIFRyYW5zbGF0aW9uID0+IDEsCiAgICAgICAgICAgICAgICAgICAgTWF4ICAgICAgICAgPT4gMTAwLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBOYW1lICAgICAgICA9PiAnUHJpb3JpdHlJRCcsCiAgICAgICAgICAgICAgICAgICAgRGF0YSAgICAgICAgPT4gJFByaW9yaXRpZXMsCiAgICAgICAgICAgICAgICAgICAgU2VsZWN0ZWRJRCAgPT4gJEdldFBhcmFte1ByaW9yaXR5SUR9LAogICAgICAgICAgICAgICAgICAgIFRyYW5zbGF0aW9uID0+IDEsCiAgICAgICAgICAgICAgICAgICAgTWF4ICAgICAgICAgPT4gMTAwLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBOYW1lICAgICAgICAgPT4gJ1NlcnZpY2VJRCcsCiAgICAgICAgICAgICAgICAgICAgRGF0YSAgICAgICAgID0+ICRTZXJ2aWNlcywKICAgICAgICAgICAgICAgICAgICBTZWxlY3RlZElEICAgPT4gJEdldFBhcmFte1NlcnZpY2VJRH0sCiAgICAgICAgICAgICAgICAgICAgUG9zc2libGVOb25lID0+IDEsCiAgICAgICAgICAgICAgICAgICAgVHJhbnNsYXRpb24gID0+IDAsCiAgICAgICAgICAgICAgICAgICAgVHJlZVZpZXcgICAgID0+ICRUcmVlVmlldywKICAgICAgICAgICAgICAgICAgICBNYXggICAgICAgICAgPT4gMTAwLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBOYW1lICAgICAgICAgPT4gJ1NMQUlEJywKICAgICAgICAgICAgICAgICAgICBEYXRhICAgICAgICAgPT4gJFNMQXMsCiAgICAgICAgICAgICAgICAgICAgU2VsZWN0ZWRJRCAgID0+ICRHZXRQYXJhbXtTTEFJRH0sCiAgICAgICAgICAgICAgICAgICAgUG9zc2libGVOb25lID0+IDEsCiAgICAgICAgICAgICAgICAgICAgVHJhbnNsYXRpb24gID0+IDAsCiAgICAgICAgICAgICAgICAgICAgTWF4ICAgICAgICAgID0+IDEwMCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgTmFtZSAgICAgICAgID0+ICdTdGFuZGFyZFRlbXBsYXRlSUQnLAogICAgICAgICAgICAgICAgICAgIERhdGEgICAgICAgICA9PiAkU3RhbmRhcmRUZW1wbGF0ZXMsCiAgICAgICAgICAgICAgICAgICAgU2VsZWN0ZWRJRCAgID0+ICRHZXRQYXJhbXtTdGFuZGFyZFRlbXBsYXRlSUR9LAogICAgICAgICAgICAgICAgICAgIFBvc3NpYmxlTm9uZSA9PiAxLAogICAgICAgICAgICAgICAgICAgIFRyYW5zbGF0aW9uICA9PiAxLAogICAgICAgICAgICAgICAgICAgIE1heCAgICAgICAgICA9PiAxMDAsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIE5hbWUgICAgICAgICA9PiAnVHlwZUlEJywKICAgICAgICAgICAgICAgICAgICBEYXRhICAgICAgICAgPT4gJFR5cGVzLAogICAgICAgICAgICAgICAgICAgIFNlbGVjdGVkSUQgICA9PiAkR2V0UGFyYW17VHlwZUlEfSwKICAgICAgICAgICAgICAgICAgICBQb3NzaWJsZU5vbmUgPT4gMSwKICAgICAgICAgICAgICAgICAgICBUcmFuc2xhdGlvbiAgPT4gMCwKICAgICAgICAgICAgICAgICAgICBNYXggICAgICAgICAgPT4gMTAwLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIEBEeW5hbWljRmllbGRBSkFYLAogICAgICAgICAgICAgICAgQFRlbXBsYXRlQUpBWCwKICAgICAgICAgICAgXSwKICAgICAgICApOwogICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5BdHRhY2htZW50KAogICAgICAgICAgICBDb250ZW50VHlwZSA9PiAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD0nIC4gJExheW91dE9iamVjdC0+e0NoYXJzZXR9LAogICAgICAgICAgICBDb250ZW50ICAgICA9PiAkSlNPTiwKICAgICAgICAgICAgVHlwZSAgICAgICAgPT4gJ2lubGluZScsCiAgICAgICAgICAgIE5vQ2FjaGUgICAgID0+IDEsCiAgICAgICAgKTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5FcnJvclNjcmVlbigKICAgICAgICAgICAgTWVzc2FnZSA9PiBUcmFuc2xhdGFibGUoJ05vIFN1YmFjdGlvbiEnKSwKICAgICAgICAgICAgQ29tbWVudCA9PiBUcmFuc2xhdGFibGUoJ1BsZWFzZSBjb250YWN0IHRoZSBhZG1pbmlzdHJhdG9yLicpLAogICAgICAgICk7CiAgICB9Cn0KCnN1YiBfR2V0TmV4dFN0YXRlcyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICVOZXh0U3RhdGVzOwogICAgaWYgKCAkUGFyYW17UXVldWVJRH0gfHwgJFBhcmFte1RpY2tldElEfSApIHsKICAgICAgICAlTmV4dFN0YXRlcyA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpUaWNrZXQnKS0+VGlja2V0U3RhdGVMaXN0KAogICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgIEFjdGlvbiA9PiAkU2VsZi0+e0FjdGlvbn0sCiAgICAgICAgICAgIFVzZXJJRCA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgKTsKICAgIH0KICAgIHJldHVybiBcJU5leHRTdGF0ZXM7Cn0KCnN1YiBfR2V0VXNlcnMgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGdldCB1c2VycwogICAgbXkgJVNob3duVXNlcnM7CiAgICBteSAlQWxsR3JvdXBzTWVtYmVycyA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpVc2VyJyktPlVzZXJMaXN0KAogICAgICAgIFR5cGUgID0+ICdMb25nJywKICAgICAgICBWYWxpZCA9PiAxLAogICAgKTsKCiAgICAjIGdldCB0aWNrZXQgb2JqZWN0CiAgICBteSAkVGlja2V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpY2tldCcpOwoKICAgICMganVzdCBzaG93IG9ubHkgdXNlcnMgd2l0aCBzZWxlY3RlZCBjdXN0b20gcXVldWUKICAgIGlmICggJFBhcmFte1F1ZXVlSUR9ICYmICEkUGFyYW17QWxsVXNlcnN9ICkgewogICAgICAgIG15IEBVc2VySURzID0gJFRpY2tldE9iamVjdC0+R2V0U3Vic2NyaWJlZFVzZXJJRHNCeVF1ZXVlSUQoJVBhcmFtKTsKICAgICAgICBmb3IgbXkgJEtleUdyb3VwTWVtYmVyICggc29ydCBrZXlzICVBbGxHcm91cHNNZW1iZXJzICkgewogICAgICAgICAgICBteSAkSGl0ID0gMDsKICAgICAgICAgICAgZm9yIG15ICRVSUQgKEBVc2VySURzKSB7CiAgICAgICAgICAgICAgICBpZiAoICRVSUQgZXEgJEtleUdyb3VwTWVtYmVyICkgewogICAgICAgICAgICAgICAgICAgICRIaXQgPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICggISRIaXQgKSB7CiAgICAgICAgICAgICAgICBkZWxldGUgJEFsbEdyb3Vwc01lbWJlcnN7JEtleUdyb3VwTWVtYmVyfTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAjIHNob3cgYWxsIHN5c3RlbSB1c2VycwogICAgaWYgKCAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpLT5HZXQoJ1RpY2tldDo6Q2hhbmdlT3duZXJUb0V2ZXJ5b25lJykgKSB7CiAgICAgICAgJVNob3duVXNlcnMgPSAlQWxsR3JvdXBzTWVtYmVyczsKICAgIH0KCiAgICAjIHNob3cgYWxsIHVzZXJzIHdobyBhcmUgb3duZXIgb3IgcncgaW4gdGhlIHF1ZXVlIGdyb3VwCiAgICBlbHNpZiAoICRQYXJhbXtRdWV1ZUlEfSApIHsKICAgICAgICBteSAkR0lEICAgICAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpRdWV1ZScpLT5HZXRRdWV1ZUdyb3VwSUQoIFF1ZXVlSUQgPT4gJFBhcmFte1F1ZXVlSUR9ICk7CiAgICAgICAgbXkgJU1lbWJlckxpc3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6R3JvdXAnKS0+UGVybWlzc2lvbkdyb3VwR2V0KAogICAgICAgICAgICBHcm91cElEID0+ICRHSUQsCiAgICAgICAgICAgIFR5cGUgICAgPT4gJ293bmVyJywKICAgICAgICApOwogICAgICAgIGZvciBteSAkS2V5TWVtYmVyICggc29ydCBrZXlzICVNZW1iZXJMaXN0ICkgewogICAgICAgICAgICBpZiAoICRBbGxHcm91cHNNZW1iZXJzeyRLZXlNZW1iZXJ9ICkgewogICAgICAgICAgICAgICAgJFNob3duVXNlcnN7JEtleU1lbWJlcn0gPSAkQWxsR3JvdXBzTWVtYmVyc3skS2V5TWVtYmVyfTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAjIHdvcmtmbG93CiAgICBteSAkQUNMID0gJFRpY2tldE9iamVjdC0+VGlja2V0QWNsKAogICAgICAgICVQYXJhbSwKICAgICAgICBBY3Rpb24gICAgICAgID0+ICRTZWxmLT57QWN0aW9ufSwKICAgICAgICBSZXR1cm5UeXBlICAgID0+ICdUaWNrZXQnLAogICAgICAgIFJldHVyblN1YlR5cGUgPT4gJ093bmVyJywKICAgICAgICBEYXRhICAgICAgICAgID0+IFwlU2hvd25Vc2VycywKICAgICAgICBVc2VySUQgICAgICAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICk7CgogICAgcmV0dXJuIHsgJFRpY2tldE9iamVjdC0+VGlja2V0QWNsRGF0YSgpIH0gaWYgJEFDTDsKCiAgICByZXR1cm4gXCVTaG93blVzZXJzOwp9CgpzdWIgX0dldFJlc3BvbnNpYmxlcyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgZ2V0IHVzZXJzCiAgICBteSAlU2hvd25Vc2VyczsKICAgIG15ICVBbGxHcm91cHNNZW1iZXJzID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlVzZXInKS0+VXNlckxpc3QoCiAgICAgICAgVHlwZSAgPT4gJ0xvbmcnLAogICAgICAgIFZhbGlkID0+IDEsCiAgICApOwoKICAgICMgZ2V0IHRpY2tldCBvYmplY3QKICAgIG15ICRUaWNrZXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGlja2V0Jyk7CgogICAgIyBqdXN0IHNob3cgb25seSB1c2VycyB3aXRoIHNlbGVjdGVkIGN1c3RvbSBxdWV1ZQogICAgaWYgKCAkUGFyYW17UXVldWVJRH0gJiYgISRQYXJhbXtBbGxVc2Vyc30gKSB7CiAgICAgICAgbXkgQFVzZXJJRHMgPSAkVGlja2V0T2JqZWN0LT5HZXRTdWJzY3JpYmVkVXNlcklEc0J5UXVldWVJRCglUGFyYW0pOwogICAgICAgIGZvciBteSAkS2V5R3JvdXBNZW1iZXIgKCBzb3J0IGtleXMgJUFsbEdyb3Vwc01lbWJlcnMgKSB7CiAgICAgICAgICAgIG15ICRIaXQgPSAwOwogICAgICAgICAgICBmb3IgbXkgJFVJRCAoQFVzZXJJRHMpIHsKICAgICAgICAgICAgICAgIGlmICggJFVJRCBlcSAkS2V5R3JvdXBNZW1iZXIgKSB7CiAgICAgICAgICAgICAgICAgICAgJEhpdCA9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCAhJEhpdCApIHsKICAgICAgICAgICAgICAgIGRlbGV0ZSAkQWxsR3JvdXBzTWVtYmVyc3skS2V5R3JvdXBNZW1iZXJ9OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgICMgc2hvdyBhbGwgc3lzdGVtIHVzZXJzCiAgICBpZiAoICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnVGlja2V0OjpDaGFuZ2VPd25lclRvRXZlcnlvbmUnKSApIHsKICAgICAgICAlU2hvd25Vc2VycyA9ICVBbGxHcm91cHNNZW1iZXJzOwogICAgfQoKICAgICMgc2hvdyBhbGwgdXNlcnMgd2hvIGFyZSByZXNwb25zaWJsZSBvciBydyBpbiB0aGUgcXVldWUgZ3JvdXAKICAgIGVsc2lmICggJFBhcmFte1F1ZXVlSUR9ICkgewogICAgICAgIG15ICRHSUQgICAgICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlF1ZXVlJyktPkdldFF1ZXVlR3JvdXBJRCggUXVldWVJRCA9PiAkUGFyYW17UXVldWVJRH0gKTsKICAgICAgICBteSAlTWVtYmVyTGlzdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpHcm91cCcpLT5QZXJtaXNzaW9uR3JvdXBHZXQoCiAgICAgICAgICAgIEdyb3VwSUQgPT4gJEdJRCwKICAgICAgICAgICAgVHlwZSAgICA9PiAncmVzcG9uc2libGUnLAogICAgICAgICk7CiAgICAgICAgZm9yIG15ICRLZXlNZW1iZXIgKCBzb3J0IGtleXMgJU1lbWJlckxpc3QgKSB7CiAgICAgICAgICAgIGlmICggJEFsbEdyb3Vwc01lbWJlcnN7JEtleU1lbWJlcn0gKSB7CiAgICAgICAgICAgICAgICAkU2hvd25Vc2Vyc3skS2V5TWVtYmVyfSA9ICRBbGxHcm91cHNNZW1iZXJzeyRLZXlNZW1iZXJ9OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgICMgd29ya2Zsb3cKICAgIG15ICRBQ0wgPSAkVGlja2V0T2JqZWN0LT5UaWNrZXRBY2woCiAgICAgICAgJVBhcmFtLAogICAgICAgIEFjdGlvbiAgICAgICAgPT4gJFNlbGYtPntBY3Rpb259LAogICAgICAgIFJldHVyblR5cGUgICAgPT4gJ1RpY2tldCcsCiAgICAgICAgUmV0dXJuU3ViVHlwZSA9PiAnUmVzcG9uc2libGUnLAogICAgICAgIERhdGEgICAgICAgICAgPT4gXCVTaG93blVzZXJzLAogICAgICAgIFVzZXJJRCAgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgKTsKCiAgICByZXR1cm4geyAkVGlja2V0T2JqZWN0LT5UaWNrZXRBY2xEYXRhKCkgfSBpZiAkQUNMOwoKICAgIHJldHVybiBcJVNob3duVXNlcnM7Cn0KCnN1YiBfR2V0UHJpb3JpdGllcyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgZ2V0IHByaW9yaXR5CiAgICBteSAlUHJpb3JpdGllczsKICAgIGlmICggJFBhcmFte1F1ZXVlSUR9IHx8ICRQYXJhbXtUaWNrZXRJRH0gKSB7CiAgICAgICAgJVByaW9yaXRpZXMgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGlja2V0JyktPlRpY2tldFByaW9yaXR5TGlzdCgKICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICBBY3Rpb24gPT4gJFNlbGYtPntBY3Rpb259LAogICAgICAgICAgICBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICk7CiAgICB9CiAgICByZXR1cm4gXCVQcmlvcml0aWVzOwp9CgpzdWIgX0dldFR5cGVzIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBnZXQgdHlwZQogICAgbXkgJVR5cGU7CiAgICBpZiAoICRQYXJhbXtRdWV1ZUlEfSB8fCAkUGFyYW17VGlja2V0SUR9ICkgewogICAgICAgICVUeXBlID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpY2tldCcpLT5UaWNrZXRUeXBlTGlzdCgKICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICBBY3Rpb24gPT4gJFNlbGYtPntBY3Rpb259LAogICAgICAgICAgICBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICk7CiAgICB9CiAgICByZXR1cm4gXCVUeXBlOwp9CgpzdWIgX0dldFNlcnZpY2VzIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBnZXQgc2VydmljZQogICAgbXkgJVNlcnZpY2U7CgogICAgIyBjaGVjayBuZWVkZWQKICAgIHJldHVybiBcJVNlcnZpY2UgaWYgISRQYXJhbXtRdWV1ZUlEfSAmJiAhJFBhcmFte1RpY2tldElEfTsKCiAgICAjIGdldCBvcHRpb25zIGZvciBkZWZhdWx0IHNlcnZpY2VzIGZvciB1bmtub3duIGN1c3RvbWVycwogICAgbXkgJERlZmF1bHRTZXJ2aWNlVW5rbm93bkN1c3RvbWVyCiAgICAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpLT5HZXQoJ1RpY2tldDo6U2VydmljZTo6RGVmYXVsdDo6VW5rbm93bkN1c3RvbWVyJyk7CgogICAgIyBjaGVjayBpZiBubyBDdXN0b21lclVzZXJJRCBpcyBzZWxlY3RlZAogICAgIyBpZiAkRGVmYXVsdFNlcnZpY2VVbmtub3duQ3VzdG9tZXIgPSAwIGxlYXZlIEN1c3RvbWVyVXNlcklEIGVtcHR5LCBpdCB3aWxsIG5vdCBnZXQgYW55IHNlcnZpY2VzCiAgICAjIGlmICREZWZhdWx0U2VydmljZVVua25vd25DdXN0b21lciA9IDEgc2V0IEN1c3RvbWVyVXNlcklEIHRvIGdldCBkZWZhdWx0IHNlcnZpY2VzCiAgICBpZiAoICEkUGFyYW17Q3VzdG9tZXJVc2VySUR9ICYmICREZWZhdWx0U2VydmljZVVua25vd25DdXN0b21lciApIHsKICAgICAgICAkUGFyYW17Q3VzdG9tZXJVc2VySUR9ID0gJzxERUZBVUxUPic7CiAgICB9CgogICAgIyBnZXQgc2VydmljZSBsaXN0CiAgICBpZiAoICRQYXJhbXtDdXN0b21lclVzZXJJRH0gKSB7CiAgICAgICAgJVNlcnZpY2UgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGlja2V0JyktPlRpY2tldFNlcnZpY2VMaXN0KAogICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgIEFjdGlvbiA9PiAkU2VsZi0+e0FjdGlvbn0sCiAgICAgICAgICAgIFVzZXJJRCA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgKTsKICAgIH0KICAgIHJldHVybiBcJVNlcnZpY2U7Cn0KCnN1YiBfR2V0U0xBcyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgZ2V0IHNsYQogICAgbXkgJVNMQTsKICAgIGlmICggJFBhcmFte1NlcnZpY2VJRH0gJiYgJFBhcmFte1NlcnZpY2VzfSAmJiAleyAkUGFyYW17U2VydmljZXN9IH0gKSB7CiAgICAgICAgaWYgKCAkUGFyYW17U2VydmljZXN9LT57ICRQYXJhbXtTZXJ2aWNlSUR9IH0gKSB7CiAgICAgICAgICAgICVTTEEgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGlja2V0JyktPlRpY2tldFNMQUxpc3QoCiAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICBBY3Rpb24gPT4gJFNlbGYtPntBY3Rpb259LAogICAgICAgICAgICAgICAgVXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gXCVTTEE7Cn0KCnN1YiBfR2V0VG9zIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBnZXQgY29uZmlnIG9iamVjdAogICAgbXkgJENvbmZpZ09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CgogICAgIyBjaGVjayBvd24gc2VsZWN0aW9uCiAgICBteSAlTmV3VG9zOwogICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6Ok5ld1F1ZXVlT3duU2VsZWN0aW9uJykgKSB7CiAgICAgICAgJU5ld1RvcyA9ICV7ICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpGcm9udGVuZDo6TmV3UXVldWVPd25TZWxlY3Rpb24nKSB9OwogICAgfQogICAgZWxzZSB7CgogICAgICAgICMgU2VsZWN0aW9uVHlwZSBRdWV1ZSBvciBTeXN0ZW1BZGRyZXNzPwogICAgICAgIG15ICVUb3M7CiAgICAgICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6Ok5ld1F1ZXVlU2VsZWN0aW9uVHlwZScpIGVxICdRdWV1ZScgKSB7CiAgICAgICAgICAgICVUb3MgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGlja2V0JyktPk1vdmVMaXN0KAogICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICAgICAgVHlwZSAgICA9PiAnY3JlYXRlJywKICAgICAgICAgICAgICAgIEFjdGlvbiAgPT4gJFNlbGYtPntBY3Rpb259LAogICAgICAgICAgICAgICAgUXVldWVJRCA9PiAkU2VsZi0+e1F1ZXVlSUR9LAogICAgICAgICAgICAgICAgVXNlcklEICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAlVG9zID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlN5c3RlbUFkZHJlc3MnKS0+U3lzdGVtQWRkcmVzc1F1ZXVlTGlzdCgpOwogICAgICAgIH0KCiAgICAgICAgIyBnZXQgY3JlYXRlIHBlcm1pc3Npb24gcXVldWVzCiAgICAgICAgbXkgJVVzZXJHcm91cHMgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6R3JvdXAnKS0+UGVybWlzc2lvblVzZXJHZXQoCiAgICAgICAgICAgIFVzZXJJRCA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgIFR5cGUgICA9PiAnY3JlYXRlJywKICAgICAgICApOwoKICAgICAgICBteSAkU3lzdGVtQWRkcmVzc09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpTeXN0ZW1BZGRyZXNzJyk7CiAgICAgICAgbXkgJFF1ZXVlT2JqZWN0ICAgICAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6UXVldWUnKTsKCiAgICAgICAgbXkgJE11bHRpVGVuYW5jeSA9ICRDb25maWdPYmplY3QtPkdldCgnTXVsdGlUZW5hbmN5Jyk7CiAgICAgICAgbXkgJEN1c3RvbWVyR3JvdXBPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q3VzdG9tZXJHcm91cCcpOwogICAgICAgIG15ICVDdXN0b21lclVzZXJHcm91cElEczsKICAgICAgICBpZiAoJE11bHRpVGVuYW5jeSAmJiAkUGFyYW17Q3VzdG9tZXJVc2VySUR9KSB7CiAgICAgICAgICAgICMgZ3JvdXBzIGZvciB3aGljaCBjdXN0b21lciB1c2VyIGlzIGFsbG93ZWQgdG8gY3JlYXRlIHRpY2hldHMKICAgICAgICAgICAgJUN1c3RvbWVyVXNlckdyb3VwSURzID0gJEN1c3RvbWVyR3JvdXBPYmplY3QtPkdyb3VwTWVtYmVyTGlzdCgKICAgICAgICAgICAgICAgIFVzZXJJRCAgICAgICAgID0+ICRQYXJhbXtDdXN0b21lclVzZXJJRH0sCiAgICAgICAgICAgICAgICBUeXBlICAgICAgICAgICA9PiAncncnLAogICAgICAgICAgICAgICAgUmVzdWx0ICAgICAgICAgPT4gJ0hBU0gnLAogICAgICAgICAgICAgICAgUmF3UGVybWlzc2lvbnMgPT4gMCwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgYnVpbGQgc2VsZWN0aW9uIHN0cmluZwogICAgICAgIFFVRVVFSUQ6CiAgICAgICAgZm9yIG15ICRRdWV1ZUlEICggc29ydCBrZXlzICVUb3MgKSB7CgogICAgICAgICAgICBteSAlUXVldWVEYXRhID0gJFF1ZXVlT2JqZWN0LT5RdWV1ZUdldCggSUQgPT4gJFF1ZXVlSUQgKTsKCiAgICAgICAgICAgICMgcGVybWlzc2lvbiBjaGVjaywgY2FuIHdlIGNyZWF0ZSBuZXcgdGlja2V0cyBpbiBxdWV1ZQogICAgICAgICAgICBuZXh0IFFVRVVFSUQgaWYgISRVc2VyR3JvdXBzeyAkUXVldWVEYXRhe0dyb3VwSUR9IH07CgogICAgICAgICAgICBpZiAoJE11bHRpVGVuYW5jeSAmJiAkUGFyYW17Q3VzdG9tZXJVc2VySUR9KSB7CiAgICAgICAgICAgICAgICAjIGNoZWNrIGN1c3RvbWVyIHVzZXIgZ3JvdXAgbWVtZWJlcnNoaXAKICAgICAgICAgICAgICAgIG5leHQgUVVFVUVJRCBpZiAhJEN1c3RvbWVyVXNlckdyb3VwSURzeyRRdWV1ZURhdGF7R3JvdXBJRH19OwogICAgICAgICAgICB9CgogICAgICAgICAgICBteSAkU3RyaW5nID0gJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpOZXdRdWV1ZVNlbGVjdGlvblN0cmluZycpCiAgICAgICAgICAgICAgICB8fCAnPFJlYWxuYW1lPiA8PEVtYWlsPj4gLSBRdWV1ZTogPFF1ZXVlPic7CiAgICAgICAgICAgICRTdHJpbmcgPX4gcy88UXVldWU+LyRRdWV1ZURhdGF7TmFtZX0vZzsKICAgICAgICAgICAgJFN0cmluZyA9fiBzLzxRdWV1ZUNvbW1lbnQ+LyRRdWV1ZURhdGF7Q29tbWVudH0vZzsKCiAgICAgICAgICAgICMgcmVtb3ZlIHRyYWlsaW5nIHNwYWNlcwogICAgICAgICAgICBpZiAoICEkUXVldWVEYXRhe0NvbW1lbnR9ICkgewogICAgICAgICAgICAgICAgJFN0cmluZyA9fiBze1xzK1x6fXt9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpGcm9udGVuZDo6TmV3UXVldWVTZWxlY3Rpb25UeXBlJykgbmUgJ1F1ZXVlJyApIHsKICAgICAgICAgICAgICAgIG15ICVTeXN0ZW1BZGRyZXNzRGF0YSA9ICRTeXN0ZW1BZGRyZXNzT2JqZWN0LT5TeXN0ZW1BZGRyZXNzR2V0KAogICAgICAgICAgICAgICAgICAgIElEID0+ICRUb3N7JFF1ZXVlSUR9LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICRTdHJpbmcgPX4gcy88UmVhbG5hbWU+LyRTeXN0ZW1BZGRyZXNzRGF0YXtSZWFsbmFtZX0vZzsKICAgICAgICAgICAgICAgICRTdHJpbmcgPX4gcy88RW1haWw+LyRTeXN0ZW1BZGRyZXNzRGF0YXtOYW1lfS9nOwogICAgICAgICAgICB9CiAgICAgICAgICAgICROZXdUb3N7JFF1ZXVlSUR9ID0gJFN0cmluZzsKICAgICAgICB9CiAgICB9CgogICAgIyBhZGQgZW1wdHkgc2VsZWN0aW9uCiAgICAkTmV3VG9zeycnfSA9ICctJzsKICAgIHJldHVybiBcJU5ld1RvczsKfQoKc3ViIF9HZXRUaW1lVW5pdHMgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkQWNjb3VudGVkVGltZSA9ICcnOwoKICAgICMgR2V0IGFjY291bnRlZCB0aW1lIGlmIEFjY291bnRUaW1lIGNvbmZpZyBpdGVtIGlzIGVuYWJsZWQuCiAgICBpZiAoICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnVGlja2V0OjpGcm9udGVuZDo6QWNjb3VudFRpbWUnKSAmJiBkZWZpbmVkICRQYXJhbXtBcnRpY2xlSUR9ICkgewogICAgICAgICRBY2NvdW50ZWRUaW1lID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpY2tldDo6QXJ0aWNsZScpLT5BcnRpY2xlQWNjb3VudGVkVGltZUdldCgKICAgICAgICAgICAgQXJ0aWNsZUlEID0+ICRQYXJhbXtBcnRpY2xlSUR9LAogICAgICAgICk7CiAgICB9CgogICAgcmV0dXJuICRBY2NvdW50ZWRUaW1lID8gJEFjY291bnRlZFRpbWUgOiAnJzsKfQoKc3ViIF9HZXRTdGFuZGFyZFRlbXBsYXRlcyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICVUZW1wbGF0ZXM7CiAgICBteSAkUXVldWVJRCA9ICRQYXJhbXtRdWV1ZUlEfSB8fCAnJzsKCiAgICBteSAkQ29uZmlnT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKTsKICAgIG15ICRRdWV1ZU9iamVjdCAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6UXVldWUnKTsKCiAgICBpZiAoICEkUXVldWVJRCApIHsKICAgICAgICBteSAkVXNlckRlZmF1bHRRdWV1ZSA9ICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpGcm9udGVuZDo6VXNlckRlZmF1bHRRdWV1ZScpIHx8ICcnOwoKICAgICAgICBpZiAoJFVzZXJEZWZhdWx0UXVldWUpIHsKICAgICAgICAgICAgJFF1ZXVlSUQgPSAkUXVldWVPYmplY3QtPlF1ZXVlTG9va3VwKCBRdWV1ZSA9PiAkVXNlckRlZmF1bHRRdWV1ZSApOwogICAgICAgIH0KICAgIH0KCiAgICAjIGNoZWNrIG5lZWRlZAogICAgcmV0dXJuIFwlVGVtcGxhdGVzIGlmICEkUXVldWVJRCAmJiAhJFBhcmFte1RpY2tldElEfTsKCiAgICBpZiAoICEkUXVldWVJRCAmJiAkUGFyYW17VGlja2V0SUR9ICkgewoKICAgICAgICAjIGdldCBRdWV1ZUlEIGZyb20gdGhlIHRpY2tldAogICAgICAgIG15ICVUaWNrZXQgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGlja2V0JyktPlRpY2tldEdldCgKICAgICAgICAgICAgVGlja2V0SUQgICAgICA9PiAkUGFyYW17VGlja2V0SUR9LAogICAgICAgICAgICBEeW5hbWljRmllbGRzID0+IDAsCiAgICAgICAgICAgIFVzZXJJRCAgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICk7CiAgICAgICAgJFF1ZXVlSUQgPSAkVGlja2V0e1F1ZXVlSUR9IHx8ICcnOwogICAgfQoKICAgICMgZmV0Y2ggYWxsIHN0ZC4gdGVtcGxhdGVzCiAgICBteSAlU3RhbmRhcmRUZW1wbGF0ZXMgPSAkUXVldWVPYmplY3QtPlF1ZXVlU3RhbmRhcmRUZW1wbGF0ZU1lbWJlckxpc3QoCiAgICAgICAgUXVldWVJRCAgICAgICA9PiAkUXVldWVJRCwKICAgICAgICBUZW1wbGF0ZVR5cGVzID0+IDEsCiAgICApOwoKICAgICMgcmV0dXJuIGVtcHR5IGhhc2ggaWYgdGhlcmUgYXJlIG5vIHRlbXBsYXRlcyBmb3IgdGhpcyBzY3JlZW4KICAgIHJldHVybiBcJVRlbXBsYXRlcyBpZiAhSXNIYXNoUmVmV2l0aERhdGEoICRTdGFuZGFyZFRlbXBsYXRlc3tDcmVhdGV9ICk7CgogICAgIyByZXR1cm4ganVzdCB0aGUgdGVtcGxhdGVzIGZvciB0aGlzIHNjcmVlbgogICAgcmV0dXJuICRTdGFuZGFyZFRlbXBsYXRlc3tDcmVhdGV9Owp9CgpzdWIgX01hc2tQaG9uZU5ldyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICRQYXJhbXtGb3JtSUR9ID0gJFNlbGYtPntGb3JtSUR9OwoKICAgICMgZ2V0IGNvbmZpZyBvYmplY3QKICAgIG15ICRDb25maWdPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpOwoKICAgICMgZ2V0IGxpc3QgdHlwZQogICAgbXkgJFRyZWVWaWV3ID0gMDsKICAgIGlmICggJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpMaXN0VHlwZScpIGVxICd0cmVlJyApIHsKICAgICAgICAkVHJlZVZpZXcgPSAxOwogICAgfQoKICAgICMgZ2V0IGxheW91dCBvYmplY3QKICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgIyBzZXQgSlMgZGF0YQogICAgJExheW91dE9iamVjdC0+QWRkSlNEYXRhKAogICAgICAgIEtleSAgID0+ICdDdXN0b21lclNlYXJjaCcsCiAgICAgICAgVmFsdWUgPT4gewogICAgICAgICAgICBTaG93Q3VzdG9tZXJUaWNrZXRzID0+ICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpGcm9udGVuZDo6U2hvd0N1c3RvbWVyVGlja2V0cycpLAogICAgICAgICAgICBBbGxvd011bHRpcGxlRnJvbSAgID0+ICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpGcm9udGVuZDo6QWdlbnRUaWNrZXRQaG9uZTo6QWxsb3dNdWx0aXBsZUZyb20nKSwKICAgICAgICB9LAogICAgKTsKCiAgICAjIGJ1aWxkIHN0cmluZwogICAgJFBhcmFte09wdGlvblN0cmd9ID0gJExheW91dE9iamVjdC0+QnVpbGRTZWxlY3Rpb24oCiAgICAgICAgRGF0YSAgICAgICAgID0+ICRQYXJhbXtVc2Vyc30sCiAgICAgICAgU2VsZWN0ZWRJRCAgID0+ICRQYXJhbXtVc2VyU2VsZWN0ZWR9LAogICAgICAgIENsYXNzICAgICAgICA9PiAnTW9kZXJuaXplJywKICAgICAgICBUcmFuc2xhdGlvbiAgPT4gMCwKICAgICAgICBOYW1lICAgICAgICAgPT4gJ05ld1VzZXJJRCcsCiAgICAgICAgUG9zc2libGVOb25lID0+IDEsCiAgICApOwoKICAgIG15ICRDb25maWcgPSAkQ29uZmlnT2JqZWN0LT5HZXQoIlRpY2tldDo6RnJvbnRlbmQ6OiRTZWxmLT57QWN0aW9ufSIpOwoKICAgICMgYnVpbGQgbmV4dCBzdGF0ZXMgc3RyaW5nCiAgICAkUGFyYW17TmV4dFN0YXRlc1N0cmd9ID0gJExheW91dE9iamVjdC0+QnVpbGRTZWxlY3Rpb24oCiAgICAgICAgRGF0YSAgICAgICAgICA9PiAkUGFyYW17TmV4dFN0YXRlc30sCiAgICAgICAgTmFtZSAgICAgICAgICA9PiAnTmV4dFN0YXRlSUQnLAogICAgICAgIENsYXNzICAgICAgICAgPT4gJ01vZGVybml6ZScsCiAgICAgICAgVHJhbnNsYXRpb24gICA9PiAxLAogICAgICAgIFNlbGVjdGVkVmFsdWUgPT4gJFBhcmFte05leHRTdGF0ZX0gfHwgJENvbmZpZy0+e1N0YXRlRGVmYXVsdH0sCiAgICApOwoKICAgICMgYnVpbGQgdG8gc3RyaW5nCiAgICBteSAlTmV3VG87CiAgICBpZiAoICRQYXJhbXtUb30gKSB7CiAgICAgICAgZm9yIG15ICRLZXlUbyAoIHNvcnQga2V5cyAleyAkUGFyYW17VG99IH0gKSB7CiAgICAgICAgICAgICROZXdUb3siJEtleVRvfHwkUGFyYW17VG99LT57JEtleVRvfSJ9ID0gJFBhcmFte1RvfS0+eyRLZXlUb307CiAgICAgICAgfQogICAgfQogICAgaWYgKCAhJFBhcmFte1RvU2VsZWN0ZWR9ICkgewogICAgICAgIG15ICRVc2VyRGVmYXVsdFF1ZXVlID0gJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpVc2VyRGVmYXVsdFF1ZXVlJykgfHwgJyc7CgogICAgICAgIGlmICgkVXNlckRlZmF1bHRRdWV1ZSkgewogICAgICAgICAgICBteSAkUXVldWVJRCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpRdWV1ZScpLT5RdWV1ZUxvb2t1cCggUXVldWUgPT4gJFVzZXJEZWZhdWx0UXVldWUgKTsKICAgICAgICAgICAgaWYgKCRRdWV1ZUlEKSB7CiAgICAgICAgICAgICAgICAkUGFyYW17VG9TZWxlY3RlZH0gPSAiJFF1ZXVlSUR8fCRVc2VyRGVmYXVsdFF1ZXVlIjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGlmICggJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpOZXdRdWV1ZVNlbGVjdGlvblR5cGUnKSBlcSAnUXVldWUnICkgewogICAgICAgICRQYXJhbXtUb1N0cmd9ID0gJExheW91dE9iamVjdC0+QWdlbnRRdWV1ZUxpc3RPcHRpb24oCiAgICAgICAgICAgIENsYXNzICAgICAgICAgID0+ICdWYWxpZGF0ZV9SZXF1aXJlZCBNb2Rlcm5pemUnLAogICAgICAgICAgICBEYXRhICAgICAgICAgICA9PiBcJU5ld1RvLAogICAgICAgICAgICBNdWx0aXBsZSAgICAgICA9PiAwLAogICAgICAgICAgICBTaXplICAgICAgICAgICA9PiAwLAogICAgICAgICAgICBOYW1lICAgICAgICAgICA9PiAnRGVzdCcsCiAgICAgICAgICAgIFRyZWVWaWV3ICAgICAgID0+ICRUcmVlVmlldywKICAgICAgICAgICAgU2VsZWN0ZWRJRCAgICAgPT4gJFBhcmFte1RvU2VsZWN0ZWR9LAogICAgICAgICAgICBPbkNoYW5nZVN1Ym1pdCA9PiAwLAogICAgICAgICk7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkUGFyYW17VG9TdHJnfSA9ICRMYXlvdXRPYmplY3QtPkJ1aWxkU2VsZWN0aW9uKAogICAgICAgICAgICBDbGFzcyAgICAgICA9PiAnVmFsaWRhdGVfUmVxdWlyZWQgTW9kZXJuaXplJywKICAgICAgICAgICAgRGF0YSAgICAgICAgPT4gXCVOZXdUbywKICAgICAgICAgICAgTmFtZSAgICAgICAgPT4gJ0Rlc3QnLAogICAgICAgICAgICBUcmVlVmlldyAgICA9PiAkVHJlZVZpZXcsCiAgICAgICAgICAgIFNlbGVjdGVkSUQgID0+ICRQYXJhbXtUb1NlbGVjdGVkfSwKICAgICAgICAgICAgVHJhbnNsYXRpb24gPT4gMCwKICAgICAgICApOwogICAgfQoKICAgICMgY3VzdG9tZXIgaW5mbyBzdHJpbmcKICAgIGlmICggJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpDdXN0b21lckluZm9Db21wb3NlJykgKSB7CiAgICAgICAgJFBhcmFte0N1c3RvbWVyVGFibGV9ID0gJExheW91dE9iamVjdC0+QWdlbnRDdXN0b21lclZpZXdUYWJsZSgKICAgICAgICAgICAgRGF0YSA9PiAkUGFyYW17Q3VzdG9tZXJEYXRhfSwKICAgICAgICAgICAgTWF4ICA9PiAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6OkN1c3RvbWVySW5mb0NvbXBvc2VNYXhTaXplJyksCiAgICAgICAgKTsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnQ3VzdG9tZXJUYWJsZScsCiAgICAgICAgICAgIERhdGEgPT4gXCVQYXJhbSwKICAgICAgICApOwogICAgfQoKICAgICMgcHJlcGFyZSBlcnJvcnMhCiAgICBpZiAoICRQYXJhbXtFcnJvcnN9ICkgewogICAgICAgIGZvciBteSAkS2V5RXJyb3IgKCBzb3J0IGtleXMgJXsgJFBhcmFte0Vycm9yc30gfSApIHsKICAgICAgICAgICAgJFBhcmFteyRLZXlFcnJvcn0gPSAnKiAnIC4gJExheW91dE9iamVjdC0+QXNjaWkySHRtbCggVGV4dCA9PiAkUGFyYW17RXJyb3JzfS0+eyRLZXlFcnJvcn0gKTsKICAgICAgICB9CiAgICB9CgogICAgIyBGcm9tIGV4dGVybmFsCiAgICBteSAkU2hvd0Vycm9ycyA9IDE7CiAgICBpZiAoCiAgICAgICAgZGVmaW5lZCAkUGFyYW17RnJvbUV4dGVybmFsQ3VzdG9tZXJ9ICYmCiAgICAgICAgZGVmaW5lZCAkUGFyYW17RnJvbUV4dGVybmFsQ3VzdG9tZXJ9LT57RW1haWx9ICYmCiAgICAgICAgZGVmaW5lZCAkUGFyYW17RnJvbUV4dGVybmFsQ3VzdG9tZXJ9LT57Q3VzdG9tZXJ9CiAgICAgICAgKQogICAgewogICAgICAgICRTaG93RXJyb3JzID0gMDsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5BZGRKU0RhdGEoCiAgICAgICAgICAgIEtleSAgID0+ICdGcm9tRXh0ZXJuYWxDdXN0b21lck5hbWUnLAogICAgICAgICAgICBWYWx1ZSA9PiAkUGFyYW17RnJvbUV4dGVybmFsQ3VzdG9tZXJ9LT57Q3VzdG9tZXJ9LAogICAgICAgICk7CiAgICAgICAgJExheW91dE9iamVjdC0+QWRkSlNEYXRhKAogICAgICAgICAgICBLZXkgICA9PiAnRnJvbUV4dGVybmFsQ3VzdG9tZXJFbWFpbCcsCiAgICAgICAgICAgIFZhbHVlID0+ICRQYXJhbXtGcm9tRXh0ZXJuYWxDdXN0b21lcn0tPntFbWFpbH0sCiAgICAgICAgKTsKICAgIH0KICAgIG15ICRDdXN0b21lckNvdW50ZXIgPSAwOwogICAgaWYgKCAkUGFyYW17TXVsdGlwbGVDdXN0b21lcn0gKSB7CiAgICAgICAgZm9yIG15ICRJdGVtICggQHsgJFBhcmFte011bHRpcGxlQ3VzdG9tZXJ9IH0gKSB7CiAgICAgICAgICAgIGlmICggISRTaG93RXJyb3JzICkgewoKICAgICAgICAgICAgICAgICMgc2V0IGVtcHR5IHZhbHVlcyBmb3IgZXJyb3JzCiAgICAgICAgICAgICAgICAkSXRlbS0+e0N1c3RvbWVyRXJyb3J9ICAgID0gJyc7CiAgICAgICAgICAgICAgICAkSXRlbS0+e0N1c3RvbWVyRGlzYWJsZWR9ID0gJyc7CiAgICAgICAgICAgICAgICAkSXRlbS0+e0N1c3RvbWVyRXJyb3JNc2d9ID0gJ0N1c3RvbWVyR2VuZXJpY1NlcnZlckVycm9yTXNnJzsKICAgICAgICAgICAgfQogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ011bHRpcGxlQ3VzdG9tZXInLAogICAgICAgICAgICAgICAgRGF0YSA9PiAkSXRlbSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICRJdGVtLT57Q3VzdG9tZXJFcnJvck1zZ30sCiAgICAgICAgICAgICAgICBEYXRhID0+ICRJdGVtLAogICAgICAgICAgICApOwogICAgICAgICAgICBpZiAoICRJdGVtLT57Q3VzdG9tZXJFcnJvcn0gKSB7CiAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICdDdXN0b21lckVycm9yRXhwbGFudGlvbicsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRDdXN0b21lckNvdW50ZXIrKzsKICAgICAgICB9CiAgICB9CgogICAgaWYgKCAhJEN1c3RvbWVyQ291bnRlciApIHsKICAgICAgICAkUGFyYW17Q3VzdG9tZXJIaWRkZW5Db250YWluZXJ9ID0gJ0hpZGRlbic7CiAgICB9CgogICAgIyBzZXQgY3VzdG9tZXIgY291bnRlcgogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAnTXVsdGlwbGVDdXN0b21lckNvdW50ZXInLAogICAgICAgIERhdGEgPT4gewogICAgICAgICAgICBDdXN0b21lckNvdW50ZXIgPT4gJEN1c3RvbWVyQ291bnRlcisrLAogICAgICAgIH0sCiAgICApOwoKICAgIGlmICggJFBhcmFte0Zyb21JbnZhbGlkfSAmJiAkUGFyYW17RXJyb3JzfSAmJiAhJFBhcmFte0Vycm9yc30tPntGcm9tRXJyb3JUeXBlfSApIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jayggTmFtZSA9PiAnRnJvbVNlcnZlckVycm9yTXNnJyApOwogICAgfQogICAgaWYgKCAkUGFyYW17RXJyb3JzfS0+e0Zyb21FcnJvclR5cGV9IHx8ICEkU2hvd0Vycm9ycyApIHsKICAgICAgICAkUGFyYW17RnJvbUludmFsaWR9ID0gJyc7CiAgICB9CgogICAgbXkgJER5bmFtaWNGaWVsZE5hbWVzID0gJFNlbGYtPl9HZXRGaWVsZHNUb1VwZGF0ZSgKICAgICAgICBPbmx5RHluYW1pY0ZpZWxkcyA9PiAxCiAgICApOwoKICAgICMgc2VuZCBkYXRhIHRvIEpTCiAgICAkTGF5b3V0T2JqZWN0LT5BZGRKU0RhdGEoCiAgICAgICAgS2V5ICAgPT4gJ0R5bmFtaWNGaWVsZE5hbWVzJywKICAgICAgICBWYWx1ZSA9PiAkRHluYW1pY0ZpZWxkTmFtZXMsCiAgICApOwoKICAgICMgYnVpbGQgdHlwZSBzdHJpbmcKICAgIGlmICggJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OlR5cGUnKSApIHsKICAgICAgICAkUGFyYW17VHlwZVN0cmd9ID0gJExheW91dE9iamVjdC0+QnVpbGRTZWxlY3Rpb24oCiAgICAgICAgICAgIENsYXNzICAgICAgICA9PiAnTW9kZXJuaXplIFZhbGlkYXRlX1JlcXVpcmVkJyAuICggJFBhcmFte0Vycm9yc30tPntUeXBlSURJbnZhbGlkfSB8fCAnICcgKSwKICAgICAgICAgICAgRGF0YSAgICAgICAgID0+ICRQYXJhbXtUeXBlc30sCiAgICAgICAgICAgIE5hbWUgICAgICAgICA9PiAnVHlwZUlEJywKICAgICAgICAgICAgU2VsZWN0ZWRJRCAgID0+ICRQYXJhbXtUeXBlSUR9LAogICAgICAgICAgICBQb3NzaWJsZU5vbmUgPT4gMSwKICAgICAgICAgICAgU29ydCAgICAgICAgID0+ICdBbHBoYW51bWVyaWNWYWx1ZScsCiAgICAgICAgICAgIFRyYW5zbGF0aW9uICA9PiAwLAogICAgICAgICk7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ1RpY2tldFR5cGUnLAogICAgICAgICAgICBEYXRhID0+IHslUGFyYW19LAogICAgICAgICk7CiAgICB9CgogICAgIyBidWlsZCBzZXJ2aWNlIHN0cmluZwogICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6U2VydmljZScpICkgewoKICAgICAgICAkUGFyYW17U2VydmljZVN0cmd9ID0gJExheW91dE9iamVjdC0+QnVpbGRTZWxlY3Rpb24oCiAgICAgICAgICAgIERhdGEgID0+ICRQYXJhbXtTZXJ2aWNlc30sCiAgICAgICAgICAgIE5hbWUgID0+ICdTZXJ2aWNlSUQnLAogICAgICAgICAgICBDbGFzcyA9PiAnTW9kZXJuaXplICcKICAgICAgICAgICAgICAgIC4gKCAkQ29uZmlnLT57U2VydmljZU1hbmRhdG9yeX0gPyAnVmFsaWRhdGVfUmVxdWlyZWQgJyA6ICcnICkKICAgICAgICAgICAgICAgIC4gKCAkUGFyYW17RXJyb3JzfS0+e1NlcnZpY2VJREludmFsaWR9IHx8ICcnICksCiAgICAgICAgICAgIFNlbGVjdGVkSUQgICA9PiAkUGFyYW17U2VydmljZUlEfSwKICAgICAgICAgICAgUG9zc2libGVOb25lID0+IDEsCiAgICAgICAgICAgIFRyZWVWaWV3ICAgICA9PiAkVHJlZVZpZXcsCiAgICAgICAgICAgIFNvcnQgICAgICAgICA9PiAnVHJlZVZpZXcnLAogICAgICAgICAgICBUcmFuc2xhdGlvbiAgPT4gMCwKICAgICAgICAgICAgTWF4ICAgICAgICAgID0+IDIwMCwKICAgICAgICApOwogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdUaWNrZXRTZXJ2aWNlJywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBTZXJ2aWNlTWFuZGF0b3J5ID0+ICRDb25maWctPntTZXJ2aWNlTWFuZGF0b3J5fSB8fCAwLAogICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICB9LAogICAgICAgICk7CgogICAgICAgICRQYXJhbXtTTEFTdHJnfSA9ICRMYXlvdXRPYmplY3QtPkJ1aWxkU2VsZWN0aW9uKAogICAgICAgICAgICBEYXRhICAgICAgID0+ICRQYXJhbXtTTEFzfSwKICAgICAgICAgICAgTmFtZSAgICAgICA9PiAnU0xBSUQnLAogICAgICAgICAgICBTZWxlY3RlZElEID0+ICRQYXJhbXtTTEFJRH0sCiAgICAgICAgICAgIENsYXNzICAgICAgPT4gJ01vZGVybml6ZSAnCiAgICAgICAgICAgICAgICAuICggJENvbmZpZy0+e1NMQU1hbmRhdG9yeX0gPyAnVmFsaWRhdGVfUmVxdWlyZWQgJyA6ICcnICkKICAgICAgICAgICAgICAgIC4gKCAkUGFyYW17RXJyb3JzfS0+e1NMQUludmFsaWR9IHx8ICcnICksCiAgICAgICAgICAgIFBvc3NpYmxlTm9uZSA9PiAxLAogICAgICAgICAgICBTb3J0ICAgICAgICAgPT4gJ0FscGhhbnVtZXJpY1ZhbHVlJywKICAgICAgICAgICAgVHJhbnNsYXRpb24gID0+IDAsCiAgICAgICAgICAgIE1heCAgICAgICAgICA9PiAyMDAsCiAgICAgICAgKTsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnVGlja2V0U0xBJywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBTTEFNYW5kYXRvcnkgPT4gJENvbmZpZy0+e1NMQU1hbmRhdG9yeX0gfHwgMCwKICAgICAgICAgICAgICAgICVQYXJhbQogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICB9CgogICAgIyBjaGVjayBpZiBleGlzdHMgY3JlYXRlIHRlbXBsYXRlcyByZWdhcmRsZXNzIHRoZSBxdWV1ZQogICAgbXkgJVN0YW5kYXJkVGVtcGxhdGVzID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlN0YW5kYXJkVGVtcGxhdGUnKS0+U3RhbmRhcmRUZW1wbGF0ZUxpc3QoCiAgICAgICAgVmFsaWQgPT4gMSwKICAgICAgICBUeXBlICA9PiAnQ3JlYXRlJywKICAgICk7CgogICAgIyBidWlsZCB0ZXh0IHRlbXBsYXRlIHN0cmluZwogICAgaWYgKCBJc0hhc2hSZWZXaXRoRGF0YSggXCVTdGFuZGFyZFRlbXBsYXRlcyApICkgewogICAgICAgICRQYXJhbXtTdGFuZGFyZFRlbXBsYXRlU3RyZ30gPSAkTGF5b3V0T2JqZWN0LT5CdWlsZFNlbGVjdGlvbigKICAgICAgICAgICAgRGF0YSAgICAgICAgID0+ICRQYXJhbXtTdGFuZGFyZFRlbXBsYXRlc30gfHwge30sCiAgICAgICAgICAgIE5hbWUgICAgICAgICA9PiAnU3RhbmRhcmRUZW1wbGF0ZUlEJywKICAgICAgICAgICAgU2VsZWN0ZWRJRCAgID0+ICRQYXJhbXtTdGFuZGFyZFRlbXBsYXRlSUR9IHx8ICcnLAogICAgICAgICAgICBDbGFzcyAgICAgICAgPT4gJ01vZGVybml6ZScsCiAgICAgICAgICAgIFBvc3NpYmxlTm9uZSA9PiAxLAogICAgICAgICAgICBTb3J0ICAgICAgICAgPT4gJ0FscGhhbnVtZXJpY1ZhbHVlJywKICAgICAgICAgICAgVHJhbnNsYXRpb24gID0+IDEsCiAgICAgICAgICAgIE1heCAgICAgICAgICA9PiAyMDAsCiAgICAgICAgKTsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnU3RhbmRhcmRUZW1wbGF0ZScsCiAgICAgICAgICAgIERhdGEgPT4geyVQYXJhbX0sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGJ1aWxkIHByaW9yaXR5IHN0cmluZwogICAgaWYgKCAhJFBhcmFte1ByaW9yaXR5SUR9ICkgewogICAgICAgICRQYXJhbXtQcmlvcml0eX0gPSAkQ29uZmlnLT57UHJpb3JpdHl9OwogICAgfQogICAgJFBhcmFte1ByaW9yaXR5U3RyZ30gPSAkTGF5b3V0T2JqZWN0LT5CdWlsZFNlbGVjdGlvbigKICAgICAgICBEYXRhICAgICAgICAgID0+ICRQYXJhbXtQcmlvcml0aWVzfSwKICAgICAgICBOYW1lICAgICAgICAgID0+ICdQcmlvcml0eUlEJywKICAgICAgICBTZWxlY3RlZElEICAgID0+ICRQYXJhbXtQcmlvcml0eUlEfSwKICAgICAgICBTZWxlY3RlZFZhbHVlID0+ICRQYXJhbXtQcmlvcml0eX0sCiAgICAgICAgQ2xhc3MgICAgICAgICA9PiAnTW9kZXJuaXplJywKICAgICAgICBUcmFuc2xhdGlvbiAgID0+IDEsCiAgICApOwoKICAgICMgcGVuZGluZyBkYXRhIHN0cmluZwogICAgJFBhcmFte1BlbmRpbmdEYXRlU3RyaW5nfSA9ICRMYXlvdXRPYmplY3QtPkJ1aWxkRGF0ZVNlbGVjdGlvbigKICAgICAgICAlUGFyYW0sCiAgICAgICAgRm9ybWF0ICAgICAgICAgICAgICAgPT4gJ0RhdGVJbnB1dEZvcm1hdExvbmcnLAogICAgICAgIFllYXJQZXJpb2RQYXN0ICAgICAgID0+IDAsCiAgICAgICAgWWVhclBlcmlvZEZ1dHVyZSAgICAgPT4gNSwKICAgICAgICBEaWZmVGltZSAgICAgICAgICAgICA9PiAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6OlBlbmRpbmdEaWZmVGltZScpIHx8IDAsCiAgICAgICAgQ2xhc3MgICAgICAgICAgICAgICAgPT4gJFBhcmFte0Vycm9yc30tPntEYXRlSW52YWxpZH0sCiAgICAgICAgVmFsaWRhdGUgICAgICAgICAgICAgPT4gMSwKICAgICAgICBWYWxpZGF0ZURhdGVJbkZ1dHVyZSA9PiAxLAogICAgKTsKCiAgICAjIHNob3cgb3duZXIgc2VsZWN0aW9uCiAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpGcm9udGVuZDo6TmV3T3duZXJTZWxlY3Rpb24nKSApIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnT3duZXJTZWxlY3Rpb24nLAogICAgICAgICAgICBEYXRhID0+IFwlUGFyYW0sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIHNob3cgcmVzcG9uc2libGUgc2VsZWN0aW9uCiAgICBpZiAoCiAgICAgICAgJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OlJlc3BvbnNpYmxlJykKICAgICAgICAmJiAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6Ok5ld1Jlc3BvbnNpYmxlU2VsZWN0aW9uJykKICAgICAgICApCiAgICB7CiAgICAgICAgJFBhcmFte1Jlc3BvbnNpYmxlVXNlcnN9LT57Jyd9ID0gJy0nOwogICAgICAgICRQYXJhbXtSZXNwb25zaWJsZU9wdGlvblN0cmd9ID0gJExheW91dE9iamVjdC0+QnVpbGRTZWxlY3Rpb24oCiAgICAgICAgICAgIERhdGEgICAgICAgPT4gJFBhcmFte1Jlc3BvbnNpYmxlVXNlcnN9LAogICAgICAgICAgICBTZWxlY3RlZElEID0+ICRQYXJhbXtSZXNwb25zaWJsZVVzZXJTZWxlY3RlZH0sCiAgICAgICAgICAgIE5hbWUgICAgICAgPT4gJ05ld1Jlc3BvbnNpYmxlSUQnLAogICAgICAgICAgICBDbGFzcyAgICAgID0+ICdNb2Rlcm5pemUnLAogICAgICAgICk7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ1Jlc3BvbnNpYmxlU2VsZWN0aW9uJywKICAgICAgICAgICAgRGF0YSA9PiBcJVBhcmFtLAogICAgICAgICk7CiAgICB9CgogICAgIyBEeW5hbWljIGZpZWxkcwogICAgIyBjeWNsZSB0cm91Z2ggdGhlIGFjdGl2YXRlZCBEeW5hbWljIEZpZWxkcyBmb3IgdGhpcyBzY3JlZW4KICAgIERZTkFNSUNGSUVMRDoKICAgIGZvciBteSAkRHluYW1pY0ZpZWxkQ29uZmlnICggQHsgJFNlbGYtPntEeW5hbWljRmllbGR9IH0gKSB7CiAgICAgICAgbmV4dCBEWU5BTUlDRklFTEQgaWYgIUlzSGFzaFJlZldpdGhEYXRhKCREeW5hbWljRmllbGRDb25maWcpOwoKICAgICAgICAjIHNraXAgZmllbGRzIHRoYXQgSFRNTCBjb3VsZCBub3QgYmUgcmV0cmlldmVkCiAgICAgICAgbmV4dCBEWU5BTUlDRklFTEQgaWYgIUlzSGFzaFJlZldpdGhEYXRhKAogICAgICAgICAgICAkUGFyYW17RHluYW1pY0ZpZWxkSFRNTH0tPnsgJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9IH0KICAgICAgICApOwoKICAgICAgICAjIGdldCB0aGUgaHRtbCBzdHJpbmdzIGZvcm0gJFBhcmFtCiAgICAgICAgbXkgJER5bmFtaWNGaWVsZEhUTUwgPSAkUGFyYW17RHluYW1pY0ZpZWxkSFRNTH0tPnsgJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9IH07CgogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdEeW5hbWljRmllbGQnLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgIE5hbWUgID0+ICREeW5hbWljRmllbGRDb25maWctPntOYW1lfSwKICAgICAgICAgICAgICAgIExhYmVsID0+ICREeW5hbWljRmllbGRIVE1MLT57TGFiZWx9LAogICAgICAgICAgICAgICAgRmllbGQgPT4gJER5bmFtaWNGaWVsZEhUTUwtPntGaWVsZH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKCiAgICAgICAgIyBleGFtcGxlIG9mIGR5bmFtaWMgZmllbGRzIG9yZGVyIGN1c3RvbWl6YXRpb24KICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnRHluYW1pY0ZpZWxkXycgLiAkRHluYW1pY0ZpZWxkQ29uZmlnLT57TmFtZX0sCiAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgTmFtZSAgPT4gJER5bmFtaWNGaWVsZENvbmZpZy0+e05hbWV9LAogICAgICAgICAgICAgICAgTGFiZWwgPT4gJER5bmFtaWNGaWVsZEhUTUwtPntMYWJlbH0sCiAgICAgICAgICAgICAgICBGaWVsZCA9PiAkRHluYW1pY0ZpZWxkSFRNTC0+e0ZpZWxkfSwKICAgICAgICAgICAgfSwKICAgICAgICApOwogICAgfQoKICAgICMgc2hvdyB0aW1lIGFjY291bnRpbmcgYm94CiAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpGcm9udGVuZDo6QWNjb3VudFRpbWUnKSApIHsKICAgICAgICAkUGFyYW17VGltZVVuaXRzQmxvY2t9ID0gJExheW91dE9iamVjdC0+VGltZVVuaXRzKAogICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgKTsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnVGltZVVuaXRzJywKICAgICAgICAgICAgRGF0YSA9PiBcJVBhcmFtLAogICAgICAgICk7CiAgICB9CgogICAgIyBzaG93IGN1c3RvbWVyIGVkaXQgbGluawogICAgbXkgJE9wdGlvbkN1c3RvbWVyID0gJExheW91dE9iamVjdC0+UGVybWlzc2lvbigKICAgICAgICBBY3Rpb24gPT4gJ0FkbWluQ3VzdG9tZXJVc2VyJywKICAgICAgICBUeXBlICAgPT4gJ3J3JywKICAgICk7CgogICAgbXkgJFNob3duT3B0aW9uc0Jsb2NrOwoKICAgIGlmICgkT3B0aW9uQ3VzdG9tZXIpIHsKCiAgICAgICAgIyBjaGVjayBpZiBuZWVkIHRvIGNhbGwgT3B0aW9ucyBibG9jawogICAgICAgIGlmICggISRTaG93bk9wdGlvbnNCbG9jayApIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdUaWNrZXRPcHRpb25zJywKICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAjIHNldCBmbGFnIHRvICJ0cnVlIiBpbiBvcmRlciB0byBwcmV2ZW50IGNhbGxpbmcgdGhlIE9wdGlvbnMgYmxvY2sgYWdhaW4KICAgICAgICAgICAgJFNob3duT3B0aW9uc0Jsb2NrID0gMTsKICAgICAgICB9CgogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdPcHRpb25DdXN0b21lcicsCiAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICB9CgogICAgIyBzaG93IGF0dGFjaG1lbnRzCiAgICBBVFRBQ0hNRU5UOgogICAgZm9yIG15ICRBdHRhY2htZW50ICggQHsgJFBhcmFte0F0dGFjaG1lbnRzfSB9ICkgewogICAgICAgIGlmICgKICAgICAgICAgICAgJEF0dGFjaG1lbnQtPntDb250ZW50SUR9CiAgICAgICAgICAgICYmICRMYXlvdXRPYmplY3QtPntCcm93c2VyUmljaFRleHR9CiAgICAgICAgICAgICYmICggJEF0dGFjaG1lbnQtPntDb250ZW50VHlwZX0gPX4gL2ltYWdlL2kgKQogICAgICAgICAgICAmJiAoICRBdHRhY2htZW50LT57RGlzcG9zaXRpb259IGVxICdpbmxpbmUnICkKICAgICAgICAgICAgKQogICAgICAgIHsKICAgICAgICAgICAgbmV4dCBBVFRBQ0hNRU5UOwogICAgICAgIH0KCiAgICAgICAgcHVzaCBAeyAkUGFyYW17QXR0YWNobWVudExpc3R9IH0sICRBdHRhY2htZW50OwogICAgfQoKICAgICMgYWRkIHJpY2ggdGV4dCBlZGl0b3IKICAgIGlmICggJExheW91dE9iamVjdC0+e0Jyb3dzZXJSaWNoVGV4dH0gKSB7CgogICAgICAgICMgdXNlIGhlaWdodC93aWR0aCBkZWZpbmVkIGZvciB0aGlzIHNjcmVlbgogICAgICAgICRQYXJhbXtSaWNoVGV4dEhlaWdodH0gPSAkQ29uZmlnLT57UmljaFRleHRIZWlnaHR9IHx8IDA7CiAgICAgICAgJFBhcmFte1JpY2hUZXh0V2lkdGh9ICA9ICRDb25maWctPntSaWNoVGV4dFdpZHRofSAgfHwgMDsKCiAgICAgICAgIyBzZXQgdXAgcmljaCB0ZXh0IGVkaXRvcgogICAgICAgICRMYXlvdXRPYmplY3QtPlNldFJpY2hUZXh0UGFyYW1ldGVycygKICAgICAgICAgICAgRGF0YSA9PiBcJVBhcmFtLAogICAgICAgICk7CiAgICB9CgogICAgIyBQZXJtaXNzaW9ucyBoYXZlIGJlZW4gY2hlY2tlZCBiZWZvcmUgaW4gUnVuKCkKICAgIGlmICggJFBhcmFte0Zyb21DaGF0SUR9ICkgewogICAgICAgIG15IEBDaGF0TWVzc2FnZXMgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2hhdCcpLT5DaGF0TWVzc2FnZUxpc3QoCiAgICAgICAgICAgIENoYXRJRCA9PiAkUGFyYW17RnJvbUNoYXRJRH0sCiAgICAgICAgKTsKCiAgICAgICAgZm9yIG15ICRNZXNzYWdlIChAQ2hhdE1lc3NhZ2VzKSB7CiAgICAgICAgICAgICRNZXNzYWdlLT57TWVzc2FnZVRleHR9ID0gJExheW91dE9iamVjdC0+QXNjaWkySHRtbCgKICAgICAgICAgICAgICAgIFRleHQgICAgICAgID0+ICRNZXNzYWdlLT57TWVzc2FnZVRleHR9LAogICAgICAgICAgICAgICAgTGlua0ZlYXR1cmUgPT4gMSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdDaGF0QXJ0aWNsZVByZXZpZXcnLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgIENoYXRNZXNzYWdlcyA9PiBcQENoYXRNZXNzYWdlcywKICAgICAgICAgICAgfSwKICAgICAgICApOwogICAgfQoKICAgICMgZ2V0IG91dHB1dCBiYWNrCiAgICByZXR1cm4gJExheW91dE9iamVjdC0+T3V0cHV0KAogICAgICAgIFRlbXBsYXRlRmlsZSA9PiAnQWdlbnRUaWNrZXRQaG9uZScsCiAgICAgICAgRGF0YSAgICAgICAgID0+IFwlUGFyYW0sCiAgICApOwp9CgpzdWIgX0dldEZpZWxkc1RvVXBkYXRlIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgQFVwZGF0YWJsZUZpZWxkczsKCiAgICAjIHNldCB0aGUgZmllbGRzIHRoYXQgY2FuIGJlIHVwZGF0YWJsZSB2aWEgQUpBWFVwZGF0ZQogICAgaWYgKCAhJFBhcmFte09ubHlEeW5hbWljRmllbGRzfSApIHsKICAgICAgICBAVXBkYXRhYmxlRmllbGRzID0gcXcoCiAgICAgICAgICAgIFR5cGVJRAogICAgICAgICAgICBEZXN0CiAgICAgICAgICAgIFNlcnZpY2VJRAogICAgICAgICAgICBTTEFJRAogICAgICAgICAgICBOZXdVc2VySUQKICAgICAgICAgICAgTmV3UmVzcG9uc2libGVJRAogICAgICAgICAgICBOZXh0U3RhdGVJRAogICAgICAgICAgICBQcmlvcml0eUlECiAgICAgICAgICAgIFN0YW5kYXJkVGVtcGxhdGVJRAogICAgICAgICk7CiAgICB9CgogICAgIyBjeWNsZSB0cm91Z2ggdGhlIGFjdGl2YXRlZCBEeW5hbWljIEZpZWxkcyBmb3IgdGhpcyBzY3JlZW4KICAgIERZTkFNSUNGSUVMRDoKICAgIGZvciBteSAkRHluYW1pY0ZpZWxkQ29uZmlnICggQHsgJFNlbGYtPntEeW5hbWljRmllbGR9IH0gKSB7CiAgICAgICAgbmV4dCBEWU5BTUlDRklFTEQgaWYgIUlzSGFzaFJlZldpdGhEYXRhKCREeW5hbWljRmllbGRDb25maWcpOwoKICAgICAgICBteSAkSXNBQ0xSZWR1Y2libGUgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6RHluYW1pY0ZpZWxkOjpCYWNrZW5kJyktPkhhc0JlaGF2aW9yKAogICAgICAgICAgICBEeW5hbWljRmllbGRDb25maWcgPT4gJER5bmFtaWNGaWVsZENvbmZpZywKICAgICAgICAgICAgQmVoYXZpb3IgICAgICAgICAgID0+ICdJc0FDTFJlZHVjaWJsZScsCiAgICAgICAgKTsKICAgICAgICBuZXh0IERZTkFNSUNGSUVMRCBpZiAhJElzQUNMUmVkdWNpYmxlOwoKICAgICAgICBwdXNoIEBVcGRhdGFibGVGaWVsZHMsICdEeW5hbWljRmllbGRfJyAuICREeW5hbWljRmllbGRDb25maWctPntOYW1lfTsKICAgIH0KCiAgICByZXR1cm4gXEBVcGRhdGFibGVGaWVsZHM7Cn0KCjE7Cg==</File>
        <File Location="Custom/Kernel/Modules/AgentTicketProcess.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxLTIwMjIgWm51bnkgR21iSCwgaHR0cHM6Ly96bnVueS5vcmcvCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6TW9kdWxlczo6QWdlbnRUaWNrZXRQcm9jZXNzOwoKdXNlIHN0cmljdDsKdXNlIHdhcm5pbmdzOwoKdXNlIEtlcm5lbDo6U3lzdGVtOjpWYXJpYWJsZUNoZWNrIHF3KDphbGwpOwp1c2UgS2VybmVsOjpMYW5ndWFnZSBxdyhUcmFuc2xhdGFibGUpOwoKb3VyICRPYmplY3RNYW5hZ2VyRGlzYWJsZWQgPSAxOwoKc3ViIG5ldyB7CiAgICBteSAoICRUeXBlLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgYWxsb2NhdGUgbmV3IGhhc2ggZm9yIG9iamVjdAogICAgbXkgJFNlbGYgPSB7JVBhcmFtfTsKICAgIGJsZXNzICRTZWxmLCAkVHlwZTsKCiAgICAjIGdsb2JhbCBjb25maWcgaGFzaCBmb3IgaWQgZGlzc29sdXRpb24KICAgICRTZWxmLT57TmFtZVRvSUR9ID0gewogICAgICAgIFRpdGxlICAgICAgICAgICAgICA9PiAnVGl0bGUnLAogICAgICAgIFN0YXRlICAgICAgICAgICAgICA9PiAnU3RhdGVJRCcsCiAgICAgICAgU3RhdGVJRCAgICAgICAgICAgID0+ICdTdGF0ZUlEJywKICAgICAgICBQcmlvcml0eSAgICAgICAgICAgPT4gJ1ByaW9yaXR5SUQnLAogICAgICAgIFByaW9yaXR5SUQgICAgICAgICA9PiAnUHJpb3JpdHlJRCcsCiAgICAgICAgTG9jayAgICAgICAgICAgICAgID0+ICdMb2NrSUQnLAogICAgICAgIExvY2tJRCAgICAgICAgICAgICA9PiAnTG9ja0lEJywKICAgICAgICBRdWV1ZSAgICAgICAgICAgICAgPT4gJ1F1ZXVlSUQnLAogICAgICAgIFF1ZXVlSUQgICAgICAgICAgICA9PiAnUXVldWVJRCcsCiAgICAgICAgQ3VzdG9tZXIgICAgICAgICAgID0+ICdDdXN0b21lcklEJywKICAgICAgICBDdXN0b21lcklEICAgICAgICAgPT4gJ0N1c3RvbWVySUQnLAogICAgICAgIEN1c3RvbWVyTm8gICAgICAgICA9PiAnQ3VzdG9tZXJJRCcsCiAgICAgICAgQ3VzdG9tZXJVc2VySUQgICAgID0+ICdDdXN0b21lclVzZXJJRCcsCiAgICAgICAgT3duZXIgICAgICAgICAgICAgID0+ICdPd25lcklEJywKICAgICAgICBPd25lcklEICAgICAgICAgICAgPT4gJ093bmVySUQnLAogICAgICAgIFR5cGUgICAgICAgICAgICAgICA9PiAnVHlwZUlEJywKICAgICAgICBUeXBlSUQgICAgICAgICAgICAgPT4gJ1R5cGVJRCcsCiAgICAgICAgU0xBICAgICAgICAgICAgICAgID0+ICdTTEFJRCcsCiAgICAgICAgU0xBSUQgICAgICAgICAgICAgID0+ICdTTEFJRCcsCiAgICAgICAgU2VydmljZSAgICAgICAgICAgID0+ICdTZXJ2aWNlSUQnLAogICAgICAgIFNlcnZpY2VJRCAgICAgICAgICA9PiAnU2VydmljZUlEJywKICAgICAgICBTdGFuZGFyZFRlbXBsYXRlSUQgPT4gJ1N0YW5kYXJkVGVtcGxhdGVJRCcsCiAgICAgICAgUmVzcG9uc2libGUgICAgICAgID0+ICdSZXNwb25zaWJsZUlEJywKICAgICAgICBSZXNwb25zaWJsZUlEICAgICAgPT4gJ1Jlc3BvbnNpYmxlSUQnLAogICAgICAgIFBlbmRpbmdUaW1lICAgICAgICA9PiAnUGVuZGluZ1RpbWUnLAogICAgICAgIEFydGljbGUgICAgICAgICAgICA9PiAnQXJ0aWNsZScsCiAgICAgICAgQXR0YWNobWVudHMgICAgICAgID0+ICdBdHRhY2htZW50cycsCiAgICB9OwoKICAgIHJldHVybiAkU2VsZjsKfQoKc3ViIFJ1biB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgZ2V0IHBhcmFtIG9iamVjdAogICAgbXkgJFBhcmFtT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OldlYjo6UmVxdWVzdCcpOwoKICAgIG15ICRUaWNrZXRJRCAgICAgICAgICAgICAgID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ1RpY2tldElEJyApOwogICAgbXkgJEFjdGl2aXR5RGlhbG9nRW50aXR5SUQgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQWN0aXZpdHlEaWFsb2dFbnRpdHlJRCcgKTsKICAgIG15ICRBY3Rpdml0eURpYWxvZ0hhc2hSZWY7CgogICAgIyBnZXQgbmVlZGVkIG9iamVjdHMKICAgIG15ICRBY3Rpdml0eURpYWxvZ09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpQcm9jZXNzTWFuYWdlbWVudDo6QWN0aXZpdHlEaWFsb2cnKTsKICAgIG15ICRMYXlvdXRPYmplY3QgICAgICAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKICAgIG15ICRUaWNrZXRPYmplY3QgICAgICAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpUaWNrZXQnKTsKCiAgICAkU2VsZi0+e0ZpcnN0QWN0aXZpdHlEaWFsb2d9ID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0ZpcnN0QWN0aXZpdHlEaWFsb2cnICk7CiAgICAkU2VsZi0+e0xpbmtUaWNrZXRJRH0gICAgICAgID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0xpbmtUaWNrZXRJRCcgKSB8fCAnJzsKICAgICRTZWxmLT57QXJ0aWNsZUlEfSAgICAgICAgICAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnQXJ0aWNsZUlEJyApIHx8ICcnOwoKICAgICMgZ2V0IHRoZSB0aWNrZXQgaW5mb3JtYXRpb24gb24gbGluayBhY3Rpb25zCiAgICBpZiAoICRTZWxmLT57TGlua1RpY2tldElEfSApIHsKICAgICAgICBteSAlVGlja2V0RGF0YSA9ICRUaWNrZXRPYmplY3QtPlRpY2tldEdldCgKICAgICAgICAgICAgVGlja2V0SUQgPT4gJFNlbGYtPntMaW5rVGlja2V0SUR9LAogICAgICAgICAgICBVc2VySUQgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgIEV4dGVuZGVkID0+IDEsCiAgICAgICAgKTsKICAgICAgICAkU2VsZi0+e0xpbmtUaWNrZXREYXRhfSA9IFwlVGlja2V0RGF0YTsKCiAgICAgICAgIyBzZXQgTGlua1RpY2tldElEIHBhcmFtIGZvciBzaG93aW5nIG9uIG1haW4gZm9ybQogICAgICAgICRQYXJhbXtMaW5rVGlja2V0SUR9ID0gJFNlbGYtPntMaW5rVGlja2V0SUR9OwogICAgfQoKICAgICMgZ2V0IHRoZSBhcnRpY2xlIGluZm9ybWF0aW9uIG9uIGxpbmsgYWN0aW9ucwogICAgaWYgKCAkU2VsZi0+e0FydGljbGVJRH0gKSB7CiAgICAgICAgbXkgJEFydGljbGVCYWNrZW5kT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpY2tldDo6QXJ0aWNsZScpLT5CYWNrZW5kRm9yQXJ0aWNsZSgKICAgICAgICAgICAgVGlja2V0SUQgID0+ICRTZWxmLT57TGlua1RpY2tldElEfSwKICAgICAgICAgICAgQXJ0aWNsZUlEID0+ICRTZWxmLT57QXJ0aWNsZUlEfSwKICAgICAgICApOwoKICAgICAgICBteSAlQXJ0aWNsZSA9ICRBcnRpY2xlQmFja2VuZE9iamVjdC0+QXJ0aWNsZUdldCgKICAgICAgICAgICAgVGlja2V0SUQgID0+ICRTZWxmLT57TGlua1RpY2tldElEfSwKICAgICAgICAgICAgQXJ0aWNsZUlEID0+ICRTZWxmLT57QXJ0aWNsZUlEfSwKICAgICAgICApOwoKICAgICAgICAkU2VsZi0+e0xpbmtBcnRpY2xlRGF0YX0gPSBcJUFydGljbGU7CgogICAgICAgICMgc2V0IEFydGljbGVJRCBwYXJhbSBmb3Igc2hvd2luZyBvbiBtYWluIGZvcm0KICAgICAgICAkUGFyYW17QXJ0aWNsZUlEfSA9ICRTZWxmLT57QXJ0aWNsZUlEfTsKICAgIH0KCiAgICBpZiAoJFRpY2tldElEKSB7CgogICAgICAgICMgY2hlY2sgaWYgdGhlcmUgaXMgYSBjb25maWd1cmVkIHJlcXVpcmVkIHBlcm1pc3Npb24KICAgICAgICAjIGZvciB0aGUgQWN0aXZpdHlEaWFsb2cgKGlmIHRoZXJlIGlzIG9uZSkKICAgICAgICBteSAkQWN0aXZpdHlEaWFsb2dQZXJtaXNzaW9uID0gJ3J3JzsKICAgICAgICBpZiAoJEFjdGl2aXR5RGlhbG9nRW50aXR5SUQpIHsKICAgICAgICAgICAgJEFjdGl2aXR5RGlhbG9nSGFzaFJlZiA9ICRBY3Rpdml0eURpYWxvZ09iamVjdC0+QWN0aXZpdHlEaWFsb2dHZXQoCiAgICAgICAgICAgICAgICBBY3Rpdml0eURpYWxvZ0VudGl0eUlEID0+ICRBY3Rpdml0eURpYWxvZ0VudGl0eUlELAogICAgICAgICAgICAgICAgSW50ZXJmYWNlICAgICAgICAgICAgICA9PiAnQWdlbnRJbnRlcmZhY2UnLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKCAhSXNIYXNoUmVmV2l0aERhdGEoJEFjdGl2aXR5RGlhbG9nSGFzaFJlZikgKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+RXJyb3JTY3JlZW4oCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgICdDb3VsZG5cJ3QgZ2V0IEFjdGl2aXR5RGlhbG9nRW50aXR5SUQgIiVzIiEnLAogICAgICAgICAgICAgICAgICAgICAgICAkQWN0aXZpdHlEaWFsb2dFbnRpdHlJRCwKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgIENvbW1lbnQgPT4gVHJhbnNsYXRhYmxlKCdQbGVhc2UgY29udGFjdCB0aGUgYWRtaW5pc3RyYXRvci4nKSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICggJEFjdGl2aXR5RGlhbG9nSGFzaFJlZi0+e1Blcm1pc3Npb259ICkgewogICAgICAgICAgICAgICAgJEFjdGl2aXR5RGlhbG9nUGVybWlzc2lvbiA9ICRBY3Rpdml0eURpYWxvZ0hhc2hSZWYtPntQZXJtaXNzaW9ufTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBjaGVjayBwZXJtaXNzaW9ucwogICAgICAgIG15ICRBY2Nlc3MgPSAkVGlja2V0T2JqZWN0LT5UaWNrZXRQZXJtaXNzaW9uKAogICAgICAgICAgICBUeXBlICAgICA9PiAkQWN0aXZpdHlEaWFsb2dQZXJtaXNzaW9uLAogICAgICAgICAgICBUaWNrZXRJRCA9PiAkU2VsZi0+e1RpY2tldElEfSwKICAgICAgICAgICAgVXNlcklEICAgPT4gJFNlbGYtPntVc2VySUR9CiAgICAgICAgKTsKCiAgICAgICAgIyBlcnJvciBzY3JlZW4sIGRvbid0IHNob3cgdGlja2V0CiAgICAgICAgaWYgKCAhJEFjY2VzcyApIHsKICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPk5vUGVybWlzc2lvbigKICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4KICAgICAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoICdZb3UgbmVlZCAlcyBwZXJtaXNzaW9ucyEnLCAkQWN0aXZpdHlEaWFsb2dQZXJtaXNzaW9uICksCiAgICAgICAgICAgICAgICBXaXRoSGVhZGVyID0+ICd5ZXMnLAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBnZXQgQUNMIHJlc3RyaWN0aW9ucwogICAgICAgIG15ICVQb3NzaWJsZUFjdGlvbnMgPSAoIDEgPT4gJFNlbGYtPntBY3Rpb259ICk7CgogICAgICAgIG15ICRBQ0wgPSAkVGlja2V0T2JqZWN0LT5UaWNrZXRBY2woCiAgICAgICAgICAgIERhdGEgICAgICAgICAgPT4gXCVQb3NzaWJsZUFjdGlvbnMsCiAgICAgICAgICAgIEFjdGlvbiAgICAgICAgPT4gJFNlbGYtPntBY3Rpb259LAogICAgICAgICAgICBUaWNrZXRJRCAgICAgID0+ICRTZWxmLT57VGlja2V0SUR9LAogICAgICAgICAgICBSZXR1cm5UeXBlICAgID0+ICdBY3Rpb24nLAogICAgICAgICAgICBSZXR1cm5TdWJUeXBlID0+ICctJywKICAgICAgICAgICAgVXNlcklEICAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgKTsKICAgICAgICBteSAlQWNsQWN0aW9uID0gJFRpY2tldE9iamVjdC0+VGlja2V0QWNsQWN0aW9uRGF0YSgpOwoKICAgICAgICAjIGNoZWNrIGlmIEFDTCByZXN0cmljdGlvbnMgZXhpc3QKICAgICAgICBpZiAoICRBQ0wgfHwgSXNIYXNoUmVmV2l0aERhdGEoIFwlQWNsQWN0aW9uICkgKSB7CgogICAgICAgICAgICBteSAlQWNsQWN0aW9uTG9va3VwID0gcmV2ZXJzZSAlQWNsQWN0aW9uOwoKICAgICAgICAgICAgIyBzaG93IGVycm9yIHNjcmVlbiBpZiBBQ0wgcHJvaGliaXRzIHRoaXMgYWN0aW9uCiAgICAgICAgICAgIGlmICggISRBY2xBY3Rpb25Mb29rdXB7ICRTZWxmLT57QWN0aW9ufSB9ICkgewogICAgICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPk5vUGVybWlzc2lvbiggV2l0aEhlYWRlciA9PiAneWVzJyApOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoIElzSGFzaFJlZldpdGhEYXRhKCRBY3Rpdml0eURpYWxvZ0hhc2hSZWYpICkgewoKICAgICAgICAgICAgIyBjaGVjayBpZiBpdCdzIGFscmVhZHkgbG9ja2VkIGJ5IHNvbWVib2R5IGVsc2UKICAgICAgICAgICAgaWYgKCAkQWN0aXZpdHlEaWFsb2dIYXNoUmVmLT57UmVxdWlyZWRMb2NrfSApIHsKCiAgICAgICAgICAgICAgICBpZiAoICRUaWNrZXRPYmplY3QtPlRpY2tldExvY2tHZXQoIFRpY2tldElEID0+ICRUaWNrZXRJRCApICkgewogICAgICAgICAgICAgICAgICAgIG15ICRBY2Nlc3NPayA9ICRUaWNrZXRPYmplY3QtPk93bmVyQ2hlY2soCiAgICAgICAgICAgICAgICAgICAgICAgIFRpY2tldElEID0+ICRUaWNrZXRJRCwKICAgICAgICAgICAgICAgICAgICAgICAgT3duZXJJRCAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCAhJEFjY2Vzc09rICkgewogICAgICAgICAgICAgICAgICAgICAgICBteSAkT3V0cHV0ID0gJExheW91dE9iamVjdC0+SGVhZGVyKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVHlwZSA9PiAnU21hbGwnLAogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPldhcm5pbmcoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+IFRyYW5zbGF0YWJsZSgnU29ycnksIHlvdSBuZWVkIHRvIGJlIHRoZSB0aWNrZXQgb3duZXIgdG8gcGVyZm9ybSB0aGlzIGFjdGlvbi4nKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbW1lbnQgPT4gVHJhbnNsYXRhYmxlKCdQbGVhc2UgY2hhbmdlIHRoZSBvd25lciBmaXJzdC4nKSwKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5Gb290ZXIoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUeXBlID0+ICdTbWFsbCcsCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkT3V0cHV0OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewoKICAgICAgICAgICAgICAgICAgICBteSAlVGlja2V0ID0gJFRpY2tldE9iamVjdC0+VGlja2V0R2V0KAogICAgICAgICAgICAgICAgICAgICAgICBUaWNrZXRJRCA9PiAkVGlja2V0SUQsCiAgICAgICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAgICAgbXkgJExvY2sgPSAkVGlja2V0T2JqZWN0LT5UaWNrZXRMb2NrU2V0KAogICAgICAgICAgICAgICAgICAgICAgICBUaWNrZXRJRCA9PiAkVGlja2V0SUQsCiAgICAgICAgICAgICAgICAgICAgICAgIExvY2sgICAgID0+ICdsb2NrJywKICAgICAgICAgICAgICAgICAgICAgICAgVXNlcklEICAgPT4gJFNlbGYtPntVc2VySUR9CiAgICAgICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAgICAgIyBTZXQgbmV3IG93bmVyIGlmIHRpY2tldCBvd25lciBpcyBkaWZmZXJlbnQgdGhlbiBsb2dnZWQgdXNlci4KICAgICAgICAgICAgICAgICAgICBpZiAoICRMb2NrICYmICggJFRpY2tldHtPd25lcklEfSAhPSAkU2VsZi0+e1VzZXJJRH0gKSApIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICMgUmVtZW1iZXIgcHJldmlvdXMgb3duZXIsIHdoaWNoIHdpbGwgYmUgdXNlZCB0byByZXN0b3JlIHRpY2tldCBvd25lciBvbiB1bmRvIGFjdGlvbi4KICAgICAgICAgICAgICAgICAgICAgICAgJFBhcmFte1ByZXZpb3VzT3duZXJ9ID0gJFRpY2tldHtPd25lcklEfTsKCiAgICAgICAgICAgICAgICAgICAgICAgIG15ICRTdWNjZXNzID0gJFRpY2tldE9iamVjdC0+VGlja2V0T3duZXJTZXQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaWNrZXRJRCAgPT4gJFRpY2tldElELAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVXNlcklEICAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5ld1VzZXJJRCA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgICAgICAgICAjIFJlbG9hZCB0aGUgcGFyZW50IHdpbmRvdyB0byBzaG93IHRoZSB1cGRhdGVkIGxvY2sgc3RhdGUuCiAgICAgICAgICAgICAgICAgICAgICAgICRQYXJhbXtQYXJlbnRSZWxvYWR9ID0gMTsKCiAgICAgICAgICAgICAgICAgICAgICAgICMgU2hvdyBsb2NrIHN0YXRlIGxpbmsuCiAgICAgICAgICAgICAgICAgICAgICAgICRQYXJhbXtSZW5kZXJMb2NrZWR9ID0gMTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIG15ICRUaWNrZXROdW1iZXIgPSAkVGlja2V0T2JqZWN0LT5UaWNrZXROdW1iZXJMb29rdXAoCiAgICAgICAgICAgICAgICAgICAgICAgIFRpY2tldElEID0+ICRUaWNrZXRJRCwKICAgICAgICAgICAgICAgICAgICAgICAgVXNlcklEICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgICAgICMgbm90aWZ5IHRoZSBhZ2VudCB0aGF0IHRoZSB0aWNrZXQgd2FzIGxvY2tlZAogICAgICAgICAgICAgICAgICAgIHB1c2ggQHsgJFBhcmFte05vdGlmeX0gfSwgewogICAgICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnTm90aWNlJywKICAgICAgICAgICAgICAgICAgICAgICAgRGF0YSAgICAgPT4gIiRUaWNrZXROdW1iZXI6ICIgLiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoIlRpY2tldCBsb2NrZWQuIiksCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgbXkgJFBvc3NpYmxlQWN0aXZpdHlEaWFsb2dzID0geyAxID0+ICRBY3Rpdml0eURpYWxvZ0VudGl0eUlEIH07CgogICAgICAgICAgICAjIGdldCBBQ0wgcmVzdHJpY3Rpb25zCiAgICAgICAgICAgIG15ICRBQ0wgPSAkVGlja2V0T2JqZWN0LT5UaWNrZXRBY2woCiAgICAgICAgICAgICAgICBEYXRhICAgICAgICAgICAgICAgICAgID0+ICRQb3NzaWJsZUFjdGl2aXR5RGlhbG9ncywKICAgICAgICAgICAgICAgIEFjdGl2aXR5RGlhbG9nRW50aXR5SUQgPT4gJEFjdGl2aXR5RGlhbG9nRW50aXR5SUQsCiAgICAgICAgICAgICAgICBUaWNrZXRJRCAgICAgICAgICAgICAgID0+ICRUaWNrZXRJRCwKICAgICAgICAgICAgICAgIFJldHVyblR5cGUgICAgICAgICAgICAgPT4gJ0FjdGl2aXR5RGlhbG9nJywKICAgICAgICAgICAgICAgIFJldHVyblN1YlR5cGUgICAgICAgICAgPT4gJy0nLAogICAgICAgICAgICAgICAgQWN0aW9uICAgICAgICAgICAgICAgICA9PiAkU2VsZi0+e0FjdGlvbn0sCiAgICAgICAgICAgICAgICBVc2VySUQgICAgICAgICAgICAgICAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGlmICgkQUNMKSB7CiAgICAgICAgICAgICAgICAleyRQb3NzaWJsZUFjdGl2aXR5RGlhbG9nc30gPSAkVGlja2V0T2JqZWN0LT5UaWNrZXRBY2xEYXRhKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgY2hlY2sgaWYgQUNMIHJlc3RyaWN0aW9ucyBleGlzdAogICAgICAgICAgICBpZiAoICFJc0hhc2hSZWZXaXRoRGF0YSgkUG9zc2libGVBY3Rpdml0eURpYWxvZ3MpICkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPk5vUGVybWlzc2lvbiggV2l0aEhlYWRlciA9PiAneWVzJyApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgICMgbGlzdCBvbmx5IEFjdGl2ZSBwcm9jZXNzZXMgYnkgZGVmYXVsdAogICAgbXkgQFByb2Nlc3NTdGF0ZXMgPSAoJ0FjdGl2ZScpOwoKICAgICMgc2V0IElzTWFpbldpbmRvdywgSXNBamF4UmVxdWVzdCwgSXNQcm9jZXNzRW5yb2xsIGZvciBwcm9wZXIgZXJyb3IgcmVzcG9uc2VzLCBzY3JlZW4gZGlzcGxheQogICAgIyBhbmQgcHJvY2VzcyBsaXN0CiAgICAkU2VsZi0+e0lzTWFpbldpbmRvd30gICAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnSXNNYWluV2luZG93JyApICAgIHx8ICcnOwogICAgJFNlbGYtPntJc0FqYXhSZXF1ZXN0fSAgID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0lzQWpheFJlcXVlc3QnICkgICB8fCAnJzsKICAgICRTZWxmLT57SXNQcm9jZXNzRW5yb2xsfSA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdJc1Byb2Nlc3NFbnJvbGwnICkgfHwgJyc7CgogICAgIyBmZXRjaCBhbHNvIEZhZGVBd2F5IHByb2Nlc3NlcyB0byBjb250aW51ZSB3b3JraW5nIHdpdGggZXhpc3RpbmcgdGlja2V0cywgYnV0IG5vdCB0byBzdGFydCBuZXcKICAgICMgICAgb25lcwogICAgaWYgKCAhJFNlbGYtPntJc01haW5XaW5kb3d9ICYmICRTZWxmLT57U3ViYWN0aW9ufSApIHsKICAgICAgICBwdXNoIEBQcm9jZXNzU3RhdGVzLCAnRmFkZUF3YXknOwogICAgfQoKICAgICMgY3JlYXRlIHByb2Nlc3Mgb2JqZWN0CiAgICAkS2VybmVsOjpPTS0+T2JqZWN0UGFyYW1BZGQoCiAgICAgICAgJ0tlcm5lbDo6U3lzdGVtOjpQcm9jZXNzTWFuYWdlbWVudDo6UHJvY2VzcycgPT4gewogICAgICAgICAgICBBY3Rpdml0eU9iamVjdCAgICAgICAgID0+ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpQcm9jZXNzTWFuYWdlbWVudDo6QWN0aXZpdHknKSwKICAgICAgICAgICAgQWN0aXZpdHlEaWFsb2dPYmplY3QgICA9PiAkQWN0aXZpdHlEaWFsb2dPYmplY3QsCiAgICAgICAgICAgIFRyYW5zaXRpb25PYmplY3QgICAgICAgPT4gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlByb2Nlc3NNYW5hZ2VtZW50OjpUcmFuc2l0aW9uJyksCiAgICAgICAgICAgIFRyYW5zaXRpb25BY3Rpb25PYmplY3QgPT4gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlByb2Nlc3NNYW5hZ2VtZW50OjpUcmFuc2l0aW9uQWN0aW9uJyksCiAgICAgICAgfQogICAgKTsKICAgIG15ICRQcm9jZXNzT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlByb2Nlc3NNYW5hZ2VtZW50OjpQcm9jZXNzJyk7CgogICAgIyBnZXQgcHJvY2Vzc2VzCiAgICBteSAkUHJvY2Vzc0xpc3QgPSAkUHJvY2Vzc09iamVjdC0+UHJvY2Vzc0xpc3QoCiAgICAgICAgUHJvY2Vzc1N0YXRlID0+IFxAUHJvY2Vzc1N0YXRlcywKICAgICAgICBJbnRlcmZhY2UgICAgPT4gWydBZ2VudEludGVyZmFjZSddLAogICAgKTsKCiAgICAjIGFsc28gZ2V0IHRoZSBsaXN0IG9mIHByb2Nlc3NlcyBpbml0aWF0ZWQgYnkgY3VzdG9tZXJzLCBhcyBhbiBhY3Rpdml0eSBkaWFsb2cgbWlnaHQgYmUKICAgICMgY29uZmlndXJlZCBmb3IgdGhlIGFnZW50IGludGVyZmFjZQogICAgbXkgJEZvbGxvd3VwUHJvY2Vzc0xpc3QgPSAkUHJvY2Vzc09iamVjdC0+UHJvY2Vzc0xpc3QoCiAgICAgICAgUHJvY2Vzc1N0YXRlID0+IFxAUHJvY2Vzc1N0YXRlcywKICAgICAgICBJbnRlcmZhY2UgICAgPT4gWyAnQWdlbnRJbnRlcmZhY2UnLCAnQ3VzdG9tZXJJbnRlcmZhY2UnIF0sCiAgICApOwoKICAgIG15ICRQcm9jZXNzRW50aXR5SUQgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnUHJvY2Vzc0VudGl0eUlEJyApOwoKICAgIGlmICggIUlzSGFzaFJlZldpdGhEYXRhKCRQcm9jZXNzTGlzdCkgJiYgIUlzSGFzaFJlZldpdGhEYXRhKCRGb2xsb3d1cFByb2Nlc3NMaXN0KSApIHsKICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+RXJyb3JTY3JlZW4oCiAgICAgICAgICAgIE1lc3NhZ2UgPT4gVHJhbnNsYXRhYmxlKCdObyBQcm9jZXNzIGNvbmZpZ3VyZWQhJyksCiAgICAgICAgICAgIENvbW1lbnQgPT4gVHJhbnNsYXRhYmxlKCdQbGVhc2UgY29udGFjdCB0aGUgYWRtaW5pc3RyYXRvci4nKSwKICAgICAgICApOwogICAgfQoKICAgICMgcHJlcGFyZSBwcm9jZXNzIGxpc3QgZm9yIEFDTHMsIHVzZSBvbmx5IGVudGl0aWVzIGluc3RlYWQgb2YgbmFtZXMsIGNvbnZlcnQgZnJvbQogICAgIyAgIFAxID0+IE5hbWUgdG8gUDEgPT4gUDEuIEFzIEFDTHMgc2hvdWxkIHdvcmsgb25seSBhZ2FpbnN0IGVudGl0aWVzCiAgICBteSAlUHJvY2Vzc0xpc3RBQ0wgPSBtYXAgeyAkXyA9PiAkXyB9IHNvcnQga2V5cyAleyRQcm9jZXNzTGlzdH07CgogICAgIyB2YWxpZGF0ZSB0aGUgUHJvY2Vzc0xpc3Qgd2l0aCBzdG9yZWQgQUNMcwogICAgbXkgJEFDTCA9ICRUaWNrZXRPYmplY3QtPlRpY2tldEFjbCgKICAgICAgICBSZXR1cm5UeXBlICAgID0+ICdQcm9jZXNzJywKICAgICAgICBSZXR1cm5TdWJUeXBlID0+ICctJywKICAgICAgICBEYXRhICAgICAgICAgID0+IFwlUHJvY2Vzc0xpc3RBQ0wsCiAgICAgICAgQWN0aW9uICAgICAgICA9PiAkU2VsZi0+e0FjdGlvbn0sCiAgICAgICAgVXNlcklEICAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgVGlja2V0SUQgICAgICA9PiAkVGlja2V0SUQsCiAgICApOwoKICAgIGlmICggSXNIYXNoUmVmV2l0aERhdGEoJFByb2Nlc3NMaXN0KSAmJiAkQUNMICkgewoKICAgICAgICAjIGdldCBBQ0wgcmVzdWx0cwogICAgICAgIG15ICVBQ0xEYXRhID0gJFRpY2tldE9iamVjdC0+VGlja2V0QWNsRGF0YSgpOwoKICAgICAgICAjIHJlY292ZXIgcHJvY2VzcyBuYW1lcwogICAgICAgIG15ICVSZWR1Y2VkUHJvY2Vzc0xpc3QgPSBtYXAgeyAkXyA9PiAkUHJvY2Vzc0xpc3QtPnskX30gfSBzb3J0IGtleXMgJUFDTERhdGE7CgogICAgICAgICMgcmVwbGFjZSBvcmlnaW5hbCBwcm9jZXNzIGxpc3Qgd2l0aCB0aGUgcmVkdWNlZCBvbmUKICAgICAgICAkUHJvY2Vzc0xpc3QgPSBcJVJlZHVjZWRQcm9jZXNzTGlzdDsKICAgIH0KCiAgICAjIGdldCBmb3JtIGlkCiAgICAkU2VsZi0+e0Zvcm1JRH0gPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnRm9ybUlEJyApOwoKICAgICMgY3JlYXRlIGZvcm0gaWQKICAgIGlmICggISRTZWxmLT57Rm9ybUlEfSApIHsKICAgICAgICAkU2VsZi0+e0Zvcm1JRH0gPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6V2ViOjpVcGxvYWRDYWNoZScpLT5Gb3JtSURDcmVhdGUoKTsKICAgIH0KCiAgICAjIGlmIHdlIGhhdmUgbm8gc3ViYWN0aW9uIGRpc3BsYXkgdGhlIHByb2Nlc3MgbGlzdCB0byBzdGFydCBhIG5ldyBvbmUKICAgIGlmICggISRTZWxmLT57U3ViYWN0aW9ufSApIHsKCiAgICAgICAgIyB0byBkaXNwbGF5IHRoZSBwcm9jZXNzIGxpc3QgaXMgbWFuZGF0b3J5IHRvIGhhdmUgcHJvY2Vzc2VzIHRoYXQgYWdlbnQgY2FuIHN0YXJ0CiAgICAgICAgaWYgKCAhSXNIYXNoUmVmV2l0aERhdGEoJFByb2Nlc3NMaXN0KSApIHsKICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkVycm9yU2NyZWVuKAogICAgICAgICAgICAgICAgTWVzc2FnZSA9PiBUcmFuc2xhdGFibGUoJ05vIFByb2Nlc3MgY29uZmlndXJlZCEnKSwKICAgICAgICAgICAgICAgIENvbW1lbnQgPT4gVHJhbnNsYXRhYmxlKCdQbGVhc2UgY29udGFjdCB0aGUgYWRtaW5pc3RyYXRvci4nKSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgZ2V0IHByb2Nlc3MgaWQgKGlmIGFueSwgYSBwcm9jZXNzIHNob3VsZCBiZSBwcmUtc2VsZWN0ZWQpCiAgICAgICAgJFBhcmFte1Byb2Nlc3NJRH0gPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnSUQnICk7CiAgICAgICAgaWYgKCAkUGFyYW17UHJvY2Vzc0lEfSApIHsKICAgICAgICAgICAgJFBhcmFte1ByZVNlbGVjdFByb2Nlc3N9ID0gMTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkU2VsZi0+X0Rpc3BsYXlQcm9jZXNzTGlzdCgKICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICBQcm9jZXNzTGlzdCAgICAgPT4gJFByb2Nlc3NMaXN0LAogICAgICAgICAgICBQcm9jZXNzRW50aXR5SUQgPT4gJFByb2Nlc3NFbnRpdHlJRCB8fCAkUGFyYW17UHJvY2Vzc0lEfSwKICAgICAgICAgICAgVGlja2V0SUQgICAgICAgID0+ICRUaWNrZXRJRCwKICAgICAgICApOwogICAgfQoKICAgICMgY2hlY2sgaWYgdGhlIHNlbGVjdGVkIHByb2Nlc3MgZnJvbSB0aGUgbGlzdCBpcyB2YWxpZCwgcHJldmVudCB0YW1wZXIgd2l0aCBwcm9jZXNzIHNlbGVjdGlvbgogICAgIyAgICBsaXN0IChub3QgZXhpc3RpbmcsIGludmFsaWQgYW4gZmFkZSBhd2F5IHByb2Nlc3NlcyBtdXN0IG5vdCBiZSBhYmxlIHRvIHN0YXJ0IGEgbmV3IHByb2Nlc3MKICAgICMgICAgdGlja2V0KQogICAgZWxzaWYgKAogICAgICAgICRTZWxmLT57U3ViYWN0aW9ufSBlcSAnRGlzcGxheUFjdGl2aXR5RGlhbG9nQUpBWCcKICAgICAgICAmJiAhJFByb2Nlc3NMaXN0LT57JFByb2Nlc3NFbnRpdHlJRH0KICAgICAgICAmJiAkU2VsZi0+e0lzTWFpbldpbmRvd30KICAgICAgICApCiAgICB7CgogICAgICAgICMgdHJhbnNsYXRlIHRoZSBlcnJvciBtZXNzYWdlIChhcyBpdCB3aWxsIGJlIGluamVjdGVkIGluIHRoZSBIVE1MKQogICAgICAgIG15ICRFcnJvck1lc3NhZ2UgPSAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoIlRoZSBzZWxlY3RlZCBwcm9jZXNzIGlzIGludmFsaWQhIik7CgogICAgICAgICMgcmV0dXJuIGEgcHJlZGVmaW5lZCBIVE1MIHN0cnVjdHVyZSBhcyB0aGUgQUpBWCBjYWxsIGlzIGV4cGVjdGluZyBhbmQgSFRNTCByZXNwb25zZQogICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5BdHRhY2htZW50KAogICAgICAgICAgICBDb250ZW50VHlwZSA9PiAndGV4dC9odG1sOyBjaGFyc2V0PScgLiAkTGF5b3V0T2JqZWN0LT57Q2hhcnNldH0sCiAgICAgICAgICAgIENvbnRlbnQgICAgID0+ICc8ZGl2IGNsYXNzPSJTZXJ2ZXJFcnJvciIgZGF0YS1tZXNzYWdlPSInIC4gJEVycm9yTWVzc2FnZSAuICciPjwvZGl2PicsCiAgICAgICAgICAgIFR5cGUgICAgICAgID0+ICdpbmxpbmUnLAogICAgICAgICAgICBOb0NhY2hlICAgICA9PiAxLAogICAgICAgICk7CiAgICB9CgogICAgIyBpZiBpbnZhbGlkIHByb2Nlc3MgaXMgZGV0ZWN0ZWQgb24gYW4gQWN0aXZpdHlEaWFsb2cgcG9wLXVwIHNjcmVlbiBzaG93IGFuIGVycm9yIG1lc3NhZ2UKICAgIGVsc2lmICgKICAgICAgICAkU2VsZi0+e1N1YmFjdGlvbn0gZXEgJ0Rpc3BsYXlBY3Rpdml0eURpYWxvZycKICAgICAgICAmJiAhJEZvbGxvd3VwUHJvY2Vzc0xpc3QtPnskUHJvY2Vzc0VudGl0eUlEfQogICAgICAgICYmICEkU2VsZi0+e0lzTWFpbldpbmRvd30KICAgICAgICApCiAgICB7CiAgICAgICAgJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigKICAgICAgICAgICAgTWVzc2FnZSA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoICdQcm9jZXNzICVzIGlzIGludmFsaWQhJywgJFByb2Nlc3NFbnRpdHlJRCApLAogICAgICAgICAgICBDb21tZW50ID0+IFRyYW5zbGF0YWJsZSgnUGxlYXNlIGNvbnRhY3QgdGhlIGFkbWluaXN0cmF0b3IuJyksCiAgICAgICAgKTsKICAgIH0KCiAgICAjIEdldCB0aGUgbmVjZXNzYXJ5IHBhcmFtZXRlcnMKICAgICMgY29sbGVjdHMgYSBtaXh0dXJlIG9mIHByZXNlbnQgdmFsdWVzIGJvdHRvbSB0byB0b3A6CiAgICAjIFN5c0NvbmZpZyBEZWZhdWx0VmFsdWVzLCBBY3Rpdml0eURpYWxvZyBEZWZhdWx0VmFsdWVzLCBUaWNrZXRWYWx1ZXMsIFN1Ym1pdHRlZFZhbHVlcwogICAgIyBpbmNsdWRpbmcgQWN0aXZpdHlEaWFsb2dFbnRpdHlJRCBhbmQgUHJvY2Vzc0VudGl0eUlECiAgICAjIGlzIHVzZWQgZm9yOgogICAgIyAtIFBhcmFtZXRlciBjaGVja2luZyBiZWZvcmUgc3RvcmluZwogICAgIyAtIHdpbGwgYmUgdXNlZCBmb3IgQUNMIGNoZWNraW5nIGxhdGVyIG9uCiAgICBteSAkR2V0UGFyYW0gPSAkU2VsZi0+X0dldFBhcmFtKAogICAgICAgIFByb2Nlc3NFbnRpdHlJRCA9PiAkUHJvY2Vzc0VudGl0eUlELAogICAgKTsKCiAgICBpZiAoICRTZWxmLT57U3ViYWN0aW9ufSBlcSAnU3RvcmVBY3Rpdml0eURpYWxvZycgJiYgJFByb2Nlc3NFbnRpdHlJRCApIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5DaGFsbGVuZ2VUb2tlbkNoZWNrKCk7CgogICAgICAgIHJldHVybiAkU2VsZi0+X1N0b3JlQWN0aXZpdHlEaWFsb2coCiAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgUHJvY2Vzc05hbWUgICAgID0+ICRQcm9jZXNzTGlzdC0+eyRQcm9jZXNzRW50aXR5SUR9LAogICAgICAgICAgICBQcm9jZXNzRW50aXR5SUQgPT4gJFByb2Nlc3NFbnRpdHlJRCwKICAgICAgICAgICAgR2V0UGFyYW0gICAgICAgID0+ICRHZXRQYXJhbSwKICAgICAgICApOwogICAgfQogICAgaWYgKCAkU2VsZi0+e1N1YmFjdGlvbn0gZXEgJ0Rpc3BsYXlBY3Rpdml0eURpYWxvZycgJiYgJFByb2Nlc3NFbnRpdHlJRCApIHsKCiAgICAgICAgcmV0dXJuICRTZWxmLT5fT3V0cHV0QWN0aXZpdHlEaWFsb2coCiAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgUHJvY2Vzc0VudGl0eUlEID0+ICRQcm9jZXNzRW50aXR5SUQsCiAgICAgICAgICAgIEdldFBhcmFtICAgICAgICA9PiAkR2V0UGFyYW0sCiAgICAgICAgKTsKICAgIH0KICAgIGlmICggJFNlbGYtPntTdWJhY3Rpb259IGVxICdEaXNwbGF5QWN0aXZpdHlEaWFsb2dBSkFYJyAmJiAkUHJvY2Vzc0VudGl0eUlEICkgewoKICAgICAgICBteSAkQWN0aXZpdHlEaWFsb2dIVE1MID0gJFNlbGYtPl9PdXRwdXRBY3Rpdml0eURpYWxvZygKICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICBQcm9jZXNzRW50aXR5SUQgPT4gJFByb2Nlc3NFbnRpdHlJRCwKICAgICAgICAgICAgR2V0UGFyYW0gICAgICAgID0+ICRHZXRQYXJhbSwKICAgICAgICApOwogICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5BdHRhY2htZW50KAogICAgICAgICAgICBDb250ZW50VHlwZSA9PiAndGV4dC9odG1sOyBjaGFyc2V0PScgLiAkTGF5b3V0T2JqZWN0LT57Q2hhcnNldH0sCiAgICAgICAgICAgIENvbnRlbnQgICAgID0+ICRBY3Rpdml0eURpYWxvZ0hUTUwsCiAgICAgICAgICAgIFR5cGUgICAgICAgID0+ICdpbmxpbmUnLAogICAgICAgICAgICBOb0NhY2hlICAgICA9PiAxLAogICAgICAgICk7CgogICAgfQogICAgZWxzaWYgKCAkU2VsZi0+e1N1YmFjdGlvbn0gZXEgJ0FKQVhVcGRhdGUnICkgewoKICAgICAgICByZXR1cm4gJFNlbGYtPl9SZW5kZXJBamF4KAogICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgIFByb2Nlc3NFbnRpdHlJRCA9PiAkUHJvY2Vzc0VudGl0eUlELAogICAgICAgICAgICBHZXRQYXJhbSAgICAgICAgPT4gJEdldFBhcmFtLAogICAgICAgICk7CiAgICB9CiAgICByZXR1cm4gJExheW91dE9iamVjdC0+RXJyb3JTY3JlZW4oCiAgICAgICAgTWVzc2FnZSA9PiBUcmFuc2xhdGFibGUoJ1N1YmFjdGlvbiBpcyBpbnZhbGlkIScpLAogICAgICAgIENvbW1lbnQgPT4gVHJhbnNsYXRhYmxlKCdQbGVhc2UgY29udGFjdCB0aGUgYWRtaW5pc3RyYXRvci4nKSwKICAgICk7Cn0KCnN1YiBfUmVuZGVyQWpheCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgZ2V0IGxheW91dCBvYmplY3QKICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgIyBGYXRhbEVycm9yIGlzIHNhZmUgYmVjYXVzZSBhIEpTT04gc3RydWN0dXJlIGlzIGV4cGVjdGluZywgdGhlbiBpdCB3aWxsIHJlc3VsdCBpbnRvIGEKICAgICMgY29tbXVuaWNhdGlvbnMgZXJyb3IKCiAgICBmb3IgbXkgJE5lZWRlZCAocXcoUHJvY2Vzc0VudGl0eUlEKSkgewogICAgICAgIGlmICggISRQYXJhbXskTmVlZGVkfSApIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigKICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fQogICAgICAgICAgICAgICAgICAgIC0+VHJhbnNsYXRlKCAnUGFyYW1ldGVyICVzIGlzIG1pc3NpbmcgaW4gJXMuJywgJE5lZWRlZCwgJ19SZW5kZXJBamF4JyApLAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KICAgIG15ICRBY3Rpdml0eURpYWxvZ0VudGl0eUlEID0gJFBhcmFte0dldFBhcmFtfXtBY3Rpdml0eURpYWxvZ0VudGl0eUlEfTsKICAgIGlmICggISRBY3Rpdml0eURpYWxvZ0VudGl0eUlEICkgewogICAgICAgICRMYXlvdXRPYmplY3QtPkZhdGFsRXJyb3IoCiAgICAgICAgICAgIE1lc3NhZ2UgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fQogICAgICAgICAgICAgICAgLT5UcmFuc2xhdGUoICdQYXJhbWV0ZXIgJXMgaXMgbWlzc2luZyBpbiAlcy4nLCAnQWN0aXZpdHlEaWFsb2dFbnRpdHlJRCcsICdfUmVuZGVyQWpheCcgKSwKICAgICAgICApOwogICAgfQogICAgbXkgJEFjdGl2aXR5RGlhbG9nID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlByb2Nlc3NNYW5hZ2VtZW50OjpBY3Rpdml0eURpYWxvZycpLT5BY3Rpdml0eURpYWxvZ0dldCgKICAgICAgICBBY3Rpdml0eURpYWxvZ0VudGl0eUlEID0+ICRBY3Rpdml0eURpYWxvZ0VudGl0eUlELAogICAgICAgIEludGVyZmFjZSAgICAgICAgICAgICAgPT4gJ0FnZW50SW50ZXJmYWNlJywKICAgICk7CgogICAgaWYgKCAhSXNIYXNoUmVmV2l0aERhdGEoJEFjdGl2aXR5RGlhbG9nKSApIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5GYXRhbEVycm9yKAogICAgICAgICAgICBNZXNzYWdlID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgKICAgICAgICAgICAgICAgICdObyBBY3Rpdml0eURpYWxvZyBjb25maWd1cmVkIGZvciAlcyBpbiBfUmVuZGVyQWpheCEnLAogICAgICAgICAgICAgICAgJEFjdGl2aXR5RGlhbG9nRW50aXR5SUQsCiAgICAgICAgICAgICksCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGdldCBsaXN0IHR5cGUKICAgIG15ICRUcmVlVmlldyA9IDA7CiAgICBpZiAoICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnVGlja2V0OjpGcm9udGVuZDo6TGlzdFR5cGUnKSBlcSAndHJlZScgKSB7CiAgICAgICAgJFRyZWVWaWV3ID0gMTsKICAgIH0KCiAgICBteSAlRmllbGRzUHJvY2Vzc2VkOwogICAgbXkgQEpTT05Db2xsZWN0b3I7CgogICAgbXkgJFNlcnZpY2VzOwoKICAgICMgQWxsIHN1Ym1pdHRlZCBEeW5hbWljRmllbGRzCiAgICAjIGdldCBkeW5hbWljIGZpZWxkIHZhbHVlcyBmb3JtIGh0dHAgcmVxdWVzdAogICAgbXkgJUR5bmFtaWNGaWVsZFZhbHVlczsKCiAgICBteSAkRHluYW1pY0ZpZWxkID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkR5bmFtaWNGaWVsZCcpLT5EeW5hbWljRmllbGRMaXN0R2V0KAogICAgICAgIFZhbGlkICAgICAgPT4gMSwKICAgICAgICBPYmplY3RUeXBlID0+ICdUaWNrZXQnLAogICAgKTsKCiAgICAjIGdldCBuZWVkZWQgb2JqZWN0CiAgICBteSAkUGFyYW1PYmplY3QgICAgICAgICAgICAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpXZWI6OlJlcXVlc3QnKTsKICAgIG15ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkR5bmFtaWNGaWVsZDo6QmFja2VuZCcpOwoKICAgICMgY3ljbGUgdHJvdWdoIHRoZSBhY3RpdmF0ZWQgRHluYW1pYyBGaWVsZHMgZm9yIHRoaXMgc2NyZWVuCiAgICBEWU5BTUlDRklFTEQ6CiAgICBmb3IgbXkgJER5bmFtaWNGaWVsZENvbmZpZyAoIEB7JER5bmFtaWNGaWVsZH0gKSB7CiAgICAgICAgbmV4dCBEWU5BTUlDRklFTEQgaWYgIUlzSGFzaFJlZldpdGhEYXRhKCREeW5hbWljRmllbGRDb25maWcpOwoKICAgICAgICAjIGV4dHJhY3QgdGhlIGR5bmFtaWMgZmllbGQgdmFsdWUgZnJvbSB0aGUgd2ViIHJlcXVlc3QKICAgICAgICAkRHluYW1pY0ZpZWxkVmFsdWVzeyAkRHluYW1pY0ZpZWxkQ29uZmlnLT57TmFtZX0gfSA9ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0LT5FZGl0RmllbGRWYWx1ZUdldCgKICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRDb25maWcsCiAgICAgICAgICAgIFBhcmFtT2JqZWN0ICAgICAgICA9PiAkUGFyYW1PYmplY3QsCiAgICAgICAgICAgIExheW91dE9iamVjdCAgICAgICA9PiAkTGF5b3V0T2JqZWN0LAogICAgICAgICk7CiAgICB9CgogICAgIyBjb252ZXJ0IGR5bmFtaWMgZmllbGQgdmFsdWVzIGludG8gYSBzdHJ1Y3R1cmUgZm9yIEFDTHMKICAgIG15ICVEeW5hbWljRmllbGRDaGVja1BhcmFtOwogICAgRFlOQU1JQ0ZJRUxEOgogICAgZm9yIG15ICREeW5hbWljRmllbGRJdGVtICggc29ydCBrZXlzICVEeW5hbWljRmllbGRWYWx1ZXMgKSB7CiAgICAgICAgbmV4dCBEWU5BTUlDRklFTEQgaWYgISREeW5hbWljRmllbGRJdGVtOwogICAgICAgIG5leHQgRFlOQU1JQ0ZJRUxEIGlmICFkZWZpbmVkICREeW5hbWljRmllbGRWYWx1ZXN7JER5bmFtaWNGaWVsZEl0ZW19OwogICAgICAgIG5leHQgRFlOQU1JQ0ZJRUxEIGlmICFsZW5ndGggJER5bmFtaWNGaWVsZFZhbHVlc3skRHluYW1pY0ZpZWxkSXRlbX07CgogICAgICAgICREeW5hbWljRmllbGRDaGVja1BhcmFteyAnRHluYW1pY0ZpZWxkXycgLiAkRHluYW1pY0ZpZWxkSXRlbSB9ID0gJER5bmFtaWNGaWVsZFZhbHVlc3skRHluYW1pY0ZpZWxkSXRlbX07CiAgICB9CiAgICAkUGFyYW17R2V0UGFyYW19LT57RHluYW1pY0ZpZWxkfSA9IFwlRHluYW1pY0ZpZWxkQ2hlY2tQYXJhbTsKCiAgICAjIEdldCB0aGUgYWN0aXZpdHkgZGlhbG9nJ3MgU3VibWl0IFBhcmFtJ3Mgb3IgQ29uZmlnIFBhcmFtcwogICAgRElBTE9HRklFTEQ6CiAgICBmb3IgbXkgJEN1cnJlbnRGaWVsZCAoIEB7ICRBY3Rpdml0eURpYWxvZy0+e0ZpZWxkT3JkZXJ9IH0gKSB7CgogICAgICAgICMgU2tpcCBpZiB3ZSdyZSB3b3JraW5nIG9uIGEgZmllbGQgdGhhdCB3YXMgYWxyZWFkeSBkb25lIHdpdGggb3Igd2l0aG91dCBJRAogICAgICAgIGlmICgKICAgICAgICAgICAgJFNlbGYtPntOYW1lVG9JRH17JEN1cnJlbnRGaWVsZH0KICAgICAgICAgICAgJiYgJEZpZWxkc1Byb2Nlc3NlZHsgJFNlbGYtPntOYW1lVG9JRH17JEN1cnJlbnRGaWVsZH0gfQogICAgICAgICAgICApCiAgICAgICAgewogICAgICAgICAgICBuZXh0IERJQUxPR0ZJRUxEOwogICAgICAgIH0KCiAgICAgICAgaWYgKCAkQ3VycmVudEZpZWxkID1+IG17XkR5bmFtaWNGaWVsZF8oLiopfXhtcyApIHsKICAgICAgICAgICAgbXkgJER5bmFtaWNGaWVsZE5hbWUgPSAkMTsKCiAgICAgICAgICAgIG15ICREeW5hbWljRmllbGRDb25maWcgPSAoIGdyZXAgeyAkXy0+e05hbWV9IGVxICREeW5hbWljRmllbGROYW1lIH0gQHskRHluYW1pY0ZpZWxkfSApWzBdOwoKICAgICAgICAgICAgbmV4dCBESUFMT0dGSUVMRCBpZiAhSXNIYXNoUmVmV2l0aERhdGEoJER5bmFtaWNGaWVsZENvbmZpZyk7CgogICAgICAgICAgICBteSAkSXNBQ0xSZWR1Y2libGUgPSAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdC0+SGFzQmVoYXZpb3IoCiAgICAgICAgICAgICAgICBEeW5hbWljRmllbGRDb25maWcgPT4gJER5bmFtaWNGaWVsZENvbmZpZywKICAgICAgICAgICAgICAgIEJlaGF2aW9yICAgICAgICAgICA9PiAnSXNBQ0xSZWR1Y2libGUnLAogICAgICAgICAgICApOwogICAgICAgICAgICBuZXh0IERJQUxPR0ZJRUxEIGlmICEkSXNBQ0xSZWR1Y2libGU7CgogICAgICAgICAgICBteSAkUG9zc2libGVWYWx1ZXMgPSAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdC0+UG9zc2libGVWYWx1ZXNHZXQoCiAgICAgICAgICAgICAgICBEeW5hbWljRmllbGRDb25maWcgPT4gJER5bmFtaWNGaWVsZENvbmZpZywKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgY29udmVydCBwb3NzaWJsZSB2YWx1ZXMga2V5ID0+IHZhbHVlIHRvIGtleSA9PiBrZXkgZm9yIEFDTHMgdXNpbmcgYSBIYXNoIHNsaWNlCiAgICAgICAgICAgIG15ICVBY2xEYXRhID0gJXskUG9zc2libGVWYWx1ZXN9OwogICAgICAgICAgICBAQWNsRGF0YXsga2V5cyAlQWNsRGF0YSB9ID0ga2V5cyAlQWNsRGF0YTsKCiAgICAgICAgICAgICMgZ2V0IHRpY2tldCBvYmplY3QKICAgICAgICAgICAgbXkgJFRpY2tldE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpUaWNrZXQnKTsKCiAgICAgICAgICAgICMgc2V0IHBvc3NpYmxlIHZhbHVlcyBmaWx0ZXIgZnJvbSBBQ0xzCiAgICAgICAgICAgIG15ICRBQ0wgPSAkVGlja2V0T2JqZWN0LT5UaWNrZXRBY2woCiAgICAgICAgICAgICAgICAleyAkUGFyYW17R2V0UGFyYW19IH0sCiAgICAgICAgICAgICAgICBSZXR1cm5UeXBlICAgID0+ICdUaWNrZXQnLAogICAgICAgICAgICAgICAgUmV0dXJuU3ViVHlwZSA9PiAnRHluYW1pY0ZpZWxkXycgLiAkRHluYW1pY0ZpZWxkQ29uZmlnLT57TmFtZX0sCiAgICAgICAgICAgICAgICBEYXRhICAgICAgICAgID0+IFwlQWNsRGF0YSwKICAgICAgICAgICAgICAgIEFjdGlvbiAgICAgICAgPT4gJFNlbGYtPntBY3Rpb259LAogICAgICAgICAgICAgICAgVXNlcklEICAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBpZiAoJEFDTCkgewogICAgICAgICAgICAgICAgbXkgJUZpbHRlciA9ICRUaWNrZXRPYmplY3QtPlRpY2tldEFjbERhdGEoKTsKCiAgICAgICAgICAgICAgICAjIGNvbnZlcnQgRmlsZXIga2V5ID0+IGtleSBiYWNrIHRvIGtleSA9PiB2YWx1ZSB1c2luZyBtYXAKICAgICAgICAgICAgICAgICV7JFBvc3NpYmxlVmFsdWVzfSA9IG1hcCB7ICRfID0+ICRQb3NzaWJsZVZhbHVlcy0+eyRffSB9IGtleXMgJUZpbHRlcjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbXkgJERhdGFWYWx1ZXMgPSAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdC0+QnVpbGRTZWxlY3Rpb25EYXRhR2V0KAogICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRDb25maWcsCiAgICAgICAgICAgICAgICBQb3NzaWJsZVZhbHVlcyAgICAgPT4gJFBvc3NpYmxlVmFsdWVzLAogICAgICAgICAgICAgICAgVmFsdWUgICAgICAgICAgICAgID0+ICREeW5hbWljRmllbGRWYWx1ZXN7ICREeW5hbWljRmllbGRDb25maWctPntOYW1lfSB9LAogICAgICAgICAgICApIHx8ICRQb3NzaWJsZVZhbHVlczsKCiAgICAgICAgICAgICMgYWRkIGR5bmFtaWMgZmllbGQgdG8gdGhlIEpTT05Db2xsZWN0b3IKICAgICAgICAgICAgcHVzaCgKICAgICAgICAgICAgICAgIEBKU09OQ29sbGVjdG9yLAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIE5hbWUgICAgICAgID0+ICdEeW5hbWljRmllbGRfJyAuICREeW5hbWljRmllbGRDb25maWctPntOYW1lfSwKICAgICAgICAgICAgICAgICAgICBEYXRhICAgICAgICA9PiAkRGF0YVZhbHVlcywKICAgICAgICAgICAgICAgICAgICBTZWxlY3RlZElEICA9PiAkRHluYW1pY0ZpZWxkVmFsdWVzeyAkRHluYW1pY0ZpZWxkQ29uZmlnLT57TmFtZX0gfSwKICAgICAgICAgICAgICAgICAgICBUcmFuc2xhdGlvbiA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnLT57Q29uZmlnfS0+e1RyYW5zbGF0YWJsZVZhbHVlc30gfHwgMCwKICAgICAgICAgICAgICAgICAgICBNYXggICAgICAgICA9PiAxMDAsCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGVsc2lmICggJFNlbGYtPntOYW1lVG9JRH17JEN1cnJlbnRGaWVsZH0gZXEgJ093bmVySUQnICkgewogICAgICAgICAgICBuZXh0IERJQUxPR0ZJRUxEIGlmICRGaWVsZHNQcm9jZXNzZWR7ICRTZWxmLT57TmFtZVRvSUR9eyRDdXJyZW50RmllbGR9IH07CgogICAgICAgICAgICBteSAkRGF0YSA9ICRTZWxmLT5fR2V0T3duZXJzKAogICAgICAgICAgICAgICAgJXsgJFBhcmFte0dldFBhcmFtfSB9LAogICAgICAgICAgICApOwoKICAgICAgICAgICAgIyBhZGQgT3duZXIgdG8gdGhlIEpTT05Db2xsZWN0b3IKICAgICAgICAgICAgcHVzaCgKICAgICAgICAgICAgICAgIEBKU09OQ29sbGVjdG9yLAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIE5hbWUgICAgICAgICA9PiAkU2VsZi0+e05hbWVUb0lEfXskQ3VycmVudEZpZWxkfSwKICAgICAgICAgICAgICAgICAgICBEYXRhICAgICAgICAgPT4gJERhdGEsCiAgICAgICAgICAgICAgICAgICAgU2VsZWN0ZWRJRCAgID0+ICRQYXJhbXtHZXRQYXJhbX17ICRTZWxmLT57TmFtZVRvSUR9eyRDdXJyZW50RmllbGR9IH0sCiAgICAgICAgICAgICAgICAgICAgUG9zc2libGVOb25lID0+IDEsCiAgICAgICAgICAgICAgICAgICAgVHJhbnNsYXRpb24gID0+IDAsCiAgICAgICAgICAgICAgICAgICAgTWF4ICAgICAgICAgID0+IDEwMCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CiAgICAgICAgICAgICRGaWVsZHNQcm9jZXNzZWR7ICRTZWxmLT57TmFtZVRvSUR9eyRDdXJyZW50RmllbGR9IH0gPSAxOwogICAgICAgIH0KICAgICAgICBlbHNpZiAoICRTZWxmLT57TmFtZVRvSUR9eyRDdXJyZW50RmllbGR9IGVxICdSZXNwb25zaWJsZUlEJyApIHsKICAgICAgICAgICAgbmV4dCBESUFMT0dGSUVMRCBpZiAkRmllbGRzUHJvY2Vzc2VkeyAkU2VsZi0+e05hbWVUb0lEfXskQ3VycmVudEZpZWxkfSB9OwoKICAgICAgICAgICAgbXkgJERhdGEgPSAkU2VsZi0+X0dldFJlc3BvbnNpYmxlcygKICAgICAgICAgICAgICAgICV7ICRQYXJhbXtHZXRQYXJhbX0gfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgYWRkIFJlc3BvbnNpYmxlIHRvIHRoZSBKU09OQ29sbGVjdG9yCiAgICAgICAgICAgIHB1c2goCiAgICAgICAgICAgICAgICBASlNPTkNvbGxlY3RvciwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBOYW1lICAgICAgICAgPT4gJFNlbGYtPntOYW1lVG9JRH17JEN1cnJlbnRGaWVsZH0sCiAgICAgICAgICAgICAgICAgICAgRGF0YSAgICAgICAgID0+ICREYXRhLAogICAgICAgICAgICAgICAgICAgIFNlbGVjdGVkSUQgICA9PiAkUGFyYW17R2V0UGFyYW19eyAkU2VsZi0+e05hbWVUb0lEfXskQ3VycmVudEZpZWxkfSB9LAogICAgICAgICAgICAgICAgICAgIFBvc3NpYmxlTm9uZSA9PiAxLAogICAgICAgICAgICAgICAgICAgIFRyYW5zbGF0aW9uICA9PiAwLAogICAgICAgICAgICAgICAgICAgIE1heCAgICAgICAgICA9PiAxMDAsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICApOwogICAgICAgICAgICAkRmllbGRzUHJvY2Vzc2VkeyAkU2VsZi0+e05hbWVUb0lEfXskQ3VycmVudEZpZWxkfSB9ID0gMTsKICAgICAgICB9CiAgICAgICAgZWxzaWYgKCAkU2VsZi0+e05hbWVUb0lEfXskQ3VycmVudEZpZWxkfSBlcSAnUXVldWVJRCcgKSB7CiAgICAgICAgICAgIG5leHQgRElBTE9HRklFTEQgaWYgJEZpZWxkc1Byb2Nlc3NlZHsgJFNlbGYtPntOYW1lVG9JRH17JEN1cnJlbnRGaWVsZH0gfTsKCiAgICAgICAgICAgIG15ICREYXRhID0gJFNlbGYtPl9HZXRRdWV1ZXMoCiAgICAgICAgICAgICAgICAleyAkUGFyYW17R2V0UGFyYW19IH0sCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAjIGFkZCBRdWV1ZSB0byB0aGUgSlNPTkNvbGxlY3RvcgogICAgICAgICAgICBwdXNoKAogICAgICAgICAgICAgICAgQEpTT05Db2xsZWN0b3IsCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgTmFtZSAgICAgICAgID0+ICRTZWxmLT57TmFtZVRvSUR9eyRDdXJyZW50RmllbGR9LAogICAgICAgICAgICAgICAgICAgIERhdGEgICAgICAgICA9PiAkRGF0YSwKICAgICAgICAgICAgICAgICAgICBTZWxlY3RlZElEICAgPT4gJFBhcmFte0dldFBhcmFtfXsgJFNlbGYtPntOYW1lVG9JRH17JEN1cnJlbnRGaWVsZH0gfSwKICAgICAgICAgICAgICAgICAgICBQb3NzaWJsZU5vbmUgPT4gMSwKICAgICAgICAgICAgICAgICAgICBUcmFuc2xhdGlvbiAgPT4gMCwKICAgICAgICAgICAgICAgICAgICBUcmVlVmlldyAgICAgPT4gJFRyZWVWaWV3LAogICAgICAgICAgICAgICAgICAgIE1heCAgICAgICAgICA9PiAxMDAsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICApOwogICAgICAgICAgICAkRmllbGRzUHJvY2Vzc2VkeyAkU2VsZi0+e05hbWVUb0lEfXskQ3VycmVudEZpZWxkfSB9ID0gMTsKICAgICAgICB9CgogICAgICAgIGVsc2lmICggJFNlbGYtPntOYW1lVG9JRH17JEN1cnJlbnRGaWVsZH0gZXEgJ1N0YXRlSUQnICkgewogICAgICAgICAgICBuZXh0IERJQUxPR0ZJRUxEIGlmICRGaWVsZHNQcm9jZXNzZWR7ICRTZWxmLT57TmFtZVRvSUR9eyRDdXJyZW50RmllbGR9IH07CgogICAgICAgICAgICBteSAkRGF0YSA9ICRTZWxmLT5fR2V0U3RhdGVzKAogICAgICAgICAgICAgICAgJXsgJFBhcmFte0dldFBhcmFtfSB9LAogICAgICAgICAgICApOwoKICAgICAgICAgICAgIyBhZGQgU3RhdGUgdG8gdGhlIEpTT05Db2xsZWN0b3IKICAgICAgICAgICAgcHVzaCgKICAgICAgICAgICAgICAgIEBKU09OQ29sbGVjdG9yLAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIE5hbWUgICAgICAgID0+ICdTdGF0ZUlEJywKICAgICAgICAgICAgICAgICAgICBEYXRhICAgICAgICA9PiAkRGF0YSwKICAgICAgICAgICAgICAgICAgICBTZWxlY3RlZElEICA9PiAkUGFyYW17R2V0UGFyYW19eyAkU2VsZi0+e05hbWVUb0lEfXskQ3VycmVudEZpZWxkfSB9LAogICAgICAgICAgICAgICAgICAgIFRyYW5zbGF0aW9uID0+IDEsCiAgICAgICAgICAgICAgICAgICAgTWF4ICAgICAgICAgPT4gMTAwLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgJEZpZWxkc1Byb2Nlc3NlZHsgJFNlbGYtPntOYW1lVG9JRH17JEN1cnJlbnRGaWVsZH0gfSA9IDE7CiAgICAgICAgfQogICAgICAgIGVsc2lmICggJFNlbGYtPntOYW1lVG9JRH17JEN1cnJlbnRGaWVsZH0gZXEgJ1ByaW9yaXR5SUQnICkgewogICAgICAgICAgICBuZXh0IERJQUxPR0ZJRUxEIGlmICRGaWVsZHNQcm9jZXNzZWR7ICRTZWxmLT57TmFtZVRvSUR9eyRDdXJyZW50RmllbGR9IH07CgogICAgICAgICAgICBteSAkRGF0YSA9ICRTZWxmLT5fR2V0UHJpb3JpdGllcygKICAgICAgICAgICAgICAgICV7ICRQYXJhbXtHZXRQYXJhbX0gfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgYWRkIFByaW9yaXR5IHRvIHRoZSBKU09OQ29sbGVjdG9yCiAgICAgICAgICAgIHB1c2goCiAgICAgICAgICAgICAgICBASlNPTkNvbGxlY3RvciwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBOYW1lICAgICAgICA9PiAkU2VsZi0+e05hbWVUb0lEfXskQ3VycmVudEZpZWxkfSwKICAgICAgICAgICAgICAgICAgICBEYXRhICAgICAgICA9PiAkRGF0YSwKICAgICAgICAgICAgICAgICAgICBTZWxlY3RlZElEICA9PiAkUGFyYW17R2V0UGFyYW19eyAkU2VsZi0+e05hbWVUb0lEfXskQ3VycmVudEZpZWxkfSB9LAogICAgICAgICAgICAgICAgICAgIFRyYW5zbGF0aW9uID0+IDEsCiAgICAgICAgICAgICAgICAgICAgTWF4ICAgICAgICAgPT4gMTAwLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgJEZpZWxkc1Byb2Nlc3NlZHsgJFNlbGYtPntOYW1lVG9JRH17JEN1cnJlbnRGaWVsZH0gfSA9IDE7CiAgICAgICAgfQogICAgICAgIGVsc2lmICggJFNlbGYtPntOYW1lVG9JRH17JEN1cnJlbnRGaWVsZH0gZXEgJ1NlcnZpY2VJRCcgKSB7CiAgICAgICAgICAgIG5leHQgRElBTE9HRklFTEQgaWYgJEZpZWxkc1Byb2Nlc3NlZHsgJFNlbGYtPntOYW1lVG9JRH17JEN1cnJlbnRGaWVsZH0gfTsKCiAgICAgICAgICAgIG15ICREYXRhID0gJFNlbGYtPl9HZXRTZXJ2aWNlcygKICAgICAgICAgICAgICAgICV7ICRQYXJhbXtHZXRQYXJhbX0gfSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgJFNlcnZpY2VzID0gJERhdGE7CgogICAgICAgICAgICAjIGFkZCBTZXJ2aWNlIHRvIHRoZSBKU09OQ29sbGVjdG9yIChVc2UgU2VydmljZUlEIGZyb20gd2ViIHJlcXVlc3QpCiAgICAgICAgICAgIHB1c2goCiAgICAgICAgICAgICAgICBASlNPTkNvbGxlY3RvciwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBOYW1lICAgICAgICAgPT4gJFNlbGYtPntOYW1lVG9JRH17JEN1cnJlbnRGaWVsZH0sCiAgICAgICAgICAgICAgICAgICAgRGF0YSAgICAgICAgID0+ICREYXRhLAogICAgICAgICAgICAgICAgICAgIFNlbGVjdGVkSUQgICA9PiAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnU2VydmljZUlEJyApIHx8ICcnLAogICAgICAgICAgICAgICAgICAgIFBvc3NpYmxlTm9uZSA9PiAxLAogICAgICAgICAgICAgICAgICAgIFRyYW5zbGF0aW9uICA9PiAwLAogICAgICAgICAgICAgICAgICAgIFRyZWVWaWV3ICAgICA9PiAkVHJlZVZpZXcsCiAgICAgICAgICAgICAgICAgICAgTWF4ICAgICAgICAgID0+IDEwMCwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CiAgICAgICAgICAgICRGaWVsZHNQcm9jZXNzZWR7ICRTZWxmLT57TmFtZVRvSUR9eyRDdXJyZW50RmllbGR9IH0gPSAxOwogICAgICAgIH0KICAgICAgICBlbHNpZiAoICRTZWxmLT57TmFtZVRvSUR9eyRDdXJyZW50RmllbGR9IGVxICdTTEFJRCcgKSB7CiAgICAgICAgICAgIG5leHQgRElBTE9HRklFTEQgaWYgJEZpZWxkc1Byb2Nlc3NlZHsgJFNlbGYtPntOYW1lVG9JRH17JEN1cnJlbnRGaWVsZH0gfTsKCiAgICAgICAgICAgICMgaWYgU0xBIGlzIHJlbmRlciBiZWZvcmUgc2VydmljZSAoYnkgaXQgb3JkZXIgaW4gdGhlIGZpZWxkcykgaXQgbmVlZHMgdG8gY3JlYXRlCiAgICAgICAgICAgICMgdGhlIHNlcnZpY2UgbGlzdAogICAgICAgICAgICBpZiAoICFJc0hhc2hSZWZXaXRoRGF0YSgkU2VydmljZXMpICkgewogICAgICAgICAgICAgICAgJFNlcnZpY2VzID0gJFNlbGYtPl9HZXRTZXJ2aWNlcygKICAgICAgICAgICAgICAgICAgICAleyAkUGFyYW17R2V0UGFyYW19IH0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICBteSAkRGF0YSA9ICRTZWxmLT5fR2V0U0xBcygKICAgICAgICAgICAgICAgICV7ICRQYXJhbXtHZXRQYXJhbX0gfSwKICAgICAgICAgICAgICAgIFNlcnZpY2VzICA9PiAkU2VydmljZXMsCiAgICAgICAgICAgICAgICBTZXJ2aWNlSUQgPT4gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ1NlcnZpY2VJRCcgKSB8fCAnJywKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgYWRkIFNMQSB0byB0aGUgSlNPTkNvbGxlY3RvciAoVXNlIFNlbGVjdGVkSUQgZnJvbSB3ZWIgcmVxdWVzdCkKICAgICAgICAgICAgcHVzaCgKICAgICAgICAgICAgICAgIEBKU09OQ29sbGVjdG9yLAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIE5hbWUgICAgICAgICA9PiAkU2VsZi0+e05hbWVUb0lEfXskQ3VycmVudEZpZWxkfSwKICAgICAgICAgICAgICAgICAgICBEYXRhICAgICAgICAgPT4gJERhdGEsCiAgICAgICAgICAgICAgICAgICAgU2VsZWN0ZWRJRCAgID0+ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdTTEFJRCcgKSB8fCAnJywKICAgICAgICAgICAgICAgICAgICBQb3NzaWJsZU5vbmUgPT4gMSwKICAgICAgICAgICAgICAgICAgICBUcmFuc2xhdGlvbiAgPT4gMCwKICAgICAgICAgICAgICAgICAgICBNYXggICAgICAgICAgPT4gMTAwLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgJEZpZWxkc1Byb2Nlc3NlZHsgJFNlbGYtPntOYW1lVG9JRH17JEN1cnJlbnRGaWVsZH0gfSA9IDE7CiAgICAgICAgfQogICAgICAgIGVsc2lmICggJFNlbGYtPntOYW1lVG9JRH17JEN1cnJlbnRGaWVsZH0gZXEgJ1R5cGVJRCcgKSB7CiAgICAgICAgICAgIG5leHQgRElBTE9HRklFTEQgaWYgJEZpZWxkc1Byb2Nlc3NlZHsgJFNlbGYtPntOYW1lVG9JRH17JEN1cnJlbnRGaWVsZH0gfTsKCiAgICAgICAgICAgIG15ICREYXRhID0gJFNlbGYtPl9HZXRUeXBlcygKICAgICAgICAgICAgICAgICV7ICRQYXJhbXtHZXRQYXJhbX0gfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgQWRkIFR5cGUgdG8gdGhlIEpTT05Db2xsZWN0b3IgKFVzZSBTZWxlY3RlZElEIGZyb20gd2ViIHJlcXVlc3QpLgogICAgICAgICAgICBwdXNoKAogICAgICAgICAgICAgICAgQEpTT05Db2xsZWN0b3IsCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgTmFtZSAgICAgICAgID0+ICRTZWxmLT57TmFtZVRvSUR9eyRDdXJyZW50RmllbGR9LAogICAgICAgICAgICAgICAgICAgIERhdGEgICAgICAgICA9PiAkRGF0YSwKICAgICAgICAgICAgICAgICAgICBTZWxlY3RlZElEICAgPT4gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ1R5cGVJRCcgKSB8fCAnJywKICAgICAgICAgICAgICAgICAgICBQb3NzaWJsZU5vbmUgPT4gMSwKICAgICAgICAgICAgICAgICAgICBUcmFuc2xhdGlvbiAgPT4gMCwKICAgICAgICAgICAgICAgICAgICBNYXggICAgICAgICAgPT4gMTAwLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgJEZpZWxkc1Byb2Nlc3NlZHsgJFNlbGYtPntOYW1lVG9JRH17JEN1cnJlbnRGaWVsZH0gfSA9IDE7CiAgICAgICAgfQogICAgICAgIGVsc2lmICgKICAgICAgICAgICAgJFNlbGYtPntOYW1lVG9JRH17JEN1cnJlbnRGaWVsZH0gZXEgJ0FydGljbGUnCiAgICAgICAgICAgICYmICRQYXJhbXtHZXRQYXJhbX0tPntFbGVtZW50Q2hhbmdlZH0gZXEgJ1N0YW5kYXJkVGVtcGxhdGVJRCcKICAgICAgICAgICAgKQogICAgICAgIHsKICAgICAgICAgICAgbmV4dCBESUFMT0dGSUVMRCBpZiAkRmllbGRzUHJvY2Vzc2VkeyAkU2VsZi0+e05hbWVUb0lEfXskQ3VycmVudEZpZWxkfSB9OwoKICAgICAgICAgICAgbXkgJFRlbXBsYXRlR2VuZXJhdG9yT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRlbXBsYXRlR2VuZXJhdG9yJyk7CiAgICAgICAgICAgIG15ICRTdGFuZGFyZFRlbXBsYXRlT2JqZWN0ICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpTdGFuZGFyZFRlbXBsYXRlJyk7CiAgICAgICAgICAgIG15ICRTdGRBdHRhY2htZW50T2JqZWN0ICAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpTdGRBdHRhY2htZW50Jyk7CiAgICAgICAgICAgIG15ICRVcGxvYWRDYWNoZU9iamVjdCAgICAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpXZWI6OlVwbG9hZENhY2hlJyk7CgogICAgICAgICAgICBteSAkU3RhbmRhcmRUZW1wbGF0ZVRleHQ7CiAgICAgICAgICAgIG15IEBUaWNrZXRBdHRhY2htZW50czsKCiAgICAgICAgICAgIGlmICggSXNQb3NpdGl2ZUludGVnZXIoICRQYXJhbXtHZXRQYXJhbX0tPntTdGFuZGFyZFRlbXBsYXRlSUR9ICkgKSB7CiAgICAgICAgICAgICAgICBteSAlU3RhbmRhcmRUZW1wbGF0ZSA9ICRTdGFuZGFyZFRlbXBsYXRlT2JqZWN0LT5TdGFuZGFyZFRlbXBsYXRlR2V0KAogICAgICAgICAgICAgICAgICAgIElEID0+ICRQYXJhbXtHZXRQYXJhbX0tPntTdGFuZGFyZFRlbXBsYXRlSUR9LAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAjIHJlbW92ZSBwcmUtc3VibWl0dGVkIGF0dGFjaG1lbnRzCiAgICAgICAgICAgICAgICAkVXBsb2FkQ2FjaGVPYmplY3QtPkZvcm1JRFJlbW92ZSggRm9ybUlEID0+ICRTZWxmLT57Rm9ybUlEfSApOwoKICAgICAgICAgICAgICAgICRTdGFuZGFyZFRlbXBsYXRlVGV4dCA9ICRUZW1wbGF0ZUdlbmVyYXRvck9iamVjdC0+X1JlcGxhY2UoCiAgICAgICAgICAgICAgICAgICAgUmljaFRleHQgPT4gJExheW91dE9iamVjdC0+e0Jyb3dzZXJSaWNoVGV4dH0sCiAgICAgICAgICAgICAgICAgICAgVGV4dCAgICAgPT4gJFN0YW5kYXJkVGVtcGxhdGV7VGVtcGxhdGV9LAogICAgICAgICAgICAgICAgICAgIERhdGEgICAgID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgJXsgJFBhcmFte0dldFBhcmFtfSB9LAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgVGlja2V0RGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICV7ICRQYXJhbXtHZXRQYXJhbX0gfSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIFVzZXJJRCA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICMgYWRkIHN0YW5kYXJkIGF0dGFjaG1lbnRzIHRvIHRpY2tldAogICAgICAgICAgICAgICAgbXkgJUFsbFN0ZEF0dGFjaG1lbnRzID0gJFN0ZEF0dGFjaG1lbnRPYmplY3QtPlN0ZEF0dGFjaG1lbnRTdGFuZGFyZFRlbXBsYXRlTWVtYmVyTGlzdCgKICAgICAgICAgICAgICAgICAgICBTdGFuZGFyZFRlbXBsYXRlSUQgPT4gJFBhcmFte0dldFBhcmFtfS0+e1N0YW5kYXJkVGVtcGxhdGVJRH0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgZm9yIG15ICRJRCAoIHNvcnQga2V5cyAlQWxsU3RkQXR0YWNobWVudHMgKSB7CiAgICAgICAgICAgICAgICAgICAgbXkgJUF0dGFjaG1lbnRzRGF0YSA9ICRTdGRBdHRhY2htZW50T2JqZWN0LT5TdGRBdHRhY2htZW50R2V0KCBJRCA9PiAkSUQgKTsKICAgICAgICAgICAgICAgICAgICAkVXBsb2FkQ2FjaGVPYmplY3QtPkZvcm1JREFkZEZpbGUoCiAgICAgICAgICAgICAgICAgICAgICAgIEZvcm1JRCAgICAgID0+ICRTZWxmLT57Rm9ybUlEfSwKICAgICAgICAgICAgICAgICAgICAgICAgRGlzcG9zaXRpb24gPT4gJ2F0dGFjaG1lbnQnLAogICAgICAgICAgICAgICAgICAgICAgICAlQXR0YWNobWVudHNEYXRhLAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgQFRpY2tldEF0dGFjaG1lbnRzID0gJFVwbG9hZENhY2hlT2JqZWN0LT5Gb3JtSURHZXRBbGxGaWxlc01ldGEoCiAgICAgICAgICAgICAgICAgICAgRm9ybUlEID0+ICRTZWxmLT57Rm9ybUlEfSwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgZm9yIG15ICRBdHRhY2htZW50IChAVGlja2V0QXR0YWNobWVudHMpIHsKICAgICAgICAgICAgICAgICAgICAkQXR0YWNobWVudC0+e0ZpbGVzaXplfSA9ICRMYXlvdXRPYmplY3QtPkh1bWFuUmVhZGFibGVEYXRhU2l6ZSgKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSA9PiAkQXR0YWNobWVudC0+e0ZpbGVzaXplfSwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBwdXNoKAogICAgICAgICAgICAgICAgQEpTT05Db2xsZWN0b3IsCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAnUmljaFRleHQnLAogICAgICAgICAgICAgICAgICAgIERhdGEgPT4gJFN0YW5kYXJkVGVtcGxhdGVUZXh0IC8vICcnLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICBOYW1lICAgICA9PiAnVGlja2V0QXR0YWNobWVudHMnLAogICAgICAgICAgICAgICAgICAgIERhdGEgICAgID0+IFxAVGlja2V0QXR0YWNobWVudHMsCiAgICAgICAgICAgICAgICAgICAgS2VlcERhdGEgPT4gMSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAkRmllbGRzUHJvY2Vzc2VkeyAkU2VsZi0+e05hbWVUb0lEfXskQ3VycmVudEZpZWxkfSB9ID0gMTsKICAgICAgICB9CiAgICB9CgogICAgbXkgJEpTT04gPSAkTGF5b3V0T2JqZWN0LT5CdWlsZFNlbGVjdGlvbkpTT04oIFtASlNPTkNvbGxlY3Rvcl0gKTsKCiAgICByZXR1cm4gJExheW91dE9iamVjdC0+QXR0YWNobWVudCgKICAgICAgICBDb250ZW50VHlwZSA9PiAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD0nIC4gJExheW91dE9iamVjdC0+e0NoYXJzZXR9LAogICAgICAgIENvbnRlbnQgICAgID0+ICRKU09OLAogICAgICAgIFR5cGUgICAgICAgID0+ICdpbmxpbmUnLAogICAgICAgIE5vQ2FjaGUgICAgID0+IDEsCiAgICApOwp9CgojID1jdXQKIwojIF9HZXRQYXJhbSgpCiMKIyByZXR1cm5zIHRoZSBjdXJyZW50IGRhdGEgc3RhdGUgb2YgdGhlIHN1Ym1pdHRlZCBpbmZvcm1hdGlvbgojCiMgVGhpcyBjb250YWlucyB0aGUgZm9sbG93aW5nIGRhdGEgZm9yIHRoZSBkaWZmZXJlbnQgY2FsbGVyczoKIwojICAgICBJbml0aWFsIGNhbGwgd2l0aCBzZWxlY3RlZCBQcm9jZXNzOgojICAgICAgICAgUHJvY2Vzc0VudGl0eUlECiMgICAgICAgICBBY3Rpdml0eURpYWxvZ0VudGl0eUlECiMgICAgICAgICBEZWZhdWx0VmFsdWVzIGZvciB0aGUgY29uZmlndXJlZCBGaWVsZHMgaW4gdGhhdCBBY3Rpdml0eURpYWxvZwojICAgICAgICAgRGVmYXVsdFZhbHVlcyBmb3IgdGhlIDQgcmVxdWlyZWQgRmllbGRzIFF1ZXVlIFN0YXRlIExvY2sgUHJpb3JpdHkKIwojICAgICBGaXJzdCBTdG9yZSBjYWxsIHN1Ym1pdHRpbmcgYW4gQWN0aXZpdHkgRGlhbG9nOgojICAgICAgICAgUHJvY2Vzc0VudGl0eUlECiMgICAgICAgICBBY3Rpdml0eURpYWxvZ0VudGl0eUlECiMgICAgICAgICBTdWJtaXR0ZWRWYWx1ZXMgZm9yIHRoZSBjdXJyZW50IEFjdGl2aXR5RGlhbG9nCiMgICAgICAgICBBY3Rpdml0eURpYWxvZyBEZWZhdWx0VmFsdWVzIGZvciBpbnZpc2libGUgZmllbGRzIG9mIHRoYXQgQWN0aXZpdHlEaWFsb2cKIyAgICAgICAgIERlZmF1bHRWYWx1ZXMgZm9yIHRoZSA0IHJlcXVpcmVkIEZpZWxkcyBRdWV1ZSBTdGF0ZSBMb2NrIFByaW9yaXR5CiMgICAgICAgICAgICAgaWYgbm90IGNvbmZpZ3VyZWQgaW4gdGhlIEFjdGl2aXR5RGlhbG9nCiMKIyAgICAgQWN0aXZpdHlEaWFsb2cgZmlsbG91dCByZXF1ZXN0IG9uIGV4aXN0aW5nIFRpY2tldDoKIyAgICAgICAgIFByb2Nlc3NFbnRpdHlJRAojICAgICAgICAgQWN0aXZpdHlEaWFsb2dFbnRpdHlJRAojICAgICAgICAgVGlja2V0VmFsdWVzCiMKIyAgICAgQWN0aXZpdHlEaWFsb2cgc3RvcmUgcmVxdWVzdCBvciBBamF4VXBkYXRlIHJlcXVlc3Qgb24gZXhpc3RpbmcgVGlja2V0czoKIyAgICAgICAgIFByb2Nlc3NFbnRpdHlJRAojICAgICAgICAgQWN0aXZpdHlEaWFsb2dFbnRpdHlJRAojICAgICAgICAgVGlja2V0VmFsdWVzIGZvciBhbGwgbm90LVN1Ym1pdHRlZCBWYWx1ZXMKIyAgICAgICAgIFN1Ym1pdHRlZCBWYWx1ZXMKIwojICAgICBteSAkR2V0UGFyYW0gPSBfR2V0UGFyYW0oCiMgICAgICAgICBQcm9jZXNzRW50aXR5SUQgPT4gJFByb2Nlc3NFbnRpdHlJRCwKIyAgICAgKTsKIwojID1jdXQKCnN1YiBfR2V0UGFyYW0gewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjbXkgJElzQUpBWFVwZGF0ZSA9ICRQYXJhbXtBSkFYfSB8fCAnJzsKCiAgICAjIGdldCBsYXlvdXQgb2JqZWN0CiAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwoKICAgIGZvciBteSAkTmVlZGVkIChxdyhQcm9jZXNzRW50aXR5SUQpKSB7CiAgICAgICAgaWYgKCAhJFBhcmFteyROZWVkZWR9ICkgewogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5GYXRhbEVycm9yKAogICAgICAgICAgICAgICAgTWVzc2FnZSA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9CiAgICAgICAgICAgICAgICAgICAgLT5UcmFuc2xhdGUoICdQYXJhbWV0ZXIgJXMgaXMgbWlzc2luZyBpbiAlcy4nLCAkTmVlZGVkLCAnX0dldFBhcmFtJyApLAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICAjIGdldCBwYXJhbSBvYmplY3QKICAgIG15ICRQYXJhbU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpXZWI6OlJlcXVlc3QnKTsKCiAgICBteSAlR2V0UGFyYW07CiAgICBteSAlVGlja2V0OwogICAgbXkgJFByb2Nlc3NFbnRpdHlJRCAgICAgICAgPSAkUGFyYW17UHJvY2Vzc0VudGl0eUlEfTsKICAgIG15ICRUaWNrZXRJRCAgICAgICAgICAgICAgID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ1RpY2tldElEJyApOwogICAgbXkgJEFjdGl2aXR5RGlhbG9nRW50aXR5SUQgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKAogICAgICAgIFBhcmFtID0+ICdBY3Rpdml0eURpYWxvZ0VudGl0eUlEJywKICAgICk7CiAgICBteSAkQWN0aXZpdHlFbnRpdHlJRDsKICAgIG15ICVWYWx1ZXNHb3R0ZW47CiAgICBteSAkVmFsdWU7CgogICAgIyBnZXQgYWN0aXZpdHkgZGlhbG9nIG9iamVjdAogICAgbXkgJEFjdGl2aXR5RGlhbG9nT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlByb2Nlc3NNYW5hZ2VtZW50OjpBY3Rpdml0eURpYWxvZycpOwoKICAgICMgY3JlYXRlIHByb2Nlc3Mgb2JqZWN0CiAgICAkS2VybmVsOjpPTS0+T2JqZWN0UGFyYW1BZGQoCiAgICAgICAgJ0tlcm5lbDo6U3lzdGVtOjpQcm9jZXNzTWFuYWdlbWVudDo6UHJvY2VzcycgPT4gewogICAgICAgICAgICBBY3Rpdml0eU9iamVjdCAgICAgICAgID0+ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpQcm9jZXNzTWFuYWdlbWVudDo6QWN0aXZpdHknKSwKICAgICAgICAgICAgQWN0aXZpdHlEaWFsb2dPYmplY3QgICA9PiAkQWN0aXZpdHlEaWFsb2dPYmplY3QsCiAgICAgICAgICAgIFRyYW5zaXRpb25PYmplY3QgICAgICAgPT4gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlByb2Nlc3NNYW5hZ2VtZW50OjpUcmFuc2l0aW9uJyksCiAgICAgICAgICAgIFRyYW5zaXRpb25BY3Rpb25PYmplY3QgPT4gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlByb2Nlc3NNYW5hZ2VtZW50OjpUcmFuc2l0aW9uQWN0aW9uJyksCiAgICAgICAgfQogICAgKTsKICAgIG15ICRQcm9jZXNzT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlByb2Nlc3NNYW5hZ2VtZW50OjpQcm9jZXNzJyk7CgogICAgIyBJZiB3ZSBnb3Qgbm8gQWN0aXZpdHlEaWFsb2dFbnRpdHlJRCBhbmQgbm8gVGlja2V0SUQKICAgICMgd2UgaGF2ZSB0byBnZXQgdGhlIFByb2Nlc3NlcycgU3RhcnRwb2ludAogICAgaWYgKCAhJEFjdGl2aXR5RGlhbG9nRW50aXR5SUQgJiYgKCAhJFRpY2tldElEIHx8ICRTZWxmLT57SXNQcm9jZXNzRW5yb2xsfSApICkgewogICAgICAgIG15ICRBY3Rpdml0eUFjdGl2aXR5RGlhbG9nID0gJFByb2Nlc3NPYmplY3QtPlByb2Nlc3NTdGFydHBvaW50R2V0KAogICAgICAgICAgICBQcm9jZXNzRW50aXR5SUQgPT4gJFByb2Nlc3NFbnRpdHlJRCwKICAgICAgICApOwogICAgICAgIGlmICgKICAgICAgICAgICAgISRBY3Rpdml0eUFjdGl2aXR5RGlhbG9nLT57QWN0aXZpdHlEaWFsb2d9CiAgICAgICAgICAgIHx8ICEkQWN0aXZpdHlBY3Rpdml0eURpYWxvZy0+e0FjdGl2aXR5fQogICAgICAgICAgICApCiAgICAgICAgewogICAgICAgICAgICBteSAkTWVzc2FnZSA9ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgKICAgICAgICAgICAgICAgICdHb3Qgbm8gU3RhcnQgQWN0aXZpdHlFbnRpdHlJRCBvciBTdGFydCBBY3Rpdml0eURpYWxvZ0VudGl0eUlEIGZvciBQcm9jZXNzOiAlcyBpbiBfR2V0UGFyYW0hJywKICAgICAgICAgICAgICAgICRQcm9jZXNzRW50aXR5SUQsCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAjIGRvZXMgbm90IHNob3cgaGVhZGVyIGFuZCBmb290ZXIgYWdhaW4KICAgICAgICAgICAgaWYgKCAkU2VsZi0+e0lzTWFpbldpbmRvd30gKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+RXJyb3IoCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PiAkTWVzc2FnZSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkZhdGFsRXJyb3IoCiAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRNZXNzYWdlLAogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICAkQWN0aXZpdHlEaWFsb2dFbnRpdHlJRCA9ICRBY3Rpdml0eUFjdGl2aXR5RGlhbG9nLT57QWN0aXZpdHlEaWFsb2d9OwogICAgICAgICRBY3Rpdml0eUVudGl0eUlEICAgICAgID0gJEFjdGl2aXR5QWN0aXZpdHlEaWFsb2ctPntBY3Rpdml0eX07CiAgICB9CgogICAgbXkgJEFjdGl2aXR5RGlhbG9nID0gJEFjdGl2aXR5RGlhbG9nT2JqZWN0LT5BY3Rpdml0eURpYWxvZ0dldCgKICAgICAgICBBY3Rpdml0eURpYWxvZ0VudGl0eUlEID0+ICRBY3Rpdml0eURpYWxvZ0VudGl0eUlELAogICAgICAgIEludGVyZmFjZSAgICAgICAgICAgICAgPT4gJ0FnZW50SW50ZXJmYWNlJywKICAgICk7CgogICAgaWYgKCAhSXNIYXNoUmVmV2l0aERhdGEoJEFjdGl2aXR5RGlhbG9nKSApIHsKICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+RXJyb3JTY3JlZW4oCiAgICAgICAgICAgIE1lc3NhZ2UgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKAogICAgICAgICAgICAgICAgJ0NvdWxkblwndCBnZXQgQWN0aXZpdHlEaWFsb2dFbnRpdHlJRCAiJXMiIScsCiAgICAgICAgICAgICAgICAkQWN0aXZpdHlEaWFsb2dFbnRpdHlJRCwKICAgICAgICAgICAgKSwKICAgICAgICAgICAgQ29tbWVudCA9PiBUcmFuc2xhdGFibGUoJ1BsZWFzZSBjb250YWN0IHRoZSBhZG1pbmlzdHJhdG9yLicpLAogICAgICAgICk7CiAgICB9CgogICAgIyBnZXQgY29uZmlnIG9iamVjdAogICAgbXkgJENvbmZpZ09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CgogICAgIyBpZiB0aGVyZSBpcyBhIHRpY2tldCB0aGVuIGlzIG5vdCBhbiBBSkFYIHJlcXVlc3QKICAgIGlmICgkVGlja2V0SUQpIHsKICAgICAgICAlVGlja2V0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpY2tldCcpLT5UaWNrZXRHZXQoCiAgICAgICAgICAgIFRpY2tldElEICAgICAgPT4gJFRpY2tldElELAogICAgICAgICAgICBVc2VySUQgICAgICAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgRHluYW1pY0ZpZWxkcyA9PiAxLAogICAgICAgICk7CgogICAgICAgICVHZXRQYXJhbSA9ICVUaWNrZXQ7CiAgICAgICAgaWYgKCAhSXNIYXNoUmVmV2l0aERhdGEoIFwlR2V0UGFyYW0gKSApIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigKICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKAogICAgICAgICAgICAgICAgICAgICdDb3VsZG5cJ3QgZ2V0IFRpY2tldCBmb3IgVGlja2V0SUQ6ICVzIGluIF9HZXRQYXJhbSEnLAogICAgICAgICAgICAgICAgICAgICRUaWNrZXRJRCwKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICBpZiAoICEkU2VsZi0+e0lzUHJvY2Vzc0Vucm9sbH0gKSB7CiAgICAgICAgICAgICRBY3Rpdml0eUVudGl0eUlEID0gJFRpY2tldHsKICAgICAgICAgICAgICAgICdEeW5hbWljRmllbGRfJwogICAgICAgICAgICAgICAgICAgIC4gJENvbmZpZ09iamVjdC0+R2V0KCJQcm9jZXNzOjpEeW5hbWljRmllbGRQcm9jZXNzTWFuYWdlbWVudEFjdGl2aXR5SUQiKQogICAgICAgICAgICB9OwogICAgICAgICAgICBpZiAoICEkQWN0aXZpdHlFbnRpdHlJRCApIHsKICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkZhdGFsRXJyb3IoCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PiBUcmFuc2xhdGFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgICdDb3VsZG5cJ3QgZGV0ZXJtaW5lIEFjdGl2aXR5RW50aXR5SUQuIER5bmFtaWNGaWVsZCBvciBDb25maWcgaXNuXCd0IHNldCBwcm9wZXJseSEnCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgfQogICAgJEdldFBhcmFte0FjdGl2aXR5RGlhbG9nRW50aXR5SUR9ID0gJEFjdGl2aXR5RGlhbG9nRW50aXR5SUQ7CiAgICAkR2V0UGFyYW17QWN0aXZpdHlFbnRpdHlJRH0gICAgICAgPSAkQWN0aXZpdHlFbnRpdHlJRDsKICAgICRHZXRQYXJhbXtQcm9jZXNzRW50aXR5SUR9ICAgICAgICA9ICRQcm9jZXNzRW50aXR5SUQ7CgogICAgIyBHZXQgdGhlIGFjdGl2aXR5ZGlhbG9ncydzIFN1Ym1pdCBQYXJhbSdzIG9yIENvbmZpZyBQYXJhbXMKICAgIERJQUxPR0ZJRUxEOgogICAgZm9yIG15ICRDdXJyZW50RmllbGQgKCBAeyAkQWN0aXZpdHlEaWFsb2ctPntGaWVsZE9yZGVyfSB9ICkgewoKICAgICAgICAjIFNraXAgaWYgd2UncmUgd29ya2luZyBvbiBhIGZpZWxkIHRoYXQgd2FzIGFscmVhZHkgZG9uZSB3aXRoIG9yIHdpdGhvdXQgSUQKICAgICAgICBpZiAoICRTZWxmLT57TmFtZVRvSUR9eyRDdXJyZW50RmllbGR9ICYmICRWYWx1ZXNHb3R0ZW57ICRTZWxmLT57TmFtZVRvSUR9eyRDdXJyZW50RmllbGR9IH0gKQogICAgICAgIHsKICAgICAgICAgICAgbmV4dCBESUFMT0dGSUVMRDsKICAgICAgICB9CgogICAgICAgIGlmICggJEN1cnJlbnRGaWVsZCA9fiBte15EeW5hbWljRmllbGRfKC4qKX14bXMgKSB7CiAgICAgICAgICAgIG15ICREeW5hbWljRmllbGROYW1lID0gJDE7CgogICAgICAgICAgICBteSAkRHluYW1pY0ZpZWxkID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkR5bmFtaWNGaWVsZCcpLT5EeW5hbWljRmllbGRMaXN0R2V0KAogICAgICAgICAgICAgICAgVmFsaWQgICAgICA9PiAxLAogICAgICAgICAgICAgICAgT2JqZWN0VHlwZSA9PiAnVGlja2V0JywKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgR2V0IHRoZSBDb25maWcgb2YgdGhlIGN1cnJlbnQgRHluYW1pY0ZpZWxkICh0aGUgZmlyc3QgZWxlbWVudCBvZiB0aGUgZ3JlcCByZXN1bHQgYXJyYXkpCiAgICAgICAgICAgIG15ICREeW5hbWljRmllbGRDb25maWcgPSAoIGdyZXAgeyAkXy0+e05hbWV9IGVxICREeW5hbWljRmllbGROYW1lIH0gQHskRHluYW1pY0ZpZWxkfSApWzBdOwoKICAgICAgICAgICAgaWYgKCAhSXNIYXNoUmVmV2l0aERhdGEoJER5bmFtaWNGaWVsZENvbmZpZykgKSB7CiAgICAgICAgICAgICAgICBteSAkTWVzc2FnZSA9CiAgICAgICAgICAgICAgICAgICAgIkR5bmFtaWNGaWVsZENvbmZpZyBtaXNzaW5nIGZvciBmaWVsZDogJER5bmFtaWNGaWVsZE5hbWUsIG9yIGlzIG5vdCBhIFRpY2tldCBEeW5hbWljIEZpZWxkISI7CgogICAgICAgICAgICAgICAgIyBsb2cgZXJyb3IgYnV0IGRvZXMgbm90IHN0b3AgdGhlIGV4ZWN1dGlvbiBhcyBpdCBjb3VsZCBiZSBhbiBvbGQgQXJ0aWNsZQogICAgICAgICAgICAgICAgIyBEeW5hbWljRmllbGQsIHNlZSBidWcjMTE2NjYKICAgICAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gJE1lc3NhZ2UsCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgIG5leHQgRElBTE9HRklFTEQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgR2V0IER5bmFtaWNGaWVsZCBWYWx1ZXMKICAgICAgICAgICAgJFZhbHVlID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkR5bmFtaWNGaWVsZDo6QmFja2VuZCcpLT5FZGl0RmllbGRWYWx1ZUdldCgKICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZENvbmZpZyA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnLAogICAgICAgICAgICAgICAgUGFyYW1PYmplY3QgICAgICAgID0+ICRQYXJhbU9iamVjdCwKICAgICAgICAgICAgICAgIExheW91dE9iamVjdCAgICAgICA9PiAkTGF5b3V0T2JqZWN0LAogICAgICAgICAgICApOwoKICAgICAgICAgICAgIyBJZiB3ZSBnb3QgYSBzdWJtaXR0ZWQgcGFyYW0sIHRha2UgaXQgYW5kIG5leHQgb3V0CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIGRlZmluZWQgJFZhbHVlCiAgICAgICAgICAgICAgICAmJiAoCiAgICAgICAgICAgICAgICAgICAgJFZhbHVlIGVxICcnCiAgICAgICAgICAgICAgICAgICAgfHwgSXNTdHJpbmdXaXRoRGF0YSgkVmFsdWUpCiAgICAgICAgICAgICAgICAgICAgfHwgSXNBcnJheVJlZldpdGhEYXRhKCRWYWx1ZSkKICAgICAgICAgICAgICAgICAgICB8fCBJc0hhc2hSZWZXaXRoRGF0YSgkVmFsdWUpCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRHZXRQYXJhbXskQ3VycmVudEZpZWxkfSA9ICRWYWx1ZTsKICAgICAgICAgICAgICAgIG5leHQgRElBTE9HRklFTEQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgSWYgd2UgZGlkbid0IGhhdmUgYSBQYXJhbSBWYWx1ZSB0cnkgdGhlIHRpY2tldCBWYWx1ZQogICAgICAgICAgICAjIG5leHQgb3V0IGlmIGl0IHdhcyBzdWNjZXNzZnVsCiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIGRlZmluZWQgJFRpY2tldHskQ3VycmVudEZpZWxkfQogICAgICAgICAgICAgICAgJiYgKAogICAgICAgICAgICAgICAgICAgICRUaWNrZXR7JEN1cnJlbnRGaWVsZH0gZXEgJycKICAgICAgICAgICAgICAgICAgICB8fCBJc1N0cmluZ1dpdGhEYXRhKCAkVGlja2V0eyRDdXJyZW50RmllbGR9ICkKICAgICAgICAgICAgICAgICAgICB8fCBJc0FycmF5UmVmV2l0aERhdGEoICRUaWNrZXR7JEN1cnJlbnRGaWVsZH0gKQogICAgICAgICAgICAgICAgICAgIHx8IElzSGFzaFJlZldpdGhEYXRhKCAkVGlja2V0eyRDdXJyZW50RmllbGR9ICkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJEdldFBhcmFteyRDdXJyZW50RmllbGR9ID0gJFRpY2tldHskQ3VycmVudEZpZWxkfTsKICAgICAgICAgICAgICAgIG5leHQgRElBTE9HRklFTEQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgSWYgd2UgaGFkIG5laXRoZXIgc3VibWl0dGVkIG5vciB0aWNrZXQgcGFyYW0gZ2V0IHRoZSBBY3Rpdml0eURpYWxvZydzIGRlZmF1bHQgVmFsdWUKICAgICAgICAgICAgIyBuZXh0IG91dCBpZiBpdCB3YXMgc3VjY2Vzc2Z1bAogICAgICAgICAgICAkVmFsdWUgPSAkQWN0aXZpdHlEaWFsb2ctPntGaWVsZHN9eyRDdXJyZW50RmllbGR9e0RlZmF1bHRWYWx1ZX07CiAgICAgICAgICAgIGlmICggZGVmaW5lZCAkVmFsdWUgJiYgbGVuZ3RoICRWYWx1ZSApIHsKICAgICAgICAgICAgICAgICRHZXRQYXJhbXskQ3VycmVudEZpZWxkfSA9ICRWYWx1ZTsKICAgICAgICAgICAgICAgIG5leHQgRElBTE9HRklFTEQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgSWYgd2UgaGFkIG5vIHN1Ym1pdHRlZCwgdGlja2V0IG9yIEFjdGl2aXR5RGlhbG9nIGRlZmF1bHQgdmFsdWUKICAgICAgICAgICAgIyB1c2UgdGhlIER5bmFtaWNGaWVsZCdzIGRlZmF1bHQgdmFsdWUgYW5kIG5leHQgb3V0CiAgICAgICAgICAgICRWYWx1ZSA9ICREeW5hbWljRmllbGRDb25maWctPntDb25maWd9e0RlZmF1bHRWYWx1ZX07CiAgICAgICAgICAgIGlmICggZGVmaW5lZCAkVmFsdWUgJiYgbGVuZ3RoICRWYWx1ZSApIHsKICAgICAgICAgICAgICAgICRHZXRQYXJhbXskQ3VycmVudEZpZWxkfSA9ICRWYWx1ZTsKICAgICAgICAgICAgICAgIG5leHQgRElBTE9HRklFTEQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgaWYgYWxsIHRoYXQgZmFpbGVkIHRoZW4gdGhlIGZpZWxkIHNob3VsZCBub3QgaGF2ZSBhIGRlZmluZWQgdmFsdWUgb3RoZXJ3aXNlCiAgICAgICAgICAgICMgaWYgYSB2YWx1ZSAoZXZlbiBlbXB0eSkgaXMgc2VudCwgZmllbGRzIGxpa2UgRGF0ZSBvciBEYXRlVGltZSB3aWxsIG1hcmsgdGhlIGZpZWxkIGFzCiAgICAgICAgICAgICMgdXNlZCB3aXRoIHRoZSBmaWVsZCBkaXNwbGF5IHZhbHVlLCB0aGlzIGNvdWxkIGxlYWQgdG8gdW53YW50ZWQgZmllbGQgc2V0cywKICAgICAgICAgICAgIyBzZWUgYnVnIzkxNTkKICAgICAgICAgICAgbmV4dCBESUFMT0dGSUVMRDsKICAgICAgICB9CgogICAgICAgICMgZ2V0IGF0dGFjaG1lbnQgZmllbGRzCiAgICAgICAgaWYgKCAkQ3VycmVudEZpZWxkIGVxICdBdHRhY2htZW50cycgKSB7CiAgICAgICAgICAgIEB7ICRHZXRQYXJhbXtBdHRhY2htZW50c30gfSA9ICRQYXJhbU9iamVjdC0+R2V0QXJyYXkoCiAgICAgICAgICAgICAgICBQYXJhbSA9PiAnQXR0YWNobWVudHMnLAogICAgICAgICAgICApOwogICAgICAgICAgICBuZXh0IERJQUxPR0ZJRUxEOwogICAgICAgIH0KCiAgICAgICAgIyBnZXQgYXJ0aWNsZSBmaWVsZHMKICAgICAgICBpZiAoICRDdXJyZW50RmllbGQgZXEgJ0FydGljbGUnICkgewoKICAgICAgICAgICAgJEdldFBhcmFte1N1YmplY3R9ID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ1N1YmplY3QnICk7CiAgICAgICAgICAgICRHZXRQYXJhbXtCb2R5fSAgICA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdCb2R5JyApOwogICAgICAgICAgICBAeyAkR2V0UGFyYW17SW5mb3JtVXNlcklEfSB9ID0gJFBhcmFtT2JqZWN0LT5HZXRBcnJheSgKICAgICAgICAgICAgICAgIFBhcmFtID0+ICdJbmZvcm1Vc2VySUQnLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgJFZhbHVlc0dvdHRlbntBcnRpY2xlfSA9IDEgaWYgKCAkR2V0UGFyYW17U3ViamVjdH0gJiYgJEdldFBhcmFte0JvZHl9ICk7CgogICAgICAgICAgICAkR2V0UGFyYW17VGltZVVuaXRzfSAgICAgICAgICA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdUaW1lVW5pdHMnICk7CiAgICAgICAgICAgICRHZXRQYXJhbXtTdGFuZGFyZFRlbXBsYXRlSUR9ID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ1N0YW5kYXJkVGVtcGxhdGVJRCcgKTsKICAgICAgICB9CgogICAgICAgIGlmICggJEN1cnJlbnRGaWVsZCBlcSAnQ3VzdG9tZXJJRCcgKSB7CiAgICAgICAgICAgICRHZXRQYXJhbXtDdXN0b21lcn0gPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKAogICAgICAgICAgICAgICAgUGFyYW0gPT4gJ1NlbGVjdGVkQ3VzdG9tZXJVc2VyJywKICAgICAgICAgICAgKSB8fCAnJzsKICAgICAgICAgICAgJEdldFBhcmFte0N1c3RvbWVyVXNlcklEfSA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oCiAgICAgICAgICAgICAgICBQYXJhbSA9PiAnU2VsZWN0ZWRDdXN0b21lclVzZXInLAogICAgICAgICAgICApIHx8ICcnOwogICAgICAgIH0KCiAgICAgICAgaWYgKCAkQ3VycmVudEZpZWxkIGVxICdQZW5kaW5nVGltZScgKSB7CiAgICAgICAgICAgIG15ICRQcmVmaXggPSAnUGVuZGluZ1RpbWUnOwoKICAgICAgICAgICAgIyBPaywgd2UgbmVlZCB0byB0cnkgdG8gZmluZCB0aGUgdGFyZ2V0IHN0YXRlIG5vdwogICAgICAgICAgICBteSAlU3RhdGVEYXRhOwoKICAgICAgICAgICAgIyBnZXQgc3RhdGUgb2JqZWN0CiAgICAgICAgICAgIG15ICRTdGF0ZU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpTdGF0ZScpOwoKICAgICAgICAgICAgIyBXYXMgc29tZXRoaW5nIHN1Ym1pdHRlZCBmcm9tIHRoZSBHVUk/CiAgICAgICAgICAgIG15ICRUYXJnZXRTdGF0ZUlEID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ1N0YXRlSUQnICk7CiAgICAgICAgICAgIGlmICgkVGFyZ2V0U3RhdGVJRCkgewogICAgICAgICAgICAgICAgJVN0YXRlRGF0YSA9ICRTdGF0ZU9iamVjdC0+U3RhdGVHZXQoCiAgICAgICAgICAgICAgICAgICAgSUQgPT4gJFRhcmdldFN0YXRlSUQsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIEZhbGxiYWNrIDE6IGRlZmF1bHQgdmFsdWUgb2YgZGlhbG9nIGZpZWxkIFN0YXRlCiAgICAgICAgICAgIGlmICggISVTdGF0ZURhdGEgJiYgJEFjdGl2aXR5RGlhbG9nLT57RmllbGRzfXtTdGF0ZX17RGVmYXVsdFZhbHVlfSApIHsKICAgICAgICAgICAgICAgICVTdGF0ZURhdGEgPSAkU3RhdGVPYmplY3QtPlN0YXRlR2V0KAogICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gJEFjdGl2aXR5RGlhbG9nLT57RmllbGRzfXtTdGF0ZX17RGVmYXVsdFZhbHVlfSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgRmFsbGJhY2sgMjogZGVmYXVsdCB2YWx1ZSBvZiBkaWFsb2cgZmllbGQgU3RhdGVJRAogICAgICAgICAgICBpZiAoICElU3RhdGVEYXRhICYmICRBY3Rpdml0eURpYWxvZy0+e0ZpZWxkc317U3RhdGVJRH17RGVmYXVsdFZhbHVlfSApIHsKICAgICAgICAgICAgICAgICVTdGF0ZURhdGEgPSAkU3RhdGVPYmplY3QtPlN0YXRlR2V0KAogICAgICAgICAgICAgICAgICAgIElEID0+ICRBY3Rpdml0eURpYWxvZy0+e0ZpZWxkc317U3RhdGVJRH17RGVmYXVsdFZhbHVlfSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgRmFsbGJhY2sgMzogZXhpc3RpbmcgdGlja2V0IHN0YXRlCiAgICAgICAgICAgIGlmICggISVTdGF0ZURhdGEgJiYgJVRpY2tldCApIHsKICAgICAgICAgICAgICAgICVTdGF0ZURhdGEgPSAkU3RhdGVPYmplY3QtPlN0YXRlR2V0KAogICAgICAgICAgICAgICAgICAgIElEID0+ICRUaWNrZXR7U3RhdGVJRH0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGdldCBwZW5kaW5nIHRpbWUgdmFsdWVzCiAgICAgICAgICAgICMgZGVwZW5kcyBvbiBTdGF0ZVR5cGUgY29udGFpbmluZyAnXnBlbmRpbmcnCiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIElzSGFzaFJlZldpdGhEYXRhKCBcJVN0YXRlRGF0YSApCiAgICAgICAgICAgICAgICAmJiAkU3RhdGVEYXRhe1R5cGVOYW1lfQogICAgICAgICAgICAgICAgJiYgJFN0YXRlRGF0YXtUeXBlTmFtZX0gPX4gL15wZW5kaW5nL2kKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgewoKICAgICAgICAgICAgICAgICMgbWFwIHRoZSBHZXRQYXJhbSdzIERhdGUgVmFsdWVzIHRvIG91ciBEYXRlUGFyYW1IYXNoCiAgICAgICAgICAgICAgICBteSAlRGF0ZVBhcmFtID0gKAogICAgICAgICAgICAgICAgICAgIFByZWZpeCA9PiAkUHJlZml4LAogICAgICAgICAgICAgICAgICAgIG1hcCB7CiAgICAgICAgICAgICAgICAgICAgICAgICggJFByZWZpeCAuICRfICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgID0+ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICggJFByZWZpeCAuICRfICkgKQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHF3KFllYXIgTW9udGggRGF5IEhvdXIgTWludXRlKQogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAjIGlmIGFsbCB2YWx1ZXMgYXJlIHByZXNlbnQKICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICBkZWZpbmVkICREYXRlUGFyYW17ICRQcmVmaXggLiAnWWVhcicgfQogICAgICAgICAgICAgICAgICAgICYmIGRlZmluZWQgJERhdGVQYXJhbXsgJFByZWZpeCAuICdNb250aCcgfQogICAgICAgICAgICAgICAgICAgICYmIGRlZmluZWQgJERhdGVQYXJhbXsgJFByZWZpeCAuICdEYXknIH0KICAgICAgICAgICAgICAgICAgICAmJiBkZWZpbmVkICREYXRlUGFyYW17ICRQcmVmaXggLiAnSG91cicgfQogICAgICAgICAgICAgICAgICAgICYmIGRlZmluZWQgJERhdGVQYXJhbXsgJFByZWZpeCAuICdNaW51dGUnIH0KICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICB7CgogICAgICAgICAgICAgICAgICAgICMgcmVjYWxjdWxhdGUgdGltZSBhY2NvcmRpbmcgdG8gdGhlIHVzZXIncyB0aW1lem9uZQogICAgICAgICAgICAgICAgICAgICVEYXRlUGFyYW0gPSAkTGF5b3V0T2JqZWN0LT5UcmFuc2Zvcm1EYXRlU2VsZWN0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICAlRGF0ZVBhcmFtLAogICAgICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgICAgICMgcmVmb3JtYXQgZm9yIHN0b3JpbmcgKGUuZy4gdGFrZSBvdXQgUHJlZml4KQogICAgICAgICAgICAgICAgICAgICV7ICRHZXRQYXJhbXskQ3VycmVudEZpZWxkfSB9CiAgICAgICAgICAgICAgICAgICAgICAgID0gbWFwIHsgJF8gPT4gJERhdGVQYXJhbXsgJFByZWZpeCAuICRfIH0gfSBxdyhZZWFyIE1vbnRoIERheSBIb3VyIE1pbnV0ZSk7CiAgICAgICAgICAgICAgICAgICAgJFZhbHVlc0dvdHRlbntQZW5kaW5nVGltZX0gPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIE5vbiBEeW5hbWljRmllbGRzCiAgICAgICAgIyAxLiB0cnkgdG8gZ2V0IHRoZSByZXF1aXJlZCBwYXJhbQogICAgICAgIG15ICRWYWx1ZSA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICRTZWxmLT57TmFtZVRvSUR9eyRDdXJyZW50RmllbGR9ICk7CgogICAgICAgIGlmICgkVmFsdWUpIHsKCiAgICAgICAgICAgICMgaWYgd2UgaGF2ZSBhbiBJRCBmaWVsZCBtYWtlIHN1cmUgdGhlIHZhbHVlIHdpdGhvdXQgSUQgd29uJ3QgYmUgaW4gdGhlCiAgICAgICAgICAgICMgJUdldFBhcmFtIEhhc2ggYW55IG1vcmUKICAgICAgICAgICAgaWYgKCAkU2VsZi0+e05hbWVUb0lEfXskQ3VycmVudEZpZWxkfSA9fiBteyguKilJRCR9eG1zICkgewogICAgICAgICAgICAgICAgJEdldFBhcmFteyQxfSA9IHVuZGVmOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRHZXRQYXJhbXsgJFNlbGYtPntOYW1lVG9JRH17JEN1cnJlbnRGaWVsZH0gfSAgICAgPSAkVmFsdWU7CiAgICAgICAgICAgICRWYWx1ZXNHb3R0ZW57ICRTZWxmLT57TmFtZVRvSUR9eyRDdXJyZW50RmllbGR9IH0gPSAxOwogICAgICAgICAgICBuZXh0IERJQUxPR0ZJRUxEOwogICAgICAgIH0KCiAgICAgICAgIyBJZiB3ZSBnb3QgdGlja2V0IHBhcmFtcywgdGhlIEdldFBhcmFtIEhhc2ggd2FzIGFscmVhZHkgZmlsbGVkIGJlZm9yZSB0aGUgbG9vcAogICAgICAgICMgYW5kIHdlIGNhbiBuZXh0IG91dAogICAgICAgIGlmICggJEdldFBhcmFteyAkU2VsZi0+e05hbWVUb0lEfXskQ3VycmVudEZpZWxkfSB9ICkgewogICAgICAgICAgICAkVmFsdWVzR290dGVueyAkU2VsZi0+e05hbWVUb0lEfXskQ3VycmVudEZpZWxkfSB9ID0gMTsKICAgICAgICAgICAgbmV4dCBESUFMT0dGSUVMRDsKICAgICAgICB9CgogICAgICAgIGlmICggJEN1cnJlbnRGaWVsZCBlcSAnUXVldWUnICYmICEkR2V0UGFyYW17ICRTZWxmLT57TmFtZVRvSUR9eyRDdXJyZW50RmllbGR9IH0gKSB7CiAgICAgICAgICAgIG15ICRVc2VyRGVmYXVsdFF1ZXVlID0gJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpVc2VyRGVmYXVsdFF1ZXVlJykgfHwgJyc7CiAgICAgICAgICAgIGlmICgkVXNlckRlZmF1bHRRdWV1ZSkgewogICAgICAgICAgICAgICAgbXkgJFF1ZXVlSUQgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6UXVldWUnKS0+UXVldWVMb29rdXAoIFF1ZXVlID0+ICRVc2VyRGVmYXVsdFF1ZXVlICk7CiAgICAgICAgICAgICAgICBpZiAoJFF1ZXVlSUQpIHsKICAgICAgICAgICAgICAgICAgICAkR2V0UGFyYW17JEN1cnJlbnRGaWVsZH0gICAgICAgICAgICAgICAgICAgICAgICAgID0gJFVzZXJEZWZhdWx0UXVldWU7CiAgICAgICAgICAgICAgICAgICAgJEdldFBhcmFteyAkU2VsZi0+e05hbWVUb0lEfXskQ3VycmVudEZpZWxkfSB9ICAgICA9ICRRdWV1ZUlEOwogICAgICAgICAgICAgICAgICAgICRWYWx1ZXNHb3R0ZW57ICRTZWxmLT57TmFtZVRvSUR9eyRDdXJyZW50RmllbGR9IH0gPSAxOwogICAgICAgICAgICAgICAgICAgIG5leHQgRElBTE9HRklFTEQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgaWYgbm8gU3VibWl0dGVkIG5vcmUgVGlja2V0IFBhcmFtIGdldCBBY3Rpdml0eURpYWxvZyBDb25maWcncyBQYXJhbQogICAgICAgIGlmICggJEN1cnJlbnRGaWVsZCBuZSAnQ3VzdG9tZXJJRCcgKSB7CiAgICAgICAgICAgICRWYWx1ZSA9ICRBY3Rpdml0eURpYWxvZy0+e0ZpZWxkc317JEN1cnJlbnRGaWVsZH17RGVmYXVsdFZhbHVlfTsKICAgICAgICB9CiAgICAgICAgaWYgKCRWYWx1ZSkgewogICAgICAgICAgICAkVmFsdWVzR290dGVueyAkU2VsZi0+e05hbWVUb0lEfXskQ3VycmVudEZpZWxkfSB9ID0gMTsKICAgICAgICAgICAgJEdldFBhcmFteyRDdXJyZW50RmllbGR9ID0gJFZhbHVlOwogICAgICAgICAgICBuZXh0IERJQUxPR0ZJRUxEOwogICAgICAgIH0KICAgIH0KCiAgICBmb3IgbXkgJEN1cnJlbnRGaWVsZCAocXcoUXVldWUgU3RhdGUgTG9jayBQcmlvcml0eSkpIHsKICAgICAgICAkVmFsdWUgPSB1bmRlZjsKICAgICAgICBpZiAoICEkVmFsdWVzR290dGVueyAkU2VsZi0+e05hbWVUb0lEfXskQ3VycmVudEZpZWxkfSB9ICkgewogICAgICAgICAgICAkVmFsdWUgPSAkQ29uZmlnT2JqZWN0LT5HZXQoIlByb2Nlc3M6OkRlZmF1bHQkQ3VycmVudEZpZWxkIik7CiAgICAgICAgICAgIGlmICggISRWYWx1ZSApIHsKCiAgICAgICAgICAgICAgICBteSAkTWVzc2FnZSA9ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgKICAgICAgICAgICAgICAgICAgICAnUHJvY2Vzczo6RGVmYXVsdCVzIENvbmZpZyBWYWx1ZSBtaXNzaW5nIScsCiAgICAgICAgICAgICAgICAgICAgJEN1cnJlbnRGaWVsZCwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgIyBkb2VzIG5vdCBzaG93IGhlYWRlciBhbmQgZm9vdGVyIGFnYWluCiAgICAgICAgICAgICAgICBpZiAoICRTZWxmLT57SXNNYWluV2luZG93fSApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+RXJyb3IoCiAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJE1lc3NhZ2UsCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5GYXRhbEVycm9yKAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJE1lc3NhZ2UsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRHZXRQYXJhbXskQ3VycmVudEZpZWxkfSA9ICRWYWx1ZTsKICAgICAgICAgICAgJFZhbHVlc0dvdHRlbnsgJFNlbGYtPntOYW1lVG9JRH17JEN1cnJlbnRGaWVsZH0gfSA9IDE7CiAgICAgICAgfQogICAgfQoKICAgIG15ICREZXN0ID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0Rlc3QnICkgfHwgJyc7CiAgICBpZiAoJERlc3QpIHsKCiAgICAgICAgbXkgQFF1ZXVlUGFydHMgPSBzcGxpdCggL1x8XHwvLCAkRGVzdCApOwoKICAgICAgICAkR2V0UGFyYW17UXVldWVJRH0gPSAkUXVldWVQYXJ0c1swXTsKICAgICAgICAkR2V0UGFyYW17UXVldWV9ICAgPSAkUXVldWVQYXJ0c1sxXTsKCiAgICAgICAgJFZhbHVlc0dvdHRlbntRdWV1ZUlEfSA9IDE7CiAgICB9CgogICAgIyBnZXQgYWxzbyB0aGUgSURzIGZvciB0aGUgUmVxdWlyZWQgZmlsZXMgKGlmIHRoZXkgYXJlIG5vdCBwcmVzZW50KQogICAgaWYgKCAkR2V0UGFyYW17UXVldWV9ICYmICEkR2V0UGFyYW17UXVldWVJRH0gKSB7CiAgICAgICAgJEdldFBhcmFte1F1ZXVlSUR9ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlF1ZXVlJyktPlF1ZXVlTG9va3VwKCBRdWV1ZSA9PiAkR2V0UGFyYW17UXVldWV9ICk7CiAgICB9CiAgICBpZiAoICRHZXRQYXJhbXtTdGF0ZX0gJiYgISRHZXRQYXJhbXtTdGF0ZUlEfSApIHsKICAgICAgICAkR2V0UGFyYW17U3RhdGVJRH0gPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6U3RhdGUnKS0+U3RhdGVMb29rdXAoIFN0YXRlID0+ICRHZXRQYXJhbXtTdGF0ZX0gKTsKICAgIH0KICAgIGlmICggJEdldFBhcmFte0xvY2t9ICYmICEkR2V0UGFyYW17TG9ja0lEfSApIHsKICAgICAgICAkR2V0UGFyYW17TG9ja0lEfSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2NrJyktPkxvY2tMb29rdXAoIExvY2sgPT4gJEdldFBhcmFte0xvY2t9ICk7CiAgICB9CiAgICBpZiAoICRHZXRQYXJhbXtQcmlvcml0eX0gJiYgISRHZXRQYXJhbXtQcmlvcml0eUlEfSApIHsKICAgICAgICAkR2V0UGFyYW17UHJpb3JpdHlJRH0gPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6UHJpb3JpdHknKS0+UHJpb3JpdHlMb29rdXAoCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICRHZXRQYXJhbXtQcmlvcml0eX0sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGFuZCBmaW5hbGx5IHdlJ2xsIGhhdmUgdGhlIHNwZWNpYWwgcGFyYW1ldGVyczoKICAgICRHZXRQYXJhbXtSZXNwb25zaWJsZUFsbH0gPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnUmVzcG9uc2libGVBbGwnICk7CiAgICAkR2V0UGFyYW17T3duZXJBbGx9ICAgICAgID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ093bmVyQWxsJyApOwogICAgJEdldFBhcmFte0VsZW1lbnRDaGFuZ2VkfSA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdFbGVtZW50Q2hhbmdlZCcgKTsKCiAgICByZXR1cm4gXCVHZXRQYXJhbTsKfQoKc3ViIF9PdXRwdXRBY3Rpdml0eURpYWxvZyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwogICAgbXkgJFRpY2tldElEICAgICAgICAgICAgICAgPSAkUGFyYW17R2V0UGFyYW19e1RpY2tldElEfTsKICAgIG15ICRBY3Rpdml0eURpYWxvZ0VudGl0eUlEID0gJFBhcmFte0dldFBhcmFtfXtBY3Rpdml0eURpYWxvZ0VudGl0eUlEfTsKCiAgICAjIGdldCBsYXlvdXQgb2JqZWN0CiAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwoKICAgICMgQ2hlY2sgbmVlZGVkIHBhcmFtZXRlcnM6CiAgICAjIFByb2Nlc3NFbnRpdHlJRCBvbmx5CiAgICAjIFRpY2tldElEIEFjdGl2aXR5RGlhbG9nRW50aXR5SUQKICAgIGlmICggISRQYXJhbXtQcm9jZXNzRW50aXR5SUR9IHx8ICggISRUaWNrZXRJRCAmJiAhJEFjdGl2aXR5RGlhbG9nRW50aXR5SUQgKSApIHsKICAgICAgICBteSAkTWVzc2FnZSA9IFRyYW5zbGF0YWJsZSgnR290IG5vIFByb2Nlc3NFbnRpdHlJRCBvciBUaWNrZXRJRCBhbmQgQWN0aXZpdHlEaWFsb2dFbnRpdHlJRCEnKTsKCiAgICAgICAgIyBkb2VzIG5vdCBzaG93IGhlYWRlciBhbmQgZm9vdGVyIGFnYWluCiAgICAgICAgaWYgKCAkU2VsZi0+e0lzTWFpbldpbmRvd30gKSB7CiAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5FcnJvcigKICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJE1lc3NhZ2UsCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAkTGF5b3V0T2JqZWN0LT5GYXRhbEVycm9yKAogICAgICAgICAgICBNZXNzYWdlID0+ICRNZXNzYWdlLAogICAgICAgICk7CiAgICB9CgogICAgbXkgJEFjdGl2aXR5QWN0aXZpdHlEaWFsb2c7CiAgICBteSAlVGlja2V0OwogICAgbXkgJUVycm9yICAgICAgICAgPSAoKTsKICAgIG15ICVFcnJvck1lc3NhZ2VzID0gKCk7CgogICAgIyBJZiB3ZSBoYWQgRXJyb3JzLCB3ZSBnb3QgYW4gRXJyb3JoYXNoCiAgICAlRXJyb3IgICAgICAgICA9ICV7ICRQYXJhbXtFcnJvcn0gfSAgICAgICAgIGlmICggSXNIYXNoUmVmV2l0aERhdGEoICRQYXJhbXtFcnJvcn0gKSApOwogICAgJUVycm9yTWVzc2FnZXMgPSAleyAkUGFyYW17RXJyb3JNZXNzYWdlc30gfSBpZiAoIElzSGFzaFJlZldpdGhEYXRhKCAkUGFyYW17RXJyb3JNZXNzYWdlc30gKSApOwoKICAgICMgZ2V0IG5lZWRlZCBvYmplY3RzCiAgICBteSAkQWN0aXZpdHlPYmplY3QgICAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6UHJvY2Vzc01hbmFnZW1lbnQ6OkFjdGl2aXR5Jyk7CiAgICBteSAkQWN0aXZpdHlEaWFsb2dPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6UHJvY2Vzc01hbmFnZW1lbnQ6OkFjdGl2aXR5RGlhbG9nJyk7CgogICAgIyBjcmVhdGUgcHJvY2VzcyBvYmplY3QKICAgICRLZXJuZWw6Ok9NLT5PYmplY3RQYXJhbUFkZCgKICAgICAgICAnS2VybmVsOjpTeXN0ZW06OlByb2Nlc3NNYW5hZ2VtZW50OjpQcm9jZXNzJyA9PiB7CiAgICAgICAgICAgIEFjdGl2aXR5T2JqZWN0ICAgICAgICAgPT4gJEFjdGl2aXR5T2JqZWN0LAogICAgICAgICAgICBBY3Rpdml0eURpYWxvZ09iamVjdCAgID0+ICRBY3Rpdml0eURpYWxvZ09iamVjdCwKICAgICAgICAgICAgVHJhbnNpdGlvbk9iamVjdCAgICAgICA9PiAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6UHJvY2Vzc01hbmFnZW1lbnQ6OlRyYW5zaXRpb24nKSwKICAgICAgICAgICAgVHJhbnNpdGlvbkFjdGlvbk9iamVjdCA9PiAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6UHJvY2Vzc01hbmFnZW1lbnQ6OlRyYW5zaXRpb25BY3Rpb24nKSwKICAgICAgICB9CiAgICApOwogICAgbXkgJFByb2Nlc3NPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6UHJvY2Vzc01hbmFnZW1lbnQ6OlByb2Nlc3MnKTsKCiAgICAjIGdldCBuZWVkZWQgb2JqZWN0CiAgICBteSAkVGlja2V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpY2tldCcpOwogICAgbXkgJENvbmZpZ09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CgogICAgaWYgKCAhJFRpY2tldElEIHx8ICRTZWxmLT57SXNQcm9jZXNzRW5yb2xsfSApIHsKICAgICAgICAkQWN0aXZpdHlBY3Rpdml0eURpYWxvZyA9ICRQcm9jZXNzT2JqZWN0LT5Qcm9jZXNzU3RhcnRwb2ludEdldCgKICAgICAgICAgICAgUHJvY2Vzc0VudGl0eUlEID0+ICRQYXJhbXtQcm9jZXNzRW50aXR5SUR9LAogICAgICAgICk7CgogICAgICAgIGlmICggIUlzSGFzaFJlZldpdGhEYXRhKCRBY3Rpdml0eUFjdGl2aXR5RGlhbG9nKSApIHsKICAgICAgICAgICAgbXkgJE1lc3NhZ2UgPSAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoCiAgICAgICAgICAgICAgICAnQ2FuXCd0IGdldCBTdGFydEFjdGl2aXR5RGlhbG9nIGFuZCBTdGFydEFjdGl2aXR5RGlhbG9nIGZvciB0aGUgUHJvY2Vzc0VudGl0eUlEICIlcyIhJywKICAgICAgICAgICAgICAgICRQYXJhbXtQcm9jZXNzRW50aXR5SUR9LAogICAgICAgICAgICApOwoKICAgICAgICAgICAgIyBkb2VzIG5vdCBzaG93IGhlYWRlciBhbmQgZm9vdGVyIGFnYWluCiAgICAgICAgICAgIGlmICggJFNlbGYtPntJc01haW5XaW5kb3d9ICkgewogICAgICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkVycm9yKAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJE1lc3NhZ2UsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5GYXRhbEVycm9yKAogICAgICAgICAgICAgICAgTWVzc2FnZSA9PiAkTWVzc2FnZSwKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CiAgICBlbHNlIHsKCiAgICAgICAgIyBubyBBSkFYIHVwZGF0ZSBpbiB0aGlzIHBhcnQKICAgICAgICAlVGlja2V0ID0gJFRpY2tldE9iamVjdC0+VGlja2V0R2V0KAogICAgICAgICAgICBUaWNrZXRJRCAgICAgID0+ICRUaWNrZXRJRCwKICAgICAgICAgICAgVXNlcklEICAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgIER5bmFtaWNGaWVsZHMgPT4gMSwKICAgICAgICApOwoKICAgICAgICBpZiAoICFJc0hhc2hSZWZXaXRoRGF0YSggXCVUaWNrZXQgKSApIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigKICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCAnQ2FuXCd0IGdldCBUaWNrZXQgIiVzIiEnLCAkUGFyYW17VGlja2V0SUR9ICksCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICBteSAkRHluYW1pY0ZpZWxkUHJvY2Vzc0lEID0gJ0R5bmFtaWNGaWVsZF8nCiAgICAgICAgICAgIC4gJENvbmZpZ09iamVjdC0+R2V0KCdQcm9jZXNzOjpEeW5hbWljRmllbGRQcm9jZXNzTWFuYWdlbWVudFByb2Nlc3NJRCcpOwogICAgICAgIG15ICREeW5hbWljRmllbGRBY3Rpdml0eUlEID0gJ0R5bmFtaWNGaWVsZF8nCiAgICAgICAgICAgIC4gJENvbmZpZ09iamVjdC0+R2V0KCdQcm9jZXNzOjpEeW5hbWljRmllbGRQcm9jZXNzTWFuYWdlbWVudEFjdGl2aXR5SUQnKTsKCiAgICAgICAgaWYgKCAhJFRpY2tldHskRHluYW1pY0ZpZWxkUHJvY2Vzc0lEfSB8fCAhJFRpY2tldHskRHluYW1pY0ZpZWxkQWN0aXZpdHlJRH0gKSB7CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkZhdGFsRXJyb3IoCiAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgKICAgICAgICAgICAgICAgICAgICAnQ2FuXCd0IGdldCBQcm9jZXNzRW50aXR5SUQgb3IgQWN0aXZpdHlFbnRpdHlJRCBmb3IgVGlja2V0ICIlcyIhJywKICAgICAgICAgICAgICAgICAgICAkUGFyYW17VGlja2V0SUR9LAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICRBY3Rpdml0eUFjdGl2aXR5RGlhbG9nID0gewogICAgICAgICAgICBBY3Rpdml0eSAgICAgICA9PiAkVGlja2V0eyREeW5hbWljRmllbGRBY3Rpdml0eUlEfSwKICAgICAgICAgICAgQWN0aXZpdHlEaWFsb2cgPT4gJEFjdGl2aXR5RGlhbG9nRW50aXR5SUQsCiAgICAgICAgfTsKICAgIH0KCiAgICBpZiAoICElVGlja2V0ICYmICRTZWxmLT57SXNQcm9jZXNzRW5yb2xsfSApIHsKICAgICAgICAlVGlja2V0ID0gJFRpY2tldE9iamVjdC0+VGlja2V0R2V0KAogICAgICAgICAgICBUaWNrZXRJRCAgICAgID0+ICRUaWNrZXRJRCwKICAgICAgICAgICAgVXNlcklEICAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgIER5bmFtaWNGaWVsZHMgPT4gMSwKICAgICAgICApOwogICAgfQoKICAgIG15ICRBY3Rpdml0eSA9ICRBY3Rpdml0eU9iamVjdC0+QWN0aXZpdHlHZXQoCiAgICAgICAgSW50ZXJmYWNlICAgICAgICA9PiAnQWdlbnRJbnRlcmZhY2UnLAogICAgICAgIEFjdGl2aXR5RW50aXR5SUQgPT4gJEFjdGl2aXR5QWN0aXZpdHlEaWFsb2ctPntBY3Rpdml0eX0KICAgICk7CiAgICBpZiAoICEkQWN0aXZpdHkgKSB7CiAgICAgICAgbXkgJE1lc3NhZ2UgPSAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoCiAgICAgICAgICAgICdDYW5cJ3QgZ2V0IEFjdGl2aXR5IGNvbmZpZ3VyYXRpb24gZm9yIEFjdGl2aXR5RW50aXR5SUQgIiVzIiEnLAogICAgICAgICAgICAkQWN0aXZpdHlBY3Rpdml0eURpYWxvZy0+e0FjdGl2aXR5fSwKICAgICAgICApOwoKICAgICAgICAjIGRvZXMgbm90IHNob3cgaGVhZGVyIGFuZCBmb290ZXIgYWdhaW4KICAgICAgICBpZiAoICRTZWxmLT57SXNNYWluV2luZG93fSApIHsKICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkVycm9yKAogICAgICAgICAgICAgICAgTWVzc2FnZSA9PiAkTWVzc2FnZSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICRMYXlvdXRPYmplY3QtPkZhdGFsRXJyb3IoCiAgICAgICAgICAgIE1lc3NhZ2UgPT4gJE1lc3NhZ2UsCiAgICAgICAgKTsKICAgIH0KCiAgICBteSAkQWN0aXZpdHlEaWFsb2cgPSAkQWN0aXZpdHlEaWFsb2dPYmplY3QtPkFjdGl2aXR5RGlhbG9nR2V0KAogICAgICAgIEFjdGl2aXR5RGlhbG9nRW50aXR5SUQgPT4gJEFjdGl2aXR5QWN0aXZpdHlEaWFsb2ctPntBY3Rpdml0eURpYWxvZ30sCiAgICAgICAgSW50ZXJmYWNlICAgICAgICAgICAgICA9PiAnQWdlbnRJbnRlcmZhY2UnLAogICAgKTsKICAgIGlmICggIUlzSGFzaFJlZldpdGhEYXRhKCRBY3Rpdml0eURpYWxvZykgKSB7CiAgICAgICAgbXkgJE1lc3NhZ2UgPSAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoCiAgICAgICAgICAgICdDYW5cJ3QgZ2V0IEFjdGl2aXR5RGlhbG9nIGNvbmZpZ3VyYXRpb24gZm9yIEFjdGl2aXR5RGlhbG9nRW50aXR5SUQgIiVzIiEnLAogICAgICAgICAgICAkQWN0aXZpdHlBY3Rpdml0eURpYWxvZy0+e0FjdGl2aXR5RGlhbG9nfSwKICAgICAgICApOwoKICAgICAgICAjIGRvZXMgbm90IHNob3cgaGVhZGVyIGFuZCBmb290ZXIgYWdhaW4KICAgICAgICBpZiAoICRTZWxmLT57SXNNYWluV2luZG93fSApIHsKICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkVycm9yKAogICAgICAgICAgICAgICAgTWVzc2FnZSA9PiAkTWVzc2FnZSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICRMYXlvdXRPYmplY3QtPkZhdGFsRXJyb3IoCiAgICAgICAgICAgIE1lc3NhZ2UgPT4gJE1lc3NhZ2UsCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGdyZXAgb3V0IE92ZXJ3cml0ZXMgaWYgZGVmaW5lZCBvbiB0aGUgQWN0aXZpdHkKICAgIG15IEBPdmVyd3JpdGVBY3Rpdml0eURpYWxvZ051bWJlciA9IGdyZXAgewogICAgICAgIHJlZiAkQWN0aXZpdHktPntBY3Rpdml0eURpYWxvZ317JF99IGVxICdIQVNIJwogICAgICAgICAgICAmJiAkQWN0aXZpdHktPntBY3Rpdml0eURpYWxvZ317JF99e0FjdGl2aXR5RGlhbG9nRW50aXR5SUR9CiAgICAgICAgICAgICYmICRBY3Rpdml0eS0+e0FjdGl2aXR5RGlhbG9nfXskX317QWN0aXZpdHlEaWFsb2dFbnRpdHlJRH0gZXEKICAgICAgICAgICAgJEFjdGl2aXR5QWN0aXZpdHlEaWFsb2ctPntBY3Rpdml0eURpYWxvZ30KICAgICAgICAgICAgJiYgSXNIYXNoUmVmV2l0aERhdGEoICRBY3Rpdml0eS0+e0FjdGl2aXR5RGlhbG9nfXskX317T3ZlcndyaXRlfSApCiAgICB9IGtleXMgJXsgJEFjdGl2aXR5LT57QWN0aXZpdHlEaWFsb2d9IH07CgogICAgIyBsZXQgdGhlIE92ZXJ3cml0ZXMgT3ZlcndyaXRlIHRoZSBBY3Rpdml0eURpYWxvZydzIEhhc2ggdmFsdWVzCiAgICBpZiAoICRPdmVyd3JpdGVBY3Rpdml0eURpYWxvZ051bWJlclswXSApIHsKICAgICAgICAleyRBY3Rpdml0eURpYWxvZ30gPSAoCiAgICAgICAgICAgICV7JEFjdGl2aXR5RGlhbG9nfSwKICAgICAgICAgICAgJXsgJEFjdGl2aXR5LT57QWN0aXZpdHlEaWFsb2d9eyAkT3ZlcndyaXRlQWN0aXZpdHlEaWFsb2dOdW1iZXJbMF0gfXtPdmVyd3JpdGV9IH0KICAgICAgICApOwogICAgfQoKICAgICMgQWRkIFBhZ2VIZWFkZXIsIE5hdmJhciwgRm9ybWhlYWRlciAoUHJvY2Vzcy9BY3Rpdml0eURpYWxvZ0hlYWRlcikKICAgIG15ICRPdXRwdXQ7CiAgICBteSAkTWFpbkJveENsYXNzOwoKICAgIGlmICggISRTZWxmLT57SXNNYWluV2luZG93fSAmJiAhJFNlbGYtPntJc1Byb2Nlc3NFbnJvbGx9ICkgewogICAgICAgICRPdXRwdXQgPSAkTGF5b3V0T2JqZWN0LT5IZWFkZXIoCiAgICAgICAgICAgIFR5cGUgID0+ICdTbWFsbCcsCiAgICAgICAgICAgIFZhbHVlID0+ICRUaWNrZXR7TnVtYmVyfSwKICAgICAgICApOwoKICAgICAgICAjIGRpc3BsYXkgZ2l2ZW4gbm90aWZ5IG1lc3NhZ2VzIGlmIHRoaXMgaXMgbm90IGFuIEFKQVggcmVxdWVzdAogICAgICAgIGlmICggSXNBcnJheVJlZldpdGhEYXRhKCAkUGFyYW17Tm90aWZ5fSApICkgewoKICAgICAgICAgICAgZm9yIG15ICROb3RpZnlEYXRhICggQHsgJFBhcmFte05vdGlmeX0gfSApIHsKICAgICAgICAgICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Tm90aWZ5KCAleyROb3RpZnlEYXRhfSApOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnSGVhZGVyJywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBOYW1lID0+CiAgICAgICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCAkQWN0aXZpdHlEaWFsb2ctPntOYW1lfSApCiAgICAgICAgICAgICAgICAgICAgfHwgJycsCiAgICAgICAgICAgIH0KICAgICAgICApOwogICAgfQogICAgZWxzaWYgKAogICAgICAgICggJFNlbGYtPntJc01haW5XaW5kb3d9IHx8ICRTZWxmLT57SXNQcm9jZXNzRW5yb2xsfSApCiAgICAgICAgJiYgSXNIYXNoUmVmV2l0aERhdGEoIFwlRXJyb3IgKQogICAgICAgICkKICAgIHsKCiAgICAgICAgIyBhZGQgcmljaCB0ZXh0IGVkaXRvcgogICAgICAgIGlmICggJExheW91dE9iamVjdC0+e0Jyb3dzZXJSaWNoVGV4dH0gKSB7CgogICAgICAgICAgICAjIHVzZSBoZWlnaHQvd2lkdGggZGVmaW5lZCBmb3IgdGhpcyBzY3JlZW4KICAgICAgICAgICAgJFBhcmFte1JpY2hUZXh0SGVpZ2h0fSA9ICRTZWxmLT57Q29uZmlnfS0+e1JpY2hUZXh0SGVpZ2h0fSB8fCAwOwogICAgICAgICAgICAkUGFyYW17UmljaFRleHRXaWR0aH0gID0gJFNlbGYtPntDb25maWd9LT57UmljaFRleHRXaWR0aH0gIHx8IDA7CgogICAgICAgICAgICAjIHNldCB1cCByaWNoIHRleHQgZWRpdG9yCiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPlNldFJpY2hUZXh0UGFyYW1ldGVycygKICAgICAgICAgICAgICAgIERhdGEgPT4gXCVQYXJhbSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgZGlzcGxheSBjb21wbGV0ZSBoZWFkZXIgYW5kIG5hdmlnYXRpb24gYmFyIGluIEFKQVggZGlhbG9ncyB3aGVuIHRoZXJlIGlzIGEgc2VydmVyIGVycm9yCiAgICAgICAgIyAgICB1bmxlc3Mgd2UgYXJlIGluIGEgcHJvY2VzcyBlbnJvbGxtZW50IChvbmx5IHdoZW4gSXNNYWluV2luZG93IGlzIGFjdGl2ZSkKICAgICAgICBteSAkVHlwZSA9ICRTZWxmLT57SXNNYWluV2luZG93fSA/ICcnIDogJ1NtYWxsJzsKICAgICAgICAkT3V0cHV0ID0gJExheW91dE9iamVjdC0+SGVhZGVyKAogICAgICAgICAgICBUeXBlID0+ICRUeXBlLAogICAgICAgICk7CiAgICAgICAgaWYgKCAkU2VsZi0+e0lzTWFpbldpbmRvd30gKSB7CiAgICAgICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+TmF2aWdhdGlvbkJhcigpOwogICAgICAgIH0KCiAgICAgICAgIyBkaXNwbGF5IG9yaWdpbmFsIGhlYWRlciB0ZXh0cyAodGhlIHByb2Nlc3MgbGlzdCBtYXliZSBpcyBub3QgbmVjZXNzYXJ5KQogICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+T3V0cHV0KAogICAgICAgICAgICBUZW1wbGF0ZUZpbGUgPT4gJ0FnZW50VGlja2V0UHJvY2VzcycgLiAkVHlwZSwKICAgICAgICAgICAgRGF0YSAgICAgICAgID0+IHsKICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgIEZvcm1JRCAgICAgICAgICA9PiAkU2VsZi0+e0Zvcm1JRH0sCiAgICAgICAgICAgICAgICBJc1Byb2Nlc3NFbnJvbGwgPT4gJFNlbGYtPntJc1Byb2Nlc3NFbnJvbGx9LAogICAgICAgICAgICB9LAogICAgICAgICk7CgogICAgICAgICMgc2V0IHRoZSBNYWluQm94IGNsYXNzIHRvIGFkZCBjb3JyZWN0IGJvcmRlcnMgdG8gdGhlIHNjcmVlbgogICAgICAgICRNYWluQm94Q2xhc3MgPSAnTWFpbkJveCc7CiAgICB9CgogICAgIyBkaXNwbGF5IHByb2Nlc3MgaW5mb3JtYXRpb24KICAgIGlmICggJFNlbGYtPntJc01haW5XaW5kb3d9ICkgewoKICAgICAgICAjIGdldCBwcm9jZXNzIGRhdGEKICAgICAgICBteSAkUHJvY2VzcyA9ICRQcm9jZXNzT2JqZWN0LT5Qcm9jZXNzR2V0KAogICAgICAgICAgICBQcm9jZXNzRW50aXR5SUQgPT4gJFBhcmFte1Byb2Nlc3NFbnRpdHlJRH0sCiAgICAgICAgKTsKCiAgICAgICAgIyBvdXRwdXQgbWFpbiBwcm9jZXNzIGluZm9ybWF0aW9uCiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ1Byb2Nlc3NJbmZvU2lkZWJhcicsCiAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgUHJvY2VzcyAgICAgICAgPT4gJFByb2Nlc3MtPntOYW1lfSAgICAgICAgfHwgJycsCiAgICAgICAgICAgICAgICBBY3Rpdml0eSAgICAgICA9PiAkQWN0aXZpdHktPntOYW1lfSAgICAgICB8fCAnJywKICAgICAgICAgICAgICAgIEFjdGl2aXR5RGlhbG9nID0+ICRBY3Rpdml0eURpYWxvZy0+e05hbWV9IHx8ICcnLAogICAgICAgICAgICB9LAogICAgICAgICk7CgogICAgICAgICMgb3V0cHV0IGFjdGl2aXR5IGRpYWxvZyBzaG9ydCBkZXNjcmlwdGlvbiAoaWYgYW55KQogICAgICAgIGlmICgKICAgICAgICAgICAgZGVmaW5lZCAkQWN0aXZpdHlEaWFsb2ctPntEZXNjcmlwdGlvblNob3J0fQogICAgICAgICAgICAmJiAkQWN0aXZpdHlEaWFsb2ctPntEZXNjcmlwdGlvblNob3J0fSBuZSAnJwogICAgICAgICAgICApCiAgICAgICAgewogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ1Byb2Nlc3NJbmZvU2lkZWJhckFjdGl2aXR5RGlhbG9nRGVzYycsCiAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICBBY3Rpdml0eURpYWxvZ0Rlc2NyaXB0aW9uID0+ICRBY3Rpdml0eURpYWxvZy0+e0Rlc2NyaXB0aW9uU2hvcnR9IHx8ICcnLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgb3V0cHV0IGxvbmcgZGVzY3JpcHRpb24gaW5mb3JtYXRpb24gaWYgZXhpc3RzCiAgICAgICAgaWYgKAogICAgICAgICAgICBkZWZpbmVkICRBY3Rpdml0eURpYWxvZy0+e0Rlc2NyaXB0aW9uTG9uZ30KICAgICAgICAgICAgJiYgbGVuZ3RoICRBY3Rpdml0eURpYWxvZy0+e0Rlc2NyaXB0aW9uTG9uZ30KICAgICAgICAgICAgKQogICAgICAgIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdMb25nRGVzY3JpcHRpb25TaWRlYmFyJywKICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgIERlc2NyaXB0aW9uID0+ICRBY3Rpdml0eURpYWxvZy0+e0Rlc2NyaXB0aW9uTG9uZ30sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICAjIHNob3cgZGVzY3JpcHRpb25zCiAgICBpZiAoICRBY3Rpdml0eURpYWxvZy0+e0Rlc2NyaXB0aW9uU2hvcnR9ICkgewogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdEZXNjcmlwdGlvblNob3J0JywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBEZXNjcmlwdGlvblNob3J0CiAgICAgICAgICAgICAgICAgICAgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKAogICAgICAgICAgICAgICAgICAgICRBY3Rpdml0eURpYWxvZy0+e0Rlc2NyaXB0aW9uU2hvcnR9LAogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKICAgIH0KICAgIGlmICggJEFjdGl2aXR5RGlhbG9nLT57RGVzY3JpcHRpb25Mb25nfSApIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnRGVzY3JpcHRpb25Mb25nJywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBEZXNjcmlwdGlvbkxvbmcKICAgICAgICAgICAgICAgICAgICA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoCiAgICAgICAgICAgICAgICAgICAgJEFjdGl2aXR5RGlhbG9nLT57RGVzY3JpcHRpb25Mb25nfSwKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICB9CgogICAgIyBzaG93IGNsb3NlICYgY2FuY2VsIGxpbmsgaWYgbmVjZXNzYXJ5CiAgICBpZiAoICEkU2VsZi0+e0lzTWFpbldpbmRvd30gJiYgISRTZWxmLT57SXNQcm9jZXNzRW5yb2xsfSApIHsKICAgICAgICBpZiAoICRQYXJhbXtSZW5kZXJMb2NrZWR9ICkgewogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ1Byb3BlcnRpZXNMb2NrJywKICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgICAgICBUaWNrZXRJRCA9PiAkVGlja2V0SUQsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdDYW5jZWxMaW5rJywKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgfQoKICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+T3V0cHV0KAogICAgICAgIFRlbXBsYXRlRmlsZSA9PiAnUHJvY2Vzc01hbmFnZW1lbnQvQWN0aXZpdHlEaWFsb2dIZWFkZXInLAogICAgICAgIERhdGEgICAgICAgICA9PiB7CiAgICAgICAgICAgIEZvcm1OYW1lICAgICAgICAgICAgICAgPT4gJ0FjdGl2aXR5RGlhbG9nRGlhbG9nJyAuICRBY3Rpdml0eUFjdGl2aXR5RGlhbG9nLT57QWN0aXZpdHlEaWFsb2d9LAogICAgICAgICAgICBGb3JtSUQgICAgICAgICAgICAgICAgID0+ICRTZWxmLT57Rm9ybUlEfSwKICAgICAgICAgICAgU3ViYWN0aW9uICAgICAgICAgICAgICA9PiAnU3RvcmVBY3Rpdml0eURpYWxvZycsCiAgICAgICAgICAgIFRpY2tldElEICAgICAgICAgICAgICAgPT4gJFRpY2tldHtUaWNrZXRJRH0gfHwgJycsCiAgICAgICAgICAgIExpbmtUaWNrZXRJRCAgICAgICAgICAgPT4gJFNlbGYtPntMaW5rVGlja2V0SUR9LAogICAgICAgICAgICBBY3Rpdml0eURpYWxvZ0VudGl0eUlEID0+ICRBY3Rpdml0eUFjdGl2aXR5RGlhbG9nLT57QWN0aXZpdHlEaWFsb2d9LAogICAgICAgICAgICBQcm9jZXNzRW50aXR5SUQgICAgICAgID0+ICRQYXJhbXtQcm9jZXNzRW50aXR5SUR9CiAgICAgICAgICAgICAgICB8fCAkVGlja2V0ewogICAgICAgICAgICAgICAgJ0R5bmFtaWNGaWVsZF8nCiAgICAgICAgICAgICAgICAgICAgLiAkQ29uZmlnT2JqZWN0LT5HZXQoCiAgICAgICAgICAgICAgICAgICAgJ1Byb2Nlc3M6OkR5bmFtaWNGaWVsZFByb2Nlc3NNYW5hZ2VtZW50UHJvY2Vzc0lEJwogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgIElzTWFpbldpbmRvdyAgICA9PiAkU2VsZi0+e0lzTWFpbldpbmRvd30sCiAgICAgICAgICAgIElzUHJvY2Vzc0Vucm9sbCA9PiAkU2VsZi0+e0lzUHJvY2Vzc0Vucm9sbH0sCiAgICAgICAgICAgIE1haW5Cb3hDbGFzcyAgICA9PiAkTWFpbkJveENsYXNzIHx8ICcnLAogICAgICAgIH0sCiAgICApOwoKICAgIG15ICVSZW5kZXJlZEZpZWxkcyA9ICgpOwoKICAgICMgZ2V0IHRoZSBsaXN0IG9mIGZpZWxkcyB3aGVyZSB0aGUgQUpBWCBsb2FkZXIgaWNvbiBzaG91bGQgYXBwZWFyIG9uIEFKQVggdXBkYXRlcyB0cmlnZ2VyZWQKICAgICMgYnkgQWN0aXZpdHlEaWFsb2cgZmllbGRzCiAgICBteSAkQUpBWFVwZGF0YWJsZUZpZWxkcyA9ICRTZWxmLT5fR2V0QUpBWFVwZGF0YWJsZUZpZWxkcygKICAgICAgICBBY3Rpdml0eURpYWxvZ0ZpZWxkcyA9PiAkQWN0aXZpdHlEaWFsb2ctPntGaWVsZHN9LAogICAgKTsKCiAgICAjIExvb3AgdGhyb3VnaCBBY3Rpdml0eURpYWxvZ0ZpZWxkcyBhbmQgcmVuZGVyIHRoZWlyIG91dHB1dAogICAgRElBTE9HRklFTEQ6CiAgICBmb3IgbXkgJEN1cnJlbnRGaWVsZCAoIEB7ICRBY3Rpdml0eURpYWxvZy0+e0ZpZWxkT3JkZXJ9IH0gKSB7CiAgICAgICAgaWYgKCAhSXNIYXNoUmVmV2l0aERhdGEoICRBY3Rpdml0eURpYWxvZy0+e0ZpZWxkc317JEN1cnJlbnRGaWVsZH0gKSApIHsKICAgICAgICAgICAgbXkgJE1lc3NhZ2UgPSAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoCiAgICAgICAgICAgICAgICAnQ2FuXCd0IGdldCBkYXRhIGZvciBGaWVsZCAiJXMiIG9mIEFjdGl2aXR5RGlhbG9nICIlcyIhJywKICAgICAgICAgICAgICAgICRDdXJyZW50RmllbGQsCiAgICAgICAgICAgICAgICAkQWN0aXZpdHlBY3Rpdml0eURpYWxvZy0+e0FjdGl2aXR5RGlhbG9nfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgZG9lcyBub3Qgc2hvdyBoZWFkZXIgYW5kIGZvb3RlciBhZ2FpbgogICAgICAgICAgICBpZiAoICRTZWxmLT57SXNNYWluV2luZG93fSApIHsKICAgICAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5FcnJvcigKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRNZXNzYWdlLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigKICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJE1lc3NhZ2UsCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICBteSAlRmllbGREYXRhID0gJXsgJEFjdGl2aXR5RGlhbG9nLT57RmllbGRzfXskQ3VycmVudEZpZWxkfSB9OwoKICAgICAgICAjIFdlIHJlbmRlciBqdXN0IHZpc2libGUgQWN0aXZpdHlEaWFsb2dGaWVsZHMKICAgICAgICBuZXh0IERJQUxPR0ZJRUxEIGlmICEkRmllbGREYXRhe0Rpc3BsYXl9OwoKICAgICAgICAjIHJlbmRlciBEeW5hbWljRmllbGRzCiAgICAgICAgaWYgKCAkQ3VycmVudEZpZWxkID1+IG17XkR5bmFtaWNGaWVsZF8oLiopfXhtcyApIHsKICAgICAgICAgICAgbXkgJER5bmFtaWNGaWVsZE5hbWUgPSAkMTsKICAgICAgICAgICAgbXkgJFJlc3BvbnNlICAgICAgICAgPSAkU2VsZi0+X1JlbmRlckR5bmFtaWNGaWVsZCgKICAgICAgICAgICAgICAgIEFjdGl2aXR5RGlhbG9nRmllbGQgPT4gJEFjdGl2aXR5RGlhbG9nLT57RmllbGRzfXskQ3VycmVudEZpZWxkfSwKICAgICAgICAgICAgICAgIEZpZWxkTmFtZSAgICAgICAgICAgPT4gJER5bmFtaWNGaWVsZE5hbWUsCiAgICAgICAgICAgICAgICBEZXNjcmlwdGlvblNob3J0ICAgID0+ICRBY3Rpdml0eURpYWxvZy0+e0ZpZWxkc317JEN1cnJlbnRGaWVsZH17RGVzY3JpcHRpb25TaG9ydH0sCiAgICAgICAgICAgICAgICBEZXNjcmlwdGlvbkxvbmcgICAgID0+ICRBY3Rpdml0eURpYWxvZy0+e0ZpZWxkc317JEN1cnJlbnRGaWVsZH17RGVzY3JpcHRpb25Mb25nfSwKICAgICAgICAgICAgICAgIFRpY2tldCAgICAgICAgICAgICAgPT4gXCVUaWNrZXQsCiAgICAgICAgICAgICAgICBFcnJvciAgICAgICAgICAgICAgID0+IFwlRXJyb3IsCiAgICAgICAgICAgICAgICBFcnJvck1lc3NhZ2VzICAgICAgID0+IFwlRXJyb3JNZXNzYWdlcyB8fCB7fSwKICAgICAgICAgICAgICAgIEZvcm1JRCAgICAgICAgICAgICAgPT4gJFNlbGYtPntGb3JtSUR9LAogICAgICAgICAgICAgICAgR2V0UGFyYW0gICAgICAgICAgICA9PiAkUGFyYW17R2V0UGFyYW19LAogICAgICAgICAgICAgICAgQUpBWFVwZGF0YWJsZUZpZWxkcyA9PiAkQUpBWFVwZGF0YWJsZUZpZWxkcywKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGlmICggISRSZXNwb25zZS0+e1N1Y2Nlc3N9ICkgewoKICAgICAgICAgICAgICAgICMgZG9lcyBub3Qgc2hvdyBoZWFkZXIgYW5kIGZvb3RlciBhZ2FpbgogICAgICAgICAgICAgICAgaWYgKCAkU2VsZi0+e0lzTWFpbldpbmRvd30gKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkVycm9yKAogICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRSZXNwb25zZS0+e01lc3NhZ2V9LAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRSZXNwb25zZS0+e01lc3NhZ2V9LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJE91dHB1dCAuPSAkUmVzcG9uc2UtPntIVE1MfTsKCiAgICAgICAgICAgICRSZW5kZXJlZEZpZWxkc3skQ3VycmVudEZpZWxkfSA9IDE7CgogICAgICAgIH0KCiAgICAgICAgIyByZW5kZXIgQXR0YWNobWVudHMKICAgICAgICBlbHNpZiAoICRDdXJyZW50RmllbGQgZXEgJ0F0dGFjaG1lbnRzJyAmJiAkVGlja2V0SUQgKSB7CiAgICAgICAgICAgIG5leHQgRElBTE9HRklFTEQgaWYgJFJlbmRlcmVkRmllbGRzeyRDdXJyZW50RmllbGR9OwoKICAgICAgICAgICAgbXkgJFJlc3BvbnNlID0gJFNlbGYtPl9SZW5kZXJBdHRhY2htZW50KAogICAgICAgICAgICAgICAgQWN0aXZpdHlEaWFsb2dGaWVsZCA9PiAkQWN0aXZpdHlEaWFsb2ctPntGaWVsZHN9LT57JEN1cnJlbnRGaWVsZH0sCiAgICAgICAgICAgICAgICBGaWVsZE5hbWUgICAgICAgICAgID0+ICRDdXJyZW50RmllbGQsCiAgICAgICAgICAgICAgICBEZXNjcmlwdGlvblNob3J0ICAgID0+ICRBY3Rpdml0eURpYWxvZy0+e0ZpZWxkc30tPnskQ3VycmVudEZpZWxkfS0+e0Rlc2NyaXB0aW9uU2hvcnR9LAogICAgICAgICAgICAgICAgRGVzY3JpcHRpb25Mb25nICAgICA9PiAkQWN0aXZpdHlEaWFsb2ctPntGaWVsZHN9LT57JEN1cnJlbnRGaWVsZH0tPntEZXNjcmlwdGlvbkxvbmd9LAogICAgICAgICAgICAgICAgVGlja2V0ICAgICAgICAgICAgICA9PiBcJVRpY2tldCwKICAgICAgICAgICAgICAgIEVycm9yICAgICAgICAgICAgICAgPT4gXCVFcnJvciwKICAgICAgICAgICAgICAgIEZvcm1JRCAgICAgICAgICAgICAgPT4gJFNlbGYtPntGb3JtSUR9LAogICAgICAgICAgICAgICAgR2V0UGFyYW0gICAgICAgICAgICA9PiAkUGFyYW17R2V0UGFyYW19LAogICAgICAgICAgICAgICAgQUpBWFVwZGF0YWJsZUZpZWxkcyA9PiAkQUpBWFVwZGF0YWJsZUZpZWxkcywKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGlmICggISRSZXNwb25zZS0+e1N1Y2Nlc3N9ICkgewoKICAgICAgICAgICAgICAgICMgZG9lcyBub3Qgc2hvdyBoZWFkZXIgYW5kIGZvb3RlciBhZ2FpbgogICAgICAgICAgICAgICAgaWYgKCAkU2VsZi0+e0lzTWFpbldpbmRvd30gKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkVycm9yKAogICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRSZXNwb25zZS0+e01lc3NhZ2V9LAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRSZXNwb25zZS0+e01lc3NhZ2V9LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJE91dHB1dCAuPSAkUmVzcG9uc2UtPntIVE1MfTsKICAgICAgICAgICAgJFJlbmRlcmVkRmllbGRzeyRDdXJyZW50RmllbGR9ID0gMTsKICAgICAgICB9CgogICAgICAgICMgcmVuZGVyIFN0YXRlCiAgICAgICAgZWxzaWYgKCAkU2VsZi0+e05hbWVUb0lEfS0+eyRDdXJyZW50RmllbGR9IGVxICdTdGF0ZUlEJyApCiAgICAgICAgewoKICAgICAgICAgICAgIyBXZSBkb24ndCByZW5kZXIgRmllbGRzIHR3aWNlLAogICAgICAgICAgICAjIGlmIHRoZXJlIHdhcyBhbHJlYWR5IGEgQ29uZmlnIHdpdGhvdXQgSUQsIHNraXAgdGhpcyBmaWVsZAogICAgICAgICAgICBuZXh0IERJQUxPR0ZJRUxEIGlmICRSZW5kZXJlZEZpZWxkc3sgJFNlbGYtPntOYW1lVG9JRH0tPnskQ3VycmVudEZpZWxkfSB9OwoKICAgICAgICAgICAgbXkgJFJlc3BvbnNlID0gJFNlbGYtPl9SZW5kZXJTdGF0ZSgKICAgICAgICAgICAgICAgIEFjdGl2aXR5RGlhbG9nRmllbGQgPT4gJEFjdGl2aXR5RGlhbG9nLT57RmllbGRzfXskQ3VycmVudEZpZWxkfSwKICAgICAgICAgICAgICAgIEZpZWxkTmFtZSAgICAgICAgICAgPT4gJEN1cnJlbnRGaWVsZCwKICAgICAgICAgICAgICAgIERlc2NyaXB0aW9uU2hvcnQgICAgPT4gJEFjdGl2aXR5RGlhbG9nLT57RmllbGRzfXskQ3VycmVudEZpZWxkfXtEZXNjcmlwdGlvblNob3J0fSwKICAgICAgICAgICAgICAgIERlc2NyaXB0aW9uTG9uZyAgICAgPT4gJEFjdGl2aXR5RGlhbG9nLT57RmllbGRzfXskQ3VycmVudEZpZWxkfXtEZXNjcmlwdGlvbkxvbmd9LAogICAgICAgICAgICAgICAgVGlja2V0ICAgICAgICAgICAgICA9PiBcJVRpY2tldCwKICAgICAgICAgICAgICAgIEVycm9yICAgICAgICAgICAgICAgPT4gXCVFcnJvciwKICAgICAgICAgICAgICAgIEZvcm1JRCAgICAgICAgICAgICAgPT4gJFNlbGYtPntGb3JtSUR9LAogICAgICAgICAgICAgICAgR2V0UGFyYW0gICAgICAgICAgICA9PiAkUGFyYW17R2V0UGFyYW19LAogICAgICAgICAgICAgICAgQUpBWFVwZGF0YWJsZUZpZWxkcyA9PiAkQUpBWFVwZGF0YWJsZUZpZWxkcywKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGlmICggISRSZXNwb25zZS0+e1N1Y2Nlc3N9ICkgewoKICAgICAgICAgICAgICAgICMgZG9lcyBub3Qgc2hvdyBoZWFkZXIgYW5kIGZvb3RlciBhZ2FpbgogICAgICAgICAgICAgICAgaWYgKCAkU2VsZi0+e0lzTWFpbldpbmRvd30gKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkVycm9yKAogICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRSZXNwb25zZS0+e01lc3NhZ2V9LAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRSZXNwb25zZS0+e01lc3NhZ2V9LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJE91dHB1dCAuPSAkUmVzcG9uc2UtPntIVE1MfTsKCiAgICAgICAgICAgICRSZW5kZXJlZEZpZWxkc3sgJFNlbGYtPntOYW1lVG9JRH0tPnskQ3VycmVudEZpZWxkfSB9ID0gMTsKICAgICAgICB9CgogICAgICAgICMgcmVuZGVyIFF1ZXVlCiAgICAgICAgZWxzaWYgKCAkU2VsZi0+e05hbWVUb0lEfS0+eyRDdXJyZW50RmllbGR9IGVxICdRdWV1ZUlEJyApCiAgICAgICAgewogICAgICAgICAgICBuZXh0IERJQUxPR0ZJRUxEIGlmICRSZW5kZXJlZEZpZWxkc3sgJFNlbGYtPntOYW1lVG9JRH0tPnskQ3VycmVudEZpZWxkfSB9OwoKICAgICAgICAgICAgbXkgJFJlc3BvbnNlID0gJFNlbGYtPl9SZW5kZXJRdWV1ZSgKICAgICAgICAgICAgICAgIEFjdGl2aXR5RGlhbG9nRmllbGQgPT4gJEFjdGl2aXR5RGlhbG9nLT57RmllbGRzfXskQ3VycmVudEZpZWxkfSwKICAgICAgICAgICAgICAgIEZpZWxkTmFtZSAgICAgICAgICAgPT4gJEN1cnJlbnRGaWVsZCwKICAgICAgICAgICAgICAgIERlc2NyaXB0aW9uU2hvcnQgICAgPT4gJEFjdGl2aXR5RGlhbG9nLT57RmllbGRzfXskQ3VycmVudEZpZWxkfXtEZXNjcmlwdGlvblNob3J0fSwKICAgICAgICAgICAgICAgIERlc2NyaXB0aW9uTG9uZyAgICAgPT4gJEFjdGl2aXR5RGlhbG9nLT57RmllbGRzfXskQ3VycmVudEZpZWxkfXtEZXNjcmlwdGlvbkxvbmd9LAogICAgICAgICAgICAgICAgVGlja2V0ICAgICAgICAgICAgICA9PiBcJVRpY2tldCwKICAgICAgICAgICAgICAgIEVycm9yICAgICAgICAgICAgICAgPT4gXCVFcnJvciwKICAgICAgICAgICAgICAgIEZvcm1JRCAgICAgICAgICAgICAgPT4gJFNlbGYtPntGb3JtSUR9LAogICAgICAgICAgICAgICAgR2V0UGFyYW0gICAgICAgICAgICA9PiAkUGFyYW17R2V0UGFyYW19LAogICAgICAgICAgICAgICAgQUpBWFVwZGF0YWJsZUZpZWxkcyA9PiAkQUpBWFVwZGF0YWJsZUZpZWxkcywKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGlmICggISRSZXNwb25zZS0+e1N1Y2Nlc3N9ICkgewoKICAgICAgICAgICAgICAgICMgZG9lcyBub3Qgc2hvdyBoZWFkZXIgYW5kIGZvb3RlciBhZ2FpbgogICAgICAgICAgICAgICAgaWYgKCAkU2VsZi0+e0lzTWFpbldpbmRvd30gKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkVycm9yKAogICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRSZXNwb25zZS0+e01lc3NhZ2V9LAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRSZXNwb25zZS0+e01lc3NhZ2V9LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJE91dHB1dCAuPSAkUmVzcG9uc2UtPntIVE1MfTsKCiAgICAgICAgICAgICRSZW5kZXJlZEZpZWxkc3sgJFNlbGYtPntOYW1lVG9JRH0tPnskQ3VycmVudEZpZWxkfSB9ID0gMTsKICAgICAgICB9CgogICAgICAgICMgcmVuZGVyIFByaW9yaXR5CiAgICAgICAgZWxzaWYgKCAkU2VsZi0+e05hbWVUb0lEfS0+eyRDdXJyZW50RmllbGR9IGVxICdQcmlvcml0eUlEJyApCiAgICAgICAgewogICAgICAgICAgICBuZXh0IERJQUxPR0ZJRUxEIGlmICRSZW5kZXJlZEZpZWxkc3sgJFNlbGYtPntOYW1lVG9JRH0tPnskQ3VycmVudEZpZWxkfSB9OwoKICAgICAgICAgICAgbXkgJFJlc3BvbnNlID0gJFNlbGYtPl9SZW5kZXJQcmlvcml0eSgKICAgICAgICAgICAgICAgIEFjdGl2aXR5RGlhbG9nRmllbGQgPT4gJEFjdGl2aXR5RGlhbG9nLT57RmllbGRzfXskQ3VycmVudEZpZWxkfSwKICAgICAgICAgICAgICAgIEZpZWxkTmFtZSAgICAgICAgICAgPT4gJEN1cnJlbnRGaWVsZCwKICAgICAgICAgICAgICAgIERlc2NyaXB0aW9uU2hvcnQgICAgPT4gJEFjdGl2aXR5RGlhbG9nLT57RmllbGRzfXskQ3VycmVudEZpZWxkfXtEZXNjcmlwdGlvblNob3J0fSwKICAgICAgICAgICAgICAgIERlc2NyaXB0aW9uTG9uZyAgICAgPT4gJEFjdGl2aXR5RGlhbG9nLT57RmllbGRzfXskQ3VycmVudEZpZWxkfXtEZXNjcmlwdGlvbkxvbmd9LAogICAgICAgICAgICAgICAgVGlja2V0ICAgICAgICAgICAgICA9PiBcJVRpY2tldCwKICAgICAgICAgICAgICAgIEVycm9yICAgICAgICAgICAgICAgPT4gXCVFcnJvciwKICAgICAgICAgICAgICAgIEZvcm1JRCAgICAgICAgICAgICAgPT4gJFNlbGYtPntGb3JtSUR9LAogICAgICAgICAgICAgICAgR2V0UGFyYW0gICAgICAgICAgICA9PiAkUGFyYW17R2V0UGFyYW19LAogICAgICAgICAgICAgICAgQUpBWFVwZGF0YWJsZUZpZWxkcyA9PiAkQUpBWFVwZGF0YWJsZUZpZWxkcywKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGlmICggISRSZXNwb25zZS0+e1N1Y2Nlc3N9ICkgewoKICAgICAgICAgICAgICAgICMgZG9lcyBub3Qgc2hvdyBoZWFkZXIgYW5kIGZvb3RlciBhZ2FpbgogICAgICAgICAgICAgICAgaWYgKCAkU2VsZi0+e0lzTWFpbldpbmRvd30gKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkVycm9yKAogICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRSZXNwb25zZS0+e01lc3NhZ2V9LAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRSZXNwb25zZS0+e01lc3NhZ2V9LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJE91dHB1dCAuPSAkUmVzcG9uc2UtPntIVE1MfTsKCiAgICAgICAgICAgICRSZW5kZXJlZEZpZWxkc3sgJFNlbGYtPntOYW1lVG9JRH0tPnskQ3VycmVudEZpZWxkfSB9ID0gMTsKICAgICAgICB9CgogICAgICAgICMgcmVuZGVyIExvY2sKICAgICAgICBlbHNpZiAoICRTZWxmLT57TmFtZVRvSUR9LT57JEN1cnJlbnRGaWVsZH0gZXEgJ0xvY2tJRCcgKSB7CiAgICAgICAgICAgIG5leHQgRElBTE9HRklFTEQgaWYgJFJlbmRlcmVkRmllbGRzeyAkU2VsZi0+e05hbWVUb0lEfS0+eyRDdXJyZW50RmllbGR9IH07CgogICAgICAgICAgICBteSAkUmVzcG9uc2UgPSAkU2VsZi0+X1JlbmRlckxvY2soCiAgICAgICAgICAgICAgICBBY3Rpdml0eURpYWxvZ0ZpZWxkID0+ICRBY3Rpdml0eURpYWxvZy0+e0ZpZWxkc317JEN1cnJlbnRGaWVsZH0sCiAgICAgICAgICAgICAgICBGaWVsZE5hbWUgICAgICAgICAgID0+ICRDdXJyZW50RmllbGQsCiAgICAgICAgICAgICAgICBEZXNjcmlwdGlvblNob3J0ICAgID0+ICRBY3Rpdml0eURpYWxvZy0+e0ZpZWxkc317JEN1cnJlbnRGaWVsZH17RGVzY3JpcHRpb25TaG9ydH0sCiAgICAgICAgICAgICAgICBEZXNjcmlwdGlvbkxvbmcgICAgID0+ICRBY3Rpdml0eURpYWxvZy0+e0ZpZWxkc317JEN1cnJlbnRGaWVsZH17RGVzY3JpcHRpb25Mb25nfSwKICAgICAgICAgICAgICAgIFRpY2tldCAgICAgICAgICAgICAgPT4gXCVUaWNrZXQsCiAgICAgICAgICAgICAgICBFcnJvciAgICAgICAgICAgICAgID0+IFwlRXJyb3IsCiAgICAgICAgICAgICAgICBGb3JtSUQgICAgICAgICAgICAgID0+ICRTZWxmLT57Rm9ybUlEfSwKICAgICAgICAgICAgICAgIEdldFBhcmFtICAgICAgICAgICAgPT4gJFBhcmFte0dldFBhcmFtfSwKICAgICAgICAgICAgICAgIEFKQVhVcGRhdGFibGVGaWVsZHMgPT4gJEFKQVhVcGRhdGFibGVGaWVsZHMsCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBpZiAoICEkUmVzcG9uc2UtPntTdWNjZXNzfSApIHsKCiAgICAgICAgICAgICAgICAjIGRvZXMgbm90IHNob3cgaGVhZGVyIGFuZCBmb290ZXIgYWdhaW4KICAgICAgICAgICAgICAgIGlmICggJFNlbGYtPntJc01haW5XaW5kb3d9ICkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5FcnJvcigKICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PiAkUmVzcG9uc2UtPntNZXNzYWdlfSwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkZhdGFsRXJyb3IoCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PiAkUmVzcG9uc2UtPntNZXNzYWdlfSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRPdXRwdXQgLj0gJFJlc3BvbnNlLT57SFRNTH07CgogICAgICAgICAgICAkUmVuZGVyZWRGaWVsZHN7ICRTZWxmLT57TmFtZVRvSUR9LT57JEN1cnJlbnRGaWVsZH0gfSA9IDE7CiAgICAgICAgfQoKICAgICAgICAjIHJlbmRlciBTZXJ2aWNlCiAgICAgICAgZWxzaWYgKCAkU2VsZi0+e05hbWVUb0lEfS0+eyRDdXJyZW50RmllbGR9IGVxICdTZXJ2aWNlSUQnICkgewogICAgICAgICAgICBuZXh0IERJQUxPR0ZJRUxEIGlmICRSZW5kZXJlZEZpZWxkc3sgJFNlbGYtPntOYW1lVG9JRH0tPnskQ3VycmVudEZpZWxkfSB9OwoKICAgICAgICAgICAgbXkgJFJlc3BvbnNlID0gJFNlbGYtPl9SZW5kZXJTZXJ2aWNlKAogICAgICAgICAgICAgICAgQWN0aXZpdHlEaWFsb2dGaWVsZCA9PiAkQWN0aXZpdHlEaWFsb2ctPntGaWVsZHN9eyRDdXJyZW50RmllbGR9LAogICAgICAgICAgICAgICAgRmllbGROYW1lICAgICAgICAgICA9PiAkQ3VycmVudEZpZWxkLAogICAgICAgICAgICAgICAgRGVzY3JpcHRpb25TaG9ydCAgICA9PiAkQWN0aXZpdHlEaWFsb2ctPntGaWVsZHN9eyRDdXJyZW50RmllbGR9e0Rlc2NyaXB0aW9uU2hvcnR9LAogICAgICAgICAgICAgICAgRGVzY3JpcHRpb25Mb25nICAgICA9PiAkQWN0aXZpdHlEaWFsb2ctPntGaWVsZHN9eyRDdXJyZW50RmllbGR9e0Rlc2NyaXB0aW9uTG9uZ30sCiAgICAgICAgICAgICAgICBUaWNrZXQgICAgICAgICAgICAgID0+IFwlVGlja2V0LAogICAgICAgICAgICAgICAgRXJyb3IgICAgICAgICAgICAgICA9PiBcJUVycm9yLAogICAgICAgICAgICAgICAgRm9ybUlEICAgICAgICAgICAgICA9PiAkU2VsZi0+e0Zvcm1JRH0sCiAgICAgICAgICAgICAgICBHZXRQYXJhbSAgICAgICAgICAgID0+ICRQYXJhbXtHZXRQYXJhbX0sCiAgICAgICAgICAgICAgICBBSkFYVXBkYXRhYmxlRmllbGRzID0+ICRBSkFYVXBkYXRhYmxlRmllbGRzLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKCAhJFJlc3BvbnNlLT57U3VjY2Vzc30gKSB7CgogICAgICAgICAgICAgICAgIyBkb2VzIG5vdCBzaG93IGhlYWRlciBhbmQgZm9vdGVyIGFnYWluCiAgICAgICAgICAgICAgICBpZiAoICRTZWxmLT57SXNNYWluV2luZG93fSApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+RXJyb3IoCiAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJFJlc3BvbnNlLT57TWVzc2FnZX0sCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5GYXRhbEVycm9yKAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJFJlc3BvbnNlLT57TWVzc2FnZX0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkT3V0cHV0IC49ICRSZXNwb25zZS0+e0hUTUx9OwoKICAgICAgICAgICAgJFJlbmRlcmVkRmllbGRzeyRDdXJyZW50RmllbGR9ID0gMTsKICAgICAgICB9CgogICAgICAgICMgcmVuZGVyIFNMQQogICAgICAgIGVsc2lmICggJFNlbGYtPntOYW1lVG9JRH0tPnskQ3VycmVudEZpZWxkfSBlcSAnU0xBSUQnICkgewogICAgICAgICAgICBuZXh0IERJQUxPR0ZJRUxEIGlmICRSZW5kZXJlZEZpZWxkc3sgJFNlbGYtPntOYW1lVG9JRH0tPnskQ3VycmVudEZpZWxkfSB9OwoKICAgICAgICAgICAgbXkgJFJlc3BvbnNlID0gJFNlbGYtPl9SZW5kZXJTTEEoCiAgICAgICAgICAgICAgICBBY3Rpdml0eURpYWxvZ0ZpZWxkID0+ICRBY3Rpdml0eURpYWxvZy0+e0ZpZWxkc317JEN1cnJlbnRGaWVsZH0sCiAgICAgICAgICAgICAgICBGaWVsZE5hbWUgICAgICAgICAgID0+ICRDdXJyZW50RmllbGQsCiAgICAgICAgICAgICAgICBEZXNjcmlwdGlvblNob3J0ICAgID0+ICRBY3Rpdml0eURpYWxvZy0+e0ZpZWxkc317JEN1cnJlbnRGaWVsZH17RGVzY3JpcHRpb25TaG9ydH0sCiAgICAgICAgICAgICAgICBEZXNjcmlwdGlvbkxvbmcgICAgID0+ICRBY3Rpdml0eURpYWxvZy0+e0ZpZWxkc317JEN1cnJlbnRGaWVsZH17RGVzY3JpcHRpb25Mb25nfSwKICAgICAgICAgICAgICAgIFRpY2tldCAgICAgICAgICAgICAgPT4gXCVUaWNrZXQsCiAgICAgICAgICAgICAgICBFcnJvciAgICAgICAgICAgICAgID0+IFwlRXJyb3IsCiAgICAgICAgICAgICAgICBGb3JtSUQgICAgICAgICAgICAgID0+ICRTZWxmLT57Rm9ybUlEfSwKICAgICAgICAgICAgICAgIEdldFBhcmFtICAgICAgICAgICAgPT4gJFBhcmFte0dldFBhcmFtfSwKICAgICAgICAgICAgICAgIEFKQVhVcGRhdGFibGVGaWVsZHMgPT4gJEFKQVhVcGRhdGFibGVGaWVsZHMsCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBpZiAoICEkUmVzcG9uc2UtPntTdWNjZXNzfSApIHsKCiAgICAgICAgICAgICAgICAjIGRvZXMgbm90IHNob3cgaGVhZGVyIGFuZCBmb290ZXIgYWdhaW4KICAgICAgICAgICAgICAgIGlmICggJFNlbGYtPntJc01haW5XaW5kb3d9ICkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5FcnJvcigKICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PiAkUmVzcG9uc2UtPntNZXNzYWdlfSwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkZhdGFsRXJyb3IoCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PiAkUmVzcG9uc2UtPntNZXNzYWdlfSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRPdXRwdXQgLj0gJFJlc3BvbnNlLT57SFRNTH07CgogICAgICAgICAgICAkUmVuZGVyZWRGaWVsZHN7ICRTZWxmLT57TmFtZVRvSUR9LT57JEN1cnJlbnRGaWVsZH0gfSA9IDE7CiAgICAgICAgfQoKICAgICAgICAjIHJlbmRlciBPd25lcgogICAgICAgIGVsc2lmICggJFNlbGYtPntOYW1lVG9JRH0tPnskQ3VycmVudEZpZWxkfSBlcSAnT3duZXJJRCcgKSB7CiAgICAgICAgICAgIG5leHQgRElBTE9HRklFTEQgaWYgJFJlbmRlcmVkRmllbGRzeyAkU2VsZi0+e05hbWVUb0lEfS0+eyRDdXJyZW50RmllbGR9IH07CgogICAgICAgICAgICBteSAkUmVzcG9uc2UgPSAkU2VsZi0+X1JlbmRlck93bmVyKAogICAgICAgICAgICAgICAgQWN0aXZpdHlEaWFsb2dGaWVsZCA9PiAkQWN0aXZpdHlEaWFsb2ctPntGaWVsZHN9eyRDdXJyZW50RmllbGR9LAogICAgICAgICAgICAgICAgRmllbGROYW1lICAgICAgICAgICA9PiAkQ3VycmVudEZpZWxkLAogICAgICAgICAgICAgICAgRGVzY3JpcHRpb25TaG9ydCAgICA9PiAkQWN0aXZpdHlEaWFsb2ctPntGaWVsZHN9eyRDdXJyZW50RmllbGR9e0Rlc2NyaXB0aW9uU2hvcnR9LAogICAgICAgICAgICAgICAgRGVzY3JpcHRpb25Mb25nICAgICA9PiAkQWN0aXZpdHlEaWFsb2ctPntGaWVsZHN9eyRDdXJyZW50RmllbGR9e0Rlc2NyaXB0aW9uTG9uZ30sCiAgICAgICAgICAgICAgICBUaWNrZXQgICAgICAgICAgICAgID0+IFwlVGlja2V0LAogICAgICAgICAgICAgICAgRXJyb3IgICAgICAgICAgICAgICA9PiBcJUVycm9yLAogICAgICAgICAgICAgICAgRm9ybUlEICAgICAgICAgICAgICA9PiAkU2VsZi0+e0Zvcm1JRH0sCiAgICAgICAgICAgICAgICBHZXRQYXJhbSAgICAgICAgICAgID0+ICRQYXJhbXtHZXRQYXJhbX0sCiAgICAgICAgICAgICAgICBBSkFYVXBkYXRhYmxlRmllbGRzID0+ICRBSkFYVXBkYXRhYmxlRmllbGRzLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKCAhJFJlc3BvbnNlLT57U3VjY2Vzc30gKSB7CgogICAgICAgICAgICAgICAgIyBkb2VzIG5vdCBzaG93IGhlYWRlciBhbmQgZm9vdGVyIGFnYWluCiAgICAgICAgICAgICAgICBpZiAoICRTZWxmLT57SXNNYWluV2luZG93fSApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+RXJyb3IoCiAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJFJlc3BvbnNlLT57TWVzc2FnZX0sCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5GYXRhbEVycm9yKAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJFJlc3BvbnNlLT57TWVzc2FnZX0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkT3V0cHV0IC49ICRSZXNwb25zZS0+e0hUTUx9OwoKICAgICAgICAgICAgJFJlbmRlcmVkRmllbGRzeyAkU2VsZi0+e05hbWVUb0lEfS0+eyRDdXJyZW50RmllbGR9IH0gPSAxOwogICAgICAgIH0KCiAgICAgICAgIyByZW5kZXIgcmVzcG9uc2libGUKICAgICAgICBlbHNpZiAoICRTZWxmLT57TmFtZVRvSUR9LT57JEN1cnJlbnRGaWVsZH0gZXEgJ1Jlc3BvbnNpYmxlSUQnICkgewogICAgICAgICAgICBuZXh0IERJQUxPR0ZJRUxEIGlmICRSZW5kZXJlZEZpZWxkc3sgJFNlbGYtPntOYW1lVG9JRH0tPnskQ3VycmVudEZpZWxkfSB9OwoKICAgICAgICAgICAgbXkgJFJlc3BvbnNlID0gJFNlbGYtPl9SZW5kZXJSZXNwb25zaWJsZSgKICAgICAgICAgICAgICAgIEFjdGl2aXR5RGlhbG9nRmllbGQgPT4gJEFjdGl2aXR5RGlhbG9nLT57RmllbGRzfXskQ3VycmVudEZpZWxkfSwKICAgICAgICAgICAgICAgIEZpZWxkTmFtZSAgICAgICAgICAgPT4gJEN1cnJlbnRGaWVsZCwKICAgICAgICAgICAgICAgIERlc2NyaXB0aW9uU2hvcnQgICAgPT4gJEFjdGl2aXR5RGlhbG9nLT57RmllbGRzfXskQ3VycmVudEZpZWxkfXtEZXNjcmlwdGlvblNob3J0fSwKICAgICAgICAgICAgICAgIERlc2NyaXB0aW9uTG9uZyAgICAgPT4gJEFjdGl2aXR5RGlhbG9nLT57RmllbGRzfXskQ3VycmVudEZpZWxkfXtEZXNjcmlwdGlvbkxvbmd9LAogICAgICAgICAgICAgICAgVGlja2V0ICAgICAgICAgICAgICA9PiBcJVRpY2tldCwKICAgICAgICAgICAgICAgIEVycm9yICAgICAgICAgICAgICAgPT4gXCVFcnJvciwKICAgICAgICAgICAgICAgIEZvcm1JRCAgICAgICAgICAgICAgPT4gJFNlbGYtPntGb3JtSUR9LAogICAgICAgICAgICAgICAgR2V0UGFyYW0gICAgICAgICAgICA9PiAkUGFyYW17R2V0UGFyYW19LAogICAgICAgICAgICAgICAgQUpBWFVwZGF0YWJsZUZpZWxkcyA9PiAkQUpBWFVwZGF0YWJsZUZpZWxkcywKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGlmICggISRSZXNwb25zZS0+e1N1Y2Nlc3N9ICkgewoKICAgICAgICAgICAgICAgICMgZG9lcyBub3Qgc2hvdyBoZWFkZXIgYW5kIGZvb3RlciBhZ2FpbgogICAgICAgICAgICAgICAgaWYgKCAkU2VsZi0+e0lzTWFpbldpbmRvd30gKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkVycm9yKAogICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRSZXNwb25zZS0+e01lc3NhZ2V9LAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRSZXNwb25zZS0+e01lc3NhZ2V9LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJE91dHB1dCAuPSAkUmVzcG9uc2UtPntIVE1MfTsKCiAgICAgICAgICAgICRSZW5kZXJlZEZpZWxkc3sgJFNlbGYtPntOYW1lVG9JRH0tPnskQ3VycmVudEZpZWxkfSB9ID0gMTsKICAgICAgICB9CgogICAgICAgICMgcmVuZGVyIEN1c3RvbWVySUQKICAgICAgICBlbHNpZiAoICRTZWxmLT57TmFtZVRvSUR9LT57JEN1cnJlbnRGaWVsZH0gZXEgJ0N1c3RvbWVySUQnICkgewogICAgICAgICAgICBuZXh0IERJQUxPR0ZJRUxEIGlmICRSZW5kZXJlZEZpZWxkc3sgJFNlbGYtPntOYW1lVG9JRH0tPnskQ3VycmVudEZpZWxkfSB9OwoKICAgICAgICAgICAgbXkgJFJlc3BvbnNlID0gJFNlbGYtPl9SZW5kZXJDdXN0b21lcigKICAgICAgICAgICAgICAgIEFjdGl2aXR5RGlhbG9nRmllbGQgPT4gJEFjdGl2aXR5RGlhbG9nLT57RmllbGRzfXskQ3VycmVudEZpZWxkfSwKICAgICAgICAgICAgICAgIEZpZWxkTmFtZSAgICAgICAgICAgPT4gJEN1cnJlbnRGaWVsZCwKICAgICAgICAgICAgICAgIERlc2NyaXB0aW9uU2hvcnQgICAgPT4gJEFjdGl2aXR5RGlhbG9nLT57RmllbGRzfXskQ3VycmVudEZpZWxkfXtEZXNjcmlwdGlvblNob3J0fSwKICAgICAgICAgICAgICAgIERlc2NyaXB0aW9uTG9uZyAgICAgPT4gJEFjdGl2aXR5RGlhbG9nLT57RmllbGRzfXskQ3VycmVudEZpZWxkfXtEZXNjcmlwdGlvbkxvbmd9LAogICAgICAgICAgICAgICAgVGlja2V0ICAgICAgICAgICAgICA9PiBcJVRpY2tldCwKICAgICAgICAgICAgICAgIEVycm9yICAgICAgICAgICAgICAgPT4gXCVFcnJvciwKICAgICAgICAgICAgICAgIEZvcm1JRCAgICAgICAgICAgICAgPT4gJFNlbGYtPntGb3JtSUR9LAogICAgICAgICAgICAgICAgR2V0UGFyYW0gICAgICAgICAgICA9PiAkUGFyYW17R2V0UGFyYW19LAogICAgICAgICAgICAgICAgQUpBWFVwZGF0YWJsZUZpZWxkcyA9PiAkQUpBWFVwZGF0YWJsZUZpZWxkcywKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGlmICggISRSZXNwb25zZS0+e1N1Y2Nlc3N9ICkgewoKICAgICAgICAgICAgICAgICMgZG9lcyBub3Qgc2hvdyBoZWFkZXIgYW5kIGZvb3RlciBhZ2FpbgogICAgICAgICAgICAgICAgaWYgKCAkU2VsZi0+e0lzTWFpbldpbmRvd30gKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkVycm9yKAogICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRSZXNwb25zZS0+e01lc3NhZ2V9LAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRSZXNwb25zZS0+e01lc3NhZ2V9LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJE91dHB1dCAuPSAkUmVzcG9uc2UtPntIVE1MfTsKCiAgICAgICAgICAgICRSZW5kZXJlZEZpZWxkc3sgJFNlbGYtPntOYW1lVG9JRH0tPnskQ3VycmVudEZpZWxkfSB9ID0gMTsKICAgICAgICB9CgogICAgICAgIGVsc2lmICggJEN1cnJlbnRGaWVsZCBlcSAnUGVuZGluZ1RpbWUnICkgewoKICAgICAgICAgICAgIyBQZW5kaW5nVGltZSBpcyBqdXN0IHVzZWZ1bCBpZiB3ZSBoYXZlIFN0YXRlIG9yIFN0YXRlSUQKICAgICAgICAgICAgaWYgKCAhZ3JlcCB7bXteKFN0YXRlSUR8U3RhdGUpJH14bXN9IEB7ICRBY3Rpdml0eURpYWxvZy0+e0ZpZWxkT3JkZXJ9IH0gKSB7CiAgICAgICAgICAgICAgICBteSAkTWVzc2FnZSA9ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgKICAgICAgICAgICAgICAgICAgICAnUGVuZGluZ1RpbWUgY2FuIGp1c3QgYmUgdXNlZCBpZiBTdGF0ZSBvciBTdGF0ZUlEIGlzIGNvbmZpZ3VyZWQgZm9yIHRoZSBzYW1lIEFjdGl2aXR5RGlhbG9nLiBBY3Rpdml0eURpYWxvZzogJXMhJywKICAgICAgICAgICAgICAgICAgICAkQWN0aXZpdHlBY3Rpdml0eURpYWxvZy0+e0FjdGl2aXR5RGlhbG9nfSwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgIyBkb2VzIG5vdCBzaG93IGhlYWRlciBhbmQgZm9vdGVyIGFnYWluCiAgICAgICAgICAgICAgICBpZiAoICRTZWxmLT57SXNNYWluV2luZG93fSApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+RXJyb3IoCiAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJE1lc3NhZ2UsCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5GYXRhbEVycm9yKAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJE1lc3NhZ2UsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICBuZXh0IERJQUxPR0ZJRUxEIGlmICRSZW5kZXJlZEZpZWxkc3sgJFNlbGYtPntOYW1lVG9JRH0tPnskQ3VycmVudEZpZWxkfSB9OwoKICAgICAgICAgICAgbXkgJFJlc3BvbnNlID0gJFNlbGYtPl9SZW5kZXJQZW5kaW5nVGltZSgKICAgICAgICAgICAgICAgIEFjdGl2aXR5RGlhbG9nRmllbGQgPT4gJEFjdGl2aXR5RGlhbG9nLT57RmllbGRzfXskQ3VycmVudEZpZWxkfSwKICAgICAgICAgICAgICAgIEZpZWxkTmFtZSAgICAgICAgICAgPT4gJEN1cnJlbnRGaWVsZCwKICAgICAgICAgICAgICAgIERlc2NyaXB0aW9uU2hvcnQgICAgPT4gJEFjdGl2aXR5RGlhbG9nLT57RmllbGRzfXskQ3VycmVudEZpZWxkfXtEZXNjcmlwdGlvblNob3J0fSwKICAgICAgICAgICAgICAgIERlc2NyaXB0aW9uTG9uZyAgICAgPT4gJEFjdGl2aXR5RGlhbG9nLT57RmllbGRzfXskQ3VycmVudEZpZWxkfXtEZXNjcmlwdGlvbkxvbmd9LAogICAgICAgICAgICAgICAgVGlja2V0ICAgICAgICAgICAgICA9PiBcJVRpY2tldCwKICAgICAgICAgICAgICAgIEVycm9yICAgICAgICAgICAgICAgPT4gXCVFcnJvciwKICAgICAgICAgICAgICAgIEZvcm1JRCAgICAgICAgICAgICAgPT4gJFNlbGYtPntGb3JtSUR9LAogICAgICAgICAgICAgICAgR2V0UGFyYW0gICAgICAgICAgICA9PiAkUGFyYW17R2V0UGFyYW19LAogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKCAhJFJlc3BvbnNlLT57U3VjY2Vzc30gKSB7CgogICAgICAgICAgICAgICAgIyBkb2VzIG5vdCBzaG93IGhlYWRlciBhbmQgZm9vdGVyIGFnYWluCiAgICAgICAgICAgICAgICBpZiAoICRTZWxmLT57SXNNYWluV2luZG93fSApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+RXJyb3IoCiAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJFJlc3BvbnNlLT57TWVzc2FnZX0sCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5GYXRhbEVycm9yKAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJFJlc3BvbnNlLT57TWVzc2FnZX0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkT3V0cHV0IC49ICRSZXNwb25zZS0+e0hUTUx9OwoKICAgICAgICAgICAgJFJlbmRlcmVkRmllbGRzeyAkU2VsZi0+e05hbWVUb0lEfS0+eyRDdXJyZW50RmllbGR9IH0gPSAxOwogICAgICAgIH0KCiAgICAgICAgIyByZW5kZXIgVGl0bGUKICAgICAgICBlbHNpZiAoICRTZWxmLT57TmFtZVRvSUR9LT57JEN1cnJlbnRGaWVsZH0gZXEgJ1RpdGxlJyApIHsKICAgICAgICAgICAgbmV4dCBESUFMT0dGSUVMRCBpZiAkUmVuZGVyZWRGaWVsZHN7ICRTZWxmLT57TmFtZVRvSUR9LT57JEN1cnJlbnRGaWVsZH0gfTsKCiAgICAgICAgICAgIG15ICRSZXNwb25zZSA9ICRTZWxmLT5fUmVuZGVyVGl0bGUoCiAgICAgICAgICAgICAgICBBY3Rpdml0eURpYWxvZ0ZpZWxkID0+ICRBY3Rpdml0eURpYWxvZy0+e0ZpZWxkc317JEN1cnJlbnRGaWVsZH0sCiAgICAgICAgICAgICAgICBGaWVsZE5hbWUgICAgICAgICAgID0+ICRDdXJyZW50RmllbGQsCiAgICAgICAgICAgICAgICBEZXNjcmlwdGlvblNob3J0ICAgID0+ICRBY3Rpdml0eURpYWxvZy0+e0ZpZWxkc317JEN1cnJlbnRGaWVsZH17RGVzY3JpcHRpb25TaG9ydH0sCiAgICAgICAgICAgICAgICBEZXNjcmlwdGlvbkxvbmcgICAgID0+ICRBY3Rpdml0eURpYWxvZy0+e0ZpZWxkc317JEN1cnJlbnRGaWVsZH17RGVzY3JpcHRpb25Mb25nfSwKICAgICAgICAgICAgICAgIFRpY2tldCAgICAgICAgICAgICAgPT4gXCVUaWNrZXQsCiAgICAgICAgICAgICAgICBFcnJvciAgICAgICAgICAgICAgID0+IFwlRXJyb3IsCiAgICAgICAgICAgICAgICBGb3JtSUQgICAgICAgICAgICAgID0+ICRTZWxmLT57Rm9ybUlEfSwKICAgICAgICAgICAgICAgIEdldFBhcmFtICAgICAgICAgICAgPT4gJFBhcmFte0dldFBhcmFtfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGlmICggISRSZXNwb25zZS0+e1N1Y2Nlc3N9ICkgewoKICAgICAgICAgICAgICAgICMgZG9lcyBub3Qgc2hvdyBoZWFkZXIgYW5kIGZvb3RlciBhZ2FpbgogICAgICAgICAgICAgICAgaWYgKCAkU2VsZi0+e0lzTWFpbldpbmRvd30gKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkVycm9yKAogICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRSZXNwb25zZS0+e01lc3NhZ2V9LAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRSZXNwb25zZS0+e01lc3NhZ2V9LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJE91dHB1dCAuPSAkUmVzcG9uc2UtPntIVE1MfTsKCiAgICAgICAgICAgICRSZW5kZXJlZEZpZWxkc3skQ3VycmVudEZpZWxkfSA9IDE7CiAgICAgICAgfQoKICAgICAgICAjIHJlbmRlciBBcnRpY2xlCiAgICAgICAgZWxzaWYgKCAkU2VsZi0+e05hbWVUb0lEfS0+eyRDdXJyZW50RmllbGR9IGVxICdBcnRpY2xlJyApIHsKICAgICAgICAgICAgbmV4dCBESUFMT0dGSUVMRCBpZiAkUmVuZGVyZWRGaWVsZHN7ICRTZWxmLT57TmFtZVRvSUR9LT57JEN1cnJlbnRGaWVsZH0gfTsKCiAgICAgICAgICAgIG15ICRSZXNwb25zZSA9ICRTZWxmLT5fUmVuZGVyQXJ0aWNsZSgKICAgICAgICAgICAgICAgIEFjdGl2aXR5RGlhbG9nRmllbGQgPT4gJEFjdGl2aXR5RGlhbG9nLT57RmllbGRzfXskQ3VycmVudEZpZWxkfSwKICAgICAgICAgICAgICAgIEZpZWxkTmFtZSAgICAgICAgICAgPT4gJEN1cnJlbnRGaWVsZCwKICAgICAgICAgICAgICAgIERlc2NyaXB0aW9uU2hvcnQgICAgPT4gJEFjdGl2aXR5RGlhbG9nLT57RmllbGRzfXskQ3VycmVudEZpZWxkfXtEZXNjcmlwdGlvblNob3J0fSwKICAgICAgICAgICAgICAgIERlc2NyaXB0aW9uTG9uZyAgICAgPT4gJEFjdGl2aXR5RGlhbG9nLT57RmllbGRzfXskQ3VycmVudEZpZWxkfXtEZXNjcmlwdGlvbkxvbmd9LAogICAgICAgICAgICAgICAgVGlja2V0ICAgICAgICAgICAgICA9PiBcJVRpY2tldCwKICAgICAgICAgICAgICAgIEVycm9yICAgICAgICAgICAgICAgPT4gXCVFcnJvciwKICAgICAgICAgICAgICAgIEZvcm1JRCAgICAgICAgICAgICAgPT4gJFNlbGYtPntGb3JtSUR9LAogICAgICAgICAgICAgICAgR2V0UGFyYW0gICAgICAgICAgICA9PiAkUGFyYW17R2V0UGFyYW19LAogICAgICAgICAgICAgICAgSW5mb3JtQWdlbnRzICAgICAgICA9PiAkQWN0aXZpdHlEaWFsb2ctPntGaWVsZHN9LT57QXJ0aWNsZX0tPntDb25maWd9LT57SW5mb3JtQWdlbnRzfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGlmICggISRSZXNwb25zZS0+e1N1Y2Nlc3N9ICkgewoKICAgICAgICAgICAgICAgICMgZG9lcyBub3Qgc2hvdyBoZWFkZXIgYW5kIGZvb3RlciBhZ2FpbgogICAgICAgICAgICAgICAgaWYgKCAkU2VsZi0+e0lzTWFpbldpbmRvd30gKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkVycm9yKAogICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRSZXNwb25zZS0+e01lc3NhZ2V9LAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRSZXNwb25zZS0+e01lc3NhZ2V9LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJE91dHB1dCAuPSAkUmVzcG9uc2UtPntIVE1MfTsKCiAgICAgICAgICAgICRSZW5kZXJlZEZpZWxkc3skQ3VycmVudEZpZWxkfSA9IDE7CiAgICAgICAgfQoKICAgICAgICAjIHJlbmRlciBUeXBlCiAgICAgICAgZWxzaWYgKCAkU2VsZi0+e05hbWVUb0lEfS0+eyRDdXJyZW50RmllbGR9IGVxICdUeXBlSUQnICkgewoKICAgICAgICAgICAgIyBXZSBkb24ndCByZW5kZXIgRmllbGRzIHR3aWNlLAogICAgICAgICAgICAjIGlmIHRoZXJlIHdhcyBhbHJlYWR5IGEgQ29uZmlnIHdpdGhvdXQgSUQsIHNraXAgdGhpcyBmaWVsZAogICAgICAgICAgICBuZXh0IERJQUxPR0ZJRUxEIGlmICRSZW5kZXJlZEZpZWxkc3sgJFNlbGYtPntOYW1lVG9JRH0tPnskQ3VycmVudEZpZWxkfSB9OwoKICAgICAgICAgICAgbXkgJFJlc3BvbnNlID0gJFNlbGYtPl9SZW5kZXJUeXBlKAogICAgICAgICAgICAgICAgQWN0aXZpdHlEaWFsb2dGaWVsZCA9PiAkQWN0aXZpdHlEaWFsb2ctPntGaWVsZHN9eyRDdXJyZW50RmllbGR9LAogICAgICAgICAgICAgICAgRmllbGROYW1lICAgICAgICAgICA9PiAkQ3VycmVudEZpZWxkLAogICAgICAgICAgICAgICAgRGVzY3JpcHRpb25TaG9ydCAgICA9PiAkQWN0aXZpdHlEaWFsb2ctPntGaWVsZHN9eyRDdXJyZW50RmllbGR9e0Rlc2NyaXB0aW9uU2hvcnR9LAogICAgICAgICAgICAgICAgRGVzY3JpcHRpb25Mb25nICAgICA9PiAkQWN0aXZpdHlEaWFsb2ctPntGaWVsZHN9eyRDdXJyZW50RmllbGR9e0Rlc2NyaXB0aW9uTG9uZ30sCiAgICAgICAgICAgICAgICBUaWNrZXQgICAgICAgICAgICAgID0+IFwlVGlja2V0LAogICAgICAgICAgICAgICAgRXJyb3IgICAgICAgICAgICAgICA9PiBcJUVycm9yLAogICAgICAgICAgICAgICAgRm9ybUlEICAgICAgICAgICAgICA9PiAkU2VsZi0+e0Zvcm1JRH0sCiAgICAgICAgICAgICAgICBHZXRQYXJhbSAgICAgICAgICAgID0+ICRQYXJhbXtHZXRQYXJhbX0sCiAgICAgICAgICAgICAgICBBSkFYVXBkYXRhYmxlRmllbGRzID0+ICRBSkFYVXBkYXRhYmxlRmllbGRzLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKCAhJFJlc3BvbnNlLT57U3VjY2Vzc30gKSB7CgogICAgICAgICAgICAgICAgIyBkb2VzIG5vdCBzaG93IGhlYWRlciBhbmQgZm9vdGVyIGFnYWluCiAgICAgICAgICAgICAgICBpZiAoICRTZWxmLT57SXNNYWluV2luZG93fSApIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+RXJyb3IoCiAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJFJlc3BvbnNlLT57TWVzc2FnZX0sCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5GYXRhbEVycm9yKAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJFJlc3BvbnNlLT57TWVzc2FnZX0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkT3V0cHV0IC49ICRSZXNwb25zZS0+e0hUTUx9OwoKICAgICAgICAgICAgJFJlbmRlcmVkRmllbGRzeyAkU2VsZi0+e05hbWVUb0lEfS0+eyRDdXJyZW50RmllbGR9IH0gPSAxOwogICAgICAgIH0KICAgIH0KCiAgICBteSAkRm9vdGVyQ1NTQ2xhc3MgPSAnRm9vdGVyJzsKCiAgICBpZiAoICRTZWxmLT57SXNBamF4UmVxdWVzdH0gKSB7CgogICAgICAgICMgRHVlIHRvIHRoZSBpbml0aWFsIGxvYWRpbmcgb2YKICAgICAgICAjIHRoZSBmaXJzdCBBY3Rpdml0eURpYWxvZyBhZnRlciBQcm9jZXNzIHNlbGVjdGlvbgogICAgICAgICMgd2UgaGF2ZSB0byBiaW5kIHRoZSBBamF4VXBkYXRlIEZ1bmN0aW9uIG9uCiAgICAgICAgIyB0aGUgc2VsZWN0cywgc28gd2UgZ2V0IHRoZSBjb21wbGV0ZSBKU09uRG9jdW1lbnRDb21wbGV0ZSBjb2RlCiAgICAgICAgIyBhbmQgZGVsaXZlciBpdCBpbiB0aGUgRm9vdGVySlMgYmxvY2suCiAgICAgICAgIyBUaGlzIEphdmFzY3JpcHQgUGFydCBpcyBleGVjdXRlZCBpbgogICAgICAgICMgQWdlbnRUaWNrZXRQcm9jZXNzLnR0CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ0Zvb3RlckpTJywKICAgICAgICApOwoKICAgICAgICAkRm9vdGVyQ1NTQ2xhc3MgPSAnQ2VudGVyZWQnOwogICAgfQoKICAgICMgc2V0IHN1Ym1pdCBidXR0b24gZGF0YQogICAgbXkgJEJ1dHRvblRleHQgID0gJ1N1Ym1pdCc7CiAgICBteSAkQnV0dG9uVGl0bGUgPSAnU2F2ZSc7CiAgICBteSAkQnV0dG9uSUQgICAgPSAnU3VibWl0JyAuICRBY3Rpdml0eUFjdGl2aXR5RGlhbG9nLT57QWN0aXZpdHlEaWFsb2d9OwogICAgaWYgKCAkQWN0aXZpdHlEaWFsb2ctPntTdWJtaXRCdXR0b25UZXh0fSApIHsKICAgICAgICAkQnV0dG9uVGV4dCAgPSAkQWN0aXZpdHlEaWFsb2ctPntTdWJtaXRCdXR0b25UZXh0fTsKICAgICAgICAkQnV0dG9uVGl0bGUgPSAkQWN0aXZpdHlEaWFsb2ctPntTdWJtaXRCdXR0b25UZXh0fTsKICAgIH0KCiAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICBOYW1lID0+ICdGb290ZXInLAogICAgICAgIERhdGEgPT4gewogICAgICAgICAgICBGb290ZXJDU1NDbGFzcyA9PiAkRm9vdGVyQ1NTQ2xhc3MsCiAgICAgICAgICAgIEJ1dHRvblRleHQgICAgID0+ICRCdXR0b25UZXh0LAogICAgICAgICAgICBCdXR0b25UaXRsZSAgICA9PiAkQnV0dG9uVGl0bGUsCiAgICAgICAgICAgIEJ1dHRvbklEICAgICAgID0+ICRCdXR0b25JRAoKICAgICAgICB9LAogICAgKTsKCiAgICBpZiAoICRBY3Rpdml0eURpYWxvZy0+e1N1Ym1pdEFkdmljZVRleHR9ICkgewogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdTdWJtaXRBZHZpY2VUZXh0JywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBBZHZpY2VUZXh0ID0+ICRBY3Rpdml0eURpYWxvZy0+e1N1Ym1pdEFkdmljZVRleHR9LAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICB9CgogICAgIyByZWxvYWQgcGFyZW50IHdpbmRvdwogICAgaWYgKCAkUGFyYW17UGFyZW50UmVsb2FkfSApIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5BZGRKU0RhdGEoCiAgICAgICAgICAgIEtleSAgID0+ICdQYXJlbnRSZWxvYWQnLAogICAgICAgICAgICBWYWx1ZSA9PiAxLAogICAgICAgICk7CiAgICB9CgogICAgIyBBZGQgdGhlIEZvcm1Gb290ZXIKICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+T3V0cHV0KAogICAgICAgIFRlbXBsYXRlRmlsZSA9PiAnUHJvY2Vzc01hbmFnZW1lbnQvQWN0aXZpdHlEaWFsb2dGb290ZXInLAogICAgICAgIERhdGEgICAgICAgICA9PiB7fSwKICAgICk7CgogICAgIyBkaXNwbGF5IHJlZ3VsYXIgZm9vdGVyIG9ubHkgaW4gbm9uLWFqYXggY2FzZQogICAgaWYgKCAhJFNlbGYtPntJc0FqYXhSZXF1ZXN0fSApIHsKICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPkZvb3RlciggVHlwZSA9PiAkU2VsZi0+e0lzTWFpbldpbmRvd30gPyAnJyA6ICdTbWFsbCcgKTsKICAgIH0KCiAgICByZXR1cm4gJE91dHB1dDsKfQoKc3ViIF9SZW5kZXJQZW5kaW5nVGltZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgZ2V0IGxheW91dCBvYmplY3QKICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgZm9yIG15ICROZWVkZWQgKHF3KEZvcm1JRCkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBTdWNjZXNzID0+IDAsCiAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0KICAgICAgICAgICAgICAgICAgICAtPlRyYW5zbGF0ZSggJ1BhcmFtZXRlciAlcyBpcyBtaXNzaW5nIGluICVzLicsICROZWVkZWQsICdfUmVuZGVyUGVuZGluZ1RpbWUnICksCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgfQogICAgaWYgKCAhSXNIYXNoUmVmV2l0aERhdGEoICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfSApICkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIFN1Y2Nlc3MgPT4gMCwKICAgICAgICAgICAgTWVzc2FnZSA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9CiAgICAgICAgICAgICAgICAtPlRyYW5zbGF0ZSggJ1BhcmFtZXRlciAlcyBpcyBtaXNzaW5nIGluICVzLicsICdBY3Rpdml0eURpYWxvZ0ZpZWxkJywgJ19SZW5kZXJQZW5kaW5nVGltZScgKSwKICAgICAgICB9OwogICAgfQoKICAgIG15ICVEYXRhID0gKAogICAgICAgIExhYmVsID0+ICgKICAgICAgICAgICAgJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCdQZW5kaW5nIERhdGUnKQogICAgICAgICAgICAgICAgLiAnICgnCiAgICAgICAgICAgICAgICAuICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgnZm9yIHBlbmRpbmcqIHN0YXRlcycpIC4gJyknCiAgICAgICAgKSwKICAgICAgICBGaWVsZElEID0+ICdSZXNwb25zaWJsZUlEJywKICAgICAgICBGb3JtSUQgID0+ICRQYXJhbXtGb3JtSUR9LAogICAgKTsKCiAgICBteSAkRXJyb3IgPSAnJzsKICAgIGlmICggSXNIYXNoUmVmV2l0aERhdGEoICRQYXJhbXtFcnJvcn0gKSApIHsKICAgICAgICBpZiAoICRQYXJhbXtFcnJvcn0tPnsnUGVuZGluZ3RUaW1lRGF5J30gKSB7CiAgICAgICAgICAgICREYXRhe1BlbmRpbmd0VGltZURheUVycm9yfSA9ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgiRGF0ZSBpbnZhbGlkISIpOwogICAgICAgICAgICAkRXJyb3IgPSAkUGFyYW17RXJyb3J9LT57J1BlbmRpbmd0VGltZURheSd9OwogICAgICAgIH0KICAgICAgICBpZiAoICRQYXJhbXtFcnJvcn0tPnsnUGVuZGluZ3RUaW1lSG91cid9ICkgewogICAgICAgICAgICAkRGF0YXtQZW5kaW5ndFRpbWVIb3VyRXJyb3J9ID0gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCJEYXRlIGludmFsaWQhIik7CiAgICAgICAgICAgICRFcnJvciA9ICRQYXJhbXtFcnJvcn0tPnsnUGVuZGluZ3RUaW1lRGF5J307CiAgICAgICAgfQogICAgfQoKICAgIG15ICRDYWxlbmRhciA9ICcnOwoKICAgICMgZ2V0IHRpY2tldCBvYmplY3QKICAgIG15ICRUaWNrZXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGlja2V0Jyk7CgogICAgIyBnZXQgdXNlZCBjYWxlbmRhciBpZiB3ZSBoYXZlIHRpY2tldCBkYXRhCiAgICBpZiAoIElzSGFzaFJlZldpdGhEYXRhKCAkUGFyYW17VGlja2V0fSApICkgewogICAgICAgICRDYWxlbmRhciA9ICRUaWNrZXRPYmplY3QtPlRpY2tldENhbGVuZGFyR2V0KAogICAgICAgICAgICAleyAkUGFyYW17VGlja2V0fSB9LAogICAgICAgICk7CiAgICB9CgogICAgJERhdGF7Q29udGVudH0gPSAkTGF5b3V0T2JqZWN0LT5CdWlsZERhdGVTZWxlY3Rpb24oCiAgICAgICAgUHJlZml4ID0+ICdQZW5kaW5nVGltZScsCiAgICAgICAgUGVuZGluZ1RpbWVSZXF1aXJlZCA9PgogICAgICAgICAgICAoCiAgICAgICAgICAgICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0Rpc3BsYXl9ICYmICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0Rpc3BsYXl9ID09IDIKICAgICAgICAgICAgKSA/IDEgOiAwLAogICAgICAgIEZvcm1hdCAgICAgICAgICAgPT4gJ0RhdGVJbnB1dEZvcm1hdExvbmcnLAogICAgICAgIFllYXJQZXJpb2RQYXN0ICAgPT4gMCwKICAgICAgICBZZWFyUGVyaW9kRnV0dXJlID0+IDUsCiAgICAgICAgRGlmZlRpbWUgICAgICAgICA9PiAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntEZWZhdWx0VmFsdWV9CiAgICAgICAgICAgIHx8ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnVGlja2V0OjpGcm9udGVuZDo6UGVuZGluZ0RpZmZUaW1lJykKICAgICAgICAgICAgfHwgODY0MDAsCiAgICAgICAgQ2xhc3MgICAgICAgICAgICAgICAgPT4gJEVycm9yLAogICAgICAgIFZhbGlkYXRlICAgICAgICAgICAgID0+IDEsCiAgICAgICAgVmFsaWRhdGVEYXRlSW5GdXR1cmUgPT4gMSwKICAgICAgICBDYWxlbmRhciAgICAgICAgICAgICA9PiAkQ2FsZW5kYXIsCiAgICApOwoKICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgIE5hbWUgPT4gJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57TGF5b3V0QmxvY2t9IHx8ICdydzpQZW5kaW5nVGltZScsCiAgICAgICAgRGF0YSA9PiBcJURhdGEsCiAgICApOwogICAgaWYgKCAkUGFyYW17RGVzY3JpcHRpb25TaG9ydH0gKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57TGF5b3V0QmxvY2t9IHx8ICdydzpQZW5kaW5nVGltZTpEZXNjcmlwdGlvblNob3J0JywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBEZXNjcmlwdGlvblNob3J0ID0+ICRQYXJhbXtEZXNjcmlwdGlvblNob3J0fSwKICAgICAgICAgICAgfSwKICAgICAgICApOwogICAgfQoKICAgIGlmICggJFBhcmFte0Rlc2NyaXB0aW9uTG9uZ30gKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ3J3OlBlbmRpbmdUaW1lOkRlc2NyaXB0aW9uTG9uZycsCiAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgRGVzY3JpcHRpb25Mb25nID0+ICRQYXJhbXtEZXNjcmlwdGlvbkxvbmd9LAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgICBTdWNjZXNzID0+IDEsCiAgICAgICAgSFRNTCAgICA9PiAkTGF5b3V0T2JqZWN0LT5PdXRwdXQoIFRlbXBsYXRlRmlsZSA9PiAnUHJvY2Vzc01hbmFnZW1lbnQvUGVuZGluZ1RpbWUnICksCiAgICB9Owp9CgpzdWIgX1JlbmRlckR5bmFtaWNGaWVsZCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgZ2V0IGxheW91dCBvYmplY3QKICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgZm9yIG15ICROZWVkZWQgKHF3KEZvcm1JRCBGaWVsZE5hbWUpKSB7CiAgICAgICAgaWYgKCAhJFBhcmFteyROZWVkZWR9ICkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgU3VjY2VzcyA9PiAwLAogICAgICAgICAgICAgICAgTWVzc2FnZSA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9CiAgICAgICAgICAgICAgICAgICAgLT5UcmFuc2xhdGUoICdQYXJhbWV0ZXIgJXMgaXMgbWlzc2luZyBpbiAlcy4nLCAkTmVlZGVkLCAnX1JlbmRlckR5bmFtaWNGaWVsZCcgKSwKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICB9CgogICAgbXkgJER5bmFtaWNGaWVsZCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEeW5hbWljRmllbGQnKS0+RHluYW1pY0ZpZWxkTGlzdEdldCgKICAgICAgICBWYWxpZCAgICAgID0+IDEsCiAgICAgICAgT2JqZWN0VHlwZSA9PiAnVGlja2V0JywKICAgICk7CgogICAgbXkgJER5bmFtaWNGaWVsZENvbmZpZyA9ICggZ3JlcCB7ICRfLT57TmFtZX0gZXEgJFBhcmFte0ZpZWxkTmFtZX0gfSBAeyREeW5hbWljRmllbGR9IClbMF07CgogICAgaWYgKCAhSXNIYXNoUmVmV2l0aERhdGEoJER5bmFtaWNGaWVsZENvbmZpZykgKSB7CgogICAgICAgIG15ICRNZXNzYWdlID0gIkR5bmFtaWNGaWVsZENvbmZpZyBtaXNzaW5nIGZvciBmaWVsZDogJFBhcmFte0ZpZWxkTmFtZX0sIG9yIGlzIG5vdCBhIFRpY2tldCBEeW5hbWljIEZpZWxkISI7CgogICAgICAgICMgbG9nIGVycm9yIGJ1dCBkb2VzIG5vdCBzdG9wIHRoZSBleGVjdXRpb24gYXMgaXQgY291bGQgYmUgYW4gb2xkIEFydGljbGUKICAgICAgICAjIER5bmFtaWNGaWVsZCwgc2VlIGJ1ZyMxMTY2NgogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAkTWVzc2FnZSwKICAgICAgICApOwoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBTdWNjZXNzID0+IDEsCiAgICAgICAgICAgIEhUTUwgICAgPT4gJycsCiAgICAgICAgfTsKICAgIH0KCiAgICBteSAkUG9zc2libGVWYWx1ZXNGaWx0ZXI7CgogICAgIyBnZXQgZHluYW1pYyBmaWVsZCBiYWNrZW5kIG9iamVjdAogICAgbXkgJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6RHluYW1pY0ZpZWxkOjpCYWNrZW5kJyk7CgogICAgbXkgJElzQUNMUmVkdWNpYmxlID0gJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QtPkhhc0JlaGF2aW9yKAogICAgICAgIER5bmFtaWNGaWVsZENvbmZpZyA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnLAogICAgICAgIEJlaGF2aW9yICAgICAgICAgICA9PiAnSXNBQ0xSZWR1Y2libGUnLAogICAgKTsKCiAgICAjIGdldCB0aWNrZXQgb2JqZWN0CiAgICBteSAkVGlja2V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpY2tldCcpOwoKICAgIGlmICgkSXNBQ0xSZWR1Y2libGUpIHsKCiAgICAgICAgIyBnZXQgUG9zc2libGVWYWx1ZXMKICAgICAgICBteSAkUG9zc2libGVWYWx1ZXMgPSAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdC0+UG9zc2libGVWYWx1ZXNHZXQoCiAgICAgICAgICAgIER5bmFtaWNGaWVsZENvbmZpZyA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnLAogICAgICAgICk7CgogICAgICAgICMgQWxsIFRpY2tldCBEeW5hbWljRmllbGRzCiAgICAgICAgIyB1c2VkIGZvciBBQ0wgY2hlY2tpbmcKICAgICAgICBteSAlRHluYW1pY0ZpZWxkQ2hlY2tQYXJhbSA9IG1hcCB7ICRfID0+ICRQYXJhbXtHZXRQYXJhbX17JF99IH0KICAgICAgICAgICAgZ3JlcCB7bXteRHluYW1pY0ZpZWxkX314bXN9ICgga2V5cyAleyAkUGFyYW17R2V0UGFyYW19IH0gKTsKCiAgICAgICAgIyBjaGVjayBpZiBmaWVsZCBoYXMgUG9zc2libGVWYWx1ZXMgcHJvcGVydHkgaW4gaXRzIGNvbmZpZ3VyYXRpb24KICAgICAgICBpZiAoIElzSGFzaFJlZldpdGhEYXRhKCRQb3NzaWJsZVZhbHVlcykgKSB7CgogICAgICAgICAgICAjIGNvbnZlcnQgcG9zc2libGUgdmFsdWVzIGtleSA9PiB2YWx1ZSB0byBrZXkgPT4ga2V5IGZvciBBQ0xzIHVzaW5nIGEgSGFzaCBzbGljZQogICAgICAgICAgICBteSAlQWNsRGF0YSA9ICV7JFBvc3NpYmxlVmFsdWVzfTsKICAgICAgICAgICAgQEFjbERhdGF7IGtleXMgJUFjbERhdGEgfSA9IGtleXMgJUFjbERhdGE7CgogICAgICAgICAgICAjIHNldCBwb3NzaWJsZSB2YWx1ZXMgZmlsdGVyIGZyb20gQUNMcwogICAgICAgICAgICBteSAkQUNMID0gJFRpY2tldE9iamVjdC0+VGlja2V0QWNsKAogICAgICAgICAgICAgICAgJXsgJFBhcmFte0dldFBhcmFtfSB9LAogICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkICA9PiBcJUR5bmFtaWNGaWVsZENoZWNrUGFyYW0sCiAgICAgICAgICAgICAgICBBY3Rpb24gICAgICAgID0+ICRTZWxmLT57QWN0aW9ufSwKICAgICAgICAgICAgICAgIFJldHVyblR5cGUgICAgPT4gJ1RpY2tldCcsCiAgICAgICAgICAgICAgICBSZXR1cm5TdWJUeXBlID0+ICdEeW5hbWljRmllbGRfJyAuICREeW5hbWljRmllbGRDb25maWctPntOYW1lfSwKICAgICAgICAgICAgICAgIERhdGEgICAgICAgICAgPT4gXCVBY2xEYXRhLAogICAgICAgICAgICAgICAgVXNlcklEICAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGlmICgkQUNMKSB7CiAgICAgICAgICAgICAgICBteSAlRmlsdGVyID0gJFRpY2tldE9iamVjdC0+VGlja2V0QWNsRGF0YSgpOwoKICAgICAgICAgICAgICAgICMgY29udmVydCBGaWxlciBrZXkgPT4ga2V5IGJhY2sgdG8ga2V5ID0+IHZhbHVlIHVzaW5nIG1hcAogICAgICAgICAgICAgICAgJXskUG9zc2libGVWYWx1ZXNGaWx0ZXJ9ID0gbWFwIHsgJF8gPT4gJFBvc3NpYmxlVmFsdWVzLT57JF99IH0ga2V5cyAlRmlsdGVyOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIG15ICRTZXJ2ZXJFcnJvcjsKICAgIGlmICggSXNIYXNoUmVmV2l0aERhdGEoICRQYXJhbXtFcnJvcn0gKSApIHsKICAgICAgICBpZiAoCiAgICAgICAgICAgIGRlZmluZWQgJFBhcmFte0Vycm9yfS0+eyAkUGFyYW17RmllbGROYW1lfSB9CiAgICAgICAgICAgICYmICRQYXJhbXtFcnJvcn0tPnsgJFBhcmFte0ZpZWxkTmFtZX0gfSBuZSAnJwogICAgICAgICAgICApCiAgICAgICAgewogICAgICAgICAgICAkU2VydmVyRXJyb3IgPSAxOwogICAgICAgIH0KICAgIH0KCiAgICAjIGdldCBzdG9yZWQgZHluYW1pYyBmaWVsZCB2YWx1ZSAoc3BsaXQpCiAgICBpZiAoICRTZWxmLT57TGlua1RpY2tldElEfSApIHsKCiAgICAgICAgbXkgJFZhbHVlID0gJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QtPlZhbHVlR2V0KAogICAgICAgICAgICBEeW5hbWljRmllbGRDb25maWcgPT4gJER5bmFtaWNGaWVsZENvbmZpZywKICAgICAgICAgICAgT2JqZWN0SUQgICAgICAgICAgID0+ICRTZWxmLT57TGlua1RpY2tldElEfSwKICAgICAgICApOwoKICAgICAgICAkUGFyYW17R2V0UGFyYW19LT57ICdEeW5hbWljRmllbGRfJyAuICRQYXJhbXtGaWVsZE5hbWV9IH0gPSAkVmFsdWU7CiAgICB9CiAgICBteSAkRXJyb3JNZXNzYWdlID0gJyc7CiAgICBpZiAoIElzSGFzaFJlZldpdGhEYXRhKCAkUGFyYW17RXJyb3JNZXNzYWdlc30gKSApIHsKICAgICAgICBpZiAoCiAgICAgICAgICAgIGRlZmluZWQgJFBhcmFte0Vycm9yTWVzc2FnZXN9LT57ICRQYXJhbXtGaWVsZE5hbWV9IH0KICAgICAgICAgICAgJiYgJFBhcmFte0Vycm9yTWVzc2FnZXN9LT57ICRQYXJhbXtGaWVsZE5hbWV9IH0gbmUgJycKICAgICAgICAgICAgKQogICAgICAgIHsKICAgICAgICAgICAgJEVycm9yTWVzc2FnZSA9ICRQYXJhbXtFcnJvck1lc3NhZ2VzfS0+eyAkUGFyYW17RmllbGROYW1lfSB9OwogICAgICAgIH0KICAgIH0KCiAgICBteSAkRHluYW1pY0ZpZWxkSFRNTCA9ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0LT5FZGl0RmllbGRSZW5kZXIoCiAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnICAgPT4gJER5bmFtaWNGaWVsZENvbmZpZywKICAgICAgICBQb3NzaWJsZVZhbHVlc0ZpbHRlciA9PiAkUG9zc2libGVWYWx1ZXNGaWx0ZXIsCiAgICAgICAgVmFsdWUgICAgICAgICAgICAgICAgPT4gJFBhcmFte0dldFBhcmFtfXsgJ0R5bmFtaWNGaWVsZF8nIC4gJFBhcmFte0ZpZWxkTmFtZX0gfSwKICAgICAgICBMYXlvdXRPYmplY3QgICAgICAgICA9PiAkTGF5b3V0T2JqZWN0LAogICAgICAgIFBhcmFtT2JqZWN0ICAgICAgICAgID0+ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpXZWI6OlJlcXVlc3QnKSwKICAgICAgICBBSkFYVXBkYXRlICAgICAgICAgICA9PiAxLAogICAgICAgIE1hbmRhdG9yeSAgICAgICAgICAgID0+ICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0Rpc3BsYXl9ID09IDIsCiAgICAgICAgVXBkYXRhYmxlRmllbGRzICAgICAgPT4gJFBhcmFte0FKQVhVcGRhdGFibGVGaWVsZHN9LAogICAgICAgIFNlcnZlckVycm9yICAgICAgICAgID0+ICRTZXJ2ZXJFcnJvciwKICAgICAgICBFcnJvck1lc3NhZ2UgICAgICAgICA9PiAkRXJyb3JNZXNzYWdlLAogICAgKTsKCiAgICBteSAlRGF0YSA9ICgKICAgICAgICBOYW1lICAgID0+ICREeW5hbWljRmllbGRDb25maWctPntOYW1lfSwKICAgICAgICBMYWJlbCAgID0+ICREeW5hbWljRmllbGRIVE1MLT57TGFiZWx9LAogICAgICAgIENvbnRlbnQgPT4gJER5bmFtaWNGaWVsZEhUTUwtPntGaWVsZH0sCiAgICApOwoKICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgIE5hbWUgPT4gJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57TGF5b3V0QmxvY2t9IHx8ICdydzpEeW5hbWljRmllbGQnLAogICAgICAgIERhdGEgPT4gXCVEYXRhLAogICAgKTsKICAgIGlmICggJFBhcmFte0Rlc2NyaXB0aW9uU2hvcnR9ICkgewogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0xheW91dEJsb2NrfQogICAgICAgICAgICAgICAgfHwgJ3J3OkR5bmFtaWNGaWVsZDpEZXNjcmlwdGlvblNob3J0JywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBEZXNjcmlwdGlvblNob3J0ID0+ICRQYXJhbXtEZXNjcmlwdGlvblNob3J0fSwKICAgICAgICAgICAgfSwKICAgICAgICApOwogICAgfQoKICAgIGlmICggJFBhcmFte0Rlc2NyaXB0aW9uTG9uZ30gKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ3J3OkR5bmFtaWNGaWVsZDpEZXNjcmlwdGlvbkxvbmcnLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgIERlc2NyaXB0aW9uTG9uZyA9PiAkUGFyYW17RGVzY3JpcHRpb25Mb25nfSwKICAgICAgICAgICAgfSwKICAgICAgICApOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgU3VjY2VzcyA9PiAxLAogICAgICAgIEhUTUwgICAgPT4gJExheW91dE9iamVjdC0+T3V0cHV0KCBUZW1wbGF0ZUZpbGUgPT4gJ1Byb2Nlc3NNYW5hZ2VtZW50L0R5bmFtaWNGaWVsZCcgKSwKICAgIH07Cn0KCnN1YiBfUmVuZGVyVGl0bGUgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGdldCBsYXlvdXQgb2JqZWN0CiAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwoKICAgIGZvciBteSAkTmVlZGVkIChxdyhGb3JtSUQpKSB7CiAgICAgICAgaWYgKCAhJFBhcmFteyROZWVkZWR9ICkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgU3VjY2VzcyA9PiAwLAogICAgICAgICAgICAgICAgTWVzc2FnZSA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9CiAgICAgICAgICAgICAgICAgICAgLT5UcmFuc2xhdGUoICdQYXJhbWV0ZXIgJXMgaXMgbWlzc2luZyBpbiAlcy4nLCAkTmVlZGVkLCAnX1JlbmRlclRpdGxlJyApLAogICAgICAgICAgICB9OwogICAgICAgIH0KICAgIH0KICAgIGlmICggIUlzSGFzaFJlZldpdGhEYXRhKCAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0gKSApIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBTdWNjZXNzID0+IDAsCiAgICAgICAgICAgIE1lc3NhZ2UgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fQogICAgICAgICAgICAgICAgLT5UcmFuc2xhdGUoICdQYXJhbWV0ZXIgJXMgaXMgbWlzc2luZyBpbiAlcy4nLCAnQWN0aXZpdHlEaWFsb2dGaWVsZCcsICdfUmVuZGVyVGl0bGUnICksCiAgICAgICAgfTsKICAgIH0KCiAgICBteSAkVGl0bGUgPSAkUGFyYW17VGlja2V0fS0+e1RpdGxlfSAvLyAnJzsKCiAgICBpZiAoICEkVGl0bGUgJiYgJFNlbGYtPntMaW5rQXJ0aWNsZURhdGF9ICkgewogICAgICAgIG15ICVUaWNrZXQgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGlja2V0JyktPlRpY2tldEdldCgKICAgICAgICAgICAgVGlja2V0SUQgPT4gJFNlbGYtPntMaW5rQXJ0aWNsZURhdGF9LT57VGlja2V0SUR9LAogICAgICAgICAgICBVc2VySUQgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgKTsKICAgICAgICAkVGl0bGUgPSAkVGlja2V0e1RpdGxlfTsKICAgIH0KCiAgICAkUGFyYW17R2V0UGFyYW19LT57VGl0bGV9IC8vPSAkVGl0bGU7CgogICAgbXkgJURhdGEgPSAoCiAgICAgICAgTGFiZWwgICAgICAgICAgICA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoIlRpdGxlIiksCiAgICAgICAgRmllbGRJRCAgICAgICAgICA9PiAnVGl0bGUnLAogICAgICAgIEZvcm1JRCAgICAgICAgICAgPT4gJFBhcmFte0Zvcm1JRH0sCiAgICAgICAgVmFsdWUgICAgICAgICAgICA9PiAkUGFyYW17R2V0UGFyYW19LT57VGl0bGV9LAogICAgICAgIE5hbWUgICAgICAgICAgICAgPT4gJ1RpdGxlJywKICAgICAgICBNYW5kYXRvcnlDbGFzcyAgID0+ICcnLAogICAgICAgIFZhbGlkYXRlUmVxdWlyZWQgPT4gJycsCiAgICApOwoKICAgICMgSWYgZmllbGQgaXMgcmVxdWlyZWQgcHV0IGluIHRoZSBuZWNlc3NhcnkgdmFyaWFibGVzIGZvcgogICAgIyBWYWxpZGF0ZVJlcXVpcmVkIGNsYXNzIGlucHV0IGZpZWxkLCBNYW5kYXRvcnkgY2xhc3MgZm9yIHRoZSBsYWJlbAogICAgaWYgKCAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntEaXNwbGF5fSAmJiAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntEaXNwbGF5fSA9PSAyICkgewogICAgICAgICREYXRhe1ZhbGlkYXRlUmVxdWlyZWR9ID0gJ1ZhbGlkYXRlX1JlcXVpcmVkJzsKICAgICAgICAkRGF0YXtNYW5kYXRvcnlDbGFzc30gICA9ICdNYW5kYXRvcnknOwogICAgfQoKICAgICMgb3V0cHV0IHNlcnZlciBlcnJvcnMKICAgIGlmICggSXNIYXNoUmVmV2l0aERhdGEoICRQYXJhbXtFcnJvcn0gKSAmJiAkUGFyYW17RXJyb3J9LT57J1RpdGxlJ30gKSB7CiAgICAgICAgJERhdGF7U2VydmVyRXJyb3J9ID0gJ1NlcnZlckVycm9yJzsKICAgIH0KCiAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICBOYW1lID0+ICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0xheW91dEJsb2NrfSB8fCAncnc6VGl0bGUnLAogICAgICAgIERhdGEgPT4gXCVEYXRhLAogICAgKTsKCiAgICAjIHNldCBtYW5kYXRvcnkgbGFiZWwgbWFya2VyCiAgICBpZiAoICREYXRhe01hbmRhdG9yeUNsYXNzfSAmJiAkRGF0YXtNYW5kYXRvcnlDbGFzc30gbmUgJycgKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ0xhYmVsU3BhbicsCiAgICAgICAgICAgIERhdGEgPT4ge30sCiAgICAgICAgKTsKICAgIH0KCiAgICBpZiAoICRQYXJhbXtEZXNjcmlwdGlvblNob3J0fSApIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntMYXlvdXRCbG9ja30gfHwgJ3J3OlRpdGxlOkRlc2NyaXB0aW9uU2hvcnQnLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgIERlc2NyaXB0aW9uU2hvcnQgPT4gJFBhcmFte0Rlc2NyaXB0aW9uU2hvcnR9LAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICB9CgogICAgaWYgKCAkUGFyYW17RGVzY3JpcHRpb25Mb25nfSApIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntMYXlvdXRCbG9ja30gfHwgJ3J3OlRpdGxlOkRlc2NyaXB0aW9uTG9uZycsCiAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgRGVzY3JpcHRpb25Mb25nID0+ICRQYXJhbXtEZXNjcmlwdGlvbkxvbmd9LAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgICBTdWNjZXNzID0+IDEsCiAgICAgICAgSFRNTCAgICA9PiAkTGF5b3V0T2JqZWN0LT5PdXRwdXQoIFRlbXBsYXRlRmlsZSA9PiAnUHJvY2Vzc01hbmFnZW1lbnQvVGl0bGUnICksCiAgICB9OwoKfQoKc3ViIF9SZW5kZXJBcnRpY2xlIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKICAgIG15ICRDb25maWdPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpOwoKICAgIGZvciBteSAkTmVlZGVkIChxdyhGb3JtSUQgVGlja2V0KSkgewogICAgICAgIGlmICggISRQYXJhbXskTmVlZGVkfSApIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIFN1Y2Nlc3MgPT4gMCwKICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fQogICAgICAgICAgICAgICAgICAgIC0+VHJhbnNsYXRlKCAnUGFyYW1ldGVyICVzIGlzIG1pc3NpbmcgaW4gJXMuJywgJE5lZWRlZCwgJ19SZW5kZXJBcnRpY2xlJyApLAogICAgICAgICAgICB9OwogICAgICAgIH0KICAgIH0KICAgIGlmICggIUlzSGFzaFJlZldpdGhEYXRhKCAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0gKSApIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBTdWNjZXNzID0+IDAsCiAgICAgICAgICAgIE1lc3NhZ2UgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fQogICAgICAgICAgICAgICAgLT5UcmFuc2xhdGUoICdQYXJhbWV0ZXIgJXMgaXMgbWlzc2luZyBpbiAlcy4nLCAnQWN0aXZpdHlEaWFsb2dGaWVsZCcsICdfUmVuZGVyQXJ0aWNsZScgKSwKICAgICAgICB9OwogICAgfQoKICAgIGlmICggSXNIYXNoUmVmV2l0aERhdGEoICRTZWxmLT57TGlua0FydGljbGVEYXRhfSApICkgewogICAgICAgIG15ICRUaWNrZXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGlja2V0Jyk7CiAgICAgICAgbXkgJFRpY2tldE51bWJlciA9ICRUaWNrZXRPYmplY3QtPlRpY2tldE51bWJlckxvb2t1cCgKICAgICAgICAgICAgVGlja2V0SUQgPT4gJFNlbGYtPntMaW5rQXJ0aWNsZURhdGF9LT57VGlja2V0SUR9LAogICAgICAgICk7CgogICAgICAgICMgcHJlcGFyZSBzdWJqZWN0CiAgICAgICAgJFBhcmFte0dldFBhcmFtfS0+e1N1YmplY3R9ID0gJFRpY2tldE9iamVjdC0+VGlja2V0U3ViamVjdENsZWFuKAogICAgICAgICAgICBUaWNrZXROdW1iZXIgPT4gJFRpY2tldE51bWJlciwKICAgICAgICAgICAgU3ViamVjdCAgICAgID0+ICRTZWxmLT57TGlua0FydGljbGVEYXRhfS0+e1N1YmplY3R9IHx8ICcnLAogICAgICAgICk7CgogICAgICAgICMgYm9keSBwcmVwYXJhdGlvbiBmb3IgcGxhaW4gdGV4dCBwcm9jZXNzaW5nCiAgICAgICAgJFBhcmFte0dldFBhcmFtfS0+e0JvZHl9ID0gJExheW91dE9iamVjdC0+QXJ0aWNsZVF1b3RlKAogICAgICAgICAgICBUaWNrZXRJRCAgICAgICAgICAgPT4gJFNlbGYtPntMaW5rQXJ0aWNsZURhdGF9LT57VGlja2V0SUR9LAogICAgICAgICAgICBBcnRpY2xlSUQgICAgICAgICAgPT4gJFNlbGYtPntMaW5rQXJ0aWNsZURhdGF9LT57QXJ0aWNsZUlEfSwKICAgICAgICAgICAgRm9ybUlEICAgICAgICAgICAgID0+ICRTZWxmLT57Rm9ybUlEfSwKICAgICAgICAgICAgVXBsb2FkQ2FjaGVPYmplY3QgID0+ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpXZWI6OlVwbG9hZENhY2hlJyksCiAgICAgICAgICAgIEF0dGFjaG1lbnRzSW5jbHVkZSA9PiAxLAogICAgICAgICk7CgogICAgICAgIG15ICVTYWZldHlDaGVja1Jlc3VsdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpIVE1MVXRpbHMnKS0+U2FmZXR5KAogICAgICAgICAgICBTdHJpbmcgPT4gJFBhcmFte0dldFBhcmFtfS0+e0JvZHl9LAoKICAgICAgICAgICAgIyBTdHJpcCBvdXQgZXh0ZXJuYWwgY29udGVudCBpZiBCbG9ja0xvYWRpbmdSZW1vdGVDb250ZW50IGlzIGVuYWJsZWQuCiAgICAgICAgICAgIE5vRXh0U3JjTG9hZCA9PiAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6OkJsb2NrTG9hZGluZ1JlbW90ZUNvbnRlbnQnKSwKCiAgICAgICAgICAgICMgRGlzYWxsb3cgcG90ZW50aWFsbHkgdW5zYWZlIGNvbnRlbnQuCiAgICAgICAgICAgIE5vQXBwbGV0ICAgICA9PiAxLAogICAgICAgICAgICBOb09iamVjdCAgICAgPT4gMSwKICAgICAgICAgICAgTm9FbWJlZCAgICAgID0+IDEsCiAgICAgICAgICAgIE5vU1ZHICAgICAgICA9PiAxLAogICAgICAgICAgICBOb0phdmFTY3JpcHQgPT4gMSwKICAgICAgICApOwogICAgICAgICRQYXJhbXtHZXRQYXJhbX0tPntCb2R5fSA9ICRTYWZldHlDaGVja1Jlc3VsdHtTdHJpbmd9OwogICAgfQoKICAgICMgZ2V0IGFsbCBhdHRhY2htZW50cyBtZXRhIGRhdGEKICAgIG15IEBBdHRhY2htZW50cyA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpXZWI6OlVwbG9hZENhY2hlJyktPkZvcm1JREdldEFsbEZpbGVzTWV0YSgKICAgICAgICBGb3JtSUQgPT4gJFNlbGYtPntGb3JtSUR9LAogICAgKTsKCiAgICAjIHNob3cgYXR0YWNobWVudHMKICAgIEFUVEFDSE1FTlQ6CiAgICBmb3IgbXkgJEF0dGFjaG1lbnQgKEBBdHRhY2htZW50cykgewogICAgICAgIGlmICgKICAgICAgICAgICAgJEF0dGFjaG1lbnQtPntDb250ZW50SUR9CiAgICAgICAgICAgICYmICRMYXlvdXRPYmplY3QtPntCcm93c2VyUmljaFRleHR9CiAgICAgICAgICAgICYmICggJEF0dGFjaG1lbnQtPntDb250ZW50VHlwZX0gPX4gL2ltYWdlL2kgKQogICAgICAgICAgICAmJiAoICRBdHRhY2htZW50LT57RGlzcG9zaXRpb259IGVxICdpbmxpbmUnICkKICAgICAgICAgICAgKQogICAgICAgIHsKICAgICAgICAgICAgbmV4dCBBVFRBQ0hNRU5UOwogICAgICAgIH0KCiAgICAgICAgcHVzaCBAeyAkUGFyYW17QXR0YWNobWVudExpc3R9IH0sICRBdHRhY2htZW50OwogICAgfQoKICAgIG15ICVEYXRhID0gKAogICAgICAgIE5hbWUgICAgICAgICAgICAgPT4gJ0FydGljbGUnLAogICAgICAgIE1hbmRhdG9yeUNsYXNzICAgPT4gJycsCiAgICAgICAgVmFsaWRhdGVSZXF1aXJlZCA9PiAnJywKICAgICAgICBTdWJqZWN0ICAgICAgICAgID0+ICRQYXJhbXtHZXRQYXJhbX0tPntTdWJqZWN0fSwKICAgICAgICBCb2R5ICAgICAgICAgICAgID0+ICRQYXJhbXtHZXRQYXJhbX0tPntCb2R5fSwKICAgICAgICBMYWJlbFN1YmplY3QgICAgID0+ICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0NvbmZpZ30tPntMYWJlbFN1YmplY3R9CiAgICAgICAgICAgIHx8ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgiU3ViamVjdCIpLAogICAgICAgIExhYmVsQm9keSA9PiAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntDb25maWd9LT57TGFiZWxCb2R5fQogICAgICAgICAgICB8fCAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoIlRleHQiKSwKICAgICAgICBBdHRhY2htZW50TGlzdCA9PiAkUGFyYW17QXR0YWNobWVudExpc3R9LAogICAgKTsKCiAgICAjIElmIGZpZWxkIGlzIHJlcXVpcmVkIHB1dCBpbiB0aGUgbmVjZXNzYXJ5IHZhcmlhYmxlcyBmb3IKICAgICMgVmFsaWRhdGVSZXF1aXJlZCBjbGFzcyBpbnB1dCBmaWVsZCwgTWFuZGF0b3J5IGNsYXNzIGZvciB0aGUgbGFiZWwKICAgIGlmICggJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57RGlzcGxheX0gJiYgJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57RGlzcGxheX0gPT0gMiApIHsKICAgICAgICAkRGF0YXtWYWxpZGF0ZVJlcXVpcmVkfSA9ICdWYWxpZGF0ZV9SZXF1aXJlZCc7CiAgICAgICAgJERhdGF7TWFuZGF0b3J5Q2xhc3N9ICAgPSAnTWFuZGF0b3J5JzsKICAgIH0KCiAgICAjIG91dHB1dCBzZXJ2ZXIgZXJyb3JzCiAgICBpZiAoIElzSGFzaFJlZldpdGhEYXRhKCAkUGFyYW17RXJyb3J9ICkgJiYgJFBhcmFte0Vycm9yfS0+eydBcnRpY2xlU3ViamVjdCd9ICkgewogICAgICAgICREYXRhe1N1YmplY3RTZXJ2ZXJFcnJvcn0gPSAnU2VydmVyRXJyb3InOwogICAgfQogICAgaWYgKCBJc0hhc2hSZWZXaXRoRGF0YSggJFBhcmFte0Vycm9yfSApICYmICRQYXJhbXtFcnJvcn0tPnsnQXJ0aWNsZUJvZHknfSApIHsKICAgICAgICAkRGF0YXtCb2R5U2VydmVyRXJyb3J9ID0gJ1NlcnZlckVycm9yJzsKICAgIH0KCiAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICBOYW1lID0+ICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0xheW91dEJsb2NrfSB8fCAncnc6QXJ0aWNsZScsCiAgICAgICAgRGF0YSA9PiBcJURhdGEsCiAgICApOwoKICAgICMgc2V0IG1hbmRhdG9yeSBsYWJlbCBtYXJrZXIKICAgIGlmICggJERhdGF7TWFuZGF0b3J5Q2xhc3N9ICYmICREYXRhe01hbmRhdG9yeUNsYXNzfSBuZSAnJyApIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnTGFiZWxTcGFuU3ViamVjdCcsCiAgICAgICAgICAgIERhdGEgPT4ge30sCiAgICAgICAgKTsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnTGFiZWxTcGFuQm9keScsCiAgICAgICAgICAgIERhdGEgPT4ge30sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGFkZCByaWNoIHRleHQgZWRpdG9yCiAgICBpZiAoICRMYXlvdXRPYmplY3QtPntCcm93c2VyUmljaFRleHR9ICkgewoKICAgICAgICAjIHVzZSBoZWlnaHQvd2lkdGggZGVmaW5lZCBmb3IgdGhpcyBzY3JlZW4KICAgICAgICAkUGFyYW17UmljaFRleHRIZWlnaHR9ID0gJFNlbGYtPntDb25maWd9LT57UmljaFRleHRIZWlnaHR9IHx8IDA7CiAgICAgICAgJFBhcmFte1JpY2hUZXh0V2lkdGh9ICA9ICRTZWxmLT57Q29uZmlnfS0+e1JpY2hUZXh0V2lkdGh9ICB8fCAwOwoKICAgICAgICAjIHNldCB1cCByaWNoIHRleHQgZWRpdG9yCiAgICAgICAgJExheW91dE9iamVjdC0+U2V0UmljaFRleHRQYXJhbWV0ZXJzKAogICAgICAgICAgICBEYXRhID0+IFwlUGFyYW0sCiAgICAgICAgKTsKICAgIH0KCiAgICBpZiAoICRQYXJhbXtEZXNjcmlwdGlvblNob3J0fSApIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAncnc6QXJ0aWNsZTpEZXNjcmlwdGlvblNob3J0JywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBEZXNjcmlwdGlvblNob3J0ID0+ICRQYXJhbXtEZXNjcmlwdGlvblNob3J0fSwKICAgICAgICAgICAgfSwKICAgICAgICApOwogICAgfQoKICAgIGlmICggJFBhcmFte0Rlc2NyaXB0aW9uTG9uZ30gKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ3J3OkFydGljbGU6RGVzY3JpcHRpb25Mb25nJywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBEZXNjcmlwdGlvbkxvbmcgPT4gJFBhcmFte0Rlc2NyaXB0aW9uTG9uZ30sCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKICAgIH0KCiAgICBpZiAoICRQYXJhbXtJbmZvcm1BZ2VudHN9ICkgewoKICAgICAgICBteSAlU2hvd25Vc2VyczsKICAgICAgICBteSAlQWxsR3JvdXBzTWVtYmVycyA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpVc2VyJyktPlVzZXJMaXN0KAogICAgICAgICAgICBUeXBlICA9PiAnTG9uZycsCiAgICAgICAgICAgIFZhbGlkID0+IDEsCiAgICAgICAgKTsKICAgICAgICBteSAkR0lEID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlF1ZXVlJyktPkdldFF1ZXVlR3JvdXBJRCggUXVldWVJRCA9PiAkUGFyYW17VGlja2V0fS0+e1F1ZXVlSUR9ICk7CiAgICAgICAgbXkgJU1lbWJlckxpc3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6R3JvdXAnKS0+UGVybWlzc2lvbkdyb3VwR2V0KAogICAgICAgICAgICBHcm91cElEID0+ICRHSUQsCiAgICAgICAgICAgIFR5cGUgICAgPT4gJ3JvJywKICAgICAgICApOwogICAgICAgIGZvciBteSAkVXNlcklEICggc29ydCBrZXlzICVNZW1iZXJMaXN0ICkgewogICAgICAgICAgICAkU2hvd25Vc2Vyc3skVXNlcklEfSA9ICRBbGxHcm91cHNNZW1iZXJzeyRVc2VySUR9OwogICAgICAgIH0KICAgICAgICAkUGFyYW17T3B0aW9uU3RyZ30gPSAkTGF5b3V0T2JqZWN0LT5CdWlsZFNlbGVjdGlvbigKICAgICAgICAgICAgRGF0YSAgICAgICA9PiBcJVNob3duVXNlcnMsCiAgICAgICAgICAgIFNlbGVjdGVkSUQgPT4gJycsCiAgICAgICAgICAgIE5hbWUgICAgICAgPT4gJ0luZm9ybVVzZXJJRCcsCiAgICAgICAgICAgIE11bHRpcGxlICAgPT4gMSwKICAgICAgICAgICAgU2l6ZSAgICAgICA9PiAzLAogICAgICAgICAgICBDbGFzcyAgICAgID0+ICdNb2Rlcm5pemUnLAogICAgICAgICk7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ3J3OkFydGljbGU6SW5mb3JtQWdlbnQnLAogICAgICAgICAgICBEYXRhID0+IFwlUGFyYW0sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIG91dHB1dCBzZXJ2ZXIgZXJyb3JzCiAgICBpZiAoIElzSGFzaFJlZldpdGhEYXRhKCAkUGFyYW17RXJyb3J9ICkgJiYgJFBhcmFte0Vycm9yfS0+eydUaW1lVW5pdHMnfSApIHsKICAgICAgICAkUGFyYW17VGltZVVuaXRzSW52YWxpZH0gPSAnU2VydmVyRXJyb3InOwogICAgfQoKICAgICMgc2hvdyB0aW1lIHVuaXRzCiAgICBpZiAoCiAgICAgICAgJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpBY2NvdW50VGltZScpCiAgICAgICAgJiYgJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57Q29uZmlnfS0+e1RpbWVVbml0c30KICAgICAgICApCiAgICB7CgogICAgICAgICRQYXJhbXtUaW1lVW5pdHNSZXF1aXJlZH0gPSAxOwogICAgICAgIGlmICggJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57Q29uZmlnfS0+e1RpbWVVbml0c30gPT0gMiApIHsKICAgICAgICAgICAgJFBhcmFte1RpbWVVbml0c1JlcXVpcmVkfSA9IDE7CiAgICAgICAgfQogICAgICAgIGVsc2lmICggJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57Q29uZmlnfS0+e1RpbWVVbml0c30gPT0gMSApIHsKICAgICAgICAgICAgJFBhcmFte1RpbWVVbml0c1JlcXVpcmVkfSA9IDA7CiAgICAgICAgfQoKICAgICAgICAjIEdldCBUaW1lVW5pdHMgdmFsdWUuCiAgICAgICAgJFBhcmFte1RpbWVVbml0c30gPSAkUGFyYW17R2V0UGFyYW19LT57VGltZVVuaXRzfTsKCiAgICAgICAgaWYgKCAhZGVmaW5lZCAkUGFyYW17VGltZVVuaXRzfSAmJiAkU2VsZi0+e0FydGljbGVJRH0gKSB7CiAgICAgICAgICAgICRQYXJhbXtUaW1lVW5pdHN9ID0gJFNlbGYtPl9HZXRUaW1lVW5pdHMoCiAgICAgICAgICAgICAgICBBcnRpY2xlSUQgPT4gJFNlbGYtPntBcnRpY2xlSUR9LAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgJFBhcmFte1RpbWVVbml0c0Jsb2NrfSA9ICRMYXlvdXRPYmplY3QtPlRpbWVVbml0cygKICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICk7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ1RpbWVVbml0cycsCiAgICAgICAgICAgIERhdGEgPT4gXCVQYXJhbSwKICAgICAgICApOwogICAgfQoKICAgICMgc2hvdyBTdGFuZGFyZFRlbXBsYXRlcwogICAgaWYgKCBJc0FycmF5UmVmV2l0aERhdGEoICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0NvbmZpZ30tPntTdGFuZGFyZFRlbXBsYXRlSUR9ICkgKSB7CiAgICAgICAgbXkgJFN0YW5kYXJkVGVtcGxhdGVPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6U3RhbmRhcmRUZW1wbGF0ZScpOwoKICAgICAgICBteSAlU3RhbmRhcmRUZW1wbGF0ZXMgPSAkU3RhbmRhcmRUZW1wbGF0ZU9iamVjdC0+U3RhbmRhcmRUZW1wbGF0ZUxpc3QoCiAgICAgICAgICAgIFZhbGlkID0+IDEsCiAgICAgICAgICAgIFR5cGUgID0+ICdQcm9jZXNzTWFuYWdlbWVudCcsCiAgICAgICAgKTsKCiAgICAgICAgU1RBTkRBUkRURU1QTEFURUlEOgogICAgICAgIGZvciBteSAkU3RhbmRhcmRUZW1wbGF0ZUlEICggc29ydCBrZXlzICVTdGFuZGFyZFRlbXBsYXRlcyApIHsKICAgICAgICAgICAgbXkgJEV4aXN0cwogICAgICAgICAgICAgICAgPSBncmVwIHsgJFN0YW5kYXJkVGVtcGxhdGVJRCBlcSAkXyB9IEB7ICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0NvbmZpZ30tPntTdGFuZGFyZFRlbXBsYXRlSUR9IH07CiAgICAgICAgICAgIG5leHQgU1RBTkRBUkRURU1QTEFURUlEIGlmICRFeGlzdHM7CgogICAgICAgICAgICBkZWxldGUgJFN0YW5kYXJkVGVtcGxhdGVzeyRTdGFuZGFyZFRlbXBsYXRlSUR9OwogICAgICAgIH0KCiAgICAgICAgaWYgKCVTdGFuZGFyZFRlbXBsYXRlcykgewogICAgICAgICAgICAkUGFyYW17U3RhbmRhcmRUZW1wbGF0ZVN0cmd9ID0gJExheW91dE9iamVjdC0+QnVpbGRTZWxlY3Rpb24oCiAgICAgICAgICAgICAgICBEYXRhICAgICAgICAgPT4gXCVTdGFuZGFyZFRlbXBsYXRlcywKICAgICAgICAgICAgICAgIE5hbWUgICAgICAgICA9PiAnU3RhbmRhcmRUZW1wbGF0ZUlEJywKICAgICAgICAgICAgICAgIFNlbGVjdGVkSUQgICA9PiAkUGFyYW17R2V0UGFyYW19LT57U3RhbmRhcmRUZW1wbGF0ZUlEfSB8fCAnJywKICAgICAgICAgICAgICAgIENsYXNzICAgICAgICA9PiAnTW9kZXJuaXplJywKICAgICAgICAgICAgICAgIFBvc3NpYmxlTm9uZSA9PiAxLAogICAgICAgICAgICAgICAgU29ydCAgICAgICAgID0+ICdBbHBoYW51bWVyaWNWYWx1ZScsCiAgICAgICAgICAgICAgICBUcmFuc2xhdGlvbiAgPT4gMSwKICAgICAgICAgICAgICAgIE1heCAgICAgICAgICA9PiAyMDAsCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5BZGRKU0RhdGEoCiAgICAgICAgICAgICAgICBLZXkgICA9PiAnU3RhbmRhcmRUZW1wbGF0ZUF1dG9GaWxsJywKICAgICAgICAgICAgICAgIFZhbHVlID0+ICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0NvbmZpZ30tPntTdGFuZGFyZFRlbXBsYXRlQXV0b0ZpbGx9IHx8IDAsCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ1N0YW5kYXJkVGVtcGxhdGUnLAogICAgICAgICAgICAgICAgRGF0YSA9PiBcJVBhcmFtLAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIFN1Y2Nlc3MgPT4gMSwKICAgICAgICBIVE1MICAgID0+ICRMYXlvdXRPYmplY3QtPk91dHB1dCggVGVtcGxhdGVGaWxlID0+ICdQcm9jZXNzTWFuYWdlbWVudC9BcnRpY2xlJyApLAogICAgfTsKfQoKc3ViIF9HZXRUaW1lVW5pdHMgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkQWNjb3VudGVkVGltZSA9ICcnOwoKICAgICMgR2V0IGFjY291bnRlZCB0aW1lIGlmIEFjY291bnRUaW1lIGNvbmZpZyBpdGVtIGlzIGVuYWJsZWQuCiAgICBpZiAoICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnVGlja2V0OjpGcm9udGVuZDo6QWNjb3VudFRpbWUnKSAmJiBkZWZpbmVkICRQYXJhbXtBcnRpY2xlSUR9ICkgewogICAgICAgICRBY2NvdW50ZWRUaW1lID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpY2tldDo6QXJ0aWNsZScpLT5BcnRpY2xlQWNjb3VudGVkVGltZUdldCgKICAgICAgICAgICAgQXJ0aWNsZUlEID0+ICRQYXJhbXtBcnRpY2xlSUR9LAogICAgICAgICk7CiAgICB9CgogICAgcmV0dXJuICRBY2NvdW50ZWRUaW1lID8gJEFjY291bnRlZFRpbWUgOiAnJzsKfQoKc3ViIF9SZW5kZXJDdXN0b21lciB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgZ2V0IGxheW91dCBvYmplY3QKICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgZm9yIG15ICROZWVkZWQgKHF3KEZvcm1JRCkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBTdWNjZXNzID0+IDAsCiAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0KICAgICAgICAgICAgICAgICAgICAtPlRyYW5zbGF0ZSggJ1BhcmFtZXRlciAlcyBpcyBtaXNzaW5nIGluICVzLicsICROZWVkZWQsICdfUmVuZGVyQ3VzdG9tZXInICksCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgfQogICAgaWYgKCAhSXNIYXNoUmVmV2l0aERhdGEoICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfSApICkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIFN1Y2Nlc3MgPT4gMCwKICAgICAgICAgICAgTWVzc2FnZSA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9CiAgICAgICAgICAgICAgICAtPlRyYW5zbGF0ZSggJ1BhcmFtZXRlciAlcyBpcyBtaXNzaW5nIGluICVzLicsICdBY3Rpdml0eURpYWxvZ0ZpZWxkJywgJ19SZW5kZXJDdXN0b21lcicgKSwKICAgICAgICB9OwogICAgfQoKICAgIG15ICVDdXN0b21lclVzZXJEYXRhID0gKCk7CgogICAgbXkgJFN1Ym1pdHRlZEN1c3RvbWVyVXNlcklEID0gJFBhcmFte0dldFBhcmFtfXtDdXN0b21lclVzZXJJRH07CgogICAgbXkgJURhdGEgPSAoCiAgICAgICAgTGFiZWxDdXN0b21lclVzZXIgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCJDdXN0b21lciB1c2VyIiksCiAgICAgICAgTGFiZWxDdXN0b21lcklEICAgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCJDdXN0b21lcklEIiksCiAgICAgICAgRm9ybUlEICAgICAgICAgICAgPT4gJFBhcmFte0Zvcm1JRH0sCiAgICAgICAgTWFuZGF0b3J5Q2xhc3MgICAgPT4gJycsCiAgICAgICAgVmFsaWRhdGVSZXF1aXJlZCAgPT4gJycsCiAgICApOwoKICAgICMgSWYgZmllbGQgaXMgcmVxdWlyZWQgcHV0IGluIHRoZSBuZWNlc3NhcnkgdmFyaWFibGVzIGZvcgogICAgIyBWYWxpZGF0ZVJlcXVpcmVkIGNsYXNzIGlucHV0IGZpZWxkLCBNYW5kYXRvcnkgY2xhc3MgZm9yIHRoZSBsYWJlbAogICAgaWYgKCAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntEaXNwbGF5fSAmJiAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntEaXNwbGF5fSA9PSAyICkgewogICAgICAgICREYXRhe1ZhbGlkYXRlUmVxdWlyZWR9ID0gJ1ZhbGlkYXRlX1JlcXVpcmVkJzsKICAgICAgICAkRGF0YXtNYW5kYXRvcnlDbGFzc30gICA9ICdNYW5kYXRvcnknOwogICAgfQoKICAgICMgb3V0cHV0IHNlcnZlciBlcnJvcnMKICAgIGlmICggSXNIYXNoUmVmV2l0aERhdGEoICRQYXJhbXtFcnJvcn0gKSAmJiAkUGFyYW17RXJyb3J9LT57Q3VzdG9tZXJVc2VySUR9ICkgewogICAgICAgICREYXRhe0N1c3RvbWVyVXNlcklEU2VydmVyRXJyb3J9ID0gJ1NlcnZlckVycm9yJzsKICAgIH0KICAgIGlmICggSXNIYXNoUmVmV2l0aERhdGEoICRQYXJhbXtFcnJvcn0gKSAmJiAkUGFyYW17RXJyb3J9LT57Q3VzdG9tZXJJRH0gKSB7CiAgICAgICAgJERhdGF7Q3VzdG9tZXJJRFNlcnZlckVycm9yfSA9ICdTZXJ2ZXJFcnJvcic7CiAgICB9CgogICAgaWYgKCAkU2VsZi0+e0xpbmtUaWNrZXREYXRhfSApIHsKICAgICAgICAlQ3VzdG9tZXJVc2VyRGF0YSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDdXN0b21lclVzZXInKS0+Q3VzdG9tZXJVc2VyRGF0YUdldCgKICAgICAgICAgICAgVXNlciA9PiAkU2VsZi0+e0xpbmtUaWNrZXREYXRhfS0+e0N1c3RvbWVyVXNlcklEfSwKICAgICAgICApOwogICAgfQoKICAgIGlmICgKICAgICAgICAoIElzSGFzaFJlZldpdGhEYXRhKCAkUGFyYW17VGlja2V0fSApICYmICRQYXJhbXtUaWNrZXR9LT57Q3VzdG9tZXJVc2VySUR9ICkKICAgICAgICB8fCAkU3VibWl0dGVkQ3VzdG9tZXJVc2VySUQKICAgICAgICApCiAgICB7CiAgICAgICAgJUN1c3RvbWVyVXNlckRhdGEgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q3VzdG9tZXJVc2VyJyktPkN1c3RvbWVyVXNlckRhdGFHZXQoCiAgICAgICAgICAgIFVzZXIgPT4gJFN1Ym1pdHRlZEN1c3RvbWVyVXNlcklECiAgICAgICAgICAgICAgICB8fCAkUGFyYW17VGlja2V0fXtDdXN0b21lclVzZXJJRH0sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIEN1c3RvbWVyIHVzZXIgZnJvbSBhcnRpY2xlIGlzIHByZXNlbGVjdGVkIGZvciBuZXcgc3BsaXQgdGlja2V0LiBTZWUgYnVnIzEyOTU2LgogICAgaWYgKAogICAgICAgIElzSGFzaFJlZldpdGhEYXRhKCAkU2VsZi0+e0xpbmtBcnRpY2xlRGF0YX0gKQogICAgICAgICYmICRTZWxmLT57TGlua0FydGljbGVEYXRhfS0+e0Zyb219CiAgICAgICAgJiYgJFNlbGYtPntMaW5rQXJ0aWNsZURhdGF9LT57U2VuZGVyVHlwZX0gZXEgJ2N1c3RvbWVyJwogICAgICAgICkKICAgIHsKCiAgICAgICAgbXkgQEFydGljbGVGcm9tQWRkcmVzcyA9IE1haWw6OkFkZHJlc3MtPnBhcnNlKCAkU2VsZi0+e0xpbmtBcnRpY2xlRGF0YX0tPntGcm9tfSApOwoKICAgICAgICBteSAkQ3VzdG9tZXJVc2VyT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyVXNlcicpOwogICAgICAgIG15ICVMaXN0ICAgICAgICAgICAgICAgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclNlYXJjaCgKICAgICAgICAgICAgUG9zdE1hc3RlclNlYXJjaCA9PiAkQXJ0aWNsZUZyb21BZGRyZXNzWzBdLT5hZGRyZXNzKCksCiAgICAgICAgICAgIFVzZXJJRCA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgIFZhbGlkICAgICAgICAgICAgPT4gMSwKICAgICAgICApOwoKICAgICAgICBteSBAQ3VzdG9tZXJVc2VyID0gc29ydCBrZXlzICVMaXN0OwogICAgICAgICVDdXN0b21lclVzZXJEYXRhID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJVc2VyRGF0YUdldCgKICAgICAgICAgICAgVXNlciA9PiAkQ3VzdG9tZXJVc2VyWzBdLAogICAgICAgICk7CiAgICB9CgogICAgIyBzaG93IGN1c3RvbWVyIGZpZWxkIGFzICJGaXJzdE5hbWUgTGFzdG5hbWUiIDxNYWlsQWRkcmVzcz4KICAgIGlmICggSXNIYXNoUmVmV2l0aERhdGEoIFwlQ3VzdG9tZXJVc2VyRGF0YSApICkgewogICAgICAgICREYXRhe0N1c3RvbWVyVXNlcklEfSAgICAgICA9ICJcIiRDdXN0b21lclVzZXJEYXRhe1VzZXJGdWxsbmFtZX0iIC4gIlwiIDwkQ3VzdG9tZXJVc2VyRGF0YXtVc2VyRW1haWx9PiI7CiAgICAgICAgJERhdGF7Q3VzdG9tZXJJRH0gICAgICAgICAgID0gJEN1c3RvbWVyVXNlckRhdGF7VXNlckN1c3RvbWVySUR9IHx8ICcnOwogICAgICAgICREYXRhe1NlbGVjdGVkQ3VzdG9tZXJVc2VyfSA9ICRDdXN0b21lclVzZXJEYXRhe1VzZXJJRH0gfHwgJyc7CiAgICB9CgogICAgIyBXaGVuIHRoZXJlIGlzIG5vIEN1c3RvbWVyIGluIHRoZSBEQiwgaXQgY291bGQgYmUgdW5rbm93biBDdXN0b21lciwgc2V0IGl0IGZyb20gdGhlIHRpY2tldC4KICAgICMgU2VlIGJ1ZyMxMjc5NyAoIGh0dHBzOi8vYnVncy5vdHJzLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MTI3OTcgKS4KICAgIGVsc2UgewogICAgICAgICREYXRhe0N1c3RvbWVyVXNlcklEfSA9ICRQYXJhbXtUaWNrZXR9e0N1c3RvbWVyVXNlcklEfSB8fCAnJzsKICAgICAgICAkRGF0YXtDdXN0b21lcklEfSAgICAgPSAkUGFyYW17VGlja2V0fXtDdXN0b21lcklEfSAgICAgfHwgJyc7CiAgICB9CgogICAgIyBzZW5kIGRhdGEgdG8gSlMKICAgICRMYXlvdXRPYmplY3QtPkFkZEpTRGF0YSgKICAgICAgICBLZXkgICA9PiAnQ3VzdG9tZXJGaWVsZHNUb1VwZGF0ZScsCiAgICAgICAgVmFsdWUgPT4gJFBhcmFte0FKQVhVcGRhdGFibGVGaWVsZHN9LAogICAgKTsKCiAgICBpZiAoICRQYXJhbXtEZXNjcmlwdGlvblNob3J0fSApIHsKICAgICAgICAkRGF0YXtEZXNjcmlwdGlvblNob3J0fSA9ICRQYXJhbXtEZXNjcmlwdGlvblNob3J0fTsKICAgIH0KCiAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICBOYW1lID0+ICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0xheW91dEJsb2NrfSB8fCAncnc6Q3VzdG9tZXInLAogICAgICAgIERhdGEgPT4gXCVEYXRhLAogICAgKTsKCiAgICAjIHNldCBtYW5kYXRvcnkgbGFiZWwgbWFya2VyCiAgICBpZiAoICREYXRhe01hbmRhdG9yeUNsYXNzfSAmJiAkRGF0YXtNYW5kYXRvcnlDbGFzc30gbmUgJycgKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ0xhYmVsU3BhbkN1c3RvbWVyVXNlcicsCiAgICAgICAgICAgIERhdGEgPT4ge30sCiAgICAgICAgKTsKICAgIH0KCiAgICBpZiAoICRQYXJhbXtEZXNjcmlwdGlvbkxvbmd9ICkgewogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdydzpDdXN0b21lcjpEZXNjcmlwdGlvbkxvbmcnLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgIERlc2NyaXB0aW9uTG9uZyA9PiAkUGFyYW17RGVzY3JpcHRpb25Mb25nfSwKICAgICAgICAgICAgfSwKICAgICAgICApOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgU3VjY2VzcyA9PiAxLAogICAgICAgIEhUTUwgICAgPT4gJExheW91dE9iamVjdC0+T3V0cHV0KCBUZW1wbGF0ZUZpbGUgPT4gJ1Byb2Nlc3NNYW5hZ2VtZW50L0N1c3RvbWVyJyApLAogICAgfTsKfQoKc3ViIF9SZW5kZXJSZXNwb25zaWJsZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgZ2V0IGxheW91dCBvYmplY3QKICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgZm9yIG15ICROZWVkZWQgKHF3KEZvcm1JRCkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBTdWNjZXNzID0+IDAsCiAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0KICAgICAgICAgICAgICAgICAgICAtPlRyYW5zbGF0ZSggJ1BhcmFtZXRlciAlcyBpcyBtaXNzaW5nIGluICVzLicsICROZWVkZWQsICdfUmVuZGVyUmVzcG9uc2libGUnICksCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgfQogICAgaWYgKCAhSXNIYXNoUmVmV2l0aERhdGEoICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfSApICkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIFN1Y2Nlc3MgPT4gMCwKICAgICAgICAgICAgTWVzc2FnZSA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9CiAgICAgICAgICAgICAgICAtPlRyYW5zbGF0ZSggJ1BhcmFtZXRlciAlcyBpcyBtaXNzaW5nIGluICVzLicsICdBY3Rpdml0eURpYWxvZ0ZpZWxkJywgJ19SZW5kZXJSZXNwb25zaWJsZScgKSwKICAgICAgICB9OwogICAgfQoKICAgIGlmICggJFNlbGYtPntMaW5rVGlja2V0RGF0YX0gKSB7CiAgICAgICAgJFBhcmFte0dldFBhcmFtfS0+e1Jlc3BvbnNpYmxlQWxsfSA9IDE7CiAgICB9CgogICAgbXkgJFJlc3BvbnNpYmxlcyA9ICRTZWxmLT5fR2V0UmVzcG9uc2libGVzKCAleyAkUGFyYW17R2V0UGFyYW19IH0gKTsKCiAgICBteSAlRGF0YSA9ICgKICAgICAgICBMYWJlbCAgICAgICAgICAgID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgiUmVzcG9uc2libGUiKSwKICAgICAgICBGaWVsZElEICAgICAgICAgID0+ICdSZXNwb25zaWJsZUlEJywKICAgICAgICBGb3JtSUQgICAgICAgICAgID0+ICRQYXJhbXtGb3JtSUR9LAogICAgICAgIFJlc3BvbnNpYmxlQWxsICAgPT4gJFBhcmFte0dldFBhcmFtfXtSZXNwb25zaWJsZUFsbH0sCiAgICAgICAgTWFuZGF0b3J5Q2xhc3MgICA9PiAnJywKICAgICAgICBWYWxpZGF0ZVJlcXVpcmVkID0+ICcnLAogICAgKTsKCiAgICAjIGlmIGZpZWxkIGlzIHJlcXVpcmVkIHB1dCBpbiB0aGUgbmVjZXNzYXJ5IHZhcmlhYmxlcyBmb3IKICAgICMgICAgVmFsaWRhdGVSZXF1aXJlZCBjbGFzcyBpbnB1dCBmaWVsZCwgTWFuZGF0b3J5IGNsYXNzIGZvciB0aGUgbGFiZWwKICAgIGlmICggJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57RGlzcGxheX0gJiYgJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57RGlzcGxheX0gPT0gMiApIHsKICAgICAgICAkRGF0YXtWYWxpZGF0ZVJlcXVpcmVkfSA9ICdWYWxpZGF0ZV9SZXF1aXJlZCc7CiAgICAgICAgJERhdGF7TWFuZGF0b3J5Q2xhc3N9ICAgPSAnTWFuZGF0b3J5JzsKICAgIH0KCiAgICBteSAkU2VsZWN0ZWRWYWx1ZTsKCiAgICAjIGdldCB1c2VyIG9iamVjdAogICAgbXkgJFVzZXJPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VXNlcicpOwoKICAgIGlmICggJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57RGVmYXVsdFZhbHVlfSApIHsKCiAgICAgICAgaWYgKCAkUGFyYW17RmllbGROYW1lfSBlcSAnUmVzcG9uc2libGUnICkgewoKICAgICAgICAgICAgIyBGZXRjaCBEZWZhdWx0VmFsdWUgZnJvbSBDb25maWcKICAgICAgICAgICAgaWYgKCAhJFNlbGVjdGVkVmFsdWUgKSB7CiAgICAgICAgICAgICAgICAkU2VsZWN0ZWRWYWx1ZSA9ICRVc2VyT2JqZWN0LT5Vc2VyTG9va3VwKAogICAgICAgICAgICAgICAgICAgIFVzZXJMb2dpbiA9PiAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntEZWZhdWx0VmFsdWV9IHx8ICcnLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGlmICgkU2VsZWN0ZWRWYWx1ZSkgewogICAgICAgICAgICAgICAgICAgICRTZWxlY3RlZFZhbHVlID0gJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57RGVmYXVsdFZhbHVlfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYgKCAhJFNlbGVjdGVkVmFsdWUgKSB7CiAgICAgICAgICAgICAgICAkU2VsZWN0ZWRWYWx1ZSA9ICRVc2VyT2JqZWN0LT5Vc2VyTG9va3VwKAogICAgICAgICAgICAgICAgICAgIFVzZXJJRCA9PiAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntEZWZhdWx0VmFsdWV9IHx8ICcnLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBteSAkUmVzcG9uc2libGVJRFBhcmFtID0gJFBhcmFte0dldFBhcmFtfXtSZXNwb25zaWJsZUlEfTsKICAgIGlmICggJFJlc3BvbnNpYmxlSURQYXJhbSAmJiAhJFNlbGVjdGVkVmFsdWUgKSB7CiAgICAgICAgJFNlbGVjdGVkVmFsdWUgPSAkVXNlck9iamVjdC0+VXNlckxvb2t1cCggVXNlcklEID0+ICRSZXNwb25zaWJsZUlEUGFyYW0gKTsKICAgIH0KCiAgICAjIGlmIHRoZXJlIGlzIG5vIHVzZXIgZnJvbSBHZXRQYXJhbSBvciBkZWZhdWx0IGFuZCB0aGUgZmllbGQgaXMgbWFuZGF0b3J5IGdldCBpdCBmcm9tIHRoZSB0aWNrZXQKICAgICMgICAgKGlmIGFueSkKICAgIGlmICgKICAgICAgICAhJFNlbGVjdGVkVmFsdWUKICAgICAgICAmJiAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntEaXNwbGF5fSA9PSAyCiAgICAgICAgJiYgSXNIYXNoUmVmV2l0aERhdGEoICRQYXJhbXtUaWNrZXR9ICkKICAgICAgICApCiAgICB7CiAgICAgICAgJFNlbGVjdGVkVmFsdWUgPSAkUGFyYW17VGlja2V0fS0+e1Jlc3BvbnNpYmxlfTsKICAgIH0KCiAgICAjIGlmIHdlIGhhdmUgYSB1c2VyIGFscmVhZHkgYW5kIHRoZSBmaWVsZCBpcyBub3QgbWFuZGF0b3J5IGFuZCBpdCBpcyB0aGUgc2FtZSBhcyBpbiB0aWNrZXQsIHRoZW4KICAgICMgICAgc2V0IGl0IHRvIG5vbmUgKGFzIGl0IGRvZXNuJ3QgbmVlZCB0byBiZSBjaGFuZ2VkIGFmdGVyYWxsKQogICAgZWxzaWYgKAogICAgICAgICRTZWxlY3RlZFZhbHVlCiAgICAgICAgJiYgJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57RGlzcGxheX0gIT0gMgogICAgICAgICYmIElzSGFzaFJlZldpdGhEYXRhKCAkUGFyYW17VGlja2V0fSApCiAgICAgICAgJiYgJFNlbGVjdGVkVmFsdWUgZXEgJFBhcmFte1RpY2tldH0tPntSZXNwb25zaWJsZX0KICAgICAgICApCiAgICB7CiAgICAgICAgJFNlbGVjdGVkVmFsdWUgPSAnJzsKICAgIH0KCiAgICAjIHNldCBzZXJ2ZXIgZXJyb3JzCiAgICBteSAkU2VydmVyRXJyb3IgPSAnJzsKICAgIGlmICggSXNIYXNoUmVmV2l0aERhdGEoICRQYXJhbXtFcnJvcn0gKSAmJiAkUGFyYW17RXJyb3J9LT57J1Jlc3BvbnNpYmxlSUQnfSApIHsKICAgICAgICAkU2VydmVyRXJyb3IgPSAnU2VydmVyRXJyb3InOwogICAgfQoKICAgICMgbG9vayB1cCAkU2VsZWN0ZWRJRAogICAgbXkgJFNlbGVjdGVkSUQ7CiAgICBpZiAoJFNlbGVjdGVkVmFsdWUpIHsKICAgICAgICAkU2VsZWN0ZWRJRCA9ICRVc2VyT2JqZWN0LT5Vc2VyTG9va3VwKAogICAgICAgICAgICBVc2VyTG9naW4gPT4gJFNlbGVjdGVkVmFsdWUsCiAgICAgICAgKTsKICAgIH0KCiAgICBpZiAoICRTZWxmLT57TGlua1RpY2tldERhdGF9ICkgewogICAgICAgICRTZWxlY3RlZElEID0gJFNlbGYtPntMaW5rVGlja2V0RGF0YX0tPntSZXNwb25zaWJsZUlEfTsKICAgIH0KCiAgICAjIGJ1aWxkIFJlc3BvbnNpYmxlIHN0cmluZwogICAgJERhdGF7Q29udGVudH0gPSAkTGF5b3V0T2JqZWN0LT5CdWlsZFNlbGVjdGlvbigKICAgICAgICBEYXRhICAgICAgICAgPT4gJFJlc3BvbnNpYmxlcywKICAgICAgICBOYW1lICAgICAgICAgPT4gJ1Jlc3BvbnNpYmxlSUQnLAogICAgICAgIFRyYW5zbGF0aW9uICA9PiAxLAogICAgICAgIFNlbGVjdGVkSUQgICA9PiAkU2VsZWN0ZWRJRCwKICAgICAgICBDbGFzcyAgICAgICAgPT4gIk1vZGVybml6ZSAkU2VydmVyRXJyb3IiLAogICAgICAgIFBvc3NpYmxlTm9uZSA9PiAxLAogICAgKTsKCiAgICAjIHNlbmQgZGF0YSB0byBKUwogICAgJExheW91dE9iamVjdC0+QWRkSlNEYXRhKAogICAgICAgIEtleSAgID0+ICdSZXNwb25zaWJsZUZpZWxkc1RvVXBkYXRlJywKICAgICAgICBWYWx1ZSA9PiAkUGFyYW17QUpBWFVwZGF0YWJsZUZpZWxkc30KICAgICk7CgogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntMYXlvdXRCbG9ja30gfHwgJ3J3OlJlc3BvbnNpYmxlJywKICAgICAgICBEYXRhID0+IFwlRGF0YSwKICAgICk7CgogICAgIyBzZXQgbWFuZGF0b3J5IGxhYmVsIG1hcmtlcgogICAgaWYgKCAkRGF0YXtNYW5kYXRvcnlDbGFzc30gJiYgJERhdGF7TWFuZGF0b3J5Q2xhc3N9IG5lICcnICkgewogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdMYWJlbFNwYW4nLAogICAgICAgICAgICBEYXRhID0+IHt9LAogICAgICAgICk7CiAgICB9CgogICAgaWYgKCAkUGFyYW17RGVzY3JpcHRpb25TaG9ydH0gKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57TGF5b3V0QmxvY2t9IHx8ICdydzpSZXNwb25zaWJsZTpEZXNjcmlwdGlvblNob3J0JywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBEZXNjcmlwdGlvblNob3J0ID0+ICRQYXJhbXtEZXNjcmlwdGlvblNob3J0fSwKICAgICAgICAgICAgfSwKICAgICAgICApOwogICAgfQoKICAgIGlmICggJFBhcmFte0Rlc2NyaXB0aW9uTG9uZ30gKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ3J3OlJlc3BvbnNpYmxlOkRlc2NyaXB0aW9uTG9uZycsCiAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgRGVzY3JpcHRpb25Mb25nID0+ICRQYXJhbXtEZXNjcmlwdGlvbkxvbmd9LAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgICBTdWNjZXNzID0+IDEsCiAgICAgICAgSFRNTCAgICA9PiAkTGF5b3V0T2JqZWN0LT5PdXRwdXQoIFRlbXBsYXRlRmlsZSA9PiAnUHJvY2Vzc01hbmFnZW1lbnQvUmVzcG9uc2libGUnICksCiAgICB9OwoKfQoKc3ViIF9SZW5kZXJPd25lciB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgZ2V0IGxheW91dCBvYmplY3QKICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgZm9yIG15ICROZWVkZWQgKHF3KEZvcm1JRCkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBTdWNjZXNzID0+IDAsCiAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0KICAgICAgICAgICAgICAgICAgICAtPlRyYW5zbGF0ZSggJ1BhcmFtZXRlciAlcyBpcyBtaXNzaW5nIGluICVzLicsICROZWVkZWQsICdfUmVuZGVyT3duZXInICksCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgfQogICAgaWYgKCAhSXNIYXNoUmVmV2l0aERhdGEoICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfSApICkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIFN1Y2Nlc3MgPT4gMCwKICAgICAgICAgICAgTWVzc2FnZSA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9CiAgICAgICAgICAgICAgICAtPlRyYW5zbGF0ZSggJ1BhcmFtZXRlciAlcyBpcyBtaXNzaW5nIGluICVzLicsICdBY3Rpdml0eURpYWxvZ0ZpZWxkJywgJ19SZW5kZXJPd25lcicgKSwKICAgICAgICB9OwogICAgfQoKICAgIGlmICggJFNlbGYtPntMaW5rVGlja2V0RGF0YX0gKSB7CiAgICAgICAgJFBhcmFte0dldFBhcmFtfS0+e093bmVyQWxsfSA9IDE7CiAgICB9CgogICAgbXkgJE93bmVycyA9ICRTZWxmLT5fR2V0T3duZXJzKCAleyAkUGFyYW17R2V0UGFyYW19IH0gKTsKCiAgICBteSAlRGF0YSA9ICgKICAgICAgICBMYWJlbCAgICAgICAgICAgID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgiT3duZXIiKSwKICAgICAgICBGaWVsZElEICAgICAgICAgID0+ICdPd25lcklEJywKICAgICAgICBGb3JtSUQgICAgICAgICAgID0+ICRQYXJhbXtGb3JtSUR9LAogICAgICAgIE93bmVyQWxsICAgICAgICAgPT4gJFBhcmFte0dldFBhcmFtfXtPd25lckFsbH0sCiAgICAgICAgTWFuZGF0b3J5Q2xhc3MgICA9PiAnJywKICAgICAgICBWYWxpZGF0ZVJlcXVpcmVkID0+ICcnLAogICAgKTsKCiAgICAjIGlmIGZpZWxkIGlzIHJlcXVpcmVkIHB1dCBpbiB0aGUgbmVjZXNzYXJ5IHZhcmlhYmxlcyBmb3IKICAgICMgICAgVmFsaWRhdGVSZXF1aXJlZCBjbGFzcyBpbnB1dCBmaWVsZCwgTWFuZGF0b3J5IGNsYXNzIGZvciB0aGUgbGFiZWwKICAgIGlmICggJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57RGlzcGxheX0gJiYgJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57RGlzcGxheX0gPT0gMiApIHsKICAgICAgICAkRGF0YXtWYWxpZGF0ZVJlcXVpcmVkfSA9ICdWYWxpZGF0ZV9SZXF1aXJlZCc7CiAgICAgICAgJERhdGF7TWFuZGF0b3J5Q2xhc3N9ICAgPSAnTWFuZGF0b3J5JzsKICAgIH0KCiAgICBteSAkU2VsZWN0ZWRWYWx1ZTsKCiAgICAjIGdldCB1c2VyIG9iamVjdAogICAgbXkgJFVzZXJPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VXNlcicpOwoKICAgIGlmICggJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57RGVmYXVsdFZhbHVlfSApIHsKCiAgICAgICAgaWYgKCAkUGFyYW17RmllbGROYW1lfSBlcSAnT3duZXInICkgewoKICAgICAgICAgICAgaWYgKCAhJFNlbGVjdGVkVmFsdWUgKSB7CgogICAgICAgICAgICAgICAgIyBGZXRjaCBEZWZhdWx0VmFsdWUgZnJvbSBDb25maWcKICAgICAgICAgICAgICAgICRTZWxlY3RlZFZhbHVlID0gJFVzZXJPYmplY3QtPlVzZXJMb29rdXAoCiAgICAgICAgICAgICAgICAgICAgVXNlckxvZ2luID0+ICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0RlZmF1bHRWYWx1ZX0gfHwgJycsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgaWYgKCRTZWxlY3RlZFZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgJFNlbGVjdGVkVmFsdWUgPSAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntEZWZhdWx0VmFsdWV9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBpZiAoICEkU2VsZWN0ZWRWYWx1ZSApIHsKICAgICAgICAgICAgICAgICRTZWxlY3RlZFZhbHVlID0gJFVzZXJPYmplY3QtPlVzZXJMb29rdXAoCiAgICAgICAgICAgICAgICAgICAgVXNlcklEID0+ICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0RlZmF1bHRWYWx1ZX0gfHwgJycsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIG15ICRPd25lcklEUGFyYW0gPSAkUGFyYW17R2V0UGFyYW19e093bmVySUR9OwogICAgaWYgKCAkT3duZXJJRFBhcmFtICYmICEkU2VsZWN0ZWRWYWx1ZSApIHsKICAgICAgICAkU2VsZWN0ZWRWYWx1ZSA9ICRVc2VyT2JqZWN0LT5Vc2VyTG9va3VwKAogICAgICAgICAgICBVc2VySUQgPT4gJE93bmVySURQYXJhbSwKICAgICAgICApOwogICAgfQoKICAgICMgaWYgdGhlcmUgaXMgbm8gdXNlciBmcm9tIEdldFBhcmFtIG9yIGRlZmF1bHQgYW5kIHRoZSBmaWVsZCBpcyBtYW5kYXRvcnkgZ2V0IGl0IGZyb20gdGhlIHRpY2tldAogICAgIyAgICAoaWYgYW55KQogICAgaWYgKAogICAgICAgICEkU2VsZWN0ZWRWYWx1ZQogICAgICAgICYmICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0Rpc3BsYXl9ID09IDIKICAgICAgICAmJiBJc0hhc2hSZWZXaXRoRGF0YSggJFBhcmFte1RpY2tldH0gKQogICAgICAgICkKICAgIHsKICAgICAgICAkU2VsZWN0ZWRWYWx1ZSA9ICRQYXJhbXtUaWNrZXR9LT57T3duZXJ9OwogICAgfQoKICAgICMgaWYgd2UgaGF2ZSBhIHVzZXIgYWxyZWFkeSBhbmQgdGhlIGZpZWxkIGlzIG5vdCBtYW5kYXRvcnkgYW5kIGl0IGlzIHRoZSBzYW1lIGFzIGluIHRpY2tldCwgdGhlbgogICAgIyAgICBzZXQgaXQgdG8gbm9uZSAoYXMgaXQgZG9lc24ndCBuZWVkIHRvIGJlIGNoYW5nZWQgYWZ0ZXJhbGwpCiAgICBlbHNpZiAoCiAgICAgICAgJFNlbGVjdGVkVmFsdWUKICAgICAgICAmJiAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntEaXNwbGF5fSAhPSAyCiAgICAgICAgJiYgSXNIYXNoUmVmV2l0aERhdGEoICRQYXJhbXtUaWNrZXR9ICkKICAgICAgICAmJiAkU2VsZWN0ZWRWYWx1ZSBlcSAkUGFyYW17VGlja2V0fS0+e093bmVyfQogICAgICAgICkKICAgIHsKICAgICAgICAkU2VsZWN0ZWRWYWx1ZSA9ICcnOwogICAgfQoKICAgICMgc2V0IHNlcnZlciBlcnJvcnMKICAgIG15ICRTZXJ2ZXJFcnJvciA9ICcnOwogICAgaWYgKCBJc0hhc2hSZWZXaXRoRGF0YSggJFBhcmFte0Vycm9yfSApICYmICRQYXJhbXtFcnJvcn0tPnsnT3duZXJJRCd9ICkgewogICAgICAgICRTZXJ2ZXJFcnJvciA9ICdTZXJ2ZXJFcnJvcic7CiAgICB9CgogICAgaWYgKCAkU2VsZi0+e0xpbmtUaWNrZXREYXRhfSApIHsKICAgICAgICAkU2VsZWN0ZWRWYWx1ZSA9ICRTZWxmLT57TGlua1RpY2tldERhdGF9LT57T3duZXJJRH07CiAgICB9CgogICAgIyBsb29rIHVwICRTZWxlY3RlZElECiAgICBteSAkU2VsZWN0ZWRJRDsKICAgIGlmICgkU2VsZWN0ZWRWYWx1ZSkgewogICAgICAgICRTZWxlY3RlZElEID0gJFVzZXJPYmplY3QtPlVzZXJMb29rdXAoCiAgICAgICAgICAgIFVzZXJMb2dpbiA9PiAkU2VsZWN0ZWRWYWx1ZSwKICAgICAgICApOwogICAgfQoKICAgICMgYnVpbGQgT3duZXIgc3RyaW5nCiAgICAkRGF0YXtDb250ZW50fSA9ICRMYXlvdXRPYmplY3QtPkJ1aWxkU2VsZWN0aW9uKAogICAgICAgIERhdGEgICAgICAgICA9PiAkT3duZXJzLAogICAgICAgIE5hbWUgICAgICAgICA9PiAnT3duZXJJRCcsCiAgICAgICAgVHJhbnNsYXRpb24gID0+IDEsCiAgICAgICAgU2VsZWN0ZWRJRCAgID0+ICRTZWxlY3RlZElEIHx8ICcnLAogICAgICAgIENsYXNzICAgICAgICA9PiAiTW9kZXJuaXplICRTZXJ2ZXJFcnJvciIsCiAgICAgICAgUG9zc2libGVOb25lID0+IDEsCiAgICApOwoKICAgICMgc2VuZCBkYXRhIHRvIEpTCiAgICAkTGF5b3V0T2JqZWN0LT5BZGRKU0RhdGEoCiAgICAgICAgS2V5ICAgPT4gJ093bmVyRmllbGRzVG9VcGRhdGUnLAogICAgICAgIFZhbHVlID0+ICRQYXJhbXtBSkFYVXBkYXRhYmxlRmllbGRzfQogICAgKTsKCiAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICBOYW1lID0+ICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0xheW91dEJsb2NrfSB8fCAncnc6T3duZXInLAogICAgICAgIERhdGEgPT4gXCVEYXRhLAogICAgKTsKCiAgICAjIHNldCBtYW5kYXRvcnkgbGFiZWwgbWFya2VyCiAgICBpZiAoICREYXRhe01hbmRhdG9yeUNsYXNzfSAmJiAkRGF0YXtNYW5kYXRvcnlDbGFzc30gbmUgJycgKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ0xhYmVsU3BhbicsCiAgICAgICAgICAgIERhdGEgPT4ge30sCiAgICAgICAgKTsKICAgIH0KCiAgICBpZiAoICRQYXJhbXtEZXNjcmlwdGlvblNob3J0fSApIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntMYXlvdXRCbG9ja30gfHwgJ3J3Ok93bmVyOkRlc2NyaXB0aW9uU2hvcnQnLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgIERlc2NyaXB0aW9uU2hvcnQgPT4gJFBhcmFte0Rlc2NyaXB0aW9uU2hvcnR9LAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICB9CgogICAgaWYgKCAkUGFyYW17RGVzY3JpcHRpb25Mb25nfSApIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAncnc6T3duZXI6RGVzY3JpcHRpb25Mb25nJywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBEZXNjcmlwdGlvbkxvbmcgPT4gJFBhcmFte0Rlc2NyaXB0aW9uTG9uZ30sCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIFN1Y2Nlc3MgPT4gMSwKICAgICAgICBIVE1MICAgID0+ICRMYXlvdXRPYmplY3QtPk91dHB1dCggVGVtcGxhdGVGaWxlID0+ICdQcm9jZXNzTWFuYWdlbWVudC9Pd25lcicgKSwKICAgIH07Cn0KCnN1YiBfUmVuZGVyU0xBIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBnZXQgbGF5b3V0IG9iamVjdAogICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKCiAgICBmb3IgbXkgJE5lZWRlZCAocXcoRm9ybUlEKSkgewogICAgICAgIGlmICggISRQYXJhbXskTmVlZGVkfSApIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIFN1Y2Nlc3MgPT4gMCwKICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fQogICAgICAgICAgICAgICAgICAgIC0+VHJhbnNsYXRlKCAnUGFyYW1ldGVyICVzIGlzIG1pc3NpbmcgaW4gJXMuJywgJE5lZWRlZCwgJ19SZW5kZXJTTEEnICksCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgfQogICAgaWYgKCAhSXNIYXNoUmVmV2l0aERhdGEoICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfSApICkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIFN1Y2Nlc3MgPT4gMCwKICAgICAgICAgICAgTWVzc2FnZSA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9CiAgICAgICAgICAgICAgICAtPlRyYW5zbGF0ZSggJ1BhcmFtZXRlciAlcyBpcyBtaXNzaW5nIGluICVzLicsICdBY3Rpdml0eURpYWxvZ0ZpZWxkJywgJ19SZW5kZXJTTEEnICksCiAgICAgICAgfTsKICAgIH0KCiAgICBpZiAoICRTZWxmLT57TGlua1RpY2tldERhdGF9ICkgewogICAgICAgICRQYXJhbXtHZXRQYXJhbX0tPntRdWV1ZUlEfSAgICAgICAgPSAkU2VsZi0+e0xpbmtUaWNrZXREYXRhfS0+e1F1ZXVlSUR9OwogICAgICAgICRQYXJhbXtHZXRQYXJhbX0tPntUaWNrZXRJRH0gICAgICAgPSAkU2VsZi0+e0xpbmtUaWNrZXREYXRhfS0+e1RpY2tldElEfTsKICAgICAgICAkUGFyYW17R2V0UGFyYW19LT57Q3VzdG9tZXJVc2VySUR9ID0gJFNlbGYtPntMaW5rVGlja2V0RGF0YX0tPntDdXN0b21lclVzZXJJRH07CiAgICB9CgogICAgIyBjcmVhdGUgYSBsb2NhbCBjb3B5IG9mIHRoZSBHZXRQYXJhbQogICAgbXkgJUdldFNlcnZpY2VzUGFyYW0gPSAleyAkUGFyYW17R2V0UGFyYW19IH07CgogICAgIyB1c2UgdGlja2V0IGluZm9ybWF0aW9uIGFzIGEgZmFsbCBiYWNrIGlmIGN1c3RvbWVyIHdhcyBhbHJlYWR5IHNldCwgb3RoZXJ3aXNlIHdoZW4gdGhlCiAgICAjIGFjdGl2aXR5IGRpYWxvZyBkaXNwbGF5cyB0aGUgc2VydmljZSBsaXN0IHdpbGwgYmUgaW5pdGlhbGx5IGVtcHR5LCBzZWUgYnVnIzEwMDU5CiAgICBpZiAoIElzSGFzaFJlZldpdGhEYXRhKCAkUGFyYW17VGlja2V0fSApICkgewogICAgICAgICRHZXRTZXJ2aWNlc1BhcmFte0N1c3RvbWVyVXNlcklEfSB8fD0gJFBhcmFte1RpY2tldH0tPntDdXN0b21lclVzZXJJRH0gfHw9ICcnOwogICAgfQoKICAgIG15ICRTZXJ2aWNlcyA9ICRTZWxmLT5fR2V0U2VydmljZXMoCiAgICAgICAgJUdldFNlcnZpY2VzUGFyYW0sCiAgICApOwoKICAgIGlmICggJFNlbGYtPntMaW5rVGlja2V0RGF0YX0gKSB7CiAgICAgICAgJFBhcmFte0dldFBhcmFtfS0+e1NlcnZpY2VzfSAgPSAkU2VydmljZXM7CiAgICAgICAgJFBhcmFte0dldFBhcmFtfS0+e1NlcnZpY2VJRH0gPSAkU2VsZi0+e0xpbmtUaWNrZXREYXRhfS0+e1NlcnZpY2VJRH07CiAgICB9CgogICAgbXkgJFNMQXMgPSAkU2VsZi0+X0dldFNMQXMoCiAgICAgICAgJXsgJFBhcmFte0dldFBhcmFtfSB9LAogICAgICAgIFNlcnZpY2VzID0+ICRTZXJ2aWNlcywKICAgICk7CgogICAgbXkgJURhdGEgPSAoCiAgICAgICAgTGFiZWwgICAgICAgICAgICA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoIlNMQSIpLAogICAgICAgIEZpZWxkSUQgICAgICAgICAgPT4gJ1NMQUlEJywKICAgICAgICBGb3JtSUQgICAgICAgICAgID0+ICRQYXJhbXtGb3JtSUR9LAogICAgICAgIE1hbmRhdG9yeUNsYXNzICAgPT4gJycsCiAgICAgICAgVmFsaWRhdGVSZXF1aXJlZCA9PiAnJywKICAgICk7CgogICAgIyBJZiBmaWVsZCBpcyByZXF1aXJlZCBwdXQgaW4gdGhlIG5lY2Vzc2FyeSB2YXJpYWJsZXMgZm9yCiAgICAjIFZhbGlkYXRlUmVxdWlyZWQgY2xhc3MgaW5wdXQgZmllbGQsIE1hbmRhdG9yeSBjbGFzcyBmb3IgdGhlIGxhYmVsCiAgICBpZiAoICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0Rpc3BsYXl9ICYmICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0Rpc3BsYXl9ID09IDIgKSB7CiAgICAgICAgJERhdGF7VmFsaWRhdGVSZXF1aXJlZH0gPSAnVmFsaWRhdGVfUmVxdWlyZWQnOwogICAgICAgICREYXRhe01hbmRhdG9yeUNsYXNzfSAgID0gJ01hbmRhdG9yeSc7CiAgICB9CgogICAgbXkgJFNlbGVjdGVkVmFsdWU7CgogICAgIyBnZXQgU0xBIG9iamVjdAogICAgbXkgJFNMQU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpTTEEnKTsKCiAgICBteSAkU0xBSURQYXJhbSA9ICRQYXJhbXtHZXRQYXJhbX17U0xBSUR9OwogICAgaWYgKCRTTEFJRFBhcmFtKSB7CiAgICAgICAgJFNlbGVjdGVkVmFsdWUgPSAkU0xBT2JqZWN0LT5TTEFMb29rdXAoIFNMQUlEID0+ICRTTEFJRFBhcmFtICk7CiAgICB9CgogICAgaWYgKCAkUGFyYW17RmllbGROYW1lfSBlcSAnU0xBJyApIHsKCiAgICAgICAgaWYgKCAhJFNlbGVjdGVkVmFsdWUgKSB7CgogICAgICAgICAgICAjIEZldGNoIERlZmF1bHRWYWx1ZSBmcm9tIENvbmZpZwogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICBkZWZpbmVkICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0RlZmF1bHRWYWx1ZX0KICAgICAgICAgICAgICAgICYmICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0RlZmF1bHRWYWx1ZX0gbmUgJycKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJFNlbGVjdGVkVmFsdWUgPSAkU0xBT2JqZWN0LT5TTEFMb29rdXAoCiAgICAgICAgICAgICAgICAgICAgU0xBID0+ICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0RlZmF1bHRWYWx1ZX0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoJFNlbGVjdGVkVmFsdWUpIHsKICAgICAgICAgICAgICAgICRTZWxlY3RlZFZhbHVlID0gJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57RGVmYXVsdFZhbHVlfTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGVsc2UgewogICAgICAgIGlmICggISRTZWxlY3RlZFZhbHVlICkgewogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICBkZWZpbmVkICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0RlZmF1bHRWYWx1ZX0KICAgICAgICAgICAgICAgICYmICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0RlZmF1bHRWYWx1ZX0gbmUgJycKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJFNlbGVjdGVkVmFsdWUgPSAkU0xBT2JqZWN0LT5TTEFMb29rdXAoCiAgICAgICAgICAgICAgICAgICAgU0xBID0+ICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0RlZmF1bHRWYWx1ZX0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgICMgR2V0IFRpY2tldFZhbHVlCiAgICBpZiAoIElzSGFzaFJlZldpdGhEYXRhKCAkUGFyYW17VGlja2V0fSApICYmICEkU2VsZWN0ZWRWYWx1ZSApIHsKICAgICAgICAkU2VsZWN0ZWRWYWx1ZSA9ICRQYXJhbXtUaWNrZXR9LT57U0xBfTsKICAgIH0KCiAgICAjIHNldCBzZXJ2ZXIgZXJyb3JzCiAgICBteSAkU2VydmVyRXJyb3IgPSAnJzsKICAgIGlmICggSXNIYXNoUmVmV2l0aERhdGEoICRQYXJhbXtFcnJvcn0gKSAmJiAkUGFyYW17RXJyb3J9LT57J1NMQUlEJ30gKSB7CiAgICAgICAgJFNlcnZlckVycm9yID0gJ1NlcnZlckVycm9yJzsKICAgIH0KCiAgICBpZiAoICRTZWxmLT57TGlua1RpY2tldERhdGF9ICkgewogICAgICAgICRTZWxlY3RlZFZhbHVlID0gJFNlbGYtPntMaW5rVGlja2V0RGF0YX0tPntTTEF9OwogICAgfQoKICAgICMgYnVpbGQgU0xBIHN0cmluZwogICAgJERhdGF7Q29udGVudH0gPSAkTGF5b3V0T2JqZWN0LT5CdWlsZFNlbGVjdGlvbigKICAgICAgICBEYXRhICAgICAgICAgID0+ICRTTEFzLAogICAgICAgIE5hbWUgICAgICAgICAgPT4gJ1NMQUlEJywKICAgICAgICBTZWxlY3RlZFZhbHVlID0+ICRTZWxlY3RlZFZhbHVlLAogICAgICAgIFBvc3NpYmxlTm9uZSAgPT4gMSwKICAgICAgICBTb3J0ICAgICAgICAgID0+ICdBbHBoYW51bWVyaWNWYWx1ZScsCiAgICAgICAgVHJhbnNsYXRpb24gICA9PiAwLAogICAgICAgIENsYXNzICAgICAgICAgPT4gIk1vZGVybml6ZSAkU2VydmVyRXJyb3IiLAogICAgICAgIE1heCAgICAgICAgICAgPT4gMjAwLAogICAgKTsKCiAgICAjIHNlbmQgZGF0YSB0byBKUwogICAgJExheW91dE9iamVjdC0+QWRkSlNEYXRhKAogICAgICAgIEtleSAgID0+ICdTTEFGaWVsZHNUb1VwZGF0ZScsCiAgICAgICAgVmFsdWUgPT4gJFBhcmFte0FKQVhVcGRhdGFibGVGaWVsZHN9CiAgICApOwoKICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgIE5hbWUgPT4gJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57TGF5b3V0QmxvY2t9IHx8ICdydzpTTEEnLAogICAgICAgIERhdGEgPT4gXCVEYXRhLAogICAgKTsKCiAgICAjIHNldCBtYW5kYXRvcnkgbGFiZWwgbWFya2VyCiAgICBpZiAoICREYXRhe01hbmRhdG9yeUNsYXNzfSAmJiAkRGF0YXtNYW5kYXRvcnlDbGFzc30gbmUgJycgKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ0xhYmVsU3BhbicsCiAgICAgICAgICAgIERhdGEgPT4ge30sCiAgICAgICAgKTsKICAgIH0KCiAgICBpZiAoICRQYXJhbXtEZXNjcmlwdGlvblNob3J0fSApIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntMYXlvdXRCbG9ja30gfHwgJ3J3OlNMQTpEZXNjcmlwdGlvblNob3J0JywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBEZXNjcmlwdGlvblNob3J0ID0+ICRQYXJhbXtEZXNjcmlwdGlvblNob3J0fSwKICAgICAgICAgICAgfSwKICAgICAgICApOwogICAgfQoKICAgIGlmICggJFBhcmFte0Rlc2NyaXB0aW9uTG9uZ30gKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ3J3OlNMQTpEZXNjcmlwdGlvbkxvbmcnLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgIERlc2NyaXB0aW9uTG9uZyA9PiAkUGFyYW17RGVzY3JpcHRpb25Mb25nfSwKICAgICAgICAgICAgfSwKICAgICAgICApOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgU3VjY2VzcyA9PiAxLAogICAgICAgIEhUTUwgICAgPT4gJExheW91dE9iamVjdC0+T3V0cHV0KCBUZW1wbGF0ZUZpbGUgPT4gJ1Byb2Nlc3NNYW5hZ2VtZW50L1NMQScgKSwKICAgIH07Cn0KCnN1YiBfUmVuZGVyU2VydmljZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgZ2V0IGxheW91dCBvYmplY3QKICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgZm9yIG15ICROZWVkZWQgKHF3KEZvcm1JRCkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBTdWNjZXNzID0+IDAsCiAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0KICAgICAgICAgICAgICAgICAgICAtPlRyYW5zbGF0ZSggJ1BhcmFtZXRlciAlcyBpcyBtaXNzaW5nIGluICVzLicsICROZWVkZWQsICdfUmVuZGVyU2VydmljZScgKSwKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICB9CiAgICBpZiAoICFJc0hhc2hSZWZXaXRoRGF0YSggJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9ICkgKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgU3VjY2VzcyA9PiAwLAogICAgICAgICAgICBNZXNzYWdlID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0KICAgICAgICAgICAgICAgIC0+VHJhbnNsYXRlKCAnUGFyYW1ldGVyICVzIGlzIG1pc3NpbmcgaW4gJXMuJywgJ0FjdGl2aXR5RGlhbG9nRmllbGQnLCAnX1JlbmRlclNlcnZpY2UnICksCiAgICAgICAgfTsKICAgIH0KCiAgICBpZiAoICRTZWxmLT57TGlua1RpY2tldERhdGF9ICkgewogICAgICAgICRQYXJhbXtHZXRQYXJhbX0tPntRdWV1ZUlEfSAgICAgICAgPSAkU2VsZi0+e0xpbmtUaWNrZXREYXRhfS0+e1F1ZXVlSUR9OwogICAgICAgICRQYXJhbXtHZXRQYXJhbX0tPntUaWNrZXRJRH0gICAgICAgPSAkU2VsZi0+e0xpbmtUaWNrZXREYXRhfS0+e1RpY2tldElEfTsKICAgICAgICAkUGFyYW17R2V0UGFyYW19LT57Q3VzdG9tZXJVc2VySUR9ID0gJFNlbGYtPntMaW5rVGlja2V0RGF0YX0tPntDdXN0b21lclVzZXJJRH07CiAgICB9CgogICAgIyBjcmVhdGUgYSBsb2NhbCBjb3B5IG9mIHRoZSBHZXRQYXJhbQogICAgbXkgJUdldFNlcnZpY2VzUGFyYW0gPSAleyAkUGFyYW17R2V0UGFyYW19IH07CgogICAgIyB1c2UgdGlja2V0IGluZm9ybWF0aW9uIGFzIGEgZmFsbCBiYWNrIGlmIGN1c3RvbWVyIHdhcyBhbHJlYWR5IHNldCwgb3RoZXJ3aXNlIHdoZW4gdGhlCiAgICAjIGFjdGl2aXR5IGRpYWxvZyBkaXNwbGF5cyB0aGUgc2VydmljZSBsaXN0IHdpbGwgYmUgaW5pdGlhbGx5IGVtcHR5LCBzZWUgYnVnIzEwMDU5CiAgICBpZiAoIElzSGFzaFJlZldpdGhEYXRhKCAkUGFyYW17VGlja2V0fSApICkgewogICAgICAgICRHZXRTZXJ2aWNlc1BhcmFte0N1c3RvbWVyVXNlcklEfSB8fD0gJFBhcmFte1RpY2tldH0tPntDdXN0b21lclVzZXJJRH0gfHw9ICcnOwogICAgfQoKICAgIG15ICRTZXJ2aWNlcyA9ICRTZWxmLT5fR2V0U2VydmljZXMoCiAgICAgICAgJUdldFNlcnZpY2VzUGFyYW0sCiAgICApOwoKICAgIG15ICVEYXRhID0gKAogICAgICAgIExhYmVsICAgICAgICAgICAgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCJTZXJ2aWNlIiksCiAgICAgICAgRmllbGRJRCAgICAgICAgICA9PiAnU2VydmljZUlEJywKICAgICAgICBGb3JtSUQgICAgICAgICAgID0+ICRQYXJhbXtGb3JtSUR9LAogICAgICAgIE1hbmRhdG9yeUNsYXNzICAgPT4gJycsCiAgICAgICAgVmFsaWRhdGVSZXF1aXJlZCA9PiAnJywKICAgICk7CgogICAgIyBJZiBmaWVsZCBpcyByZXF1aXJlZCBwdXQgaW4gdGhlIG5lY2Vzc2FyeSB2YXJpYWJsZXMgZm9yCiAgICAjIFZhbGlkYXRlUmVxdWlyZWQgY2xhc3MgaW5wdXQgZmllbGQsIE1hbmRhdG9yeSBjbGFzcyBmb3IgdGhlIGxhYmVsCiAgICBpZiAoICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0Rpc3BsYXl9ICYmICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0Rpc3BsYXl9ID09IDIgKSB7CiAgICAgICAgJERhdGF7VmFsaWRhdGVSZXF1aXJlZH0gPSAnVmFsaWRhdGVfUmVxdWlyZWQnOwogICAgICAgICREYXRhe01hbmRhdG9yeUNsYXNzfSAgID0gJ01hbmRhdG9yeSc7CiAgICB9CgogICAgbXkgJFNlbGVjdGVkVmFsdWU7CgogICAgIyBnZXQgc2VydmljZSBvYmplY3QKICAgIG15ICRTZXJ2aWNlT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlNlcnZpY2UnKTsKCiAgICBteSAkU2VydmljZUlEUGFyYW0gPSAkUGFyYW17R2V0UGFyYW19e1NlcnZpY2VJRH07CiAgICBpZiAoJFNlcnZpY2VJRFBhcmFtKSB7CiAgICAgICAgJFNlbGVjdGVkVmFsdWUgPSAkU2VydmljZU9iamVjdC0+U2VydmljZUxvb2t1cCgKICAgICAgICAgICAgU2VydmljZUlEID0+ICRTZXJ2aWNlSURQYXJhbSwKICAgICAgICApOwogICAgfQoKICAgIGlmICggJFBhcmFte0ZpZWxkTmFtZX0gZXEgJ1NlcnZpY2UnICkgewoKICAgICAgICBpZiAoICEkU2VsZWN0ZWRWYWx1ZSApIHsKCiAgICAgICAgICAgICMgRmV0Y2ggRGVmYXVsdFZhbHVlIGZyb20gQ29uZmlnCiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIGRlZmluZWQgJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57RGVmYXVsdFZhbHVlfQogICAgICAgICAgICAgICAgJiYgJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57RGVmYXVsdFZhbHVlfSBuZSAnJwogICAgICAgICAgICAgICAgKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkU2VsZWN0ZWRWYWx1ZSA9ICRTZXJ2aWNlT2JqZWN0LT5TZXJ2aWNlTG9va3VwKAogICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57RGVmYXVsdFZhbHVlfSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCRTZWxlY3RlZFZhbHVlKSB7CiAgICAgICAgICAgICAgICAkU2VsZWN0ZWRWYWx1ZSA9ICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0RlZmF1bHRWYWx1ZX07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBpZiAoICEkU2VsZWN0ZWRWYWx1ZSApIHsKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgZGVmaW5lZCAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntEZWZhdWx0VmFsdWV9CiAgICAgICAgICAgICAgICAmJiAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntEZWZhdWx0VmFsdWV9IG5lICcnCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRTZWxlY3RlZFZhbHVlID0gJFNlcnZpY2VPYmplY3QtPlNlcnZpY2VMb29rdXAoCiAgICAgICAgICAgICAgICAgICAgU2VydmljZSA9PiAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntEZWZhdWx0VmFsdWV9LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAjIEdldCBUaWNrZXRWYWx1ZQogICAgaWYgKCBJc0hhc2hSZWZXaXRoRGF0YSggJFBhcmFte1RpY2tldH0gKSAmJiAhJFNlbGVjdGVkVmFsdWUgKSB7CiAgICAgICAgJFNlbGVjdGVkVmFsdWUgPSAkUGFyYW17VGlja2V0fS0+e1NlcnZpY2V9OwogICAgfQoKICAgICMgc2V0IHNlcnZlciBlcnJvcnMKICAgIG15ICRTZXJ2ZXJFcnJvciA9ICcnOwogICAgaWYgKCBJc0hhc2hSZWZXaXRoRGF0YSggJFBhcmFte0Vycm9yfSApICYmICRQYXJhbXtFcnJvcn0tPnsnU2VydmljZUlEJ30gKSB7CiAgICAgICAgJFNlcnZlckVycm9yID0gJ1NlcnZlckVycm9yJzsKICAgIH0KCiAgICAjIGdldCBsaXN0IHR5cGUKICAgIG15ICRUcmVlVmlldyA9IDA7CiAgICBpZiAoICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnVGlja2V0OjpGcm9udGVuZDo6TGlzdFR5cGUnKSBlcSAndHJlZScgKSB7CiAgICAgICAgJFRyZWVWaWV3ID0gMTsKICAgIH0KCiAgICBpZiAoICRTZWxmLT57TGlua1RpY2tldERhdGF9ICkgewogICAgICAgICRTZWxlY3RlZFZhbHVlID0gJFNlbGYtPntMaW5rVGlja2V0RGF0YX0tPntTZXJ2aWNlfTsKICAgIH0KCiAgICAjIGJ1aWxkIFNlcnZpY2Ugc3RyaW5nCiAgICAkRGF0YXtDb250ZW50fSA9ICRMYXlvdXRPYmplY3QtPkJ1aWxkU2VsZWN0aW9uKAogICAgICAgIERhdGEgICAgICAgICAgPT4gJFNlcnZpY2VzLAogICAgICAgIE5hbWUgICAgICAgICAgPT4gJ1NlcnZpY2VJRCcsCiAgICAgICAgQ2xhc3MgICAgICAgICA9PiAiTW9kZXJuaXplICRTZXJ2ZXJFcnJvciIsCiAgICAgICAgU2VsZWN0ZWRWYWx1ZSA9PiAkU2VsZWN0ZWRWYWx1ZSwKICAgICAgICBQb3NzaWJsZU5vbmUgID0+IDEsCiAgICAgICAgVHJlZVZpZXcgICAgICA9PiAkVHJlZVZpZXcsCiAgICAgICAgU29ydCAgICAgICAgICA9PiAnVHJlZVZpZXcnLAogICAgICAgIFRyYW5zbGF0aW9uICAgPT4gMCwKICAgICAgICBNYXggICAgICAgICAgID0+IDIwMCwKICAgICk7CgogICAgIyBzZW5kIGRhdGEgdG8gSlMKICAgICRMYXlvdXRPYmplY3QtPkFkZEpTRGF0YSgKICAgICAgICBLZXkgICA9PiAnU2VydmljZUZpZWxkc1RvVXBkYXRlJywKICAgICAgICBWYWx1ZSA9PiAkUGFyYW17QUpBWFVwZGF0YWJsZUZpZWxkc30KICAgICk7CgogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntMYXlvdXRCbG9ja30gfHwgJ3J3OlNlcnZpY2UnLAogICAgICAgIERhdGEgPT4gXCVEYXRhLAogICAgKTsKCiAgICAjIHNldCBtYW5kYXRvcnkgbGFiZWwgbWFya2VyCiAgICBpZiAoICREYXRhe01hbmRhdG9yeUNsYXNzfSAmJiAkRGF0YXtNYW5kYXRvcnlDbGFzc30gbmUgJycgKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ0xhYmVsU3BhbicsCiAgICAgICAgICAgIERhdGEgPT4ge30sCiAgICAgICAgKTsKICAgIH0KCiAgICBpZiAoICRQYXJhbXtEZXNjcmlwdGlvblNob3J0fSApIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntMYXlvdXRCbG9ja30gfHwgJ3J3OlNlcnZpY2U6RGVzY3JpcHRpb25TaG9ydCcsCiAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgRGVzY3JpcHRpb25TaG9ydCA9PiAkUGFyYW17RGVzY3JpcHRpb25TaG9ydH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKICAgIH0KCiAgICBpZiAoICRQYXJhbXtEZXNjcmlwdGlvbkxvbmd9ICkgewogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdydzpTZXJ2aWNlOkRlc2NyaXB0aW9uTG9uZycsCiAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgRGVzY3JpcHRpb25Mb25nID0+ICRQYXJhbXtEZXNjcmlwdGlvbkxvbmd9LAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgICBTdWNjZXNzID0+IDEsCiAgICAgICAgSFRNTCAgICA9PiAkTGF5b3V0T2JqZWN0LT5PdXRwdXQoIFRlbXBsYXRlRmlsZSA9PiAnUHJvY2Vzc01hbmFnZW1lbnQvU2VydmljZScgKSwKICAgIH07Cgp9CgpzdWIgX1JlbmRlckxvY2sgewoKICAgICMgZm9yIGxvY2sgc3RhdGVzIHRoZXJlJ3Mgbm8gQUNMIGNoZWNraW5nIHlldCBpbXBsZW1lbnRlZCBzbyBubyBjaGVja2luZy4uLgoKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBnZXQgbGF5b3V0IG9iamVjdAogICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKCiAgICBmb3IgbXkgJE5lZWRlZCAocXcoRm9ybUlEKSkgewogICAgICAgIGlmICggISRQYXJhbXskTmVlZGVkfSApIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIFN1Y2Nlc3MgPT4gMCwKICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fQogICAgICAgICAgICAgICAgICAgIC0+VHJhbnNsYXRlKCAnUGFyYW1ldGVyICVzIGlzIG1pc3NpbmcgaW4gJXMuJywgJE5lZWRlZCwgJ19SZW5kZXJMb2NrJyApLAogICAgICAgICAgICB9OwogICAgICAgIH0KICAgIH0KICAgIGlmICggIUlzSGFzaFJlZldpdGhEYXRhKCAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0gKSApIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBTdWNjZXNzID0+IDAsCiAgICAgICAgICAgIE1lc3NhZ2UgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fQogICAgICAgICAgICAgICAgLT5UcmFuc2xhdGUoICdQYXJhbWV0ZXIgJXMgaXMgbWlzc2luZyBpbiAlcy4nLCAnQWN0aXZpdHlEaWFsb2dGaWVsZCcsICdfUmVuZGVyTG9jaycgKSwKICAgICAgICB9OwogICAgfQoKICAgIG15ICRMb2NrcyA9ICRTZWxmLT5fR2V0TG9ja3MoCiAgICAgICAgJXsgJFBhcmFte0dldFBhcmFtfSB9LAogICAgKTsKCiAgICBteSAlRGF0YSA9ICgKICAgICAgICBMYWJlbCAgICAgICAgICAgID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgiTG9jayBzdGF0ZSIpLAogICAgICAgIEZpZWxkSUQgICAgICAgICAgPT4gJ0xvY2tJRCcsCiAgICAgICAgRm9ybUlEICAgICAgICAgICA9PiAkUGFyYW17Rm9ybUlEfSwKICAgICAgICBNYW5kYXRvcnlDbGFzcyAgID0+ICcnLAogICAgICAgIFZhbGlkYXRlUmVxdWlyZWQgPT4gJycsCiAgICApOwoKICAgICMgSWYgZmllbGQgaXMgcmVxdWlyZWQgcHV0IGluIHRoZSBuZWNlc3NhcnkgdmFyaWFibGVzIGZvcgogICAgIyBWYWxpZGF0ZVJlcXVpcmVkIGNsYXNzIGlucHV0IGZpZWxkLCBNYW5kYXRvcnkgY2xhc3MgZm9yIHRoZSBsYWJlbAogICAgaWYgKCAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntEaXNwbGF5fSAmJiAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntEaXNwbGF5fSA9PSAyICkgewogICAgICAgICREYXRhe1ZhbGlkYXRlUmVxdWlyZWR9ID0gJ1ZhbGlkYXRlX1JlcXVpcmVkJzsKICAgICAgICAkRGF0YXtNYW5kYXRvcnlDbGFzc30gICA9ICdNYW5kYXRvcnknOwogICAgfQoKICAgIG15ICRTZWxlY3RlZFZhbHVlOwoKICAgICMgZ2V0IGxvY2sgb2JqZWN0CiAgICBteSAkTG9ja09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2NrJyk7CgogICAgbXkgJExvY2tJRFBhcmFtID0gJFBhcmFte0dldFBhcmFtfXtMb2NrSUR9OwogICAgJFNlbGVjdGVkVmFsdWUgPSAkTG9ja09iamVjdC0+TG9ja0xvb2t1cCggTG9ja0lEID0+ICRMb2NrSURQYXJhbSApCiAgICAgICAgaWYgKCRMb2NrSURQYXJhbSk7CgogICAgaWYgKCAkUGFyYW17RmllbGROYW1lfSBlcSAnTG9jaycgKSB7CgogICAgICAgIGlmICggISRTZWxlY3RlZFZhbHVlICkgewoKICAgICAgICAgICAgIyBGZXRjaCBEZWZhdWx0VmFsdWUgZnJvbSBDb25maWcKICAgICAgICAgICAgJFNlbGVjdGVkVmFsdWUgPSAkTG9ja09iamVjdC0+TG9ja0xvb2t1cCgKICAgICAgICAgICAgICAgIExvY2sgPT4gJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57RGVmYXVsdFZhbHVlfSB8fCAnJywKICAgICAgICAgICAgKTsKICAgICAgICAgICAgaWYgKCRTZWxlY3RlZFZhbHVlKSB7CiAgICAgICAgICAgICAgICAkU2VsZWN0ZWRWYWx1ZSA9ICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0RlZmF1bHRWYWx1ZX07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkU2VsZWN0ZWRWYWx1ZSA9ICRMb2NrT2JqZWN0LT5Mb2NrTG9va3VwKAogICAgICAgICAgICBMb2NrSUQgPT4gJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57RGVmYXVsdFZhbHVlfSB8fCAnJwogICAgICAgICAgICApCiAgICAgICAgICAgIGlmICEkU2VsZWN0ZWRWYWx1ZTsKICAgIH0KCiAgICAjIEdldCBUaWNrZXRWYWx1ZQogICAgaWYgKCBJc0hhc2hSZWZXaXRoRGF0YSggJFBhcmFte1RpY2tldH0gKSAmJiAhJFNlbGVjdGVkVmFsdWUgKSB7CiAgICAgICAgJFNlbGVjdGVkVmFsdWUgPSAkUGFyYW17VGlja2V0fS0+e0xvY2t9OwogICAgfQoKICAgICMgc2V0IHNlcnZlciBlcnJvcnMKICAgIG15ICRTZXJ2ZXJFcnJvciA9ICcnOwogICAgaWYgKCBJc0hhc2hSZWZXaXRoRGF0YSggJFBhcmFte0Vycm9yfSApICYmICRQYXJhbXtFcnJvcn0tPnsnTG9ja0lEJ30gKSB7CiAgICAgICAgJFNlcnZlckVycm9yID0gJ1NlcnZlckVycm9yJzsKICAgIH0KCiAgICBpZiAoICRTZWxmLT57TGlua1RpY2tldERhdGF9ICkgewogICAgICAgICRTZWxlY3RlZFZhbHVlID0gJFNlbGYtPntMaW5rVGlja2V0RGF0YX0tPntMb2NrfTsKICAgIH0KCiAgICAjIGJ1aWxkIGxvY2sgc3RyaW5nCiAgICAkRGF0YXtDb250ZW50fSA9ICRMYXlvdXRPYmplY3QtPkJ1aWxkU2VsZWN0aW9uKAogICAgICAgIERhdGEgICAgICAgICAgPT4gJExvY2tzLAogICAgICAgIE5hbWUgICAgICAgICAgPT4gJ0xvY2tJRCcsCiAgICAgICAgVHJhbnNsYXRpb24gICA9PiAxLAogICAgICAgIFNlbGVjdGVkVmFsdWUgPT4gJFNlbGVjdGVkVmFsdWUsCiAgICAgICAgQ2xhc3MgICAgICAgICA9PiAiTW9kZXJuaXplICRTZXJ2ZXJFcnJvciIsCiAgICApOwoKICAgICMgc2VuZCBkYXRhIHRvIEpTCiAgICAkTGF5b3V0T2JqZWN0LT5BZGRKU0RhdGEoCiAgICAgICAgS2V5ICAgPT4gJ0xvY2tGaWVsZHNUb1VwZGF0ZScsCiAgICAgICAgVmFsdWUgPT4gJFBhcmFte0FKQVhVcGRhdGFibGVGaWVsZHN9CiAgICApOwoKICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgIE5hbWUgPT4gJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57TGF5b3V0QmxvY2t9IHx8ICdydzpMb2NrJywKICAgICAgICBEYXRhID0+IFwlRGF0YSwKICAgICk7CgogICAgIyBzZXQgbWFuZGF0b3J5IGxhYmVsIG1hcmtlcgogICAgaWYgKCAkRGF0YXtNYW5kYXRvcnlDbGFzc30gJiYgJERhdGF7TWFuZGF0b3J5Q2xhc3N9IG5lICcnICkgewogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdMYWJlbFNwYW4nLAogICAgICAgICAgICBEYXRhID0+IHt9LAogICAgICAgICk7CiAgICB9CgogICAgaWYgKCAkUGFyYW17RGVzY3JpcHRpb25TaG9ydH0gKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57TGF5b3V0QmxvY2t9IHx8ICdydzpMb2NrOkRlc2NyaXB0aW9uU2hvcnQnLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgIERlc2NyaXB0aW9uU2hvcnQgPT4gJFBhcmFte0Rlc2NyaXB0aW9uU2hvcnR9LAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICB9CgogICAgaWYgKCAkUGFyYW17RGVzY3JpcHRpb25Mb25nfSApIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAncnc6TG9jazpEZXNjcmlwdGlvbkxvbmcnLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgIERlc2NyaXB0aW9uTG9uZyA9PiAkUGFyYW17RGVzY3JpcHRpb25Mb25nfSwKICAgICAgICAgICAgfSwKICAgICAgICApOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgU3VjY2VzcyA9PiAxLAogICAgICAgIEhUTUwgICAgPT4gJExheW91dE9iamVjdC0+T3V0cHV0KCBUZW1wbGF0ZUZpbGUgPT4gJ1Byb2Nlc3NNYW5hZ2VtZW50L0xvY2snICksCiAgICB9Owp9CgpzdWIgX1JlbmRlclByaW9yaXR5IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBnZXQgbGF5b3V0IG9iamVjdAogICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKCiAgICBmb3IgbXkgJE5lZWRlZCAocXcoRm9ybUlEKSkgewogICAgICAgIGlmICggISRQYXJhbXskTmVlZGVkfSApIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIFN1Y2Nlc3MgPT4gMCwKICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fQogICAgICAgICAgICAgICAgICAgIC0+VHJhbnNsYXRlKCAnUGFyYW1ldGVyICVzIGlzIG1pc3NpbmcgaW4gJXMuJywgJE5lZWRlZCwgJ19SZW5kZXJQcmlvcml0eScgKSwKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICB9CiAgICBpZiAoICFJc0hhc2hSZWZXaXRoRGF0YSggJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9ICkgKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgU3VjY2VzcyA9PiAwLAogICAgICAgICAgICBNZXNzYWdlID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0KICAgICAgICAgICAgICAgIC0+VHJhbnNsYXRlKCAnUGFyYW1ldGVyICVzIGlzIG1pc3NpbmcgaW4gJXMuJywgJ0FjdGl2aXR5RGlhbG9nRmllbGQnLCAnX1JlbmRlclByaW9yaXR5JyApLAogICAgICAgIH07CiAgICB9CgogICAgbXkgJFByaW9yaXRpZXMgPSAkU2VsZi0+X0dldFByaW9yaXRpZXMoCiAgICAgICAgJXsgJFBhcmFte0dldFBhcmFtfSB9LAogICAgKTsKCiAgICBteSAlRGF0YSA9ICgKICAgICAgICBMYWJlbCAgICAgICAgICAgID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgiUHJpb3JpdHkiKSwKICAgICAgICBGaWVsZElEICAgICAgICAgID0+ICdQcmlvcml0eUlEJywKICAgICAgICBGb3JtSUQgICAgICAgICAgID0+ICRQYXJhbXtGb3JtSUR9LAogICAgICAgIE1hbmRhdG9yeUNsYXNzICAgPT4gJycsCiAgICAgICAgVmFsaWRhdGVSZXF1aXJlZCA9PiAnJywKICAgICk7CgogICAgIyBJZiBmaWVsZCBpcyByZXF1aXJlZCBwdXQgaW4gdGhlIG5lY2Vzc2FyeSB2YXJpYWJsZXMgZm9yCiAgICAjIFZhbGlkYXRlUmVxdWlyZWQgY2xhc3MgaW5wdXQgZmllbGQsIE1hbmRhdG9yeSBjbGFzcyBmb3IgdGhlIGxhYmVsCiAgICBpZiAoICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0Rpc3BsYXl9ICYmICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0Rpc3BsYXl9ID09IDIgKSB7CiAgICAgICAgJERhdGF7VmFsaWRhdGVSZXF1aXJlZH0gPSAnVmFsaWRhdGVfUmVxdWlyZWQnOwogICAgICAgICREYXRhe01hbmRhdG9yeUNsYXNzfSAgID0gJ01hbmRhdG9yeSc7CiAgICB9CgogICAgbXkgJFNlbGVjdGVkVmFsdWU7CgogICAgIyBnZXQgcHJpb3JpdHkgb2JqZWN0CiAgICBteSAkUHJpb3JpdHlPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6UHJpb3JpdHknKTsKCiAgICBteSAkUHJpb3JpdHlJRFBhcmFtID0gJFBhcmFte0dldFBhcmFtfXtQcmlvcml0eUlEfTsKICAgIGlmICgkUHJpb3JpdHlJRFBhcmFtKSB7CiAgICAgICAgJFNlbGVjdGVkVmFsdWUgPSAkUHJpb3JpdHlPYmplY3QtPlByaW9yaXR5TG9va3VwKAogICAgICAgICAgICBQcmlvcml0eUlEID0+ICRQcmlvcml0eUlEUGFyYW0sCiAgICAgICAgKTsKICAgIH0KCiAgICBpZiAoICRQYXJhbXtGaWVsZE5hbWV9IGVxICdQcmlvcml0eScgKSB7CgogICAgICAgIGlmICggISRTZWxlY3RlZFZhbHVlICkgewoKICAgICAgICAgICAgIyBGZXRjaCBEZWZhdWx0VmFsdWUgZnJvbSBDb25maWcKICAgICAgICAgICAgJFNlbGVjdGVkVmFsdWUgPSAkUHJpb3JpdHlPYmplY3QtPlByaW9yaXR5TG9va3VwKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57RGVmYXVsdFZhbHVlfSB8fCAnJywKICAgICAgICAgICAgKTsKICAgICAgICAgICAgaWYgKCRTZWxlY3RlZFZhbHVlKSB7CiAgICAgICAgICAgICAgICAkU2VsZWN0ZWRWYWx1ZSA9ICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0RlZmF1bHRWYWx1ZX07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBpZiAoICEkU2VsZWN0ZWRWYWx1ZSApIHsKICAgICAgICAgICAgJFNlbGVjdGVkVmFsdWUgPSAkUHJpb3JpdHlPYmplY3QtPlByaW9yaXR5TG9va3VwKAogICAgICAgICAgICAgICAgUHJpb3JpdHlJRCA9PiAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntEZWZhdWx0VmFsdWV9IHx8ICcnLAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICAjIEdldCBUaWNrZXRWYWx1ZQogICAgaWYgKCBJc0hhc2hSZWZXaXRoRGF0YSggJFBhcmFte1RpY2tldH0gKSAmJiAhJFNlbGVjdGVkVmFsdWUgKSB7CiAgICAgICAgJFNlbGVjdGVkVmFsdWUgPSAkUGFyYW17VGlja2V0fS0+e1ByaW9yaXR5fTsKICAgIH0KCiAgICAjIHNldCBzZXJ2ZXIgZXJyb3JzCiAgICBteSAkU2VydmVyRXJyb3IgPSAnJzsKICAgIGlmICggSXNIYXNoUmVmV2l0aERhdGEoICRQYXJhbXtFcnJvcn0gKSAmJiAkUGFyYW17RXJyb3J9LT57J1ByaW9yaXR5SUQnfSApIHsKICAgICAgICAkU2VydmVyRXJyb3IgPSAnU2VydmVyRXJyb3InOwogICAgfQoKICAgIGlmICggJFNlbGYtPntMaW5rVGlja2V0RGF0YX0gKSB7CiAgICAgICAgJFNlbGVjdGVkVmFsdWUgPSAkU2VsZi0+e0xpbmtUaWNrZXREYXRhfS0+e1ByaW9yaXR5fTsKICAgIH0KCiAgICAjIGJ1aWxkIG5leHQgUHJpb3JpdGllcyBzdHJpbmcKICAgICREYXRhe0NvbnRlbnR9ID0gJExheW91dE9iamVjdC0+QnVpbGRTZWxlY3Rpb24oCiAgICAgICAgRGF0YSAgICAgICAgICA9PiAkUHJpb3JpdGllcywKICAgICAgICBOYW1lICAgICAgICAgID0+ICdQcmlvcml0eUlEJywKICAgICAgICBUcmFuc2xhdGlvbiAgID0+IDEsCiAgICAgICAgU2VsZWN0ZWRWYWx1ZSA9PiAkU2VsZWN0ZWRWYWx1ZSwKICAgICAgICBDbGFzcyAgICAgICAgID0+ICJNb2Rlcm5pemUgJFNlcnZlckVycm9yIiwKICAgICk7CgogICAgIyBzZW5kIGRhdGEgdG8gSlMKICAgICRMYXlvdXRPYmplY3QtPkFkZEpTRGF0YSgKICAgICAgICBLZXkgICA9PiAnUHJpb3JpdHlGaWVsZHNUb1VwZGF0ZScsCiAgICAgICAgVmFsdWUgPT4gJFBhcmFte0FKQVhVcGRhdGFibGVGaWVsZHN9CiAgICApOwoKICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgIE5hbWUgPT4gJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57TGF5b3V0QmxvY2t9IHx8ICdydzpQcmlvcml0eScsCiAgICAgICAgRGF0YSA9PiBcJURhdGEsCiAgICApOwoKICAgICMgc2V0IG1hbmRhdG9yeSBsYWJlbCBtYXJrZXIKICAgIGlmICggJERhdGF7TWFuZGF0b3J5Q2xhc3N9ICYmICREYXRhe01hbmRhdG9yeUNsYXNzfSBuZSAnJyApIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnTGFiZWxTcGFuJywKICAgICAgICAgICAgRGF0YSA9PiB7fSwKICAgICAgICApOwogICAgfQoKICAgIGlmICggJFBhcmFte0Rlc2NyaXB0aW9uU2hvcnR9ICkgewogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0xheW91dEJsb2NrfSB8fCAncnc6UHJpb3JpdHk6RGVzY3JpcHRpb25TaG9ydCcsCiAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgRGVzY3JpcHRpb25TaG9ydCA9PiAkUGFyYW17RGVzY3JpcHRpb25TaG9ydH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKICAgIH0KCiAgICBpZiAoICRQYXJhbXtEZXNjcmlwdGlvbkxvbmd9ICkgewogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdydzpQcmlvcml0eTpEZXNjcmlwdGlvbkxvbmcnLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgIERlc2NyaXB0aW9uTG9uZyA9PiAkUGFyYW17RGVzY3JpcHRpb25Mb25nfSwKICAgICAgICAgICAgfSwKICAgICAgICApOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgU3VjY2VzcyA9PiAxLAogICAgICAgIEhUTUwgICAgPT4gJExheW91dE9iamVjdC0+T3V0cHV0KCBUZW1wbGF0ZUZpbGUgPT4gJ1Byb2Nlc3NNYW5hZ2VtZW50L1ByaW9yaXR5JyApLAogICAgfTsKfQoKc3ViIF9SZW5kZXJRdWV1ZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgZ2V0IGxheW91dCBvYmplY3QKICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgZm9yIG15ICROZWVkZWQgKHF3KEZvcm1JRCkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBTdWNjZXNzID0+IDAsCiAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0KICAgICAgICAgICAgICAgICAgICAtPlRyYW5zbGF0ZSggJ1BhcmFtZXRlciAlcyBpcyBtaXNzaW5nIGluICVzLicsICROZWVkZWQsICdfUmVuZGVyUXVldWUnICksCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgfQogICAgaWYgKCAhSXNIYXNoUmVmV2l0aERhdGEoICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfSApICkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIFN1Y2Nlc3MgPT4gMCwKICAgICAgICAgICAgTWVzc2FnZSA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9CiAgICAgICAgICAgICAgICAtPlRyYW5zbGF0ZSggJ1BhcmFtZXRlciAlcyBpcyBtaXNzaW5nIGluICVzLicsICdBY3Rpdml0eURpYWxvZ0ZpZWxkJywgJ19SZW5kZXJRdWV1ZScgKSwKICAgICAgICB9OwogICAgfQoKICAgIG15ICRRdWV1ZXMgPSAkU2VsZi0+X0dldFF1ZXVlcygKICAgICAgICAleyAkUGFyYW17R2V0UGFyYW19IH0sCiAgICApOwoKICAgIG15ICVEYXRhID0gKAogICAgICAgIExhYmVsICAgICAgICAgICAgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCJUbyBxdWV1ZSIpLAogICAgICAgIEZpZWxkSUQgICAgICAgICAgPT4gJ1F1ZXVlSUQnLAogICAgICAgIEZvcm1JRCAgICAgICAgICAgPT4gJFBhcmFte0Zvcm1JRH0sCiAgICAgICAgTWFuZGF0b3J5Q2xhc3MgICA9PiAnJywKICAgICAgICBWYWxpZGF0ZVJlcXVpcmVkID0+ICcnLAogICAgKTsKCiAgICAjIElmIGZpZWxkIGlzIHJlcXVpcmVkIHB1dCBpbiB0aGUgbmVjZXNzYXJ5IHZhcmlhYmxlcyBmb3IKICAgICMgVmFsaWRhdGVSZXF1aXJlZCBjbGFzcyBpbnB1dCBmaWVsZCwgTWFuZGF0b3J5IGNsYXNzIGZvciB0aGUgbGFiZWwKICAgIGlmICggJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57RGlzcGxheX0gJiYgJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57RGlzcGxheX0gPT0gMiApIHsKICAgICAgICAkRGF0YXtWYWxpZGF0ZVJlcXVpcmVkfSA9ICdWYWxpZGF0ZV9SZXF1aXJlZCc7CiAgICAgICAgJERhdGF7TWFuZGF0b3J5Q2xhc3N9ICAgPSAnTWFuZGF0b3J5JzsKICAgIH0KICAgIG15ICRTZWxlY3RlZFZhbHVlOwoKICAgICMgZ2V0IHF1ZXVlIG9iamVjdAogICAgbXkgJFF1ZXVlT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlF1ZXVlJyk7CgogICAgIyBpZiB3ZSBnb3QgUXVldWVJRCBhcyBQYXJhbSBmcm9tIHRoZSBHVUkKICAgIG15ICRRdWV1ZUlEUGFyYW0gPSAkUGFyYW17R2V0UGFyYW19e1F1ZXVlSUR9OwogICAgaWYgKCRRdWV1ZUlEUGFyYW0pIHsKICAgICAgICAkU2VsZWN0ZWRWYWx1ZSA9ICRRdWV1ZU9iamVjdC0+UXVldWVMb29rdXAoCiAgICAgICAgICAgIFF1ZXVlSUQgPT4gJFF1ZXVlSURQYXJhbSwKICAgICAgICApOwogICAgfQoKICAgIGlmICggJFBhcmFte0ZpZWxkTmFtZX0gZXEgJ1F1ZXVlJyApIHsKCiAgICAgICAgaWYgKCAhJFNlbGVjdGVkVmFsdWUgKSB7CgogICAgICAgICAgICAjIEZldGNoIERlZmF1bHRWYWx1ZSBmcm9tIENvbmZpZwogICAgICAgICAgICAkU2VsZWN0ZWRWYWx1ZSA9ICRRdWV1ZU9iamVjdC0+UXVldWVMb29rdXAoCiAgICAgICAgICAgICAgICBRdWV1ZSA9PiAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntEZWZhdWx0VmFsdWV9IHx8ICcnLAogICAgICAgICAgICApOwogICAgICAgICAgICBpZiAoJFNlbGVjdGVkVmFsdWUpIHsKICAgICAgICAgICAgICAgICRTZWxlY3RlZFZhbHVlID0gJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57RGVmYXVsdFZhbHVlfTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGVsc2UgewogICAgICAgIGlmICggISRTZWxlY3RlZFZhbHVlICkgewogICAgICAgICAgICAkU2VsZWN0ZWRWYWx1ZSA9ICRRdWV1ZU9iamVjdC0+UXVldWVMb29rdXAoCiAgICAgICAgICAgICAgICBRdWV1ZUlEID0+ICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0RlZmF1bHRWYWx1ZX0gfHwgJycsCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgICMgR2V0IFRpY2tldFZhbHVlCiAgICBpZiAoIElzSGFzaFJlZldpdGhEYXRhKCAkUGFyYW17VGlja2V0fSApICYmICEkU2VsZWN0ZWRWYWx1ZSApIHsKICAgICAgICAkU2VsZWN0ZWRWYWx1ZSA9ICRQYXJhbXtUaWNrZXR9LT57UXVldWV9OwogICAgfQoKICAgICMgc2V0IHNlcnZlciBlcnJvcnMKICAgIG15ICRTZXJ2ZXJFcnJvciA9ICcnOwogICAgaWYgKCBJc0hhc2hSZWZXaXRoRGF0YSggJFBhcmFte0Vycm9yfSApICYmICRQYXJhbXtFcnJvcn0tPnsnUXVldWVJRCd9ICkgewogICAgICAgICRTZXJ2ZXJFcnJvciA9ICdTZXJ2ZXJFcnJvcic7CiAgICB9CgogICAgIyBnZXQgbGlzdCB0eXBlCiAgICBteSAkVHJlZVZpZXcgPSAwOwogICAgaWYgKCAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpLT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6Okxpc3RUeXBlJykgZXEgJ3RyZWUnICkgewogICAgICAgICRUcmVlVmlldyA9IDE7CiAgICB9CgogICAgaWYgKCAkU2VsZi0+e0xpbmtUaWNrZXREYXRhfSApIHsKICAgICAgICAkU2VsZWN0ZWRWYWx1ZSA9ICRTZWxmLT57TGlua1RpY2tldERhdGF9LT57UXVldWV9OwogICAgfQoKICAgICMgYnVpbGQgbmV4dCBxdWV1ZXMgc3RyaW5nCiAgICAkRGF0YXtDb250ZW50fSA9ICRMYXlvdXRPYmplY3QtPkJ1aWxkU2VsZWN0aW9uKAogICAgICAgIERhdGEgICAgICAgICAgPT4gJFF1ZXVlcywKICAgICAgICBOYW1lICAgICAgICAgID0+ICdRdWV1ZUlEJywKICAgICAgICBUcmFuc2xhdGlvbiAgID0+IDAsCiAgICAgICAgU2VsZWN0ZWRWYWx1ZSA9PiAkU2VsZWN0ZWRWYWx1ZSwKICAgICAgICBDbGFzcyAgICAgICAgID0+ICJNb2Rlcm5pemUgJFNlcnZlckVycm9yIiwKICAgICAgICBUcmVlVmlldyAgICAgID0+ICRUcmVlVmlldywKICAgICAgICBTb3J0ICAgICAgICAgID0+ICdUcmVlVmlldycsCiAgICAgICAgUG9zc2libGVOb25lICA9PiAxLAogICAgKTsKCiAgICAjIHNlbmQgZGF0YSB0byBKUwogICAgJExheW91dE9iamVjdC0+QWRkSlNEYXRhKAogICAgICAgIEtleSAgID0+ICdRdWV1ZUZpZWxkc1RvVXBkYXRlJywKICAgICAgICBWYWx1ZSA9PiAkUGFyYW17QUpBWFVwZGF0YWJsZUZpZWxkc30KICAgICk7CgogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntMYXlvdXRCbG9ja30gfHwgJ3J3OlF1ZXVlJywKICAgICAgICBEYXRhID0+IFwlRGF0YSwKICAgICk7CgogICAgIyBzZXQgbWFuZGF0b3J5IGxhYmVsIG1hcmtlcgogICAgaWYgKCAkRGF0YXtNYW5kYXRvcnlDbGFzc30gJiYgJERhdGF7TWFuZGF0b3J5Q2xhc3N9IG5lICcnICkgewogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdMYWJlbFNwYW4nLAogICAgICAgICAgICBEYXRhID0+IHt9LAogICAgICAgICk7CiAgICB9CgogICAgaWYgKCAkUGFyYW17RGVzY3JpcHRpb25TaG9ydH0gKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57TGF5b3V0QmxvY2t9IHx8ICdydzpRdWV1ZTpEZXNjcmlwdGlvblNob3J0JywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBEZXNjcmlwdGlvblNob3J0ID0+ICRQYXJhbXtEZXNjcmlwdGlvblNob3J0fSwKICAgICAgICAgICAgfSwKICAgICAgICApOwogICAgfQoKICAgIGlmICggJFBhcmFte0Rlc2NyaXB0aW9uTG9uZ30gKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ3J3OlF1ZXVlOkRlc2NyaXB0aW9uTG9uZycsCiAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgRGVzY3JpcHRpb25Mb25nID0+ICRQYXJhbXtEZXNjcmlwdGlvbkxvbmd9LAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgICBTdWNjZXNzID0+IDEsCiAgICAgICAgSFRNTCAgICA9PiAkTGF5b3V0T2JqZWN0LT5PdXRwdXQoIFRlbXBsYXRlRmlsZSA9PiAnUHJvY2Vzc01hbmFnZW1lbnQvUXVldWUnICksCiAgICB9Owp9CgpzdWIgX1JlbmRlckF0dGFjaG1lbnQgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwogICAgbXkgJENvbmZpZ09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CgogICAgTkVFREVEOgogICAgZm9yIG15ICROZWVkZWQgKHF3KEZvcm1JRCBBY3Rpdml0eURpYWxvZ0ZpZWxkKSkgewogICAgICAgIG5leHQgTkVFREVEIGlmIGRlZmluZWQgJFBhcmFteyROZWVkZWR9OwogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIFN1Y2Nlc3MgPT4gMCwKICAgICAgICAgICAgTWVzc2FnZSA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9CiAgICAgICAgICAgICAgICAtPlRyYW5zbGF0ZSggJ1BhcmFtZXRlciAlcyBpcyBtaXNzaW5nIGluICVzLicsICROZWVkZWQsICdfUmVuZGVyQXR0YWNobWVudCcgKSwKICAgICAgICB9OwogICAgfQoKICAgIGlmICggIUlzSGFzaFJlZldpdGhEYXRhKCAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0gKSApIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBTdWNjZXNzID0+IDAsCiAgICAgICAgICAgIE1lc3NhZ2UgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fQogICAgICAgICAgICAgICAgLT5UcmFuc2xhdGUoICdQYXJhbWV0ZXIgJXMgaXMgbWlzc2luZyBpbiAlcy4nLCAnQWN0aXZpdHlEaWFsb2dGaWVsZCcsICdfUmVuZGVyQXR0YWNobWVudCcgKSwKICAgICAgICB9OwogICAgfQoKICAgIG15ICRBdHRhY2htZW50TGlzdCA9ICRTZWxmLT5fR2V0QXR0YWNobWVudHMoCiAgICAgICAgJXsgJFBhcmFte0dldFBhcmFtfSB9CiAgICApOwoKICAgIG15ICVEYXRhID0gKAogICAgICAgIExhYmVsICAgICAgICAgICAgPT4gJ0F0dGFjaG1lbnRzJywKICAgICAgICBGaWVsZElEICAgICAgICAgID0+ICdBdHRhY2htZW50cycsCiAgICAgICAgRm9ybUlEICAgICAgICAgICA9PiAkUGFyYW17Rm9ybUlEfSwKICAgICAgICBNYW5kYXRvcnlDbGFzcyAgID0+ICcnLAogICAgICAgIFZhbGlkYXRlUmVxdWlyZWQgPT4gJycsCiAgICApOwoKICAgIGlmICgKICAgICAgICAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntEaXNwbGF5fQogICAgICAgICYmICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0Rpc3BsYXl9ID09IDIKICAgICAgICApCiAgICB7CiAgICAgICAgJERhdGF7VmFsaWRhdGVSZXF1aXJlZH0gPSAnVmFsaWRhdGVfUmVxdWlyZWQnOwogICAgICAgICREYXRhe01hbmRhdG9yeUNsYXNzfSAgID0gJ01hbmRhdG9yeSc7CiAgICB9CgogICAgbXkgJEF0dGFjaG1lbnRzRHluYW1pY0ZpZWxkTmFtZSA9ICRDb25maWdPYmplY3QtPkdldCgnUHJvY2Vzczo6RHluYW1pY0ZpZWxkUHJvY2Vzc01hbmFnZW1lbnRBdHRhY2htZW50Jyk7CgogICAgbXkgJEF0dGFjaG1lbnRzUGFyYW0gPSAkUGFyYW17R2V0UGFyYW19LT57ICdEeW5hbWljRmllbGRfJyAuICRBdHRhY2htZW50c0R5bmFtaWNGaWVsZE5hbWUgfTsKICAgIG15IEBTZWxlY3RlZEF0dGFjaG1lbnRzOwogICAgaWYgKCRBdHRhY2htZW50c1BhcmFtKSB7CiAgICAgICAgQFNlbGVjdGVkQXR0YWNobWVudHMgPSBzcGxpdCggJywnLCAkQXR0YWNobWVudHNQYXJhbSApOwogICAgfQoKICAgICREYXRhe0NvbnRlbnR9ID0gJExheW91dE9iamVjdC0+QnVpbGRTZWxlY3Rpb24oCiAgICAgICAgRGF0YSAgICAgICAgPT4gJEF0dGFjaG1lbnRMaXN0LAogICAgICAgIE5hbWUgICAgICAgID0+ICdBdHRhY2htZW50cycsCiAgICAgICAgVHJhbnNsYXRpb24gPT4gMCwKICAgICAgICBTZWxlY3RlZElEICA9PiBcQFNlbGVjdGVkQXR0YWNobWVudHMsCiAgICAgICAgTXVsdGlwbGUgICAgPT4gMSwKICAgICAgICBDbGFzcyAgICAgICA9PiAiTW9kZXJuaXplICREYXRhe1ZhbGlkYXRlUmVxdWlyZWR9IiwKICAgICk7CgogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntMYXlvdXRCbG9ja30gLy8gJ3J3OkF0dGFjaG1lbnQnLAogICAgICAgIERhdGEgPT4gXCVEYXRhLAogICAgKTsKCiAgICBpZiAoICREYXRhe01hbmRhdG9yeUNsYXNzfSAmJiAkRGF0YXtNYW5kYXRvcnlDbGFzc30gbmUgJycgKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ0xhYmVsU3BhbicsCiAgICAgICAgKTsKICAgIH0KCiAgICAkUGFyYW17RGVzY3JpcHRpb25TaG9ydH0gLy89ICdBdHRhY2htZW50cyB0byBiZSBwcm9wYWdhdGVkIHRvIGEgc3VidGlja2V0IG9uIGNyZWF0aW9uLic7CgogICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgTmFtZSA9PiAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntMYXlvdXRCbG9ja30gLy8gJ3J3OkF0dGFjaG1lbnQ6RGVzY3JpcHRpb25TaG9ydCcsCiAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgIERlc2NyaXB0aW9uU2hvcnQgPT4gJFBhcmFte0Rlc2NyaXB0aW9uU2hvcnR9LAogICAgICAgIH0sCiAgICApOwoKICAgIGlmICggJFBhcmFte0Rlc2NyaXB0aW9uTG9uZ30gKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ3J3OkF0dGFjaG1lbnQ6RGVzY3JpcHRpb25Mb25nJywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBEZXNjcmlwdGlvbkxvbmcgPT4gJFBhcmFte0Rlc2NyaXB0aW9uTG9uZ30sCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIFN1Y2Nlc3MgPT4gMSwKICAgICAgICBIVE1MICAgID0+ICRMYXlvdXRPYmplY3QtPk91dHB1dCggVGVtcGxhdGVGaWxlID0+ICdQcm9jZXNzTWFuYWdlbWVudC9BdHRhY2htZW50JyApLAogICAgfTsKfQoKc3ViIF9SZW5kZXJTdGF0ZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgZ2V0IGxheW91dCBvYmplY3QKICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgZm9yIG15ICROZWVkZWQgKHF3KEZvcm1JRCkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBTdWNjZXNzID0+IDAsCiAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0KICAgICAgICAgICAgICAgICAgICAtPlRyYW5zbGF0ZSggJ1BhcmFtZXRlciAlcyBpcyBtaXNzaW5nIGluICVzLicsICROZWVkZWQsICdfUmVuZGVyU3RhdGUnICksCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgfQogICAgaWYgKCAhSXNIYXNoUmVmV2l0aERhdGEoICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfSApICkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIFN1Y2Nlc3MgPT4gMCwKICAgICAgICAgICAgTWVzc2FnZSA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9CiAgICAgICAgICAgICAgICAtPlRyYW5zbGF0ZSggJ1BhcmFtZXRlciAlcyBpcyBtaXNzaW5nIGluICVzLicsICdBY3Rpdml0eURpYWxvZ0ZpZWxkJywgJ19SZW5kZXJTdGF0ZScgKSwKICAgICAgICB9OwogICAgfQoKICAgIG15ICRTdGF0ZXMgPSAkU2VsZi0+X0dldFN0YXRlcyggJXsgJFBhcmFte0dldFBhcmFtfSB9ICk7CgogICAgbXkgJURhdGEgPSAoCiAgICAgICAgTGFiZWwgICAgICAgICAgICA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoIk5leHQgdGlja2V0IHN0YXRlIiksCiAgICAgICAgRmllbGRJRCAgICAgICAgICA9PiAnU3RhdGVJRCcsCiAgICAgICAgRm9ybUlEICAgICAgICAgICA9PiAkUGFyYW17Rm9ybUlEfSwKICAgICAgICBNYW5kYXRvcnlDbGFzcyAgID0+ICcnLAogICAgICAgIFZhbGlkYXRlUmVxdWlyZWQgPT4gJycsCiAgICApOwoKICAgICMgSWYgZmllbGQgaXMgcmVxdWlyZWQgcHV0IGluIHRoZSBuZWNlc3NhcnkgdmFyaWFibGVzIGZvcgogICAgIyBWYWxpZGF0ZVJlcXVpcmVkIGNsYXNzIGlucHV0IGZpZWxkLCBNYW5kYXRvcnkgY2xhc3MgZm9yIHRoZSBsYWJlbAogICAgaWYgKCAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntEaXNwbGF5fSAmJiAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntEaXNwbGF5fSA9PSAyICkgewogICAgICAgICREYXRhe1ZhbGlkYXRlUmVxdWlyZWR9ID0gJ1ZhbGlkYXRlX1JlcXVpcmVkJzsKICAgICAgICAkRGF0YXtNYW5kYXRvcnlDbGFzc30gICA9ICdNYW5kYXRvcnknOwogICAgfQogICAgbXkgJFNlbGVjdGVkVmFsdWU7CgogICAgIyBnZXQgc3RhdGUgb2JqZWN0CiAgICBteSAkU3RhdGVPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6U3RhdGUnKTsKCiAgICBteSAkU3RhdGVJRFBhcmFtID0gJFBhcmFte0dldFBhcmFtfXtTdGF0ZUlEfTsKICAgIGlmICgkU3RhdGVJRFBhcmFtKSB7CiAgICAgICAgJFNlbGVjdGVkVmFsdWUgPSAkU3RhdGVPYmplY3QtPlN0YXRlTG9va3VwKCBTdGF0ZUlEID0+ICRTdGF0ZUlEUGFyYW0gKTsKICAgIH0KCiAgICBpZiAoICRQYXJhbXtGaWVsZE5hbWV9IGVxICdTdGF0ZScgKSB7CgogICAgICAgIGlmICggISRTZWxlY3RlZFZhbHVlICkgewoKICAgICAgICAgICAgIyBGZXRjaCBEZWZhdWx0VmFsdWUgZnJvbSBDb25maWcKICAgICAgICAgICAgJFNlbGVjdGVkVmFsdWUgPSAkU3RhdGVPYmplY3QtPlN0YXRlTG9va3VwKAogICAgICAgICAgICAgICAgU3RhdGUgPT4gJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57RGVmYXVsdFZhbHVlfSB8fCAnJywKICAgICAgICAgICAgKTsKICAgICAgICAgICAgaWYgKCRTZWxlY3RlZFZhbHVlKSB7CiAgICAgICAgICAgICAgICAkU2VsZWN0ZWRWYWx1ZSA9ICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0RlZmF1bHRWYWx1ZX07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBpZiAoICEkU2VsZWN0ZWRWYWx1ZSApIHsKICAgICAgICAgICAgJFNlbGVjdGVkVmFsdWUgPSAkU3RhdGVPYmplY3QtPlN0YXRlTG9va3VwKAogICAgICAgICAgICAgICAgU3RhdGVJRCA9PiAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntEZWZhdWx0VmFsdWV9IHx8ICcnLAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICAjIEdldCBUaWNrZXRWYWx1ZQogICAgaWYgKCBJc0hhc2hSZWZXaXRoRGF0YSggJFBhcmFte1RpY2tldH0gKSAmJiAhJFNlbGVjdGVkVmFsdWUgKSB7CiAgICAgICAgJFNlbGVjdGVkVmFsdWUgPSAkUGFyYW17VGlja2V0fS0+e1N0YXRlfTsKICAgIH0KCiAgICAjIHNldCBzZXJ2ZXIgZXJyb3JzCiAgICBteSAkU2VydmVyRXJyb3IgPSAnJzsKICAgIGlmICggSXNIYXNoUmVmV2l0aERhdGEoICRQYXJhbXtFcnJvcn0gKSAmJiAkUGFyYW17RXJyb3J9LT57J1N0YXRlSUQnfSApIHsKICAgICAgICAkU2VydmVyRXJyb3IgPSAnU2VydmVyRXJyb3InOwogICAgfQoKICAgICMgYnVpbGQgbmV4dCBzdGF0ZXMgc3RyaW5nCiAgICAkRGF0YXtDb250ZW50fSA9ICRMYXlvdXRPYmplY3QtPkJ1aWxkU2VsZWN0aW9uKAogICAgICAgIERhdGEgICAgICAgICAgPT4gJFN0YXRlcywKICAgICAgICBOYW1lICAgICAgICAgID0+ICdTdGF0ZUlEJywKICAgICAgICBUcmFuc2xhdGlvbiAgID0+IDEsCiAgICAgICAgU2VsZWN0ZWRWYWx1ZSA9PiAkU2VsZWN0ZWRWYWx1ZSwKICAgICAgICBDbGFzcyAgICAgICAgID0+ICJNb2Rlcm5pemUgJFNlcnZlckVycm9yIiwKICAgICk7CgogICAgIyBzZW5kIGRhdGEgdG8gSlMKICAgICRMYXlvdXRPYmplY3QtPkFkZEpTRGF0YSgKICAgICAgICBLZXkgICA9PiAnU3RhdGVGaWVsZHNUb1VwZGF0ZScsCiAgICAgICAgVmFsdWUgPT4gJFBhcmFte0FKQVhVcGRhdGFibGVGaWVsZHN9CiAgICApOwoKICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgIE5hbWUgPT4gJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57TGF5b3V0QmxvY2t9IHx8ICdydzpTdGF0ZScsCiAgICAgICAgRGF0YSA9PiBcJURhdGEsCiAgICApOwoKICAgICMgc2V0IG1hbmRhdG9yeSBsYWJlbCBtYXJrZXIKICAgIGlmICggJERhdGF7TWFuZGF0b3J5Q2xhc3N9ICYmICREYXRhe01hbmRhdG9yeUNsYXNzfSBuZSAnJyApIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnTGFiZWxTcGFuJywKICAgICAgICAgICAgRGF0YSA9PiB7fSwKICAgICAgICApOwogICAgfQoKICAgIGlmICggJFBhcmFte0Rlc2NyaXB0aW9uU2hvcnR9ICkgewogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0xheW91dEJsb2NrfSB8fCAncnc6U3RhdGU6RGVzY3JpcHRpb25TaG9ydCcsCiAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgRGVzY3JpcHRpb25TaG9ydCA9PiAkUGFyYW17RGVzY3JpcHRpb25TaG9ydH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKICAgIH0KCiAgICBpZiAoICRQYXJhbXtEZXNjcmlwdGlvbkxvbmd9ICkgewogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdydzpTdGF0ZTpEZXNjcmlwdGlvbkxvbmcnLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgIERlc2NyaXB0aW9uTG9uZyA9PiAkUGFyYW17RGVzY3JpcHRpb25Mb25nfSwKICAgICAgICAgICAgfSwKICAgICAgICApOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgU3VjY2VzcyA9PiAxLAogICAgICAgIEhUTUwgICAgPT4gJExheW91dE9iamVjdC0+T3V0cHV0KCBUZW1wbGF0ZUZpbGUgPT4gJ1Byb2Nlc3NNYW5hZ2VtZW50L1N0YXRlJyApLAogICAgfTsKfQoKc3ViIF9SZW5kZXJUeXBlIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBnZXQgbGF5b3V0IG9iamVjdAogICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKCiAgICBmb3IgbXkgJE5lZWRlZCAocXcoRm9ybUlEKSkgewogICAgICAgIGlmICggISRQYXJhbXskTmVlZGVkfSApIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIFN1Y2Nlc3MgPT4gMCwKICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fQogICAgICAgICAgICAgICAgICAgIC0+VHJhbnNsYXRlKCAnUGFyYW1ldGVyICVzIGlzIG1pc3NpbmcgaW4gJXMuJywgJE5lZWRlZCwgJ19SZW5kZXJUeXBlJyApLAogICAgICAgICAgICB9OwogICAgICAgIH0KICAgIH0KICAgIGlmICggIUlzSGFzaFJlZldpdGhEYXRhKCAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0gKSApIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBTdWNjZXNzID0+IDAsCiAgICAgICAgICAgIE1lc3NhZ2UgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fQogICAgICAgICAgICAgICAgLT5UcmFuc2xhdGUoICdQYXJhbWV0ZXIgJXMgaXMgbWlzc2luZyBpbiAlcy4nLCAnQWN0aXZpdHlEaWFsb2dGaWVsZCcsICdfUmVuZGVyVHlwZScgKSwKICAgICAgICB9OwogICAgfQoKICAgIG15ICRUeXBlcyA9ICRTZWxmLT5fR2V0VHlwZXMoCiAgICAgICAgJXsgJFBhcmFte0dldFBhcmFtfSB9LAogICAgKTsKCiAgICBteSAlRGF0YSA9ICgKICAgICAgICBMYWJlbCAgICAgICAgICAgID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgiVHlwZSIpLAogICAgICAgIEZpZWxkSUQgICAgICAgICAgPT4gJ1R5cGVJRCcsCiAgICAgICAgRm9ybUlEICAgICAgICAgICA9PiAkUGFyYW17Rm9ybUlEfSwKICAgICAgICBNYW5kYXRvcnlDbGFzcyAgID0+ICcnLAogICAgICAgIFZhbGlkYXRlUmVxdWlyZWQgPT4gJycsCiAgICApOwoKICAgICMgSWYgZmllbGQgaXMgcmVxdWlyZWQgcHV0IGluIHRoZSBuZWNlc3NhcnkgdmFyaWFibGVzIGZvcgogICAgIyBWYWxpZGF0ZVJlcXVpcmVkIGNsYXNzIGlucHV0IGZpZWxkLCBNYW5kYXRvcnkgY2xhc3MgZm9yIHRoZSBsYWJlbAogICAgaWYgKCAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntEaXNwbGF5fSAmJiAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntEaXNwbGF5fSA9PSAyICkgewogICAgICAgICREYXRhe1ZhbGlkYXRlUmVxdWlyZWR9ID0gJ1ZhbGlkYXRlX1JlcXVpcmVkJzsKICAgICAgICAkRGF0YXtNYW5kYXRvcnlDbGFzc30gICA9ICdNYW5kYXRvcnknOwogICAgfQoKICAgIG15ICRTZWxlY3RlZFZhbHVlOwoKICAgICMgZ2V0IHR5cGUgb2JqZWN0CiAgICBteSAkVHlwZU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpUeXBlJyk7CgogICAgbXkgJFR5cGVJRFBhcmFtID0gJFBhcmFte0dldFBhcmFtfXtUeXBlSUR9OwogICAgaWYgKCRUeXBlSURQYXJhbSkgewogICAgICAgICRTZWxlY3RlZFZhbHVlID0gJFR5cGVPYmplY3QtPlR5cGVMb29rdXAoCiAgICAgICAgICAgIFR5cGVJRCA9PiAkVHlwZUlEUGFyYW0sCiAgICAgICAgKTsKICAgIH0KCiAgICBpZiAoICRQYXJhbXtGaWVsZE5hbWV9IGVxICdUeXBlJyApIHsKCiAgICAgICAgaWYgKCAhJFNlbGVjdGVkVmFsdWUgKSB7CgogICAgICAgICAgICAjIEZldGNoIERlZmF1bHRWYWx1ZSBmcm9tIENvbmZpZwogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICBkZWZpbmVkICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0RlZmF1bHRWYWx1ZX0KICAgICAgICAgICAgICAgICYmICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0RlZmF1bHRWYWx1ZX0gbmUgJycKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJFNlbGVjdGVkVmFsdWUgPSAkVHlwZU9iamVjdC0+VHlwZUxvb2t1cCgKICAgICAgICAgICAgICAgICAgICBUeXBlID0+ICRQYXJhbXtBY3Rpdml0eURpYWxvZ0ZpZWxkfS0+e0RlZmF1bHRWYWx1ZX0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgkU2VsZWN0ZWRWYWx1ZSkgewogICAgICAgICAgICAgICAgJFNlbGVjdGVkVmFsdWUgPSAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZH0tPntEZWZhdWx0VmFsdWV9OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgZWxzZSB7CiAgICAgICAgaWYgKCAhJFNlbGVjdGVkVmFsdWUgKSB7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIGRlZmluZWQgJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57RGVmYXVsdFZhbHVlfQogICAgICAgICAgICAgICAgJiYgJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57RGVmYXVsdFZhbHVlfSBuZSAnJwogICAgICAgICAgICAgICAgKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkU2VsZWN0ZWRWYWx1ZSA9ICRUeXBlT2JqZWN0LT5UeXBlTG9va3VwKAogICAgICAgICAgICAgICAgICAgIFR5cGUgPT4gJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57RGVmYXVsdFZhbHVlfSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgIyBHZXQgVGlja2V0VmFsdWUKICAgIGlmICggSXNIYXNoUmVmV2l0aERhdGEoICRQYXJhbXtUaWNrZXR9ICkgJiYgISRTZWxlY3RlZFZhbHVlICkgewogICAgICAgICRTZWxlY3RlZFZhbHVlID0gJFBhcmFte1RpY2tldH0tPntUeXBlfTsKICAgIH0KCiAgICAjIHNldCBzZXJ2ZXIgZXJyb3JzCiAgICBteSAkU2VydmVyRXJyb3IgPSAnJzsKICAgIGlmICggSXNIYXNoUmVmV2l0aERhdGEoICRQYXJhbXtFcnJvcn0gKSAmJiAkUGFyYW17RXJyb3J9LT57J1R5cGVJRCd9ICkgewogICAgICAgICRTZXJ2ZXJFcnJvciA9ICdTZXJ2ZXJFcnJvcic7CiAgICB9CgogICAgaWYgKCAkU2VsZi0+e0xpbmtUaWNrZXREYXRhfSApIHsKICAgICAgICAkU2VsZWN0ZWRWYWx1ZSA9ICRTZWxmLT57TGlua1RpY2tldERhdGF9LT57VHlwZX07CiAgICB9CgogICAgIyBidWlsZCBTZXJ2aWNlIHN0cmluZwogICAgJERhdGF7Q29udGVudH0gPSAkTGF5b3V0T2JqZWN0LT5CdWlsZFNlbGVjdGlvbigKICAgICAgICBEYXRhICAgICAgICAgID0+ICRUeXBlcywKICAgICAgICBOYW1lICAgICAgICAgID0+ICdUeXBlSUQnLAogICAgICAgIENsYXNzICAgICAgICAgPT4gIk1vZGVybml6ZSAkU2VydmVyRXJyb3IiLAogICAgICAgIFNlbGVjdGVkVmFsdWUgPT4gJFNlbGVjdGVkVmFsdWUsCiAgICAgICAgUG9zc2libGVOb25lICA9PiAxLAogICAgICAgIFNvcnQgICAgICAgICAgPT4gJ0FscGhhbnVtZXJpY1ZhbHVlJywKICAgICAgICBUcmFuc2xhdGlvbiAgID0+IDAsCiAgICAgICAgTWF4ICAgICAgICAgICA9PiAyMDAsCiAgICApOwoKICAgICMgc2VuZCBkYXRhIHRvIEpTCiAgICAkTGF5b3V0T2JqZWN0LT5BZGRKU0RhdGEoCiAgICAgICAgS2V5ICAgPT4gJ1R5cGVGaWVsZHNUb1VwZGF0ZScsCiAgICAgICAgVmFsdWUgPT4gJFBhcmFte0FKQVhVcGRhdGFibGVGaWVsZHN9CiAgICApOwoKICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgIE5hbWUgPT4gJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57TGF5b3V0QmxvY2t9IHx8ICdydzpUeXBlJywKICAgICAgICBEYXRhID0+IFwlRGF0YSwKICAgICk7CgogICAgIyBzZXQgbWFuZGF0b3J5IGxhYmVsIG1hcmtlcgogICAgaWYgKCAkRGF0YXtNYW5kYXRvcnlDbGFzc30gJiYgJERhdGF7TWFuZGF0b3J5Q2xhc3N9IG5lICcnICkgewogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdMYWJlbFNwYW4nLAogICAgICAgICAgICBEYXRhID0+IHt9LAogICAgICAgICk7CiAgICB9CgogICAgaWYgKCAkUGFyYW17RGVzY3JpcHRpb25TaG9ydH0gKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJFBhcmFte0FjdGl2aXR5RGlhbG9nRmllbGR9LT57TGF5b3V0QmxvY2t9IHx8ICdydzpUeXBlOkRlc2NyaXB0aW9uU2hvcnQnLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgIERlc2NyaXB0aW9uU2hvcnQgPT4gJFBhcmFte0Rlc2NyaXB0aW9uU2hvcnR9LAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICB9CgogICAgaWYgKCAkUGFyYW17RGVzY3JpcHRpb25Mb25nfSApIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAncnc6VHlwZTpEZXNjcmlwdGlvbkxvbmcnLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgIERlc2NyaXB0aW9uTG9uZyA9PiAkUGFyYW17RGVzY3JpcHRpb25Mb25nfSwKICAgICAgICAgICAgfSwKICAgICAgICApOwogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgU3VjY2VzcyA9PiAxLAogICAgICAgIEhUTUwgICAgPT4gJExheW91dE9iamVjdC0+T3V0cHV0KCBUZW1wbGF0ZUZpbGUgPT4gJ1Byb2Nlc3NNYW5hZ2VtZW50L1R5cGUnICksCiAgICB9Owp9CgpzdWIgX1N0b3JlQWN0aXZpdHlEaWFsb2cgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkVGlja2V0SUQgPSAkUGFyYW17R2V0UGFyYW19LT57VGlja2V0SUR9OwogICAgbXkgJFByb2Nlc3NTdGFydHBvaW50OwogICAgbXkgJVRpY2tldDsKICAgIG15ICRQcm9jZXNzRW50aXR5SUQ7CiAgICBteSAkQWN0aXZpdHlFbnRpdHlJRDsKICAgIG15ICVFcnJvcjsKICAgIG15ICVFcnJvck1lc3NhZ2VzOwoKICAgIG15ICVUaWNrZXRQYXJhbTsKCiAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwogICAgbXkgJENvbmZpZ09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CgogICAgbXkgJEFjdGl2aXR5RGlhbG9nRW50aXR5SUQgPSAkUGFyYW17R2V0UGFyYW19LT57QWN0aXZpdHlEaWFsb2dFbnRpdHlJRH07CiAgICBpZiAoICEkQWN0aXZpdHlEaWFsb2dFbnRpdHlJRCApIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5GYXRhbEVycm9yKAogICAgICAgICAgICBNZXNzYWdlID0+IFRyYW5zbGF0YWJsZSgnQWN0aXZpdHlEaWFsb2dFbnRpdHlJRCBtaXNzaW5nIScpLAogICAgICAgICk7CiAgICB9CgogICAgIyBnZXQgYWN0aXZpdHkgZGlhbG9nIG9iamVjdAogICAgbXkgJEFjdGl2aXR5RGlhbG9nT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlByb2Nlc3NNYW5hZ2VtZW50OjpBY3Rpdml0eURpYWxvZycpOwogICAgbXkgJEFjdGl2aXR5RGlhbG9nICAgICAgID0gJEFjdGl2aXR5RGlhbG9nT2JqZWN0LT5BY3Rpdml0eURpYWxvZ0dldCgKICAgICAgICBBY3Rpdml0eURpYWxvZ0VudGl0eUlEID0+ICRBY3Rpdml0eURpYWxvZ0VudGl0eUlELAogICAgICAgIEludGVyZmFjZSAgICAgICAgICAgICAgPT4gJ0FnZW50SW50ZXJmYWNlJywKICAgICk7CgogICAgaWYgKCAhSXNIYXNoUmVmV2l0aERhdGEoJEFjdGl2aXR5RGlhbG9nKSApIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5GYXRhbEVycm9yKAogICAgICAgICAgICBNZXNzYWdlID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgKICAgICAgICAgICAgICAgICdDb3VsZG5cJ3QgZ2V0IENvbmZpZyBmb3IgQWN0aXZpdHlEaWFsb2dFbnRpdHlJRCAiJXMiIScsCiAgICAgICAgICAgICAgICAkQWN0aXZpdHlEaWFsb2dFbnRpdHlJRCwKICAgICAgICAgICAgKSwKICAgICAgICApOwogICAgfQoKICAgICMgZ2V0IHBhcmFtIG9iamVjdAogICAgbXkgJFBhcmFtT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OldlYjo6UmVxdWVzdCcpOwoKICAgICMgZ2V0IHVwbG9hZCBjYWNoZSBvYmplY3QKICAgIG15ICRVcGxvYWRDYWNoZU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpXZWI6OlVwbG9hZENhY2hlJyk7CgogICAgbXkgJER5bmFtaWNGaWVsZCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEeW5hbWljRmllbGQnKS0+RHluYW1pY0ZpZWxkTGlzdEdldCgKICAgICAgICBWYWxpZCAgICAgID0+IDEsCiAgICAgICAgT2JqZWN0VHlwZSA9PiAnVGlja2V0JywKICAgICk7CgogICAgIyBnZXQgZHluYW1pYyBmaWVsZCBiYWNrZW5kIG9iamVjdAogICAgbXkgJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6RHluYW1pY0ZpZWxkOjpCYWNrZW5kJyk7CgogICAgIyBjaGVjayBlYWNoIEZpZWxkIG9mIGFuIEFjdGl2aXR5IERpYWxvZyBhbmQgZmlsbCB0aGUgZXJyb3IgaGFzaCBpZiBzb21ldGhpbmcgZ29lcyBob3JyaWJseSB3cm9uZwogICAgbXkgJUNoZWNrZWRGaWVsZHM7CiAgICBESUFMT0dGSUVMRDoKICAgIGZvciBteSAkQ3VycmVudEZpZWxkICggQHsgJEFjdGl2aXR5RGlhbG9nLT57RmllbGRPcmRlcn0gfSApIHsKICAgICAgICBpZiAoICRDdXJyZW50RmllbGQgPX4gbXteRHluYW1pY0ZpZWxkXyguKil9eG1zICkgewogICAgICAgICAgICBteSAkRHluYW1pY0ZpZWxkTmFtZSA9ICQxOwoKICAgICAgICAgICAgIyBHZXQgdGhlIENvbmZpZyBvZiB0aGUgY3VycmVudCBEeW5hbWljRmllbGQgKHRoZSBmaXJzdCBlbGVtZW50IG9mIHRoZSBncmVwIHJlc3VsdCBhcnJheSkKICAgICAgICAgICAgbXkgJER5bmFtaWNGaWVsZENvbmZpZyA9ICggZ3JlcCB7ICRfLT57TmFtZX0gZXEgJER5bmFtaWNGaWVsZE5hbWUgfSBAeyREeW5hbWljRmllbGR9IClbMF07CgogICAgICAgICAgICBpZiAoICFJc0hhc2hSZWZXaXRoRGF0YSgkRHluYW1pY0ZpZWxkQ29uZmlnKSApIHsKCiAgICAgICAgICAgICAgICBteSAkTWVzc2FnZQogICAgICAgICAgICAgICAgICAgID0gIkR5bmFtaWNGaWVsZENvbmZpZyBtaXNzaW5nIGZvciBmaWVsZDogJFBhcmFte0ZpZWxkTmFtZX0sIG9yIGlzIG5vdCBhIFRpY2tldCBEeW5hbWljIEZpZWxkISI7CgogICAgICAgICAgICAgICAgIyBsb2cgZXJyb3IgYnV0IGRvZXMgbm90IHN0b3AgdGhlIGV4ZWN1dGlvbiBhcyBpdCBjb3VsZCBiZSBhbiBvbGQgQXJ0aWNsZQogICAgICAgICAgICAgICAgIyBEeW5hbWljRmllbGQsIHNlZSBidWcjMTE2NjYKICAgICAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gJE1lc3NhZ2UsCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgIG5leHQgRElBTE9HRklFTEQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgV2lsbCBiZSBleHRlbmRlZCBsYXRlciBvbiBmb3IgQUNMIENoZWNraW5nOgogICAgICAgICAgICBteSAkUG9zc2libGVWYWx1ZXNGaWx0ZXI7CgogICAgICAgICAgICAjIGlmIHdlIGhhdmUgYW4gaW52aXNpYmxlIGZpZWxkLCB1c2UgY29uZmlnJ3MgZGVmYXVsdCB2YWx1ZQogICAgICAgICAgICBpZiAoICRBY3Rpdml0eURpYWxvZy0+e0ZpZWxkc30tPnskQ3VycmVudEZpZWxkfS0+e0Rpc3BsYXl9ID09IDAgKSB7CiAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgZGVmaW5lZCAkQWN0aXZpdHlEaWFsb2ctPntGaWVsZHN9LT57JEN1cnJlbnRGaWVsZH0tPntEZWZhdWx0VmFsdWV9CiAgICAgICAgICAgICAgICAgICAgJiYgbGVuZ3RoICRBY3Rpdml0eURpYWxvZy0+e0ZpZWxkc30tPnskQ3VycmVudEZpZWxkfS0+e0RlZmF1bHRWYWx1ZX0KICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJFRpY2tldFBhcmFteyRDdXJyZW50RmllbGR9ID0gJEFjdGl2aXR5RGlhbG9nLT57RmllbGRzfS0+eyRDdXJyZW50RmllbGR9LT57RGVmYXVsdFZhbHVlfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRUaWNrZXRQYXJhbXskQ3VycmVudEZpZWxkfSA9ICcnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIG9ubHkgdmFsaWRhdGUgdmlzaWJsZSBmaWVsZHMKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAjIENoZWNrIER5bmFtaWNGaWVsZCBWYWx1ZXMKICAgICAgICAgICAgICAgIG15ICRWYWxpZGF0aW9uUmVzdWx0ID0gJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QtPkVkaXRGaWVsZFZhbHVlVmFsaWRhdGUoCiAgICAgICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnICAgPT4gJER5bmFtaWNGaWVsZENvbmZpZywKICAgICAgICAgICAgICAgICAgICBQb3NzaWJsZVZhbHVlc0ZpbHRlciA9PiAkUG9zc2libGVWYWx1ZXNGaWx0ZXIsCiAgICAgICAgICAgICAgICAgICAgUGFyYW1PYmplY3QgICAgICAgICAgPT4gJFBhcmFtT2JqZWN0LAogICAgICAgICAgICAgICAgICAgIE1hbmRhdG9yeSAgICAgICAgICAgID0+ICRBY3Rpdml0eURpYWxvZy0+e0ZpZWxkc30tPnskQ3VycmVudEZpZWxkfS0+e0Rpc3BsYXl9ID09IDIsCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgIGlmICggIUlzSGFzaFJlZldpdGhEYXRhKCRWYWxpZGF0aW9uUmVzdWx0KSApIHsKICAgICAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5GYXRhbEVycm9yKAogICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdDb3VsZCBub3QgcGVyZm9ybSB2YWxpZGF0aW9uIG9uIGZpZWxkICVzIScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRHluYW1pY0ZpZWxkQ29uZmlnLT57TGFiZWx9LAogICAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCAkVmFsaWRhdGlvblJlc3VsdC0+e1NlcnZlckVycm9yfSApIHsKICAgICAgICAgICAgICAgICAgICAkRXJyb3J7ICREeW5hbWljRmllbGRDb25maWctPntOYW1lfSB9ICAgICAgICAgPSAxOwogICAgICAgICAgICAgICAgICAgICRFcnJvck1lc3NhZ2VzeyAkRHluYW1pY0ZpZWxkQ29uZmlnLT57TmFtZX0gfSA9ICRWYWxpZGF0aW9uUmVzdWx0LT57RXJyb3JNZXNzYWdlfTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkVGlja2V0UGFyYW17JEN1cnJlbnRGaWVsZH0gPQogICAgICAgICAgICAgICAgICAgICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0LT5FZGl0RmllbGRWYWx1ZUdldCgKICAgICAgICAgICAgICAgICAgICBEeW5hbWljRmllbGRDb25maWcgPT4gJER5bmFtaWNGaWVsZENvbmZpZywKICAgICAgICAgICAgICAgICAgICBQYXJhbU9iamVjdCAgICAgICAgPT4gJFBhcmFtT2JqZWN0LAogICAgICAgICAgICAgICAgICAgIExheW91dE9iamVjdCAgICAgICA9PiAkTGF5b3V0T2JqZWN0LAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgSW4gY2FzZSBvZiBEeW5hbWljRmllbGRzIHRoZXJlIGlzIG5vIE5hbWVUb0lEIHRyYW5zbGF0aW9uCiAgICAgICAgICAgICMgc28ganVzdCB0YWtlIHRoZSBEeW5hbWljRmllbGQgbmFtZQogICAgICAgICAgICAkQ2hlY2tlZEZpZWxkc3skQ3VycmVudEZpZWxkfSA9IDE7CiAgICAgICAgfQogICAgICAgIGVsc2lmICgKICAgICAgICAgICAgJFNlbGYtPntOYW1lVG9JRH0tPnskQ3VycmVudEZpZWxkfSBlcSAnQ3VzdG9tZXJJRCcKICAgICAgICAgICAgfHwgJFNlbGYtPntOYW1lVG9JRH0tPnskQ3VycmVudEZpZWxkfSBlcSAnQ3VzdG9tZXJVc2VySUQnCiAgICAgICAgICAgICkKICAgICAgICB7CgogICAgICAgICAgICBuZXh0IERJQUxPR0ZJRUxEIGlmICRDaGVja2VkRmllbGRzeyAkU2VsZi0+e05hbWVUb0lEfS0+eydDdXN0b21lcklEJ30gfTsKCiAgICAgICAgICAgICMgaXMgbm90IHBvc3NpYmxlIHRvIGEgaGF2ZSBhbiBpbnZpc2libGUgZmllbGQgZm9yIHRoaXMgcGFydGljdWxhciB2YWx1ZQogICAgICAgICAgICAjIG9uIGFnZW50IGludGVyZmFjZQogICAgICAgICAgICBpZiAoICRBY3Rpdml0eURpYWxvZy0+e0ZpZWxkc30tPnskQ3VycmVudEZpZWxkfS0+e0Rpc3BsYXl9ID09IDAgKSB7CiAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5GYXRhbEVycm9yKAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gVHJhbnNsYXRhYmxlKCdDb3VsZG5cJ3QgdXNlIEN1c3RvbWVySUQgYXMgYW4gaW52aXNpYmxlIGZpZWxkLicpLAogICAgICAgICAgICAgICAgICAgIENvbW1lbnQgPT4gVHJhbnNsYXRhYmxlKCdQbGVhc2UgY29udGFjdCB0aGUgYWRtaW5pc3RyYXRvci4nKSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgQ3VzdG9tZXJJRCBzaG91bGQgbm90IGJlIG1hbmRhdG9yeSBhcyBpbiBvdGhlciBzY3JlZW5zCiAgICAgICAgICAgICRUaWNrZXRQYXJhbXtDdXN0b21lcklEfSA9ICRQYXJhbXtHZXRQYXJhbX0tPntDdXN0b21lcklEfSB8fCAnJzsKCiAgICAgICAgICAgICMgVW5mb3J0dW5hdGVseSBUaWNrZXRDcmVhdGUgbmVlZHMgJ0N1c3RvbWVyVXNlcicgYXMgcGFyYW0gaW5zdGVhZCBvZiAnQ3VzdG9tZXJVc2VySUQnCiAgICAgICAgICAgIG15ICRDdXN0b21lclVzZXJJRCA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdTZWxlY3RlZEN1c3RvbWVyVXNlcicgKTsKCiAgICAgICAgICAgICMgZmFsbC1iYWNrLCBpZiBjdXN0b21lciBhdXRvLWNvbXBsZXRlIGRvZXMgbm90IHNob3duIGFueSByZXN1bHRzLCB0aGVuIHRyeSB0byB1c2UKICAgICAgICAgICAgIyB0aGUgY29udGVudCBvZiB0aGUgb3JpZ2luYWwgZmllbGQgYXMgY3VzdG9tZXIgdXNlciBpZAogICAgICAgICAgICBpZiAoICEkQ3VzdG9tZXJVc2VySUQgKSB7CgogICAgICAgICAgICAgICAgJEN1c3RvbWVyVXNlcklEID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0N1c3RvbWVyVXNlcklEJyApOwoKICAgICAgICAgICAgICAgICMgY2hlY2sgZW1haWwgYWRkcmVzcwogICAgICAgICAgICAgICAgZm9yIG15ICRFbWFpbCAoIE1haWw6OkFkZHJlc3MtPnBhcnNlKCRDdXN0b21lclVzZXJJRCkgKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICAgICAhJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNoZWNrSXRlbScpLT5DaGVja0VtYWlsKCBBZGRyZXNzID0+ICRFbWFpbC0+YWRkcmVzcygpICkKICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgJEVycm9yeydDdXN0b21lclVzZXJJRCd9ID0gMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICggISRDdXN0b21lclVzZXJJRCApIHsKICAgICAgICAgICAgICAgICRFcnJvcnsnQ3VzdG9tZXJVc2VySUQnfSA9IDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkVGlja2V0UGFyYW17Q3VzdG9tZXJVc2VyfSA9ICRDdXN0b21lclVzZXJJRDsKICAgICAgICAgICAgfQogICAgICAgICAgICAkQ2hlY2tlZEZpZWxkc3sgJFNlbGYtPntOYW1lVG9JRH0tPnsnQ3VzdG9tZXJJRCd9IH0gICAgID0gMTsKICAgICAgICAgICAgJENoZWNrZWRGaWVsZHN7ICRTZWxmLT57TmFtZVRvSUR9LT57J0N1c3RvbWVyVXNlcklEJ30gfSA9IDE7CgogICAgICAgIH0KICAgICAgICBlbHNpZiAoICRDdXJyZW50RmllbGQgZXEgJ1BlbmRpbmdUaW1lJyApIHsKICAgICAgICAgICAgbXkgJFByZWZpeCA9ICdQZW5kaW5nVGltZSc7CgogICAgICAgICAgICAjIE1ha2Ugc3VyZSB3ZSBoYXZlIFZhbHVlcyBvdGhlcndpc2UgdGFrZSBhbiBlbXB0eSBzdHJpbmcKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgSXNIYXNoUmVmV2l0aERhdGEoICRQYXJhbXtHZXRQYXJhbX0tPntQZW5kaW5nVGltZX0gKQogICAgICAgICAgICAgICAgJiYgZGVmaW5lZCAkUGFyYW17R2V0UGFyYW19LT57UGVuZGluZ1RpbWV9LT57WWVhcn0KICAgICAgICAgICAgICAgICYmIGRlZmluZWQgJFBhcmFte0dldFBhcmFtfS0+e1BlbmRpbmdUaW1lfS0+e01vbnRofQogICAgICAgICAgICAgICAgJiYgZGVmaW5lZCAkUGFyYW17R2V0UGFyYW19LT57UGVuZGluZ1RpbWV9LT57RGF5fQogICAgICAgICAgICAgICAgJiYgZGVmaW5lZCAkUGFyYW17R2V0UGFyYW19LT57UGVuZGluZ1RpbWV9LT57SG91cn0KICAgICAgICAgICAgICAgICYmIGRlZmluZWQgJFBhcmFte0dldFBhcmFtfS0+e1BlbmRpbmdUaW1lfS0+e01pbnV0ZX0KICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJFRpY2tldFBhcmFteyRDdXJyZW50RmllbGR9ID0gJFBhcmFte0dldFBhcmFtfS0+e1BlbmRpbmdUaW1lfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBpZiB3ZSBoYXZlIG5vIFBlbmRpbmcgc3RhdHVzIHdlIGhhdmUgbm8gdGltZSB0byBzZXQKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkVGlja2V0UGFyYW17JEN1cnJlbnRGaWVsZH0gPSAnJzsKICAgICAgICAgICAgfQogICAgICAgICAgICAkQ2hlY2tlZEZpZWxkc3snUGVuZGluZ1RpbWUnfSA9IDE7CiAgICAgICAgfQoKICAgICAgICBlbHNlIHsKCiAgICAgICAgICAgICMgc2tpcCBpZiB3ZSd2ZSBhbHJlYWR5IGNoZWNrZWQgSUQgb3IgTmFtZQogICAgICAgICAgICBuZXh0IERJQUxPR0ZJRUxEIGlmICRDaGVja2VkRmllbGRzeyAkU2VsZi0+e05hbWVUb0lEfS0+eyRDdXJyZW50RmllbGR9IH07CgogICAgICAgICAgICBuZXh0IERJQUxPR0ZJRUxEIGlmICRDdXJyZW50RmllbGQgZXEgJ0F0dGFjaG1lbnRzJzsKCiAgICAgICAgICAgIG15ICRSZXN1bHQgPSAkU2VsZi0+X0NoZWNrRmllbGQoCiAgICAgICAgICAgICAgICBGaWVsZCA9PiAkU2VsZi0+e05hbWVUb0lEfS0+eyRDdXJyZW50RmllbGR9LAogICAgICAgICAgICAgICAgJXsgJEFjdGl2aXR5RGlhbG9nLT57RmllbGRzfXskQ3VycmVudEZpZWxkfSB9LAogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKCAhJFJlc3VsdCApIHsKCiAgICAgICAgICAgICAgICAjIHNwZWNpYWwgY2FzZSBmb3IgQXJ0aWNsZSAoU3ViamVjdCAmIEJvZHkpCiAgICAgICAgICAgICAgICBpZiAoICRDdXJyZW50RmllbGQgZXEgJ0FydGljbGUnICkgewogICAgICAgICAgICAgICAgICAgIGZvciBteSAkQXJ0aWNsZVBhcnQgKHF3KFN1YmplY3QgQm9keSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhJFBhcmFte0dldFBhcmFtfS0+eyRBcnRpY2xlUGFydH0gKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBzZXQgZXJyb3IgZm9yIGVhY2ggcGFydCAoaWYgYW55KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEVycm9yeyAnQXJ0aWNsZScgLiAkQXJ0aWNsZVBhcnQgfSA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyBhbGwgb3RoZXIgZmllbGRzCiAgICAgICAgICAgICAgICBlbHNpZiAoICRBY3Rpdml0eURpYWxvZy0+e0ZpZWxkc30tPnskQ3VycmVudEZpZWxkfS0+e0Rpc3BsYXl9ID09IDIgKSB7CiAgICAgICAgICAgICAgICAgICAgJEVycm9yeyAkU2VsZi0+e05hbWVUb0lEfS0+eyRDdXJyZW50RmllbGR9IH0gPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAkQ3VycmVudEZpZWxkIGVxICdBcnRpY2xlJwogICAgICAgICAgICAgICAgJiYgJEFjdGl2aXR5RGlhbG9nLT57RmllbGRzfS0+eyRDdXJyZW50RmllbGR9LT57Q29uZmlnfS0+e1RpbWVVbml0c30KICAgICAgICAgICAgICAgICYmICRBY3Rpdml0eURpYWxvZy0+e0ZpZWxkc30tPnskQ3VycmVudEZpZWxkfS0+e0NvbmZpZ30tPntUaW1lVW5pdHN9ID09IDIKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKCAhJFBhcmFte0dldFBhcmFtfS0+e1RpbWVVbml0c30gKSB7CgogICAgICAgICAgICAgICAgICAgICMgc2V0IGVycm9yIGZvciB0aGUgdGltZS11bml0cyAoaWYgYW55KQogICAgICAgICAgICAgICAgICAgICRFcnJvcnsnVGltZVVuaXRzJ30gPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBlbHNpZiAoJFJlc3VsdCkgewogICAgICAgICAgICAgICAgJFRpY2tldFBhcmFteyAkU2VsZi0+e05hbWVUb0lEfS0+eyRDdXJyZW50RmllbGR9IH0gPSAkUmVzdWx0OwogICAgICAgICAgICB9CiAgICAgICAgICAgICRDaGVja2VkRmllbGRzeyAkU2VsZi0+e05hbWVUb0lEfS0+eyRDdXJyZW50RmllbGR9IH0gPSAxOwogICAgICAgIH0KICAgIH0KCiAgICAjIGNyZWF0ZSBwcm9jZXNzIG9iamVjdAogICAgJEtlcm5lbDo6T00tPk9iamVjdFBhcmFtQWRkKAogICAgICAgICdLZXJuZWw6OlN5c3RlbTo6UHJvY2Vzc01hbmFnZW1lbnQ6OlByb2Nlc3MnID0+IHsKICAgICAgICAgICAgQWN0aXZpdHlPYmplY3QgICAgICAgICA9PiAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6UHJvY2Vzc01hbmFnZW1lbnQ6OkFjdGl2aXR5JyksCiAgICAgICAgICAgIEFjdGl2aXR5RGlhbG9nT2JqZWN0ICAgPT4gJEFjdGl2aXR5RGlhbG9nT2JqZWN0LAogICAgICAgICAgICBUcmFuc2l0aW9uT2JqZWN0ICAgICAgID0+ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpQcm9jZXNzTWFuYWdlbWVudDo6VHJhbnNpdGlvbicpLAogICAgICAgICAgICBUcmFuc2l0aW9uQWN0aW9uT2JqZWN0ID0+ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpQcm9jZXNzTWFuYWdlbWVudDo6VHJhbnNpdGlvbkFjdGlvbicpLAogICAgICAgIH0KICAgICk7CiAgICBteSAkUHJvY2Vzc09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpQcm9jZXNzTWFuYWdlbWVudDo6UHJvY2VzcycpOwoKICAgIG15ICRUaWNrZXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGlja2V0Jyk7CgogICAgbXkgQE5vdGlmeTsKCiAgICBteSAkTmV3VGlja2V0SUQ7CiAgICBteSAkTmV3T3duZXJJRDsKICAgIGlmICggISRUaWNrZXRJRCApIHsKCiAgICAgICAgJFByb2Nlc3NFbnRpdHlJRCA9ICRQYXJhbXtHZXRQYXJhbX0tPntQcm9jZXNzRW50aXR5SUR9OwogICAgICAgIGlmICggISRQcm9jZXNzRW50aXR5SUQgKQogICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPkZhdGFsRXJyb3IoCiAgICAgICAgICAgICAgICBNZXNzYWdlID0+IFRyYW5zbGF0YWJsZSgnTWlzc2luZyBQcm9jZXNzRW50aXR5SUQsIGNoZWNrIHlvdXIgQWN0aXZpdHlEaWFsb2dIZWFkZXIudHQhJyksCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAkUHJvY2Vzc1N0YXJ0cG9pbnQgPSAkUHJvY2Vzc09iamVjdC0+UHJvY2Vzc1N0YXJ0cG9pbnRHZXQoCiAgICAgICAgICAgIFByb2Nlc3NFbnRpdHlJRCA9PiAkUGFyYW17UHJvY2Vzc0VudGl0eUlEfSwKICAgICAgICApOwoKICAgICAgICBpZiAoCiAgICAgICAgICAgICEkUHJvY2Vzc1N0YXJ0cG9pbnQKICAgICAgICAgICAgfHwgIUlzSGFzaFJlZldpdGhEYXRhKCRQcm9jZXNzU3RhcnRwb2ludCkKICAgICAgICAgICAgfHwgISRQcm9jZXNzU3RhcnRwb2ludC0+e0FjdGl2aXR5fSB8fCAhJFByb2Nlc3NTdGFydHBvaW50LT57QWN0aXZpdHlEaWFsb2d9CiAgICAgICAgICAgICkKICAgICAgICB7CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkZhdGFsRXJyb3IoCiAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgKICAgICAgICAgICAgICAgICAgICAnTm8gU3RhcnRBY3Rpdml0eURpYWxvZyBvciBTdGFydEFjdGl2aXR5RGlhbG9nIGZvciBQcm9jZXNzICIlcyIgY29uZmlndXJlZCEnLAogICAgICAgICAgICAgICAgICAgICRQYXJhbXtQcm9jZXNzRW50aXR5SUR9LAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICRBY3Rpdml0eUVudGl0eUlEID0gJFByb2Nlc3NTdGFydHBvaW50LT57QWN0aXZpdHl9OwoKICAgICAgICBmb3IgbXkgJE5lZWRlZCAocXcoUXVldWUgU3RhdGUgTG9jayBQcmlvcml0eSkpIHsKCiAgICAgICAgICAgIGlmICggISRUaWNrZXRQYXJhbXsgJFNlbGYtPntOYW1lVG9JRH0tPnskTmVlZGVkfSB9ICkgewoKICAgICAgICAgICAgICAgICMgaWYgYSByZXF1aXJlZCBmaWVsZCBoYXMgbm8gdmFsdWUgY2FsbCBfQ2hlY2tGaWVsZCBhcyBmaWxlZCBpcyBoaWRkZW4KICAgICAgICAgICAgICAgICMgKE5vIERpc3BsYXkgcGFyYW0gPSBEaXNwbGF5ID0+IDApIGFuZCBubyBEZWZhdWx0VmFsdWUsIHRvIHVzZSBnbG9iYWwgZGVmYXVsdCBhcwogICAgICAgICAgICAgICAgIyBmYWxsLWJhY2suIE9uZSByZWFzb24gZm9yIHRoaXMgdG8gaGFwcGVuIGlzIHRoYXQgQWN0aXZpdHlEaWFsb2cgRGVmYXVsdFZhbHVlIHRyaWVkCiAgICAgICAgICAgICAgICAjIHRvIHNldCBiZWZvcmUsIHdhcyBub3QgdmFsaWQuCiAgICAgICAgICAgICAgICBteSAkUmVzdWx0ID0gJFNlbGYtPl9DaGVja0ZpZWxkKAogICAgICAgICAgICAgICAgICAgIEZpZWxkID0+ICRTZWxmLT57TmFtZVRvSUR9LT57JE5lZWRlZH0sCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgIGlmICggISRSZXN1bHQgKSB7CiAgICAgICAgICAgICAgICAgICAgJEVycm9yeyAkU2VsZi0+e05hbWVUb0lEfS0+eyROZWVkZWR9IH0gPSAnIFNlcnZlckVycm9yJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2lmICgkUmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgJFRpY2tldFBhcmFteyAkU2VsZi0+e05hbWVUb0lEfS0+eyROZWVkZWR9IH0gPSAkUmVzdWx0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIElmIHdlIGhhZCBubyBFcnJvcnMsIHdlIGNhbiBjcmVhdGUgdGhlIFRpY2tldCBhbmQgU2V0IEFjdGl2aXR5RW50aXR5SUQgYXMgd2VsbCBhcwogICAgICAgICMgUHJvY2Vzc0VudGl0eUlECiAgICAgICAgaWYgKCAhSXNIYXNoUmVmV2l0aERhdGEoIFwlRXJyb3IgKSApIHsKCiAgICAgICAgICAgICRUaWNrZXRQYXJhbXtVc2VySUR9ID0gJFNlbGYtPntVc2VySUR9OwoKICAgICAgICAgICAgaWYgKCAkVGlja2V0UGFyYW17T3duZXJJRH0gKSB7CiAgICAgICAgICAgICAgICAkTmV3T3duZXJJRCA9ICRUaWNrZXRQYXJhbXtPd25lcklEfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBTZXQgT3duZXJJRCB0byAxIG9uIFRpY2tldENyZWF0ZS4gVGhpcyB3aWxsIGJlIHVwZGF0ZWQgbGF0ZXIgb24sIHNvIGV2ZW50cyBjYW4gYmUgdHJpZ2dlcmVkLgogICAgICAgICAgICAkVGlja2V0UGFyYW17T3duZXJJRH0gPSAxOwoKICAgICAgICAgICAgIyBpZiBTdGFydEFjdGl2aXR5RGlhbG9nIGRvZXMgbm90IHByb3ZpZGUgYSB0aWNrZXQgdGl0bGUgc2V0IGEgZGVmYXVsdCB2YWx1ZQogICAgICAgICAgICBpZiAoICEkVGlja2V0UGFyYW17VGl0bGV9ICkgewoKICAgICAgICAgICAgICAgICMgZ2V0IHRoZSBjdXJyZW50IHNlcnZlciBUaW1lLXN0YW1wCiAgICAgICAgICAgICAgICBteSAkRGF0ZVRpbWVPYmplY3QgICA9ICRLZXJuZWw6Ok9NLT5DcmVhdGUoJ0tlcm5lbDo6U3lzdGVtOjpEYXRlVGltZScpOwogICAgICAgICAgICAgICAgbXkgJEN1cnJlbnRUaW1lU3RhbXAgPSAkRGF0ZVRpbWVPYmplY3QtPlRvU3RyaW5nKCk7CiAgICAgICAgICAgICAgICBteSAkT1RSU1RpbWVab25lICAgICA9ICREYXRlVGltZU9iamVjdC0+T1RSU1RpbWVab25lR2V0KCk7CiAgICAgICAgICAgICAgICAkVGlja2V0UGFyYW17VGl0bGV9ID0gIiRQYXJhbXtQcm9jZXNzTmFtZX0gLSAkQ3VycmVudFRpbWVTdGFtcCAoJE9UUlNUaW1lWm9uZSkiOwoKICAgICAgICAgICAgICAgICMgdXNlIGFydGljbGUgc3ViamVjdCBmcm9tIHRoZSB3ZWIgcmVxdWVzdCBpZiBhbnkKICAgICAgICAgICAgICAgIGlmICggSXNTdHJpbmdXaXRoRGF0YSggJFBhcmFte0dldFBhcmFtfS0+e1N1YmplY3R9ICkgKSB7CiAgICAgICAgICAgICAgICAgICAgJFRpY2tldFBhcmFte1RpdGxlfSA9ICRQYXJhbXtHZXRQYXJhbX0tPntTdWJqZWN0fTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBjcmVhdGUgYSBuZXcgdGlja2V0CiAgICAgICAgICAgICRUaWNrZXRJRCA9ICRUaWNrZXRPYmplY3QtPlRpY2tldENyZWF0ZSglVGlja2V0UGFyYW0pOwoKICAgICAgICAgICAgaWYgKCAhJFRpY2tldElEICkgewogICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgKICAgICAgICAgICAgICAgICAgICAgICAgJ0NvdWxkblwndCBjcmVhdGUgdGlja2V0IGZvciBQcm9jZXNzIHdpdGggUHJvY2Vzc0VudGl0eUlEICIlcyIhJywKICAgICAgICAgICAgICAgICAgICAgICAgJFBhcmFte1Byb2Nlc3NFbnRpdHlJRH0sCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG15ICRTdWNjZXNzID0gJFByb2Nlc3NPYmplY3QtPlByb2Nlc3NUaWNrZXRQcm9jZXNzU2V0KAogICAgICAgICAgICAgICAgUHJvY2Vzc0VudGl0eUlEID0+ICRQYXJhbXtQcm9jZXNzRW50aXR5SUR9LAogICAgICAgICAgICAgICAgVGlja2V0SUQgICAgICAgID0+ICRUaWNrZXRJRCwKICAgICAgICAgICAgICAgIFVzZXJJRCAgICAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGlmICggISRTdWNjZXNzICkgewogICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgKICAgICAgICAgICAgICAgICAgICAgICAgJ0NvdWxkblwndCBzZXQgUHJvY2Vzc0VudGl0eUlEICIlcyIgb24gVGlja2V0SUQgIiVzIiEnLAogICAgICAgICAgICAgICAgICAgICAgICAkUGFyYW17UHJvY2Vzc0VudGl0eUlEfSwKICAgICAgICAgICAgICAgICAgICAgICAgJFRpY2tldElELAogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkU3VjY2VzcyA9IHVuZGVmOwoKICAgICAgICAgICAgJFN1Y2Nlc3MgPSAkUHJvY2Vzc09iamVjdC0+UHJvY2Vzc1RpY2tldEFjdGl2aXR5U2V0KAogICAgICAgICAgICAgICAgUHJvY2Vzc0VudGl0eUlEICA9PiAkUGFyYW17UHJvY2Vzc0VudGl0eUlEfSwKICAgICAgICAgICAgICAgIEFjdGl2aXR5RW50aXR5SUQgPT4gJFByb2Nlc3NTdGFydHBvaW50LT57QWN0aXZpdHl9LAogICAgICAgICAgICAgICAgVGlja2V0SUQgICAgICAgICA9PiAkVGlja2V0SUQsCiAgICAgICAgICAgICAgICBVc2VySUQgICAgICAgICAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGlmICggISRTdWNjZXNzICkgewogICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgKICAgICAgICAgICAgICAgICAgICAgICAgJ0NvdWxkblwndCBzZXQgQWN0aXZpdHlFbnRpdHlJRCAiJXMiIG9uIFRpY2tldElEICIlcyIhJywKICAgICAgICAgICAgICAgICAgICAgICAgJFBhcmFte1Byb2Nlc3NFbnRpdHlJRH0sCiAgICAgICAgICAgICAgICAgICAgICAgICRUaWNrZXRJRCwKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgIENvbW1lbnQgPT4gVHJhbnNsYXRhYmxlKCdQbGVhc2UgY29udGFjdCB0aGUgYWRtaW5pc3RyYXRvci4nKSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICVUaWNrZXQgPSAkVGlja2V0T2JqZWN0LT5UaWNrZXRHZXQoCiAgICAgICAgICAgICAgICBUaWNrZXRJRCAgICAgID0+ICRUaWNrZXRJRCwKICAgICAgICAgICAgICAgIFVzZXJJRCAgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkcyA9PiAxLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKCAhSXNIYXNoUmVmV2l0aERhdGEoIFwlVGlja2V0ICkgKSB7CiAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5GYXRhbEVycm9yKAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKAogICAgICAgICAgICAgICAgICAgICAgICAnQ291bGQgbm90IHN0b3JlIEFjdGl2aXR5RGlhbG9nLCBpbnZhbGlkIFRpY2tldElEOiAlcyEnLAogICAgICAgICAgICAgICAgICAgICAgICAkVGlja2V0SUQsCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICBDb21tZW50ID0+IFRyYW5zbGF0YWJsZSgnUGxlYXNlIGNvbnRhY3QgdGhlIGFkbWluaXN0cmF0b3IuJyksCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciBteSAkRHluYW1pY0ZpZWxkQ29uZmlnICgKCiAgICAgICAgICAgICAgICAjIDIuIHJlbW92ZSAiRHluYW1pY0ZpZWxkXyIgZnJvbSBzdHJpbmcKICAgICAgICAgICAgICAgIG1hcCB7CiAgICAgICAgICAgICAgICAgICAgbXkgJEZpZWxkID0gJF87CiAgICAgICAgICAgICAgICAgICAgJEZpZWxkID1+IHN7XkR5bmFtaWNGaWVsZF8oLiopfXskMX14bXM7CgogICAgICAgICAgICAgICAgICAgICMgMy4gZ3JlcCBmcm9tIHRoZSBEeW5hbWljRmllbGRDb25maWdzIHRoZSByZXN1bHRpbmcgRHluYW1pY0ZpZWxkcyB3aXRob3V0CiAgICAgICAgICAgICAgICAgICAgIyAiRHluYW1pY0ZpZWxkXyIKICAgICAgICAgICAgICAgICAgICBncmVwIHsgJF8tPntOYW1lfSBlcSAkRmllbGQgfSBAeyREeW5hbWljRmllbGR9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgIyAxLiBncmVwIGFsbCBEeW5hbWljRmllbGRzCiAgICAgICAgICAgICAgICBncmVwIHtte15EeW5hbWljRmllbGRfKC4qKX14bXN9IEB7ICRBY3Rpdml0eURpYWxvZy0+e0ZpZWxkT3JkZXJ9IH0KICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgewoKICAgICAgICAgICAgICAgICMgYW5kIG5vdyBpdCdzIGVhc3ksIGp1c3Qgc3RvcmUgdGhlIGR5bmFtaWMgRmllbGQgVmFsdWVzIDspCiAgICAgICAgICAgICAgICAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdC0+VmFsdWVTZXQoCiAgICAgICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRDb25maWcsCiAgICAgICAgICAgICAgICAgICAgT2JqZWN0SUQgICAgICAgICAgID0+ICRUaWNrZXRJRCwKICAgICAgICAgICAgICAgICAgICBWYWx1ZSAgICAgICAgICAgICAgPT4gJFRpY2tldFBhcmFteyAnRHluYW1pY0ZpZWxkXycgLiAkRHluYW1pY0ZpZWxkQ29uZmlnLT57TmFtZX0gfSwKICAgICAgICAgICAgICAgICAgICBVc2VySUQgICAgICAgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyByZW1lbWJlciBuZXcgY3JlYXRlZCBUaWNrZXRJRAogICAgICAgICAgICAkTmV3VGlja2V0SUQgPSAkVGlja2V0SUQ7CiAgICAgICAgfQogICAgfQoKICAgIGVsc2lmICggJFRpY2tldElEICYmICRTZWxmLT57SXNQcm9jZXNzRW5yb2xsfSApIHsKCiAgICAgICAgIyB1c2UgRXJyb3IgaW5zdGVhZCBvZiBGYXRhbEVycm9yIGFzIHdlIGFyZSBpbiBhIFBvcC11cCB3aW5kb3cKICAgICAgICAjIEdldCBUaWNrZXQgdG8gY2hlY2sgVGlja2V0SUQgd2FzIHZhbGlkCiAgICAgICAgJVRpY2tldCA9ICRUaWNrZXRPYmplY3QtPlRpY2tldEdldCgKICAgICAgICAgICAgVGlja2V0SUQgICAgICA9PiAkVGlja2V0SUQsCiAgICAgICAgICAgIFVzZXJJRCAgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICBEeW5hbWljRmllbGRzID0+IDAsCiAgICAgICAgKTsKCiAgICAgICAgaWYgKCAhSXNIYXNoUmVmV2l0aERhdGEoIFwlVGlja2V0ICkgKSB7CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkVycm9yKAogICAgICAgICAgICAgICAgTWVzc2FnZSA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoICdJbnZhbGlkIFRpY2tldElEOiAlcyEnLCAkVGlja2V0SUQgKSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIG15ICRTdWNjZXNzID0gJFByb2Nlc3NPYmplY3QtPlByb2Nlc3NUaWNrZXRQcm9jZXNzU2V0KAogICAgICAgICAgICBQcm9jZXNzRW50aXR5SUQgPT4gJFBhcmFte1Byb2Nlc3NFbnRpdHlJRH0sCiAgICAgICAgICAgIFRpY2tldElEICAgICAgICA9PiAkVGlja2V0SUQsCiAgICAgICAgICAgIFVzZXJJRCAgICAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgKTsKICAgICAgICBpZiAoICEkU3VjY2VzcyApIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+RXJyb3IoCiAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgKICAgICAgICAgICAgICAgICAgICAnQ291bGRuXCd0IHNldCBQcm9jZXNzRW50aXR5SUQgIiVzIiBvbiBUaWNrZXRJRCAiJXMiIScsCiAgICAgICAgICAgICAgICAgICAgJFBhcmFte1Byb2Nlc3NFbnRpdHlJRH0sCiAgICAgICAgICAgICAgICAgICAgJFRpY2tldElELAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICRTdWNjZXNzID0gdW5kZWY7CgogICAgICAgICRQcm9jZXNzU3RhcnRwb2ludCA9ICRQcm9jZXNzT2JqZWN0LT5Qcm9jZXNzU3RhcnRwb2ludEdldCgKICAgICAgICAgICAgUHJvY2Vzc0VudGl0eUlEID0+ICRQYXJhbXtQcm9jZXNzRW50aXR5SUR9LAogICAgICAgICk7CgogICAgICAgIGlmICgKICAgICAgICAgICAgISRQcm9jZXNzU3RhcnRwb2ludAogICAgICAgICAgICB8fCAhSXNIYXNoUmVmV2l0aERhdGEoJFByb2Nlc3NTdGFydHBvaW50KQogICAgICAgICAgICB8fCAhJFByb2Nlc3NTdGFydHBvaW50LT57QWN0aXZpdHl9IHx8ICEkUHJvY2Vzc1N0YXJ0cG9pbnQtPntBY3Rpdml0eURpYWxvZ30KICAgICAgICAgICAgKQogICAgICAgIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+RXJyb3IoCiAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgKICAgICAgICAgICAgICAgICAgICAnTm8gU3RhcnRBY3Rpdml0eURpYWxvZyBvciBTdGFydEFjdGl2aXR5RGlhbG9nIGZvciBQcm9jZXNzICIlcyIgY29uZmlndXJlZCEnLAogICAgICAgICAgICAgICAgICAgICRQYXJhbXtQcm9jZXNzRW50aXR5SUR9LAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICRTdWNjZXNzID0gJFByb2Nlc3NPYmplY3QtPlByb2Nlc3NUaWNrZXRBY3Rpdml0eVNldCgKICAgICAgICAgICAgUHJvY2Vzc0VudGl0eUlEICA9PiAkUGFyYW17UHJvY2Vzc0VudGl0eUlEfSwKICAgICAgICAgICAgQWN0aXZpdHlFbnRpdHlJRCA9PiAkUHJvY2Vzc1N0YXJ0cG9pbnQtPntBY3Rpdml0eX0sCiAgICAgICAgICAgIFRpY2tldElEICAgICAgICAgPT4gJFRpY2tldElELAogICAgICAgICAgICBVc2VySUQgICAgICAgICAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICApOwoKICAgICAgICBpZiAoICEkU3VjY2VzcyApIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+RXJyb3IoCiAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgKICAgICAgICAgICAgICAgICAgICAnQ291bGRuXCd0IHNldCBBY3Rpdml0eUVudGl0eUlEICIlcyIgb24gVGlja2V0SUQgIiVzIiEnLAogICAgICAgICAgICAgICAgICAgICRQYXJhbXtQcm9jZXNzRW50aXR5SUR9LAogICAgICAgICAgICAgICAgICAgICRUaWNrZXRJRCwKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICBDb21tZW50ID0+IFRyYW5zbGF0YWJsZSgnUGxlYXNlIGNvbnRhY3QgdGhlIGFkbWluaXN0cmF0b3IuJyksCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIHVzZSBQcm9jZXNzRW50aXR5SUQgZnJvbSB0aGUgd2ViIHJlcXVlc3QKICAgICAgICAkUHJvY2Vzc0VudGl0eUlEID0gJFBhcmFte1Byb2Nlc3NFbnRpdHlJRH07CgogICAgICAgICMgQ2hlY2sgaWYgd2UgZGVhbCB3aXRoIGEgVGlja2V0IFVwZGF0ZQogICAgICAgIG15ICRVcGRhdGVUaWNrZXRJRCA9ICRUaWNrZXRJRDsKICAgIH0KCiAgICAjIElmIHdlIGhhZCBhIFRpY2tldElELCBnZXQgdGhlIFRpY2tldAogICAgZWxzZSB7CgogICAgICAgICMgR2V0IFRpY2tldCB0byBjaGVjayBUaWNrZXRJRCB3YXMgdmFsaWQKICAgICAgICAlVGlja2V0ID0gJFRpY2tldE9iamVjdC0+VGlja2V0R2V0KAogICAgICAgICAgICBUaWNrZXRJRCAgICAgID0+ICRUaWNrZXRJRCwKICAgICAgICAgICAgVXNlcklEICAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgIER5bmFtaWNGaWVsZHMgPT4gMSwKICAgICAgICApOwoKICAgICAgICBpZiAoICFJc0hhc2hSZWZXaXRoRGF0YSggXCVUaWNrZXQgKSApIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigKICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKAogICAgICAgICAgICAgICAgICAgICdDb3VsZCBub3Qgc3RvcmUgQWN0aXZpdHlEaWFsb2csIGludmFsaWQgVGlja2V0SUQ6ICVzIScsCiAgICAgICAgICAgICAgICAgICAgJFRpY2tldElELAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICRBY3Rpdml0eUVudGl0eUlEID0gJFRpY2tldHsKICAgICAgICAgICAgJ0R5bmFtaWNGaWVsZF8nCiAgICAgICAgICAgICAgICAuICRDb25maWdPYmplY3QtPkdldCgnUHJvY2Vzczo6RHluYW1pY0ZpZWxkUHJvY2Vzc01hbmFnZW1lbnRBY3Rpdml0eUlEJykKICAgICAgICB9OwogICAgICAgIGlmICggISRBY3Rpdml0eUVudGl0eUlEICkKICAgICAgICB7CgogICAgICAgICAgICByZXR1cm4gJFNlbGYtPl9TaG93RGlhbG9nRXJyb3IoCiAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgKICAgICAgICAgICAgICAgICAgICAnTWlzc2luZyBBY3Rpdml0eUVudGl0eUlEIGluIFRpY2tldCAlcyEnLAogICAgICAgICAgICAgICAgICAgICRUaWNrZXR7VGlja2V0SUR9LAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgIENvbW1lbnQgPT4gVHJhbnNsYXRhYmxlKCdQbGVhc2UgY29udGFjdCB0aGUgYWRtaW5pc3RyYXRvci4nKSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgTWFrZSBzdXJlIHRoZSBhY3Rpdml0eSBkaWFsb2cgdG8gc2F2ZSBpcyBzdGlsbCB0aGUgY29ycmVjdCBhY3Rpdml0eQogICAgICAgIG15ICRBY3Rpdml0eSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpQcm9jZXNzTWFuYWdlbWVudDo6QWN0aXZpdHknKS0+QWN0aXZpdHlHZXQoCiAgICAgICAgICAgIEFjdGl2aXR5RW50aXR5SUQgPT4gJEFjdGl2aXR5RW50aXR5SUQsCiAgICAgICAgICAgIEludGVyZmFjZSAgICAgICAgPT4gWydBZ2VudEludGVyZmFjZSddLAogICAgICAgICk7CiAgICAgICAgbXkgJUFjdGl2aXR5RGlhbG9ncyA9IHJldmVyc2UgJXsgJEFjdGl2aXR5LT57QWN0aXZpdHlEaWFsb2d9IC8vIHt9IH07CiAgICAgICAgaWYgKCAhJEFjdGl2aXR5RGlhbG9nc3skQWN0aXZpdHlEaWFsb2dFbnRpdHlJRH0gKSB7CgogICAgICAgICAgICBteSAkVGlja2V0SG9vayAgICAgICAgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6SG9vaycpOwogICAgICAgICAgICBteSAkVGlja2V0SG9va0RpdmlkZXIgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6SG9va0RpdmlkZXInKTsKCiAgICAgICAgICAgICRFcnJvcntXcm9uZ0FjdGl2aXR5fSA9IDE7CiAgICAgICAgICAgIHB1c2ggQE5vdGlmeSwgewogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ0Vycm9yJywKICAgICAgICAgICAgICAgIERhdGEgICAgID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgKICAgICAgICAgICAgICAgICAgICAnVGhpcyBzdGVwIGRvZXMgbm90IGJlbG9uZyBhbnltb3JlIHRvIHRoZSBjdXJyZW50IGFjdGl2aXR5IGluIHByb2Nlc3MgZm9yIHRpY2tldCBcJyVzJXMlc1wnISBBbm90aGVyIHVzZXIgY2hhbmdlZCB0aGlzIHRpY2tldCBpbiB0aGUgbWVhbnRpbWUuIFBsZWFzZSBjbG9zZSB0aGlzIHdpbmRvdyBhbmQgcmVsb2FkIHRoZSB0aWNrZXQuJywKICAgICAgICAgICAgICAgICAgICAkVGlja2V0SG9vaywKICAgICAgICAgICAgICAgICAgICAkVGlja2V0SG9va0RpdmlkZXIsCiAgICAgICAgICAgICAgICAgICAgJFRpY2tldHtUaWNrZXROdW1iZXJ9LAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgICRQcm9jZXNzRW50aXR5SUQgPSAkVGlja2V0ewogICAgICAgICAgICAnRHluYW1pY0ZpZWxkXycKICAgICAgICAgICAgICAgIC4gJENvbmZpZ09iamVjdC0+R2V0KCdQcm9jZXNzOjpEeW5hbWljRmllbGRQcm9jZXNzTWFuYWdlbWVudFByb2Nlc3NJRCcpCiAgICAgICAgfTsKCiAgICAgICAgaWYgKCAhJFByb2Nlc3NFbnRpdHlJRCApCiAgICAgICAgewogICAgICAgICAgICByZXR1cm4gJFNlbGYtPl9TaG93RGlhbG9nRXJyb3IoCiAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgKICAgICAgICAgICAgICAgICAgICAnTWlzc2luZyBQcm9jZXNzRW50aXR5SUQgaW4gVGlja2V0ICVzIScsCiAgICAgICAgICAgICAgICAgICAgJFRpY2tldHtUaWNrZXRJRH0sCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgQ29tbWVudCA9PiBUcmFuc2xhdGFibGUoJ1BsZWFzZSBjb250YWN0IHRoZSBhZG1pbmlzdHJhdG9yLicpLAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICAjIGlmIHdlIGdvdCBlcnJvcnMgZ28gYmFjayB0byBkaXNwbGF5aW5nIHRoZSBBY3Rpdml0eURpYWxvZwogICAgaWYgKCBJc0hhc2hSZWZXaXRoRGF0YSggXCVFcnJvciApICkgewogICAgICAgIHJldHVybiAkU2VsZi0+X091dHB1dEFjdGl2aXR5RGlhbG9nKAogICAgICAgICAgICBQcm9jZXNzRW50aXR5SUQgICAgICAgID0+ICRQcm9jZXNzRW50aXR5SUQsCiAgICAgICAgICAgIFRpY2tldElEICAgICAgICAgICAgICAgPT4gJFRpY2tldElEIHx8IHVuZGVmLAogICAgICAgICAgICBBY3Rpdml0eURpYWxvZ0VudGl0eUlEID0+ICRBY3Rpdml0eURpYWxvZ0VudGl0eUlELAogICAgICAgICAgICBFcnJvciAgICAgICAgICAgICAgICAgID0+IFwlRXJyb3IsCiAgICAgICAgICAgIEVycm9yTWVzc2FnZXMgICAgICAgICAgPT4gXCVFcnJvck1lc3NhZ2VzLAogICAgICAgICAgICBHZXRQYXJhbSAgICAgICAgICAgICAgID0+ICRQYXJhbXtHZXRQYXJhbX0sCiAgICAgICAgICAgIE5vdGlmeSAgICAgICAgICAgICAgICAgPT4gXEBOb3RpZnksCiAgICAgICAgKTsKICAgIH0KCiAgICAjIENoZWNrIGlmIHdlIGRlYWwgd2l0aCBhIFRpY2tldCBVcGRhdGUKICAgIG15ICRVcGRhdGVUaWNrZXRJRCA9ICRQYXJhbXtHZXRQYXJhbX0tPntUaWNrZXRJRH07CgogICAgIyBXZSBzYXZlIG9ubHkgb25jZSwgbm8gbWF0dGVyIGlmIG9uZSBvciBtb3JlIGNvbmZpZ3VyYXRpb25zIGFyZSBzZXQgZm9yIHRoZSBzYW1lIHBhcmFtCiAgICBteSAlU3RvcmVkRmllbGRzOwoKICAgICMgU2F2ZSBsb29wIGZvciBzdG9yaW5nIFRpY2tldCBWYWx1ZXMgdGhhdCB3ZXJlIG5vdCByZXF1aXJlZCBvbiB0aGUgaW5pdGlhbCBUaWNrZXRDcmVhdGUKICAgIERJQUxPR0ZJRUxEOgogICAgZm9yIG15ICRDdXJyZW50RmllbGQgKCBAeyAkQWN0aXZpdHlEaWFsb2ctPntGaWVsZE9yZGVyfSB9ICkgewoKICAgICAgICBpZiAoICFJc0hhc2hSZWZXaXRoRGF0YSggJEFjdGl2aXR5RGlhbG9nLT57RmllbGRzfXskQ3VycmVudEZpZWxkfSApICkgewogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5GYXRhbEVycm9yKAogICAgICAgICAgICAgICAgTWVzc2FnZSA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoCiAgICAgICAgICAgICAgICAgICAgJ0NhblwndCBnZXQgZGF0YSBmb3IgRmllbGQgIiVzIiBvZiBBY3Rpdml0eURpYWxvZyAiJXMiIScsCiAgICAgICAgICAgICAgICAgICAgJEN1cnJlbnRGaWVsZCwKICAgICAgICAgICAgICAgICAgICAkQWN0aXZpdHlEaWFsb2dFbnRpdHlJRCwKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICBpZiAoICRDdXJyZW50RmllbGQgPX4gbXteRHluYW1pY0ZpZWxkXyguKil9eG1zICkgewogICAgICAgICAgICBteSAkRHluYW1pY0ZpZWxkTmFtZSAgID0gJDE7CiAgICAgICAgICAgIG15ICREeW5hbWljRmllbGRDb25maWcgPSAoIGdyZXAgeyAkXy0+e05hbWV9IGVxICREeW5hbWljRmllbGROYW1lIH0gQHskRHluYW1pY0ZpZWxkfSApWzBdOwoKICAgICAgICAgICAgaWYgKCAhSXNIYXNoUmVmV2l0aERhdGEoJER5bmFtaWNGaWVsZENvbmZpZykgKSB7CgogICAgICAgICAgICAgICAgbXkgJE1lc3NhZ2UKICAgICAgICAgICAgICAgICAgICA9ICJEeW5hbWljRmllbGRDb25maWcgbWlzc2luZyBmb3IgZmllbGQ6ICRQYXJhbXtGaWVsZE5hbWV9LCBvciBpcyBub3QgYSBUaWNrZXQgRHluYW1pYyBGaWVsZCEiOwoKICAgICAgICAgICAgICAgICMgbG9nIGVycm9yIGJ1dCBkb2VzIG5vdCBzdG9wIHRoZSBleGVjdXRpb24gYXMgaXQgY291bGQgYmUgYW4gb2xkIEFydGljbGUKICAgICAgICAgICAgICAgICMgRHluYW1pY0ZpZWxkLCBzZWUgYnVnIzExNjY2CiAgICAgICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICRNZXNzYWdlLAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICBuZXh0IERJQUxPR0ZJRUxEOwogICAgICAgICAgICB9CgogICAgICAgICAgICBteSAkU3VjY2VzcyA9ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0LT5WYWx1ZVNldCgKICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZENvbmZpZyA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnLAogICAgICAgICAgICAgICAgT2JqZWN0SUQgICAgICAgICAgID0+ICRUaWNrZXRJRCwKICAgICAgICAgICAgICAgIFZhbHVlICAgICAgICAgICAgICA9PiAkVGlja2V0UGFyYW17JEN1cnJlbnRGaWVsZH0sCiAgICAgICAgICAgICAgICBVc2VySUQgICAgICAgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICApOwogICAgICAgICAgICBpZiAoICEkU3VjY2VzcyApIHsKICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkZhdGFsRXJyb3IoCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgICdDb3VsZCBub3Qgc2V0IER5bmFtaWNGaWVsZCB2YWx1ZSBmb3IgJXMgb2YgVGlja2V0IHdpdGggSUQgIiVzIiBpbiBBY3Rpdml0eURpYWxvZyAiJXMiIScsCiAgICAgICAgICAgICAgICAgICAgICAgICRDdXJyZW50RmllbGQsCiAgICAgICAgICAgICAgICAgICAgICAgICRUaWNrZXRJRCwKICAgICAgICAgICAgICAgICAgICAgICAgJEFjdGl2aXR5RGlhbG9nRW50aXR5SUQsCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzaWYgKCAkQ3VycmVudEZpZWxkIGVxICdBdHRhY2htZW50cycgKSB7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIElzQXJyYXlSZWZXaXRoRGF0YSggJFBhcmFte0dldFBhcmFtfS0+e0F0dGFjaG1lbnRzfSApCiAgICAgICAgICAgICAgICB8fCAkUGFyYW17R2V0UGFyYW19LT57QXR0YWNobWVudHN9ID1+IG17XDpcOn0KICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbXkgJER5bmFtaWNGaWVsZE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEeW5hbWljRmllbGQnKTsKICAgICAgICAgICAgICAgIG15ICRBdHRhY2htZW50c0R5bmFtaWNGaWVsZE5hbWUKICAgICAgICAgICAgICAgICAgICA9ICRDb25maWdPYmplY3QtPkdldCgnUHJvY2Vzczo6RHluYW1pY0ZpZWxkUHJvY2Vzc01hbmFnZW1lbnRBdHRhY2htZW50Jyk7CgogICAgICAgICAgICAgICAgbXkgJER5bmFtaWNGaWVsZENvbmZpZyA9ICREeW5hbWljRmllbGRPYmplY3QtPkR5bmFtaWNGaWVsZEdldCgKICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICRBdHRhY2htZW50c0R5bmFtaWNGaWVsZE5hbWUsCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgIG5leHQgRElBTE9HRklFTEQgaWYgIUlzSGFzaFJlZldpdGhEYXRhKCREeW5hbWljRmllbGRDb25maWcpOwoKICAgICAgICAgICAgICAgIG15ICRWYWx1ZTsKICAgICAgICAgICAgICAgIGlmICggSXNBcnJheVJlZldpdGhEYXRhKCAkUGFyYW17R2V0UGFyYW19LT57QXR0YWNobWVudHN9ICkgKSB7CiAgICAgICAgICAgICAgICAgICAgJFZhbHVlID0gam9pbiAnLCcsIEB7ICRQYXJhbXtHZXRQYXJhbX0tPntBdHRhY2htZW50c30gfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRWYWx1ZSA9ICRQYXJhbXtHZXRQYXJhbX0tPntBdHRhY2htZW50c30gLy8gJyc7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbXkgJFN1Y2Nlc3MgPSAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdC0+VmFsdWVTZXQoCiAgICAgICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRDb25maWcsCiAgICAgICAgICAgICAgICAgICAgT2JqZWN0SUQgICAgICAgICAgID0+ICRUaWNrZXRJRCwKICAgICAgICAgICAgICAgICAgICBWYWx1ZSAgICAgICAgICAgICAgPT4gJFZhbHVlLAogICAgICAgICAgICAgICAgICAgIFVzZXJJRCAgICAgICAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgbmV4dCBESUFMT0dGSUVMRCBpZiAkU3VjY2VzczsKCiAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5GYXRhbEVycm9yKAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKAogICAgICAgICAgICAgICAgICAgICAgICAnQ291bGQgbm90IHNldCBhdHRhY2htZW50cyBmb3IgdGlja2V0IHdpdGggSUQgJXMgaW4gYWN0aXZpdHkgZGlhbG9nICIlcyIhJywKICAgICAgICAgICAgICAgICAgICAgICAgJFRpY2tldElELAogICAgICAgICAgICAgICAgICAgICAgICAkQWN0aXZpdHlEaWFsb2dFbnRpdHlJRCwKICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNpZiAoICRDdXJyZW50RmllbGQgZXEgJ1BlbmRpbmdUaW1lJyApIHsKCiAgICAgICAgICAgICMgVGhpcyBWYWx1ZSBpcyBqdXN0IHNldCBpZiBTdGF0dXMgd2FzIG9uIGEgUGVuZGluZyBzdGF0ZQogICAgICAgICAgICAjIHNvIGl0IGhhcyB0byBiZSBwb3NzaWJsZSB0byBzdG9yZSB0aGUgdGlja2V0IGlmIHRoaXMgb25lJ3MgZW1wdHkKICAgICAgICAgICAgaWYgKCBJc0hhc2hSZWZXaXRoRGF0YSggJFRpY2tldFBhcmFteydQZW5kaW5nVGltZSd9ICkgKSB7CiAgICAgICAgICAgICAgICBteSAkU3VjY2VzcyA9ICRUaWNrZXRPYmplY3QtPlRpY2tldFBlbmRpbmdUaW1lU2V0KAogICAgICAgICAgICAgICAgICAgIFVzZXJJRCAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgICAgICAgICBUaWNrZXRJRCA9PiAkVGlja2V0SUQsCiAgICAgICAgICAgICAgICAgICAgJXsgJFRpY2tldFBhcmFteydQZW5kaW5nVGltZSd9IH0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgaWYgKCAhJFN1Y2Nlc3MgKSB7CiAgICAgICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigKICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQ291bGQgbm90IHNldCBQZW5kaW5nVGltZSBmb3IgVGlja2V0IHdpdGggSUQgIiVzIiBpbiBBY3Rpdml0eURpYWxvZyAiJXMiIScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVGlja2V0SUQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkQWN0aXZpdHlEaWFsb2dFbnRpdHlJRCwKICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBlbHNpZiAoICRDdXJyZW50RmllbGQgZXEgJ0FydGljbGUnICYmICggJFVwZGF0ZVRpY2tldElEIHx8ICROZXdUaWNrZXRJRCApICkgewoKICAgICAgICAgICAgbXkgJFRpY2tldElEID0gJFVwZGF0ZVRpY2tldElEIHx8ICROZXdUaWNrZXRJRDsKCiAgICAgICAgICAgIGlmICggJFBhcmFte0dldFBhcmFtfS0+e1N1YmplY3R9ICYmICRQYXJhbXtHZXRQYXJhbX0tPntCb2R5fSApIHsKCiAgICAgICAgICAgICAgICAjIGFkZCBub3RlCiAgICAgICAgICAgICAgICBteSAkQXJ0aWNsZUlEID0gJyc7CiAgICAgICAgICAgICAgICBteSAkTWltZVR5cGUgID0gJ3RleHQvcGxhaW4nOwoKICAgICAgICAgICAgICAgICMgZ2V0IHByZSBsb2FkZWQgYXR0YWNobWVudAogICAgICAgICAgICAgICAgbXkgQEF0dGFjaG1lbnRzID0gJFVwbG9hZENhY2hlT2JqZWN0LT5Gb3JtSURHZXRBbGxGaWxlc0RhdGEoCiAgICAgICAgICAgICAgICAgICAgRm9ybUlEID0+ICRTZWxmLT57Rm9ybUlEfSwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgIyBnZXQgc3VibWl0IGF0dGFjaG1lbnQKICAgICAgICAgICAgICAgIG15ICVVcGxvYWRTdHVmZiA9ICRQYXJhbU9iamVjdC0+R2V0VXBsb2FkQWxsKAogICAgICAgICAgICAgICAgICAgIFBhcmFtID0+ICdGaWxlVXBsb2FkJywKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBpZiAoJVVwbG9hZFN0dWZmKSB7CiAgICAgICAgICAgICAgICAgICAgcHVzaCBAQXR0YWNobWVudHMsIFwlVXBsb2FkU3R1ZmY7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCAkTGF5b3V0T2JqZWN0LT57QnJvd3NlclJpY2hUZXh0fSApIHsKICAgICAgICAgICAgICAgICAgICAkTWltZVR5cGUgPSAndGV4dC9odG1sJzsKCiAgICAgICAgICAgICAgICAgICAgIyB3cml0ZSBhdHRhY2htZW50cwogICAgICAgICAgICAgICAgICAgIG15IEBOZXdBdHRhY2htZW50RGF0YTsKICAgICAgICAgICAgICAgICAgICBBVFRBQ0hNRU5UOgogICAgICAgICAgICAgICAgICAgIGZvciBteSAkQXR0YWNobWVudCAoQEF0dGFjaG1lbnRzKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAjIHNraXAsIGRlbGV0ZWQgbm90IHVzZWQgaW5saW5lIGltYWdlcwogICAgICAgICAgICAgICAgICAgICAgICBteSAkQ29udGVudElEID0gJEF0dGFjaG1lbnQtPntDb250ZW50SUR9OwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkQ29udGVudElECiAgICAgICAgICAgICAgICAgICAgICAgICAgICAmJiAoICRBdHRhY2htZW50LT57Q29udGVudFR5cGV9ID1+IC9pbWFnZS9pICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmICggJEF0dGFjaG1lbnQtPntEaXNwb3NpdGlvbn0gZXEgJ2lubGluZScgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBteSAkQ29udGVudElESFRNTFF1b3RlID0gJExheW91dE9iamVjdC0+QXNjaWkySHRtbCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZXh0ID0+ICRDb250ZW50SUQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgd29ya2Fyb3VuZCBmb3IgbGluayBlbmNvZGUgb2YgcmljaCB0ZXh0IGVkaXRvciwgc2VlIGJ1ZyM1MDUzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBteSAkQ29udGVudElETGlua0VuY29kZSA9ICRMYXlvdXRPYmplY3QtPkxpbmtFbmNvZGUoJENvbnRlbnRJRCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkUGFyYW17R2V0UGFyYW19LT57Qm9keX0gPX4gcy8oQ29udGVudElEPSkkQ29udGVudElETGlua0VuY29kZS8kMSRDb250ZW50SUQvZzsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGlnbm9yZSBhdHRhY2htZW50IGlmIG5vdCBsaW5rZWQgaW4gYm9keQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAkUGFyYW17R2V0UGFyYW19LT57Qm9keX0gIX4gLyhcUSRDb250ZW50SURIVE1MUXVvdGVcRXxcUSRDb250ZW50SURcRSkvaSApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dCBBVFRBQ0hNRU5UOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAjIFJlbWVtYmVyIGlubGluZSBpbWFnZXMgYW5kIG5vcm1hbCBhdHRhY2htZW50cy4KICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCBATmV3QXR0YWNobWVudERhdGEsIFwleyRBdHRhY2htZW50fTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIEBBdHRhY2htZW50cyA9IEBOZXdBdHRhY2htZW50RGF0YTsKCiAgICAgICAgICAgICAgICAgICAgIyB2ZXJpZnkgaHRtbCBkb2N1bWVudAogICAgICAgICAgICAgICAgICAgICRQYXJhbXtHZXRQYXJhbX0tPntCb2R5fSA9ICRMYXlvdXRPYmplY3QtPlJpY2hUZXh0RG9jdW1lbnRDb21wbGV0ZSgKICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nID0+ICRQYXJhbXtHZXRQYXJhbX0tPntCb2R5fSwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG15ICRDb21tdW5pY2F0aW9uQ2hhbm5lbCA9ICRBY3Rpdml0eURpYWxvZy0+e0ZpZWxkc30tPntBcnRpY2xlfS0+e0NvbmZpZ30tPntDb21tdW5pY2F0aW9uQ2hhbm5lbH0KICAgICAgICAgICAgICAgICAgICAvLyAnSW50ZXJuYWwnOwoKICAgICAgICAgICAgICAgIG15ICRBcnRpY2xlQmFja2VuZE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpUaWNrZXQ6OkFydGljbGUnKS0+QmFja2VuZEZvckNoYW5uZWwoCiAgICAgICAgICAgICAgICAgICAgQ2hhbm5lbE5hbWUgPT4gJENvbW11bmljYXRpb25DaGFubmVsLAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAjIENoYW5nZSBoaXN0b3J5IHR5cGUgYW5kIGNvbW1lbnQgYWNjb3JkaW5nbHkgdG8gdGhlIHByb2Nlc3MgYXJ0aWNsZS4KICAgICAgICAgICAgICAgIG15ICRIaXN0b3J5VHlwZSAgICA9ICdBZGROb3RlJzsKICAgICAgICAgICAgICAgIG15ICRIaXN0b3J5Q29tbWVudCA9ICclJU5vdGUnOwogICAgICAgICAgICAgICAgaWYgKCAkQ29tbXVuaWNhdGlvbkNoYW5uZWwgZXEgJ1Bob25lJyApIHsKICAgICAgICAgICAgICAgICAgICAkSGlzdG9yeVR5cGUgICAgPSAnUGhvbmVDYWxsQWdlbnQnOwogICAgICAgICAgICAgICAgICAgICRIaXN0b3J5Q29tbWVudCA9ICclJSc7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbXkgJEZyb20gPSAiXCIkU2VsZi0+e1VzZXJGdWxsbmFtZX1cIiA8JFNlbGYtPntVc2VyRW1haWx9PiI7CiAgICAgICAgICAgICAgICAkQXJ0aWNsZUlEID0gJEFydGljbGVCYWNrZW5kT2JqZWN0LT5BcnRpY2xlQ3JlYXRlKAogICAgICAgICAgICAgICAgICAgIFRpY2tldElEICAgICAgICAgICAgID0+ICRUaWNrZXRJRCwKICAgICAgICAgICAgICAgICAgICBTZW5kZXJUeXBlICAgICAgICAgICA9PiAnYWdlbnQnLAogICAgICAgICAgICAgICAgICAgIElzVmlzaWJsZUZvckN1c3RvbWVyID0+ICRBY3Rpdml0eURpYWxvZy0+e0ZpZWxkc30tPntBcnRpY2xlfS0+e0NvbmZpZ30tPntJc1Zpc2libGVGb3JDdXN0b21lcn0gLy8gMCwKICAgICAgICAgICAgICAgICAgICBGcm9tICAgICAgICAgICAgICAgICA9PiAkRnJvbSwKICAgICAgICAgICAgICAgICAgICBNaW1lVHlwZSAgICAgICAgICAgICA9PiAkTWltZVR5cGUsCiAgICAgICAgICAgICAgICAgICAgQ2hhcnNldCAgICAgICAgICAgICAgPT4gJExheW91dE9iamVjdC0+e1VzZXJDaGFyc2V0fSwKICAgICAgICAgICAgICAgICAgICBVc2VySUQgICAgICAgICAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICAgICAgICAgSGlzdG9yeVR5cGUgICAgICAgICAgPT4gJEhpc3RvcnlUeXBlLAogICAgICAgICAgICAgICAgICAgIEhpc3RvcnlDb21tZW50ICAgICAgID0+ICRIaXN0b3J5Q29tbWVudCwKICAgICAgICAgICAgICAgICAgICBCb2R5ICAgICAgICAgICAgICAgICA9PiAkUGFyYW17R2V0UGFyYW19e0JvZHl9LAogICAgICAgICAgICAgICAgICAgIFN1YmplY3QgICAgICAgICAgICAgID0+ICRQYXJhbXtHZXRQYXJhbX17U3ViamVjdH0sCiAgICAgICAgICAgICAgICAgICAgRm9yY2VOb3RpZmljYXRpb25Ub1VzZXJJRCA9PiAkQWN0aXZpdHlEaWFsb2ctPntGaWVsZHN9LT57QXJ0aWNsZX0tPntDb25maWd9LT57SW5mb3JtQWdlbnRzfQogICAgICAgICAgICAgICAgICAgID8gJFBhcmFte0dldFBhcmFtfXtJbmZvcm1Vc2VySUR9CiAgICAgICAgICAgICAgICAgICAgOiBbXSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBpZiAoICEkQXJ0aWNsZUlEICkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5FcnJvclNjcmVlbigpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgd3JpdGUgYXR0YWNobWVudHMKICAgICAgICAgICAgICAgIGZvciBteSAkQXR0YWNobWVudCAoQEF0dGFjaG1lbnRzKSB7CiAgICAgICAgICAgICAgICAgICAgJEFydGljbGVCYWNrZW5kT2JqZWN0LT5BcnRpY2xlV3JpdGVBdHRhY2htZW50KAogICAgICAgICAgICAgICAgICAgICAgICAleyRBdHRhY2htZW50fSwKICAgICAgICAgICAgICAgICAgICAgICAgQXJ0aWNsZUlEID0+ICRBcnRpY2xlSUQsCiAgICAgICAgICAgICAgICAgICAgICAgIFVzZXJJRCAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIFJlbW92ZSBwcmUgc3VibWl0dGVkIGF0dGFjaG1lbnRzLgogICAgICAgICAgICAgICAgJFVwbG9hZENhY2hlT2JqZWN0LT5Gb3JtSURSZW1vdmUoIEZvcm1JRCA9PiAkU2VsZi0+e0Zvcm1JRH0gKTsKCiAgICAgICAgICAgICAgICAjIHRpbWUgYWNjb3VudGluZwogICAgICAgICAgICAgICAgaWYgKCAkUGFyYW17R2V0UGFyYW19LT57VGltZVVuaXRzfSApIHsKICAgICAgICAgICAgICAgICAgICAkVGlja2V0T2JqZWN0LT5UaWNrZXRBY2NvdW50VGltZSgKICAgICAgICAgICAgICAgICAgICAgICAgVGlja2V0SUQgID0+ICRUaWNrZXRJRCwKICAgICAgICAgICAgICAgICAgICAgICAgQXJ0aWNsZUlEID0+ICRBcnRpY2xlSUQsCiAgICAgICAgICAgICAgICAgICAgICAgIFRpbWVVbml0ICA9PiAkUGFyYW17R2V0UGFyYW19e1RpbWVVbml0c30sCiAgICAgICAgICAgICAgICAgICAgICAgIFVzZXJJRCAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBJZiB3ZSBoYXZlIHRvIFVwZGF0ZSBhIHRpY2tldCwgdXBkYXRlIHRoZSB0cmFuc21pdHRlZCB2YWx1ZXMKICAgICAgICBlbHNpZiAoJFVwZGF0ZVRpY2tldElEKSB7CgogICAgICAgICAgICBteSAkU3VjY2VzczsKICAgICAgICAgICAgaWYgKCAkU2VsZi0+e05hbWVUb0lEfS0+eyRDdXJyZW50RmllbGR9IGVxICdUaXRsZScgKSB7CgogICAgICAgICAgICAgICAgIyBpZiB0aGVyZSBpcyBubyB0aXRsZSwgbm90aGluZyBpcyBuZWVkZWQgdG8gYmUgZG9uZQogICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICFkZWZpbmVkICRUaWNrZXRQYXJhbXsnVGl0bGUnfQogICAgICAgICAgICAgICAgICAgIHx8ICggZGVmaW5lZCAkVGlja2V0UGFyYW17J1RpdGxlJ30gJiYgJFRpY2tldFBhcmFteydUaXRsZSd9IGVxICcnICkKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJFN1Y2Nlc3MgPSAxOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgb3RoZXJ3aXNlIHNldCB0aGUgdGlja2V0IHRpdGxlCiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkU3VjY2VzcyA9ICRUaWNrZXRPYmplY3QtPlRpY2tldFRpdGxlVXBkYXRlKAogICAgICAgICAgICAgICAgICAgICAgICBUaXRsZSAgICA9PiAkVGlja2V0UGFyYW17J1RpdGxlJ30sCiAgICAgICAgICAgICAgICAgICAgICAgIFRpY2tldElEID0+ICRUaWNrZXRJRCwKICAgICAgICAgICAgICAgICAgICAgICAgVXNlcklEICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzaWYgKAogICAgICAgICAgICAgICAgKAogICAgICAgICAgICAgICAgICAgICRTZWxmLT57TmFtZVRvSUR9LT57JEN1cnJlbnRGaWVsZH0gZXEgJ0N1c3RvbWVySUQnCiAgICAgICAgICAgICAgICAgICAgfHwgJFNlbGYtPntOYW1lVG9JRH0tPnskQ3VycmVudEZpZWxkfSBlcSAnQ3VzdG9tZXJVc2VySUQnCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIG5leHQgRElBTE9HRklFTEQgaWYgJFN0b3JlZEZpZWxkc3sgJFNlbGYtPntOYW1lVG9JRH0tPnskQ3VycmVudEZpZWxkfSB9OwoKICAgICAgICAgICAgICAgIGlmICggJEFjdGl2aXR5RGlhbG9nLT57RmllbGRzfS0+eyRDdXJyZW50RmllbGR9LT57RGlzcGxheX0gPT0gMSApIHsKICAgICAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5GYXRhbEVycm9yKAogICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdXcm9uZyBBY3Rpdml0eURpYWxvZyBGaWVsZCBjb25maWc6ICVzIGNhblwndCBiZSBEaXNwbGF5ID0+IDEgLyBTaG93IGZpZWxkIChQbGVhc2UgY2hhbmdlIGl0cyBjb25maWd1cmF0aW9uIHRvIGJlIERpc3BsYXkgPT4gMCAvIERvIG5vdCBzaG93IGZpZWxkIG9yIERpc3BsYXkgPT4gMiAvIFNob3cgZmllbGQgYXMgbWFuZGF0b3J5KSEnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEN1cnJlbnRGaWVsZCwKICAgICAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICMgc2tpcCBUaWNrZXRDdXN0b21lclNldCgpIGlmIHRoZXJlIGlzIG5vIGNoYW5nZSBpbiB0aGUgY3VzdG9tZXIKICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAkVGlja2V0e0N1c3RvbWVySUR9IGVxICRUaWNrZXRQYXJhbXtDdXN0b21lcklEfQogICAgICAgICAgICAgICAgICAgICYmICRUaWNrZXR7Q3VzdG9tZXJVc2VySUR9IGVxICRUaWNrZXRQYXJhbXtDdXN0b21lclVzZXJ9CiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgewoKICAgICAgICAgICAgICAgICAgICAjIEluIHRoaXMgY2FzZSB3ZSBkb24ndCB3YW50IHRvIGNhbGwgYW55IGFkZGl0aW9uYWwgc3RvcmVzCiAgICAgICAgICAgICAgICAgICAgIyBvbiBDdXN0b21lciwgQ3VzdG9tZXJObywgQ3VzdG9tZXJJRCBvciBDdXN0b21lclVzZXJJRAogICAgICAgICAgICAgICAgICAgICMgc28gbWFrZSBzdXJlIGJvdGggZmllbGRzIGFyZSBzZXQgdG8gIlN0b3JlZCIgOykKICAgICAgICAgICAgICAgICAgICAkU3RvcmVkRmllbGRzeyAkU2VsZi0+e05hbWVUb0lEfS0+eydDdXN0b21lcklEJ30gfSAgICAgPSAxOwogICAgICAgICAgICAgICAgICAgICRTdG9yZWRGaWVsZHN7ICRTZWxmLT57TmFtZVRvSUR9LT57J0N1c3RvbWVyVXNlcklEJ30gfSA9IDE7CiAgICAgICAgICAgICAgICAgICAgbmV4dCBESUFMT0dGSUVMRDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkU3VjY2VzcyA9ICRUaWNrZXRPYmplY3QtPlRpY2tldEN1c3RvbWVyU2V0KAogICAgICAgICAgICAgICAgICAgIE5vID0+ICRUaWNrZXRQYXJhbXtDdXN0b21lcklEfSwKCiAgICAgICAgICAgICAgICAgICAgIyBoZXJlIHRvbzogdW5mb3J0dW5hdGVseSBUaWNrZXRDcmVhdGUgdGFrZXMgUGFyYW0gJ0N1c3RvbWVyVXNlcicKICAgICAgICAgICAgICAgICAgICAjIGluc3RlYWQgb2YgQ3VzdG9tZXJVc2VySUQsIHNvIG91ciBUaWNrZXRQYXJhbSBoYXNoCiAgICAgICAgICAgICAgICAgICAgIyBoYXMgdGhlIEN1c3RvbWVyVXNlciBLZXkgaW5zdGVhZCBvZiAnQ3VzdG9tZXJVc2VySUQnCiAgICAgICAgICAgICAgICAgICAgVXNlciAgICAgPT4gJFRpY2tldFBhcmFte0N1c3RvbWVyVXNlcn0sCiAgICAgICAgICAgICAgICAgICAgVGlja2V0SUQgPT4gJFRpY2tldElELAogICAgICAgICAgICAgICAgICAgIFVzZXJJRCAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgIyBJbiB0aGlzIGNhc2Ugd2UgZG9uJ3Qgd2FudCB0byBjYWxsIGFueSBhZGRpdGlvbmFsIHN0b3JlcwogICAgICAgICAgICAgICAgIyBvbiBDdXN0b21lciwgQ3VzdG9tZXJObywgQ3VzdG9tZXJJRCBvciBDdXN0b21lclVzZXJJRAogICAgICAgICAgICAgICAgIyBzbyBtYWtlIHN1cmUgYm90aCBmaWVsZHMgYXJlIHNldCB0byAiU3RvcmVkIiA7KQogICAgICAgICAgICAgICAgJFN0b3JlZEZpZWxkc3sgJFNlbGYtPntOYW1lVG9JRH0tPnsnQ3VzdG9tZXJJRCd9IH0gICAgID0gMTsKICAgICAgICAgICAgICAgICRTdG9yZWRGaWVsZHN7ICRTZWxmLT57TmFtZVRvSUR9LT57J0N1c3RvbWVyVXNlcklEJ30gfSA9IDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBuZXh0IERJQUxPR0ZJRUxEIGlmICRTdG9yZWRGaWVsZHN7ICRTZWxmLT57TmFtZVRvSUR9LT57JEN1cnJlbnRGaWVsZH0gfTsKICAgICAgICAgICAgICAgIG5leHQgRElBTE9HRklFTEQgaWYgJEN1cnJlbnRGaWVsZCBlcSAnQXR0YWNobWVudHMnOwoKICAgICAgICAgICAgICAgIG15ICRUaWNrZXRGaWVsZFNldFN1YiA9ICRDdXJyZW50RmllbGQ7CiAgICAgICAgICAgICAgICAkVGlja2V0RmllbGRTZXRTdWIgPX4gc3tJRCR9e314bXM7CiAgICAgICAgICAgICAgICAkVGlja2V0RmllbGRTZXRTdWIgPSAnVGlja2V0JyAuICRUaWNrZXRGaWVsZFNldFN1YiAuICdTZXQnOwoKICAgICAgICAgICAgICAgIGlmICggJFRpY2tldE9iamVjdC0+Y2FuKCRUaWNrZXRGaWVsZFNldFN1YikgKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIG15ICRVcGRhdGVGaWVsZE5hbWU7CgogICAgICAgICAgICAgICAgICAgICMgc2FkbHkgd2UgbmVlZCBhbiBleGNlcHRpb24gZm9yIE93bmVyKElEKSBhbmQgUmVzcG9uc2libGUoSUQpLCBiZWNhdXNlIHRoZQogICAgICAgICAgICAgICAgICAgICMgVGlja2V0KlNldCBzdWJzIG5lZWQgTmV3VXNlcklEIGFzIHBhcmFtCiAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICAgICBzY2FsYXIgZ3JlcCB7ICRTZWxmLT57TmFtZVRvSUR9LT57JEN1cnJlbnRGaWVsZH0gZXEgJF8gfQogICAgICAgICAgICAgICAgICAgICAgICBxdyggT3duZXJJRCBSZXNwb25zaWJsZUlEICkKICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFVwZGF0ZUZpZWxkTmFtZSA9ICdOZXdVc2VySUQnOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFVwZGF0ZUZpZWxkTmFtZSA9ICRTZWxmLT57TmFtZVRvSUR9LT57JEN1cnJlbnRGaWVsZH07CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAjIHRvIHN0b3JlIGlmIHRoZSBmaWVsZCBuZWVkcyB0byBiZSB1cGRhdGVkCiAgICAgICAgICAgICAgICAgICAgbXkgJEZpZWxkVXBkYXRlOwoKICAgICAgICAgICAgICAgICAgICAjIG9ubHkgU2VydmljZSBhbmQgU0xBIGZpZWxkcyBhY2NlcHRzIGVtcHR5IHZhbHVlcyBpZiB0aGUgaGFzaCBrZXkgaXMgbm90CiAgICAgICAgICAgICAgICAgICAgIyBkZWZpbmVkIHNldCBpdCB0byBlbXB0eSBzbyB0aGUgVGlja2V0KlNldCBmdW5jdGlvbiBjYWxsIHdpbGwgZ2V0IHRoZSBlbXB0eQogICAgICAgICAgICAgICAgICAgICMgdmFsdWUKICAgICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgICAgICggJFVwZGF0ZUZpZWxkTmFtZSBlcSAnU2VydmljZUlEJyB8fCAkVXBkYXRlRmllbGROYW1lIGVxICdTTEFJRCcgKQogICAgICAgICAgICAgICAgICAgICAgICAmJiAhZGVmaW5lZCAkVGlja2V0UGFyYW17ICRTZWxmLT57TmFtZVRvSUR9LT57JEN1cnJlbnRGaWVsZH0gfQogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAkVGlja2V0UGFyYW17ICRTZWxmLT57TmFtZVRvSUR9LT57JEN1cnJlbnRGaWVsZH0gfSA9ICcnOwogICAgICAgICAgICAgICAgICAgICAgICAkRmllbGRVcGRhdGUgPSAxOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgIyB1cGRhdGUgU2VydmljZSBhbiBTTEEgZmllbGRzIGlmIHRoZXkgaGF2ZSBhIGRlZmluZWQgdmFsdWUgKGV2ZW4gZW1wdHkpCiAgICAgICAgICAgICAgICAgICAgZWxzaWYgKCAkVXBkYXRlRmllbGROYW1lIGVxICdTZXJ2aWNlSUQnIHx8ICRVcGRhdGVGaWVsZE5hbWUgZXEgJ1NMQUlEJyApCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAkRmllbGRVcGRhdGUgPSAxOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgIyB1cGRhdGUgYW55IG90aGVyIGZpZWxkIHRoYXQgaXRzIHZhbHVlIGlzIGRlZmluZWQgYW5kIG5vdCBlbXB0eQogICAgICAgICAgICAgICAgICAgIGVsc2lmICgKICAgICAgICAgICAgICAgICAgICAgICAgJFVwZGF0ZUZpZWxkTmFtZSBuZSAnU2VydmljZUlEJwogICAgICAgICAgICAgICAgICAgICAgICAmJiAkVXBkYXRlRmllbGROYW1lIG5lICdTTEFJRCcKICAgICAgICAgICAgICAgICAgICAgICAgJiYgZGVmaW5lZCAkVGlja2V0UGFyYW17ICRTZWxmLT57TmFtZVRvSUR9LT57JEN1cnJlbnRGaWVsZH0gfQogICAgICAgICAgICAgICAgICAgICAgICAmJiAkVGlja2V0UGFyYW17ICRTZWxmLT57TmFtZVRvSUR9LT57JEN1cnJlbnRGaWVsZH0gfSBuZSAnJwogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAkRmllbGRVcGRhdGUgPSAxOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgJFN1Y2Nlc3MgPSAxOwoKICAgICAgICAgICAgICAgICAgICAjIGNoZWNrIGlmIGZpZWxkIG5lZWRzIHRvIGJlIHVwZGF0ZWQKICAgICAgICAgICAgICAgICAgICBpZiAoJEZpZWxkVXBkYXRlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRTdWNjZXNzID0gJFRpY2tldE9iamVjdC0+JFRpY2tldEZpZWxkU2V0U3ViKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFVwZGF0ZUZpZWxkTmFtZSA9PiAkVGlja2V0UGFyYW17ICRTZWxmLT57TmFtZVRvSUR9LT57JEN1cnJlbnRGaWVsZH0gfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRpY2tldElEICAgICAgICAgPT4gJFRpY2tldElELAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVXNlcklEICAgICAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgICAgICAgICAjIGluIGNhc2Ugb2YgYSBuZXcgc2VydmljZSBhbmQgbm8gbmV3IFNMQSBpcyB0byBiZSBzZXQsIGNoZWNrIGlmIGN1cnJlbnQKICAgICAgICAgICAgICAgICAgICAgICAgIyBhc3NpZ25lZCBTTEEgaXMgc3RpbGwgdmFsaWQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFVwZGF0ZUZpZWxkTmFtZSBlcSAnU2VydmljZUlEJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJiYgIWRlZmluZWQgJFRpY2tldFBhcmFte1NMQUlEfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBnZXQgdGlja2V0IGRldGFpbHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15ICVUaWNrZXQgPSAkVGlja2V0T2JqZWN0LT5UaWNrZXRHZXQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGlja2V0SUQgICAgICA9PiAkVGlja2V0SUQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkcyA9PiAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFVzZXJJRCAgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGlmIHRpY2tldCBhbHJlYWR5IGhhdmUgYW4gU0xBIGFzc2lnbmVkIGdldCB0aGUgbGlzdCBTTEFzIGZvciB0aGUgbmV3CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHNlcnZpY2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggSXNQb3NpdGl2ZUludGVnZXIoICRUaWNrZXR7U0xBSUR9ICkgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXkgJVNMQUxpc3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6U0xBJyktPlNMQUxpc3QoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlcnZpY2VJRCA9PiAkVGlja2V0UGFyYW17ICRTZWxmLT57TmFtZVRvSUR9LT57JEN1cnJlbnRGaWVsZH0gfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXNlcklEICAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGlmIHRoZSBjdXJyZW50IFNMQSBpcyBub3QgaW4gdGhlIGxpc3Qgb2YgU0xBIGZvciBuZXcgc2VydmljZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgcmVtb3ZlIFNMQSBmcm9tIHRpY2tldAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggISRTTEFMaXN0eyAkVGlja2V0e1NMQUlEfSB9ICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVGlja2V0T2JqZWN0LT5UaWNrZXRTTEFTZXQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTTEFJRCAgICA9PiAnJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRpY2tldElEID0+ICRUaWNrZXRJRCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFVzZXJJRCAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCAhJFN1Y2Nlc3MgKSB7CiAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5GYXRhbEVycm9yKAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKAogICAgICAgICAgICAgICAgICAgICAgICAnQ291bGQgbm90IHNldCAlcyBmb3IgVGlja2V0IHdpdGggSUQgIiVzIiBpbiBBY3Rpdml0eURpYWxvZyAiJXMiIScsCiAgICAgICAgICAgICAgICAgICAgICAgICRDdXJyZW50RmllbGQsCiAgICAgICAgICAgICAgICAgICAgICAgICRUaWNrZXRJRCwKICAgICAgICAgICAgICAgICAgICAgICAgJEFjdGl2aXR5RGlhbG9nRW50aXR5SUQsCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgIyBnZXQgdGhlIGxpbmsgdGlja2V0IGlkIGlmIGdpdmVuCiAgICBteSAkTGlua1RpY2tldElEID0gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0xpbmtUaWNrZXRJRCcgKSB8fCAnJzsKCiAgICAjIGdldCBzY3JlZW4gY29uZmlnCiAgICBteSAkQ29uZmlnID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKS0+R2V0KCJUaWNrZXQ6OkZyb250ZW5kOjokU2VsZi0+e0FjdGlvbn0iKTsKCiAgICAjIGxpbmsgdGlja2V0cwogICAgaWYgKAogICAgICAgICRMaW5rVGlja2V0SUQKICAgICAgICAmJiAkQ29uZmlnLT57U3BsaXRMaW5rVHlwZX0KICAgICAgICAmJiAkQ29uZmlnLT57U3BsaXRMaW5rVHlwZX0tPntMaW5rVHlwZX0KICAgICAgICAmJiAkQ29uZmlnLT57U3BsaXRMaW5rVHlwZX0tPntEaXJlY3Rpb259CiAgICAgICAgKQogICAgewoKICAgICAgICBteSAkQWNjZXNzID0gJFRpY2tldE9iamVjdC0+VGlja2V0UGVybWlzc2lvbigKICAgICAgICAgICAgVHlwZSAgICAgPT4gJ3JvJywKICAgICAgICAgICAgVGlja2V0SUQgPT4gJExpbmtUaWNrZXRJRCwKICAgICAgICAgICAgVXNlcklEICAgPT4gJFNlbGYtPntVc2VySUR9CiAgICAgICAgKTsKCiAgICAgICAgaWYgKCAhJEFjY2VzcyApIHsKICAgICAgICAgICAgcmV0dXJuICRMYXlvdXRPYmplY3QtPk5vUGVybWlzc2lvbigKICAgICAgICAgICAgICAgIE1lc3NhZ2UgICAgPT4gIllvdSBuZWVkIHJvIHBlcm1pc3Npb24hIiwKICAgICAgICAgICAgICAgIFdpdGhIZWFkZXIgPT4gJ3llcycsCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICBteSAkU291cmNlS2V5ID0gJExpbmtUaWNrZXRJRDsKICAgICAgICBteSAkVGFyZ2V0S2V5ID0gJFRpY2tldElEOwoKICAgICAgICBpZiAoICRDb25maWctPntTcGxpdExpbmtUeXBlfS0+e0RpcmVjdGlvbn0gZXEgJ1NvdXJjZScgKSB7CiAgICAgICAgICAgICRTb3VyY2VLZXkgPSAkVGlja2V0SUQ7CiAgICAgICAgICAgICRUYXJnZXRLZXkgPSAkTGlua1RpY2tldElEOwogICAgICAgIH0KCiAgICAgICAgIyBsaW5rIHRoZSB0aWNrZXRzCiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxpbmtPYmplY3QnKS0+TGlua0FkZCgKICAgICAgICAgICAgU291cmNlT2JqZWN0ID0+ICdUaWNrZXQnLAogICAgICAgICAgICBTb3VyY2VLZXkgICAgPT4gJFNvdXJjZUtleSwKICAgICAgICAgICAgVGFyZ2V0T2JqZWN0ID0+ICdUaWNrZXQnLAogICAgICAgICAgICBUYXJnZXRLZXkgICAgPT4gJFRhcmdldEtleSwKICAgICAgICAgICAgVHlwZSAgICAgICAgID0+ICRDb25maWctPntTcGxpdExpbmtUeXBlfS0+e0xpbmtUeXBlfSB8fCAnTm9ybWFsJywKICAgICAgICAgICAgU3RhdGUgICAgICAgID0+ICdWYWxpZCcsCiAgICAgICAgICAgIFVzZXJJRCAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgKTsKICAgIH0KCiAgICBpZiAoJE5ld093bmVySUQpIHsKICAgICAgICAkVGlja2V0T2JqZWN0LT5UaWNrZXRPd25lclNldCgKICAgICAgICAgICAgVGlja2V0SUQgID0+ICRUaWNrZXRJRCwKICAgICAgICAgICAgTmV3VXNlcklEID0+ICROZXdPd25lcklELAogICAgICAgICAgICBVc2VySUQgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICk7CiAgICB9CgogICAgIyBUcmFuc2l0aW9ucyB3aWxsIGJlIGhhbmRsZWQgYnkgdGlja2V0IGV2ZW50IG1vZHVsZSAoVGlja2V0UHJvY2Vzc1RyYW5zaXRpb25zLnBtKS4KCiAgICAjIGlmIHdlIHdlcmUgdXBkYXRpbmcgYSB0aWNrZXQsIGNsb3NlIHRoZSBwb3AtdXAgYW5kIHJldHVybiB0byB6b29tCiAgICAjIGVsc2UgKG5ldyB0aWNrZXQpIGp1c3QgZ28gdG8gem9vbSB0byBzaG93IHRoZSBuZXcgdGlja2V0CiAgICBpZiAoJFVwZGF0ZVRpY2tldElEKSB7CgogICAgICAgICMgbG9hZCBuZXcgVVJMIGluIHBhcmVudCB3aW5kb3cgYW5kIGNsb3NlIHBvcC11cAogICAgICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5Qb3B1cENsb3NlKAogICAgICAgICAgICBVUkwgPT4gIkFjdGlvbj1BZ2VudFRpY2tldFpvb207VGlja2V0SUQ9JFVwZGF0ZVRpY2tldElEIiwKICAgICAgICApOwogICAgfQoKICAgIHJldHVybiAkTGF5b3V0T2JqZWN0LT5SZWRpcmVjdCgKICAgICAgICBPUCA9PiAiQWN0aW9uPUFnZW50VGlja2V0Wm9vbTtUaWNrZXRJRD0kVGlja2V0SUQiLAogICAgKTsKfQoKc3ViIF9EaXNwbGF5UHJvY2Vzc0xpc3QgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIElmIHdlIGhhdmUgYSBQcm9jZXNzRW50aXR5SUQKICAgICRQYXJhbXtFcnJvcnN9LT57UHJvY2Vzc0VudGl0eUlESW52YWxpZH0gPSAnIFNlcnZlckVycm9yJwogICAgICAgIGlmICggJFBhcmFte1Byb2Nlc3NFbnRpdHlJRH0gJiYgISRQYXJhbXtQcm9jZXNzTGlzdH0tPnsgJFBhcmFte1Byb2Nlc3NFbnRpdHlJRH0gfSApOwoKICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CiAgICBteSAkQ29uZmlnT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKTsKCiAgICBteSAkQ29uZmlnID0gJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpBZ2VudFRpY2tldFByb2Nlc3MnKTsKCiAgICAkUGFyYW17UHJvY2Vzc0xpc3R9ID0gJExheW91dE9iamVjdC0+QnVpbGRTZWxlY3Rpb24oCiAgICAgICAgQ2xhc3MgICAgICAgID0+ICdNb2Rlcm5pemUgVmFsaWRhdGVfUmVxdWlyZWQnIC4gKCAkUGFyYW17RXJyb3JzfS0+e1Byb2Nlc3NFbnRpdHlJREludmFsaWR9IHx8ICcgJyApLAogICAgICAgIERhdGEgICAgICAgICA9PiAkUGFyYW17UHJvY2Vzc0xpc3R9LAogICAgICAgIE5hbWUgICAgICAgICA9PiAnUHJvY2Vzc0VudGl0eUlEJywKICAgICAgICBTZWxlY3RlZElEICAgPT4gJFBhcmFte1Byb2Nlc3NFbnRpdHlJRH0sCiAgICAgICAgUG9zc2libGVOb25lID0+IDEsCiAgICAgICAgU29ydCAgICAgICAgID0+ICdBbHBoYW51bWVyaWNWYWx1ZScsCiAgICAgICAgVHJhbnNsYXRpb24gID0+IDEsCiAgICAgICAgVHJlZVZpZXcgICAgID0+ICRDb25maWctPntQcm9jZXNzTGlzdFRyZWVWaWV3fSB8fCAwLAogICAgICAgIEF1dG9Db21wbGV0ZSA9PiAnb2ZmJywKICAgICk7CgogICAgIyBhZGQgcmljaCB0ZXh0IGVkaXRvcgogICAgaWYgKCAkTGF5b3V0T2JqZWN0LT57QnJvd3NlclJpY2hUZXh0fSApIHsKCiAgICAgICAgIyB1c2UgaGVpZ2h0L3dpZHRoIGRlZmluZWQgZm9yIHRoaXMgc2NyZWVuCiAgICAgICAgJFBhcmFte1JpY2hUZXh0SGVpZ2h0fSA9ICRTZWxmLT57Q29uZmlnfS0+e1JpY2hUZXh0SGVpZ2h0fSB8fCAwOwogICAgICAgICRQYXJhbXtSaWNoVGV4dFdpZHRofSAgPSAkU2VsZi0+e0NvbmZpZ30tPntSaWNoVGV4dFdpZHRofSAgfHwgMDsKCiAgICAgICAgIyBzZXQgdXAgcmljaCB0ZXh0IGVkaXRvcgogICAgICAgICRMYXlvdXRPYmplY3QtPlNldFJpY2hUZXh0UGFyYW1ldGVycygKICAgICAgICAgICAgRGF0YSA9PiBcJVBhcmFtLAogICAgICAgICk7CiAgICB9CgogICAgaWYgKCAkUGFyYW17UHJlU2VsZWN0UHJvY2Vzc30gJiYgJFBhcmFte1Byb2Nlc3NJRH0gKSB7CgogICAgICAgICMgc2VuZCBkYXRhIHRvIEpTCiAgICAgICAgJExheW91dE9iamVjdC0+QWRkSlNEYXRhKAogICAgICAgICAgICBLZXkgICA9PiAnUHJvY2Vzc0lEJywKICAgICAgICAgICAgVmFsdWUgPT4gJFBhcmFte1Byb2Nlc3NJRH0sCiAgICAgICAgKTsKICAgIH0KCiAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICBOYW1lID0+ICdQcm9jZXNzTGlzdCcsCiAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgRm9ybUlEID0+ICRTZWxmLT57Rm9ybUlEfSwKICAgICAgICB9LAogICAgKTsKCiAgICAjIG9uIGluaXRpYWwgc2NyZWVuIGZyb20gbmF2YmFyIHRoZXJlIGlzIG5vIElzTWFpbldpbm93IGJ1dCBhbHNvIG5vIElzUHJvY2Vzc0Vucm9sbCwKICAgICMgdGhlbiBpdCBtdXN0IGJlIGEgTWFpbldpbmRvdwogICAgaWYgKCAhJFNlbGYtPntJc01haW5XaW5kb3d9ICYmICEkU2VsZi0+e0lzUHJvY2Vzc0Vucm9sbH0gKSB7CiAgICAgICAgJFNlbGYtPntJc01haW5XaW5kb3d9ID0gMTsKICAgIH0KCiAgICBteSAkVHlwZSA9ICRTZWxmLT57SXNNYWluV2luZG93fSA/ICcnIDogJ1NtYWxsJzsKCiAgICBteSAkT3V0cHV0ID0gJExheW91dE9iamVjdC0+SGVhZGVyKAogICAgICAgIFR5cGUgPT4gJFR5cGUsCiAgICApOwogICAgaWYgKCAkU2VsZi0+e0lzTWFpbldpbmRvd30gKSB7CiAgICAgICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5OYXZpZ2F0aW9uQmFyKCk7CiAgICB9CgogICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5PdXRwdXQoCiAgICAgICAgVGVtcGxhdGVGaWxlID0+ICdBZ2VudFRpY2tldFByb2Nlc3MnIC4gJFR5cGUsCiAgICAgICAgRGF0YSAgICAgICAgID0+IHsKICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICBGb3JtSUQgICAgICAgICAgPT4gJFNlbGYtPntGb3JtSUR9LAogICAgICAgICAgICBJc1Byb2Nlc3NFbnJvbGwgPT4gJFNlbGYtPntJc1Byb2Nlc3NFbnJvbGx9LAogICAgICAgIH0sCiAgICApOwoKICAgICMgd29ya2Fyb3VuZCB3aGVuIGFjdGl2aXR5IGRpYWxvZyBpcyBsb2FkZWQgYnkgQUpBWCBhcyBmaXJzdCBhY3Rpdml0eSBkaWFsb2csIGlmIHRoZXJlIGlzCiAgICAjIGEgZGF0ZSBmaWVsZCBsaWtlIFBlbmRpbmcgVGltZSBvciBEeW5hbWljIEZpZWxkcyBEYXRlL1RpbWUgb3IgRGF0ZSwgdGhlcmUgaXMgbm8gd2F5IHRvIHNldAogICAgIyB0aGlzIG9wdGlvbnMgaW4gdGhlIGZvb3RlciBhZ2FpbgogICAgJExheW91dE9iamVjdC0+e0hhc0RhdGVwaWNrZXJ9ID0gMTsKCiAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPkZvb3RlciggVHlwZSA9PiAkVHlwZSApOwoKICAgIHJldHVybiAkT3V0cHV0Owp9CgojID1jdXQKIwojIF9DaGVja0ZpZWxkKCkKIwojIGNoZWNrcyBhbGwgdGhlIHBvc3NpYmxlIHRpY2tldCBmaWVsZHMgYW5kIHJldHVybnMgdGhlIElEIChpZiBwb3NzaWJsZSkgdmFsdWUgb2YgdGhlIGZpZWxkLCBpZiB2YWxpZAojIGFuZCBjaGVja3MgYXJlIHN1Y2Nlc3NmdWwKIwojIGlmIERpc3BsYXkgcGFyYW0gaXMgc2V0IHRvIDAgb3Igbm90IGdpdmVuLCBpdCB1c2VzIEFjdGl2aXR5RGlhbG9nIGZpZWxkIGRlZmF1bHQgdmFsdWUgZm9yIGFsbCBmaWVsZHMKIyBvciBnbG9iYWwgZGVmYXVsdCB2YWx1ZSBhcyBmYWxsLWJhY2sgb25seSBmb3IgY2VydGFpbiBmaWVsZHMKIwojIGlmIERpc3BsYXkgcGFyYW0gaXMgc2V0IHRvIDEgb3IgMiBpdCB1c2VzIHRoZSB2YWx1ZSBmcm9tIHRoZSB3ZWIgcmVxdWVzdAojCiMgICAgIG15ICRQcmlvcml0eUlEID0gJEFnZW50VGlja2V0UHJvY2Vzc09iamVjdC0+X0NoZWNrRmllbGQoCiMgICAgICAgICBGaWVsZCAgICAgICAgPT4gJ1ByaW9yaXR5SUQnLAojICAgICAgICAgRGlzcGxheSAgICAgID0+IDEsICAgICAgICAgICAgICAgICAgICMgb3B0aW9uYWwsIDAgb3IgMSBvciAyCiMgICAgICAgICBEZWZhdWx0VmFsdWUgPT4gJzMgbm9ybWFsJywgICAgICAgICAgIyBBY3Rpdml0eURpYWxvZyBmaWVsZCBkZWZhdWx0IHZhbHVlIChpdCB1c2VzIGdsb2JhbAojICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgICAgZGVmYXVsdCB2YWx1ZSBhcyBmYWxsIGJhY2sgZm9yIG1hbmRhdG9yeSBmaWVsZHMKIyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjICAgIChRdWV1ZSwgU2F0ZSwgTG9jayBhbmQgUHJpb3JpdHkpCiMgICAgICk7CiMKIyBSZXR1cm5zOgojICAgICAkUHJpb3JpdHlJRCA9IDE7ICAgICAgICAgICAgICAgICAgICAgICAgICMgaWYgUHJpb3JpdHlJRCBpcyBzZXQgdG8gMSBpbiB0aGUgd2ViIHJlcXVlc3QKIwojICAgICBteSAkUHJpb3JpdHlJRCA9ICRBZ2VudFRpY2tldFByb2Nlc3NPYmplY3QtPl9DaGVja0ZpZWxkKAojICAgICAgICAgRmllbGQgICAgICAgID0+ICdQcmlvcml0eUlEJywKIyAgICAgICAgIERpc3BsYXkgICAgICA9PiAwLAojICAgICAgICAgRGVmYXVsdFZhbHVlID0+ICczIG5vcm1hbCcsCiMgICAgICk7CiMKIyBSZXR1cm5zOgojICAgICAkUHJpb3JpdHlJRCA9IDM7ICAgICAgICAgICAgICAgICAgICAgICAgIyBzaW5jZSBBY3Rpdml0eURpYWxvZyBkZWZhdWx0IHZhbHVlIGlzICczIG5vcm1hbCcgYW5kCiMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjICAgICBmaWVsZCBpcyBoaWRkZW4KIwojID1jdXQKCnN1YiBfQ2hlY2tGaWVsZCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBmb3IgbXkgJE5lZWRlZCAocXcoRmllbGQpKSB7CiAgICAgICAgaWYgKCAhJFBhcmFteyROZWVkZWR9ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCAkTmVlZGVkISIKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICAjIHJlbW92ZSB0aGUgSUQgYW5kIGNoZWNrIGlmIHRoZSBnaXZlbiBmaWVsZCBpcyByZXF1aXJlZCBmb3IgY3JlYXRpbmcgYSB0aWNrZXQKICAgIG15ICRGaWVsZFdpdGhvdXRJRCA9ICRQYXJhbXtGaWVsZH07CiAgICAkRmllbGRXaXRob3V0SUQgPX4gc3tJRCR9e314bXM7CiAgICBteSAkVGlja2V0UmVxdWlyZWRGaWVsZCA9IHNjYWxhciBncmVwIHsgJF8gZXEgJEZpZWxkV2l0aG91dElEIH0gcXcoUXVldWUgU3RhdGUgTG9jayBQcmlvcml0eSk7CgogICAgbXkgJFZhbHVlOwoKICAgICMgZ2V0IG5lZWRlZCBvYmplY3RzCiAgICBteSAkUGFyYW1PYmplY3QgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OldlYjo6UmVxdWVzdCcpOwogICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKCiAgICAjIGlmIG5vIERpc3BsYXkgKG9yIERpc3BsYXkgPT0gMCkgaXMgY29tbWl0dGVkCiAgICBpZiAoICEkUGFyYW17RGlzcGxheX0gKSB7CgogICAgICAgICMgQ2hlY2sgaWYgYSBEZWZhdWx0VmFsdWUgaXMgZ2l2ZW4KICAgICAgICBpZiAoICRQYXJhbXtEZWZhdWx0VmFsdWV9ICkgewoKICAgICAgICAgICAgIyBjaGVjayBpZiB0aGUgZ2l2ZW4gZmllbGQgcGFyYW0gaXMgdmFsaWQKICAgICAgICAgICAgJFZhbHVlID0gJFNlbGYtPl9Mb29rdXBWYWx1ZSgKICAgICAgICAgICAgICAgIEZpZWxkID0+ICRGaWVsZFdpdGhvdXRJRCwKICAgICAgICAgICAgICAgIFZhbHVlID0+ICRQYXJhbXtEZWZhdWx0VmFsdWV9LAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBpZiB3ZSBnb3QgYSByZXF1aXJlZCB0aWNrZXQgZmllbGQsIGNoZWNrIGlmIHdlIGdvdCBhIHZhbGlkIERlZmF1bHRWYWx1ZSBpbiB0aGUgU3lzQ29uZmlnCiAgICAgICAgaWYgKCAhJFZhbHVlICYmICRUaWNrZXRSZXF1aXJlZEZpZWxkICkgewogICAgICAgICAgICAkVmFsdWUgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpLT5HZXQoIlByb2Nlc3M6OkRlZmF1bHQkRmllbGRXaXRob3V0SUQiKTsKCiAgICAgICAgICAgIGlmICggISRWYWx1ZSApIHsKICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkZhdGFsRXJyb3IoCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgICdEZWZhdWx0IENvbmZpZyBmb3IgUHJvY2Vzczo6RGVmYXVsdCVzIG1pc3NpbmchJywKICAgICAgICAgICAgICAgICAgICAgICAgJEZpZWxkV2l0aG91dElELAogICAgICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewoKICAgICAgICAgICAgICAgICMgY2hlY2sgaWYgdGhlIGdpdmVuIGZpZWxkIHBhcmFtIGlzIHZhbGlkCiAgICAgICAgICAgICAgICAkVmFsdWUgPSAkU2VsZi0+X0xvb2t1cFZhbHVlKAogICAgICAgICAgICAgICAgICAgIEZpZWxkID0+ICRGaWVsZFdpdGhvdXRJRCwKICAgICAgICAgICAgICAgICAgICBWYWx1ZSA9PiAkVmFsdWUsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgaWYgKCAhJFZhbHVlICkgewogICAgICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkZhdGFsRXJyb3IoCiAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0RlZmF1bHQgQ29uZmlnIGZvciBQcm9jZXNzOjpEZWZhdWx0JXMgaW52YWxpZCEnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJEZpZWxkV2l0aG91dElELAogICAgICAgICAgICAgICAgICAgICAgICApLAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBlbHNpZiAoICRQYXJhbXtEaXNwbGF5fSA9PSAxICkgewoKICAgICAgICAjIERpc3BsYXkgPT0gMSBpcyBsb2dpY2FsaXR5IG5vdCBwb3NzaWJsZSBmb3IgYSB0aWNrZXQgcmVxdWlyZWQgZmllbGQKICAgICAgICBpZiAoJFRpY2tldFJlcXVpcmVkRmllbGQpIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+RmF0YWxFcnJvcigKICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKAogICAgICAgICAgICAgICAgICAgICdXcm9uZyBBY3Rpdml0eURpYWxvZyBGaWVsZCBjb25maWc6ICVzIGNhblwndCBiZSBEaXNwbGF5ID0+IDEgLyBTaG93IGZpZWxkIChQbGVhc2UgY2hhbmdlIGl0cyBjb25maWd1cmF0aW9uIHRvIGJlIERpc3BsYXkgPT4gMCAvIERvIG5vdCBzaG93IGZpZWxkIG9yIERpc3BsYXkgPT4gMiAvIFNob3cgZmllbGQgYXMgbWFuZGF0b3J5KSEnLAogICAgICAgICAgICAgICAgICAgICRQYXJhbXtGaWVsZH0sCiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBjaGVjayBpZiB0aGUgZ2l2ZW4gZmllbGQgcGFyYW0gaXMgdmFsaWQKICAgICAgICBpZiAoICRQYXJhbXtGaWVsZH0gZXEgJ0FydGljbGUnICkgewoKICAgICAgICAgICAgJFZhbHVlID0gMTsKCiAgICAgICAgICAgIG15ICggJEJvZHksICRTdWJqZWN0LCAkQXR0YWNobWVudEV4aXN0cywgJFRpbWVVbml0cyApID0gKAogICAgICAgICAgICAgICAgJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0JvZHknICksCiAgICAgICAgICAgICAgICAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnU3ViamVjdCcgKSwKICAgICAgICAgICAgICAgICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdBdHRhY2htZW50RXhpc3RzJyApLAogICAgICAgICAgICAgICAgJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ1RpbWVVbml0cycgKQogICAgICAgICAgICApOwoKICAgICAgICAgICAgIyBJZiBhdHRhY2htZW50IGV4aXN0cyBhbmQgYm9keSBhbmQgc3ViamVjdCBub3QsIGl0IGlzIGVycm9yIChzZWUgYnVnIzEzMDgxKS4KICAgICAgICAgICAgaWYgKCAkQXR0YWNobWVudEV4aXN0cyAmJiAoICEkQm9keSAmJiAhJFN1YmplY3QgKSApIHsKICAgICAgICAgICAgICAgICRWYWx1ZSA9IDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgSWYgdGltZSB1bml0cyBleGlzdHMgYW5kIGJvZHkgYW5kIHN1YmplY3Qgbm90LCBpdCBpcyBlcnJvciAoc2VlIGJ1ZyMxMzI2NikuCiAgICAgICAgICAgIGlmICggJFRpbWVVbml0cyAmJiAoICEkQm9keSAmJiAhJFN1YmplY3QgKSApIHsKICAgICAgICAgICAgICAgICRWYWx1ZSA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CgogICAgICAgICAgICAkVmFsdWUgPSAkU2VsZi0+X0xvb2t1cFZhbHVlKAogICAgICAgICAgICAgICAgRmllbGQgPT4gJFBhcmFte0ZpZWxkfSwKICAgICAgICAgICAgICAgIFZhbHVlID0+ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICRQYXJhbXtGaWVsZH0gKSB8fCAnJywKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CiAgICBlbHNpZiAoICRQYXJhbXtEaXNwbGF5fSA9PSAyICkgewoKICAgICAgICAjIGNoZWNrIGlmIHRoZSBnaXZlbiBmaWVsZCBwYXJhbSBpcyB2YWxpZAogICAgICAgIGlmICggJFBhcmFte0ZpZWxkfSBlcSAnQXJ0aWNsZScgKSB7CgogICAgICAgICAgICBteSAoICRCb2R5LCAkU3ViamVjdCApID0gKAogICAgICAgICAgICAgICAgJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJ0JvZHknICksCiAgICAgICAgICAgICAgICAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnU3ViamVjdCcgKQogICAgICAgICAgICApOwoKICAgICAgICAgICAgJFZhbHVlID0gMDsKICAgICAgICAgICAgaWYgKCAkQm9keSAmJiAkU3ViamVjdCApIHsKICAgICAgICAgICAgICAgICRWYWx1ZSA9IDE7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRWYWx1ZSA9ICRTZWxmLT5fTG9va3VwVmFsdWUoCiAgICAgICAgICAgICAgICBGaWVsZCA9PiAkUGFyYW17RmllbGR9LAogICAgICAgICAgICAgICAgVmFsdWUgPT4gJFBhcmFtT2JqZWN0LT5HZXRQYXJhbSggUGFyYW0gPT4gJFBhcmFte0ZpZWxkfSApIHx8ICcnLAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gJFZhbHVlOwp9CgojID1jdXQKIwojIF9Mb29rdXBWYWx1ZSgpCiMKIyByZXR1cm5zIHRoZSBJRCAoaWYgcG9zc2libGUpIG9mIG5lYXJseSBhbGwgdGlja2V0IGZpZWxkcyBhbmQvb3IgY2hlY2tzIGlmIGl0cyB2YWxpZC4KIyBDYW4gaGFuZGxlIElEcyBvciBTdHJpbmdzLgojIEN1cnJlbnRseSB3b3JraW5nIHdpdGg6IFN0YXRlLCBRdWV1ZSwgTG9jaywgUHJpb3JpdHkgKHBvc3NpYmxlIG1vcmUpLgojCiMgICAgIG15ICRQcmlvcml0eUlEID0gJEFnZW50VGlja2V0UHJvY2Vzc09iamVjdC0+X0xvb2t1cFZhbHVlKAojICAgICAgICAgUHJpb3JpdHlJRCA9PiAxLAojICAgICApOwojICAgICAkUHJpb3JpdHlJRCA9IDE7CiMKIyAgICAgbXkgJFN0YXRlSUQgPSAkQWdlbnRUaWNrZXRQcm9jZXNzT2JqZWN0LT5fTG9va3VwVmFsdWUoCiMgICAgICAgICBTdGF0ZSA9PiAnb3BlbicsCiMgICAgICk7CiMgICAgICRTdGF0ZUlEID0gMzsKIwojICAgICBteSAkUHJpb3JpdHlJRCA9ICRBZ2VudFRpY2tldFByb2Nlc3NPYmplY3QtPl9Mb29rdXBWYWx1ZSgKIyAgICAgICAgIFByaW9yaXR5ID0+ICd1bmtub3ducHJpb3JpdHkxMjM0JywKIyAgICAgKTsKIyAgICAgJFByaW9yaXR5SUQgPSB1bmRlZjsKIwojID1jdXQKCnN1YiBfTG9va3VwVmFsdWUgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGdldCBsb2cgb2JqZWN0CiAgICBteSAkTG9nT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBmb3IgbXkgJE5lZWRlZCAocXcoRmllbGQgVmFsdWUpKSB7CiAgICAgICAgaWYgKCAhZGVmaW5lZCAkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgICRMb2dPYmplY3QtPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCAkTmVlZGVkISIKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICBpZiAoICEkUGFyYW17RmllbGR9ICkgewogICAgICAgICRMb2dPYmplY3QtPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gIkZpZWxkIHNob3VsZCBub3QgYmUgZW1wdHkhIgogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgaWYgdGhlcmUgaXMgbm8gdmFsdWUsIHRoZXJlIGlzIG5vdGhpbmcgdG8gZG8KICAgIHJldHVybiBpZiAhJFBhcmFte1ZhbHVlfTsKCiAgICAjIHJlbW92ZSB0aGUgSUQgZm9yIGZ1bmN0aW9uIG5hbWUgcHVycG9zZQogICAgbXkgJEZpZWxkV2l0aG91dElEID0gJFBhcmFte0ZpZWxkfTsKICAgICRGaWVsZFdpdGhvdXRJRCA9fiBze0lEJH17fXhtczsKCiAgICBteSAkTG9va3VwRmllbGROYW1lOwogICAgbXkgJE9iamVjdE5hbWU7CiAgICBteSAkRnVuY3Rpb25OYW1lOwoKICAgICMgb3duZXIoSUQpIGFuZCByZXNwb25zaWJsZShJRCkgbG9va3VwIG5lZWRzIFVzZXJJRCBhcyBwYXJhbWV0ZXIKICAgIGlmICggc2NhbGFyIGdyZXAgeyAkUGFyYW17RmllbGR9IGVxICRfIH0gcXcoIE93bmVySUQgUmVzcG9uc2libGVJRCApICkgewogICAgICAgICRMb29rdXBGaWVsZE5hbWUgPSAnVXNlcklEJzsKICAgICAgICAkT2JqZWN0TmFtZSAgICAgID0gJ1VzZXInOwogICAgICAgICRGdW5jdGlvbk5hbWUgICAgPSAnVXNlckxvb2t1cCc7CiAgICB9CgogICAgIyBvd25lciBhbmQgcmVzcG9uc2libGUgbG9va3VwIG5lZWRzIFVzZXJMb2dpbiBhcyBwYXJhbWV0ZXIKICAgIGVsc2lmICggc2NhbGFyIGdyZXAgeyAkUGFyYW17RmllbGR9IGVxICRfIH0gcXcoIE93bmVyIFJlc3BvbnNpYmxlICkgKSB7CiAgICAgICAgJExvb2t1cEZpZWxkTmFtZSA9ICdVc2VyTG9naW4nOwogICAgICAgICRPYmplY3ROYW1lICAgICAgPSAnVXNlcic7CiAgICAgICAgJEZ1bmN0aW9uTmFtZSAgICA9ICdVc2VyTG9va3VwJzsKICAgIH0KCiAgICAjIHNlcnZpY2UgYW5kIFNMQSBsb29rdXAgbmVlZHMgTmFtZSBhcyBwYXJhbWV0ZXIgKFdoaWxlIFNlcnZpY2VJRCBhbiBTTEFJRCB1c2VzIHN0YW5kYXJkKQogICAgZWxzaWYgKCBzY2FsYXIgZ3JlcCB7ICRQYXJhbXtGaWVsZH0gZXEgJF8gfSBxdyggU2VydmljZSBTTEEgKSApIHsKICAgICAgICAkTG9va3VwRmllbGROYW1lID0gJ05hbWUnOwogICAgICAgICRPYmplY3ROYW1lICAgICAgPSAkRmllbGRXaXRob3V0SUQ7CiAgICAgICAgJEZ1bmN0aW9uTmFtZSAgICA9ICRGaWVsZFdpdGhvdXRJRCAuICdMb29rdXAnOwogICAgfQoKICAgICMgb3RoZXIgZmllbGRzIGNhbiB1c2Ugc3RhbmRhcmQgcGFyYW1ldGVyIG5hbWVzIGFzIFByaW9yaXR5IG9yIFByaW9yaXR5SUQKICAgIGVsc2UgewogICAgICAgICRMb29rdXBGaWVsZE5hbWUgPSAkUGFyYW17RmllbGR9OwogICAgICAgICRPYmplY3ROYW1lICAgICAgPSAkRmllbGRXaXRob3V0SUQ7CiAgICAgICAgJEZ1bmN0aW9uTmFtZSAgICA9ICRGaWVsZFdpdGhvdXRJRCAuICdMb29rdXAnOwogICAgfQoKICAgICMgZ2V0IGFwcHJvcHJpYXRlIG9iamVjdCBvZiBmaWVsZAogICAgbXkgJEZpZWxkT2JqZWN0OwogICAgaWYgKCAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TWFpbicpLT5SZXF1aXJlKCAnS2VybmVsOjpTeXN0ZW06OicgLiAkT2JqZWN0TmFtZSwgU2lsZW50ID0+IDEgKSApIHsKICAgICAgICAkRmllbGRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCAnS2VybmVsOjpTeXN0ZW06OicgLiAkT2JqZWN0TmFtZSApOwogICAgfQoKICAgIG15ICRWYWx1ZTsKCiAgICAjIGNoZWNrIGlmIHRoZSBiYWNrZW5kIG1vZHVsZSBoYXMgdGhlIG5lZWRlZCAqTG9va3VwIHN1YgogICAgaWYgKCAkRmllbGRPYmplY3QgJiYgJEZpZWxkT2JqZWN0LT5jYW4oJEZ1bmN0aW9uTmFtZSkgKSB7CgogICAgICAgICMgY2FsbCB0aGUgKkxvb2t1cCBzdWIgYW5kIGdldCB0aGUgdmFsdWUKICAgICAgICAkVmFsdWUgPSAkRmllbGRPYmplY3QtPiRGdW5jdGlvbk5hbWUoCiAgICAgICAgICAgICRMb29rdXBGaWVsZE5hbWUgPT4gJFBhcmFte1ZhbHVlfSwKICAgICAgICApOwogICAgfQoKICAgICMgaWYgd2UgZGlkbid0IGhhdmUgYW4gb2JqZWN0IGFuZCB0aGUgdmFsdWUgaGFzIG5vIHJlZiBhIHN0cmluZyBlLmcuIFRpdGxlIGFuZCBzbyBvbgogICAgIyByZXR1cm4gdHJ1ZQogICAgZWxzaWYgKCAkUGFyYW17RmllbGR9IGVxICRGaWVsZFdpdGhvdXRJRCAmJiAhcmVmICRQYXJhbXtWYWx1ZX0gKSB7CiAgICAgICAgcmV0dXJuICRQYXJhbXtWYWx1ZX07CiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkTG9nT2JqZWN0LT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJFcnJvciB3aGlsZSBjaGVja2luZyB3aXRoICIgLiAkRmllbGRXaXRob3V0SUQgLiAiT2JqZWN0ISIKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICByZXR1cm4gaWYgKCAhJFZhbHVlICk7CgogICAgIyByZXR1cm4gdGhlIGdpdmVuIElEIHZhbHVlIGlmIHRoZSAqTG9va3VwIHJlc3VsdCB3YXMgYSBzdHJpbmcKICAgIGlmICggJFBhcmFte0ZpZWxkfSBuZSAkRmllbGRXaXRob3V0SUQgKSB7CiAgICAgICAgcmV0dXJuICRQYXJhbXtWYWx1ZX07CiAgICB9CgogICAgIyByZXR1cm4gdGhlICpMb29rdXAgc3RyaW5nIHJldHVybiB2YWx1ZQogICAgcmV0dXJuICRWYWx1ZTsKfQoKc3ViIF9HZXRSZXNwb25zaWJsZXMgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGdldCB1c2VycwogICAgbXkgJVNob3duVXNlcnM7CiAgICBteSAlQWxsR3JvdXBzTWVtYmVycyA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpVc2VyJyktPlVzZXJMaXN0KAogICAgICAgIFR5cGUgID0+ICdMb25nJywKICAgICAgICBWYWxpZCA9PiAxLAogICAgKTsKCiAgICAjIGdldCBuZWVkZWQgb2JqZWN0cwogICAgbXkgJFRpY2tldE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpUaWNrZXQnKTsKICAgIG15ICRRdWV1ZU9iamVjdCAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6UXVldWUnKTsKICAgIG15ICRHcm91cE9iamVjdCAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6R3JvdXAnKTsKICAgIG15ICRDb25maWdPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpOwoKICAgICMgR2V0IGF2YWlsYWJsZSBwZXJtaXNzaW9ucyBhbmQgc2V0IHBlcm1pc3Npb24gZ3JvdXAgdHlwZSBhY2NvcmRpbmdseS4KICAgIG15ICRDb25maWdQZXJtaXNzaW9ucyAgID0gJENvbmZpZ09iamVjdC0+R2V0KCdTeXN0ZW06OlBlcm1pc3Npb24nKTsKICAgIG15ICRQZXJtaXNzaW9uR3JvdXBUeXBlID0gKCBncmVwIHsgJF8gZXEgJ3Jlc3BvbnNpYmxlJyB9IEB7JENvbmZpZ1Blcm1pc3Npb25zfSApID8gJ3Jlc3BvbnNpYmxlJyA6ICdydyc7CgogICAgIyBpZiB3ZSBhcmUgdXBkYXRpbmcgYSB0aWNrZXQgc2hvdyB0aGUgZnVsbCBsaXN0IG9mIHBvc3NpYmxlIHJlc3BvbnNpYmxlcwogICAgaWYgKCAkUGFyYW17VGlja2V0SUR9ICkgewogICAgICAgIGlmICggJFBhcmFte1F1ZXVlSUR9ICYmICEkUGFyYW17QWxsVXNlcnN9ICkgewogICAgICAgICAgICBteSAkR0lEICAgICAgICA9ICRRdWV1ZU9iamVjdC0+R2V0UXVldWVHcm91cElEKCBRdWV1ZUlEID0+ICRQYXJhbXtRdWV1ZUlEfSApOwogICAgICAgICAgICBteSAlTWVtYmVyTGlzdCA9ICRHcm91cE9iamVjdC0+UGVybWlzc2lvbkdyb3VwR2V0KAogICAgICAgICAgICAgICAgR3JvdXBJRCA9PiAkR0lELAogICAgICAgICAgICAgICAgVHlwZSAgICA9PiAkUGVybWlzc2lvbkdyb3VwVHlwZSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgZm9yIG15ICRVc2VySUQgKCBzb3J0IGtleXMgJU1lbWJlckxpc3QgKSB7CiAgICAgICAgICAgICAgICAkU2hvd25Vc2Vyc3skVXNlcklEfSA9ICRBbGxHcm91cHNNZW1iZXJzeyRVc2VySUR9OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgZWxzZSB7CgogICAgICAgICMgdGhlIFN0YXJ0QWN0aXZpdHlEaWFsb2cgZG9lcyBub3QgcHJvdmlkZSBhIFRpY2tldElEIGFuZCBpdCBjb3VsZCBiZSB0aGF0IGFsc28gdGhlcmUKICAgICAgICAjIGlzIG5vIFF1ZXVlSUQgaW5mb3JtYXRpb24uIEdldCB0aGUgZGVmYXVsdCBRdWV1ZUlEIGZvciB0aGlzIG1hdHRlcnMuCiAgICAgICAgaWYgKCAhJFBhcmFte1F1ZXVlSUR9ICkgewogICAgICAgICAgICBteSAkUXVldWUgICA9ICRDb25maWdPYmplY3QtPkdldCgiUHJvY2Vzczo6RGVmYXVsdFF1ZXVlIik7CiAgICAgICAgICAgIG15ICRRdWV1ZUlEID0gJFF1ZXVlT2JqZWN0LT5RdWV1ZUxvb2t1cCggUXVldWUgPT4gJFF1ZXVlICk7CiAgICAgICAgICAgIGlmICgkUXVldWVJRCkgewogICAgICAgICAgICAgICAgJFBhcmFte1F1ZXVlSUR9ID0gJFF1ZXVlSUQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMganVzdCBzaG93IG9ubHkgdXNlcnMgd2l0aCBzZWxlY3RlZCBjdXN0b20gcXVldWUKICAgICAgICBpZiAoICRQYXJhbXtRdWV1ZUlEfSAmJiAhJFBhcmFte1Jlc3BvbnNpYmxlQWxsfSApIHsKICAgICAgICAgICAgbXkgQFVzZXJJRHMgPSAkVGlja2V0T2JqZWN0LT5HZXRTdWJzY3JpYmVkVXNlcklEc0J5UXVldWVJRCglUGFyYW0pOwogICAgICAgICAgICBmb3IgbXkgJEtleUdyb3VwTWVtYmVyICggc29ydCBrZXlzICVBbGxHcm91cHNNZW1iZXJzICkgewogICAgICAgICAgICAgICAgbXkgJEhpdCA9IDA7CiAgICAgICAgICAgICAgICBmb3IgbXkgJFVJRCAoQFVzZXJJRHMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoICRVSUQgZXEgJEtleUdyb3VwTWVtYmVyICkgewogICAgICAgICAgICAgICAgICAgICAgICAkSGl0ID0gMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoICEkSGl0ICkgewogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSAkQWxsR3JvdXBzTWVtYmVyc3skS2V5R3JvdXBNZW1iZXJ9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIHNob3cgYWxsIHN5c3RlbSB1c2VycwogICAgICAgIGlmICggJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkNoYW5nZU93bmVyVG9FdmVyeW9uZScpICkgewogICAgICAgICAgICAlU2hvd25Vc2VycyA9ICVBbGxHcm91cHNNZW1iZXJzOwogICAgICAgIH0KCiAgICAgICAgIyBzaG93IGFsbCBzdWJzY3JpYmVkIHVzZXJzIHdobyBoYXZlIHRoZSBhcHByb3ByaWF0ZSBwZXJtaXNzaW9uIGluIHRoZSBxdWV1ZSBncm91cAogICAgICAgIGVsc2lmICggJFBhcmFte1F1ZXVlSUR9ICkgewogICAgICAgICAgICBteSAkR0lEICAgICAgICA9ICRRdWV1ZU9iamVjdC0+R2V0UXVldWVHcm91cElEKCBRdWV1ZUlEID0+ICRQYXJhbXtRdWV1ZUlEfSApOwogICAgICAgICAgICBteSAlTWVtYmVyTGlzdCA9ICRHcm91cE9iamVjdC0+UGVybWlzc2lvbkdyb3VwR2V0KAogICAgICAgICAgICAgICAgR3JvdXBJRCA9PiAkR0lELAogICAgICAgICAgICAgICAgVHlwZSAgICA9PiAkUGVybWlzc2lvbkdyb3VwVHlwZSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgZm9yIG15ICRLZXlNZW1iZXIgKCBzb3J0IGtleXMgJU1lbWJlckxpc3QgKSB7CiAgICAgICAgICAgICAgICBpZiAoICRBbGxHcm91cHNNZW1iZXJzeyRLZXlNZW1iZXJ9ICkgewogICAgICAgICAgICAgICAgICAgICRTaG93blVzZXJzeyRLZXlNZW1iZXJ9ID0gJEFsbEdyb3Vwc01lbWJlcnN7JEtleU1lbWJlcn07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgIyB3b3JrZmxvdwogICAgbXkgJEFDTCA9ICRUaWNrZXRPYmplY3QtPlRpY2tldEFjbCgKICAgICAgICAlUGFyYW0sCiAgICAgICAgQWN0aW9uICAgICAgICA9PiAkU2VsZi0+e0FjdGlvbn0sCiAgICAgICAgUmV0dXJuVHlwZSAgICA9PiAnVGlja2V0JywKICAgICAgICBSZXR1cm5TdWJUeXBlID0+ICdSZXNwb25zaWJsZScsCiAgICAgICAgRGF0YSAgICAgICAgICA9PiBcJVNob3duVXNlcnMsCiAgICAgICAgVXNlcklEICAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICApOwoKICAgIHJldHVybiB7ICRUaWNrZXRPYmplY3QtPlRpY2tldEFjbERhdGEoKSB9IGlmICRBQ0w7CgogICAgcmV0dXJuIFwlU2hvd25Vc2VyczsKfQoKc3ViIF9HZXRPd25lcnMgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGdldCB1c2VycwogICAgbXkgJVNob3duVXNlcnM7CiAgICBteSAlQWxsR3JvdXBzTWVtYmVycyA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpVc2VyJyktPlVzZXJMaXN0KAogICAgICAgIFR5cGUgID0+ICdMb25nJywKICAgICAgICBWYWxpZCA9PiAxLAogICAgKTsKCiAgICAjIGdldCBuZWVkZWQgb2JqZWN0cwogICAgbXkgJFRpY2tldE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpUaWNrZXQnKTsKICAgIG15ICRRdWV1ZU9iamVjdCAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6UXVldWUnKTsKICAgIG15ICRHcm91cE9iamVjdCAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6R3JvdXAnKTsKICAgIG15ICRDb25maWdPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpOwoKICAgICMgR2V0IGF2YWlsYWJsZSBwZXJtaXNzaW9ucyBhbmQgc2V0IHBlcm1pc3Npb24gZ3JvdXAgdHlwZSBhY2NvcmRpbmdseS4KICAgIG15ICRDb25maWdQZXJtaXNzaW9ucyAgID0gJENvbmZpZ09iamVjdC0+R2V0KCdTeXN0ZW06OlBlcm1pc3Npb24nKTsKICAgIG15ICRQZXJtaXNzaW9uR3JvdXBUeXBlID0gKCBncmVwIHsgJF8gZXEgJ293bmVyJyB9IEB7JENvbmZpZ1Blcm1pc3Npb25zfSApID8gJ293bmVyJyA6ICdydyc7CgogICAgIyBpZiB3ZSBhcmUgdXBkYXRpbmcgYSB0aWNrZXQgc2hvdyB0aGUgZnVsbCBsaXN0IG9mIHBvc3NpYmxlIG93bmVycwogICAgaWYgKCAkUGFyYW17VGlja2V0SUR9ICkgewogICAgICAgIGlmICggJFBhcmFte1F1ZXVlSUR9ICYmICEkUGFyYW17QWxsVXNlcnN9ICkgewogICAgICAgICAgICBteSAkR0lEICAgICAgICA9ICRRdWV1ZU9iamVjdC0+R2V0UXVldWVHcm91cElEKCBRdWV1ZUlEID0+ICRQYXJhbXtRdWV1ZUlEfSApOwogICAgICAgICAgICBteSAlTWVtYmVyTGlzdCA9ICRHcm91cE9iamVjdC0+UGVybWlzc2lvbkdyb3VwR2V0KAogICAgICAgICAgICAgICAgR3JvdXBJRCA9PiAkR0lELAogICAgICAgICAgICAgICAgVHlwZSAgICA9PiAkUGVybWlzc2lvbkdyb3VwVHlwZSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgZm9yIG15ICRVc2VySUQgKCBzb3J0IGtleXMgJU1lbWJlckxpc3QgKSB7CiAgICAgICAgICAgICAgICAkU2hvd25Vc2Vyc3skVXNlcklEfSA9ICRBbGxHcm91cHNNZW1iZXJzeyRVc2VySUR9OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgZWxzZSB7CgogICAgICAgICMgdGhlIFN0YXJ0QWN0aXZpdHlEaWFsb2cgZG9lcyBub3QgcHJvdmlkZSBhIFRpY2tldElEIGFuZCBpdCBjb3VsZCBiZSB0aGF0IGFsc28gdGhlcmUKICAgICAgICAjIGlzIG5vIFF1ZXVlSUQgaW5mb3JtYXRpb24uIEdldCB0aGUgZGVmYXVsdCBRdWV1ZUlEIGZvciB0aGlzIG1hdHRlcnMuCiAgICAgICAgaWYgKCAhJFBhcmFte1F1ZXVlSUR9ICkgewogICAgICAgICAgICBteSAkUXVldWUgICA9ICRDb25maWdPYmplY3QtPkdldCgiUHJvY2Vzczo6RGVmYXVsdFF1ZXVlIik7CiAgICAgICAgICAgIG15ICRRdWV1ZUlEID0gJFF1ZXVlT2JqZWN0LT5RdWV1ZUxvb2t1cCggUXVldWUgPT4gJFF1ZXVlICk7CiAgICAgICAgICAgIGlmICgkUXVldWVJRCkgewogICAgICAgICAgICAgICAgJFBhcmFte1F1ZXVlSUR9ID0gJFF1ZXVlSUQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMganVzdCBzaG93IG9ubHkgdXNlcnMgd2l0aCBzZWxlY3RlZCBjdXN0b20gcXVldWUKICAgICAgICBpZiAoICRQYXJhbXtRdWV1ZUlEfSAmJiAhJFBhcmFte093bmVyQWxsfSApIHsKICAgICAgICAgICAgbXkgQFVzZXJJRHMgPSAkVGlja2V0T2JqZWN0LT5HZXRTdWJzY3JpYmVkVXNlcklEc0J5UXVldWVJRCglUGFyYW0pOwogICAgICAgICAgICBmb3IgbXkgJEtleUdyb3VwTWVtYmVyICggc29ydCBrZXlzICVBbGxHcm91cHNNZW1iZXJzICkgewogICAgICAgICAgICAgICAgbXkgJEhpdCA9IDA7CiAgICAgICAgICAgICAgICBmb3IgbXkgJFVJRCAoQFVzZXJJRHMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoICRVSUQgZXEgJEtleUdyb3VwTWVtYmVyICkgewogICAgICAgICAgICAgICAgICAgICAgICAkSGl0ID0gMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoICEkSGl0ICkgewogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSAkQWxsR3JvdXBzTWVtYmVyc3skS2V5R3JvdXBNZW1iZXJ9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIHNob3cgYWxsIHN5c3RlbSB1c2VycwogICAgICAgIGlmICggJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkNoYW5nZU93bmVyVG9FdmVyeW9uZScpICkgewogICAgICAgICAgICAlU2hvd25Vc2VycyA9ICVBbGxHcm91cHNNZW1iZXJzOwogICAgICAgIH0KCiAgICAgICAgIyBzaG93IGFsbCBzdWJzY3JpYmVkIHVzZXJzIHdobyBoYXZlIHRoZSBhcHByb3ByaWF0ZSBwZXJtaXNzaW9uIGluIHRoZSBxdWV1ZSBncm91cAogICAgICAgIGVsc2lmICggJFBhcmFte1F1ZXVlSUR9ICkgewogICAgICAgICAgICBteSAkR0lEICAgICAgICA9ICRRdWV1ZU9iamVjdC0+R2V0UXVldWVHcm91cElEKCBRdWV1ZUlEID0+ICRQYXJhbXtRdWV1ZUlEfSApOwogICAgICAgICAgICBteSAlTWVtYmVyTGlzdCA9ICRHcm91cE9iamVjdC0+UGVybWlzc2lvbkdyb3VwR2V0KAogICAgICAgICAgICAgICAgR3JvdXBJRCA9PiAkR0lELAogICAgICAgICAgICAgICAgVHlwZSAgICA9PiAkUGVybWlzc2lvbkdyb3VwVHlwZSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgZm9yIG15ICRLZXlNZW1iZXIgKCBzb3J0IGtleXMgJU1lbWJlckxpc3QgKSB7CiAgICAgICAgICAgICAgICBpZiAoICRBbGxHcm91cHNNZW1iZXJzeyRLZXlNZW1iZXJ9ICkgewogICAgICAgICAgICAgICAgICAgICRTaG93blVzZXJzeyRLZXlNZW1iZXJ9ID0gJEFsbEdyb3Vwc01lbWJlcnN7JEtleU1lbWJlcn07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgIyB3b3JrZmxvdwogICAgbXkgJEFDTCA9ICRUaWNrZXRPYmplY3QtPlRpY2tldEFjbCgKICAgICAgICAlUGFyYW0sCiAgICAgICAgQWN0aW9uICAgICAgICA9PiAkU2VsZi0+e0FjdGlvbn0sCiAgICAgICAgUmV0dXJuVHlwZSAgICA9PiAnVGlja2V0JywKICAgICAgICBSZXR1cm5TdWJUeXBlID0+ICdPd25lcicsCiAgICAgICAgRGF0YSAgICAgICAgICA9PiBcJVNob3duVXNlcnMsCiAgICAgICAgVXNlcklEICAgICAgICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICApOwoKICAgIHJldHVybiB7ICRUaWNrZXRPYmplY3QtPlRpY2tldEFjbERhdGEoKSB9IGlmICRBQ0w7CgogICAgcmV0dXJuIFwlU2hvd25Vc2VyczsKfQoKc3ViIF9HZXRTTEFzIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBnZXQgc2xhCiAgICBteSAlU0xBOwogICAgaWYgKCAkUGFyYW17U2VydmljZUlEfSAmJiAkUGFyYW17U2VydmljZXN9ICYmICV7ICRQYXJhbXtTZXJ2aWNlc30gfSApIHsKICAgICAgICBpZiAoICRQYXJhbXtTZXJ2aWNlc30tPnsgJFBhcmFte1NlcnZpY2VJRH0gfSApIHsKICAgICAgICAgICAgJVNMQSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpUaWNrZXQnKS0+VGlja2V0U0xBTGlzdCgKICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgIEFjdGlvbiA9PiAkU2VsZi0+e0FjdGlvbn0sCiAgICAgICAgICAgICAgICBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBcJVNMQTsKfQoKc3ViIF9HZXRTZXJ2aWNlcyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgZ2V0IHNlcnZpY2UKICAgIG15ICVTZXJ2aWNlOwoKICAgICMgY2hlY2sgbmVlZGVkCiAgICByZXR1cm4gXCVTZXJ2aWNlIGlmICEkUGFyYW17UXVldWVJRH0gJiYgISRQYXJhbXtUaWNrZXRJRH07CgogICAgIyBnZXQgb3B0aW9ucyBmb3IgZGVmYXVsdCBzZXJ2aWNlcyBmb3IgdW5rbm93biBjdXN0b21lcnMKICAgIG15ICREZWZhdWx0U2VydmljZVVua25vd25DdXN0b21lcgogICAgICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKS0+R2V0KCdUaWNrZXQ6OlNlcnZpY2U6OkRlZmF1bHQ6OlVua25vd25DdXN0b21lcicpOwoKICAgICMgY2hlY2sgaWYgbm8gQ3VzdG9tZXJVc2VySUQgaXMgc2VsZWN0ZWQKICAgICMgaWYgJERlZmF1bHRTZXJ2aWNlVW5rbm93bkN1c3RvbWVyID0gMCBsZWF2ZSBDdXN0b21lclVzZXJJRCBlbXB0eSwgaXQgd2lsbCBub3QgZ2V0IGFueSBzZXJ2aWNlcwogICAgIyBpZiAkRGVmYXVsdFNlcnZpY2VVbmtub3duQ3VzdG9tZXIgPSAxIHNldCBDdXN0b21lclVzZXJJRCB0byBnZXQgZGVmYXVsdCBzZXJ2aWNlcwogICAgaWYgKCAhJFBhcmFte0N1c3RvbWVyVXNlcklEfSAmJiAkRGVmYXVsdFNlcnZpY2VVbmtub3duQ3VzdG9tZXIgKSB7CiAgICAgICAgJFBhcmFte0N1c3RvbWVyVXNlcklEfSA9ICc8REVGQVVMVD4nOwogICAgfQoKICAgICMgZ2V0IHNlcnZpY2UgbGlzdAogICAgaWYgKCAkUGFyYW17Q3VzdG9tZXJVc2VySUR9ICkgewogICAgICAgICVTZXJ2aWNlID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpY2tldCcpLT5UaWNrZXRTZXJ2aWNlTGlzdCgKICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICBBY3Rpb24gPT4gJFNlbGYtPntBY3Rpb259LAogICAgICAgICAgICBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICk7CiAgICB9CiAgICByZXR1cm4gXCVTZXJ2aWNlOwp9CgpzdWIgX0dldExvY2tzIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJUxvY2tzID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvY2snKS0+TG9ja0xpc3QoCiAgICAgICAgVXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICk7CgogICAgcmV0dXJuIFwlTG9ja3M7Cn0KCnN1YiBfR2V0UHJpb3JpdGllcyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICVQcmlvcml0aWVzOwoKICAgICMgSW5pdGlhbGx5IHdlIGhhdmUganVzdCB0aGUgZGVmYXVsdCBRdWV1ZSBQYXJhbWV0ZXIKICAgICMgc28gbWFrZSBzdXJlIHRvIGdldCB0aGUgSUQgaW4gdGhhdCBjYXNlCiAgICBteSAkUXVldWVJRDsKICAgIGlmICggISRQYXJhbXtRdWV1ZUlEfSAmJiAkUGFyYW17UXVldWV9ICkgewogICAgICAgICRRdWV1ZUlEID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlF1ZXVlJyktPlF1ZXVlTG9va3VwKCBRdWV1ZSA9PiAkUGFyYW17UXVldWV9ICk7CiAgICB9CiAgICBpZiAoICRQYXJhbXtRdWV1ZUlEfSB8fCAkUXVldWVJRCB8fCAkUGFyYW17VGlja2V0SUR9ICkgewogICAgICAgICVQcmlvcml0aWVzID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpY2tldCcpLT5UaWNrZXRQcmlvcml0eUxpc3QoCiAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgQWN0aW9uID0+ICRTZWxmLT57QWN0aW9ufSwKICAgICAgICAgICAgVXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICApOwoKICAgIH0KICAgIHJldHVybiBcJVByaW9yaXRpZXM7Cn0KCnN1YiBfR2V0UXVldWVzIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayB3aGljaCB0eXBlIG9mIHBlcm1pc3Npb24gaXMgbmVlZGVkOiBpZiB0aGUgcHJvY2VzcyB0aWNrZXQKICAgICMgYWxyZWFkeSBleGlzdHMgKD0gVGlja2V0SUQgaXMgcHJlc2VudCksIHdlIG5lZWQgdGhlICdtb3ZlX2ludG8nCiAgICAjIHBlcm1pc3Npb24gb3RoZXJ3aXNlIHRoZSAnY3JlYXRlJyBwZXJtaXNzaW9uCiAgICBteSAkUGVybWlzc2lvblR5cGUgPSAnY3JlYXRlJzsKICAgIGlmICggJFBhcmFte1RpY2tldElEfSApIHsKICAgICAgICAkUGVybWlzc2lvblR5cGUgPSAnbW92ZV9pbnRvJzsKICAgIH0KCiAgICAjIGdldCBjb25maWcgb2JqZWN0CiAgICBteSAkQ29uZmlnT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKTsKCiAgICAjIGNoZWNrIG93biBzZWxlY3Rpb24KICAgIG15ICVOZXdRdWV1ZXM7CiAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpGcm9udGVuZDo6TmV3UXVldWVPd25TZWxlY3Rpb24nKSApIHsKICAgICAgICAlTmV3UXVldWVzID0gJXsgJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpOZXdRdWV1ZU93blNlbGVjdGlvbicpIH07CiAgICB9CiAgICBlbHNlIHsKCiAgICAgICAgIyBTZWxlY3Rpb25UeXBlIFF1ZXVlIG9yIFN5c3RlbUFkZHJlc3M/CiAgICAgICAgbXkgJVF1ZXVlczsKICAgICAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpGcm9udGVuZDo6TmV3UXVldWVTZWxlY3Rpb25UeXBlJykgZXEgJ1F1ZXVlJyApIHsKICAgICAgICAgICAgJVF1ZXVlcyA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpUaWNrZXQnKS0+TW92ZUxpc3QoCiAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICBUeXBlICAgID0+ICRQZXJtaXNzaW9uVHlwZSwKICAgICAgICAgICAgICAgIEFjdGlvbiAgPT4gJFNlbGYtPntBY3Rpb259LAogICAgICAgICAgICAgICAgUXVldWVJRCA9PiAkU2VsZi0+e1F1ZXVlSUR9LAogICAgICAgICAgICAgICAgVXNlcklEICA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAlUXVldWVzID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlN5c3RlbUFkZHJlc3MnKS0+U3lzdGVtQWRkcmVzc1F1ZXVlTGlzdCgpOwogICAgICAgIH0KCiAgICAgICAgIyBnZXQgcGVybWlzc2lvbiBxdWV1ZXMKICAgICAgICBteSAlVXNlckdyb3VwcyA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpHcm91cCcpLT5QZXJtaXNzaW9uVXNlckdldCgKICAgICAgICAgICAgVXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgVHlwZSAgID0+ICRQZXJtaXNzaW9uVHlwZSwKICAgICAgICApOwoKICAgICAgICAjIGJ1aWxkIHNlbGVjdGlvbiBzdHJpbmcKICAgICAgICBRVUVVRUlEOgogICAgICAgIGZvciBteSAkUXVldWVJRCAoIHNvcnQga2V5cyAlUXVldWVzICkgewogICAgICAgICAgICBteSAlUXVldWVEYXRhID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlF1ZXVlJyktPlF1ZXVlR2V0KCBJRCA9PiAkUXVldWVJRCApOwoKICAgICAgICAgICAgIyBwZXJtaXNzaW9uIGNoZWNrLCBjYW4gd2UgY3JlYXRlIG5ldyB0aWNrZXRzIGluIHF1ZXVlCiAgICAgICAgICAgIG5leHQgUVVFVUVJRCBpZiAhJFVzZXJHcm91cHN7ICRRdWV1ZURhdGF7R3JvdXBJRH0gfTsKCiAgICAgICAgICAgIG15ICRTdHJpbmcgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6Ok5ld1F1ZXVlU2VsZWN0aW9uU3RyaW5nJykKICAgICAgICAgICAgICAgIHx8ICc8UmVhbG5hbWU+IDw8RW1haWw+PiAtIFF1ZXVlOiA8UXVldWU+JzsKICAgICAgICAgICAgJFN0cmluZyA9fiBzLzxRdWV1ZT4vJFF1ZXVlRGF0YXtOYW1lfS9nOwogICAgICAgICAgICAkU3RyaW5nID1+IHMvPFF1ZXVlQ29tbWVudD4vJFF1ZXVlRGF0YXtDb21tZW50fS9nOwoKICAgICAgICAgICAgIyByZW1vdmUgdHJhaWxpbmcgc3BhY2VzCiAgICAgICAgICAgICRTdHJpbmcgPX4gc3tccytcen17fSBpZiAhJFF1ZXVlRGF0YXtDb21tZW50fTsKCiAgICAgICAgICAgIGlmICggJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpOZXdRdWV1ZVNlbGVjdGlvblR5cGUnKSBuZSAnUXVldWUnICkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbXkgJVN5c3RlbUFkZHJlc3NEYXRhID0gJFNlbGYtPntTeXN0ZW1BZGRyZXNzfS0+U3lzdGVtQWRkcmVzc0dldCgKICAgICAgICAgICAgICAgICAgICBJRCA9PiAkUXVldWVzeyRRdWV1ZUlEfSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAkU3RyaW5nID1+IHMvPFJlYWxuYW1lPi8kU3lzdGVtQWRkcmVzc0RhdGF7UmVhbG5hbWV9L2c7CiAgICAgICAgICAgICAgICAkU3RyaW5nID1+IHMvPEVtYWlsPi8kU3lzdGVtQWRkcmVzc0RhdGF7TmFtZX0vZzsKICAgICAgICAgICAgfQogICAgICAgICAgICAkTmV3UXVldWVzeyRRdWV1ZUlEfSA9ICRTdHJpbmc7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBcJU5ld1F1ZXVlczsKfQoKc3ViIF9HZXRBdHRhY2htZW50cyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRDb25maWdPYmplY3QgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKTsKICAgIG15ICRMYXlvdXRPYmplY3QgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwogICAgbXkgJEFydGljbGVPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGlja2V0OjpBcnRpY2xlJyk7CgogICAgbXkgQEFydGljbGVzID0gJEFydGljbGVPYmplY3QtPkFydGljbGVMaXN0KAogICAgICAgIFRpY2tldElEID0+ICRQYXJhbXtUaWNrZXRJRH0sCiAgICApOwoKICAgIG15ICVBcnRpY2xlRmlsZURhdGE7CgogICAgcmV0dXJuIFwlQXJ0aWNsZUZpbGVEYXRhIGlmICFAQXJ0aWNsZXM7CgogICAgbXkgJEZvcm1hdFN0cmluZyA9ICRDb25maWdPYmplY3QtPkdldCgnUHJvY2Vzczo6RHluYW1pY0ZpZWxkUHJvY2Vzc01hbmFnZW1lbnRBdHRhY2htZW50OjpGb3JtYXRTdHJpbmcnKQogICAgICAgIC8vICdBIyUxJGQ6ICUyJHMnOwoKICAgIG15ICRUcmFuc2xhdGVkT2JqZWN0VHlwZSAgICAgID0gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCdBcnRpY2xlJyk7CiAgICBteSAkVHJhbnNsYXRlZEF0dGFjaG1lbnRMYWJlbCA9ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgnQXR0YWNobWVudCcpOwoKICAgIEFSVElDTEU6CiAgICBmb3IgbXkgJEFydGljbGUgKEBBcnRpY2xlcykgewogICAgICAgIG15ICVJbmRleCA9ICRBcnRpY2xlT2JqZWN0LT5BcnRpY2xlQXR0YWNobWVudEluZGV4KAogICAgICAgICAgICBUaWNrZXRJRCAgICAgICAgID0+ICRQYXJhbXtUaWNrZXRJRH0sCiAgICAgICAgICAgIEFydGljbGVJRCAgICAgICAgPT4gJEFydGljbGUtPntBcnRpY2xlSUR9LAogICAgICAgICAgICBFeGNsdWRlUGxhaW5UZXh0ID0+IDEsCiAgICAgICAgICAgIEV4Y2x1ZGVIVE1MQm9keSAgPT4gMSwKICAgICAgICAgICAgRXhjbHVkZUlubGluZSAgICA9PiAwLAogICAgICAgICk7CgogICAgICAgIG5leHQgQVJUSUNMRSBpZiAhJUluZGV4OwoKICAgICAgICBmb3IgbXkgJEZpbGVJRCAoIHNvcnQga2V5cyAlSW5kZXggKSB7CgogICAgICAgICAgICAjIFNlbGVjdGlvblRleHQgcmVzdWx0cyBpbiBzb21ldGhpbmcgbGlrZTogIiMyOiB0ZXN0ZmlsZS5wZGYiCiAgICAgICAgICAgICMgJEZvcm1hdFN0cmluZyA9ICcjJTEkZDogJTIkcycKICAgICAgICAgICAgbXkgJFNlbGVjdGlvblRleHQgPSBzcHJpbnRmICRGb3JtYXRTdHJpbmcsICRBcnRpY2xlLT57QXJ0aWNsZU51bWJlcn0sICRJbmRleHskRmlsZUlEfS0+e0ZpbGVuYW1lfSwKICAgICAgICAgICAgICAgICRUcmFuc2xhdGVkT2JqZWN0VHlwZSwgJFRyYW5zbGF0ZWRBdHRhY2htZW50TGFiZWw7CgogICAgICAgICAgICAjIENyZWF0ZSBhIHN0cmluZ2lmaWVkIHN0cnVjdHVyZSB0byB1c2UgZGF0YSBhcyBrZXkgaW4gSFRNTCBzZWxlY3Rpb24uCiAgICAgICAgICAgICMgVGhpcyBpbmZvIGlzIG5lZWRlZCB0byBnZXQgdGhlIGNvcnJlY3QgYXR0YWNobWVudCBmcm9tIHRoZSBiYWNrZW5kLgogICAgICAgICAgICAjCiAgICAgICAgICAgICMgU3RyaW5naWZpZWQgc3RydWN0dXJlCiAgICAgICAgICAgICMgJ09iamVjdFR5cGU9QXJ0aWNsZTtPYmplY3RJRD0xO0lEPTUnCiAgICAgICAgICAgICMgJ09iamVjdFR5cGU9QXJ0aWNsZTtPYmplY3RJRD0xO0lEPTUsT2JqZWN0VHlwZT1BcnRpY2xlO09iamVjdElEPTM7SUQ9MicKICAgICAgICAgICAgIwogICAgICAgICAgICAjIFBhcnNlZCBzdHJpbmdpZmllZCBzdHJ1Y3R1cmUKICAgICAgICAgICAgIyBEYXRhID0gewogICAgICAgICAgICAjICAgICBPYmplY3RUeXBlID0+ICdBcnRpY2xlJywKICAgICAgICAgICAgIyAgICAgT2JqZWN0SUQgICA9PiAnMScsCiAgICAgICAgICAgICMgICAgIElEICAgICAgICAgPT4gJzQnLAogICAgICAgICAgICAjIH0KCiAgICAgICAgICAgIG15ICRLZXkgPSAnT2JqZWN0VHlwZT1BcnRpY2xlO09iamVjdElEPScgLiAkQXJ0aWNsZS0+e0FydGljbGVJRH0gLiAnO0lEPScgLiAkRmlsZUlEOwogICAgICAgICAgICAkQXJ0aWNsZUZpbGVEYXRheyRLZXl9ID0gJFNlbGVjdGlvblRleHQ7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBcJUFydGljbGVGaWxlRGF0YTsKfQoKc3ViIF9HZXRTdGF0ZXMgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAlU3RhdGVzID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpY2tldCcpLT5UaWNrZXRTdGF0ZUxpc3QoCiAgICAgICAgJVBhcmFtLAoKICAgICAgICAjIFNldCBkZWZhdWx0IHZhbHVlcyBmb3IgbmV3IHByb2Nlc3MgdGlja2V0CiAgICAgICAgUXVldWVJRCAgPT4gJFBhcmFte1F1ZXVlSUR9ICB8fCAxLAogICAgICAgIFRpY2tldElEID0+ICRQYXJhbXtUaWNrZXRJRH0gfHwgJycsCgogICAgICAgICMgcmVtb3ZlIHR5cGUsIHNpbmNlIGlmIFRpY2tldDo6VHlwZSBpcyBhY3RpdmUgaW4gc3lzY29uZmlnLCB0aGUgVHlwZSBwYXJhbWV0ZXIgd2lsbAogICAgICAgICMgYmUgc2VudCBhbmQgdGhlIFRpY2tldFN0YXRlTGlzdCB3aWxsIHNlbmQgdGhlIHBhcmFtZXRlciBhcyBTdGF0ZSBUeXBlCiAgICAgICAgVHlwZSA9PiB1bmRlZiwKCiAgICAgICAgQWN0aW9uID0+ICRTZWxmLT57QWN0aW9ufSwKICAgICAgICBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9LAogICAgKTsKCiAgICByZXR1cm4gXCVTdGF0ZXM7Cn0KCnN1YiBfR2V0VHlwZXMgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGdldCB0eXBlCiAgICBteSAlVHlwZTsKICAgIGlmICggJFBhcmFte1F1ZXVlSUR9IHx8ICRQYXJhbXtUaWNrZXRJRH0gKSB7CiAgICAgICAgJVR5cGUgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGlja2V0JyktPlRpY2tldFR5cGVMaXN0KAogICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgIEFjdGlvbiA9PiAkU2VsZi0+e0FjdGlvbn0sCiAgICAgICAgICAgIFVzZXJJRCA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgKTsKICAgIH0KICAgIHJldHVybiBcJVR5cGU7Cn0KCnN1YiBfR2V0QUpBWFVwZGF0YWJsZUZpZWxkcyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICVEZWZhdWx0VXBkYXRhYmxlRmllbGRzID0gKAogICAgICAgIFByaW9yaXR5SUQgICAgPT4gMSwKICAgICAgICBRdWV1ZUlEICAgICAgID0+IDEsCiAgICAgICAgUmVzcG9uc2libGVJRCA9PiAxLAogICAgICAgIFNlcnZpY2VJRCAgICAgPT4gMSwKICAgICAgICBTTEFJRCAgICAgICAgID0+IDEsCiAgICAgICAgU3RhdGVJRCAgICAgICA9PiAxLAogICAgICAgIE93bmVySUQgICAgICAgPT4gMSwKICAgICAgICBMb2NrSUQgICAgICAgID0+IDEsCiAgICAgICAgVHlwZUlEICAgICAgICA9PiAxLAogICAgKTsKCiAgICBteSAkRHluYW1pY0ZpZWxkID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkR5bmFtaWNGaWVsZCcpLT5EeW5hbWljRmllbGRMaXN0R2V0KAogICAgICAgIFZhbGlkICAgICAgPT4gMSwKICAgICAgICBPYmplY3RUeXBlID0+ICdUaWNrZXQnLAogICAgKTsKCiAgICAjIGNyZWF0ZSBhIER5bmFtaWNGaWVsZExvb2t1cFRhYmxlCiAgICBteSAlRHluYW1pY0ZpZWxkTG9va3VwID0gbWFwIHsgJ0R5bmFtaWNGaWVsZF8nIC4gJF8tPntOYW1lfSA9PiAkXyB9IEB7JER5bmFtaWNGaWVsZH07CgogICAgbXkgQFVwZGF0YWJsZUZpZWxkczsKICAgIEZJRUxEOgogICAgZm9yIG15ICRGaWVsZCAoIHNvcnQga2V5cyAleyAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZHN9IH0gKSB7CgogICAgICAgIG15ICRGaWVsZERhdGEgPSAkUGFyYW17QWN0aXZpdHlEaWFsb2dGaWVsZHN9LT57JEZpZWxkfTsKCiAgICAgICAgIyBza2lwIGhpZGRlbiBmaWVsZHMKICAgICAgICBuZXh0IEZJRUxEIGlmICEkRmllbGREYXRhLT57RGlzcGxheX07CgogICAgICAgICMgZm9yIER5bmFtaWMgRmllbGRzIGNoZWNrIGlmIGlzIEFKQVhVcGRhdGFibGUKICAgICAgICBpZiAoICRGaWVsZCA9fiBte15EeW5hbWljRmllbGRfKC4qKX14bXMgKSB7CiAgICAgICAgICAgIG15ICREeW5hbWljRmllbGRDb25maWcgPSAkRHluYW1pY0ZpZWxkTG9va3VweyRGaWVsZH07CgogICAgICAgICAgICAjIHNraXAgYW55IGZpZWxkIHdpdGggd3JvbmcgY29uZmlnCiAgICAgICAgICAgIG5leHQgRklFTEQgaWYgIUlzSGFzaFJlZldpdGhEYXRhKCREeW5hbWljRmllbGRDb25maWcpOwoKICAgICAgICAgICAgIyBza2lwIGZpZWxkIGlmIGlzIG5vdCBJc0FDTFJlZHVjaWJsZSAodXBkYXRhYmxlKQogICAgICAgICAgICBteSAkSXNBQ0xSZWR1Y2libGUgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6RHluYW1pY0ZpZWxkOjpCYWNrZW5kJyktPkhhc0JlaGF2aW9yKAogICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRDb25maWcsCiAgICAgICAgICAgICAgICBCZWhhdmlvciAgICAgICAgICAgPT4gJ0lzQUNMUmVkdWNpYmxlJywKICAgICAgICAgICAgKTsKICAgICAgICAgICAgbmV4dCBGSUVMRCBpZiAhJElzQUNMUmVkdWNpYmxlOwoKICAgICAgICAgICAgcHVzaCBAVXBkYXRhYmxlRmllbGRzLCAkRmllbGQ7CiAgICAgICAgfQoKICAgICAgICAjIGZvciBhbGwgb3RoZXJzIHVzZSAlRGVmYXVsdFVwZGF0YWJsZUZpZWxkcyB0YWJsZQogICAgICAgIGVsc2UgewoKICAgICAgICAgICAgIyBzdGFuZGFyaXplIHRoZSBmaWVsZCBuYW1lIChlLmcuIHVzZSBTdGF0ZUlEIGZvciBTdGF0ZSBmaWVsZCkKICAgICAgICAgICAgbXkgJEZpZWxkTmFtZSA9ICRTZWxmLT57TmFtZVRvSUR9LT57JEZpZWxkfTsKCiAgICAgICAgICAgICMgc2tpcCBpZiBmaWVsZCBuYW1lIGNvdWxkIG5vdCBiZSBjb252ZXJ0ZWQgKHRoaXMgbWVhbnMgdGhhdCBmaWVsZCBpcyB1bmtub3duKQogICAgICAgICAgICBuZXh0IEZJRUxEIGlmICEkRmllbGROYW1lOwoKICAgICAgICAgICAgIyBza2lwIGlmIHRoZSBmaWVsZCBpcyBub3QgdXBkYXRhYmxlIHZpYSBhamF4CiAgICAgICAgICAgIG5leHQgRklFTEQgaWYgISREZWZhdWx0VXBkYXRhYmxlRmllbGRzeyRGaWVsZE5hbWV9OwoKICAgICAgICAgICAgcHVzaCBAVXBkYXRhYmxlRmllbGRzLCAkRmllbGROYW1lOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gXEBVcGRhdGFibGVGaWVsZHM7Cn0KCnN1YiBfR2V0RmllbGRzVG9VcGRhdGVTdHJnIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJEZpZWxkc1RvVXBkYXRlID0gJyc7CiAgICBpZiAoIElzQXJyYXlSZWZXaXRoRGF0YSggJFBhcmFte0FKQVhVcGRhdGFibGVGaWVsZHN9ICkgKSB7CiAgICAgICAgbXkgJEZpcnN0SXRlbSA9IDE7CiAgICAgICAgRklFTEQ6CiAgICAgICAgZm9yIG15ICRGaWVsZCAoIEB7ICRQYXJhbXtBSkFYVXBkYXRhYmxlRmllbGRzfSB9ICkgewogICAgICAgICAgICBuZXh0IEZJRUxEIGlmICRGaWVsZCBlcSAkUGFyYW17VHJpZ2dlckZpZWxkfTsKICAgICAgICAgICAgaWYgKCRGaXJzdEl0ZW0pIHsKICAgICAgICAgICAgICAgICRGaXJzdEl0ZW0gPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJEZpZWxkc1RvVXBkYXRlIC49ICcsICc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJEZpZWxkc1RvVXBkYXRlIC49ICInIiAuICRGaWVsZCAuICInIjsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gJEZpZWxkc1RvVXBkYXRlOwp9CgpzdWIgX1Nob3dEaWFsb2dFcnJvciB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CgogICAgbXkgJE91dHB1dCA9ICRMYXlvdXRPYmplY3QtPkhlYWRlciggVHlwZSA9PiAnU21hbGwnICk7CiAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPkVycm9yKCVQYXJhbSk7CiAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPkZvb3RlciggVHlwZSA9PiAnU21hbGwnICk7CiAgICByZXR1cm4gJE91dHB1dDsKfQoKMTsK</File>
        <File Location="Custom/Kernel/Output/HTML/Article/Chat.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxLTIwMjIgWm51bnkgR21iSCwgaHR0cHM6Ly96bnVueS5vcmcvCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6T3V0cHV0OjpIVE1MOjpBcnRpY2xlOjpDaGF0OwoKdXNlIHN0cmljdDsKdXNlIHdhcm5pbmdzOwoKdXNlIHBhcmVudCAnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkFydGljbGU6OkJhc2UnOwoKdXNlIEtlcm5lbDo6U3lzdGVtOjpWYXJpYWJsZUNoZWNrIHF3KDphbGwpOwoKb3VyIEBPYmplY3REZXBlbmRlbmNpZXMgPSAoCiAgICAnS2VybmVsOjpDb25maWcnLAogICAgJ0tlcm5lbDo6TGFuZ3VhZ2UnLAogICAgJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpDdXN0b21lclVzZXInLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpIVE1MVXRpbHMnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpMb2cnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpUaWNrZXQ6OkFydGljbGUnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpVc2VyJywKKTsKCj1oZWFkMiBBcnRpY2xlRmllbGRzKCkKClJldHVybnMgY29tbW9uIGFydGljbGUgZmllbGRzIGZvciBhIENoYXQgYXJ0aWNsZS4KCiAgICBteSAlQXJ0aWNsZUZpZWxkcyA9ICRMYXlvdXRPYmplY3QtPkFydGljbGVGaWVsZHMoCiAgICAgICAgVGlja2V0SUQgID0+IDEyMywgICAjIChyZXF1aXJlZCkKICAgICAgICBBcnRpY2xlSUQgPT4gMTIzLCAgICMgKHJlcXVpcmVkKQogICAgKTsKClJldHVybnM6CgogICAgJUFydGljbGVGaWVsZHMgPSAoCiAgICAgICAgU2VuZGVyID0+IHsgICAgICAgICAgICAgICAgICAgICAjIG1hbmRhdG9yeQogICAgICAgICAgICBMYWJlbCA9PiAnU2VuZGVyJywKICAgICAgICAgICAgVmFsdWUgPT4gJ0pvaG4gRG9lJywKICAgICAgICAgICAgUHJpbyAgPT4gMTAwLAogICAgICAgIH0sCiAgICAgICAgU3ViamVjdCA9PiB7ICAgICAgICAgICAgICAgICAgICAjIG1hbmRhdG9yeQogICAgICAgICAgICBMYWJlbCA9PiAnU3ViamVjdCcsCiAgICAgICAgICAgIFZhbHVlID0+ICdBcnRpY2xlIHN1YmplY3QnLAogICAgICAgICAgICBQcmlvICA9PiAyMDAsCiAgICAgICAgfSwKICAgICAgICAuLi4KICAgICk7Cgo9Y3V0CgpzdWIgQXJ0aWNsZUZpZWxkcyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgQ2hlY2sgbmVlZGVkIHN0dWZmLgogICAgZm9yIG15ICROZWVkZWQgKHF3KFRpY2tldElEIEFydGljbGVJRCkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICROZWVkZWQhIiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICBteSAkQXJ0aWNsZUJhY2tlbmRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGlja2V0OjpBcnRpY2xlJyktPkJhY2tlbmRGb3JBcnRpY2xlKCVQYXJhbSk7CgogICAgbXkgJUFydGljbGUgPSAkQXJ0aWNsZUJhY2tlbmRPYmplY3QtPkFydGljbGVHZXQoCiAgICAgICAgJVBhcmFtLAogICAgKTsKCiAgICBteSAkU2VuZGVyOwogICAgbXkgJFNlbmRlclJlYWxuYW1lOwoKICAgIGlmICggSXNBcnJheVJlZldpdGhEYXRhKCAkQXJ0aWNsZXtDaGF0TWVzc2FnZUxpc3R9ICkgKSB7CgogICAgICAgICMgR2V0IElEIGFuZCB0eXBlIG9mIGZpcnN0IHBlcnNvbiBpbiBjb252ZXJzYXRpb24uCiAgICAgICAgaWYgKAogICAgICAgICAgICBJc0hhc2hSZWZXaXRoRGF0YSggJEFydGljbGV7Q2hhdE1lc3NhZ2VMaXN0fS0+WzBdICkKICAgICAgICAgICAgJiYgJEFydGljbGV7Q2hhdE1lc3NhZ2VMaXN0fS0+WzBdLT57Q2hhdHRlclR5cGV9CiAgICAgICAgICAgICkKICAgICAgICB7CgogICAgICAgICAgICAjIEdldCBhZ2VudCBkYXRhLgogICAgICAgICAgICBpZiAoICRBcnRpY2xle0NoYXRNZXNzYWdlTGlzdH0tPlswXS0+e0NoYXR0ZXJUeXBlfSBlcSAnVXNlcicgKSB7CiAgICAgICAgICAgICAgICBteSAlQWdlbnREYXRhID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlVzZXInKS0+R2V0VXNlckRhdGEoCiAgICAgICAgICAgICAgICAgICAgVXNlcklEICAgICAgICA9PiAkQXJ0aWNsZXtDaGF0TWVzc2FnZUxpc3R9LT5bMF0tPntDaGF0dGVySUR9LAogICAgICAgICAgICAgICAgICAgIE5vT3V0T2ZPZmZpY2UgPT4gMSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAkU2VuZGVyICAgICAgICAgPSAiJEFnZW50RGF0YXtVc2VyRnVsbG5hbWV9IDwkQWdlbnREYXRhe1VzZXJFbWFpbH0+IjsKICAgICAgICAgICAgICAgICRTZW5kZXJSZWFsbmFtZSA9ICRBZ2VudERhdGF7VXNlckZ1bGxuYW1lfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBHZXQgY3VzdG9tZXIgZGF0YS4KICAgICAgICAgICAgZWxzaWYgKCAkQXJ0aWNsZXtDaGF0TWVzc2FnZUxpc3R9LT5bMF0tPntDaGF0dGVyVHlwZX0gZXEgJ0N1c3RvbWVyJyApIHsKICAgICAgICAgICAgICAgIG15ICRDdXN0b21lclVzZXJPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q3VzdG9tZXJVc2VyJyk7CiAgICAgICAgICAgICAgICBteSAlQ3VzdG9tZXJEYXRhICAgICAgID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJVc2VyRGF0YUdldCgKICAgICAgICAgICAgICAgICAgICBVc2VyID0+ICRBcnRpY2xle0NoYXRNZXNzYWdlTGlzdH0tPlswXS0+e0NoYXR0ZXJJRH0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgbXkgJEN1c3RvbWVyTmFtZSA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyTmFtZSgKICAgICAgICAgICAgICAgICAgICBVc2VyTG9naW4gPT4gJEFydGljbGV7Q2hhdE1lc3NhZ2VMaXN0fS0+WzBdLT57Q2hhdHRlcklEfSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAkU2VuZGVyICAgICAgICAgPSAiJEN1c3RvbWVyTmFtZSA8JEN1c3RvbWVyRGF0YXtVc2VyRW1haWx9PiI7CiAgICAgICAgICAgICAgICAkU2VuZGVyUmVhbG5hbWUgPSAkQ3VzdG9tZXJOYW1lOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIG15ICRTZW5kZXJEaXNwbGF5VHlwZSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnVGlja2V0OjpGcm9udGVuZDo6RGVmYXVsdFNlbmRlckRpc3BsYXlUeXBlJykKICAgICAgICB8fCAnUmVhbG5hbWUnOwogICAgbXkgJEhpZGRlblR5cGUgPSAkU2VuZGVyRGlzcGxheVR5cGUgZXEgJ1JlYWxuYW1lJyA/ICdWYWx1ZScgOiAnUmVhbG5hbWUnOwoKICAgIG15ICVSZXN1bHQgPSAoCiAgICAgICAgU2VuZGVyID0+IHsKICAgICAgICAgICAgTGFiZWwgICAgICAgICAgICAgICAgPT4gJ1NlbmRlcicsCiAgICAgICAgICAgIFZhbHVlICAgICAgICAgICAgICAgID0+ICRTZW5kZXIsCiAgICAgICAgICAgIFJlYWxuYW1lICAgICAgICAgICAgID0+ICRTZW5kZXJSZWFsbmFtZSwKICAgICAgICAgICAgUHJpbyAgICAgICAgICAgICAgICAgPT4gMTAwLAogICAgICAgICAgICAkSGlkZGVuVHlwZSAuIEhpZGRlbiA9PiAnSGlkZGVuJywKICAgICAgICB9LAogICAgICAgIFN1YmplY3QgPT4gewogICAgICAgICAgICBMYWJlbCA9PiAnU3ViamVjdCcsCiAgICAgICAgICAgIFZhbHVlID0+ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6TGFuZ3VhZ2UnKS0+VHJhbnNsYXRlKCdDaGF0JyksCiAgICAgICAgICAgIFByaW8gID0+IDIwMCwKICAgICAgICB9LAogICAgKTsKCiAgICByZXR1cm4gJVJlc3VsdDsKfQoKPWhlYWQyIEFydGljbGVQcmV2aWV3KCkKClJldHVybnMgYXJ0aWNsZSBwcmV2aWV3IGZvciBhIENoYXQgYXJ0aWNsZS4KCiAgICAkTGF5b3V0T2JqZWN0LT5BcnRpY2xlUHJldmlldygKICAgICAgICBUaWNrZXRJRCAgID0+IDEyMywgICAgICMgKHJlcXVpcmVkKQogICAgICAgIEFydGljbGVJRCAgPT4gMTIzLCAgICAgIyAocmVxdWlyZWQpCiAgICAgICAgUmVzdWx0VHlwZSA9PiAncGxhaW4nLCAjIChvcHRpb25hbCkgcGxhaW58SFRNTC4gRGVmYXVsdCBIVE1MLgogICAgICAgIE1heExlbmd0aCAgPT4gNTAsICAgICAgIyAob3B0aW9uYWwpIHBlcmZvcm1zIHRyaW1taW5nIChmb3IgcGxhaW4gcmVzdWx0IG9ubHkpCiAgICApOwoKUmV0dXJucyBhcnRpY2xlIHByZXZpZXcgaW4gc2NhbGFyIGZvcm06CgogICAgJEFydGljbGVQcmV2aWV3ID0gJ0pvaG4gRG9lIFsyMDE3LTA2LTA4IDE1OjQ2OjUxXSBIZWxsbywgd29ybGQhJzsKCj1jdXQKCnN1YiBBcnRpY2xlUHJldmlldyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgQ2hlY2sgbmVlZGVkIHN0dWZmLgogICAgZm9yIG15ICROZWVkZWQgKHF3KFRpY2tldElEIEFydGljbGVJRCkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICROZWVkZWQhIiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICBpZiAoICRQYXJhbXtNYXhMZW5ndGh9ICYmICFJc1Bvc2l0aXZlSW50ZWdlciggJFBhcmFte01heExlbmd0aH0gKSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gIk1heExlbmd0aCBtdXN0IGJlIHBvc2l0aXZlIGludGVnZXIhIgogICAgICAgICk7CgogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBteSAkQXJ0aWNsZUJhY2tlbmRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGlja2V0OjpBcnRpY2xlJyktPkJhY2tlbmRGb3JBcnRpY2xlKCVQYXJhbSk7CgogICAgbXkgJUFydGljbGUgPSAkQXJ0aWNsZUJhY2tlbmRPYmplY3QtPkFydGljbGVHZXQoCiAgICAgICAgJVBhcmFtLAogICAgICAgIER5bmFtaWNGaWVsZHMgPT4gMCwKICAgICk7CgogICAgbXkgJFJlc3VsdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKS0+T3V0cHV0KAogICAgICAgIFRlbXBsYXRlRmlsZSA9PiAnQXJ0aWNsZUNvbnRlbnQvQ2hhdCcsCiAgICAgICAgRGF0YSAgICAgICAgID0+IHsKICAgICAgICAgICAgQ2hhdE1lc3NhZ2VzID0+ICRBcnRpY2xle0NoYXRNZXNzYWdlTGlzdH0sCiAgICAgICAgfSwKICAgICk7CgogICAgaWYgKCAkUGFyYW17UmVzdWx0VHlwZX0gJiYgJFBhcmFte1Jlc3VsdFR5cGV9IGVxICdwbGFpbicgKSB7CgogICAgICAgICRSZXN1bHQgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6SFRNTFV0aWxzJyktPlRvQXNjaWkoCiAgICAgICAgICAgIFN0cmluZyA9PiAkUmVzdWx0LAogICAgICAgICk7CgogICAgICAgICRSZXN1bHQgPX4gc3tcblxzKlxufXtcbn1nOyAgICAjIFJlbW92ZSBleHRyYSBuZXcgbGluZXMuCiAgICAgICAgJFJlc3VsdCA9fiBzL1teXFNcbl0rLyAvZzsgICAgICMgUmVtb3ZlIGV4dHJhIHNwYWNlcy4KCiAgICAgICAgaWYgKCAkUGFyYW17TWF4TGVuZ3RofSApIHsKCiAgICAgICAgICAgICMgdHJpbQogICAgICAgICAgICAkUmVzdWx0ID0gc3Vic3RyKCAkUmVzdWx0LCAwLCAkUGFyYW17TWF4TGVuZ3RofSApOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gJFJlc3VsdDsKfQoKPWhlYWQyIEFydGljbGVDdXN0b21lclJlY2lwaWVudHNHZXQoKQoKR2V0IGN1c3RvbWVyIHVzZXJzIGZyb20gYW4gYXJ0aWNsZSB0byB1c2UgYXMgcmVjaXBpZW50cy4KCiAgICBteSBAQ3VzdG9tZXJVc2VySURzID0gJExheW91dE9iamVjdC0+QXJ0aWNsZUN1c3RvbWVyUmVjaXBpZW50c0dldCgKICAgICAgICBUaWNrZXRJRCAgPT4gMTIzLCAgICAgIyAocmVxdWlyZWQpCiAgICAgICAgQXJ0aWNsZUlEID0+IDEyMywgICAgICMgKHJlcXVpcmVkKQogICAgKTsKClJldHVybnMgYXJyYXkgb2YgY3VzdG9tZXIgdXNlciBJRHMgd2hvIHNob3VsZCByZWNlaXZlIGEgbWVzc2FnZToKCiAgICBAQ3VzdG9tZXJVc2VySURzID0gKAogICAgICAgICdjdXN0b21lci0xJywKICAgICAgICAnY3VzdG9tZXItMicsCiAgICAgICAgLi4uCiAgICApOwoKPWN1dAoKc3ViIEFydGljbGVDdXN0b21lclJlY2lwaWVudHNHZXQgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBmb3IgbXkgJE5lZWRlZCAocXcoVGlja2V0SUQgQXJ0aWNsZUlEKSkgewogICAgICAgIGlmICggISRQYXJhbXskTmVlZGVkfSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIk5lZWQgJE5lZWRlZCEiLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgIG15ICVBcnRpY2xlID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpY2tldDo6QXJ0aWNsZScpLT5CYWNrZW5kRm9yQXJ0aWNsZSglUGFyYW0pLT5BcnRpY2xlR2V0KCVQYXJhbSk7CiAgICByZXR1cm4gaWYgISVBcnRpY2xlOwoKICAgIG15ICRDdXN0b21lclVzZXJPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q3VzdG9tZXJVc2VyJyk7CgogICAgbXkgQEN1c3RvbWVyVXNlcklEczsKCiAgICBDSEFUX01FU1NBR0U6CiAgICBmb3IgbXkgJENoYXRNZXNzYWdlICggQHsgJEFydGljbGV7Q2hhdE1lc3NhZ2VMaXN0fSAvLyBbXSB9ICkgewoKICAgICAgICAjIFByb2Nlc3MgYWxsIGNoYXQgbWVzc2FnZXMgd2hlcmUgdGhlIHNlbmRlciB3YXMgYSBjdXN0b21lci4KICAgICAgICBuZXh0IENIQVRfTUVTU0FHRSBpZiAhJENoYXRNZXNzYWdlLT57Q2hhdHRlclR5cGV9IGVxICdDdXN0b21lcic7CgogICAgICAgICMgR2V0IHNpbmdsZSBjdXN0b21lciB1c2VyIGZyb20gY3VzdG9tZXIgYmFja2VuZCBiYXNlZCBvbiB0aGUgSUQgYWRkcmVzcy4KICAgICAgICBteSAlQ3VzdG9tZXJTZWFyY2ggPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclNlYXJjaCgKICAgICAgICAgICAgVXNlckxvZ2luID0+ICRDaGF0TWVzc2FnZS0+e0NoYXR0ZXJJRH0sCiAgICAgICAgICAgIExpbWl0ICAgICA9PiAxLAogICAgICAgICAgICBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICk7CiAgICAgICAgbmV4dCBDSEFUX01FU1NBR0UgaWYgISVDdXN0b21lclNlYXJjaDsKCiAgICAgICAgIyBTYXZlIGN1c3RvbWVyIHVzZXIgSUQgaWYgbm90IGFscmVhZHkgcHJlc2VudCBpbiB0aGUgbGlzdC4KICAgICAgICBmb3IgbXkgJEN1c3RvbWVyVXNlcklEICggc29ydCBrZXlzICVDdXN0b21lclNlYXJjaCApIHsKICAgICAgICAgICAgcHVzaCBAQ3VzdG9tZXJVc2VySURzLCAkQ3VzdG9tZXJVc2VySUQgaWYgIWdyZXAgeyAkXyBlcSAkQ3VzdG9tZXJVc2VySUQgfSBAQ3VzdG9tZXJVc2VySURzOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gQEN1c3RvbWVyVXNlcklEczsKfQoKMTsK</File>
        <File Location="Custom/Kernel/Output/HTML/Article/MIMEBase.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxLTIwMjIgWm51bnkgR21iSCwgaHR0cHM6Ly96bnVueS5vcmcvCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6T3V0cHV0OjpIVE1MOjpBcnRpY2xlOjpNSU1FQmFzZTsKCnVzZSBzdHJpY3Q7CnVzZSB3YXJuaW5nczsKCnVzZSBwYXJlbnQgJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpBcnRpY2xlOjpCYXNlJzsKCnVzZSBNYWlsOjpBZGRyZXNzOwoKdXNlIEtlcm5lbDo6TGFuZ3VhZ2UgcXcoVHJhbnNsYXRhYmxlKTsKdXNlIEtlcm5lbDo6U3lzdGVtOjpWYXJpYWJsZUNoZWNrIHF3KDphbGwpOwoKb3VyIEBPYmplY3REZXBlbmRlbmNpZXMgPSAoCiAgICAnS2VybmVsOjpDb25maWcnLAogICAgJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpDaGVja0l0ZW0nLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpDdXN0b21lclVzZXInLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpFbmNvZGUnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpMb2cnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpNYWluJywKICAgICdLZXJuZWw6OlN5c3RlbTo6VGlja2V0JywKICAgICdLZXJuZWw6OlN5c3RlbTo6VGlja2V0OjpBcnRpY2xlJywKKTsKCnN1YiBuZXcgewogICAgbXkgKCAkVHlwZSwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkU2VsZiA9IHt9OwogICAgYmxlc3MoICRTZWxmLCAkVHlwZSApOwoKICAgIHJldHVybiAkU2VsZjsKfQoKPWhlYWQyIEFydGljbGVGaWVsZHMoKQoKUmV0dXJucyBjb21tb24gYXJ0aWNsZSBmaWVsZHMgZm9yIGEgTUlNRUJhc2UgYXJ0aWNsZS4KCiAgICBteSAlQXJ0aWNsZUZpZWxkcyA9ICRMYXlvdXRPYmplY3QtPkFydGljbGVGaWVsZHMoCiAgICAgICAgVGlja2V0SUQgID0+IDEyMywgICAjIChyZXF1aXJlZCkKICAgICAgICBBcnRpY2xlSUQgPT4gMTIzLCAgICMgKHJlcXVpcmVkKQogICAgKTsKClJldHVybnM6CgogICAgJUFydGljbGVGaWVsZHMgPSAoCiAgICAgICAgU2VuZGVyID0+IHsgICAgICAgICAgICAgICAgICAgICAjIG1hbmRhdG9yeQogICAgICAgICAgICBMYWJlbCA9PiAnU2VuZGVyJywKICAgICAgICAgICAgVmFsdWUgPT4gJ0pvaG4gRG9lJywKICAgICAgICAgICAgUHJpbyAgPT4gMTAwLAogICAgICAgIH0sCiAgICAgICAgU3ViamVjdCA9PiB7ICAgICAgICAgICAgICAgICAgICAjIG1hbmRhdG9yeQogICAgICAgICAgICBMYWJlbCA9PiAnU3ViamVjdCcsCiAgICAgICAgICAgIFZhbHVlID0+ICdBcnRpY2xlIHN1YmplY3QnLAogICAgICAgICAgICBQcmlvICA9PiAyMDAsCiAgICAgICAgfSwKICAgICAgICBQR1AgPT4gewogICAgICAgICAgICBMYWJlbCA9PiAnUEdQJywgICAgICAgICAgICAgIyBtYW5kYXRvcnkKICAgICAgICAgICAgVmFsdWUgPT4gJ1ZhbHVlJywgICAgICAgICAgICMgbWFuZGF0b3J5CiAgICAgICAgICAgIENsYXNzID0+ICdDbGFzcycsICAgICAgICAgICAjIG9wdGlvbmFsCiAgICAgICAgICAgIC4uLgogICAgICAgIH0sCiAgICAgICAgLi4uCiAgICApOwoKPWN1dAoKc3ViIEFydGljbGVGaWVsZHMgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIENoZWNrIG5lZWRlZCBzdHVmZi4KICAgIGZvciBteSAkTmVlZGVkIChxdyhUaWNrZXRJRCBBcnRpY2xlSUQpKSB7CiAgICAgICAgaWYgKCAhJFBhcmFteyROZWVkZWR9ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCAkTmVlZGVkISIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgbXkgJVJlc3VsdDsKCiAgICBteSAkQ29uZmlnT2JqZWN0ICAgICAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpOwogICAgbXkgJExheW91dE9iamVjdCAgICAgICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwogICAgbXkgJE1haW5PYmplY3QgICAgICAgICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06Ok1haW4nKTsKICAgIG15ICRBcnRpY2xlQmFja2VuZE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpUaWNrZXQ6OkFydGljbGUnKS0+QmFja2VuZEZvckFydGljbGUoJVBhcmFtKTsKCiAgICBteSAlVGlja2V0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpY2tldCcpLT5UaWNrZXRHZXQoCiAgICAgICAgJVBhcmFtLAogICAgICAgIER5bmFtaWNGaWVsZHMgPT4gMCwKICAgICk7CgogICAgbXkgJUFydGljbGUgPSAkQXJ0aWNsZUJhY2tlbmRPYmplY3QtPkFydGljbGVHZXQoCiAgICAgICAgJVBhcmFtLAogICAgICAgIER5bmFtaWNGaWVsZHMgPT4gMSwKICAgICAgICBSZWFsTmFtZXMgICAgID0+IDEsCiAgICApOwoKICAgICMgY2xlYW51cCBzdWJqZWN0CiAgICAkQXJ0aWNsZXtTdWJqZWN0fSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpUaWNrZXQnKS0+VGlja2V0U3ViamVjdENsZWFuKAogICAgICAgIFRpY2tldE51bWJlciA9PiAkVGlja2V0e1RpY2tldE51bWJlcn0sCiAgICAgICAgU3ViamVjdCAgICAgID0+ICRBcnRpY2xle1N1YmplY3R9IHx8ICcnLAogICAgICAgIFNpemUgICAgICAgICA9PiAwLAogICAgKTsKCiAgICAkUmVzdWx0e1N1YmplY3R9ID0gewogICAgICAgIExhYmVsID0+ICdTdWJqZWN0JywKICAgICAgICBWYWx1ZSA9PiAkQXJ0aWNsZXtTdWJqZWN0fSwKICAgIH07CgogICAgIyBydW4gYXJ0aWNsZSB2aWV3IG1vZHVsZXMKICAgIG15ICRDb25maWcgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ1RpY2tldDo6RnJvbnRlbmQ6OkFydGljbGVWaWV3TW9kdWxlJyk7CgogICAgaWYgKCByZWYgJENvbmZpZyBlcSAnSEFTSCcgKSB7CiAgICAgICAgbXkgJUpvYnMgPSAleyRDb25maWd9OwoKICAgICAgICBKT0I6CiAgICAgICAgZm9yIG15ICRKb2IgKCBzb3J0IGtleXMgJUpvYnMgKSB7CgogICAgICAgICAgICAjIGxvYWQgbW9kdWxlCiAgICAgICAgICAgIG5leHQgSk9CIGlmICEkTWFpbk9iamVjdC0+UmVxdWlyZSggJEpvYnN7JEpvYn0tPntNb2R1bGV9ICk7CgogICAgICAgICAgICBteSAkT2JqZWN0ID0gJEpvYnN7JEpvYn0tPntNb2R1bGV9LT5uZXcoCiAgICAgICAgICAgICAgICBUaWNrZXRJRCAgPT4gJFNlbGYtPntUaWNrZXRJRH0sCiAgICAgICAgICAgICAgICBBcnRpY2xlSUQgPT4gJFBhcmFte0FydGljbGVJRH0sCiAgICAgICAgICAgICAgICBVc2VySUQgICAgPT4gJFBhcmFte1VzZXJJRH0gfHwgMSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICMgcnVuIG1vZHVsZQogICAgICAgICAgICBteSBARGF0YSA9ICRPYmplY3QtPkNoZWNrKAogICAgICAgICAgICAgICAgQXJ0aWNsZSA9PiBcJUFydGljbGUsCiAgICAgICAgICAgICAgICAlVGlja2V0LCBDb25maWcgPT4gJEpvYnN7JEpvYn0KICAgICAgICAgICAgKTsKICAgICAgICAgICAgZm9yIG15ICREYXRhUmVmIChARGF0YSkgewogICAgICAgICAgICAgICAgaWYgKCAhJERhdGFSZWYtPntTdWNjZXNzZnVsfSApIHsKICAgICAgICAgICAgICAgICAgICAkRGF0YVJlZi0+e1Jlc3VsdH0gPSAnRXJyb3InOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJERhdGFSZWYtPntSZXN1bHR9ID0gJ05vdGljZSc7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJFJlc3VsdHsgJERhdGFSZWYtPntLZXl9IH0gPSB7CiAgICAgICAgICAgICAgICAgICAgTGFiZWwgPT4gJERhdGFSZWYtPntLZXl9LAogICAgICAgICAgICAgICAgICAgIFZhbHVlID0+ICREYXRhUmVmLT57VmFsdWV9LAogICAgICAgICAgICAgICAgICAgIENsYXNzID0+ICREYXRhUmVmLT57UmVzdWx0fSwKICAgICAgICAgICAgICAgICAgICBUeXBlICA9PiAnQXJ0aWNsZU9wdGlvbicsCiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIGZvciBteSAkV2FybmluZyAoIEB7ICREYXRhUmVmLT57V2FybmluZ3N9IH0gKSB7CiAgICAgICAgICAgICAgICAgICAgJFJlc3VsdHsgJERhdGFSZWYtPntLZXl9IH0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExhYmVsID0+ICRXYXJuaW5nLT57S2V5fSwKICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWUgPT4gJFdhcm5pbmctPntWYWx1ZX0sCiAgICAgICAgICAgICAgICAgICAgICAgIENsYXNzID0+ICRXYXJuaW5nLT57UmVzdWx0fSwKICAgICAgICAgICAgICAgICAgICAgICAgVHlwZSAgPT4gJ0FydGljbGVPcHRpb24nLAogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgVE9ETzogQ2hlY2sgaG93IHRvIGltcGxlbWVudCB0aGlzLgogICAgICAgICAgICAjICMgZmlsdGVyIG9wdGlvbgogICAgICAgICAgICAjICRPYmplY3QtPkZpbHRlcigKICAgICAgICAgICAgIyAgICAgQXJ0aWNsZSA9PiBcJUFydGljbGUsCiAgICAgICAgICAgICMgICAgICVUaWNrZXQsIENvbmZpZyA9PiAkSm9ic3skSm9ifQogICAgICAgICAgICAjICk7CiAgICAgICAgfQogICAgfQoKICAgICMgZG8gc29tZSBzdHJpcHMgJiYgcXVvdGluZwogICAgbXkgJFJlY2lwaWVudERpc3BsYXlUeXBlID0gJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpEZWZhdWx0UmVjaXBpZW50RGlzcGxheVR5cGUnKSB8fCAnUmVhbG5hbWUnOwogICAgbXkgJFNlbmRlckRpc3BsYXlUeXBlICAgID0gJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkZyb250ZW5kOjpEZWZhdWx0U2VuZGVyRGlzcGxheVR5cGUnKSAgICB8fCAnUmVhbG5hbWUnOwogICAgS0VZOgogICAgZm9yIG15ICRLZXkgKHF3KEZyb20gVG8gQ2MgQmNjKSkgewogICAgICAgIG5leHQgS0VZIGlmICEkQXJ0aWNsZXskS2V5fTsKCiAgICAgICAgbXkgJERpc3BsYXlUeXBlID0gJEtleSBlcSAnRnJvbScgICAgICAgICAgICAgPyAkU2VuZGVyRGlzcGxheVR5cGUgOiAkUmVjaXBpZW50RGlzcGxheVR5cGU7CiAgICAgICAgbXkgJEhpZGRlblR5cGUgID0gJERpc3BsYXlUeXBlIGVxICdSZWFsbmFtZScgPyAnVmFsdWUnICAgICAgICAgICAgOiAnUmVhbG5hbWUnOwogICAgICAgICRSZXN1bHR7JEtleX0gPSB7CiAgICAgICAgICAgIExhYmVsICAgICAgICAgICAgICAgICAgID0+ICRLZXksCiAgICAgICAgICAgIFZhbHVlICAgICAgICAgICAgICAgICAgID0+ICRBcnRpY2xleyRLZXl9LAogICAgICAgICAgICBSZWFsbmFtZSAgICAgICAgICAgICAgICA9PiAkQXJ0aWNsZXsgJEtleSAuICdSZWFsbmFtZScgfSwKICAgICAgICAgICAgQXJ0aWNsZUlEICAgICAgICAgICAgICAgPT4gJEFydGljbGV7QXJ0aWNsZUlEfSwKICAgICAgICAgICAgJEhpZGRlblR5cGUgLiBIaWRkZW4gICAgPT4gJ0hpZGRlbicsCiAgICAgICAgICAgIEhpZGVJbkN1c3RvbWVySW50ZXJmYWNlID0+ICRLZXkgZXEgJ0JjYycgPyAxIDogdW5kZWYsCiAgICAgICAgfTsKICAgICAgICBpZiAoICRLZXkgZXEgJ0Zyb20nICkgewogICAgICAgICAgICAkUmVzdWx0e1NlbmRlcn0gPSB7CiAgICAgICAgICAgICAgICBMYWJlbCAgICAgICAgICAgICAgICA9PiBUcmFuc2xhdGFibGUoJ1NlbmRlcicpLAogICAgICAgICAgICAgICAgVmFsdWUgICAgICAgICAgICAgICAgPT4gJEFydGljbGV7RnJvbX0sCiAgICAgICAgICAgICAgICBSZWFsbmFtZSAgICAgICAgICAgICA9PiAkQXJ0aWNsZXtGcm9tUmVhbG5hbWV9LAogICAgICAgICAgICAgICAgJEhpZGRlblR5cGUgLiBIaWRkZW4gPT4gJ0hpZGRlbicsCiAgICAgICAgICAgICAgICBIaWRlSW5UaW1lbGluZVZpZXcgICA9PiAxLAogICAgICAgICAgICAgICAgSGlkZUluVGlja2V0UHJpbnQgICAgPT4gMSwKICAgICAgICAgICAgfTsKICAgICAgICB9CiAgICB9CgogICAgIyBBc3NpZ24gcHJpb3JpdHkuCiAgICBteSAkUHJpb3JpdHkgPSAxMDA7CiAgICBmb3IgbXkgJEtleSAocXcoRnJvbSBUbyBDYyBCY2MpKSB7CiAgICAgICAgaWYgKCAkUmVzdWx0eyRLZXl9ICkgewogICAgICAgICAgICAkUmVzdWx0eyRLZXl9LT57UHJpb30gPSAkUHJpb3JpdHk7CiAgICAgICAgICAgICRQcmlvcml0eSArPSAxMDA7CiAgICAgICAgfQogICAgfQoKICAgIG15IEBGaWVsZHNXaXRob3V0UHJpbyA9IGdyZXAgeyAhJFJlc3VsdHskX30tPntQcmlvfSB9IHNvcnQga2V5cyAlUmVzdWx0OwoKICAgIG15ICRCYXNlUHJpbyA9IDEwMDAwMDsKICAgIGZvciBteSAkS2V5IChARmllbGRzV2l0aG91dFByaW8pIHsKICAgICAgICAkUmVzdWx0eyRLZXl9LT57UHJpb30gPSAkQmFzZVByaW8rKzsKICAgIH0KCiAgICByZXR1cm4gJVJlc3VsdDsKfQoKPWhlYWQyIEFydGljbGVQcmV2aWV3KCkKClJldHVybnMgYXJ0aWNsZSBwcmV2aWV3IGZvciBhIE1JTUVCYXNlIGFydGljbGUuCgogICAgJExheW91dE9iamVjdC0+QXJ0aWNsZVByZXZpZXcoCiAgICAgICAgVGlja2V0SUQgICA9PiAxMjMsICAgICAjIChyZXF1aXJlZCkKICAgICAgICBBcnRpY2xlSUQgID0+IDEyMywgICAgICMgKHJlcXVpcmVkKQogICAgICAgIFJlc3VsdFR5cGUgPT4gJ3BsYWluJywgIyAob3B0aW9uYWwpIHBsYWlufEhUTUwuIERlZmF1bHQgSFRNTC4KICAgICAgICBNYXhMZW5ndGggID0+IDUwLCAgICAgICMgKG9wdGlvbmFsKSBwZXJmb3JtcyB0cmltbWluZyAoZm9yIHBsYWluIHJlc3VsdCBvbmx5KQogICAgKTsKClJldHVybnMgYXJ0aWNsZSBwcmV2aWV3IGluIHNjYWxhciBmb3JtOgoKICAgICRBcnRpY2xlUHJldmlldyA9ICdIZWxsbywgd29ybGQhJzsKCklmIEhUTUwgcHJldmlldyB3YXMgcmVxdWVzdGVkLCBidXQgSFRNTCBjb250ZW50IGRvZXMgbm90IGV4aXN0IGZvciBhbiBhcnRpY2xlLCB0aGlzIGZ1bmN0aW9uIHdpbGwgcmV0dXJuIHVuZGVmLgoKPWN1dAoKc3ViIEFydGljbGVQcmV2aWV3IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBDaGVjayBuZWVkZWQgc3R1ZmYuCiAgICBmb3IgbXkgJE5lZWRlZCAocXcoVGlja2V0SUQgQXJ0aWNsZUlEKSkgewogICAgICAgIGlmICggISRQYXJhbXskTmVlZGVkfSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIk5lZWQgJE5lZWRlZCEiLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgIGlmICggJFBhcmFte01heExlbmd0aH0gJiYgIUlzUG9zaXRpdmVJbnRlZ2VyKCAkUGFyYW17TWF4TGVuZ3RofSApICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiTWF4TGVuZ3RoIG11c3QgYmUgcG9zaXRpdmUgaW50ZWdlciEiCiAgICAgICAgKTsKCiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIG15ICRBcnRpY2xlQmFja2VuZE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpUaWNrZXQ6OkFydGljbGUnKS0+QmFja2VuZEZvckFydGljbGUoJVBhcmFtKTsKCiAgICBteSAlQXJ0aWNsZSA9ICRBcnRpY2xlQmFja2VuZE9iamVjdC0+QXJ0aWNsZUdldCgKICAgICAgICAlUGFyYW0sCiAgICAgICAgRHluYW1pY0ZpZWxkcyA9PiAwLAogICAgKTsKCiAgICBteSAkUmVzdWx0OwoKICAgIGlmICggJFBhcmFte1Jlc3VsdFR5cGV9ICYmICRQYXJhbXtSZXN1bHRUeXBlfSBlcSAncGxhaW4nICkgewoKICAgICAgICAjIHBsYWluCiAgICAgICAgJFJlc3VsdCA9ICRBcnRpY2xle0JvZHl9OwoKICAgICAgICBpZiAoICRQYXJhbXtNYXhMZW5ndGh9ICkgewoKICAgICAgICAgICAgIyB0cmltCiAgICAgICAgICAgICRSZXN1bHQgPSBzdWJzdHIoICRSZXN1bHQsIDAsICRQYXJhbXtNYXhMZW5ndGh9ICk7CiAgICAgICAgfQogICAgfQogICAgZWxzZSB7CiAgICAgICAgbXkgJEhUTUxCb2R5QXR0YWNobWVudElEID0gJFNlbGYtPkhUTUxCb2R5QXR0YWNobWVudElER2V0KCVQYXJhbSk7CgogICAgICAgIGlmICgkSFRNTEJvZHlBdHRhY2htZW50SUQpIHsKCiAgICAgICAgICAgICMgUHJldmlldyBkb2Vzbid0IGluY2x1ZGUgaW5saW5lIGltYWdlcy4uLgogICAgICAgICAgICBteSAlRGF0YSA9ICRBcnRpY2xlQmFja2VuZE9iamVjdC0+QXJ0aWNsZUF0dGFjaG1lbnQoCiAgICAgICAgICAgICAgICBBcnRpY2xlSUQgPT4gJFBhcmFte0FydGljbGVJRH0sCiAgICAgICAgICAgICAgICBGaWxlSUQgICAgPT4gJEhUTUxCb2R5QXR0YWNobWVudElELAogICAgICAgICAgICApOwoKICAgICAgICAgICAgIyBHZXQgdGhlIGNoYXJzZXQgZGlyZWN0bHkgZnJvbSB0aGUgYXR0YWNobWVudCBoYXNoIGFuZCBjb252ZXJ0IGNvbnRlbnQgdG8gdGhlIGludGVybmFsIGNoYXJzZXQgKHV0Zi04KS4KICAgICAgICAgICAgIyAgIFBsZWFzZSBzZWUgYnVnIzEzMzY3IGZvciBtb3JlIGluZm9ybWF0aW9uLgogICAgICAgICAgICBteSAkQ2hhcnNldDsKICAgICAgICAgICAgaWYgKCAkRGF0YXtDb250ZW50VHlwZX0gPX4gbS8uKz9jaGFyc2V0PSgifCd8KSg/PENoYXJzZXQ+LispL2lnICkgewogICAgICAgICAgICAgICAgJENoYXJzZXQgPSAkK3tDaGFyc2V0fTsKICAgICAgICAgICAgICAgICRDaGFyc2V0ID1+IHMvInwnLy9nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJENoYXJzZXQgPSAndXMtYXNjaWknOwogICAgICAgICAgICB9CgogICAgICAgICAgICAkUmVzdWx0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkVuY29kZScpLT5Db252ZXJ0KAogICAgICAgICAgICAgICAgVGV4dCAgPT4gJERhdGF7Q29udGVudH0sCiAgICAgICAgICAgICAgICBGcm9tICA9PiAkQ2hhcnNldCwKICAgICAgICAgICAgICAgIFRvICAgID0+ICd1dGYtOCcsCiAgICAgICAgICAgICAgICBDaGVjayA9PiAxLAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gJFJlc3VsdDsKfQoKPWhlYWQyIEhUTUxCb2R5QXR0YWNobWVudElER2V0KCkKClJldHVybnMgSFRNTEJvZHlBdHRhY2htZW50SUQuCgogICAgbXkgJEhUTUxCb2R5QXR0YWNobWVudElEID0gJExheW91dE9iamVjdC0+SFRNTEJvZHlBdHRhY2htZW50SURHZXQoCiAgICAgICAgVGlja2V0SUQgID0+IDEyMywgICAgICMgKHJlcXVpcmVkKQogICAgICAgIEFydGljbGVJRCA9PiAxMjMsICAgICAjIChyZXF1aXJlZCkKICAgICk7CgpSZXR1cm5zCgogICAgJEhUTUxCb2R5QXR0YWNobWVudElEID0gMjM7Cgo9Y3V0CgpzdWIgSFRNTEJvZHlBdHRhY2htZW50SURHZXQgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIENoZWNrIG5lZWRlZCBzdHVmZi4KICAgIGZvciBteSAkTmVlZGVkIChxdyhUaWNrZXRJRCBBcnRpY2xlSUQpKSB7CiAgICAgICAgaWYgKCAhJFBhcmFteyROZWVkZWR9ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCAkTmVlZGVkISIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgbXkgJEFydGljbGVCYWNrZW5kT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpY2tldDo6QXJ0aWNsZScpLT5CYWNrZW5kRm9yQXJ0aWNsZSglUGFyYW0pOwoKICAgICMgR2V0IGEgSFRNTCBhdHRhY2htZW50LgogICAgbXkgJUF0dGFjaG1lbnRJbmRleEhUTUxCb2R5ID0gJEFydGljbGVCYWNrZW5kT2JqZWN0LT5BcnRpY2xlQXR0YWNobWVudEluZGV4KAogICAgICAgIEFydGljbGVJRCAgICA9PiAkUGFyYW17QXJ0aWNsZUlEfSwKICAgICAgICBPbmx5SFRNTEJvZHkgPT4gMSwKICAgICk7CgogICAgbXkgKCRIVE1MQm9keUF0dGFjaG1lbnRJRCkgPSBzb3J0IGtleXMgJUF0dGFjaG1lbnRJbmRleEhUTUxCb2R5OwoKICAgIHJldHVybiAkSFRNTEJvZHlBdHRhY2htZW50SUQ7Cn0KCj1oZWFkMiBBcnRpY2xlQ3VzdG9tZXJSZWNpcGllbnRzR2V0KCkKCkdldCBjdXN0b21lciB1c2VycyBmcm9tIGFuIGFydGljbGUgdG8gdXNlIGFzIHJlY2lwaWVudHMuCgogICAgbXkgQEN1c3RvbWVyVXNlcklEcyA9ICRMYXlvdXRPYmplY3QtPkFydGljbGVDdXN0b21lclJlY2lwaWVudHNHZXQoCiAgICAgICAgVGlja2V0SUQgID0+IDEyMywgICAgICMgKHJlcXVpcmVkKQogICAgICAgIEFydGljbGVJRCA9PiAxMjMsICAgICAjIChyZXF1aXJlZCkKICAgICk7CgpSZXR1cm5zIGFycmF5IG9mIGN1c3RvbWVyIHVzZXIgSURzIHdobyBzaG91bGQgcmVjZWl2ZSBhIG1lc3NhZ2U6CgogICAgQEN1c3RvbWVyVXNlcklEcyA9ICgKICAgICAgICAnY3VzdG9tZXItMScsCiAgICAgICAgJ2N1c3RvbWVyLTInLAogICAgICAgIC4uLgogICAgKTsKCj1jdXQKCnN1YiBBcnRpY2xlQ3VzdG9tZXJSZWNpcGllbnRzR2V0IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgZm9yIG15ICROZWVkZWQgKHF3KFRpY2tldElEIEFydGljbGVJRCkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICROZWVkZWQhIiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICBteSAlQXJ0aWNsZSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpUaWNrZXQ6OkFydGljbGUnKS0+QmFja2VuZEZvckFydGljbGUoJVBhcmFtKS0+QXJ0aWNsZUdldCglUGFyYW0pOwogICAgcmV0dXJuIGlmICElQXJ0aWNsZTsKCiAgICBteSAkUmVjaXBpZW50RW1haWwgPSAkQXJ0aWNsZXtGcm9tfTsKCiAgICAjIENoZWNrIFJlcGx5VG8uCiAgICBpZiAoICRBcnRpY2xle1JlcGx5VG99ICkgewogICAgICAgICRSZWNpcGllbnRFbWFpbCA9ICRBcnRpY2xle1JlcGx5VG99OwogICAgfQoKICAgICMgQ2hlY2sgYXJ0aWNsZSB0eXBlIGFuZCB1c2UgVG8gaW4gY2FzZSBzZW5kZXIgaXMgbm90IGN1c3RvbWVyLgogICAgaWYgKCAkQXJ0aWNsZXtTZW5kZXJUeXBlfSAhfiAvY3VzdG9tZXIvICkgewogICAgICAgICRSZWNpcGllbnRFbWFpbCA9ICRBcnRpY2xle1RvfTsKICAgICAgICAkQXJ0aWNsZXtSZXBseVRvfSA9ICcnOwogICAgfQoKICAgIG15ICRDaGVja0l0ZW1PYmplY3QgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2hlY2tJdGVtJyk7CiAgICBteSAkQ3VzdG9tZXJVc2VyT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyVXNlcicpOwoKICAgIG15IEBDdXN0b21lclVzZXJJRHM7CgogICAgRU1BSUw6CiAgICBmb3IgbXkgJEVtYWlsICggTWFpbDo6QWRkcmVzcy0+cGFyc2UoJFJlY2lwaWVudEVtYWlsKSApIHsKICAgICAgICBuZXh0IEVNQUlMIGlmICEkQ2hlY2tJdGVtT2JqZWN0LT5DaGVja0VtYWlsKCBBZGRyZXNzID0+ICRFbWFpbC0+YWRkcmVzcygpICk7CgogICAgICAgICMgR2V0IHNpbmdsZSBjdXN0b21lciB1c2VyIGZyb20gY3VzdG9tZXIgYmFja2VuZCBiYXNlZCBvbiB0aGUgZW1haWwgYWRkcmVzcy4KICAgICAgICBteSAlQ3VzdG9tZXJTZWFyY2ggPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclNlYXJjaCgKICAgICAgICAgICAgUG9zdE1hc3RlclNlYXJjaCA9PiAkRW1haWwtPmFkZHJlc3MoKSwKICAgICAgICAgICAgTGltaXQgICAgICAgICAgICA9PiAxLAogICAgICAgICAgICBVc2VySUQgICAgICAgICAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICApOwogICAgICAgIG5leHQgRU1BSUwgaWYgISVDdXN0b21lclNlYXJjaDsKCiAgICAgICAgIyBTYXZlIGN1c3RvbWVyIHVzZXIgSUQgaWYgbm90IGFscmVhZHkgcHJlc2VudCBpbiB0aGUgbGlzdC4KICAgICAgICBmb3IgbXkgJEN1c3RvbWVyVXNlcklEICggc29ydCBrZXlzICVDdXN0b21lclNlYXJjaCApIHsKICAgICAgICAgICAgcHVzaCBAQ3VzdG9tZXJVc2VySURzLCAkQ3VzdG9tZXJVc2VySUQgaWYgIWdyZXAgeyAkXyBlcSAkQ3VzdG9tZXJVc2VySUQgfSBAQ3VzdG9tZXJVc2VySURzOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gQEN1c3RvbWVyVXNlcklEczsKfQoKMTsK</File>
        <File Location="Custom/Kernel/Output/HTML/Dashboard/CustomerUserList.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxLTIwMjIgWm51bnkgR21iSCwgaHR0cHM6Ly96bnVueS5vcmcvCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6T3V0cHV0OjpIVE1MOjpEYXNoYm9hcmQ6OkN1c3RvbWVyVXNlckxpc3Q7Cgp1c2Ugc3RyaWN0Owp1c2Ugd2FybmluZ3M7Cgp1c2UgS2VybmVsOjpMYW5ndWFnZSBxdyhUcmFuc2xhdGFibGUpOwoKb3VyICRPYmplY3RNYW5hZ2VyRGlzYWJsZWQgPSAxOwoKc3ViIG5ldyB7CiAgICBteSAoICRUeXBlLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgYWxsb2NhdGUgbmV3IGhhc2ggZm9yIG9iamVjdAogICAgbXkgJFNlbGYgPSB7JVBhcmFtfTsKICAgIGJsZXNzKCAkU2VsZiwgJFR5cGUgKTsKCiAgICAjIGdldCBuZWVkZWQgcGFyYW1ldGVycwogICAgZm9yIG15ICROZWVkZWQgKHF3KENvbmZpZyBOYW1lIFVzZXJJRCkpIHsKICAgICAgICBkaWUgIkdvdCBubyAkTmVlZGVkISIgaWYgKCAhJFNlbGYtPnskTmVlZGVkfSApOwogICAgfQoKICAgICMgZ2V0IHBhcmFtIG9iamVjdAogICAgbXkgJFBhcmFtT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OldlYjo6UmVxdWVzdCcpOwoKICAgICMgZ2V0IGN1cnJlbnQgZmlsdGVyCiAgICBteSAkTmFtZSAgICAgICAgICAgPSAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAnTmFtZScgKSB8fCAnJzsKICAgIG15ICRQcmVmZXJlbmNlc0tleSA9ICdVc2VyRGFzaGJvYXJkQ3VzdG9tZXJVc2VyTGlzdEZpbHRlcicgLiAkU2VsZi0+e05hbWV9OwoKICAgICRTZWxmLT57UHJlZktleX0gPSAnVXNlckRhc2hib2FyZFByZWYnIC4gJFNlbGYtPntOYW1lfSAuICctU2hvd24nOwoKICAgICRTZWxmLT57UGFnZVNob3dufSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKS0+eyAkU2VsZi0+e1ByZWZLZXl9IH0KICAgICAgICB8fCAkU2VsZi0+e0NvbmZpZ30tPntMaW1pdH07CgogICAgJFNlbGYtPntTdGFydEhpdH0gPSBpbnQoICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdTdGFydEhpdCcgKSB8fCAxICk7CgogICAgcmV0dXJuICRTZWxmOwp9CgpzdWIgUHJlZmVyZW5jZXMgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSBAUGFyYW1zID0gKAogICAgICAgIHsKICAgICAgICAgICAgRGVzYyAgPT4gVHJhbnNsYXRhYmxlKCdTaG93biBjdXN0b21lciB1c2VycycpLAogICAgICAgICAgICBOYW1lICA9PiAkU2VsZi0+e1ByZWZLZXl9LAogICAgICAgICAgICBCbG9jayA9PiAnT3B0aW9uJywKCiAgICAgICAgICAgICMgICAgICAgICAgICBCbG9jayA9PiAnSW5wdXQnLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgIDUgID0+ICcgNScsCiAgICAgICAgICAgICAgICAxMCA9PiAnMTAnLAogICAgICAgICAgICAgICAgMTUgPT4gJzE1JywKICAgICAgICAgICAgICAgIDIwID0+ICcyMCcsCiAgICAgICAgICAgICAgICAyNSA9PiAnMjUnLAogICAgICAgICAgICB9LAogICAgICAgICAgICBTZWxlY3RlZElEICA9PiAkU2VsZi0+e1BhZ2VTaG93bn0sCiAgICAgICAgICAgIFRyYW5zbGF0aW9uID0+IDAsCiAgICAgICAgfSwKICAgICk7CgogICAgcmV0dXJuIEBQYXJhbXM7Cn0KCnN1YiBDb25maWcgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICByZXR1cm4gKAogICAgICAgICV7ICRTZWxmLT57Q29uZmlnfSB9LAoKICAgICAgICAjIHJlbWVtYmVyLCBkbyBub3QgYWxsb3cgdG8gdXNlIHBhZ2UgY2FjaGUKICAgICAgICAjIChpdCdzIG5vdCB3b3JraW5nIGJlY2F1c2Ugb2YgaW50ZXJuYWwgZmlsdGVyKQogICAgICAgIENhY2hlVFRMID0+IHVuZGVmLAogICAgICAgIENhY2hlS2V5ID0+IHVuZGVmLAogICAgKTsKfQoKc3ViIFJ1biB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIHJldHVybiBpZiAhJFBhcmFte0N1c3RvbWVySUR9OwoKICAgICMgZ2V0IGN1c3RvbWVyIHVzZXIgb2JqZWN0CiAgICBteSAkQ3VzdG9tZXJVc2VyT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyVXNlcicpOwoKICAgIG15ICRDdXN0b21lcklEcyA9IHsKICAgICAgICAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclNlYXJjaCgKICAgICAgICAgICAgQ3VzdG9tZXJJRFJhdyA9PiAkUGFyYW17Q3VzdG9tZXJJRH0sCiAgICAgICAgICAgIFVzZXJJRCA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgKQogICAgfTsKCiAgICAjIGlmIHdlIGFyZSB1c2luZyBtdWx0aXBsZSBDdXN0b21lcklEcyBmb3IgYSBDdXN0b21lclVzZXIsIHdlIGhhdmUgdG8gZXhwYW5kIG91ciBDdXN0b21lcklEcyB2YXJpYWJsZQogICAgbXkgQEN1c3RvbWVyVXNlcklEcyA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyVXNlckN1c3RvbWVyTWVtYmVyTGlzdCgKICAgICAgICBDdXN0b21lcklEID0+ICRQYXJhbXtDdXN0b21lcklEfSwKICAgICk7CgogICAgQ1VTVE9NRVJVU0VSSUQ6CiAgICBmb3IgbXkgJEN1c3RvbWVyVXNlcklEIChAQ3VzdG9tZXJVc2VySURzKSB7CiAgICAgICAgbXkgJUN1c3RvbWVyVXNlckxpc3QgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclNlYXJjaCggVXNlckxvZ2luID0+ICRDdXN0b21lclVzZXJJRCApOwogICAgICAgIG5leHQgQ1VTVE9NRVJVU0VSSUQgaWYgISVDdXN0b21lclVzZXJMaXN0OwogICAgICAgICRDdXN0b21lcklEcyA9IHsgJSRDdXN0b21lcklEcywgJUN1c3RvbWVyVXNlckxpc3QgfTsKICAgIH0KCiAgICAjIGFkZCBwYWdlIG5hdiBiYXIKICAgIG15ICRUb3RhbCA9IHNjYWxhciBrZXlzICV7JEN1c3RvbWVySURzfTsKCiAgICAjIGdldCBsYXlvdXQgb2JqZWN0CiAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwoKICAgIG15ICRMaW5rUGFnZSA9ICdTdWJhY3Rpb249RWxlbWVudDtOYW1lPScKICAgICAgICAuICRTZWxmLT57TmFtZX0gLiAnOycKICAgICAgICAuICdDdXN0b21lcklEPScKICAgICAgICAuICRMYXlvdXRPYmplY3QtPkxpbmtFbmNvZGUoICRQYXJhbXtDdXN0b21lcklEfSApIC4gJzsnOwoKICAgIG15ICVQYWdlTmF2ID0gJExheW91dE9iamVjdC0+UGFnZU5hdkJhcigKICAgICAgICBTdGFydEhpdCAgICA9PiAkU2VsZi0+e1N0YXJ0SGl0fSwKICAgICAgICBQYWdlU2hvd24gICA9PiAkU2VsZi0+e1BhZ2VTaG93bn0sCiAgICAgICAgQWxsSGl0cyAgICAgPT4gJFRvdGFsIHx8IDEsCiAgICAgICAgQWN0aW9uICAgICAgPT4gJ0FjdGlvbj0nIC4gJExheW91dE9iamVjdC0+e0FjdGlvbn0sCiAgICAgICAgTGluayAgICAgICAgPT4gJExpbmtQYWdlLAogICAgICAgIEFKQVhSZXBsYWNlID0+ICdEYXNoYm9hcmQnIC4gJFNlbGYtPntOYW1lfSwKICAgICAgICBJRFByZWZpeCAgICA9PiAnRGFzaGJvYXJkJyAuICRTZWxmLT57TmFtZX0sCiAgICAgICAgQUpBWCAgICAgICAgPT4gJFBhcmFte0FKQVh9LAogICAgKTsKCiAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICBOYW1lID0+ICdDb250ZW50TGFyZ2VDdXN0b21lclVzZXJMaXN0TmF2QmFyJywKICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgJXsgJFNlbGYtPntDb25maWd9IH0sCiAgICAgICAgICAgIE5hbWUgPT4gJFNlbGYtPntOYW1lfSwKICAgICAgICAgICAgJVBhZ2VOYXYsCiAgICAgICAgfSwKICAgICk7CgogICAgIyBnZXQgY29uZmlnIG9iamVjdAogICAgbXkgJENvbmZpZ09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CgogICAgIyBjaGVjayB0aGUgcGVybWlzc2lvbiBmb3IgdGhlIFN3aXRjaFRvQ3VzdG9tZXIgZmVhdHVyZQogICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ1N3aXRjaFRvQ3VzdG9tZXInKSApIHsKCiAgICAgICAgIyBnZXQgZ3JvdXAgb2JqZWN0CiAgICAgICAgbXkgJEdyb3VwT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06Okdyb3VwJyk7CgogICAgICAgICMgZ2V0IHRoZSBncm91cCBpZCB3aGljaCBpcyBhbGxvd2VkIHRvIHVzZSB0aGUgc3dpdGNoIHRvIGN1c3RvbWVyIGZlYXR1cmUKICAgICAgICBteSAkU3dpdGNoVG9DdXN0b21lckdyb3VwSUQgPSAkR3JvdXBPYmplY3QtPkdyb3VwTG9va3VwKAogICAgICAgICAgICBHcm91cCA9PiAkQ29uZmlnT2JqZWN0LT5HZXQoJ1N3aXRjaFRvQ3VzdG9tZXI6OlBlcm1pc3Npb25Hcm91cCcpLAogICAgICAgICk7CgogICAgICAgICMgZ2V0IHVzZXIgZ3JvdXBzLCB3aGVyZSB0aGUgdXNlciBoYXMgdGhlIHJ3IHByaXZpbGVnZQogICAgICAgIG15ICVHcm91cHMgPSAkR3JvdXBPYmplY3QtPlBlcm1pc3Npb25Vc2VyR2V0KAogICAgICAgICAgICBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICBUeXBlICAgPT4gJ3J3JywKICAgICAgICApOwoKICAgICAgICAjIGlmIHRoZSB1c2VyIGlzIGEgbWVtYmVyIGluIHRoaXMgZ3JvdXAgaGUgY2FuIGFjY2VzcyB0aGUgZmVhdHVyZQogICAgICAgIGlmICggJEdyb3Vwc3skU3dpdGNoVG9DdXN0b21lckdyb3VwSUR9ICkgewoKICAgICAgICAgICAgJFNlbGYtPntTd2l0Y2hUb0N1c3RvbWVyUGVybWlzc2lvbn0gPSAxOwoKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdPdmVydmlld1Jlc3VsdFN3aXRjaFRvQ3VzdG9tZXInLAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICAjIHNob3cgY2hhbmdlIGN1c3RvbWVyIHJlbGF0aW9ucyBidXR0b24gaWYgdGhlIGFnZW50IGhhcyBwZXJtaXNzaW9uCiAgICBteSAkQ2hhbmdlQ3VzdG9tZXJSZWxlYXRpb25zQWNjZXNzID0gJExheW91dE9iamVjdC0+UGVybWlzc2lvbigKICAgICAgICBBY3Rpb24gPT4gJ0FkbWluQ3VzdG9tZXJVc2VyQ3VzdG9tZXInLAogICAgICAgIFR5cGUgICA9PiAncncnLAogICAgKTsKCiAgICBpZiAoJENoYW5nZUN1c3RvbWVyUmVsZWF0aW9uc0FjY2VzcykgewogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdDb250ZW50TGFyZ2VDdXN0b21lcklEQWRkJywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICBDdXN0b21lcklEID0+ICRQYXJhbXtDdXN0b21lcklEfSwKICAgICAgICAgICAgfSwKICAgICAgICApOwogICAgfQoKICAgICMgU2hvdyBhZGQgbmV3IGN1c3RvbWVyIGJ1dHRvbiBpZjoKICAgICMgICAtIFRoZSBhZ2VudCBoYXMgcGVybWlzc2lvbiB0byB1c2UgdGhlIG1vZHVsZQogICAgIyAgIC0gVGhlcmUgYXJlIHdyaXRhYmxlIGN1c3RvbWVyIGJhY2tlbmRzCiAgICBteSAkQWRkQWNjZXNzOwoKICAgIFRZUEU6CiAgICBmb3IgbXkgJFBlcm1pc3Npb24gKHF3KHJvIHJ3KSkgewogICAgICAgICRBZGRBY2Nlc3MgPSAkTGF5b3V0T2JqZWN0LT5QZXJtaXNzaW9uKAogICAgICAgICAgICBBY3Rpb24gPT4gJ0FkbWluQ3VzdG9tZXJVc2VyJywKICAgICAgICAgICAgVHlwZSAgID0+ICRQZXJtaXNzaW9uLAogICAgICAgICk7CiAgICAgICAgbGFzdCBUWVBFIGlmICRBZGRBY2Nlc3M7CiAgICB9CgogICAgIyBHZXQgd3JpdGFibGUgZGF0YSBzb3VyY2VzLgogICAgbXkgJUN1c3RvbWVyU291cmNlID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJTb3VyY2VMaXN0KAogICAgICAgIFJlYWRPbmx5ID0+IDAsCiAgICApOwoKICAgIGlmICggJEFkZEFjY2VzcyAmJiBzY2FsYXIga2V5cyAlQ3VzdG9tZXJTb3VyY2UgKSB7CiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ0NvbnRlbnRMYXJnZUN1c3RvbWVyVXNlckFkZCcsCiAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgQ3VzdG9tZXJJRCA9PiAkU2VsZi0+e0N1c3RvbWVySUR9LAogICAgICAgICAgICB9LAogICAgICAgICk7CgogICAgICAgICRTZWxmLT57RWRpdEN1c3RvbWVyUGVybWlzc2lvbn0gPSAxOwogICAgfQoKICAgICMgZ2V0IHRoZSBwZXJtaXNzaW9uIGZvciB0aGUgcGhvbmUgdGlja2V0IGNyZWF0aW9uCiAgICBteSAkTmV3QWdlbnRUaWNrZXRQaG9uZVBlcm1pc3Npb24gPSAkTGF5b3V0T2JqZWN0LT5QZXJtaXNzaW9uKAogICAgICAgIEFjdGlvbiA9PiAnQWdlbnRUaWNrZXRQaG9uZScsCiAgICAgICAgVHlwZSAgID0+ICdydycsCiAgICApOwoKICAgICMgY2hlY2sgdGhlIHBlcm1pc3Npb24gZm9yIHRoZSBwaG9uZSB0aWNrZXQgY3JlYXRpb24KICAgIGlmICgkTmV3QWdlbnRUaWNrZXRQaG9uZVBlcm1pc3Npb24pIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnT3ZlcnZpZXdSZXN1bHROZXdBZ2VudFRpY2tldFBob25lJywKICAgICAgICApOwogICAgfQoKICAgICMgZ2V0IHRoZSBwZXJtaXNzaW9uIGZvciB0aGUgZW1haWwgdGlja2V0IGNyZWF0aW9uCiAgICBteSAkTmV3QWdlbnRUaWNrZXRFbWFpbFBlcm1pc3Npb24gPSAkTGF5b3V0T2JqZWN0LT5QZXJtaXNzaW9uKAogICAgICAgIEFjdGlvbiA9PiAnQWdlbnRUaWNrZXRFbWFpbCcsCiAgICAgICAgVHlwZSAgID0+ICdydycsCiAgICApOwoKICAgICMgY2hlY2sgdGhlIHBlcm1pc3Npb24gZm9yIHRoZSBlbWFpbCB0aWNrZXQgY3JlYXRpb24KICAgIGlmICgkTmV3QWdlbnRUaWNrZXRFbWFpbFBlcm1pc3Npb24pIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnT3ZlcnZpZXdSZXN1bHROZXdBZ2VudFRpY2tldEVtYWlsJywKICAgICAgICApOwogICAgfQoKICAgIG15IEBDdXN0b21lcktleXMgPSBzb3J0IHsgbGMoICRDdXN0b21lcklEcy0+eyRhfSApIGNtcCBsYyggJEN1c3RvbWVySURzLT57JGJ9ICkgfSBrZXlzICV7JEN1c3RvbWVySURzfTsKICAgIEBDdXN0b21lcktleXMgPSBzcGxpY2UgQEN1c3RvbWVyS2V5cywgJFNlbGYtPntTdGFydEhpdH0gLSAxLCAkU2VsZi0+e1BhZ2VTaG93bn07CgogICAgZm9yIG15ICRDdXN0b21lcktleSAoQEN1c3RvbWVyS2V5cykgewogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdDb250ZW50TGFyZ2VDdXN0b21lclVzZXJMaXN0Um93JywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICBFZGl0Q3VzdG9tZXJQZXJtaXNzaW9uID0+ICRTZWxmLT57RWRpdEN1c3RvbWVyUGVybWlzc2lvbn0sCiAgICAgICAgICAgICAgICBDdXN0b21lcktleSAgICAgICAgICAgID0+ICRDdXN0b21lcktleSwKICAgICAgICAgICAgICAgIEN1c3RvbWVyTGlzdEVudHJ5ICAgICAgPT4gJEN1c3RvbWVySURzLT57JEN1c3RvbWVyS2V5fSwKICAgICAgICAgICAgfSwKICAgICAgICApOwoKICAgICAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnQ2hhdEVuZ2luZTo6QWN0aXZlJykgKSB7CgogICAgICAgICAgICAjIENoZWNrIGlmIGFnZW50IGhhcyBwZXJtaXNzaW9uIHRvIHN0YXJ0IGNoYXRzIHdpdGggdGhlIGN1c3RvbWVyIHVzZXJzLgogICAgICAgICAgICBteSAkRW5hYmxlQ2hhdCA9IDE7CiAgICAgICAgICAgIG15ICRDaGF0U3RhcnRpbmdBZ2VudHNHcm91cAogICAgICAgICAgICAgICAgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ0NoYXRFbmdpbmU6OlBlcm1pc3Npb25Hcm91cDo6Q2hhdFN0YXJ0aW5nQWdlbnRzJykgfHwgJ3VzZXJzJzsKICAgICAgICAgICAgbXkgJENoYXRTdGFydGluZ0FnZW50c0dyb3VwUGVybWlzc2lvbiA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpHcm91cCcpLT5QZXJtaXNzaW9uQ2hlY2soCiAgICAgICAgICAgICAgICBVc2VySUQgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICAgICAgR3JvdXBOYW1lID0+ICRDaGF0U3RhcnRpbmdBZ2VudHNHcm91cCwKICAgICAgICAgICAgICAgIFR5cGUgICAgICA9PiAncncnLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKCAhJENoYXRTdGFydGluZ0FnZW50c0dyb3VwUGVybWlzc2lvbiApIHsKICAgICAgICAgICAgICAgICRFbmFibGVDaGF0ID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAkRW5hYmxlQ2hhdAogICAgICAgICAgICAgICAgJiYgISRDb25maWdPYmplY3QtPkdldCgnQ2hhdEVuZ2luZTo6Q2hhdERpcmVjdGlvbjo6QWdlbnRUb0N1c3RvbWVyJykKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJEVuYWJsZUNoYXQgPSAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoJEVuYWJsZUNoYXQpIHsKICAgICAgICAgICAgICAgIG15ICRWaWRlb0NoYXRFbmFibGVkID0gMDsKICAgICAgICAgICAgICAgIG15ICRWaWRlb0NoYXRBZ2VudHNHcm91cAogICAgICAgICAgICAgICAgICAgID0gJENvbmZpZ09iamVjdC0+R2V0KCdDaGF0RW5naW5lOjpQZXJtaXNzaW9uR3JvdXA6OlZpZGVvQ2hhdEFnZW50cycpIHx8ICd1c2Vycyc7CiAgICAgICAgICAgICAgICBteSAkVmlkZW9DaGF0QWdlbnRzR3JvdXBQZXJtaXNzaW9uID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06Okdyb3VwJyktPlBlcm1pc3Npb25DaGVjaygKICAgICAgICAgICAgICAgICAgICBVc2VySUQgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICAgICAgICAgIEdyb3VwTmFtZSA9PiAkVmlkZW9DaGF0QWdlbnRzR3JvdXAsCiAgICAgICAgICAgICAgICAgICAgVHlwZSAgICAgID0+ICdydycsCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICMgRW5hYmxlIHRoZSB2aWRlbyBjaGF0IGZlYXR1cmUgaWYgc3lzdGVtIGlzIGVudGl0bGVkIGFuZCBhZ2VudCBpcyBhIG1lbWJlciBvZiBjb25maWd1cmVkIGdyb3VwLgogICAgICAgICAgICAgICAgaWYgKCRWaWRlb0NoYXRBZ2VudHNHcm91cFBlcm1pc3Npb24pIHsKICAgICAgICAgICAgICAgICAgICBpZiAoICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpNYWluJyktPlJlcXVpcmUoICdLZXJuZWw6OlN5c3RlbTo6VmlkZW9DaGF0JywgU2lsZW50ID0+IDEgKSApCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAkVmlkZW9DaGF0RW5hYmxlZCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpWaWRlb0NoYXQnKS0+SXNFbmFibGVkKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG15ICRDdXN0b21lckVuYWJsZUNoYXQgPSAwOwogICAgICAgICAgICAgICAgbXkgJENoYXRBY2Nlc3MgICAgICAgICA9IDA7CiAgICAgICAgICAgICAgICBteSAkVmlkZW9DaGF0QXZhaWxhYmxlID0gMDsKICAgICAgICAgICAgICAgIG15ICRWaWRlb0NoYXRTdXBwb3J0ICAgPSAwOwoKICAgICAgICAgICAgICAgICMgRGVmYXVsdCBzdGF0dXMgaXMgb2ZmbGluZS4KICAgICAgICAgICAgICAgIG15ICRVc2VyU3RhdGUgICAgICAgICAgICA9IFRyYW5zbGF0YWJsZSgnT2ZmbGluZScpOwogICAgICAgICAgICAgICAgbXkgJFVzZXJTdGF0ZURlc2NyaXB0aW9uID0gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCdVc2VyIGlzIGN1cnJlbnRseSBvZmZsaW5lLicpOwoKICAgICAgICAgICAgICAgIG15ICRDdXN0b21lckNoYXRBdmFpbGFiaWxpdHkgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2hhdCcpLT5DdXN0b21lckF2YWlsYWJpbGl0eUdldCgKICAgICAgICAgICAgICAgICAgICBVc2VySUQgPT4gJEN1c3RvbWVyS2V5LAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICBteSAkQ3VzdG9tZXJVc2VyT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyVXNlcicpOwoKICAgICAgICAgICAgICAgIG15ICVDdXN0b21lclVzZXIgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJEYXRhR2V0KAogICAgICAgICAgICAgICAgICAgIFVzZXIgPT4gJEN1c3RvbWVyS2V5LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICRDdXN0b21lclVzZXJ7VXNlckZ1bGxuYW1lfSA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyTmFtZSgKICAgICAgICAgICAgICAgICAgICBVc2VyTG9naW4gPT4gJEN1c3RvbWVyS2V5LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICRWaWRlb0NoYXRTdXBwb3J0ID0gMSBpZiAkQ3VzdG9tZXJVc2Vye1ZpZGVvQ2hhdEhhc1dlYlJUQ307CgogICAgICAgICAgICAgICAgaWYgKCAkQ3VzdG9tZXJDaGF0QXZhaWxhYmlsaXR5ID09IDMgKSB7CiAgICAgICAgICAgICAgICAgICAgJFVzZXJTdGF0ZSAgICAgICAgICAgID0gVHJhbnNsYXRhYmxlKCdBY3RpdmUnKTsKICAgICAgICAgICAgICAgICAgICAkQ3VzdG9tZXJFbmFibGVDaGF0ICAgPSAxOwogICAgICAgICAgICAgICAgICAgICRVc2VyU3RhdGVEZXNjcmlwdGlvbiA9ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgnVXNlciBpcyBjdXJyZW50bHkgYWN0aXZlLicpOwogICAgICAgICAgICAgICAgICAgICRWaWRlb0NoYXRBdmFpbGFibGUgICA9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNpZiAoICRDdXN0b21lckNoYXRBdmFpbGFiaWxpdHkgPT0gMiApIHsKICAgICAgICAgICAgICAgICAgICAkVXNlclN0YXRlICAgICAgICAgID0gVHJhbnNsYXRhYmxlKCdBd2F5Jyk7CiAgICAgICAgICAgICAgICAgICAgJEN1c3RvbWVyRW5hYmxlQ2hhdCA9IDE7CiAgICAgICAgICAgICAgICAgICAgJFVzZXJTdGF0ZURlc2NyaXB0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgID0gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCdVc2VyIHdhcyBpbmFjdGl2ZSBmb3IgYSB3aGlsZS4nKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICdDb250ZW50TGFyZ2VDdXN0b21lclVzZXJMaXN0Um93VXNlclN0YXR1cycsCiAgICAgICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICVDdXN0b21lclVzZXIsCiAgICAgICAgICAgICAgICAgICAgICAgIFVzZXJTdGF0ZSAgICAgICAgICAgID0+ICRVc2VyU3RhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgIFVzZXJTdGF0ZURlc2NyaXB0aW9uID0+ICRVc2VyU3RhdGVEZXNjcmlwdGlvbiwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgJEN1c3RvbWVyRW5hYmxlQ2hhdAogICAgICAgICAgICAgICAgICAgICYmICRDb25maWdPYmplY3QtPkdldCgnVGlja2V0OjpBZ2VudDo6U3RhcnRDaGF0V09UaWNrZXQnKQogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAnQ29udGVudExhcmdlQ3VzdG9tZXJVc2VyTGlzdFJvd0NoYXRJY29ucycsCiAgICAgICAgICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJUN1c3RvbWVyVXNlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZpZGVvQ2hhdEVuYWJsZWQgICA9PiAkVmlkZW9DaGF0RW5hYmxlZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZpZGVvQ2hhdEF2YWlsYWJsZSA9PiAkVmlkZW9DaGF0QXZhaWxhYmxlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVmlkZW9DaGF0U3VwcG9ydCAgID0+ICRWaWRlb0NoYXRTdXBwb3J0LAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgZ2V0IHRpY2tldCBvYmplY3QKICAgICAgICBteSAkVGlja2V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpY2tldCcpOwoKICAgICAgICBteSAkVGlja2V0Q291bnRPcGVuID0gJFRpY2tldE9iamVjdC0+VGlja2V0U2VhcmNoKAogICAgICAgICAgICBTdGF0ZVR5cGUgICAgICAgICAgICA9PiAnT3BlbicsCiAgICAgICAgICAgIEN1c3RvbWVyVXNlckxvZ2luUmF3ID0+ICRDdXN0b21lcktleSwKICAgICAgICAgICAgUmVzdWx0ICAgICAgICAgICAgICAgPT4gJ0NPVU5UJywKICAgICAgICAgICAgUGVybWlzc2lvbiAgICAgICAgICAgPT4gJFNlbGYtPntDb25maWd9LT57UGVybWlzc2lvbn0sCiAgICAgICAgICAgIFVzZXJJRCAgICAgICAgICAgICAgID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgQ2FjaGVUVEwgICAgICAgICAgICAgPT4gJFNlbGYtPntDb25maWd9LT57Q2FjaGVUVExMb2NhbH0gKiA2MCwKICAgICAgICApIHx8IDA7CgogICAgICAgIG15ICRDdXN0b21lcktleVNRTCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEQicpLT5RdWVyeVN0cmluZ0VzY2FwZSggUXVlcnlTdHJpbmcgPT4gJEN1c3RvbWVyS2V5ICk7CgogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdDb250ZW50TGFyZ2VDdXN0b21lclVzZXJMaXN0Um93Q3VzdG9tZXJVc2VyVGlja2V0c09wZW4nLAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgICAgIENvdW50ICAgICAgICAgID0+ICRUaWNrZXRDb3VudE9wZW4sCiAgICAgICAgICAgICAgICBDdXN0b21lcktleSAgICA9PiAkQ3VzdG9tZXJLZXksCiAgICAgICAgICAgICAgICBDdXN0b21lcktleVNRTCA9PiAkQ3VzdG9tZXJLZXlTUUwsCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKCiAgICAgICAgbXkgJFRpY2tldENvdW50Q2xvc2VkID0gJFRpY2tldE9iamVjdC0+VGlja2V0U2VhcmNoKAogICAgICAgICAgICBTdGF0ZVR5cGUgICAgICAgICAgICA9PiAnQ2xvc2VkJywKICAgICAgICAgICAgQ3VzdG9tZXJVc2VyTG9naW5SYXcgPT4gJEN1c3RvbWVyS2V5LAogICAgICAgICAgICBSZXN1bHQgICAgICAgICAgICAgICA9PiAnQ09VTlQnLAogICAgICAgICAgICBQZXJtaXNzaW9uICAgICAgICAgICA9PiAkU2VsZi0+e0NvbmZpZ30tPntQZXJtaXNzaW9ufSwKICAgICAgICAgICAgVXNlcklEICAgICAgICAgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICBDYWNoZVRUTCAgICAgICAgICAgICA9PiAkU2VsZi0+e0NvbmZpZ30tPntDYWNoZVRUTExvY2FsfSAqIDYwLAogICAgICAgICkgfHwgMDsKCiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ0NvbnRlbnRMYXJnZUN1c3RvbWVyVXNlckxpc3RSb3dDdXN0b21lclVzZXJUaWNrZXRzQ2xvc2VkJywKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICBDb3VudCAgICAgICAgICA9PiAkVGlja2V0Q291bnRDbG9zZWQsCiAgICAgICAgICAgICAgICBDdXN0b21lcktleSAgICA9PiAkQ3VzdG9tZXJLZXksCiAgICAgICAgICAgICAgICBDdXN0b21lcktleVNRTCA9PiAkQ3VzdG9tZXJLZXlTUUwsCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKCiAgICAgICAgIyBjaGVjayB0aGUgcGVybWlzc2lvbiBmb3IgdGhlIHBob25lIHRpY2tldCBjcmVhdGlvbgogICAgICAgIGlmICgkTmV3QWdlbnRUaWNrZXRQaG9uZVBlcm1pc3Npb24pIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdDb250ZW50TGFyZ2VDdXN0b21lclVzZXJMaXN0TmV3QWdlbnRUaWNrZXRQaG9uZScsCiAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJLZXkgICAgICAgPT4gJEN1c3RvbWVyS2V5LAogICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyTGlzdEVudHJ5ID0+ICRDdXN0b21lcklEcy0+eyRDdXN0b21lcktleX0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBjaGVjayB0aGUgcGVybWlzc2lvbiBmb3IgdGhlIGVtYWlsIHRpY2tldCBjcmVhdGlvbgogICAgICAgIGlmICgkTmV3QWdlbnRUaWNrZXRFbWFpbFBlcm1pc3Npb24pIHsKICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICBOYW1lID0+ICdDb250ZW50TGFyZ2VDdXN0b21lclVzZXJMaXN0TmV3QWdlbnRUaWNrZXRFbWFpbCcsCiAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICAgICAgQ3VzdG9tZXJLZXkgICAgICAgPT4gJEN1c3RvbWVyS2V5LAogICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyTGlzdEVudHJ5ID0+ICRDdXN0b21lcklEcy0+eyRDdXN0b21lcktleX0sCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgaWYgKCAkQ29uZmlnT2JqZWN0LT5HZXQoJ1N3aXRjaFRvQ3VzdG9tZXInKSAmJiAkU2VsZi0+e1N3aXRjaFRvQ3VzdG9tZXJQZXJtaXNzaW9ufSApCiAgICAgICAgewogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ092ZXJ2aWV3UmVzdWx0Um93U3dpdGNoVG9DdXN0b21lcicsCiAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICAgICAgQ291bnQgICAgICAgPT4gJFRpY2tldENvdW50Q2xvc2VkLAogICAgICAgICAgICAgICAgICAgIEN1c3RvbWVyS2V5ID0+ICRDdXN0b21lcktleSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgICMgc2hvdyAibm9uZSIgaWYgdGhlcmUgYXJlIG5vIGN1c3RvbWVycwogICAgaWYgKCAhJXskQ3VzdG9tZXJJRHN9ICkgewogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdDb250ZW50TGFyZ2VDdXN0b21lclVzZXJMaXN0Tm9uZScsCiAgICAgICAgICAgIERhdGEgPT4ge30sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGNoZWNrIGZvciByZWZyZXNoIHRpbWUKICAgIG15ICRSZWZyZXNoID0gJyc7CiAgICBpZiAoICRTZWxmLT57VXNlclJlZnJlc2hUaW1lfSApIHsKICAgICAgICAkUmVmcmVzaCA9IDYwICogJFNlbGYtPntVc2VyUmVmcmVzaFRpbWV9OwogICAgICAgIG15ICROYW1lSFRNTCA9ICRTZWxmLT57TmFtZX07CiAgICAgICAgJE5hbWVIVE1MID1+IHN7LX17X314bXNnOwoKICAgICAgICAjIHNlbmQgZGF0YSB0byBKUwogICAgICAgICRMYXlvdXRPYmplY3QtPkFkZEpTRGF0YSgKICAgICAgICAgICAgS2V5ICAgPT4gJ0N1c3RvbWVyVXNlckxpc3RSZWZyZXNoJywKICAgICAgICAgICAgVmFsdWUgPT4gewogICAgICAgICAgICAgICAgJXsgJFNlbGYtPntDb25maWd9IH0sCiAgICAgICAgICAgICAgICBOYW1lICAgICAgICA9PiAkU2VsZi0+e05hbWV9LAogICAgICAgICAgICAgICAgTmFtZUhUTUwgICAgPT4gJE5hbWVIVE1MLAogICAgICAgICAgICAgICAgUmVmcmVzaFRpbWUgPT4gJFJlZnJlc2gsCiAgICAgICAgICAgICAgICBDdXN0b21lcklEICA9PiAkUGFyYW17Q3VzdG9tZXJJRH0sCiAgICAgICAgICAgIH0sCiAgICAgICAgKTsKICAgIH0KCiAgICBteSAkQ29udGVudCA9ICRMYXlvdXRPYmplY3QtPk91dHB1dCgKICAgICAgICBUZW1wbGF0ZUZpbGUgPT4gJ0FnZW50RGFzaGJvYXJkQ3VzdG9tZXJVc2VyTGlzdCcsCiAgICAgICAgRGF0YSAgICAgICAgID0+IHsKICAgICAgICAgICAgJXsgJFNlbGYtPntDb25maWd9IH0sCiAgICAgICAgICAgIEVkaXRDdXN0b21lclBlcm1pc3Npb24gPT4gJFNlbGYtPntFZGl0Q3VzdG9tZXJQZXJtaXNzaW9ufSwKICAgICAgICAgICAgTmFtZSAgICAgICAgICAgICAgICAgICA9PiAkU2VsZi0+e05hbWV9LAogICAgICAgIH0sCiAgICAgICAgQUpBWCA9PiAkUGFyYW17QUpBWH0sCiAgICApOwoKICAgIHJldHVybiAkQ29udGVudDsKfQoKMTsK</File>
        <File Location="Custom/Kernel/Output/HTML/Statistics/View.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxLTIwMjIgWm51bnkgR21iSCwgaHR0cHM6Ly96bnVueS5vcmcvCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6T3V0cHV0OjpIVE1MOjpTdGF0aXN0aWNzOjpWaWV3OwoKdXNlIHN0cmljdDsKdXNlIHdhcm5pbmdzOwoKdXNlIExpc3Q6OlV0aWwgcXcoIGZpcnN0ICk7Cgp1c2UgS2VybmVsOjpTeXN0ZW06OlZhcmlhYmxlQ2hlY2sgcXcoOmFsbCk7CnVzZSBLZXJuZWw6OlN5c3RlbTo6RGF0ZVRpbWU7CgpvdXIgQE9iamVjdERlcGVuZGVuY2llcyA9ICgKICAgICdLZXJuZWw6OkNvbmZpZycsCiAgICAnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcsCiAgICAnS2VybmVsOjpPdXRwdXQ6OlBERjo6U3RhdGlzdGljcycsCiAgICAnS2VybmVsOjpTeXN0ZW06OkNTVicsCiAgICAnS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyQ29tcGFueScsCiAgICAnS2VybmVsOjpTeXN0ZW06OkRhdGVUaW1lJywKICAgICdLZXJuZWw6OlN5c3RlbTo6RXhjZWwnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpHcm91cCcsCiAgICAnS2VybmVsOjpTeXN0ZW06OkxvZycsCiAgICAnS2VybmVsOjpTeXN0ZW06Ok1haW4nLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpTdGF0cycsCiAgICAnS2VybmVsOjpTeXN0ZW06OlRpY2tldDo6QXJ0aWNsZScsCiAgICAnS2VybmVsOjpTeXN0ZW06OlVzZXInLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpXZWI6OlJlcXVlc3QnLAopOwoKdXNlIEtlcm5lbDo6TGFuZ3VhZ2UgcXcoVHJhbnNsYXRhYmxlKTsKCj1oZWFkMSBOQU1FCgpLZXJuZWw6Ok91dHB1dDo6SFRNTDo6U3RhdGlzdGljczo6VmlldyAtIFZpZXcgb2JqZWN0IGZvciBzdGF0aXN0aWNzCgo9aGVhZDEgREVTQ1JJUFRJT04KClByb3ZpZGVzIHNldmVyYWwgZnVuY3Rpb25zIHRvIGdlbmVyYXRlIHN0YXRpc3RpY3MgR1VJIGVsZW1lbnRzLgoKPWhlYWQxIFBVQkxJQyBJTlRFUkZBQ0UKCj1jdXQKCnN1YiBuZXcgewogICAgbXkgKCAkVHlwZSwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGFsbG9jYXRlIG5ldyBoYXNoIGZvciBvYmplY3QKICAgIG15ICRTZWxmID0ge307CiAgICBibGVzcyggJFNlbGYsICRUeXBlICk7CgogICAgcmV0dXJuICRTZWxmOwp9Cgo9aGVhZDIgU3RhdHNQYXJhbXNXaWRnZXQoKQoKZ2VuZXJhdGUgSFRNTCBmb3Igc3RhdGlzdGljcyBydW4gd2lkZ2V0LgoKICAgIG15ICRIVE1MID0gJFN0YXRzVmlld09iamVjdC0+U3RhdHNQYXJhbXNXaWRnZXQoCiAgICAgICAgU3RhdElEID0+ICRTdGF0SUQsCgogICAgICAgIEZvcm1hdHMgPT4geyAgICAgICAgICAgICMgb3B0aW9uYWwsIGxpbWl0IHRoZSBhdmFpbGFibGUgZm9ybWF0cwogICAgICAgICAgICBQcmludCA9PiAnUHJpbnQnLAogICAgICAgIH0KCiAgICAgICAgT3V0cHV0Q291bnRlciA9PiAxLCAgICAgIyBvcHRpb25hbCwgY291bnRlciB0byBhcHBlbmQgdG8gRWxlbWVudElEcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgVGhpcyBpcyBuZWVkZWQgaWYgdGhlcmUgaXMgbW9yZSB0aGFuIG9uZSBzdGF0IG9uIHRoZSBwYWdlLgoKICAgICAgICBBSkFYICAgICAgICAgID0+IDAsICAgICAjIG9wdGlvbmFsLCBrZWVwIHNjcmlwdCB0YWdzIGZvciBBSkFYIHJlc3BvbnNlcwogICAgKTsKCj1jdXQKCnN1YiBTdGF0c1BhcmFtc1dpZGdldCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CiAgICBteSAkQ29uZmlnT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKTsKICAgIG15ICRQYXJhbU9iamVjdCAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6V2ViOjpSZXF1ZXN0Jyk7CgogICAgZm9yIG15ICROZWVkZWQgKHF3KFN0YXQpKSB7CiAgICAgICAgaWYgKCAhJFBhcmFteyROZWVkZWR9ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICJlcnJvciIsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCAkTmVlZGVkISIKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICAjIERvbid0IGFsbG93IHRvIHJ1biBhbiBpbnZhbGlkIHN0YXQuCiAgICByZXR1cm4gaWYgISRQYXJhbXtTdGF0fS0+e1ZhbGlkfTsKCiAgICAkUGFyYW17T3V0cHV0Q291bnRlcn0gfHw9IDE7CgogICAgIyBDaGVjayBpZiB0aGVyZSBhcmUgYW55IGNvbmZpZ3VyYXRpb24gZXJyb3JzIHRoYXQgbXVzdCBiZSBjb3JyZWN0ZWQgYnkgdGhlIHN0YXRzIGFkbWluCiAgICBteSAkU3RhdHNDb25maWd1cmF0aW9uVmFsaWQgPSAkU2VsZi0+U3RhdHNDb25maWd1cmF0aW9uVmFsaWRhdGUoCiAgICAgICAgU3RhdCAgID0+ICRQYXJhbXtTdGF0fSwKICAgICAgICBFcnJvcnMgPT4ge30sCiAgICApOwoKICAgIGlmICggISRTdGF0c0NvbmZpZ3VyYXRpb25WYWxpZCApIHsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgbXkgJEhhc1VzZXJHZXRQYXJhbSA9IHJlZiAkUGFyYW17VXNlckdldFBhcmFtfSBlcSAnSEFTSCc7CgogICAgbXkgJVVzZXJHZXRQYXJhbSA9ICV7ICRQYXJhbXtVc2VyR2V0UGFyYW19IC8vIHt9IH07CiAgICBteSAkRm9ybWF0ICAgICAgID0gJFBhcmFte0Zvcm1hdHN9IHx8ICRDb25maWdPYmplY3QtPkdldCgnU3RhdHM6OkZvcm1hdCcpOwoKICAgIG15ICRMb2NhbEdldFBhcmFtID0gc3ViIHsKICAgICAgICBteSAoJVBhcmFtKSA9IEBfOwogICAgICAgIG15ICRQYXJhbSA9ICRQYXJhbXtQYXJhbX07CiAgICAgICAgcmV0dXJuICRIYXNVc2VyR2V0UGFyYW0gPyAkVXNlckdldFBhcmFteyRQYXJhbX0gOiAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAkUGFyYW0gKTsKICAgIH07CgogICAgbXkgJExvY2FsR2V0QXJyYXkgPSBzdWIgewogICAgICAgIG15ICglUGFyYW0pID0gQF87CiAgICAgICAgbXkgJFBhcmFtID0gJFBhcmFte1BhcmFtfTsKICAgICAgICBpZiAoJEhhc1VzZXJHZXRQYXJhbSkgewogICAgICAgICAgICBpZiAoICRVc2VyR2V0UGFyYW17JFBhcmFtfSAmJiByZWYgJFVzZXJHZXRQYXJhbXskUGFyYW19IGVxICdBUlJBWScgKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gQHsgJFVzZXJHZXRQYXJhbXskUGFyYW19IH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJFBhcmFtT2JqZWN0LT5HZXRBcnJheSggUGFyYW0gPT4gJFBhcmFtICk7CiAgICB9OwoKICAgIG15ICRTdGF0ICAgPSAkUGFyYW17U3RhdH07CiAgICBteSAkU3RhdElEID0gJFN0YXQtPntTdGF0SUR9OwoKICAgIG15ICRPdXRwdXQ7CgogICAgIyBnZXQgdGhlIG9iamVjdCBuYW1lCiAgICBpZiAoICRTdGF0LT57U3RhdFR5cGV9IGVxICdzdGF0aWMnICkgewogICAgICAgICRTdGF0LT57T2JqZWN0TmFtZX0gPSAkU3RhdC0+e0ZpbGV9OwogICAgfQoKICAgICMgaWYgbm8gb2JqZWN0IG5hbWUgaXMgZGVmaW5lZCB1c2UgYW4gZW1wdHkgc3RyaW5nCiAgICAkU3RhdC0+e09iamVjdE5hbWV9IHx8PSAnJzsKCiAgICAjIGNyZWF0ZSBmb3JtYXQgc2VsZWN0IGJveAogICAgbXkgJVNlbGVjdEZvcm1hdDsKICAgIFZBTFVFOgogICAgZm9yIG15ICRWYWx1ZSAoIEB7ICRTdGF0LT57Rm9ybWF0fSB9ICkgewogICAgICAgIG5leHQgVkFMVUUgaWYgIWRlZmluZWQgJEZvcm1hdC0+eyRWYWx1ZX07CiAgICAgICAgJFNlbGVjdEZvcm1hdHskVmFsdWV9ID0gJEZvcm1hdC0+eyRWYWx1ZX07CiAgICB9CgogICAgaWYgKCBrZXlzICVTZWxlY3RGb3JtYXQgPiAxICkgewogICAgICAgIG15ICVGcm9udGVuZDsKICAgICAgICAkRnJvbnRlbmR7U2VsZWN0Rm9ybWF0fSA9ICRMYXlvdXRPYmplY3QtPkJ1aWxkU2VsZWN0aW9uKAogICAgICAgICAgICBEYXRhICAgICAgID0+IFwlU2VsZWN0Rm9ybWF0LAogICAgICAgICAgICBTZWxlY3RlZElEID0+ICRMb2NhbEdldFBhcmFtLT4oIFBhcmFtID0+ICdGb3JtYXQnICksCiAgICAgICAgICAgIE5hbWUgICAgICAgPT4gJ0Zvcm1hdCcsCiAgICAgICAgICAgIENsYXNzICAgICAgPT4gJ01vZGVybml6ZScsCiAgICAgICAgKTsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnRm9ybWF0JywKICAgICAgICAgICAgRGF0YSA9PiBcJUZyb250ZW5kLAogICAgICAgICk7CiAgICB9CiAgICBlbHNpZiAoIGtleXMgJVNlbGVjdEZvcm1hdCA9PSAxICkgewogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdGb3JtYXRGaXhlZCcsCiAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgRm9ybWF0ICAgID0+ICggdmFsdWVzICVTZWxlY3RGb3JtYXQgKVswXSwKICAgICAgICAgICAgICAgIEZvcm1hdEtleSA9PiAoIGtleXMgJVNlbGVjdEZvcm1hdCApWzBdLAogICAgICAgICAgICB9LAogICAgICAgICk7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICByZXR1cm47ICAgICMgbm8gcG9zc2libGUgb3V0cHV0IGZvcm1hdAogICAgfQoKICAgICMgcHJvdmlkZSB0aGUgdGltZSB6b25lIGZpZWxkIG9ubHkgZm9yIGR5bmFtaWMgc3RhdGlzdGljcwogICAgaWYgKCAkU3RhdC0+e1N0YXRUeXBlfSBlcSAnZHluYW1pYycgKSB7CiAgICAgICAgbXkgJFNlbGVjdGVkVGltZVpvbmUgPSAkU2VsZi0+X0dldFZhbGlkVGltZVpvbmUoIFRpbWVab25lID0+ICRMb2NhbEdldFBhcmFtLT4oIFBhcmFtID0+ICdUaW1lWm9uZScgKSApCiAgICAgICAgICAgIC8vICRTdGF0LT57VGltZVpvbmV9CiAgICAgICAgICAgIC8vIEtlcm5lbDo6U3lzdGVtOjpEYXRlVGltZS0+T1RSU1RpbWVab25lR2V0KCk7CgogICAgICAgIG15ICVUaW1lWm9uZUJ1aWxkU2VsZWN0aW9uID0gJFNlbGYtPl9UaW1lWm9uZUJ1aWxkU2VsZWN0aW9uKAogICAgICAgICAgICBJbmNsdWRlVGltZVpvbmUgPT4gJFNlbGVjdGVkVGltZVpvbmUsCiAgICAgICAgKTsKCiAgICAgICAgbXkgJUZyb250ZW5kOwogICAgICAgICRGcm9udGVuZHtTZWxlY3RUaW1lWm9uZX0gPSAkTGF5b3V0T2JqZWN0LT5CdWlsZFNlbGVjdGlvbigKICAgICAgICAgICAgJVRpbWVab25lQnVpbGRTZWxlY3Rpb24sCiAgICAgICAgICAgIE5hbWUgICAgICAgPT4gJ1RpbWVab25lJywKICAgICAgICAgICAgQ2xhc3MgICAgICA9PiAnTW9kZXJuaXplJywKICAgICAgICAgICAgU2VsZWN0ZWRJRCA9PiAkU2VsZWN0ZWRUaW1lWm9uZSwKICAgICAgICApOwoKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnVGltZVpvbmUnLAogICAgICAgICAgICBEYXRhID0+IFwlRnJvbnRlbmQsCiAgICAgICAgKTsKICAgIH0KCiAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnU3RhdHM6OkV4Y2hhbmdlQXhpcycpICkgewogICAgICAgIG15ICRFeGNoYW5nZUF4aXMgPSAkTGF5b3V0T2JqZWN0LT5CdWlsZFNlbGVjdGlvbigKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAxID0+IFRyYW5zbGF0YWJsZSgnWWVzJyksCiAgICAgICAgICAgICAgICAwID0+IFRyYW5zbGF0YWJsZSgnTm8nKQogICAgICAgICAgICB9LAogICAgICAgICAgICBOYW1lICAgICAgID0+ICdFeGNoYW5nZUF4aXMnLAogICAgICAgICAgICBTZWxlY3RlZElEID0+ICRMb2NhbEdldFBhcmFtLT4oIFBhcmFtID0+ICdFeGNoYW5nZUF4aXMnICkgLy8gMCwKICAgICAgICAgICAgQ2xhc3MgICAgICA9PiAnTW9kZXJuaXplJywKICAgICAgICApOwoKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAnRXhjaGFuZ2VBeGlzJywKICAgICAgICAgICAgRGF0YSA9PiB7IEV4Y2hhbmdlQXhpcyA9PiAkRXhjaGFuZ2VBeGlzIH0KICAgICAgICApOwogICAgfQoKICAgICMgZ2V0IHN0YXRpYyBhdHRyaWJ1dGVzCiAgICBpZiAoICRTdGF0LT57U3RhdFR5cGV9IGVxICdzdGF0aWMnICkgewoKICAgICAgICAjIGxvYWQgc3RhdGljIG1vZHVsZQogICAgICAgIG15ICRQYXJhbXMgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6U3RhdHMnKS0+R2V0UGFyYW1zKCBTdGF0SUQgPT4gJFN0YXRJRCApOwoKICAgICAgICByZXR1cm4gaWYgISRQYXJhbXM7CgogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdTdGF0aWMnLAogICAgICAgICk7CgogICAgICAgIFBBUkFNSVRFTToKICAgICAgICBmb3IgbXkgJFBhcmFtSXRlbSAoIEB7JFBhcmFtc30gKSB7CiAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgTmFtZSA9PiAnSXRlbVBhcmFtJywKICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgIFBhcmFtID0+ICRQYXJhbUl0ZW0tPntGcm9udGVuZH0sCiAgICAgICAgICAgICAgICAgICAgTmFtZSAgPT4gJFBhcmFtSXRlbS0+e05hbWV9LAogICAgICAgICAgICAgICAgICAgIEZpZWxkID0+ICRMYXlvdXRPYmplY3QtPkJ1aWxkU2VsZWN0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICBEYXRhICAgICAgID0+ICRQYXJhbUl0ZW0tPntEYXRhfSwKICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSAgICAgICA9PiAkUGFyYW1JdGVtLT57TmFtZX0sCiAgICAgICAgICAgICAgICAgICAgICAgIFNlbGVjdGVkSUQgPT4gJExvY2FsR2V0UGFyYW0tPiggUGFyYW0gPT4gJFBhcmFtSXRlbS0+e05hbWV9ICkgLy8gJFBhcmFtSXRlbS0+e1NlbGVjdGVkSUR9IHx8ICcnLAogICAgICAgICAgICAgICAgICAgICAgICBNdWx0aXBsZSAgID0+ICRQYXJhbUl0ZW0tPntNdWx0aXBsZX0gfHwgMCwKICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSAgICAgICA9PiAkUGFyYW1JdGVtLT57U2l6ZX0gfHwgJycsCiAgICAgICAgICAgICAgICAgICAgICAgIENsYXNzICAgICAgPT4gJ01vZGVybml6ZScsCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgICMgZ2V0IGR5bmFtaWMgYXR0cmlidXRlcwogICAgZWxzaWYgKCAkU3RhdC0+e1N0YXRUeXBlfSBlcSAnZHluYW1pYycgKSB7CiAgICAgICAgbXkgJU5hbWUgPSAoCiAgICAgICAgICAgIFVzZUFzWHZhbHVlICAgICAgPT4gVHJhbnNsYXRhYmxlKCdYLWF4aXMnKSwKICAgICAgICAgICAgVXNlQXNWYWx1ZVNlcmllcyA9PiBUcmFuc2xhdGFibGUoJ1ktYXhpcycpLAogICAgICAgICAgICBVc2VBc1Jlc3RyaWN0aW9uID0+IFRyYW5zbGF0YWJsZSgnRmlsdGVyJyksCiAgICAgICAgKTsKCiAgICAgICAgZm9yIG15ICRVc2UgKHF3KFVzZUFzWHZhbHVlIFVzZUFzVmFsdWVTZXJpZXMgVXNlQXNSZXN0cmljdGlvbikpIHsKICAgICAgICAgICAgbXkgJEZsYWcgPSAwOwogICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgIE5hbWUgPT4gJ0R5bmFtaWMnLAogICAgICAgICAgICAgICAgRGF0YSA9PiB7IE5hbWUgPT4gJE5hbWV7JFVzZX0gfSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgT0JKRUNUQVRUUklCVVRFOgogICAgICAgICAgICBmb3IgbXkgJE9iamVjdEF0dHJpYnV0ZSAoIEB7ICRTdGF0LT57JFVzZX0gfSApIHsKICAgICAgICAgICAgICAgIG5leHQgT0JKRUNUQVRUUklCVVRFIGlmICEkT2JqZWN0QXR0cmlidXRlLT57U2VsZWN0ZWR9OwoKICAgICAgICAgICAgICAgIG15ICRFbGVtZW50TmFtZSA9ICRVc2UgLiAkT2JqZWN0QXR0cmlidXRlLT57RWxlbWVudH07CiAgICAgICAgICAgICAgICBteSAlVmFsdWVIYXNoOwogICAgICAgICAgICAgICAgJEZsYWcgPSAxOwoKICAgICAgICAgICAgICAgICMgU2VsZWN0IEFsbCBmdW5jdGlvbgogICAgICAgICAgICAgICAgaWYgKCAhJE9iamVjdEF0dHJpYnV0ZS0+e1NlbGVjdGVkVmFsdWVzfVswXSApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgICAgICRPYmplY3RBdHRyaWJ1dGUtPntWYWx1ZXN9ICYmIHJlZiAkT2JqZWN0QXR0cmlidXRlLT57VmFsdWVzfSBuZSAnSEFTSCcKICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ1ZhbHVlcyBuZWVkcyB0byBiZSBhIGhhc2ggcmVmZXJlbmNlIScKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgbmV4dCBPQkpFQ1RBVFRSSUJVVEU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIG15IEBWYWx1ZXMgPSBrZXlzKCAleyAkT2JqZWN0QXR0cmlidXRlLT57VmFsdWVzfSB9ICk7CiAgICAgICAgICAgICAgICAgICAgJE9iamVjdEF0dHJpYnV0ZS0+e1NlbGVjdGVkVmFsdWVzfSA9IFxAVmFsdWVzOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIFZBTFVFOgogICAgICAgICAgICAgICAgZm9yIG15ICRWYWx1ZSAoIEB7ICRPYmplY3RBdHRyaWJ1dGUtPntTZWxlY3RlZFZhbHVlc30gfSApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoICRPYmplY3RBdHRyaWJ1dGUtPntWYWx1ZXN9ICkgewogICAgICAgICAgICAgICAgICAgICAgICBuZXh0IFZBTFVFIGlmICFkZWZpbmVkICRPYmplY3RBdHRyaWJ1dGUtPntWYWx1ZXN9LT57JFZhbHVlfTsKICAgICAgICAgICAgICAgICAgICAgICAgJFZhbHVlSGFzaHskVmFsdWV9ID0gJE9iamVjdEF0dHJpYnV0ZS0+e1ZhbHVlc30tPnskVmFsdWV9OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFZhbHVlSGFzaHtWYWx1ZX0gPSAkVmFsdWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gJ0VsZW1lbnQnLAogICAgICAgICAgICAgICAgICAgIERhdGEgPT4geyBOYW1lID0+ICRPYmplY3RBdHRyaWJ1dGUtPntOYW1lfSB9LAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAjIHNob3cgZml4ZWQgZWxlbWVudHMKICAgICAgICAgICAgICAgIGlmICggJE9iamVjdEF0dHJpYnV0ZS0+e0ZpeGVkfSApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoICRPYmplY3RBdHRyaWJ1dGUtPntCbG9ja30gZXEgJ1RpbWUnICkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoICRVc2UgZXEgJ1VzZUFzUmVzdHJpY3Rpb24nICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlICRPYmplY3RBdHRyaWJ1dGUtPntTZWxlY3RlZFZhbHVlc307CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgbXkgJFRpbWVTY2FsZSA9ICRTZWxmLT5fVGltZVNjYWxlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggJE9iamVjdEF0dHJpYnV0ZS0+e1RpbWVTdGFydH0gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICdUaW1lUGVyaW9kRml4ZWQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaW1lU3RhcnQgPT4gJE9iamVjdEF0dHJpYnV0ZS0+e1RpbWVTdGFydH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRpbWVTdG9wICA9PiAkT2JqZWN0QXR0cmlidXRlLT57VGltZVN0b3B9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2lmICggJE9iamVjdEF0dHJpYnV0ZS0+e1RpbWVSZWxhdGl2ZVVuaXR9ICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAnVGltZVJlbGF0aXZlRml4ZWQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaW1lUmVsYXRpdmVVbml0ICA9PiAkVGltZVNjYWxlLT57ICRPYmplY3RBdHRyaWJ1dGUtPntUaW1lUmVsYXRpdmVVbml0fSB9LT57VmFsdWV9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaW1lUmVsYXRpdmVDb3VudCA9PiAkT2JqZWN0QXR0cmlidXRlLT57VGltZVJlbGF0aXZlQ291bnR9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaW1lUmVsYXRpdmVVcGNvbWluZ0NvdW50ID0+ICRPYmplY3RBdHRyaWJ1dGUtPntUaW1lUmVsYXRpdmVVcGNvbWluZ0NvdW50fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoICRPYmplY3RBdHRyaWJ1dGUtPntTZWxlY3RlZFZhbHVlc31bMF0gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICdUaW1lU2NhbGVGaXhlZCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNjYWxlID0+ICRUaW1lU2NhbGUtPnsgJE9iamVjdEF0dHJpYnV0ZS0+e1NlbGVjdGVkVmFsdWVzfVswXSB9LT57VmFsdWV9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDb3VudCA9PiAkT2JqZWN0QXR0cmlidXRlLT57VGltZVNjYWxlQ291bnR9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgewoKICAgICAgICAgICAgICAgICAgICAgICAgIyBmaW5kIG91dCB3aGljaCBzb3J0IG1lY2hhbmlzbSBpcyB1c2VkCiAgICAgICAgICAgICAgICAgICAgICAgIG15IEBTb3J0ZWQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggJE9iamVjdEF0dHJpYnV0ZS0+e1NvcnRJbmRpdmlkdWFsfSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEBTb3J0ZWQgPSBncmVwIHsgJFZhbHVlSGFzaHskX30gfSBAeyAkT2JqZWN0QXR0cmlidXRlLT57U29ydEluZGl2aWR1YWx9IH07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBAU29ydGVkID0gc29ydCB7ICRWYWx1ZUhhc2h7JGF9IGNtcCAkVmFsdWVIYXNoeyRifSB9IGtleXMgJVZhbHVlSGFzaDsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgbXkgQEZpeGVkQXR0cmlidXRlczsKCiAgICAgICAgICAgICAgICAgICAgICAgIEVMRU1FTlQ6CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBteSAkRWxlbWVudCAoQFNvcnRlZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbXkgJFZhbHVlID0gJFZhbHVlSGFzaHskRWxlbWVudH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoICRPYmplY3RBdHRyaWJ1dGUtPntUcmFuc2xhdGlvbn0gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFZhbHVlID0gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCAkVmFsdWVIYXNoeyRFbGVtZW50fSApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHQgRUxFTUVOVCBpZiAhZGVmaW5lZCAkVmFsdWU7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVzaCBARml4ZWRBdHRyaWJ1dGVzLCAkVmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAnRml4ZWQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWUgICA9PiBqb2luKCAnLCAnLCBARml4ZWRBdHRyaWJ1dGVzICksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgS2V5ICAgICA9PiAkXywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVc2UgICAgID0+ICRVc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRWxlbWVudCA9PiAkT2JqZWN0QXR0cmlidXRlLT57RWxlbWVudH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIHNob3cgIHVuZml4ZWQgZWxlbWVudHMKICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIG15ICVCbG9ja0RhdGE7CiAgICAgICAgICAgICAgICAgICAgJEJsb2NrRGF0YXtOYW1lfSAgICA9ICRPYmplY3RBdHRyaWJ1dGUtPntOYW1lfTsKICAgICAgICAgICAgICAgICAgICAkQmxvY2tEYXRhe0VsZW1lbnR9ID0gJE9iamVjdEF0dHJpYnV0ZS0+e0VsZW1lbnR9OwogICAgICAgICAgICAgICAgICAgICRCbG9ja0RhdGF7VmFsdWV9ICAgPSAkT2JqZWN0QXR0cmlidXRlLT57U2VsZWN0ZWRWYWx1ZXN9LT5bMF07CgogICAgICAgICAgICAgICAgICAgIG15IEBTZWxlY3RlZElEcyA9ICRMb2NhbEdldEFycmF5LT4oIFBhcmFtID0+ICRFbGVtZW50TmFtZSApOwoKICAgICAgICAgICAgICAgICAgICBpZiAoICRPYmplY3RBdHRyaWJ1dGUtPntCbG9ja30gZXEgJ011bHRpU2VsZWN0RmllbGQnICkgewogICAgICAgICAgICAgICAgICAgICAgICAkQmxvY2tEYXRhe1NlbGVjdEZpZWxkfSA9ICRMYXlvdXRPYmplY3QtPkJ1aWxkU2VsZWN0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgRGF0YSAgICAgICAgICAgPT4gXCVWYWx1ZUhhc2gsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOYW1lICAgICAgICAgICA9PiAkRWxlbWVudE5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNdWx0aXBsZSAgICAgICA9PiAxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2l6ZSAgICAgICAgICAgPT4gNSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlbGVjdGVkSUQgICAgID0+IEBTZWxlY3RlZElEcyA/IFtAU2VsZWN0ZWRJRHNdIDogJE9iamVjdEF0dHJpYnV0ZS0+e1NlbGVjdGVkVmFsdWVzfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRyYW5zbGF0aW9uICAgID0+ICRPYmplY3RBdHRyaWJ1dGUtPntUcmFuc2xhdGlvbn0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUcmVlVmlldyAgICAgICA9PiAkT2JqZWN0QXR0cmlidXRlLT57VHJlZVZpZXd9IHx8IDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTb3J0ICAgICAgICAgICA9PiBzY2FsYXIgJE9iamVjdEF0dHJpYnV0ZS0+e1NvcnR9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgU29ydEluZGl2aWR1YWwgPT4gc2NhbGFyICRPYmplY3RBdHRyaWJ1dGUtPntTb3J0SW5kaXZpZHVhbH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDbGFzcyAgICAgICAgICA9PiAnTW9kZXJuaXplJywKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBOYW1lID0+ICdNdWx0aVNlbGVjdEZpZWxkJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIERhdGEgPT4gXCVCbG9ja0RhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2lmICggJE9iamVjdEF0dHJpYnV0ZS0+e0Jsb2NrfSBlcSAnU2VsZWN0RmllbGQnICkgewoKICAgICAgICAgICAgICAgICAgICAgICAgJEJsb2NrRGF0YXtTZWxlY3RGaWVsZH0gPSAkTGF5b3V0T2JqZWN0LT5CdWlsZFNlbGVjdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgICAgIERhdGEgICAgICAgICAgID0+IFwlVmFsdWVIYXNoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSAgICAgICAgICAgPT4gJEVsZW1lbnROYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgVHJhbnNsYXRpb24gICAgPT4gJE9iamVjdEF0dHJpYnV0ZS0+e1RyYW5zbGF0aW9ufSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRyZWVWaWV3ICAgICAgID0+ICRPYmplY3RBdHRyaWJ1dGUtPntUcmVlVmlld30gfHwgMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNvcnQgICAgICAgICAgID0+IHNjYWxhciAkT2JqZWN0QXR0cmlidXRlLT57U29ydH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTb3J0SW5kaXZpZHVhbCA9PiBzY2FsYXIgJE9iamVjdEF0dHJpYnV0ZS0+e1NvcnRJbmRpdmlkdWFsfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlbGVjdGVkSUQgICAgID0+ICRMb2NhbEdldFBhcmFtLT4oIFBhcmFtID0+ICRFbGVtZW50TmFtZSApLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2xhc3MgICAgICAgICAgPT4gJ01vZGVybml6ZScsCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAnU2VsZWN0RmllbGQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgRGF0YSA9PiBcJUJsb2NrRGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGVsc2lmICggJE9iamVjdEF0dHJpYnV0ZS0+e0Jsb2NrfSBlcSAnSW5wdXRGaWVsZCcgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTmFtZSA9PiAnSW5wdXRGaWVsZCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBLZXkgICA9PiAkRWxlbWVudE5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWUgPT4gJExvY2FsR2V0UGFyYW0tPiggUGFyYW0gPT4gJEVsZW1lbnROYW1lICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gJE9iamVjdEF0dHJpYnV0ZS0+e1NlbGVjdGVkVmFsdWVzfVswXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDU1NDbGFzcyAgICAgICAgICAgPT4gJE9iamVjdEF0dHJpYnV0ZS0+e0NTU0NsYXNzfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBIVE1MRGF0YUF0dHJpYnV0ZXMgPT4gJE9iamVjdEF0dHJpYnV0ZS0+e0hUTUxEYXRhQXR0cmlidXRlc30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNpZiAoICRPYmplY3RBdHRyaWJ1dGUtPntCbG9ja30gZXEgJ1RpbWUnICkgewogICAgICAgICAgICAgICAgICAgICAgICAkT2JqZWN0QXR0cmlidXRlLT57RWxlbWVudH0gPSAkVXNlIC4gJE9iamVjdEF0dHJpYnV0ZS0+e0VsZW1lbnR9OwoKICAgICAgICAgICAgICAgICAgICAgICAgbXkgJVRpbWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggJE9iamVjdEF0dHJpYnV0ZS0+e1RpbWVTdGFydH0gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoICRMb2NhbEdldFBhcmFtLT4oIFBhcmFtID0+ICRFbGVtZW50TmFtZSAuICdTdGFydFllYXInICkgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIG15ICRMaW1pdCAocXcoU3RhcnQgU3RvcCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIG15ICRVbml0IChxdyhZZWFyIE1vbnRoIERheSBIb3VyIE1pbnV0ZSBTZWNvbmQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGRlZmluZWQoICRMb2NhbEdldFBhcmFtLT4oIFBhcmFtID0+ICIkRWxlbWVudE5hbWUkTGltaXQkVW5pdCIgKSApICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRUaW1leyAkTGltaXQgLiAkVW5pdCB9ID0gJExvY2FsR2V0UGFyYW0tPigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFyYW0gPT4gJEVsZW1lbnROYW1lIC4gIiRMaW1pdCRVbml0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggIWRlZmluZWQoICRUaW1leyAkTGltaXQgLiAnSG91cicgfSApICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAkTGltaXQgZXEgJ1N0YXJ0JyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVGltZXtTdGFydEhvdXJ9ICAgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRUaW1le1N0YXJ0TWludXRlfSA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFRpbWV7U3RhcnRTZWNvbmR9ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2lmICggJExpbWl0IGVxICdTdG9wJyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVGltZXtTdG9wSG91cn0gICA9IDIzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRUaW1le1N0b3BNaW51dGV9ID0gNTk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFRpbWV7U3RvcFNlY29uZH0gPSA1OTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNpZiAoICFkZWZpbmVkKCAkVGltZXsgJExpbWl0IC4gJ1NlY29uZCcgfSApICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAkTGltaXQgZXEgJ1N0YXJ0JyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVGltZXtTdGFydFNlY29uZH0gPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzaWYgKCAkTGltaXQgZXEgJ1N0b3AnICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRUaW1le1N0b3BTZWNvbmR9ID0gNTk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFRpbWV7IlRpbWUkTGltaXQifSA9IHNwcmludGYoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiJTA0ZC0lMDJkLSUwMmQgJTAyZDolMDJkOiUwMmQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFRpbWV7ICRMaW1pdCAuICdZZWFyJyB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFRpbWV7ICRMaW1pdCAuICdNb250aCcgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRUaW1leyAkTGltaXQgLiAnRGF5JyB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFRpbWV7ICRMaW1pdCAuICdIb3VyJyB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFRpbWV7ICRMaW1pdCAuICdNaW51dGUnIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVGltZXsgJExpbWl0IC4gJ1NlY29uZCcgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzaWYgKCAkT2JqZWN0QXR0cmlidXRlLT57VGltZVJlbGF0aXZlVW5pdH0gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVGltZXtUaW1lUmVsYXRpdmVDb3VudH0gPSAkTG9jYWxHZXRQYXJhbS0+KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhcmFtID0+ICRPYmplY3RBdHRyaWJ1dGUtPntFbGVtZW50fSAuICdUaW1lUmVsYXRpdmVDb3VudCcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApIC8vICRPYmplY3RBdHRyaWJ1dGUtPntUaW1lUmVsYXRpdmVDb3VudH07CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFRpbWV7VGltZVJlbGF0aXZlVXBjb21pbmdDb3VudH0gPSAkTG9jYWxHZXRQYXJhbS0+KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhcmFtID0+ICRPYmplY3RBdHRyaWJ1dGUtPntFbGVtZW50fSAuICdUaW1lUmVsYXRpdmVVcGNvbWluZ0NvdW50JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICkgLy8gJE9iamVjdEF0dHJpYnV0ZS0+e1RpbWVSZWxhdGl2ZVVwY29taW5nQ291bnR9OwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRUaW1le1RpbWVTY2FsZUNvdW50fSA9ICRMb2NhbEdldFBhcmFtLT4oCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFyYW0gPT4gJE9iamVjdEF0dHJpYnV0ZS0+e0VsZW1lbnR9IC4gJ1RpbWVTY2FsZUNvdW50JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICkgfHwgJE9iamVjdEF0dHJpYnV0ZS0+e1RpbWVTY2FsZUNvdW50fTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVGltZXtUaW1lUmVsYXRpdmVVbml0TG9jYWxTZWxlY3RlZFZhbHVlfSA9ICRMb2NhbEdldFBhcmFtLT4oCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFyYW0gPT4gJE9iamVjdEF0dHJpYnV0ZS0+e0VsZW1lbnR9IC4gJ1RpbWVSZWxhdGl2ZVVuaXQnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoICRVc2UgbmUgJ1VzZUFzUmVzdHJpY3Rpb24nICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFRpbWV7VGltZVNjYWxlVW5pdExvY2FsU2VsZWN0ZWRWYWx1ZX0gPSAkTG9jYWxHZXRQYXJhbS0+KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhcmFtID0+ICRPYmplY3RBdHRyaWJ1dGUtPntFbGVtZW50fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBnZXQgdGhlIHNlbGVjdGVkIHggYXhpcyB0aW1lIHNjYWxlIHZhbHVlIGZvciB2YWx1ZSBzZXJpZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggJFVzZSBlcSAnVXNlQXNWYWx1ZVNlcmllcycgKSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgZ2V0IHRoZSBuYW1lIGZvciB0aGUgeCBheGlzIGVsZW1lbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteSAkWEF4aXNFbGVtZW50TmFtZSA9ICRPYmplY3RBdHRyaWJ1dGUtPntFbGVtZW50fTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkWEF4aXNFbGVtZW50TmFtZSA9fiBzeyBcQSBVc2VBc1ZhbHVlU2VyaWVzIH17VXNlQXNYdmFsdWV9eG1zOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGdldCB0aGUgY3VycmVudCB4IGF4aXMgdmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteSAkWEF4aXNMb2NhbFNlbGVjdGVkVmFsdWUgPSAkTG9jYWxHZXRQYXJhbS0+KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYXJhbSA9PiAkWEF4aXNFbGVtZW50TmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRUaW1le1NlbGVjdGVkWEF4aXNWYWx1ZX0gPSAkWEF4aXNMb2NhbFNlbGVjdGVkVmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfHwgJFNlbGYtPl9HZXRTZWxlY3RlZFhBeGlzVGltZVNjYWxlVmFsdWUoIFN0YXQgPT4gJFN0YXQgKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBzYXZlIHRoZSB4IGF4aXMgdGltZSBzY2FsZSBlbGVtZW50IGlkIGZvciB0aGUgb3V0cHV0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEJsb2NrRGF0YXtYQXhpc1RpbWVTY2FsZUVsZW1lbnRJRH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPSAkWEF4aXNFbGVtZW50TmFtZSAuICctJyAuICRTdGF0SUQgLiAnLScgLiAkUGFyYW17T3V0cHV0Q291bnRlcn07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIG15ICVUaW1lRGF0YSA9ICRTZWxmLT5fVGltZU91dHB1dCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN0YXRJRCAgICAgICAgPT4gJFN0YXRJRCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE91dHB1dENvdW50ZXIgPT4gJFBhcmFte091dHB1dENvdW50ZXJ9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgT3V0cHV0ICAgICAgICA9PiAnVmlldycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBVc2UgICAgICAgICAgID0+ICRVc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAleyRPYmplY3RBdHRyaWJ1dGV9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJVRpbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICVCbG9ja0RhdGEgPSAoICVCbG9ja0RhdGEsICVUaW1lRGF0YSApOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAkT2JqZWN0QXR0cmlidXRlLT57VGltZVN0YXJ0fSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gJ1RpbWVQZXJpb2QnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERhdGEgPT4gXCVCbG9ja0RhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBlbHNpZiAoICRPYmplY3RBdHRyaWJ1dGUtPntUaW1lUmVsYXRpdmVVbml0fSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gJ1RpbWVQZXJpb2RSZWxhdGl2ZScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGF0YSA9PiBcJUJsb2NrRGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICMgYnVpbGQgdGhlIFRpbWVzY2FsZSBvdXRwdXQKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAkVXNlIG5lICdVc2VBc1Jlc3RyaWN0aW9uJyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gJ1RpbWVTY2FsZScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICVCbG9ja0RhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBzZW5kIGRhdGEgdG8gSlMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkFkZEpTRGF0YSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBLZXkgICA9PiAnU3RhdHNQYXJhbURhdGEnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZhbHVlID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJUJsb2NrRGF0YQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAjIGVuZCBvZiBidWlsZCB0aW1lc2NhbGUgb3V0cHV0CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIFNob3cgdGhpcyBCbG9jayBpZiBubyB2YWx1ZSBzZXJpZXMgb3IgcmVzdHJpY3Rpb25zIGFyZSBzZWxlY3RlZAogICAgICAgICAgICBpZiAoICEkRmxhZyApIHsKICAgICAgICAgICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICAgICAgICAgIE5hbWUgPT4gJ05vRWxlbWVudCcsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgbXkgJVllc05vID0gKAogICAgICAgIDAgPT4gVHJhbnNsYXRhYmxlKCdObycpLAogICAgICAgIDEgPT4gVHJhbnNsYXRhYmxlKCdZZXMnKQogICAgKTsKICAgIG15ICVWYWxpZEludmFsaWQgPSAoCiAgICAgICAgMCA9PiBUcmFuc2xhdGFibGUoJ2ludmFsaWQnKSwKICAgICAgICAxID0+IFRyYW5zbGF0YWJsZSgndmFsaWQnKQogICAgKTsKICAgICRTdGF0LT57U3VtUm93VmFsdWV9ICAgICAgICAgICAgICAgID0gJFllc05veyAkU3RhdC0+e1N1bVJvd30gfTsKICAgICRTdGF0LT57U3VtQ29sVmFsdWV9ICAgICAgICAgICAgICAgID0gJFllc05veyAkU3RhdC0+e1N1bUNvbH0gfTsKICAgICRTdGF0LT57Q2FjaGVWYWx1ZX0gICAgICAgICAgICAgICAgID0gJFllc05veyAkU3RhdC0+e0NhY2hlfSB9OwogICAgJFN0YXQtPntTaG93QXNEYXNoYm9hcmRXaWRnZXRWYWx1ZX0gPSAkWWVzTm97ICRTdGF0LT57U2hvd0FzRGFzaGJvYXJkV2lkZ2V0fSAvLyAwIH07CiAgICAkU3RhdC0+e1ZhbGlkVmFsdWV9ICAgICAgICAgICAgICAgICA9ICRWYWxpZEludmFsaWR7ICRTdGF0LT57VmFsaWR9IH07CgogICAgZm9yIG15ICRGaWVsZCAocXcoQ3JlYXRlZEJ5IENoYW5nZWRCeSkpIHsKICAgICAgICAkU3RhdC0+eyRGaWVsZH0gPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VXNlcicpLT5Vc2VyTmFtZSggVXNlcklEID0+ICRTdGF0LT57JEZpZWxkfSApOwogICAgfQoKICAgIGlmICggJFBhcmFte0FKQVh9ICkgewoKICAgICAgICAjIHNlbmQgZGF0YSB0byBKUwogICAgICAgICRMYXlvdXRPYmplY3QtPkFkZEpTRGF0YSgKICAgICAgICAgICAgS2V5ICAgPT4gJ1N0YXRzV2lkZ2V0QUpBWCcsCiAgICAgICAgICAgIFZhbHVlID0+ICRQYXJhbXtBSkFYfQogICAgICAgICk7CiAgICB9CgogICAgJE91dHB1dCAuPSAkTGF5b3V0T2JqZWN0LT5PdXRwdXQoCiAgICAgICAgVGVtcGxhdGVGaWxlID0+ICdTdGF0aXN0aWNzL1N0YXRzUGFyYW1zV2lkZ2V0JywKICAgICAgICBEYXRhICAgICAgICAgPT4gewogICAgICAgICAgICAleyRTdGF0fSwKICAgICAgICAgICAgQUpBWCA9PiAkUGFyYW17QUpBWH0sCiAgICAgICAgfSwKICAgICAgICBBSkFYID0+ICRQYXJhbXtBSkFYfSwKICAgICk7CiAgICByZXR1cm4gJE91dHB1dDsKfQoKc3ViIEdlbmVyYWxTcGVjaWZpY2F0aW9uc1dpZGdldCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CiAgICBteSAkUGFyYW1PYmplY3QgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OldlYjo6UmVxdWVzdCcpOwogICAgbXkgJENvbmZpZ09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CgogICAgIyBJbiBjYXNlIG9mIHBhZ2UgcmVsb2FkIGJlY2F1c2Ugb2YgZXJyb3JzCiAgICBteSAlRXJyb3JzICAgPSAleyAkUGFyYW17RXJyb3JzfSAgIC8vIHt9IH07CiAgICBteSAlR2V0UGFyYW0gPSAleyAkUGFyYW17R2V0UGFyYW19IC8vIHt9IH07CgogICAgbXkgJFN0YXQ7CiAgICBpZiAoICRQYXJhbXtTdGF0SUR9ICkgewogICAgICAgICRTdGF0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlN0YXRzJyktPlN0YXRzR2V0KAogICAgICAgICAgICBTdGF0SUQgPT4gJFBhcmFte1N0YXRJRH0sCiAgICAgICAgICAgIFVzZXJJRCA9PiAkUGFyYW17VXNlcklEfSwKICAgICAgICApOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgJFN0YXQtPntTdGF0SUR9ICAgICA9ICcnOwogICAgICAgICRTdGF0LT57U3RhdE51bWJlcn0gPSAnJzsKICAgICAgICAkU3RhdC0+e1ZhbGlkfSAgICAgID0gMTsKICAgIH0KCiAgICAjIENoZWNrIGlmIGEgdGltZSBmaWVsZCBpcyBzZWxlY3RlZCBpbiB0aGUgY3VycmVudCBzdGF0aXN0aWMgY29uZmlndXJhdGlvbiwgYmVjYXVzZQogICAgIyAgIG9ubHkgaW4gdGhpcyBjYXNlIHRoZSBjYWNoaW5nIGNhbiBiZSBhY3RpdmF0ZWQgaW4gdGhlIGdlbmVyYWwgc3RhdGlzdGljIHNldHRpbmdzLgogICAgbXkgJFRpbWVGaWVsZFNlbGVjdGVkOwoKICAgIFVTRToKICAgIGZvciBteSAkVXNlIChxdyhVc2VBc1h2YWx1ZSBVc2VBc1ZhbHVlU2VyaWVzIFVzZUFzUmVzdHJpY3Rpb24pKSB7CgogICAgICAgIGZvciBteSAkT2JqZWN0QXR0cmlidXRlICggQHsgJFN0YXQtPnskVXNlfSB9ICkgewoKICAgICAgICAgICAgaWYgKCAkT2JqZWN0QXR0cmlidXRlLT57U2VsZWN0ZWR9ICYmICRPYmplY3RBdHRyaWJ1dGUtPntCbG9ja30gZXEgJ1RpbWUnICkgewogICAgICAgICAgICAgICAgJFRpbWVGaWVsZFNlbGVjdGVkID0gMTsKICAgICAgICAgICAgICAgIGxhc3QgVVNFOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIG15ICVGcm9udGVuZDsKCiAgICBteSAlWWVzTm8gPSAoCiAgICAgICAgMCA9PiBUcmFuc2xhdGFibGUoJ05vJyksCiAgICAgICAgMSA9PiBUcmFuc2xhdGFibGUoJ1llcycpCiAgICApOwoKICAgICMgQ3JlYXRlIHNlbGVjdGJveGVzIGZvciAnQ2FjaGUnLCAnU3VtUm93JywgJ1N1bUNvbCcsIGFuZCAnVmFsaWQnLgogICAgZm9yIG15ICRLZXkgKHF3KENhY2hlIFNob3dBc0Rhc2hib2FyZFdpZGdldCBTdW1Sb3cgU3VtQ29sKSkgewoKICAgICAgICBteSAlU2VsZWN0aW9uRGF0YSA9ICVZZXNObzsKCiAgICAgICAgaWYgKCAkS2V5IGVxICdDYWNoZScgJiYgISRUaW1lRmllbGRTZWxlY3RlZCApIHsKICAgICAgICAgICAgZGVsZXRlICRTZWxlY3Rpb25EYXRhezF9OwogICAgICAgIH0KCiAgICAgICAgJEZyb250ZW5keyAnU2VsZWN0JyAuICRLZXkgfSA9ICRMYXlvdXRPYmplY3QtPkJ1aWxkU2VsZWN0aW9uKAogICAgICAgICAgICBEYXRhICAgICAgID0+IFwlU2VsZWN0aW9uRGF0YSwKICAgICAgICAgICAgU2VsZWN0ZWRJRCA9PiAkR2V0UGFyYW17JEtleX0gLy8gJFN0YXQtPnskS2V5fSB8fCAwLAogICAgICAgICAgICBOYW1lICAgICAgID0+ICRLZXksCiAgICAgICAgICAgIENsYXNzICAgICAgPT4gJ01vZGVybml6ZScsCiAgICAgICAgKTsKICAgIH0KCiAgICAjIE5ldyBzdGF0aXN0aWNzIGRvbid0IGdldCB0aGlzIHNlbGVjdC4KICAgIGlmICggISRTdGF0LT57T2JqZWN0QmVoYXZpb3Vyc30tPntQcm92aWRlc0Rhc2hib2FyZFdpZGdldH0gKSB7CiAgICAgICAgJEZyb250ZW5keydTZWxlY3RTaG93QXNEYXNoYm9hcmRXaWRnZXQnfSA9ICRMYXlvdXRPYmplY3QtPkJ1aWxkU2VsZWN0aW9uKAogICAgICAgICAgICBEYXRhID0+IHsKICAgICAgICAgICAgICAgIDAgPT4gVHJhbnNsYXRhYmxlKCdObyAobm90IHN1cHBvcnRlZCknKSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgU2VsZWN0ZWRJRCA9PiAwLAogICAgICAgICAgICBOYW1lICAgICAgID0+ICdTaG93QXNEYXNoYm9hcmRXaWRnZXQnLAogICAgICAgICAgICBDbGFzcyAgICAgID0+ICdNb2Rlcm5pemUnLAogICAgICAgICk7CiAgICB9CgogICAgJEZyb250ZW5ke1NlbGVjdFZhbGlkfSA9ICRMYXlvdXRPYmplY3QtPkJ1aWxkU2VsZWN0aW9uKAogICAgICAgIERhdGEgPT4gewogICAgICAgICAgICAwID0+IFRyYW5zbGF0YWJsZSgnaW52YWxpZCcpLAogICAgICAgICAgICAxID0+IFRyYW5zbGF0YWJsZSgndmFsaWQnKSwKICAgICAgICB9LAogICAgICAgIFNlbGVjdGVkSUQgPT4gJEdldFBhcmFte1ZhbGlkfSAvLyAkU3RhdC0+e1ZhbGlkfSwKICAgICAgICBOYW1lICAgICAgID0+ICdWYWxpZCcsCiAgICAgICAgQ2xhc3MgICAgICA9PiAnTW9kZXJuaXplJywKICAgICk7CgogICAgIyBnZXQgdGhlIGRlZmF1bHQgc2VsZWN0ZWQgZm9ybWF0cwogICAgbXkgJERlZmF1bHRTZWxlY3RlZEZvcm1hdCA9ICRDb25maWdPYmplY3QtPkdldCgnU3RhdHM6OkRlZmF1bHRTZWxlY3RlZEZvcm1hdCcpIHx8IFtdOwoKICAgICMgQ3JlYXRlIGEgbmV3IHN0YXRpc3RpYwogICAgaWYgKCAhJFN0YXQtPntTdGF0VHlwZX0gKSB7CiAgICAgICAgbXkgJER5bmFtaWNGaWxlcyA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpTdGF0cycpLT5HZXREeW5hbWljRmlsZXMoKTsKCiAgICAgICAgbXkgJU9iamVjdE1vZHVsZXM7CiAgICAgICAgRFlOQU1JQ19GSUxFOgogICAgICAgIGZvciBteSAkRHluYW1pY0ZpbGUgKCBzb3J0IGtleXMgJXsgJER5bmFtaWNGaWxlcyAvLyB7fSB9ICkgewogICAgICAgICAgICBteSAkT2JqZWN0TmFtZSA9ICdLZXJuZWw6OlN5c3RlbTo6U3RhdHM6OkR5bmFtaWM6OicgLiAkRHluYW1pY0ZpbGU7CgogICAgICAgICAgICBuZXh0IERZTkFNSUNfRklMRSBpZiAhJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06Ok1haW4nKS0+UmVxdWlyZSgkT2JqZWN0TmFtZSk7CiAgICAgICAgICAgIG15ICRPYmplY3QgPSAkT2JqZWN0TmFtZS0+bmV3KCk7CiAgICAgICAgICAgIG5leHQgRFlOQU1JQ19GSUxFIGlmICEkT2JqZWN0OwogICAgICAgICAgICBpZiAoICRPYmplY3QtPmNhbignR2V0U3RhdEVsZW1lbnQnKSApIHsKICAgICAgICAgICAgICAgICRPYmplY3RNb2R1bGVze0R5bmFtaWNNYXRyaXh9LT57JE9iamVjdE5hbWV9ID0gJER5bmFtaWNGaWxlcy0+eyREeW5hbWljRmlsZX07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkT2JqZWN0TW9kdWxlc3tEeW5hbWljTGlzdH0tPnskT2JqZWN0TmFtZX0gPSAkRHluYW1pY0ZpbGVzLT57JER5bmFtaWNGaWxlfTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgbXkgJFN0YXRpY0ZpbGVzID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlN0YXRzJyktPkdldFN0YXRpY0ZpbGVzKAogICAgICAgICAgICBPbmx5VW51c2VkRmlsZXMgPT4gMSwKICAgICAgICAgICAgVXNlcklEICAgICAgICAgID0+ICRQYXJhbXtVc2VySUR9LAogICAgICAgICk7CiAgICAgICAgZm9yIG15ICRTdGF0aWNGaWxlICggc29ydCBrZXlzICV7ICRTdGF0aWNGaWxlcyAvLyB7fSB9ICkgewogICAgICAgICAgICAkT2JqZWN0TW9kdWxlc3tTdGF0aWN9LT57ICdLZXJuZWw6OlN5c3RlbTo6U3RhdHM6OlN0YXRpYzo6JyAuICRTdGF0aWNGaWxlIH0gPSAkU3RhdGljRmlsZXMtPnskU3RhdGljRmlsZX07CiAgICAgICAgfQoKICAgICAgICAkRnJvbnRlbmR7U3RhdGlzdGljUHJlc2VsZWN0aW9ufSA9ICRQYXJhbU9iamVjdC0+R2V0UGFyYW0oIFBhcmFtID0+ICdTdGF0aXN0aWNQcmVzZWxlY3Rpb24nICk7CgogICAgICAgIGlmICggJEZyb250ZW5ke1N0YXRpc3RpY1ByZXNlbGVjdGlvbn0gZXEgJ1N0YXRpYycgKSB7CiAgICAgICAgICAgICRGcm9udGVuZHtTdGF0VHlwZX0gICAgICAgICA9ICdzdGF0aWMnOwogICAgICAgICAgICAkRnJvbnRlbmR7U2VsZWN0T2JqZWN0VHlwZX0gPSAkTGF5b3V0T2JqZWN0LT5CdWlsZFNlbGVjdGlvbigKICAgICAgICAgICAgICAgIERhdGEgID0+ICRPYmplY3RNb2R1bGVze1N0YXRpY30sCiAgICAgICAgICAgICAgICBOYW1lICA9PiAnT2JqZWN0TW9kdWxlJywKICAgICAgICAgICAgICAgIENsYXNzID0+ICdNb2Rlcm5pemUgVmFsaWRhdGVfUmVxdWlyZWQnIC4gKCAkRXJyb3Jze09iamVjdE1vZHVsZVNlcnZlckVycm9yfSA/ICcgU2VydmVyRXJyb3InIDogJycgKSwKICAgICAgICAgICAgICAgIFRyYW5zbGF0aW9uID0+IDAsCiAgICAgICAgICAgICAgICBTZWxlY3RlZElEICA9PiAkR2V0UGFyYW17T2JqZWN0TW9kdWxlfSwKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgZWxzaWYgKCAkRnJvbnRlbmR7U3RhdGlzdGljUHJlc2VsZWN0aW9ufSBlcSAnRHluYW1pY0xpc3QnICkgewoKICAgICAgICAgICAgIyByZW1vdmUgdGhlIGRlZmF1bHQgc2VsZWN0ZWQgZ3JhcGggZm9ybWF0cyBmb3IgdGhlIGR5bmFtaWMgbGlzdHMKICAgICAgICAgICAgQHskRGVmYXVsdFNlbGVjdGVkRm9ybWF0fSA9IGdyZXAgeyAkXyAhfiBte15EM30gfSBAeyREZWZhdWx0U2VsZWN0ZWRGb3JtYXR9OwoKICAgICAgICAgICAgJEZyb250ZW5ke1N0YXRUeXBlfSAgICAgICAgID0gJ2R5bmFtaWMnOwogICAgICAgICAgICAkRnJvbnRlbmR7U2VsZWN0T2JqZWN0VHlwZX0gPSAkTGF5b3V0T2JqZWN0LT5CdWlsZFNlbGVjdGlvbigKICAgICAgICAgICAgICAgIERhdGEgICAgICAgID0+ICRPYmplY3RNb2R1bGVze0R5bmFtaWNMaXN0fSwKICAgICAgICAgICAgICAgIE5hbWUgICAgICAgID0+ICdPYmplY3RNb2R1bGUnLAogICAgICAgICAgICAgICAgVHJhbnNsYXRpb24gPT4gMSwKICAgICAgICAgICAgICAgIENsYXNzICAgICAgID0+ICdNb2Rlcm5pemUgJyAuICggJEVycm9yc3tPYmplY3RNb2R1bGVTZXJ2ZXJFcnJvcn0gPyAnIFNlcnZlckVycm9yJyA6ICcnICksCiAgICAgICAgICAgICAgICBTZWxlY3RlZElEICA9PiAkR2V0UGFyYW17T2JqZWN0TW9kdWxlfSAvLyAkQ29uZmlnT2JqZWN0LT5HZXQoJ1N0YXRzOjpEZWZhdWx0U2VsZWN0ZWREeW5hbWljT2JqZWN0JyksCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICAjIER5bmFtaWNNYXRyaXgKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJEZyb250ZW5ke1N0YXRUeXBlfSAgICAgICAgID0gJ2R5bmFtaWMnOwogICAgICAgICAgICAkRnJvbnRlbmR7U2VsZWN0T2JqZWN0VHlwZX0gPSAkTGF5b3V0T2JqZWN0LT5CdWlsZFNlbGVjdGlvbigKICAgICAgICAgICAgICAgIERhdGEgICAgICAgID0+ICRPYmplY3RNb2R1bGVze0R5bmFtaWNNYXRyaXh9LAogICAgICAgICAgICAgICAgTmFtZSAgICAgICAgPT4gJ09iamVjdE1vZHVsZScsCiAgICAgICAgICAgICAgICBUcmFuc2xhdGlvbiA9PiAxLAogICAgICAgICAgICAgICAgQ2xhc3MgICAgICAgPT4gJ01vZGVybml6ZSAnIC4gKCAkRXJyb3Jze09iamVjdE1vZHVsZVNlcnZlckVycm9yfSA/ICcgU2VydmVyRXJyb3InIDogJycgKSwKICAgICAgICAgICAgICAgIFNlbGVjdGVkSUQgID0+ICRHZXRQYXJhbXtPYmplY3RNb2R1bGV9IC8vICRDb25maWdPYmplY3QtPkdldCgnU3RhdHM6OkRlZmF1bHRTZWxlY3RlZER5bmFtaWNPYmplY3QnKSwKICAgICAgICAgICAgKTsKCiAgICAgICAgfQogICAgfQoKICAgICMgZ2V0IHRoZSBhdmFpYmxlIGZvcm1hdHMKICAgIG15ICRBdmFpbGFibGVGb3JtYXRzID0gJENvbmZpZ09iamVjdC0+R2V0KCdTdGF0czo6Rm9ybWF0Jyk7CgogICAgIyBjcmVhdGUgbXVsdGlzZWxlY3Rib3hlcyAnZm9ybWF0JwogICAgJFN0YXQtPntTZWxlY3RGb3JtYXR9ID0gJExheW91dE9iamVjdC0+QnVpbGRTZWxlY3Rpb24oCiAgICAgICAgRGF0YSAgICAgICA9PiAkQXZhaWxhYmxlRm9ybWF0cywKICAgICAgICBOYW1lICAgICAgID0+ICdGb3JtYXQnLAogICAgICAgIENsYXNzICAgICAgPT4gJ01vZGVybml6ZSBWYWxpZGF0ZV9SZXF1aXJlZCcgLiAoICRFcnJvcnN7Rm9ybWF0U2VydmVyRXJyb3J9ID8gJyBTZXJ2ZXJFcnJvcicgOiAnJyApLAogICAgICAgIE11bHRpcGxlICAgPT4gMSwKICAgICAgICBTaXplICAgICAgID0+IDUsCiAgICAgICAgU2VsZWN0ZWRJRCA9PiAkR2V0UGFyYW17Rm9ybWF0fSAvLyAkU3RhdC0+e0Zvcm1hdH0gfHwgJERlZmF1bHRTZWxlY3RlZEZvcm1hdCwKICAgICk7CgogICAgIyBjcmVhdGUgbXVsdGlzZWxlY3Rib3hlcyAncGVybWlzc2lvbicKICAgIG15ICVQZXJtaXNzaW9uID0gKAogICAgICAgIERhdGEgICAgICAgID0+IHsgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06Okdyb3VwJyktPkdyb3VwTGlzdCggVmFsaWQgPT4gMSApIH0sCiAgICAgICAgTmFtZSAgICAgICAgPT4gJ1Blcm1pc3Npb24nLAogICAgICAgIENsYXNzICAgICAgID0+ICdNb2Rlcm5pemUgVmFsaWRhdGVfUmVxdWlyZWQnIC4gKCAkRXJyb3Jze1Blcm1pc3Npb25TZXJ2ZXJFcnJvcn0gPyAnIFNlcnZlckVycm9yJyA6ICcnICksCiAgICAgICAgTXVsdGlwbGUgICAgPT4gMSwKICAgICAgICBTaXplICAgICAgICA9PiA1LAogICAgICAgIFRyYW5zbGF0aW9uID0+IDAsCiAgICApOwogICAgaWYgKCAkR2V0UGFyYW17UGVybWlzc2lvbn0gLy8gJFN0YXQtPntQZXJtaXNzaW9ufSApIHsKICAgICAgICAkUGVybWlzc2lvbntTZWxlY3RlZElEfSA9ICRHZXRQYXJhbXtQZXJtaXNzaW9ufSAvLyAkU3RhdC0+e1Blcm1pc3Npb259OwogICAgfQogICAgZWxzZSB7CiAgICAgICAgJFBlcm1pc3Npb257U2VsZWN0ZWRWYWx1ZX0gPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ1N0YXRzOjpEZWZhdWx0U2VsZWN0ZWRQZXJtaXNzaW9ucycpOwogICAgfQogICAgJFN0YXQtPntTZWxlY3RQZXJtaXNzaW9ufSA9ICRMYXlvdXRPYmplY3QtPkJ1aWxkU2VsZWN0aW9uKCVQZXJtaXNzaW9uKTsKCiAgICAjIHByb3ZpZGUgdGhlIHRpbWV6b25lIGZpZWxkIG9ubHkgZm9yIGR5bmFtaWMgc3RhdGlzdGljcwogICAgaWYgKAogICAgICAgICggJFN0YXQtPntTdGF0VHlwZX0gJiYgJFN0YXQtPntTdGF0VHlwZX0gZXEgJ2R5bmFtaWMnICkKICAgICAgICB8fCAoICRGcm9udGVuZHtTdGF0VHlwZX0gJiYgJEZyb250ZW5ke1N0YXRUeXBlfSBlcSAnZHluYW1pYycgKQogICAgICAgICkKICAgIHsKCiAgICAgICAgbXkgJFNlbGVjdGVkVGltZVpvbmUgPSAkU2VsZi0+X0dldFZhbGlkVGltZVpvbmUoIFRpbWVab25lID0+ICRHZXRQYXJhbXtUaW1lWm9uZX0gKSAvLyAkU3RhdC0+e1RpbWVab25lfTsKICAgICAgICBpZiAoICFkZWZpbmVkICRTZWxlY3RlZFRpbWVab25lICkgewogICAgICAgICAgICBteSAlVXNlclByZWZlcmVuY2VzID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlVzZXInKS0+R2V0UHJlZmVyZW5jZXMoCiAgICAgICAgICAgICAgICBVc2VySUQgPT4gJFBhcmFte1VzZXJJRH0KICAgICAgICAgICAgKTsKICAgICAgICAgICAgJFNlbGVjdGVkVGltZVpvbmUgPSAkU2VsZi0+X0dldFZhbGlkVGltZVpvbmUoIFRpbWVab25lID0+ICRVc2VyUHJlZmVyZW5jZXN7VXNlclRpbWVab25lfSApCiAgICAgICAgICAgICAgICAvLyBLZXJuZWw6OlN5c3RlbTo6RGF0ZVRpbWUtPk9UUlNUaW1lWm9uZUdldCgpOwogICAgICAgIH0KCiAgICAgICAgbXkgJVRpbWVab25lQnVpbGRTZWxlY3Rpb24gPSAkU2VsZi0+X1RpbWVab25lQnVpbGRTZWxlY3Rpb24oCiAgICAgICAgICAgIEluY2x1ZGVUaW1lWm9uZSA9PiAkU2VsZWN0ZWRUaW1lWm9uZSwKICAgICAgICApOwoKICAgICAgICAkU3RhdC0+e1NlbGVjdFRpbWVab25lfSA9ICRMYXlvdXRPYmplY3QtPkJ1aWxkU2VsZWN0aW9uKAogICAgICAgICAgICAlVGltZVpvbmVCdWlsZFNlbGVjdGlvbiwKICAgICAgICAgICAgTmFtZSAgICAgICA9PiAnVGltZVpvbmUnLAogICAgICAgICAgICBDbGFzcyAgICAgID0+ICdNb2Rlcm5pemUgJyAuICggJEVycm9yc3tUaW1lWm9uZVNlcnZlckVycm9yfSA/ICcgU2VydmVyRXJyb3InIDogJycgKSwKICAgICAgICAgICAgU2VsZWN0ZWRJRCA9PiAkU2VsZWN0ZWRUaW1lWm9uZSwKICAgICAgICApOwogICAgfQoKICAgIG15ICRPdXRwdXQgPSAkTGF5b3V0T2JqZWN0LT5PdXRwdXQoCiAgICAgICAgVGVtcGxhdGVGaWxlID0+ICdTdGF0aXN0aWNzL0dlbmVyYWxTcGVjaWZpY2F0aW9uc1dpZGdldCcsCiAgICAgICAgRGF0YSAgICAgICAgID0+IHsKICAgICAgICAgICAgJUZyb250ZW5kLAogICAgICAgICAgICAleyRTdGF0fSwKICAgICAgICAgICAgJUdldFBhcmFtLAogICAgICAgICAgICAlRXJyb3JzLAogICAgICAgIH0sCiAgICApOwogICAgcmV0dXJuICRPdXRwdXQ7Cn0KCnN1YiBYQXhpc1dpZGdldCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRTdGF0ID0gJFBhcmFte1N0YXR9OwoKICAgICMgZ2V0IG5lZWRlZCBvYmplY3RzCiAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwogICAgbXkgJENvbmZpZ09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CgogICAgIyBpZiBvbmx5IG9uZSB2YWx1ZSBpcyBhdmFpbGFibGUgc2VsZWN0IHRoaXMgdmFsdWUKICAgIGlmICggISRTdGF0LT57VXNlQXNYdmFsdWV9WzBde1NlbGVjdGVkfSAmJiBzY2FsYXIoIEB7ICRTdGF0LT57VXNlQXNYdmFsdWV9IH0gKSA9PSAxICkgewogICAgICAgICRTdGF0LT57VXNlQXNYdmFsdWV9WzBde1NlbGVjdGVkfSA9IDE7CiAgICAgICAgJFN0YXQtPntVc2VBc1h2YWx1ZX1bMF17Rml4ZWR9ICAgID0gMTsKICAgIH0KCiAgICBteSBAWEF4aXNFbGVtZW50czsKCiAgICBmb3IgbXkgJE9iamVjdEF0dHJpYnV0ZSAoIEB7ICRTdGF0LT57VXNlQXNYdmFsdWV9IH0gKSB7CiAgICAgICAgbXkgJUJsb2NrRGF0YTsKICAgICAgICAkQmxvY2tEYXRhe0ZpeGVkfSAgID0gJ2NoZWNrZWQ9ImNoZWNrZWQiJzsKICAgICAgICAkQmxvY2tEYXRhe0NoZWNrZWR9ID0gJyc7CiAgICAgICAgJEJsb2NrRGF0YXtCbG9ja30gICA9ICRPYmplY3RBdHRyaWJ1dGUtPntCbG9ja307CgogICAgICAgICMgdGhpbmdzIHdoaWNoIHNob3VsZCBiZSBkb25lIGlmIHRoaXMgYXR0cmlidXRlIGlzIHNlbGVjdGVkCiAgICAgICAgaWYgKCAkT2JqZWN0QXR0cmlidXRlLT57U2VsZWN0ZWR9ICkgewogICAgICAgICAgICAkQmxvY2tEYXRhe0NoZWNrZWR9ID0gJ2NoZWNrZWQ9ImNoZWNrZWQiJzsKICAgICAgICAgICAgaWYgKCAhJE9iamVjdEF0dHJpYnV0ZS0+e0ZpeGVkfSApIHsKICAgICAgICAgICAgICAgICRCbG9ja0RhdGF7Rml4ZWR9ID0gJyc7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICggJE9iamVjdEF0dHJpYnV0ZS0+e0Jsb2NrfSBlcSAnU2VsZWN0RmllbGQnIHx8ICRPYmplY3RBdHRyaWJ1dGUtPntCbG9ja30gZXEgJ011bHRpU2VsZWN0RmllbGQnICkgewogICAgICAgICAgICBteSAkREZUcmVlQ2xhc3MgPSAoICRPYmplY3RBdHRyaWJ1dGUtPntTaG93QXNUcmVlfSAmJiAkT2JqZWN0QXR0cmlidXRlLT57SXNEeW5hbWljRmllbGR9ICkKICAgICAgICAgICAgICAgID8gJ0R5bmFtaWNGaWVsZFdpdGhUcmVlVmlldycgOiAnJzsKICAgICAgICAgICAgJEJsb2NrRGF0YXtTZWxlY3RGaWVsZH0gPSAkTGF5b3V0T2JqZWN0LT5CdWlsZFNlbGVjdGlvbigKICAgICAgICAgICAgICAgIERhdGEgICAgICAgICAgID0+ICRPYmplY3RBdHRyaWJ1dGUtPntWYWx1ZXN9LAogICAgICAgICAgICAgICAgTmFtZSAgICAgICAgICAgPT4gJ1hBeGlzJyAuICRPYmplY3RBdHRyaWJ1dGUtPntFbGVtZW50fSwKICAgICAgICAgICAgICAgIE11bHRpcGxlICAgICAgID0+IDEsCiAgICAgICAgICAgICAgICBTaXplICAgICAgICAgICA9PiA1LAogICAgICAgICAgICAgICAgQ2xhc3MgICAgICAgICAgPT4gIk1vZGVybml6ZSAkREZUcmVlQ2xhc3MiLAogICAgICAgICAgICAgICAgU2VsZWN0ZWRJRCAgICAgPT4gJE9iamVjdEF0dHJpYnV0ZS0+e1NlbGVjdGVkVmFsdWVzfSwKICAgICAgICAgICAgICAgIFRyYW5zbGF0aW9uICAgID0+ICRPYmplY3RBdHRyaWJ1dGUtPntUcmFuc2xhdGlvbn0sCiAgICAgICAgICAgICAgICBUcmVlVmlldyAgICAgICA9PiAkT2JqZWN0QXR0cmlidXRlLT57VHJlZVZpZXd9IHx8IDAsCiAgICAgICAgICAgICAgICBTb3J0ICAgICAgICAgICA9PiBzY2FsYXIgJE9iamVjdEF0dHJpYnV0ZS0+e1NvcnR9LAogICAgICAgICAgICAgICAgU29ydEluZGl2aWR1YWwgPT4gc2NhbGFyICRPYmplY3RBdHRyaWJ1dGUtPntTb3J0SW5kaXZpZHVhbH0sCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBpZiAoICRPYmplY3RBdHRyaWJ1dGUtPntTaG93QXNUcmVlfSAmJiAkT2JqZWN0QXR0cmlidXRlLT57SXNEeW5hbWljRmllbGR9ICkgewogICAgICAgICAgICAgICAgbXkgJFRyZWVTZWxlY3Rpb25NZXNzYWdlID0gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCJTaG93IFRyZWUgU2VsZWN0aW9uIik7CiAgICAgICAgICAgICAgICAkQmxvY2tEYXRhe1NlbGVjdEZpZWxkfQogICAgICAgICAgICAgICAgICAgIC49ICcgPGEgaHJlZj0iIyIgdGl0bGU9IicKICAgICAgICAgICAgICAgICAgICAuICRUcmVlU2VsZWN0aW9uTWVzc2FnZQogICAgICAgICAgICAgICAgICAgIC4gJyIgY2xhc3M9IlNob3dUcmVlU2VsZWN0aW9uIj48c3Bhbj4nCiAgICAgICAgICAgICAgICAgICAgLiAkVHJlZVNlbGVjdGlvbk1lc3NhZ2UgLiAnPC9zcGFuPjxpIGNsYXNzPSJmYSBmYS1zaXRlbWFwIj48L2k+PC9hPic7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICRCbG9ja0RhdGF7TmFtZX0gICAgPSAkT2JqZWN0QXR0cmlidXRlLT57TmFtZX07CiAgICAgICAgJEJsb2NrRGF0YXtFbGVtZW50fSA9ICdYQXhpcycgLiAkT2JqZWN0QXR0cmlidXRlLT57RWxlbWVudH07CgogICAgICAgICMgc2hvdyB0aGUgYXR0cmlidXRlIGJsb2NrCiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ0F0dHJpYnV0ZScsCiAgICAgICAgICAgIERhdGEgPT4gXCVCbG9ja0RhdGEsCiAgICAgICAgKTsKCiAgICAgICAgaWYgKCAkT2JqZWN0QXR0cmlidXRlLT57QmxvY2t9IGVxICdUaW1lJyApIHsKCiAgICAgICAgICAgIG15ICVUaW1lRGF0YSA9ICRTZWxmLT5fVGltZU91dHB1dCgKICAgICAgICAgICAgICAgIE91dHB1dCA9PiAnRWRpdCcsCiAgICAgICAgICAgICAgICBVc2UgICAgPT4gJ1VzZUFzWHZhbHVlJywKICAgICAgICAgICAgICAgICV7JE9iamVjdEF0dHJpYnV0ZX0sCiAgICAgICAgICAgICAgICBFbGVtZW50ID0+ICRCbG9ja0RhdGF7RWxlbWVudH0sCiAgICAgICAgICAgICk7CiAgICAgICAgICAgICVCbG9ja0RhdGEgPSAoICVCbG9ja0RhdGEsICVUaW1lRGF0YSApOwogICAgICAgIH0KCiAgICAgICAgbXkgJEJsb2NrID0gJE9iamVjdEF0dHJpYnV0ZS0+e0Jsb2NrfTsKCiAgICAgICAgaWYgKCAkQmxvY2sgZXEgJ1NlbGVjdEZpZWxkJyApIHsKICAgICAgICAgICAgJEJsb2NrID0gJ011bHRpU2VsZWN0RmllbGQnOwogICAgICAgIH0KCiAgICAgICAgIyBzdG9yZSBkYXRhLCB3aGljaCB3aWxsIGJlIHNlbnQgdG8gSlMKICAgICAgICBwdXNoIEBYQXhpc0VsZW1lbnRzLCAkQmxvY2tEYXRhe0VsZW1lbnR9IGlmICRCbG9ja0RhdGF7Q2hlY2tlZH07CgogICAgICAgICMgc2hvdyB0aGUgaW5wdXQgZWxlbWVudAogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICRCbG9jaywKICAgICAgICAgICAgRGF0YSA9PiBcJUJsb2NrRGF0YSwKICAgICAgICApOwogICAgfQoKICAgICMgc2VuZCBkYXRhIHRvIEpTCiAgICAkTGF5b3V0T2JqZWN0LT5BZGRKU0RhdGEoCiAgICAgICAgS2V5ICAgPT4gJ1hBeGlzRWxlbWVudHMnLAogICAgICAgIFZhbHVlID0+IFxAWEF4aXNFbGVtZW50cywKICAgICk7CgogICAgbXkgJE91dHB1dCA9ICRMYXlvdXRPYmplY3QtPk91dHB1dCgKICAgICAgICBUZW1wbGF0ZUZpbGUgPT4gJ1N0YXRpc3RpY3MvWEF4aXNXaWRnZXQnLAogICAgICAgIERhdGEgICAgICAgICA9PiB7CiAgICAgICAgICAgICV7JFN0YXR9LAogICAgICAgIH0sCiAgICApOwogICAgcmV0dXJuICRPdXRwdXQ7Cn0KCnN1YiBZQXhpc1dpZGdldCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRTdGF0ID0gJFBhcmFte1N0YXR9OwoKICAgICMgZ2V0IG5lZWRlZCBvYmplY3RzCiAgICBteSAkTGF5b3V0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpPdXRwdXQ6OkhUTUw6OkxheW91dCcpOwogICAgbXkgJENvbmZpZ09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CgogICAgbXkgQFlBeGlzRWxlbWVudHM7CgogICAgT0JKRUNUQVRUUklCVVRFOgogICAgZm9yIG15ICRPYmplY3RBdHRyaWJ1dGUgKCBAeyAkU3RhdC0+e1VzZUFzVmFsdWVTZXJpZXN9IH0gKSB7CiAgICAgICAgbXkgJUJsb2NrRGF0YTsKICAgICAgICAkQmxvY2tEYXRhe0ZpeGVkfSAgID0gJ2NoZWNrZWQ9ImNoZWNrZWQiJzsKICAgICAgICAkQmxvY2tEYXRhe0NoZWNrZWR9ID0gJyc7CiAgICAgICAgJEJsb2NrRGF0YXtCbG9ja30gICA9ICRPYmplY3RBdHRyaWJ1dGUtPntCbG9ja307CgogICAgICAgIGlmICggJE9iamVjdEF0dHJpYnV0ZS0+e1NlbGVjdGVkfSApIHsKICAgICAgICAgICAgJEJsb2NrRGF0YXtDaGVja2VkfSA9ICdjaGVja2VkPSJjaGVja2VkIic7CiAgICAgICAgICAgIGlmICggISRPYmplY3RBdHRyaWJ1dGUtPntGaXhlZH0gKSB7CiAgICAgICAgICAgICAgICAkQmxvY2tEYXRhe0ZpeGVkfSA9ICcnOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoICRPYmplY3RBdHRyaWJ1dGUtPntCbG9ja30gZXEgJ1NlbGVjdEZpZWxkJyB8fCAkT2JqZWN0QXR0cmlidXRlLT57QmxvY2t9IGVxICdNdWx0aVNlbGVjdEZpZWxkJyApIHsKICAgICAgICAgICAgbXkgJERGVHJlZUNsYXNzID0gKCAkT2JqZWN0QXR0cmlidXRlLT57U2hvd0FzVHJlZX0gJiYgJE9iamVjdEF0dHJpYnV0ZS0+e0lzRHluYW1pY0ZpZWxkfSApCiAgICAgICAgICAgICAgICA/ICdEeW5hbWljRmllbGRXaXRoVHJlZVZpZXcnIDogJyc7CiAgICAgICAgICAgICRCbG9ja0RhdGF7U2VsZWN0RmllbGR9ID0gJExheW91dE9iamVjdC0+QnVpbGRTZWxlY3Rpb24oCiAgICAgICAgICAgICAgICBEYXRhICAgICAgICAgICA9PiAkT2JqZWN0QXR0cmlidXRlLT57VmFsdWVzfSwKICAgICAgICAgICAgICAgIE5hbWUgICAgICAgICAgID0+ICdZQXhpcycgLiAkT2JqZWN0QXR0cmlidXRlLT57RWxlbWVudH0sCiAgICAgICAgICAgICAgICBNdWx0aXBsZSAgICAgICA9PiAxLAogICAgICAgICAgICAgICAgU2l6ZSAgICAgICAgICAgPT4gNSwKICAgICAgICAgICAgICAgIENsYXNzICAgICAgICAgID0+ICJNb2Rlcm5pemUgJERGVHJlZUNsYXNzIiwKICAgICAgICAgICAgICAgIFNlbGVjdGVkSUQgICAgID0+ICRPYmplY3RBdHRyaWJ1dGUtPntTZWxlY3RlZFZhbHVlc30sCiAgICAgICAgICAgICAgICBUcmFuc2xhdGlvbiAgICA9PiAkT2JqZWN0QXR0cmlidXRlLT57VHJhbnNsYXRpb259LAogICAgICAgICAgICAgICAgVHJlZVZpZXcgICAgICAgPT4gJE9iamVjdEF0dHJpYnV0ZS0+e1RyZWVWaWV3fSB8fCAwLAogICAgICAgICAgICAgICAgU29ydCAgICAgICAgICAgPT4gc2NhbGFyICRPYmplY3RBdHRyaWJ1dGUtPntTb3J0fSwKICAgICAgICAgICAgICAgIFNvcnRJbmRpdmlkdWFsID0+IHNjYWxhciAkT2JqZWN0QXR0cmlidXRlLT57U29ydEluZGl2aWR1YWx9LAogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKCAkT2JqZWN0QXR0cmlidXRlLT57U2hvd0FzVHJlZX0gJiYgJE9iamVjdEF0dHJpYnV0ZS0+e0lzRHluYW1pY0ZpZWxkfSApIHsKICAgICAgICAgICAgICAgIG15ICRUcmVlU2VsZWN0aW9uTWVzc2FnZSA9ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgiU2hvdyBUcmVlIFNlbGVjdGlvbiIpOwogICAgICAgICAgICAgICAgJEJsb2NrRGF0YXtTZWxlY3RGaWVsZH0KICAgICAgICAgICAgICAgICAgICAuPSAnIDxhIGhyZWY9IiMiIHRpdGxlPSInCiAgICAgICAgICAgICAgICAgICAgLiAkVHJlZVNlbGVjdGlvbk1lc3NhZ2UKICAgICAgICAgICAgICAgICAgICAuICciIGNsYXNzPSJTaG93VHJlZVNlbGVjdGlvbiI+PHNwYW4+JwogICAgICAgICAgICAgICAgICAgIC4gJFRyZWVTZWxlY3Rpb25NZXNzYWdlIC4gJzwvc3Bhbj48aSBjbGFzcz0iZmEgZmEtc2l0ZW1hcCI+PC9pPjwvYT4nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAkQmxvY2tEYXRhe05hbWV9ICAgID0gJE9iamVjdEF0dHJpYnV0ZS0+e05hbWV9OwogICAgICAgICRCbG9ja0RhdGF7RWxlbWVudH0gPSAnWUF4aXMnIC4gJE9iamVjdEF0dHJpYnV0ZS0+e0VsZW1lbnR9OwoKICAgICAgICAjIHNob3cgdGhlIGF0dHJpYnV0ZSBibG9jawogICAgICAgICRMYXlvdXRPYmplY3QtPkJsb2NrKAogICAgICAgICAgICBOYW1lID0+ICdBdHRyaWJ1dGUnLAogICAgICAgICAgICBEYXRhID0+IFwlQmxvY2tEYXRhLAogICAgICAgICk7CgogICAgICAgIGlmICggJE9iamVjdEF0dHJpYnV0ZS0+e0Jsb2NrfSBlcSAnVGltZScgKSB7CgogICAgICAgICAgICAjIGdldCB0aGUgc2VsZWN0ZWQgeCBheGlzIHRpbWUgc2NhbGUgdmFsdWUKICAgICAgICAgICAgbXkgJFNlbGVjdGVkWEF4aXNUaW1lU2NhbGVWYWx1ZSA9ICRTZWxmLT5fR2V0U2VsZWN0ZWRYQXhpc1RpbWVTY2FsZVZhbHVlKCBTdGF0ID0+ICRTdGF0ICk7CgogICAgICAgICAgICBteSAlVGltZURhdGEgPSAkU2VsZi0+X1RpbWVPdXRwdXQoCiAgICAgICAgICAgICAgICBPdXRwdXQgPT4gJ0VkaXQnLAogICAgICAgICAgICAgICAgVXNlICAgID0+ICdVc2VBc1ZhbHVlU2VyaWVzJywKICAgICAgICAgICAgICAgICV7JE9iamVjdEF0dHJpYnV0ZX0sCiAgICAgICAgICAgICAgICBFbGVtZW50ICAgICAgICAgICAgPT4gJEJsb2NrRGF0YXtFbGVtZW50fSwKICAgICAgICAgICAgICAgIFNlbGVjdGVkWEF4aXNWYWx1ZSA9PiAkU2VsZWN0ZWRYQXhpc1RpbWVTY2FsZVZhbHVlLAogICAgICAgICAgICApOwogICAgICAgICAgICAlQmxvY2tEYXRhID0gKCAlQmxvY2tEYXRhLCAlVGltZURhdGEgKTsKICAgICAgICB9CgogICAgICAgIG15ICRCbG9jayA9ICRPYmplY3RBdHRyaWJ1dGUtPntCbG9ja307CgogICAgICAgIGlmICggJEJsb2NrIGVxICdTZWxlY3RGaWVsZCcgKSB7CiAgICAgICAgICAgICRCbG9jayA9ICdNdWx0aVNlbGVjdEZpZWxkJzsKICAgICAgICB9CgogICAgICAgICMgc3RvcmUgZGF0YSwgd2hpY2ggd2lsbCBiZSBzZW50IHRvIEpTCiAgICAgICAgcHVzaCBAWUF4aXNFbGVtZW50cywgJEJsb2NrRGF0YXtFbGVtZW50fSBpZiAkQmxvY2tEYXRhe0NoZWNrZWR9OwoKICAgICAgICAjIHNob3cgdGhlIGlucHV0IGVsZW1lbnQKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAkQmxvY2ssCiAgICAgICAgICAgIERhdGEgPT4gXCVCbG9ja0RhdGEsCiAgICAgICAgKTsKICAgIH0KCiAgICAjIHNlbmQgZGF0YSB0byBKUwogICAgJExheW91dE9iamVjdC0+QWRkSlNEYXRhKAogICAgICAgIEtleSAgID0+ICdZQXhpc0VsZW1lbnRzJywKICAgICAgICBWYWx1ZSA9PiBcQFlBeGlzRWxlbWVudHMsCiAgICApOwoKICAgIG15ICRPdXRwdXQgPSAkTGF5b3V0T2JqZWN0LT5PdXRwdXQoCiAgICAgICAgVGVtcGxhdGVGaWxlID0+ICdTdGF0aXN0aWNzL1lBeGlzV2lkZ2V0JywKICAgICAgICBEYXRhICAgICAgICAgPT4gewogICAgICAgICAgICAleyRTdGF0fSwKICAgICAgICB9LAogICAgKTsKICAgIHJldHVybiAkT3V0cHV0Owp9CgpzdWIgUmVzdHJpY3Rpb25zV2lkZ2V0IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJFN0YXQgPSAkUGFyYW17U3RhdH07CgogICAgIyBnZXQgbmVlZGVkIG9iamVjdHMKICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CiAgICBteSAkQ29uZmlnT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKTsKCiAgICBteSBAUmVzdHJpY3Rpb25FbGVtZW50czsKCiAgICBmb3IgbXkgJE9iamVjdEF0dHJpYnV0ZSAoIEB7ICRTdGF0LT57VXNlQXNSZXN0cmljdGlvbn0gfSApIHsKICAgICAgICBteSAlQmxvY2tEYXRhOwogICAgICAgICRCbG9ja0RhdGF7Rml4ZWR9ICAgICAgICAgICAgICA9ICdjaGVja2VkPSJjaGVja2VkIic7CiAgICAgICAgJEJsb2NrRGF0YXtDaGVja2VkfSAgICAgICAgICAgID0gJyc7CiAgICAgICAgJEJsb2NrRGF0YXtCbG9ja30gICAgICAgICAgICAgID0gJE9iamVjdEF0dHJpYnV0ZS0+e0Jsb2NrfTsKICAgICAgICAkQmxvY2tEYXRhe0NTU0NsYXNzfSAgICAgICAgICAgPSAkT2JqZWN0QXR0cmlidXRlLT57Q1NTQ2xhc3N9OwogICAgICAgICRCbG9ja0RhdGF7SFRNTERhdGFBdHRyaWJ1dGVzfSA9ICRPYmplY3RBdHRyaWJ1dGUtPntIVE1MRGF0YUF0dHJpYnV0ZXN9OwoKICAgICAgICBpZiAoICRPYmplY3RBdHRyaWJ1dGUtPntTZWxlY3RlZH0gKSB7CiAgICAgICAgICAgICRCbG9ja0RhdGF7Q2hlY2tlZH0gPSAnY2hlY2tlZD0iY2hlY2tlZCInOwogICAgICAgICAgICBpZiAoICEkT2JqZWN0QXR0cmlidXRlLT57Rml4ZWR9ICkgewogICAgICAgICAgICAgICAgJEJsb2NrRGF0YXtGaXhlZH0gPSAiIjsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCAkT2JqZWN0QXR0cmlidXRlLT57U2VsZWN0ZWRWYWx1ZXN9ICkgewogICAgICAgICAgICAkQmxvY2tEYXRhe1NlbGVjdGVkVmFsdWV9ID0gJE9iamVjdEF0dHJpYnV0ZS0+e1NlbGVjdGVkVmFsdWVzfVswXTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRCbG9ja0RhdGF7U2VsZWN0ZWRWYWx1ZX0gPSAnJzsKICAgICAgICAgICAgJE9iamVjdEF0dHJpYnV0ZS0+e1NlbGVjdGVkVmFsdWVzfSA9IHVuZGVmOwogICAgICAgIH0KCiAgICAgICAgaWYgKAogICAgICAgICAgICAkT2JqZWN0QXR0cmlidXRlLT57QmxvY2t9IGVxICdNdWx0aVNlbGVjdEZpZWxkJwogICAgICAgICAgICB8fCAkT2JqZWN0QXR0cmlidXRlLT57QmxvY2t9IGVxICdTZWxlY3RGaWVsZCcKICAgICAgICAgICAgKQogICAgICAgIHsKICAgICAgICAgICAgbXkgJERGVHJlZUNsYXNzID0gKCAkT2JqZWN0QXR0cmlidXRlLT57U2hvd0FzVHJlZX0gJiYgJE9iamVjdEF0dHJpYnV0ZS0+e0lzRHluYW1pY0ZpZWxkfSApCiAgICAgICAgICAgICAgICA/ICdEeW5hbWljRmllbGRXaXRoVHJlZVZpZXcnIDogJyc7CgogICAgICAgICAgICAjIFRha2UgaW50byBhY2NvdW50IGNvbmZpZyAnSW5jbHVkZVVua25vd25UaWNrZXRDdXN0b21lcnMnIGZvciBDdXN0b21lcklEIHJlc3RyaWN0aW9uIGZpZWxkLgogICAgICAgICAgICAjIFNlZSBidWcjMTQ4NjkgKGh0dHBzOi8vYnVncy5vdHJzLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MTQ4NjkpLgogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAkT2JqZWN0QXR0cmlidXRlLT57RWxlbWVudH0gZXEgJ0N1c3RvbWVySUQnCiAgICAgICAgICAgICAgICAmJiAhJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OkluY2x1ZGVVbmtub3duVGlja2V0Q3VzdG9tZXJzJykKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbXkgJUN1c3RvbWVyQ29tcGFueUxpc3QKICAgICAgICAgICAgICAgICAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDdXN0b21lckNvbXBhbnknKS0+Q3VzdG9tZXJDb21wYW55TGlzdCggVXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwgVmFsaWQgPT4gMSApOwogICAgICAgICAgICAgICAgJUN1c3RvbWVyQ29tcGFueUxpc3QKICAgICAgICAgICAgICAgICAgICA9IG1hcCB7ICRfID0+ICRfIH0gZ3JlcCB7IGRlZmluZWQgJE9iamVjdEF0dHJpYnV0ZS0+e1ZhbHVlc30tPnskX30gfSBzb3J0IGtleXMgJUN1c3RvbWVyQ29tcGFueUxpc3Q7CgogICAgICAgICAgICAgICAgJE9iamVjdEF0dHJpYnV0ZS0+e1ZhbHVlc30gPSBcJUN1c3RvbWVyQ29tcGFueUxpc3Q7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRCbG9ja0RhdGF7U2VsZWN0RmllbGR9ID0gJExheW91dE9iamVjdC0+QnVpbGRTZWxlY3Rpb24oCiAgICAgICAgICAgICAgICBEYXRhICAgICAgICAgICA9PiAkT2JqZWN0QXR0cmlidXRlLT57VmFsdWVzfSwKICAgICAgICAgICAgICAgIE5hbWUgICAgICAgICAgID0+ICdSZXN0cmljdGlvbnMnIC4gJE9iamVjdEF0dHJpYnV0ZS0+e0VsZW1lbnR9LAogICAgICAgICAgICAgICAgTXVsdGlwbGUgICAgICAgPT4gMSwKICAgICAgICAgICAgICAgIFNpemUgICAgICAgICAgID0+IDUsCiAgICAgICAgICAgICAgICBDbGFzcyAgICAgICAgICA9PiAiTW9kZXJuaXplICRERlRyZWVDbGFzcyIsCiAgICAgICAgICAgICAgICBTZWxlY3RlZElEICAgICA9PiAkT2JqZWN0QXR0cmlidXRlLT57U2VsZWN0ZWRWYWx1ZXN9LAogICAgICAgICAgICAgICAgVHJhbnNsYXRpb24gICAgPT4gJE9iamVjdEF0dHJpYnV0ZS0+e1RyYW5zbGF0aW9ufSwKICAgICAgICAgICAgICAgIFRyZWVWaWV3ICAgICAgID0+ICRPYmplY3RBdHRyaWJ1dGUtPntUcmVlVmlld30gfHwgMCwKICAgICAgICAgICAgICAgIFNvcnQgICAgICAgICAgID0+IHNjYWxhciAkT2JqZWN0QXR0cmlidXRlLT57U29ydH0sCiAgICAgICAgICAgICAgICBTb3J0SW5kaXZpZHVhbCA9PiBzY2FsYXIgJE9iamVjdEF0dHJpYnV0ZS0+e1NvcnRJbmRpdmlkdWFsfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGlmICggJE9iamVjdEF0dHJpYnV0ZS0+e1Nob3dBc1RyZWV9ICYmICRPYmplY3RBdHRyaWJ1dGUtPntJc0R5bmFtaWNGaWVsZH0gKSB7CiAgICAgICAgICAgICAgICBteSAkVHJlZVNlbGVjdGlvbk1lc3NhZ2UgPSAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoIlNob3cgVHJlZSBTZWxlY3Rpb24iKTsKICAgICAgICAgICAgICAgICRCbG9ja0RhdGF7U2VsZWN0RmllbGR9CiAgICAgICAgICAgICAgICAgICAgLj0gJyA8YSBocmVmPSIjIiB0aXRsZT0iJwogICAgICAgICAgICAgICAgICAgIC4gJFRyZWVTZWxlY3Rpb25NZXNzYWdlCiAgICAgICAgICAgICAgICAgICAgLiAnIiBjbGFzcz0iU2hvd1RyZWVTZWxlY3Rpb24iPjxzcGFuPicKICAgICAgICAgICAgICAgICAgICAuICRUcmVlU2VsZWN0aW9uTWVzc2FnZSAuICc8L3NwYW4+PGkgY2xhc3M9ImZhIGZhLXNpdGVtYXAiPjwvaT48L2E+JzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgJEJsb2NrRGF0YXtFbGVtZW50fSA9ICdSZXN0cmljdGlvbnMnIC4gJE9iamVjdEF0dHJpYnV0ZS0+e0VsZW1lbnR9OwogICAgICAgICRCbG9ja0RhdGF7TmFtZX0gICAgPSAkT2JqZWN0QXR0cmlidXRlLT57TmFtZX07CgogICAgICAgICMgc2hvdyB0aGUgYXR0cmlidXRlIGJsb2NrCiAgICAgICAgJExheW91dE9iamVjdC0+QmxvY2soCiAgICAgICAgICAgIE5hbWUgPT4gJ0F0dHJpYnV0ZScsCiAgICAgICAgICAgIERhdGEgPT4gXCVCbG9ja0RhdGEsCiAgICAgICAgKTsKICAgICAgICBpZiAoICRPYmplY3RBdHRyaWJ1dGUtPntCbG9ja30gZXEgJ1RpbWUnICkgewoKICAgICAgICAgICAgbXkgJVRpbWVEYXRhID0gJFNlbGYtPl9UaW1lT3V0cHV0KAogICAgICAgICAgICAgICAgT3V0cHV0ID0+ICdFZGl0JywKICAgICAgICAgICAgICAgIFVzZSAgICA9PiAnVXNlQXNSZXN0cmljdGlvbicsCiAgICAgICAgICAgICAgICAleyRPYmplY3RBdHRyaWJ1dGV9LAogICAgICAgICAgICAgICAgRWxlbWVudCA9PiAkQmxvY2tEYXRhe0VsZW1lbnR9LAogICAgICAgICAgICApOwogICAgICAgICAgICAlQmxvY2tEYXRhID0gKCAlQmxvY2tEYXRhLCAlVGltZURhdGEgKTsKICAgICAgICB9CgogICAgICAgICMgc3RvcmUgZGF0YSwgd2hpY2ggd2lsbCBiZSBzZW50IHRvIEpTCiAgICAgICAgcHVzaCBAUmVzdHJpY3Rpb25FbGVtZW50cywgJEJsb2NrRGF0YXtFbGVtZW50fSBpZiAkQmxvY2tEYXRhe0NoZWNrZWR9OwoKICAgICAgICAjIHNob3cgdGhlIGlucHV0IGVsZW1lbnQKICAgICAgICAkTGF5b3V0T2JqZWN0LT5CbG9jaygKICAgICAgICAgICAgTmFtZSA9PiAkT2JqZWN0QXR0cmlidXRlLT57QmxvY2t9LAogICAgICAgICAgICBEYXRhID0+IFwlQmxvY2tEYXRhLAogICAgICAgICk7CiAgICB9CgogICAgIyBzZW5kIGRhdGEgdG8gSlMKICAgICRMYXlvdXRPYmplY3QtPkFkZEpTRGF0YSgKICAgICAgICBLZXkgICA9PiAnUmVzdHJpY3Rpb25FbGVtZW50cycsCiAgICAgICAgVmFsdWUgPT4gXEBSZXN0cmljdGlvbkVsZW1lbnRzLAogICAgKTsKCiAgICBteSAkT3V0cHV0ID0gJExheW91dE9iamVjdC0+T3V0cHV0KAogICAgICAgIFRlbXBsYXRlRmlsZSA9PiAnU3RhdGlzdGljcy9SZXN0cmljdGlvbnNXaWRnZXQnLAogICAgICAgIERhdGEgICAgICAgICA9PiB7CiAgICAgICAgICAgICV7JFN0YXR9LAogICAgICAgIH0sCiAgICApOwogICAgcmV0dXJuICRPdXRwdXQ7Cn0KCnN1YiBQcmV2aWV3V2lkZ2V0IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJFN0YXQgPSAkUGFyYW17U3RhdH07CgogICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKCiAgICBteSAlU3RhdHNDb25maWd1cmF0aW9uRXJyb3JzOwoKICAgICRTZWxmLT5TdGF0c0NvbmZpZ3VyYXRpb25WYWxpZGF0ZSgKICAgICAgICBTdGF0ICAgPT4gJFN0YXQsCiAgICAgICAgRXJyb3JzID0+IFwlU3RhdHNDb25maWd1cmF0aW9uRXJyb3JzLAogICAgKTsKCiAgICBteSAlRnJvbnRlbmQ7CgogICAgaWYgKCAhJVN0YXRzQ29uZmlndXJhdGlvbkVycm9ycyApIHsKICAgICAgICAkRnJvbnRlbmR7UHJldmlld1Jlc3VsdH0gPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6U3RhdHMnKS0+U3RhdHNSdW4oCiAgICAgICAgICAgIFN0YXRJRCAgID0+ICRTdGF0LT57U3RhdElEfSwKICAgICAgICAgICAgR2V0UGFyYW0gPT4gJFN0YXQsCiAgICAgICAgICAgIFByZXZpZXcgID0+IDEsCiAgICAgICAgICAgIFVzZXJJRCAgID0+ICRQYXJhbXtVc2VySUR9LAogICAgICAgICk7CiAgICB9CgogICAgIyBzZW5kIGRhdGEgdG8gSlMKICAgICRMYXlvdXRPYmplY3QtPkFkZEpTRGF0YSgKICAgICAgICBLZXkgICA9PiAnUHJldmlld1Jlc3VsdCcsCiAgICAgICAgVmFsdWUgPT4gJEZyb250ZW5ke1ByZXZpZXdSZXN1bHR9LAogICAgKTsKCiAgICBteSAkT3V0cHV0ID0gJExheW91dE9iamVjdC0+T3V0cHV0KAogICAgICAgIFRlbXBsYXRlRmlsZSA9PiAnU3RhdGlzdGljcy9QcmV2aWV3V2lkZ2V0JywKICAgICAgICBEYXRhICAgICAgICAgPT4gewogICAgICAgICAgICAleyRTdGF0fSwKICAgICAgICAgICAgJUZyb250ZW5kLAogICAgICAgICAgICBTdGF0c0NvbmZpZ3VyYXRpb25FcnJvcnMgPT4gXCVTdGF0c0NvbmZpZ3VyYXRpb25FcnJvcnMsCiAgICAgICAgfSwKICAgICk7CiAgICByZXR1cm4gJE91dHB1dDsKfQoKc3ViIFN0YXRzUGFyYW1zR2V0IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJFN0YXQgPSAkUGFyYW17U3RhdH07CgogICAgbXkgJEhhc1VzZXJHZXRQYXJhbSA9IHJlZiAkUGFyYW17VXNlckdldFBhcmFtfSBlcSAnSEFTSCc7CgogICAgbXkgJVVzZXJHZXRQYXJhbSA9ICV7ICRQYXJhbXtVc2VyR2V0UGFyYW19IC8vIHt9IH07CgogICAgbXkgJENvbmZpZ09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CiAgICBteSAkUGFyYW1PYmplY3QgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OldlYjo6UmVxdWVzdCcpOwoKICAgIG15ICRMb2NhbEdldFBhcmFtID0gc3ViIHsKICAgICAgICBteSAoJVBhcmFtKSA9IEBfOwogICAgICAgIG15ICRQYXJhbSA9ICRQYXJhbXtQYXJhbX07CiAgICAgICAgcmV0dXJuICRIYXNVc2VyR2V0UGFyYW0gPyAkVXNlckdldFBhcmFteyRQYXJhbX0gOiAkUGFyYW1PYmplY3QtPkdldFBhcmFtKCBQYXJhbSA9PiAkUGFyYW0gKTsKICAgIH07CgogICAgbXkgJExvY2FsR2V0QXJyYXkgPSBzdWIgewogICAgICAgIG15ICglUGFyYW0pID0gQF87CiAgICAgICAgbXkgJFBhcmFtID0gJFBhcmFte1BhcmFtfTsKICAgICAgICBpZiAoJEhhc1VzZXJHZXRQYXJhbSkgewogICAgICAgICAgICBpZiAoICRVc2VyR2V0UGFyYW17JFBhcmFtfSAmJiByZWYgJFVzZXJHZXRQYXJhbXskUGFyYW19IGVxICdBUlJBWScgKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gQHsgJFVzZXJHZXRQYXJhbXskUGFyYW19IH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJFBhcmFtT2JqZWN0LT5HZXRBcnJheSggUGFyYW0gPT4gJFBhcmFtICk7CiAgICB9OwoKICAgIG15ICggJUdldFBhcmFtLCBARXJyb3JzICk7CgogICAgIyBnZXQgdGhlIHRpbWUgem9uZSBwYXJhbQogICAgaWYgKCBsZW5ndGggJExvY2FsR2V0UGFyYW0tPiggUGFyYW0gPT4gJ1RpbWVab25lJyApICkgewogICAgICAgICRHZXRQYXJhbXtUaW1lWm9uZX0gPSAkU2VsZi0+X0dldFZhbGlkVGltZVpvbmUoIFRpbWVab25lID0+ICRMb2NhbEdldFBhcmFtLT4oIFBhcmFtID0+ICdUaW1lWm9uZScgKSApCiAgICAgICAgICAgIC8vICRTdGF0LT57VGltZVpvbmV9OwogICAgfQoKICAgICMgZ2V0IEV4Y2hhbmdlQXhpcyBwYXJhbQogICAgaWYgKCBsZW5ndGggJExvY2FsR2V0UGFyYW0tPiggUGFyYW0gPT4gJ0V4Y2hhbmdlQXhpcycgKSApIHsKICAgICAgICAkR2V0UGFyYW17RXhjaGFuZ2VBeGlzfSA9ICRMb2NhbEdldFBhcmFtLT4oIFBhcmFtID0+ICdFeGNoYW5nZUF4aXMnICkgLy8gJFN0YXQtPntFeGNoYW5nZUF4aXN9OwogICAgfQoKICAgICMKICAgICMgU3RhdGljIHN0YXRpc3RpY3MKICAgICMKICAgIGlmICggJFN0YXQtPntTdGF0VHlwZX0gZXEgJ3N0YXRpYycgKSB7CiAgICAgICAgbXkgJEN1clN5c0RURGV0YWlscyA9ICRLZXJuZWw6Ok9NLT5DcmVhdGUoJ0tlcm5lbDo6U3lzdGVtOjpEYXRlVGltZScpLT5HZXQoKTsKCiAgICAgICAgJEdldFBhcmFte1llYXJ9ICA9ICRDdXJTeXNEVERldGFpbHMtPntZZWFyfTsKICAgICAgICAkR2V0UGFyYW17TW9udGh9ID0gJEN1clN5c0RURGV0YWlscy0+e01vbnRofTsKICAgICAgICAkR2V0UGFyYW17RGF5fSAgID0gJEN1clN5c0RURGV0YWlscy0+e0RheX07CgogICAgICAgIG15ICRQYXJhbXMgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6U3RhdHMnKS0+R2V0UGFyYW1zKAogICAgICAgICAgICBTdGF0SUQgPT4gJFN0YXQtPntTdGF0SUR9LAogICAgICAgICk7CgogICAgICAgIFBBUkFNSVRFTToKICAgICAgICBmb3IgbXkgJFBhcmFtSXRlbSAoIEB7JFBhcmFtc30gKSB7CiAgICAgICAgICAgIGlmICggJFBhcmFtSXRlbS0+e011bHRpcGxlfSApIHsKICAgICAgICAgICAgICAgICRHZXRQYXJhbXsgJFBhcmFtSXRlbS0+e05hbWV9IH0gPSBbICRMb2NhbEdldEFycmF5LT4oIFBhcmFtID0+ICRQYXJhbUl0ZW0tPntOYW1lfSApIF07CiAgICAgICAgICAgICAgICBuZXh0IFBBUkFNSVRFTTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkR2V0UGFyYW17ICRQYXJhbUl0ZW0tPntOYW1lfSB9ID0gJExvY2FsR2V0UGFyYW0tPiggUGFyYW0gPT4gJFBhcmFtSXRlbS0+e05hbWV9ICk7CiAgICAgICAgfQogICAgfQogICAgIwogICAgIyBEeW5hbWljIHN0YXRpc3RpY3MKICAgICMKICAgIGVsc2UgewoKICAgICAgICBteSAkVGltZVBlcmlvZCAgICAgICAgID0gMDsKICAgICAgICBteSAkVGltZVVwY29taW5nUGVyaW9kID0gMDsKCiAgICAgICAgZm9yIG15ICRVc2UgKHF3KFVzZUFzWHZhbHVlIFVzZUFzVmFsdWVTZXJpZXMgVXNlQXNSZXN0cmljdGlvbikpIHsKICAgICAgICAgICAgJFN0YXQtPnskVXNlfSB8fD0gW107CgogICAgICAgICAgICBteSBAQXJyYXkgICA9IEB7ICRTdGF0LT57JFVzZX0gfTsKICAgICAgICAgICAgbXkgJENvdW50ZXIgPSAwOwogICAgICAgICAgICBFTEVNRU5UOgogICAgICAgICAgICBmb3IgbXkgJEVsZW1lbnQgKEBBcnJheSkgewogICAgICAgICAgICAgICAgbmV4dCBFTEVNRU5UIGlmICEkRWxlbWVudC0+e1NlbGVjdGVkfTsKCiAgICAgICAgICAgICAgICBteSAkRWxlbWVudE5hbWUgPSAkVXNlIC4gJEVsZW1lbnQtPnsnRWxlbWVudCd9OwoKICAgICAgICAgICAgICAgIGlmICggISRFbGVtZW50LT57Rml4ZWR9ICkgewoKICAgICAgICAgICAgICAgICAgICBpZiAoICRMb2NhbEdldEFycmF5LT4oIFBhcmFtID0+ICRFbGVtZW50TmFtZSApICkgewogICAgICAgICAgICAgICAgICAgICAgICBteSBAU2VsZWN0ZWRWYWx1ZXMgPSAkTG9jYWxHZXRBcnJheS0+KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgUGFyYW0gPT4gJEVsZW1lbnROYW1lCiAgICAgICAgICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgICAgICAgICAkRWxlbWVudC0+e1NlbGVjdGVkVmFsdWVzfSA9IFxAU2VsZWN0ZWRWYWx1ZXM7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2lmICggJExvY2FsR2V0UGFyYW0tPiggUGFyYW0gPT4gJEVsZW1lbnROYW1lICkgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG15ICRTZWxlY3RlZFZhbHVlID0gJExvY2FsR2V0UGFyYW0tPigKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBhcmFtID0+ICRFbGVtZW50TmFtZQogICAgICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICAgICAgICAgJEVsZW1lbnQtPntTZWxlY3RlZFZhbHVlc30gPSBbJFNlbGVjdGVkVmFsdWVdOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgIyBzZXQgdGhlIGZpcnN0IHZhbHVlIGZvciBhIHNpbmdsZSBzZWxlY3QgZmllbGQsIGlmIG5vIHNlbGVjdGVkIHZhbHVlIGlzIGdpdmVuCiAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICAgICAkRWxlbWVudC0+e0Jsb2NrfSBlcSAnU2VsZWN0RmllbGQnCiAgICAgICAgICAgICAgICAgICAgICAgICYmICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICFJc0FycmF5UmVmV2l0aERhdGEoICRFbGVtZW50LT57U2VsZWN0ZWRWYWx1ZXN9ICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHx8IHNjYWxhciBAeyAkRWxlbWVudC0+e1NlbGVjdGVkVmFsdWVzfSB9ID4gMQogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICB7CgogICAgICAgICAgICAgICAgICAgICAgICBteSBAVmFsdWVzID0gc29ydCBrZXlzICV7ICRFbGVtZW50LT57VmFsdWVzfSB9OwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgSXNBcnJheVJlZldpdGhEYXRhKCAkRWxlbWVudC0+e1NlbGVjdGVkVmFsdWVzfSApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAmJiBzY2FsYXIgQHsgJEVsZW1lbnQtPntTZWxlY3RlZFZhbHVlc30gfSA+IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgQFZhbHVlcyA9IEB7ICRFbGVtZW50LT57U2VsZWN0ZWRWYWx1ZXN9IH07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICRFbGVtZW50LT57U2VsZWN0ZWRWYWx1ZXN9ID0gWyAkVmFsdWVzWzBdIF07CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAoICRFbGVtZW50LT57QmxvY2t9IGVxICdJbnB1dEZpZWxkJyApIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICMgU2hvdyB3YXJuaW5nIGlmIHJlc3RyaWN0aW9ucyBjb250YWluIHN0b3Agd29yZHMgd2l0aGluIHRpY2tldCBzZWFyY2guCiAgICAgICAgICAgICAgICAgICAgICAgIG15ICVTdG9wV29yZEZpZWxkcyA9ICRTZWxmLT5fU3RvcFdvcmRGaWVsZHNHZXQoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggJFN0b3BXb3JkRmllbGRzeyAkRWxlbWVudC0+e0VsZW1lbnR9IH0gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBteSAkRXJyb3JNZXNzYWdlID0gJFNlbGYtPl9TdG9wV29yZEVycm9yQ2hlY2soCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEVsZW1lbnQtPntFbGVtZW50fSA9PiAkRWxlbWVudC0+e1NlbGVjdGVkVmFsdWVzfVswXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJEVycm9yTWVzc2FnZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2ggQEVycm9ycywgIiRFbGVtZW50LT57TmFtZX06ICRFcnJvck1lc3NhZ2UiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoICRFbGVtZW50LT57QmxvY2t9IGVxICdUaW1lJyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgbXkgJVRpbWU7CgogICAgICAgICAgICAgICAgICAgICAgICAjIENoZWNrIGlmIGl0IGlzIGFuIGFic29sdXRlIHRpbWUgcGVyaW9kCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggJEVsZW1lbnQtPntUaW1lU3RhcnR9ICkgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggJExvY2FsR2V0UGFyYW0tPiggUGFyYW0gPT4gJEVsZW1lbnROYW1lIC4gJ1N0YXJ0WWVhcicgKSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgbXkgJExpbWl0IChxdyhTdGFydCBTdG9wKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgbXkgJFVuaXQgKHF3KFllYXIgTW9udGggRGF5IEhvdXIgTWludXRlIFNlY29uZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggZGVmaW5lZCggJExvY2FsR2V0UGFyYW0tPiggUGFyYW0gPT4gIiRFbGVtZW50TmFtZSRMaW1pdCRVbml0IiApICkgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFRpbWV7ICRMaW1pdCAuICRVbml0IH0gPSAkTG9jYWxHZXRQYXJhbS0+KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQYXJhbSA9PiAkRWxlbWVudE5hbWUgLiAiJExpbWl0JFVuaXQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhZGVmaW5lZCggJFRpbWV7ICRMaW1pdCAuICdIb3VyJyB9ICkgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoICRMaW1pdCBlcSAnU3RhcnQnICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRUaW1le1N0YXJ0SG91cn0gICA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFRpbWV7U3RhcnRNaW51dGV9ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVGltZXtTdGFydFNlY29uZH0gPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzaWYgKCAkTGltaXQgZXEgJ1N0b3AnICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRUaW1le1N0b3BIb3VyfSAgID0gMjM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFRpbWV7U3RvcE1pbnV0ZX0gPSA1OTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVGltZXtTdG9wU2Vjb25kfSA9IDU5OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2lmICggIWRlZmluZWQoICRUaW1leyAkTGltaXQgLiAnU2Vjb25kJyB9ICkgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoICRMaW1pdCBlcSAnU3RhcnQnICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRUaW1le1N0YXJ0U2Vjb25kfSA9IDA7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNpZiAoICRMaW1pdCBlcSAnU3RvcCcgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFRpbWV7U3RvcFNlY29uZH0gPSA1OTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVGltZXsiVGltZSRMaW1pdCJ9ID0gc3ByaW50ZigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIlMDRkLSUwMmQtJTAyZCAlMDJkOiUwMmQ6JTAyZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVGltZXsgJExpbWl0IC4gJ1llYXInIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVGltZXsgJExpbWl0IC4gJ01vbnRoJyB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFRpbWV7ICRMaW1pdCAuICdEYXknIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVGltZXsgJExpbWl0IC4gJ0hvdXInIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVGltZXsgJExpbWl0IC4gJ01pbnV0ZScgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRUaW1leyAkTGltaXQgLiAnU2Vjb25kJyB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEVsZW1lbnQtPntUaW1lU3RhcnR9ID0gJFRpbWV7VGltZVN0YXJ0fTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkRWxlbWVudC0+e1RpbWVTdG9wfSAgPSAkVGltZXtUaW1lU3RvcH07CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggJFVzZSBlcSAnVXNlQXNYdmFsdWUnICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteSAkVGltZVN0YXJ0RXBvY2ggPSAkS2VybmVsOjpPTS0+Q3JlYXRlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0tlcm5lbDo6U3lzdGVtOjpEYXRlVGltZScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmplY3RQYXJhbXMgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN0cmluZyA9PiAkRWxlbWVudC0+e1RpbWVTdGFydH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApLT5Ub0Vwb2NoKCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteSAkVGltZVN0b3BFcG9jaCA9ICRLZXJuZWw6Ok9NLT5DcmVhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnS2VybmVsOjpTeXN0ZW06OkRhdGVUaW1lJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdFBhcmFtcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nID0+ICRFbGVtZW50LT57VGltZVN0b3B9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKS0+VG9FcG9jaCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFRpbWVQZXJpb2QgPSAkVGltZVN0b3BFcG9jaCAtICRUaW1lU3RhcnRFcG9jaDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAkVXNlIG5lICdVc2VBc1ZhbHVlU2VyaWVzJyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVGltZXtUaW1lUmVsYXRpdmVVbml0fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA9ICRMb2NhbEdldFBhcmFtLT4oIFBhcmFtID0+ICRFbGVtZW50TmFtZSAuICdUaW1lUmVsYXRpdmVVbml0JyApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRUaW1le1RpbWVSZWxhdGl2ZUNvdW50fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA9ICRMb2NhbEdldFBhcmFtLT4oIFBhcmFtID0+ICRFbGVtZW50TmFtZSAuICdUaW1lUmVsYXRpdmVDb3VudCcgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVGltZXtUaW1lUmVsYXRpdmVVcGNvbWluZ0NvdW50fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA9ICRMb2NhbEdldFBhcmFtLT4oIFBhcmFtID0+ICRFbGVtZW50TmFtZSAuICdUaW1lUmVsYXRpdmVVcGNvbWluZ0NvdW50JyApOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFVzZSBWYWx1ZXMgb2YgdGhlIHN0YXQgYXMgZmFsbGJhY2sKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVGltZXtUaW1lUmVsYXRpdmVDb3VudH0gICAgICAgICAvLz0gJEVsZW1lbnQtPntUaW1lUmVsYXRpdmVDb3VudH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFRpbWV7VGltZVJlbGF0aXZlVXBjb21pbmdDb3VudH0gLy89ICRFbGVtZW50LT57VGltZVJlbGF0aXZlVXBjb21pbmdDb3VudH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJFRpbWV7VGltZVJlbGF0aXZlVW5pdH0gfHw9ICRFbGVtZW50LT57VGltZVJlbGF0aXZlVW5pdH07CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggISRUaW1le1RpbWVSZWxhdGl2ZUNvdW50fSAmJiAhJFRpbWV7VGltZVJlbGF0aXZlVXBjb21pbmdDb3VudH0gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2ggQEVycm9ycywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRyYW5zbGF0YWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdObyBwYXN0IGNvbXBsZXRlIG9yIHRoZSBjdXJyZW50K3VwY29taW5nIGNvbXBsZXRlIHJlbGF0aXZlIHRpbWUgdmFsdWUgc2VsZWN0ZWQuJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggJFVzZSBlcSAnVXNlQXNYdmFsdWUnICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVGltZVBlcmlvZCA9ICRUaW1le1RpbWVSZWxhdGl2ZUNvdW50fSAqICRTZWxmLT5fVGltZUluU2Vjb25kcygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRpbWVVbml0ID0+ICRUaW1le1RpbWVSZWxhdGl2ZVVuaXR9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVGltZVVwY29taW5nUGVyaW9kID0gJFRpbWV7VGltZVJlbGF0aXZlVXBjb21pbmdDb3VudH0gKiAkU2VsZi0+X1RpbWVJblNlY29uZHMoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaW1lVW5pdCA9PiAkVGltZXtUaW1lUmVsYXRpdmVVbml0fSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRFbGVtZW50LT57VGltZVJlbGF0aXZlQ291bnR9ICAgICAgICAgPSAkVGltZXtUaW1lUmVsYXRpdmVDb3VudH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJEVsZW1lbnQtPntUaW1lUmVsYXRpdmVVcGNvbWluZ0NvdW50fSA9ICRUaW1le1RpbWVSZWxhdGl2ZVVwY29taW5nQ291bnR9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRFbGVtZW50LT57VGltZVJlbGF0aXZlVW5pdH0gICAgICAgICAgPSAkVGltZXtUaW1lUmVsYXRpdmVVbml0fTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAkVXNlIG5lICdVc2VBc1Jlc3RyaWN0aW9uJyApIHsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoICRMb2NhbEdldFBhcmFtLT4oIFBhcmFtID0+ICRFbGVtZW50TmFtZSApICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRFbGVtZW50LT57U2VsZWN0ZWRWYWx1ZXN9ID0gWyAkTG9jYWxHZXRQYXJhbS0+KCBQYXJhbSA9PiAkRWxlbWVudE5hbWUgKSBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICggJExvY2FsR2V0UGFyYW0tPiggUGFyYW0gPT4gJEVsZW1lbnROYW1lIC4gJ1RpbWVTY2FsZUNvdW50JyApICkgewoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVGltZXtUaW1lU2NhbGVDb3VudH0gPSAkTG9jYWxHZXRQYXJhbS0+KCBQYXJhbSA9PiAkRWxlbWVudE5hbWUgLiAnVGltZVNjYWxlQ291bnQnICk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgVXNlIFZhbHVlcyBvZiB0aGUgc3RhdCBhcyBmYWxsYmFjawogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRUaW1le1RpbWVTY2FsZUNvdW50fSB8fD0gJEVsZW1lbnQtPntUaW1lU2NhbGVDb3VudH07CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRFbGVtZW50LT57VGltZVNjYWxlQ291bnR9ID0gJFRpbWV7VGltZVNjYWxlQ291bnR9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRHZXRQYXJhbXskVXNlfS0+WyRDb3VudGVyXSA9ICRFbGVtZW50OwogICAgICAgICAgICAgICAgJENvdW50ZXIrKzsKCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCByZWYgJEdldFBhcmFteyRVc2V9IG5lICdBUlJBWScgKSB7CiAgICAgICAgICAgICAgICAkR2V0UGFyYW17JFVzZX0gPSBbXTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBjaGVjayBpZiB0aGUgdGltZXBlcmlvZCBpcyB0b28gYmlnIG9yIHRoZSB0aW1lIHNjYWxlIHRvbyBzbWFsbAogICAgICAgIGlmICgKICAgICAgICAgICAgKCAkR2V0UGFyYW17VXNlQXNYdmFsdWV9WzBde0Jsb2NrfSAmJiAkR2V0UGFyYW17VXNlQXNYdmFsdWV9WzBde0Jsb2NrfSBlcSAnVGltZScgKQogICAgICAgICAgICAmJiAoCiAgICAgICAgICAgICAgICAhJEdldFBhcmFte1VzZUFzVmFsdWVTZXJpZXN9WzBdCiAgICAgICAgICAgICAgICB8fCAoICRHZXRQYXJhbXtVc2VBc1ZhbHVlU2VyaWVzfVswXSAmJiAkR2V0UGFyYW17VXNlQXNWYWx1ZVNlcmllc31bMF17QmxvY2t9IG5lICdUaW1lJyApCiAgICAgICAgICAgICkKICAgICAgICAgICAgKQogICAgICAgIHsKCiAgICAgICAgICAgIG15ICRTY2FsZVBlcmlvZCA9ICRTZWxmLT5fVGltZUluU2Vjb25kcygKICAgICAgICAgICAgICAgIFRpbWVVbml0ID0+ICRHZXRQYXJhbXtVc2VBc1h2YWx1ZX1bMF17U2VsZWN0ZWRWYWx1ZXN9WzBdCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAjIGludGVncmF0ZSB0aGlzIGZ1bmN0aW9uYWxpdHkgaW4gdGhlIGNvbXBsZXRlbmVzc2NoZWNrCiAgICAgICAgICAgIG15ICRNYXhBdHRyID0gJENvbmZpZ09iamVjdC0+R2V0KCdTdGF0czo6TWF4WGF4aXNBdHRyaWJ1dGVzJykgfHwgMTAwMDsKICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgKCAkVGltZVBlcmlvZCArICRUaW1lVXBjb21pbmdQZXJpb2QgKSAvICggJFNjYWxlUGVyaW9kICogJEdldFBhcmFte1VzZUFzWHZhbHVlfVswXXtUaW1lU2NhbGVDb3VudH0gKQogICAgICAgICAgICAgICAgPiAkTWF4QXR0cgogICAgICAgICAgICAgICAgKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBwdXNoIEBFcnJvcnMsIFRyYW5zbGF0YWJsZSgnVGhlIHNlbGVjdGVkIHRpbWUgcGVyaW9kIGlzIGxhcmdlciB0aGFuIHRoZSBhbGxvd2VkIHRpbWUgcGVyaW9kLicpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoICRHZXRQYXJhbXtVc2VBc1ZhbHVlU2VyaWVzfVswXXtCbG9ja30gJiYgJEdldFBhcmFte1VzZUFzVmFsdWVTZXJpZXN9WzBde0Jsb2NrfSBlcSAnVGltZScgKSB7CgogICAgICAgICAgICBteSAkVGltZVNjYWxlID0gJFNlbGYtPl9UaW1lU2NhbGUoCiAgICAgICAgICAgICAgICBTZWxlY3RlZFhBeGlzVmFsdWUgPT4gJEdldFBhcmFte1VzZUFzWHZhbHVlfVswXXtTZWxlY3RlZFZhbHVlc31bMF0sCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBpZiAoICFJc0hhc2hSZWZXaXRoRGF0YSgkVGltZVNjYWxlKSApIHsKICAgICAgICAgICAgICAgIHB1c2ggQEVycm9ycywKICAgICAgICAgICAgICAgICAgICBUcmFuc2xhdGFibGUoCiAgICAgICAgICAgICAgICAgICAgJ05vIHRpbWUgc2NhbGUgdmFsdWUgYXZhaWxhYmxlIGZvciB0aGUgY3VycmVudCBzZWxlY3RlZCB0aW1lIHNjYWxlIHZhbHVlIG9uIHRoZSBYIGF4aXMuJwogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgaWYgKEBFcnJvcnMpIHsKICAgICAgICBkaWUgXEBFcnJvcnM7CiAgICB9CgogICAgcmV0dXJuICVHZXRQYXJhbTsKfQoKc3ViIFN0YXRzUmVzdWx0UmVuZGVyIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgQFN0YXRBcnJheSA9IEB7ICRQYXJhbXtTdGF0QXJyYXl9IC8vIFtdIH07CiAgICBteSAkU3RhdCAgICAgID0gJFBhcmFte1N0YXR9OwoKICAgIG15ICRMYXlvdXRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6SFRNTDo6TGF5b3V0Jyk7CiAgICBteSAkQ29uZmlnT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKTsKCiAgICBteSAkVGl0bGVBcnJheVJlZiA9IHNoaWZ0IEBTdGF0QXJyYXk7CiAgICBteSAkVGl0bGUgICAgICAgICA9ICRUaXRsZUFycmF5UmVmLT5bMF07CiAgICBteSAkSGVhZEFycmF5UmVmICA9IHNoaWZ0IEBTdGF0QXJyYXk7CgogICAgIyBHZW5lcmF0ZSBGaWxlbmFtZQogICAgbXkgJEZpbGVuYW1lID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlN0YXRzJyktPlN0cmluZ0FuZFRpbWVzdGFtcDJGaWxlbmFtZSgKICAgICAgICBTdHJpbmcgICA9PiAkU3RhdC0+e1RpdGxlfSAuICcgQ3JlYXRlZCcsCiAgICAgICAgVGltZVpvbmUgPT4gJFBhcmFte1RpbWVab25lfSwKICAgICk7CgogICAgIyBnZXQgQ1NWIG9iamVjdAogICAgbXkgJENTVk9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDU1YnKTsKCiAgICAjIGdlbmVyYXRlIEQzIG91dHB1dAogICAgaWYgKCAkUGFyYW17Rm9ybWF0fSA9fiBte15EM30gKSB7CgogICAgICAgICMgaWYgYXJyYXkgPSBlbXB0eQogICAgICAgIGlmICggIUBTdGF0QXJyYXkgKSB7CiAgICAgICAgICAgIHB1c2ggQFN0YXRBcnJheSwgWyAnICcsIDAgXTsKICAgICAgICB9CgogICAgICAgIG15ICRPdXRwdXQgPSAkTGF5b3V0T2JqZWN0LT5IZWFkZXIoCiAgICAgICAgICAgIFZhbHVlID0+ICRUaXRsZSwKICAgICAgICAgICAgVHlwZSAgPT4gJ1NtYWxsJywKICAgICAgICApOwoKICAgICAgICAjIHNlbmQgZGF0YSB0byBKUwogICAgICAgICRMYXlvdXRPYmplY3QtPkFkZEpTRGF0YSgKICAgICAgICAgICAgS2V5ICAgPT4gJ0QzRGF0YScsCiAgICAgICAgICAgIFZhbHVlID0+IHsKICAgICAgICAgICAgICAgIFJhd0RhdGEgPT4gWwogICAgICAgICAgICAgICAgICAgIFskVGl0bGVdLAogICAgICAgICAgICAgICAgICAgICRIZWFkQXJyYXlSZWYsCiAgICAgICAgICAgICAgICAgICAgQFN0YXRBcnJheSwKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICBGb3JtYXQgPT4gJFBhcmFte0Zvcm1hdH0sCiAgICAgICAgICAgIH0KICAgICAgICApOwoKICAgICAgICAkT3V0cHV0IC49ICRMYXlvdXRPYmplY3QtPk91dHB1dCgKICAgICAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgICAgICAleyRTdGF0fSwKICAgICAgICAgICAgfSwKICAgICAgICAgICAgVGVtcGxhdGVGaWxlID0+ICdTdGF0aXN0aWNzL1N0YXRzUmVzdWx0UmVuZGVyL0QzJywKICAgICAgICApOwogICAgICAgICRPdXRwdXQgLj0gJExheW91dE9iamVjdC0+Rm9vdGVyKAogICAgICAgICAgICBUeXBlID0+ICdTbWFsbCcsCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gJE91dHB1dDsKICAgIH0KCiAgICAjIGdlbmVyYXRlIGNzdiBvdXRwdXQKICAgIGlmICggJFBhcmFte0Zvcm1hdH0gZXEgJ0NTVicgKSB7CgogICAgICAgICMgZ2V0IFNlcGFyYXRvciBmcm9tIGxhbmd1YWdlIGZpbGUKICAgICAgICBteSAkVXNlckNTVlNlcGFyYXRvciA9ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPntTZXBhcmF0b3J9OwoKICAgICAgICBpZiAoICRDb25maWdPYmplY3QtPkdldCgnUHJlZmVyZW5jZXNHcm91cHMnKS0+e0NTVlNlcGFyYXRvcn0tPntBY3RpdmV9ICkgewogICAgICAgICAgICBteSAlVXNlckRhdGEgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VXNlcicpLT5HZXRVc2VyRGF0YSgKICAgICAgICAgICAgICAgIFVzZXJJRCA9PiAkUGFyYW17VXNlcklEfQogICAgICAgICAgICApOwogICAgICAgICAgICAkVXNlckNTVlNlcGFyYXRvciA9ICRVc2VyRGF0YXtVc2VyQ1NWU2VwYXJhdG9yfSBpZiAkVXNlckRhdGF7VXNlckNTVlNlcGFyYXRvcn07CiAgICAgICAgfQogICAgICAgIG15ICRPdXRwdXQgPSAkQ1NWT2JqZWN0LT5BcnJheTJDU1YoCiAgICAgICAgICAgIEhlYWQgICAgICA9PiAkSGVhZEFycmF5UmVmLAogICAgICAgICAgICBEYXRhICAgICAgPT4gXEBTdGF0QXJyYXksCiAgICAgICAgICAgIFNlcGFyYXRvciA9PiAkVXNlckNTVlNlcGFyYXRvciwKICAgICAgICApOwoKICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+QXR0YWNobWVudCgKICAgICAgICAgICAgRmlsZW5hbWUgICAgPT4gJEZpbGVuYW1lIC4gJy5jc3YnLAogICAgICAgICAgICBDb250ZW50VHlwZSA9PiAidGV4dC9jc3YiLAogICAgICAgICAgICBDb250ZW50ICAgICA9PiAkT3V0cHV0LAogICAgICAgICk7CiAgICB9CgogICAgIyBnZW5lcmF0ZSBleGNlbCBvdXRwdXQKICAgIGVsc2lmICggJFBhcmFte0Zvcm1hdH0gZXEgJ0V4Y2VsJyApIHsKCiAgICAgICAgbXkgJFN0YXRzQmFja2VuZE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoICRTdGF0LT57T2JqZWN0TW9kdWxlfSApOwogICAgICAgIG15ICRFeGNlbE9iamVjdCAgICAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6RXhjZWwnKTsKCiAgICAgICAgbXkgJUFycmF5MkV4Y2VsUGFyYW1zOwogICAgICAgIGlmICggJFN0YXRzQmFja2VuZE9iamVjdC0+Y2FuKCdXb3Jrc2hlZXRzJykgKSB7CiAgICAgICAgICAgICVBcnJheTJFeGNlbFBhcmFtcyA9ICgKICAgICAgICAgICAgICAgIFdvcmtzaGVldHMgPT4gJFN0YXRzQmFja2VuZE9iamVjdC0+V29ya3NoZWV0cygpLAogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgbXkgQFRhYmxlRGF0YSAgICAgICAgPSAoIFsgQHskSGVhZEFycmF5UmVmfSBdLCBAU3RhdEFycmF5ICk7CiAgICAgICAgICAgIG15ICRGb3JtYXREZWZpbml0aW9uID0gJEV4Y2VsT2JqZWN0LT5HZXRGb3JtYXREZWZpbml0aW9uKAogICAgICAgICAgICAgICAgU3RhdCA9PiAkU3RhdCwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICVBcnJheTJFeGNlbFBhcmFtcyA9ICgKICAgICAgICAgICAgICAgIERhdGEgICAgICAgICAgICAgPT4gXEBUYWJsZURhdGEsCiAgICAgICAgICAgICAgICBGb3JtYXREZWZpbml0aW9uID0+ICRGb3JtYXREZWZpbml0aW9uLAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgbXkgJE91dHB1dCA9ICRFeGNlbE9iamVjdC0+QXJyYXkyRXhjZWwoCiAgICAgICAgICAgICVBcnJheTJFeGNlbFBhcmFtcywKICAgICAgICAgICAgU3RhdCA9PiAkU3RhdCwKICAgICAgICApOwoKICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+QXR0YWNobWVudCgKICAgICAgICAgICAgRmlsZW5hbWUgICAgPT4gJEZpbGVuYW1lIC4gJy54bHN4JywKICAgICAgICAgICAgQ29udGVudFR5cGUgPT4gImFwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5zcHJlYWRzaGVldG1sLnNoZWV0IiwKICAgICAgICAgICAgQ29udGVudCAgICAgPT4gJE91dHB1dCwKICAgICAgICApOwoKICAgIH0KCiAgICAjIHBkZiBvciBodG1sIG91dHB1dAogICAgZWxzaWYgKCAkUGFyYW17Rm9ybWF0fSBlcSAnUHJpbnQnICkgewogICAgICAgIG15ICRQREZTdHJpbmcgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Ok91dHB1dDo6UERGOjpTdGF0aXN0aWNzJyktPkdlbmVyYXRlUERGKAogICAgICAgICAgICBTdGF0ICAgICAgICAgPT4gJFN0YXQsCiAgICAgICAgICAgIFRpdGxlICAgICAgICA9PiAkVGl0bGUsCiAgICAgICAgICAgIEhlYWRBcnJheVJlZiA9PiAkSGVhZEFycmF5UmVmLAogICAgICAgICAgICBTdGF0QXJyYXkgICAgPT4gXEBTdGF0QXJyYXksCiAgICAgICAgICAgIFRpbWVab25lICAgICA9PiAkUGFyYW17VGltZVpvbmV9LAogICAgICAgICAgICBVc2VySUQgICAgICAgPT4gJFBhcmFte1VzZXJJRH0sCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gJExheW91dE9iamVjdC0+QXR0YWNobWVudCgKICAgICAgICAgICAgRmlsZW5hbWUgICAgPT4gJEZpbGVuYW1lIC4gJy5wZGYnLAogICAgICAgICAgICBDb250ZW50VHlwZSA9PiAnYXBwbGljYXRpb24vcGRmJywKICAgICAgICAgICAgQ29udGVudCAgICAgPT4gJFBERlN0cmluZywKICAgICAgICAgICAgVHlwZSAgICAgICAgPT4gJ2lubGluZScsCiAgICAgICAgKTsKICAgIH0KfQoKPWhlYWQyIFN0YXRzQ29uZmlndXJhdGlvblZhbGlkYXRlKCkKCiAgICBteSAkU3RhdENvcnJlY3RseUNvbmZpZ3VyZWQgPSAkU3RhdHNWaWV3T2JqZWN0LT5TdGF0c0NvbmZpZ3VyYXRpb25WYWxpZGF0ZSgKICAgICAgICBTdGF0RGF0YSA9PiBcJVN0YXREYXRhLAogICAgICAgIEVycm9ycyAgID0+IFwlRXJyb3JzLCAgICMgSGFzaCB0byBiZSBwb3B1bGF0ZWQgd2l0aCBlcnJvcnMsIGlmIGFueQogICAgKTsKCj1jdXQKCnN1YiBTdGF0c0NvbmZpZ3VyYXRpb25WYWxpZGF0ZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIGZvciBteSAkTmVlZGVkIChxdyhTdGF0IEVycm9ycykpIHsKICAgICAgICBpZiAoICEkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICROZWVkZWQiCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgbXkgJUdlbmVyYWxTcGVjaWZpY2F0aW9uRmllbGRFcnJvcnM7CiAgICBteSAoICVYQXhpc0ZpZWxkRXJyb3JzLCBAWEF4aXNHZW5lcmFsRXJyb3JzICk7CiAgICBteSAoICVZQXhpc0ZpZWxkRXJyb3JzLCBAWUF4aXNHZW5lcmFsRXJyb3JzICk7CiAgICBteSAoJVJlc3RyaWN0aW9uc0ZpZWxkRXJyb3JzKTsKCiAgICBteSAlU3RhdCA9ICV7ICRQYXJhbXtTdGF0fSB9OwoKICAgICMgU3BlY2lmaWNhdGlvbgogICAgewogICAgICAgIEtFWToKICAgICAgICBmb3IgbXkgJEZpZWxkIChxdyhUaXRsZSBEZXNjcmlwdGlvbiBTdGF0VHlwZSBQZXJtaXNzaW9uIEZvcm1hdCBPYmplY3RNb2R1bGUpKSB7CiAgICAgICAgICAgIGlmICggISRTdGF0eyRGaWVsZH0gKSB7CiAgICAgICAgICAgICAgICAkR2VuZXJhbFNwZWNpZmljYXRpb25GaWVsZEVycm9yc3skRmllbGR9ID0gVHJhbnNsYXRhYmxlKCdUaGlzIGZpZWxkIGlzIHJlcXVpcmVkLicpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICggJFN0YXR7U3RhdFR5cGV9ICYmICRTdGF0e1N0YXRUeXBlfSBlcSAnc3RhdGljJyAmJiAhJFN0YXR7RmlsZX0gKSB7CiAgICAgICAgICAgICRHZW5lcmFsU3BlY2lmaWNhdGlvbkZpZWxkRXJyb3Jze0ZpbGV9ID0gVHJhbnNsYXRhYmxlKCdUaGlzIGZpZWxkIGlzIHJlcXVpcmVkLicpOwogICAgICAgIH0KICAgICAgICBpZiAoICRTdGF0e1N0YXRUeXBlfSAmJiAkU3RhdHtTdGF0VHlwZX0gZXEgJ2R5bmFtaWMnICYmICEkU3RhdHtPYmplY3R9ICkgewogICAgICAgICAgICAkR2VuZXJhbFNwZWNpZmljYXRpb25GaWVsZEVycm9yc3tPYmplY3R9ID0gVHJhbnNsYXRhYmxlKCdUaGlzIGZpZWxkIGlzIHJlcXVpcmVkLicpOwogICAgICAgIH0KICAgIH0KCiAgICBteSAkQ29uZmlnT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKTsKCiAgICBpZiAoICRTdGF0e1N0YXRUeXBlfSBlcSAnZHluYW1pYycgKSB7CgogICAgICAgICMgc2F2ZSB0aGUgc2VsZWN0ZWQgeCBheGlzIHRpbWUgc2NhbGUgdmFsdWUgZm9yIHNvbWUgY2hlY2tzIGZvciB0aGUgeSBheGlzCiAgICAgICAgbXkgJFNlbGVjdGVkWEF4aXNUaW1lU2NhbGVWYWx1ZTsKCiAgICAgICAgIyBYIEF4aXMKICAgICAgICB7CiAgICAgICAgICAgIG15ICRGbGFnID0gMDsKICAgICAgICAgICAgWFZBTFVFOgogICAgICAgICAgICBmb3IgbXkgJFh2YWx1ZSAoIEB7ICRTdGF0e1VzZUFzWHZhbHVlfSB9ICkgewogICAgICAgICAgICAgICAgbmV4dCBYVkFMVUUgaWYgISRYdmFsdWUtPntTZWxlY3RlZH07CgogICAgICAgICAgICAgICAgaWYgKCAkWHZhbHVlLT57QmxvY2t9IGVxICdUaW1lJyApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoICRYdmFsdWUtPntUaW1lU3RhcnR9ICYmICRYdmFsdWUtPntUaW1lU3RvcH0gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG15ICRUaW1lU3RhcnREVE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5DcmVhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnS2VybmVsOjpTeXN0ZW06OkRhdGVUaW1lJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdFBhcmFtcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nID0+ICRYdmFsdWUtPntUaW1lU3RhcnR9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIG15ICRUaW1lU3RvcERUT2JqZWN0ID0gJEtlcm5lbDo6T00tPkNyZWF0ZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdLZXJuZWw6OlN5c3RlbTo6RGF0ZVRpbWUnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0UGFyYW1zID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdHJpbmcgPT4gJFh2YWx1ZS0+e1RpbWVTdG9wfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoICEkVGltZVN0YXJ0RFRPYmplY3QgfHwgISRUaW1lU3RvcERUT2JqZWN0ICkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFhBeGlzRmllbGRFcnJvcnN7ICRYdmFsdWUtPntFbGVtZW50fSB9ID0gVHJhbnNsYXRhYmxlKCdUaGUgc2VsZWN0ZWQgZGF0ZSBpcyBub3QgdmFsaWQuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzaWYgKCAkVGltZVN0YXJ0RFRPYmplY3QgPiAkVGltZVN0b3BEVE9iamVjdCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRYQXhpc0ZpZWxkRXJyb3JzeyAkWHZhbHVlLT57RWxlbWVudH0gfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID0gVHJhbnNsYXRhYmxlKCdUaGUgc2VsZWN0ZWQgZW5kIHRpbWUgaXMgYmVmb3JlIHRoZSBzdGFydCB0aW1lLicpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2lmICgKICAgICAgICAgICAgICAgICAgICAgICAgISRYdmFsdWUtPntUaW1lUmVsYXRpdmVVbml0fQogICAgICAgICAgICAgICAgICAgICAgICB8fCAoICEkWHZhbHVlLT57VGltZVJlbGF0aXZlQ291bnR9ICYmICEkWHZhbHVlLT57VGltZVJlbGF0aXZlVXBjb21pbmdDb3VudH0gKQogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAkWEF4aXNGaWVsZEVycm9yc3sgJFh2YWx1ZS0+e0VsZW1lbnR9IH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgID0gVHJhbnNsYXRhYmxlKCdUaGVyZSBpcyBzb21ldGhpbmcgd3Jvbmcgd2l0aCB5b3VyIHRpbWUgc2VsZWN0aW9uLicpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKCAhJFh2YWx1ZS0+e1NlbGVjdGVkVmFsdWVzfVswXSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFhBeGlzRmllbGRFcnJvcnN7ICRYdmFsdWUtPntFbGVtZW50fSB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA9IFRyYW5zbGF0YWJsZSgnVGhlcmUgaXMgc29tZXRoaW5nIHdyb25nIHdpdGggeW91ciB0aW1lIHNlbGVjdGlvbi4nKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzaWYgKCAkWHZhbHVlLT57Rml4ZWR9ICYmICQjeyAkWHZhbHVlLT57U2VsZWN0ZWRWYWx1ZXN9IH0gPiAwICkgewogICAgICAgICAgICAgICAgICAgICAgICAkWEF4aXNGaWVsZEVycm9yc3sgJFh2YWx1ZS0+e0VsZW1lbnR9IH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgID0gVHJhbnNsYXRhYmxlKCdUaGVyZSBpcyBzb21ldGhpbmcgd3Jvbmcgd2l0aCB5b3VyIHRpbWUgc2VsZWN0aW9uLicpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFNlbGVjdGVkWEF4aXNUaW1lU2NhbGVWYWx1ZSA9ICRYdmFsdWUtPntTZWxlY3RlZFZhbHVlc31bMF07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzaWYgKCAkWHZhbHVlLT57QmxvY2t9IGVxICdTZWxlY3RGaWVsZCcgKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCAkWHZhbHVlLT57Rml4ZWR9ICYmICQjeyAkWHZhbHVlLT57U2VsZWN0ZWRWYWx1ZXN9IH0gPiAwICkgewogICAgICAgICAgICAgICAgICAgICAgICAkWEF4aXNGaWVsZEVycm9yc3sgJFh2YWx1ZS0+e0VsZW1lbnR9IH0gPSBUcmFuc2xhdGFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnUGxlYXNlIHNlbGVjdCBvbmx5IG9uZSBlbGVtZW50IG9yIGFsbG93IG1vZGlmaWNhdGlvbiBhdCBzdGF0IGdlbmVyYXRpb24gdGltZS4nCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2lmICggJFh2YWx1ZS0+e0ZpeGVkfSAmJiAhJFh2YWx1ZS0+e1NlbGVjdGVkVmFsdWVzfVswXSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFhBeGlzRmllbGRFcnJvcnN7ICRYdmFsdWUtPntFbGVtZW50fSB9ID0gVHJhbnNsYXRhYmxlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1BsZWFzZSBzZWxlY3QgYXQgbGVhc3Qgb25lIHZhbHVlIG9mIHRoaXMgZmllbGQgb3IgYWxsb3cgbW9kaWZpY2F0aW9uIGF0IHN0YXQgZ2VuZXJhdGlvbiB0aW1lLicKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJEZsYWcgPSAxOwogICAgICAgICAgICAgICAgbGFzdCBYVkFMVUU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCAhJEZsYWcgKSB7CiAgICAgICAgICAgICAgICBwdXNoIEBYQXhpc0dlbmVyYWxFcnJvcnMsIFRyYW5zbGF0YWJsZSgnUGxlYXNlIHNlbGVjdCBvbmUgZWxlbWVudCBmb3IgdGhlIFgtYXhpcy4nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBZIEF4aXMKICAgICAgICB7CiAgICAgICAgICAgIG15ICRDb3VudGVyICA9IDA7CiAgICAgICAgICAgIG15ICRUaW1lVXNlZCA9IDA7CiAgICAgICAgICAgIFZBTFVFU0VSSUVTOgogICAgICAgICAgICBmb3IgbXkgJFZhbHVlU2VyaWVzICggQHsgJFN0YXR7VXNlQXNWYWx1ZVNlcmllc30gfSApIHsKICAgICAgICAgICAgICAgIG5leHQgVkFMVUVTRVJJRVMgaWYgISRWYWx1ZVNlcmllcy0+e1NlbGVjdGVkfTsKCiAgICAgICAgICAgICAgICBpZiAoICRWYWx1ZVNlcmllcy0+e0Jsb2NrfSBlcSAnVGltZScgfHwgJFZhbHVlU2VyaWVzLT57QmxvY2t9IGVxICdUaW1lRXh0ZW5kZWQnICkgewogICAgICAgICAgICAgICAgICAgIGlmICggJFZhbHVlU2VyaWVzLT57Rml4ZWR9ICYmICQjeyAkVmFsdWVTZXJpZXMtPntTZWxlY3RlZFZhbHVlc30gfSA+IDAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRZQXhpc0ZpZWxkRXJyb3JzeyAkVmFsdWVTZXJpZXMtPntFbGVtZW50fSB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA9IFRyYW5zbGF0YWJsZSgnVGhlcmUgaXMgc29tZXRoaW5nIHdyb25nIHdpdGggeW91ciB0aW1lIHNlbGVjdGlvbi4nKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzaWYgKCAhJFZhbHVlU2VyaWVzLT57U2VsZWN0ZWRWYWx1ZXN9WzBdICkgewogICAgICAgICAgICAgICAgICAgICAgICAkWUF4aXNGaWVsZEVycm9yc3sgJFZhbHVlU2VyaWVzLT57RWxlbWVudH0gfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPSBUcmFuc2xhdGFibGUoJ1RoZXJlIGlzIHNvbWV0aGluZyB3cm9uZyB3aXRoIHlvdXIgdGltZSBzZWxlY3Rpb24uJyk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBteSAkVGltZVNjYWxlID0gJFNlbGYtPl9UaW1lU2NhbGUoCiAgICAgICAgICAgICAgICAgICAgICAgIFNlbGVjdGVkWEF4aXNWYWx1ZSA9PiAkU2VsZWN0ZWRYQXhpc1RpbWVTY2FsZVZhbHVlLAogICAgICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgICAgIGlmICggIUlzSGFzaFJlZldpdGhEYXRhKCRUaW1lU2NhbGUpICkgewogICAgICAgICAgICAgICAgICAgICAgICAkWUF4aXNGaWVsZEVycm9yc3sgJFZhbHVlU2VyaWVzLT57RWxlbWVudH0gfSA9IFRyYW5zbGF0YWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdObyB0aW1lIHNjYWxlIHZhbHVlIGF2YWlsYWJsZSBmb3IgdGhlIGN1cnJlbnQgc2VsZWN0ZWQgdGltZSBzY2FsZSB2YWx1ZSBvbiB0aGUgWCBheGlzLicKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICRUaW1lVXNlZCsrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzaWYgKCAkVmFsdWVTZXJpZXMtPntCbG9ja30gZXEgJ1NlbGVjdEZpZWxkJyApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoICRWYWx1ZVNlcmllcy0+e0ZpeGVkfSAmJiAkI3sgJFZhbHVlU2VyaWVzLT57U2VsZWN0ZWRWYWx1ZXN9IH0gPiAwICkgewogICAgICAgICAgICAgICAgICAgICAgICAkWUF4aXNGaWVsZEVycm9yc3sgJFZhbHVlU2VyaWVzLT57RWxlbWVudH0gfSA9IFRyYW5zbGF0YWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdQbGVhc2Ugc2VsZWN0IG9ubHkgb25lIGVsZW1lbnQgb3IgYWxsb3cgbW9kaWZpY2F0aW9uIGF0IHN0YXQgZ2VuZXJhdGlvbiB0aW1lLicKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzaWYgKCAkVmFsdWVTZXJpZXMtPntGaXhlZH0gJiYgISRWYWx1ZVNlcmllcy0+e1NlbGVjdGVkVmFsdWVzfVswXSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFlBeGlzRmllbGRFcnJvcnN7ICRWYWx1ZVNlcmllcy0+e0VsZW1lbnR9IH0gPSBUcmFuc2xhdGFibGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnUGxlYXNlIHNlbGVjdCBhdCBsZWFzdCBvbmUgdmFsdWUgb2YgdGhpcyBmaWVsZCBvciBhbGxvdyBtb2RpZmljYXRpb24gYXQgc3RhdCBnZW5lcmF0aW9uIHRpbWUuJwogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkQ291bnRlcisrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoICRDb3VudGVyID4gMSAmJiAkVGltZVVzZWQgKSB7CiAgICAgICAgICAgICAgICBwdXNoIEBZQXhpc0dlbmVyYWxFcnJvcnMsIFRyYW5zbGF0YWJsZSgnWW91IGNhbiBvbmx5IHVzZSBvbmUgdGltZSBlbGVtZW50IGZvciB0aGUgWSBheGlzLicpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2lmICggJENvdW50ZXIgPiAyICkgewogICAgICAgICAgICAgICAgcHVzaCBAWUF4aXNHZW5lcmFsRXJyb3JzLCBUcmFuc2xhdGFibGUoJ1lvdSBjYW4gb25seSB1c2Ugb25lIG9yIHR3byBlbGVtZW50cyBmb3IgdGhlIFkgYXhpcy4nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBSZXN0cmljdGlvbnMKICAgICAgICB7CiAgICAgICAgICAgIFJFU1RSSUNUSU9OOgogICAgICAgICAgICBmb3IgbXkgJFJlc3RyaWN0aW9uICggQHsgJFN0YXR7VXNlQXNSZXN0cmljdGlvbn0gfSApIHsKICAgICAgICAgICAgICAgIG5leHQgUkVTVFJJQ1RJT04gaWYgISRSZXN0cmljdGlvbi0+e1NlbGVjdGVkfTsKCiAgICAgICAgICAgICAgICBpZiAoICRSZXN0cmljdGlvbi0+e0Jsb2NrfSBlcSAnU2VsZWN0RmllbGQnICkgewogICAgICAgICAgICAgICAgICAgIGlmICggJFJlc3RyaWN0aW9uLT57Rml4ZWR9ICYmICQjeyAkUmVzdHJpY3Rpb24tPntTZWxlY3RlZFZhbHVlc30gfSA+IDAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRSZXN0cmljdGlvbnNGaWVsZEVycm9yc3sgJFJlc3RyaWN0aW9uLT57RWxlbWVudH0gfSA9IFRyYW5zbGF0YWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdQbGVhc2Ugc2VsZWN0IG9ubHkgb25lIGVsZW1lbnQgb3IgYWxsb3cgbW9kaWZpY2F0aW9uIGF0IHN0YXQgZ2VuZXJhdGlvbiB0aW1lLicKICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzaWYgKCAhJFJlc3RyaWN0aW9uLT57U2VsZWN0ZWRWYWx1ZXN9WzBdICkgewogICAgICAgICAgICAgICAgICAgICAgICAkUmVzdHJpY3Rpb25zRmllbGRFcnJvcnN7ICRSZXN0cmljdGlvbi0+e0VsZW1lbnR9IH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgID0gVHJhbnNsYXRhYmxlKCdQbGVhc2Ugc2VsZWN0IGF0IGxlYXN0IG9uZSB2YWx1ZSBvZiB0aGlzIGZpZWxkLicpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2lmICggJFJlc3RyaWN0aW9uLT57QmxvY2t9IGVxICdJbnB1dEZpZWxkJyApIHsKICAgICAgICAgICAgICAgICAgICBpZiAoICEkUmVzdHJpY3Rpb24tPntTZWxlY3RlZFZhbHVlc31bMF0gJiYgJFJlc3RyaWN0aW9uLT57Rml4ZWR9ICkgewogICAgICAgICAgICAgICAgICAgICAgICAkUmVzdHJpY3Rpb25zRmllbGRFcnJvcnN7ICRSZXN0cmljdGlvbi0+e0VsZW1lbnR9IH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgID0gVHJhbnNsYXRhYmxlKCdQbGVhc2UgcHJvdmlkZSBhIHZhbHVlIG9yIGFsbG93IG1vZGlmaWNhdGlvbiBhdCBzdGF0IGdlbmVyYXRpb24gdGltZS4nKTsKICAgICAgICAgICAgICAgICAgICAgICAgbGFzdCBSRVNUUklDVElPTjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICMgU2hvdyB3YXJuaW5nIGlmIHJlc3RyaWN0aW9ucyBjb250YWluIHN0b3Agd29yZHMgd2l0aGluIHRpY2tldCBzZWFyY2guCiAgICAgICAgICAgICAgICAgICAgbXkgJVN0b3BXb3JkRmllbGRzID0gJFNlbGYtPl9TdG9wV29yZEZpZWxkc0dldCgpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoICRTdG9wV29yZEZpZWxkc3sgJFJlc3RyaWN0aW9uLT57RWxlbWVudH0gfSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgbXkgJEVycm9yTWVzc2FnZSA9ICRTZWxmLT5fU3RvcFdvcmRFcnJvckNoZWNrKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFJlc3RyaWN0aW9uLT57RWxlbWVudH0gPT4gJFJlc3RyaWN0aW9uLT57U2VsZWN0ZWRWYWx1ZXN9WzBdLAogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJEVycm9yTWVzc2FnZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgJFJlc3RyaWN0aW9uc0ZpZWxkRXJyb3JzeyAkUmVzdHJpY3Rpb24tPntFbGVtZW50fSB9ID0gJEVycm9yTWVzc2FnZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNpZiAoICRSZXN0cmljdGlvbi0+e0Jsb2NrfSBlcSAnVGltZScgfHwgJFJlc3RyaWN0aW9uLT57QmxvY2t9IGVxICdUaW1lRXh0ZW5kZWQnICkgewogICAgICAgICAgICAgICAgICAgIGlmICggJFJlc3RyaWN0aW9uLT57VGltZVN0YXJ0fSAmJiAkUmVzdHJpY3Rpb24tPntUaW1lU3RvcH0gKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG15ICRUaW1lU3RhcnREVE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5DcmVhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnS2VybmVsOjpTeXN0ZW06OkRhdGVUaW1lJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdFBhcmFtcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nID0+ICRSZXN0cmljdGlvbi0+e1RpbWVTdGFydH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICAgICAgICAgbXkgJFRpbWVTdG9wRFRPYmplY3QgPSAkS2VybmVsOjpPTS0+Q3JlYXRlKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0tlcm5lbDo6U3lzdGVtOjpEYXRlVGltZScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmplY3RQYXJhbXMgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN0cmluZyA9PiAkUmVzdHJpY3Rpb24tPntUaW1lU3RvcH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAhJFRpbWVTdGFydERUT2JqZWN0IHx8ICEkVGltZVN0b3BEVE9iamVjdCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRSZXN0cmljdGlvbnNGaWVsZEVycm9yc3sgJFJlc3RyaWN0aW9uLT57RWxlbWVudH0gfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID0gVHJhbnNsYXRhYmxlKCdUaGUgc2VsZWN0ZWQgZGF0ZSBpcyBub3QgdmFsaWQuJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzaWYgKCAkVGltZVN0YXJ0RFRPYmplY3QgPiAkVGltZVN0b3BEVE9iamVjdCApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRSZXN0cmljdGlvbnNGaWVsZEVycm9yc3sgJFJlc3RyaWN0aW9uLT57RWxlbWVudH0gfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID0gVHJhbnNsYXRhYmxlKCdUaGUgc2VsZWN0ZWQgZW5kIHRpbWUgaXMgYmVmb3JlIHRoZSBzdGFydCB0aW1lLicpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2lmICgKICAgICAgICAgICAgICAgICAgICAgICAgISRSZXN0cmljdGlvbi0+e1RpbWVSZWxhdGl2ZVVuaXR9CiAgICAgICAgICAgICAgICAgICAgICAgIHx8ICggISRSZXN0cmljdGlvbi0+e1RpbWVSZWxhdGl2ZUNvdW50fSAmJiAhJFJlc3RyaWN0aW9uLT57VGltZVJlbGF0aXZlVXBjb21pbmdDb3VudH0gKQogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAkUmVzdHJpY3Rpb25zRmllbGRFcnJvcnN7ICRSZXN0cmljdGlvbi0+e0VsZW1lbnR9IH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgID0gVHJhbnNsYXRhYmxlKCdUaGVyZSBpcyBzb21ldGhpbmcgd3Jvbmcgd2l0aCB5b3VyIHRpbWUgc2VsZWN0aW9uLicpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBDaGVjayBpZiB0aGUgdGltZXBlcmlvZCBpcyB0b28gYmlnIG9yIHRoZSB0aW1lIHNjYWxlIHRvbyBzbWFsbC4gQWxzbyBleGVjdXRlIHRoaXMgY2hlY2sgZm9yCiAgICAgICAgIyAgIG5vbi1maXhlZCB2YWx1ZXMgYmVjYXVzZSBpdCBpcyB1c2VkIGluIHByZXZpZXcgYW5kIGNyb24gc3RhdHMgZ2VuZXJhdGlvbiBtb2RlLgogICAgICAgIHsKICAgICAgICAgICAgWFZBTFVFOgogICAgICAgICAgICBmb3IgbXkgJFh2YWx1ZSAoIEB7ICRTdGF0e1VzZUFzWHZhbHVlfSB9ICkgewoKICAgICAgICAgICAgICAgIGxhc3QgWFZBTFVFIGlmIGRlZmluZWQgJFhBeGlzRmllbGRFcnJvcnN7ICRYdmFsdWUtPntFbGVtZW50fSB9OwogICAgICAgICAgICAgICAgbmV4dCBYVkFMVUUgaWYgISggJFh2YWx1ZS0+e1NlbGVjdGVkfSAmJiAkWHZhbHVlLT57QmxvY2t9IGVxICdUaW1lJyApOwoKICAgICAgICAgICAgICAgIG15ICRGbGFnID0gMTsKICAgICAgICAgICAgICAgIFZBTFVFU0VSSUVTOgogICAgICAgICAgICAgICAgZm9yIG15ICRWYWx1ZVNlcmllcyAoIEB7ICRTdGF0e1VzZUFzVmFsdWVTZXJpZXN9IH0gKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCAkVmFsdWVTZXJpZXMtPntTZWxlY3RlZH0gJiYgJFZhbHVlU2VyaWVzLT57QmxvY2t9IGVxICdUaW1lJyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJEZsYWcgPSAwOwogICAgICAgICAgICAgICAgICAgICAgICBsYXN0IFZBTFVFU0VSSUVTOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBsYXN0IFhWQUxVRSBpZiAhJEZsYWc7CgogICAgICAgICAgICAgICAgbXkgJFNjYWxlUGVyaW9kICAgICAgICA9IDA7CiAgICAgICAgICAgICAgICBteSAkVGltZVBlcmlvZCAgICAgICAgID0gMDsKICAgICAgICAgICAgICAgIG15ICRUaW1lVXBjb21pbmdQZXJpb2QgPSAwOwoKICAgICAgICAgICAgICAgIG15ICRDb3VudCA9ICRYdmFsdWUtPntUaW1lU2NhbGVDb3VudH0gPyAkWHZhbHVlLT57VGltZVNjYWxlQ291bnR9IDogMTsKCiAgICAgICAgICAgICAgICAkU2NhbGVQZXJpb2QgPSAkU2VsZi0+X1RpbWVJblNlY29uZHMoCiAgICAgICAgICAgICAgICAgICAgVGltZVVuaXQgPT4gJFh2YWx1ZS0+e1NlbGVjdGVkVmFsdWVzfVswXSwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgaWYgKCAhJFNjYWxlUGVyaW9kICkgewogICAgICAgICAgICAgICAgICAgICRYQXhpc0ZpZWxkRXJyb3JzeyAkWHZhbHVlLT57RWxlbWVudH0gfSA9IFRyYW5zbGF0YWJsZSgnUGxlYXNlIHNlbGVjdCBhIHRpbWUgc2NhbGUuJyk7CiAgICAgICAgICAgICAgICAgICAgbGFzdCBYVkFMVUU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCAkWHZhbHVlLT57VGltZVN0b3B9ICYmICRYdmFsdWUtPntUaW1lU3RhcnR9ICkgewogICAgICAgICAgICAgICAgICAgIG15ICRUaW1lU3RhcnRFcG9jaCA9ICRLZXJuZWw6Ok9NLT5DcmVhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgICdLZXJuZWw6OlN5c3RlbTo6RGF0ZVRpbWUnLAogICAgICAgICAgICAgICAgICAgICAgICBPYmplY3RQYXJhbXMgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nID0+ICRYdmFsdWUtPntUaW1lU3RhcnR9LAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICktPlRvRXBvY2goKTsKCiAgICAgICAgICAgICAgICAgICAgbXkgJFRpbWVTdG9wRXBvY2ggPSAkS2VybmVsOjpPTS0+Q3JlYXRlKAogICAgICAgICAgICAgICAgICAgICAgICAnS2VybmVsOjpTeXN0ZW06OkRhdGVUaW1lJywKICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0UGFyYW1zID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN0cmluZyA9PiAkWHZhbHVlLT57VGltZVN0b3B9LAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICktPlRvRXBvY2goKTsKCiAgICAgICAgICAgICAgICAgICAgJFRpbWVQZXJpb2QgPSAkVGltZVN0b3BFcG9jaCAtICRUaW1lU3RhcnRFcG9jaDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRUaW1lUGVyaW9kID0gJFh2YWx1ZS0+e1RpbWVSZWxhdGl2ZUNvdW50fSAqICRTZWxmLT5fVGltZUluU2Vjb25kcygKICAgICAgICAgICAgICAgICAgICAgICAgVGltZVVuaXQgPT4gJFh2YWx1ZS0+e1RpbWVSZWxhdGl2ZVVuaXR9LAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgJFRpbWVVcGNvbWluZ1BlcmlvZCA9ICRYdmFsdWUtPntUaW1lUmVsYXRpdmVVcGNvbWluZ0NvdW50fSAqICRTZWxmLT5fVGltZUluU2Vjb25kcygKICAgICAgICAgICAgICAgICAgICAgICAgVGltZVVuaXQgPT4gJFh2YWx1ZS0+e1RpbWVSZWxhdGl2ZVVuaXR9LAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbXkgJE1heEF0dHIgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ1N0YXRzOjpNYXhYYXhpc0F0dHJpYnV0ZXMnKSB8fCAxMDAwOwogICAgICAgICAgICAgICAgaWYgKCAoICRUaW1lUGVyaW9kICsgJFRpbWVVcGNvbWluZ1BlcmlvZCApIC8gKCAkU2NhbGVQZXJpb2QgKiAkQ291bnQgKSA+ICRNYXhBdHRyICkgewogICAgICAgICAgICAgICAgICAgICRYQXhpc0ZpZWxkRXJyb3JzeyAkWHZhbHVlLT57RWxlbWVudH0gfQogICAgICAgICAgICAgICAgICAgICAgICA9IFRyYW5zbGF0YWJsZSgnWW91ciByZXBvcnRpbmcgdGltZSBpbnRlcnZhbCBpcyB0b28gc21hbGwsIHBsZWFzZSB1c2UgYSBsYXJnZXIgdGltZSBzY2FsZS4nKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBsYXN0IFhWQUxVRTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBpZiAoCiAgICAgICAgISVHZW5lcmFsU3BlY2lmaWNhdGlvbkZpZWxkRXJyb3JzCiAgICAgICAgJiYgISVYQXhpc0ZpZWxkRXJyb3JzCiAgICAgICAgJiYgIUBYQXhpc0dlbmVyYWxFcnJvcnMKICAgICAgICAmJiAhJVlBeGlzRmllbGRFcnJvcnMKICAgICAgICAmJiAhQFlBeGlzR2VuZXJhbEVycm9ycwogICAgICAgICYmICElUmVzdHJpY3Rpb25zRmllbGRFcnJvcnMKICAgICAgICApCiAgICB7CiAgICAgICAgcmV0dXJuIDE7CiAgICB9CgogICAgJXsgJFBhcmFte0Vycm9yc30gfSA9ICgKICAgICAgICBHZW5lcmFsU3BlY2lmaWNhdGlvbkZpZWxkRXJyb3JzID0+IFwlR2VuZXJhbFNwZWNpZmljYXRpb25GaWVsZEVycm9ycywKICAgICAgICBYQXhpc0ZpZWxkRXJyb3JzICAgICAgICAgICAgICAgID0+IFwlWEF4aXNGaWVsZEVycm9ycywKICAgICAgICBYQXhpc0dlbmVyYWxFcnJvcnMgICAgICAgICAgICAgID0+IFxAWEF4aXNHZW5lcmFsRXJyb3JzLAogICAgICAgIFlBeGlzRmllbGRFcnJvcnMgICAgICAgICAgICAgICAgPT4gXCVZQXhpc0ZpZWxkRXJyb3JzLAogICAgICAgIFlBeGlzR2VuZXJhbEVycm9ycyAgICAgICAgICAgICAgPT4gXEBZQXhpc0dlbmVyYWxFcnJvcnMsCiAgICAgICAgUmVzdHJpY3Rpb25zRmllbGRFcnJvcnMgICAgICAgICA9PiBcJVJlc3RyaWN0aW9uc0ZpZWxkRXJyb3JzLAogICAgKTsKCiAgICByZXR1cm47Cn0KCnN1YiBfVGltZU91dHB1dCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgZGlmZnJlbnQgb3V0cHV0IHR5cGVzCiAgICBteSAlQWxsb3dlZE91dHB1dCA9ICgKICAgICAgICBFZGl0ID0+IDEsCiAgICAgICAgVmlldyA9PiAxLAogICAgKTsKCiAgICAjIGNoZWNrIGlmIHRoZSBvdXRwdXQgdHlwZSBpcyBnaXZlbiBhbmQgYWxsb3dlZAogICAgaWYgKCAhJFBhcmFte091dHB1dH0gfHwgISRBbGxvd2VkT3V0cHV0eyAkUGFyYW17T3V0cHV0fSB9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAiZXJyb3IiLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnX1RpbWVPdXRwdXQ6IE5lZWQgYWxsb3dlZCBvdXRwdXQgdHlwZSEnLAogICAgICAgICk7CiAgICB9CgogICAgIyBnZXQgbGF5b3V0IG9iamVjdAogICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKCiAgICBteSAlVGltZU91dHB1dDsKCiAgICBteSAlVGltZVNjYWxlQnVpbGRTZWxlY3Rpb24gPSAkU2VsZi0+X1RpbWVTY2FsZUJ1aWxkU2VsZWN0aW9uKCk7CgogICAgbXkgJEVsZW1lbnQgICA9ICRQYXJhbXtFbGVtZW50fTsKICAgIG15ICRFbGVtZW50SUQgPSAkRWxlbWVudDsKCiAgICAjIGFkZCB0aGUgU3RhdElEIHRvIHRoZSBFbGVtZW50SUQgZm9yIHRoZSB2aWV3IG91dHB1dAogICAgaWYgKCAkUGFyYW17T3V0cHV0fSBlcSAnVmlldycgJiYgJFBhcmFte1N0YXRJRH0gKSB7CiAgICAgICAgJEVsZW1lbnRJRCAuPSAnLScgLiAkUGFyYW17U3RhdElEfSAuICctJyAuICRQYXJhbXtPdXRwdXRDb3VudGVyfTsKICAgIH0KCiAgICBpZiAoICRQYXJhbXtVc2V9IG5lICdVc2VBc1ZhbHVlU2VyaWVzJyApIHsKCiAgICAgICAgaWYgKCAkUGFyYW17T3V0cHV0fSBlcSAnRWRpdCcgfHwgKCAkUGFyYW17VGltZVN0YXJ0fSAmJiAkUGFyYW17VGltZVN0b3B9ICkgKSB7CgogICAgICAgICAgICAjIGNoZWNrIGlmIG5lZWQgcGFyYW1zIGFyZSBhdmFpbGFibGUKICAgICAgICAgICAgaWYgKCAhJFBhcmFte1RpbWVQZXJpb2RGb3JtYXR9ICkgewogICAgICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gImVycm9yIiwKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAnX1RpbWVPdXRwdXQ6IE5lZWQgVGltZVBlcmlvZEZvcm1hdCEnLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBnZXQgdGltZQogICAgICAgICAgICBteSAkQ3VyU3lzRFREZXRhaWxzID0gJEtlcm5lbDo6T00tPkNyZWF0ZSgnS2VybmVsOjpTeXN0ZW06OkRhdGVUaW1lJyktPkdldCgpOwogICAgICAgICAgICBteSAkWWVhciAgICAgICAgICAgID0gJEN1clN5c0RURGV0YWlscy0+e1llYXJ9OwogICAgICAgICAgICBteSAlVGltZUNvbmZpZzsKCiAgICAgICAgICAgICMgZGVmYXVsdCB0aW1lIGNvbmZpZ3VyYXRpb24KICAgICAgICAgICAgJFRpbWVDb25maWd7Rm9ybWF0fSAgICAgICAgICAgICAgICAgICAgID0gJFBhcmFte1RpbWVQZXJpb2RGb3JtYXR9OwogICAgICAgICAgICAkVGltZUNvbmZpZ3tPdmVycmlkZVRpbWVab25lfSAgICAgICAgICAgPSAxOwogICAgICAgICAgICAkVGltZUNvbmZpZ3sgJEVsZW1lbnQgLiAnU3RhcnRZZWFyJyB9ICAgPSAkWWVhciAtIDE7CiAgICAgICAgICAgICRUaW1lQ29uZmlneyAkRWxlbWVudCAuICdTdGFydE1vbnRoJyB9ICA9IDE7CiAgICAgICAgICAgICRUaW1lQ29uZmlneyAkRWxlbWVudCAuICdTdGFydERheScgfSAgICA9IDE7CiAgICAgICAgICAgICRUaW1lQ29uZmlneyAkRWxlbWVudCAuICdTdGFydEhvdXInIH0gICA9IDA7CiAgICAgICAgICAgICRUaW1lQ29uZmlneyAkRWxlbWVudCAuICdTdGFydE1pbnV0ZScgfSA9IDA7CiAgICAgICAgICAgICRUaW1lQ29uZmlneyAkRWxlbWVudCAuICdTdGFydFNlY29uZCcgfSA9IDE7CiAgICAgICAgICAgICRUaW1lQ29uZmlneyAkRWxlbWVudCAuICdTdG9wWWVhcicgfSAgICA9ICRZZWFyOwogICAgICAgICAgICAkVGltZUNvbmZpZ3sgJEVsZW1lbnQgLiAnU3RvcE1vbnRoJyB9ICAgPSAxMjsKICAgICAgICAgICAgJFRpbWVDb25maWd7ICRFbGVtZW50IC4gJ1N0b3BEYXknIH0gICAgID0gMzE7CiAgICAgICAgICAgICRUaW1lQ29uZmlneyAkRWxlbWVudCAuICdTdG9wSG91cicgfSAgICA9IDIzOwogICAgICAgICAgICAkVGltZUNvbmZpZ3sgJEVsZW1lbnQgLiAnU3RvcE1pbnV0ZScgfSAgPSA1OTsKICAgICAgICAgICAgJFRpbWVDb25maWd7ICRFbGVtZW50IC4gJ1N0b3BTZWNvbmQnIH0gID0gNTk7CgogICAgICAgICAgICBmb3IgbXkgJEtleSAocXcoU3RhcnQgU3RvcCkpIHsKICAgICAgICAgICAgICAgICRUaW1lQ29uZmlne1ByZWZpeH0gPSAkRWxlbWVudCAuICRLZXk7CgogICAgICAgICAgICAgICAgIyB0aW1lIHNldHRpbmcgaWYgYXZhaWxhYmxlCiAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgJFBhcmFteyAnVGltZScgLiAkS2V5IH0KICAgICAgICAgICAgICAgICAgICAmJiAkUGFyYW17ICdUaW1lJyAuICRLZXkgfSA9fiBte14oXGRcZFxkXGQpLShcZFxkKS0oXGRcZClccyhcZFxkKTooXGRcZCk6KFxkXGQpJH14aQogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAkVGltZUNvbmZpZ3sgJEVsZW1lbnQgLiAkS2V5IC4gJ1llYXInIH0gICA9ICQxOwogICAgICAgICAgICAgICAgICAgICRUaW1lQ29uZmlneyAkRWxlbWVudCAuICRLZXkgLiAnTW9udGgnIH0gID0gJDI7CiAgICAgICAgICAgICAgICAgICAgJFRpbWVDb25maWd7ICRFbGVtZW50IC4gJEtleSAuICdEYXknIH0gICAgPSAkMzsKICAgICAgICAgICAgICAgICAgICAkVGltZUNvbmZpZ3sgJEVsZW1lbnQgLiAkS2V5IC4gJ0hvdXInIH0gICA9ICQ0OwogICAgICAgICAgICAgICAgICAgICRUaW1lQ29uZmlneyAkRWxlbWVudCAuICRLZXkgLiAnTWludXRlJyB9ID0gJDU7CiAgICAgICAgICAgICAgICAgICAgJFRpbWVDb25maWd7ICRFbGVtZW50IC4gJEtleSAuICdTZWNvbmQnIH0gPSAkNjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRUaW1lT3V0cHV0eyAnVGltZScgLiAkS2V5IH0gPSAkTGF5b3V0T2JqZWN0LT5CdWlsZERhdGVTZWxlY3Rpb24oJVRpbWVDb25maWcpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBteSAlVGltZUNvdW50RGF0YTsKICAgICAgICBmb3IgbXkgJENvdW50ZXIgKCAxIC4uIDYwICkgewogICAgICAgICAgICAkVGltZUNvdW50RGF0YXskQ291bnRlcn0gPSAkQ291bnRlcjsKICAgICAgICB9CgogICAgICAgIGlmICggJFBhcmFte1VzZX0gZXEgJ1VzZUFzWHZhbHVlJyApIHsKICAgICAgICAgICAgJFRpbWVPdXRwdXR7VGltZVNjYWxlQ291bnR9ID0gJExheW91dE9iamVjdC0+QnVpbGRTZWxlY3Rpb24oCiAgICAgICAgICAgICAgICBEYXRhICAgICAgID0+IFwlVGltZUNvdW50RGF0YSwKICAgICAgICAgICAgICAgIE5hbWUgICAgICAgPT4gJEVsZW1lbnQgLiAnVGltZVNjYWxlQ291bnQnLAogICAgICAgICAgICAgICAgSUQgICAgICAgICA9PiAkRWxlbWVudElEIC4gJy1UaW1lU2NhbGVDb3VudCcsCiAgICAgICAgICAgICAgICBTZWxlY3RlZElEID0+ICRQYXJhbXtUaW1lU2NhbGVDb3VudH0sCiAgICAgICAgICAgICAgICBTb3J0ICAgICAgID0+ICdOdW1lcmljS2V5JywKICAgICAgICAgICAgICAgIENsYXNzICAgICAgPT4gJ01vZGVybml6ZScsCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICBpZiAoICRQYXJhbXtPdXRwdXR9IGVxICdFZGl0JyB8fCAkUGFyYW17VGltZVJlbGF0aXZlVW5pdH0gKSB7CgogICAgICAgICAgICBteSBAVGltZUNvdW50TGlzdCA9IHF3KFRpbWVSZWxhdGl2ZUNvdW50IFRpbWVSZWxhdGl2ZVVwY29taW5nQ291bnQpOwoKICAgICAgICAgICAgIyBhZGQgdGhlIHplcm8gZm9yIHRoZSB0aW1lIHJlbGF0aXZlIGNvdW50IHNlbGVjdGlvbnMKICAgICAgICAgICAgJFRpbWVDb3VudERhdGF7MH0gPSAnLSc7CgogICAgICAgICAgICBmb3IgbXkgJFRpbWVDb3VudE5hbWUgKEBUaW1lQ291bnRMaXN0KSB7CgogICAgICAgICAgICAgICAgJFRpbWVPdXRwdXR7JFRpbWVDb3VudE5hbWV9ID0gJExheW91dE9iamVjdC0+QnVpbGRTZWxlY3Rpb24oCiAgICAgICAgICAgICAgICAgICAgRGF0YSAgICAgICA9PiBcJVRpbWVDb3VudERhdGEsCiAgICAgICAgICAgICAgICAgICAgTmFtZSAgICAgICA9PiAkRWxlbWVudCAuICRUaW1lQ291bnROYW1lLAogICAgICAgICAgICAgICAgICAgIElEICAgICAgICAgPT4gJEVsZW1lbnRJRCAuICctJyAuICRUaW1lQ291bnROYW1lLAogICAgICAgICAgICAgICAgICAgIFNlbGVjdGVkSUQgPT4gJFBhcmFteyRUaW1lQ291bnROYW1lfSwKICAgICAgICAgICAgICAgICAgICBTb3J0ICAgICAgID0+ICdOdW1lcmljS2V5JywKICAgICAgICAgICAgICAgICAgICBDbGFzcyAgICAgID0+ICdNb2Rlcm5pemUnLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJFRpbWVPdXRwdXR7VGltZVJlbGF0aXZlVW5pdH0gPSAkTGF5b3V0T2JqZWN0LT5CdWlsZFNlbGVjdGlvbigKICAgICAgICAgICAgICAgICVUaW1lU2NhbGVCdWlsZFNlbGVjdGlvbiwKICAgICAgICAgICAgICAgIE5hbWUgICAgICAgPT4gJEVsZW1lbnQgLiAnVGltZVJlbGF0aXZlVW5pdCcsCiAgICAgICAgICAgICAgICBJRCAgICAgICAgID0+ICRFbGVtZW50SUQgLiAnLVRpbWVSZWxhdGl2ZVVuaXQnLAogICAgICAgICAgICAgICAgQ2xhc3MgICAgICA9PiAnVGltZVJlbGF0aXZlVW5pdCcgLiAkUGFyYW17T3V0cHV0fSwKICAgICAgICAgICAgICAgIFNlbGVjdGVkSUQgPT4gJFBhcmFte1RpbWVSZWxhdGl2ZVVuaXRMb2NhbFNlbGVjdGVkVmFsdWV9IC8vICRQYXJhbXtUaW1lUmVsYXRpdmVVbml0fSAvLyAnRGF5JywKICAgICAgICAgICAgICAgIENsYXNzICAgICAgPT4gJ01vZGVybml6ZScsCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICBpZiAoICRQYXJhbXtUaW1lUmVsYXRpdmVVbml0fSApIHsKICAgICAgICAgICAgJFRpbWVPdXRwdXR7Q2hlY2tlZFJlbGF0aXZlfSA9ICdjaGVja2VkPSJjaGVja2VkIic7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkVGltZU91dHB1dHtDaGVja2VkQWJzb2x1dH0gPSAnY2hlY2tlZD0iY2hlY2tlZCInOwogICAgICAgIH0KICAgIH0KCiAgICBpZiAoICRQYXJhbXtVc2V9IG5lICdVc2VBc1Jlc3RyaWN0aW9uJyApIHsKCiAgICAgICAgaWYgKCAkUGFyYW17T3V0cHV0fSBlcSAnVmlldycgKSB7CiAgICAgICAgICAgICRUaW1lT3V0cHV0e1RpbWVTY2FsZVlBeGlzfSA9ICRTZWxmLT5fVGltZVNjYWxlWUF4aXMoKTsKICAgICAgICB9CgogICAgICAgICVUaW1lU2NhbGVCdWlsZFNlbGVjdGlvbiA9ICRTZWxmLT5fVGltZVNjYWxlQnVpbGRTZWxlY3Rpb24oCiAgICAgICAgICAgIFNlbGVjdGVkWEF4aXNWYWx1ZSA9PiAkUGFyYW17U2VsZWN0ZWRYQXhpc1ZhbHVlfSwKICAgICAgICAgICAgU29ydFJldmVyc2UgICAgICAgID0+IDEsCiAgICAgICAgKTsKCiAgICAgICAgJFRpbWVPdXRwdXR7VGltZVNjYWxlVW5pdH0gPSAkTGF5b3V0T2JqZWN0LT5CdWlsZFNlbGVjdGlvbigKICAgICAgICAgICAgJVRpbWVTY2FsZUJ1aWxkU2VsZWN0aW9uLAogICAgICAgICAgICBOYW1lICAgICAgID0+ICRFbGVtZW50LAogICAgICAgICAgICBJRCAgICAgICAgID0+ICRFbGVtZW50SUQsCiAgICAgICAgICAgIENsYXNzICAgICAgPT4gJ01vZGVybml6ZSBUaW1lU2NhbGUnIC4gJFBhcmFte091dHB1dH0sCiAgICAgICAgICAgIFNlbGVjdGVkSUQgPT4gJFBhcmFte1RpbWVTY2FsZVVuaXRMb2NhbFNlbGVjdGVkVmFsdWV9IC8vICRQYXJhbXtTZWxlY3RlZFZhbHVlc31bMF0gLy8gJ0RheScsCiAgICAgICAgKTsKICAgICAgICAkVGltZU91dHB1dHtUaW1lU2NhbGVFbGVtZW50SUR9ID0gJEVsZW1lbnRJRDsKICAgIH0KCiAgICByZXR1cm4gJVRpbWVPdXRwdXQ7Cn0KCnN1YiBfVGltZVNjYWxlQnVpbGRTZWxlY3Rpb24gewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAlVGltZVNjYWxlQnVpbGRTZWxlY3Rpb24gPSAoCiAgICAgICAgRGF0YSA9PiB7CiAgICAgICAgICAgIFNlY29uZCAgID0+IFRyYW5zbGF0YWJsZSgnc2Vjb25kKHMpJyksCiAgICAgICAgICAgIE1pbnV0ZSAgID0+IFRyYW5zbGF0YWJsZSgnbWludXRlKHMpJyksCiAgICAgICAgICAgIEhvdXIgICAgID0+IFRyYW5zbGF0YWJsZSgnaG91cihzKScpLAogICAgICAgICAgICBEYXkgICAgICA9PiBUcmFuc2xhdGFibGUoJ2RheShzKScpLAogICAgICAgICAgICBXZWVrICAgICA9PiBUcmFuc2xhdGFibGUoJ3dlZWsocyknKSwKICAgICAgICAgICAgTW9udGggICAgPT4gVHJhbnNsYXRhYmxlKCdtb250aChzKScpLAogICAgICAgICAgICBRdWFydGVyICA9PiBUcmFuc2xhdGFibGUoJ3F1YXJ0ZXIocyknKSwKICAgICAgICAgICAgSGFsZlllYXIgPT4gVHJhbnNsYXRhYmxlKCdoYWxmLXllYXIocyknKSwKICAgICAgICAgICAgWWVhciAgICAgPT4gVHJhbnNsYXRhYmxlKCd5ZWFyKHMpJyksCiAgICAgICAgfSwKICAgICAgICBTb3J0ICAgICAgICAgICA9PiAnSW5kaXZpZHVhbEtleScsCiAgICAgICAgU29ydEluZGl2aWR1YWwgPT4gWyAnU2Vjb25kJywgJ01pbnV0ZScsICdIb3VyJywgJ0RheScsICdXZWVrJywgJ01vbnRoJywgJ1F1YXJ0ZXInLCAnSGFsZlllYXInLCAnWWVhcicgXSwKICAgICk7CgogICAgIyBzcGVjaWFsIHRpbWUgc2NhbGUgaGFuZGxpbmcKICAgIGlmICggJFBhcmFte1NlbGVjdGVkVmFsdWV9IHx8ICRQYXJhbXtTZWxlY3RlZFhBeGlzVmFsdWV9ICkgewoKICAgICAgICBteSAkVGltZVNjYWxlID0gJFNlbGYtPl9UaW1lU2NhbGUoJVBhcmFtKTsKCiAgICAgICAgIyBzb3J0IHRoZSB0aW1lIHNjYWxlIHdpdGggdGhlIGRlZmluZWQgcG9zaXRpb24KICAgICAgICBteSBAVGltZVNjYWxlU29ydGVkID0gc29ydCB7ICRUaW1lU2NhbGUtPnskYX0tPntQb3NpdGlvbn0gPD0+ICRUaW1lU2NhbGUtPnskYn0tPntQb3NpdGlvbn0gfSBrZXlzICV7JFRpbWVTY2FsZX07CgogICAgICAgICMgcmV2ZXJzZSB0aGUgc29ydGluZwogICAgICAgIGlmICggJFBhcmFte1NvcnRSZXZlcnNlfSApIHsKICAgICAgICAgICAgQFRpbWVTY2FsZVNvcnRlZAogICAgICAgICAgICAgICAgPSBzb3J0IHsgJFRpbWVTY2FsZS0+eyRifS0+e1Bvc2l0aW9ufSA8PT4gJFRpbWVTY2FsZS0+eyRhfS0+e1Bvc2l0aW9ufSB9IGtleXMgJXskVGltZVNjYWxlfTsKICAgICAgICB9CgogICAgICAgIG15ICVUaW1lU2NhbGVEYXRhOwoKICAgICAgICBJVEVNOgogICAgICAgIGZvciBteSAkSXRlbSAoQFRpbWVTY2FsZVNvcnRlZCkgewogICAgICAgICAgICAkVGltZVNjYWxlRGF0YXskSXRlbX0gPSAkVGltZVNjYWxlLT57JEl0ZW19LT57VmFsdWV9OwogICAgICAgICAgICBsYXN0IElURU0gaWYgJFBhcmFte1NlbGVjdGVkVmFsdWV9ICYmICRQYXJhbXtTZWxlY3RlZFZhbHVlfSBlcSAkSXRlbTsKICAgICAgICB9CgogICAgICAgICRUaW1lU2NhbGVCdWlsZFNlbGVjdGlvbntEYXRhfSA9IFwlVGltZVNjYWxlRGF0YTsKICAgIH0KCiAgICByZXR1cm4gJVRpbWVTY2FsZUJ1aWxkU2VsZWN0aW9uOwp9CgpzdWIgX1RpbWVTY2FsZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICVUaW1lU2NhbGUgPSAoCiAgICAgICAgJ1NlY29uZCcgPT4gewogICAgICAgICAgICBQb3NpdGlvbiA9PiAxLAogICAgICAgICAgICBWYWx1ZSAgICA9PiBUcmFuc2xhdGFibGUoJ3NlY29uZChzKScpLAogICAgICAgIH0sCiAgICAgICAgJ01pbnV0ZScgPT4gewogICAgICAgICAgICBQb3NpdGlvbiA9PiAyLAogICAgICAgICAgICBWYWx1ZSAgICA9PiBUcmFuc2xhdGFibGUoJ21pbnV0ZShzKScpLAogICAgICAgIH0sCiAgICAgICAgJ0hvdXInID0+IHsKICAgICAgICAgICAgUG9zaXRpb24gPT4gMywKICAgICAgICAgICAgVmFsdWUgICAgPT4gVHJhbnNsYXRhYmxlKCdob3VyKHMpJyksCiAgICAgICAgfSwKICAgICAgICAnRGF5JyA9PiB7CiAgICAgICAgICAgIFBvc2l0aW9uID0+IDQsCiAgICAgICAgICAgIFZhbHVlICAgID0+IFRyYW5zbGF0YWJsZSgnZGF5KHMpJyksCiAgICAgICAgfSwKICAgICAgICAnV2VlaycgPT4gewogICAgICAgICAgICBQb3NpdGlvbiA9PiA1LAogICAgICAgICAgICBWYWx1ZSAgICA9PiBUcmFuc2xhdGFibGUoJ3dlZWsocyknKSwKICAgICAgICB9LAogICAgICAgICdNb250aCcgPT4gewogICAgICAgICAgICBQb3NpdGlvbiA9PiA2LAogICAgICAgICAgICBWYWx1ZSAgICA9PiBUcmFuc2xhdGFibGUoJ21vbnRoKHMpJyksCiAgICAgICAgfSwKICAgICAgICAnUXVhcnRlcicgPT4gewogICAgICAgICAgICBQb3NpdGlvbiA9PiA3LAogICAgICAgICAgICBWYWx1ZSAgICA9PiBUcmFuc2xhdGFibGUoJ3F1YXJ0ZXIocyknKSwKICAgICAgICB9LAogICAgICAgICdIYWxmWWVhcicgPT4gewogICAgICAgICAgICBQb3NpdGlvbiA9PiA4LAogICAgICAgICAgICBWYWx1ZSAgICA9PiBUcmFuc2xhdGFibGUoJ2hhbGYteWVhcihzKScpLAogICAgICAgIH0sCiAgICAgICAgJ1llYXInID0+IHsKICAgICAgICAgICAgUG9zaXRpb24gPT4gOSwKICAgICAgICAgICAgVmFsdWUgICAgPT4gVHJhbnNsYXRhYmxlKCd5ZWFyKHMpJyksCiAgICAgICAgfSwKICAgICk7CgogICAgIyBhbGxvd2VkIHkgYXhpcyB0aW1lIHNjYWxlIHZhbHVlcyBmb3IgdGhlIHNlbGVjdGVkIHggYXhpcyB0aW1lIHZhbHVlCiAgICBteSAkVGltZVNjYWxlWUF4aXMgPSAkU2VsZi0+X1RpbWVTY2FsZVlBeGlzKCk7CgogICAgaWYgKCAkUGFyYW17U2VsZWN0ZWRYQXhpc1ZhbHVlfSApIHsKCiAgICAgICAgaWYgKCBJc0FycmF5UmVmV2l0aERhdGEoICRUaW1lU2NhbGVZQXhpcy0+eyAkUGFyYW17U2VsZWN0ZWRYQXhpc1ZhbHVlfSB9ICkgKSB7CiAgICAgICAgICAgICVUaW1lU2NhbGUKICAgICAgICAgICAgICAgID0gbWFwIHsgJF8tPntLZXl9ID0+ICRUaW1lU2NhbGV7ICRfLT57S2V5fSB9IH0gQHsgJFRpbWVTY2FsZVlBeGlzLT57ICRQYXJhbXtTZWxlY3RlZFhBeGlzVmFsdWV9IH0gfTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICVUaW1lU2NhbGUgPSAoKTsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIFwlVGltZVNjYWxlOwp9CgpzdWIgX1RpbWVTY2FsZVlBeGlzIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBnZXQgbGF5b3V0IG9iamVjdAogICAgbXkgJExheW91dE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKCiAgICAjIGFsbG93ZWQgeSBheGlzIHRpbWUgc2NhbGUgdmFsdWVzIGZvciB0aGUgc2VsZWN0ZWQgeCBheGlzIHRpbWUgdmFsdWUKICAgICMgeCBheGlzIHZhbHVlID0+IFsgeSBheGlzIHZhbHVlcyBdLAogICAgbXkgJVRpbWVTY2FsZVlBeGlzID0gKAogICAgICAgICdTZWNvbmQnID0+IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgS2V5ICAgPT4gJ01pbnV0ZScsCiAgICAgICAgICAgICAgICBWYWx1ZSA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoJ21pbnV0ZShzKScpLAogICAgICAgICAgICB9LAogICAgICAgIF0sCiAgICAgICAgJ01pbnV0ZScgPT4gWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBLZXkgICA9PiAnSG91cicsCiAgICAgICAgICAgICAgICBWYWx1ZSA9PiAkTGF5b3V0T2JqZWN0LT57TGFuZ3VhZ2VPYmplY3R9LT5UcmFuc2xhdGUoJ2hvdXIocyknKSwKICAgICAgICAgICAgfSwKICAgICAgICBdLAogICAgICAgICdIb3VyJyA9PiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIEtleSAgID0+ICdEYXknLAogICAgICAgICAgICAgICAgVmFsdWUgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCdkYXkocyknKSwKICAgICAgICAgICAgfSwKICAgICAgICBdLAogICAgICAgICdEYXknID0+IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgS2V5ICAgPT4gJ01vbnRoJywKICAgICAgICAgICAgICAgIFZhbHVlID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgnbW9udGgocyknKSwKICAgICAgICAgICAgfSwKICAgICAgICBdLAogICAgICAgICdXZWVrJyA9PiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIEtleSAgID0+ICdXZWVrJywKICAgICAgICAgICAgICAgIFZhbHVlID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgnd2VlayhzKScpLAogICAgICAgICAgICB9LAogICAgICAgIF0sCiAgICAgICAgJ01vbnRoJyA9PiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIEtleSAgID0+ICdZZWFyJywKICAgICAgICAgICAgICAgIFZhbHVlID0+ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgneWVhcihzKScpLAogICAgICAgICAgICB9LAogICAgICAgIF0sCiAgICAgICAgJ1F1YXJ0ZXInID0+IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgS2V5ICAgPT4gJ1llYXInLAogICAgICAgICAgICAgICAgVmFsdWUgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCd5ZWFyKHMpJyksCiAgICAgICAgICAgIH0sCiAgICAgICAgXSwKICAgICAgICAnSGFsZlllYXInID0+IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgS2V5ICAgPT4gJ1llYXInLAogICAgICAgICAgICAgICAgVmFsdWUgPT4gJExheW91dE9iamVjdC0+e0xhbmd1YWdlT2JqZWN0fS0+VHJhbnNsYXRlKCd5ZWFyKHMpJyksCiAgICAgICAgICAgIH0sCiAgICAgICAgXSwKICAgICk7CgogICAgcmV0dXJuIFwlVGltZVNjYWxlWUF4aXM7Cn0KCnN1YiBfR2V0VmFsaWRUaW1lWm9uZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIHJldHVybiBpZiAhJFBhcmFte1RpbWVab25lfTsKCiAgICAjIFJldHVybiBwYXNzZWQgdGltZSB6b25lIG9ubHkgaWYgaXQgaXMgdmFsaWQuIEl0IGNhbiBoYXBwZW4gdGltZSB6b25lIGlzIHN0aWxsIGFuIG9sZC1zdHlsZSBvZmZzZXQuCiAgICAjICAgUGxlYXNlIHNlZSBidWcjMTMzNzMgZm9yIG1vcmUgaW5mb3JtYXRpb24uCiAgICByZXR1cm4gJFBhcmFte1RpbWVab25lfSBpZiBLZXJuZWw6OlN5c3RlbTo6RGF0ZVRpbWUtPklzVGltZVpvbmVWYWxpZCggVGltZVpvbmUgPT4gJFBhcmFte1RpbWVab25lfSApOwoKICAgIHJldHVybjsKfQoKc3ViIF9UaW1lWm9uZUJ1aWxkU2VsZWN0aW9uIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJFRpbWVab25lcyA9IEtlcm5lbDo6U3lzdGVtOjpEYXRlVGltZS0+VGltZVpvbmVMaXN0KAogICAgICAgIEluY2x1ZGVUaW1lWm9uZSA9PiAkUGFyYW17SW5jbHVkZVRpbWVab25lfSwKICAgICk7CgogICAgbXkgJVRpbWVab25lQnVpbGRTZWxlY3Rpb24gPSAoCiAgICAgICAgRGF0YSA9PiB7IG1hcCB7ICRfID0+ICRfIH0gQHskVGltZVpvbmVzfSB9LAogICAgKTsKCiAgICByZXR1cm4gJVRpbWVab25lQnVpbGRTZWxlY3Rpb247Cn0KCiMgQVRURU5USU9OOiB0aGlzIGZ1bmN0aW9uIGRlbGl2ZXJzIG9ubHkgYXBwcm94aW1hdGlvbnMhISEKc3ViIF9UaW1lSW5TZWNvbmRzIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBpZiBuZWVkIHBhcmFtcyBhcmUgYXZhaWxhYmxlCiAgICBpZiAoICEkUGFyYW17VGltZVVuaXR9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAiZXJyb3IiLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnX1RpbWVJblNlY29uZHM6IE5lZWQgVGltZVVuaXQhJywKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBteSAlVGltZUluU2Vjb25kcyA9ICgKICAgICAgICBZZWFyICAgICA9PiA2MCAqIDYwICogMjQgKiAzNjUsCiAgICAgICAgSGFsZlllYXIgPT4gNjAgKiA2MCAqIDI0ICogMTgyLAogICAgICAgIFF1YXJ0ZXIgID0+IDYwICogNjAgKiAyNCAqIDkxLAogICAgICAgIE1vbnRoICAgID0+IDYwICogNjAgKiAyNCAqIDMwLAogICAgICAgIFdlZWsgICAgID0+IDYwICogNjAgKiAyNCAqIDcsCiAgICAgICAgRGF5ICAgICAgPT4gNjAgKiA2MCAqIDI0LAogICAgICAgIEhvdXIgICAgID0+IDYwICogNjAsCiAgICAgICAgTWludXRlICAgPT4gNjAsCiAgICAgICAgU2Vjb25kICAgPT4gMSwKICAgICk7CgogICAgcmV0dXJuICRUaW1lSW5TZWNvbmRzeyAkUGFyYW17VGltZVVuaXR9IH07Cn0KCnN1YiBfR2V0U2VsZWN0ZWRYQXhpc1RpbWVTY2FsZVZhbHVlIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJFNlbGVjdGVkWEF4aXNUaW1lU2NhbGVWYWx1ZTsKCiAgICBmb3IgbXkgJEtleSAoIEB7ICRQYXJhbXtTdGF0fS0+e1VzZUFzWHZhbHVlfSB9ICkgewoKICAgICAgICBpZiAoICRLZXktPntTZWxlY3RlZH0gJiYgJEtleS0+e0Jsb2NrfSBlcSAnVGltZScgKSB7CiAgICAgICAgICAgICRTZWxlY3RlZFhBeGlzVGltZVNjYWxlVmFsdWUgPSAkS2V5LT57U2VsZWN0ZWRWYWx1ZXN9WzBdOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gJFNlbGVjdGVkWEF4aXNUaW1lU2NhbGVWYWx1ZTsKfQoKc3ViIF9TdG9wV29yZEVycm9yQ2hlY2sgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkTGF5b3V0T2JqZWN0ICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6T3V0cHV0OjpIVE1MOjpMYXlvdXQnKTsKICAgIG15ICRBcnRpY2xlT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpY2tldDo6QXJ0aWNsZScpOwoKICAgIGlmICggISVQYXJhbSApIHsKICAgICAgICAkTGF5b3V0T2JqZWN0LT5GYXRhbEVycm9yKAogICAgICAgICAgICBNZXNzYWdlID0+IFRyYW5zbGF0YWJsZSgnR290IG5vIHZhbHVlcyB0byBjaGVjay4nKSwKICAgICAgICApOwogICAgfQoKICAgIG15ICVTdG9wV29yZHNTZXJ2ZXJFcnJvcnM7CiAgICBpZiAoICEkQXJ0aWNsZU9iamVjdC0+U2VhcmNoU3RyaW5nU3RvcFdvcmRzVXNhZ2VXYXJuaW5nQWN0aXZlKCkgKSB7CiAgICAgICAgcmV0dXJuICVTdG9wV29yZHNTZXJ2ZXJFcnJvcnM7CiAgICB9CgogICAgbXkgJVNlYXJjaFN0cmluZ3M7CgogICAgRklFTEQ6CiAgICBmb3IgbXkgJEZpZWxkICggc29ydCBrZXlzICVQYXJhbSApIHsKICAgICAgICBuZXh0IEZJRUxEIGlmICFkZWZpbmVkICRQYXJhbXskRmllbGR9OwogICAgICAgIG5leHQgRklFTEQgaWYgIWxlbmd0aCAkUGFyYW17JEZpZWxkfTsKCiAgICAgICAgJFNlYXJjaFN0cmluZ3N7JEZpZWxkfSA9ICRQYXJhbXskRmllbGR9OwogICAgfQoKICAgIG15ICRFcnJvck1lc3NhZ2U7CgogICAgaWYgKCVTZWFyY2hTdHJpbmdzKSB7CgogICAgICAgIG15ICRTdG9wV29yZHMgPSAkQXJ0aWNsZU9iamVjdC0+U2VhcmNoU3RyaW5nU3RvcFdvcmRzRmluZCgKICAgICAgICAgICAgU2VhcmNoU3RyaW5ncyA9PiBcJVNlYXJjaFN0cmluZ3MsCiAgICAgICAgKTsKCiAgICAgICAgRklFTEQ6CiAgICAgICAgZm9yIG15ICRGaWVsZCAoIHNvcnQga2V5cyAleyRTdG9wV29yZHN9ICkgewogICAgICAgICAgICBuZXh0IEZJRUxEIGlmICFkZWZpbmVkICRTdG9wV29yZHMtPnskRmllbGR9OwogICAgICAgICAgICBuZXh0IEZJRUxEIGlmIHJlZiAkU3RvcFdvcmRzLT57JEZpZWxkfSBuZSAnQVJSQVknOwogICAgICAgICAgICBuZXh0IEZJRUxEIGlmICFAeyAkU3RvcFdvcmRzLT57JEZpZWxkfSB9OwoKICAgICAgICAgICAgJEVycm9yTWVzc2FnZSA9ICRMYXlvdXRPYmplY3QtPntMYW5ndWFnZU9iamVjdH0tPlRyYW5zbGF0ZSgKICAgICAgICAgICAgICAgICdQbGVhc2UgcmVtb3ZlIHRoZSBmb2xsb3dpbmcgd29yZHMgYmVjYXVzZSB0aGV5IGNhbm5vdCBiZSB1c2VkIGZvciB0aGUgdGlja2V0IHJlc3RyaWN0aW9uczogJXMuJywKICAgICAgICAgICAgICAgIGpvaW4oICcsJywgc29ydCBAeyAkU3RvcFdvcmRzLT57JEZpZWxkfSB9ICksCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiAkRXJyb3JNZXNzYWdlOwp9CgpzdWIgX1N0b3BXb3JkRmllbGRzR2V0IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgaWYgKCAhJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlRpY2tldDo6QXJ0aWNsZScpLT5TZWFyY2hTdHJpbmdTdG9wV29yZHNVc2FnZVdhcm5pbmdBY3RpdmUoKSApIHsKICAgICAgICByZXR1cm4gKCk7CiAgICB9CgogICAgbXkgJVN0b3BXb3JkRmllbGRzID0gKAogICAgICAgICdNSU1FX0Zyb20nICAgID0+IDEsCiAgICAgICAgJ01JTUVfVG8nICAgICAgPT4gMSwKICAgICAgICAnTUlNRV9DYycgICAgICA9PiAxLAogICAgICAgICdNSU1FX1N1YmplY3QnID0+IDEsCiAgICAgICAgJ01JTUVfQm9keScgICAgPT4gMSwKICAgICk7CgogICAgcmV0dXJuICVTdG9wV29yZEZpZWxkczsKfQoKMTsKCj1oZWFkMSBURVJNUyBBTkQgQ09ORElUSU9OUwoKVGhpcyBzb2Z0d2FyZSBpcyBwYXJ0IG9mIHRoZSBPVFJTIHByb2plY3QgKEw8aHR0cHM6Ly9vdHJzLm9yZy8+KS4KClRoaXMgc29mdHdhcmUgY29tZXMgd2l0aCBBQlNPTFVURUxZIE5PIFdBUlJBTlRZLiBGb3IgZGV0YWlscywgc2VlCnRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEdQTCkuIElmIHlvdQpkaWQgbm90IHJlY2VpdmUgdGhpcyBmaWxlLCBzZWUgTDxodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0Pi4KCj1jdXQK</File>
        <File Location="Custom/Kernel/System/Console/Command/Admin/CustomerUser/SetPassword.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxLTIwMjIgWm51bnkgR21iSCwgaHR0cHM6Ly96bnVueS5vcmcvCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6U3lzdGVtOjpDb25zb2xlOjpDb21tYW5kOjpBZG1pbjo6Q3VzdG9tZXJVc2VyOjpTZXRQYXNzd29yZDsKCnVzZSBzdHJpY3Q7CnVzZSB3YXJuaW5nczsKCnVzZSBwYXJlbnQgcXcoS2VybmVsOjpTeXN0ZW06OkNvbnNvbGU6OkJhc2VDb21tYW5kKTsKCm91ciBAT2JqZWN0RGVwZW5kZW5jaWVzID0gKAogICAgJ0tlcm5lbDo6U3lzdGVtOjpDdXN0b21lclVzZXInLAopOwoKc3ViIENvbmZpZ3VyZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICRTZWxmLT5EZXNjcmlwdGlvbignVXBkYXRlIHRoZSBwYXNzd29yZCBmb3IgYSBjdXN0b21lciB1c2VyLicpOwogICAgJFNlbGYtPkFkZEFyZ3VtZW50KAogICAgICAgIE5hbWUgICAgICAgID0+ICd1c2VyJywKICAgICAgICBEZXNjcmlwdGlvbiA9PiAiU3BlY2lmeSB0aGUgdXNlciBsb2dpbiBvZiB0aGUgYWdlbnQvY3VzdG9tZXIgdG8gYmUgdXBkYXRlZC4iLAogICAgICAgIFJlcXVpcmVkICAgID0+IDEsCiAgICAgICAgVmFsdWVSZWdleCAgPT4gcXIvLiovc214LAogICAgKTsKICAgICRTZWxmLT5BZGRBcmd1bWVudCgKICAgICAgICBOYW1lICAgICAgICA9PiAncGFzc3dvcmQnLAogICAgICAgIERlc2NyaXB0aW9uID0+ICJTZXQgYSBuZXcgcGFzc3dvcmQgZm9yIHRoZSB1c2VyIChhIHBhc3N3b3JkIHdpbGwgYmUgZ2VuZXJhdGVkIG90aGVyd2lzZSkuIiwKICAgICAgICBSZXF1aXJlZCAgICA9PiAwLAogICAgICAgIFZhbHVlUmVnZXggID0+IHFyLy4qL3NteCwKICAgICk7CgogICAgcmV0dXJuOwp9CgpzdWIgUnVuIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJExvZ2luID0gJFNlbGYtPkdldEFyZ3VtZW50KCd1c2VyJyk7CgogICAgJFNlbGYtPlByaW50KCI8eWVsbG93PlNldHRpbmcgcGFzc3dvcmQgZm9yIHVzZXIgJExvZ2luLi4uPC95ZWxsb3c+XG4iKTsKCiAgICBteSAkQ3VzdG9tZXJVc2VyT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyVXNlcicpOwogICAgbXkgJUN1c3RvbWVyVXNlckxpc3QgICA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyU2VhcmNoKAogICAgICAgIFVzZXJMb2dpbiA9PiAkTG9naW4sCiAgICAgICAgVXNlcklEID0+IDEsCiAgICApOwoKICAgIGlmICggIXNjYWxhciAlQ3VzdG9tZXJVc2VyTGlzdCApIHsKICAgICAgICAkU2VsZi0+UHJpbnRFcnJvcigiTm8gY3VzdG9tZXIgdXNlciBmb3VuZCB3aXRoIGxvZ2luICckTG9naW4nIVxuIik7CiAgICAgICAgcmV0dXJuICRTZWxmLT5FeGl0Q29kZUVycm9yKCk7CiAgICB9CgogICAgIyBpZiBubyBwYXNzd29yZCBoYXMgYmVlbiBwcm92aWRlZCwgZ2VuZXJhdGUgb25lCiAgICBteSAkUGFzc3dvcmQgPSAkU2VsZi0+R2V0QXJndW1lbnQoJ3Bhc3N3b3JkJyk7CiAgICBpZiAoICEkUGFzc3dvcmQgKSB7CiAgICAgICAgJFBhc3N3b3JkID0gJEN1c3RvbWVyVXNlck9iamVjdC0+R2VuZXJhdGVSYW5kb21QYXNzd29yZCggU2l6ZSA9PiAxMiApOwogICAgICAgICRTZWxmLT5QcmludCgiPHllbGxvdz5HZW5lcmF0ZWQgcGFzc3dvcmQgJyRQYXNzd29yZCcuPC95ZWxsb3c+XG4iKTsKICAgIH0KCiAgICBteSAkUmVzdWx0ID0gJEN1c3RvbWVyVXNlck9iamVjdC0+U2V0UGFzc3dvcmQoCiAgICAgICAgVXNlckxvZ2luID0+ICRMb2dpbiwKICAgICAgICBQVyAgICAgICAgPT4gJFBhc3N3b3JkLAogICAgKTsKCiAgICBpZiAoICEkUmVzdWx0ICkgewogICAgICAgICRTZWxmLT5QcmludEVycm9yKCJGYWlsZWQgdG8gc2V0IHBhc3N3b3JkIVxuIik7CiAgICAgICAgcmV0dXJuICRTZWxmLT5FeGl0Q29kZUVycm9yKCk7CiAgICB9CgogICAgJFNlbGYtPlByaW50KCI8Z3JlZW4+U3VjY2Vzc2Z1bGx5IHNldCBwYXNzd29yZCBmb3IgY3VzdG9tZXIgdXNlciAnJExvZ2luJy48L2dyZWVuPlxuIik7CiAgICByZXR1cm4gJFNlbGYtPkV4aXRDb2RlT2soKTsKfQoKMTsK</File>
        <File Location="Custom/Kernel/System/Console/Command/Maint/SMIME/CustomerCertificate/Fetch.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxLTIwMjIgWm51bnkgR21iSCwgaHR0cHM6Ly96bnVueS5vcmcvCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6U3lzdGVtOjpDb25zb2xlOjpDb21tYW5kOjpNYWludDo6U01JTUU6OkN1c3RvbWVyQ2VydGlmaWNhdGU6OkZldGNoOwoKdXNlIHN0cmljdDsKdXNlIHdhcm5pbmdzOwoKdXNlIHBhcmVudCBxdyhLZXJuZWw6OlN5c3RlbTo6Q29uc29sZTo6QmFzZUNvbW1hbmQpOwoKb3VyIEBPYmplY3REZXBlbmRlbmNpZXMgPSAoCiAgICAnS2VybmVsOjpDb25maWcnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpDaGVja0l0ZW0nLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpDcnlwdDo6U01JTUUnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpDdXN0b21lclVzZXInLAopOwoKc3ViIENvbmZpZ3VyZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICRTZWxmLT5EZXNjcmlwdGlvbignRmV0Y2ggUy9NSU1FIGNlcnRpZmljYXRlcyBmcm9tIGN1c3RvbWVyIGJhY2tlbmRzLicpOwogICAgJFNlbGYtPkFkZE9wdGlvbigKICAgICAgICBOYW1lID0+ICdhZGQtYWxsJywKICAgICAgICBEZXNjcmlwdGlvbiA9PgogICAgICAgICAgICAiQWRkIGFsbCBmb3VuZCBjZXJ0aWZpY2F0ZXMgZnJvbSB0aGUgY3VzdG9tZXIgYmFja2VuZCBpbnRvIHRoZSBzeXN0ZW0gd2l0aGluIHRoZSBwcmVkZWZpbmVkIHNlYXJjaCBsaW1pdCBpbiBjdXN0b21lciBiYWNrZWQgKFRoaXMgb3BlcmF0aW9uIG1pZ2h0IHRha2Ugc29tZSB0aW1lKS4iLAogICAgICAgIFJlcXVpcmVkICAgPT4gMCwKICAgICAgICBIYXNWYWx1ZSAgID0+IDAsCiAgICAgICAgVmFsdWVSZWdleCA9PiBxci8uKi9zbXgsCiAgICApOwogICAgJFNlbGYtPkFkZE9wdGlvbigKICAgICAgICBOYW1lICAgICAgICA9PiAnZW1haWwnLAogICAgICAgIERlc2NyaXB0aW9uID0+ICJPbmx5IGdldCBhIGNlcnRpZmljYXRlIGZvciB0aGUgc3BlY2lmaWVkIGVtYWlsIGFkZHJlc3MuIiwKICAgICAgICBSZXF1aXJlZCAgICA9PiAwLAogICAgICAgIEhhc1ZhbHVlICAgID0+IDEsCiAgICAgICAgVmFsdWVSZWdleCAgPT4gcXIvLiovc214LAogICAgKTsKCiAgICByZXR1cm47Cn0KCnN1YiBSdW4gewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAkU2VsZi0+UHJpbnQoIjx5ZWxsb3c+RmV0Y2hpbmcgY3VzdG9tZXIgUy9NSU1FIGNlcnRpZmljYXRlcy4uLjwveWVsbG93PlxuIik7CgogICAgbXkgJENvbmZpZ09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CgogICAgbXkgJFN0b3BFeGVjdXRpb247CiAgICBpZiAoICEkQ29uZmlnT2JqZWN0LT5HZXQoJ1NNSU1FJykgKSB7CiAgICAgICAgJFNlbGYtPlByaW50KCInUy9NSU1FJyBpcyBub3QgYWN0aXZhdGVkIGluIFN5c0NvbmZpZywgY2FuJ3QgY29udGludWUhXG4iKTsKICAgICAgICAkU3RvcEV4ZWN1dGlvbiA9IDE7CiAgICB9CiAgICBlbHNpZiAoICEkQ29uZmlnT2JqZWN0LT5HZXQoJ1NNSU1FOjpGZXRjaEZyb21DdXN0b21lcicpICkgewogICAgICAgICRTZWxmLT5QcmludCgiJ1NNSU1FOjpGZXRjaEZyb21DdXN0b21lcicgaXMgbm90IGFjdGl2YXRlZCBpbiBTeXNDb25maWcsIGNhbid0IGNvbnRpbnVlIVxuIik7CiAgICAgICAgJFN0b3BFeGVjdXRpb24gPSAxOwogICAgfQoKICAgIGlmICgkU3RvcEV4ZWN1dGlvbikgewogICAgICAgICRTZWxmLT5QcmludCgiXG48Z3JlZW4+RG9uZS48L2dyZWVuPlxuIik7CiAgICAgICAgcmV0dXJuICRTZWxmLT5FeGl0Q29kZU9rKCk7CiAgICB9CgogICAgbXkgJENyeXB0T2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNyeXB0OjpTTUlNRScpOwogICAgaWYgKCAhJENyeXB0T2JqZWN0ICkgewogICAgICAgICRTZWxmLT5QcmludEVycm9yKCJTL01JTUUgZW52aXJvbm1lbnQgaXMgbm90IHdvcmtpbmchXG4iKTsKICAgICAgICAkU2VsZi0+UHJpbnQoIjxyZWQ+RmFpbC48L3JlZD5cbiIpOwogICAgICAgIHJldHVybiAkU2VsZi0+RXhpdENvZGVFcnJvcigpOwogICAgfQoKICAgICMgR2V0IGNlcnRpZmljYXRlIGZvciBqdXN0IG9uZSBjdXN0b21lci4KICAgIGlmICggJFNlbGYtPkdldE9wdGlvbignZW1haWwnKSApIHsKICAgICAgICBteSAkRW1haWxBZGRyZXNzID0gJFNlbGYtPkdldE9wdGlvbignZW1haWwnKTsKCiAgICAgICAgbXkgJFZhbGlkRW1haWwgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2hlY2tJdGVtJyktPkNoZWNrRW1haWwoCiAgICAgICAgICAgIEFkZHJlc3MgPT4gJEVtYWlsQWRkcmVzcywKICAgICAgICApOwogICAgICAgIGlmICggISRWYWxpZEVtYWlsICkgewogICAgICAgICAgICAkU2VsZi0+UHJpbnRFcnJvcigiICAkRW1haWxBZGRyZXNzIE5PVCB2YWxpZCAoJFZhbGlkRW1haWwpXG4iKTsKICAgICAgICAgICAgcmV0dXJuICRTZWxmLT5FeGl0Q29kZUVycm9yKCk7CiAgICAgICAgfQoKICAgICAgICBteSBARmlsZXMgPSAkQ3J5cHRPYmplY3QtPkZldGNoRnJvbUN1c3RvbWVyKAogICAgICAgICAgICBTZWFyY2ggPT4gJEVtYWlsQWRkcmVzcywKICAgICAgICApOwoKICAgICAgICBpZiAoICFARmlsZXMgKSB7CiAgICAgICAgICAgICRTZWxmLT5QcmludCgiICBObyBuZXcgY2VydGlmaWNhdGVzIGZvdW5kLlxuIik7CiAgICAgICAgfQoKICAgICAgICBmb3IgbXkgJEZpbGVuYW1lIChARmlsZXMpIHsKICAgICAgICAgICAgbXkgJENlcnRpZmljYXRlID0gJENyeXB0T2JqZWN0LT5DZXJ0aWZpY2F0ZUdldCgKICAgICAgICAgICAgICAgIEZpbGVuYW1lID0+ICRGaWxlbmFtZSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIG15ICVDZXJ0aWZpY2F0ZUF0dHJpYnV0ZXMgPSAkQ3J5cHRPYmplY3QtPkNlcnRpZmljYXRlQXR0cmlidXRlcygKICAgICAgICAgICAgICAgIENlcnRpZmljYXRlID0+ICRDZXJ0aWZpY2F0ZSwKICAgICAgICAgICAgICAgIEZpbGVuYW1lICAgID0+ICRGaWxlbmFtZSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICRTZWxmLT5QcmludCgiICBBZGRlZCBjZXJ0aWZpY2F0ZSAkQ2VydGlmaWNhdGVBdHRyaWJ1dGVze0ZpbmdlcnByaW50fSAoPHllbGxvdz4kRmlsZW5hbWU8L3llbGxvdz4pXG4iKTsKICAgICAgICB9CgogICAgICAgICRTZWxmLT5QcmludCgiXG48Z3JlZW4+RG9uZS48L2dyZWVuPlxuIik7CiAgICAgICAgcmV0dXJuICRTZWxmLT5FeGl0Q29kZU9rKCk7CiAgICB9CgogICAgbXkgKCAkTGlzdE9mQ2VydGlmaWNhdGVzLCAkRW1haWxzRnJvbUNlcnRpZmljYXRlcyApID0gJFNlbGYtPl9HZXRDdXJyZW50RGF0YSgpOwoKICAgIG15ICRDdXN0b21lclVzZXJPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q3VzdG9tZXJVc2VyJyk7CgogICAgIyBDaGVjayBjdXN0b21lciB1c2VyIGZvciBVc2VyU01JTUVDZXJ0aWZpY2F0ZSBwcm9wZXJ0eSAoTGltaXQgPSBDdXN0b21lclVzZXJTZWFyY2hMaXN0TGltaXQgZnJvbSBjdXN0b21lciBiYWNrZW5kKQogICAgbXkgJUN1c3RvbWVyVXNlcnMgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclNlYXJjaCgKICAgICAgICBQb3N0TWFzdGVyU2VhcmNoID0+ICcqJywKICAgICAgICBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9LAogICAgKTsKCiAgICBMT0dJTjoKICAgIGZvciBteSAkTG9naW4gKCBzb3J0IGtleXMgJUN1c3RvbWVyVXNlcnMgKSB7CiAgICAgICAgbXkgJUN1c3RvbWVyVXNlciA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyVXNlckRhdGFHZXQoCiAgICAgICAgICAgIFVzZXIgPT4gJExvZ2luLAogICAgICAgICk7CgogICAgICAgIG5leHQgTE9HSU4gaWYgISRDdXN0b21lclVzZXJ7VXNlclNNSU1FQ2VydGlmaWNhdGV9OwoKICAgICAgICAkU2VsZi0+UHJpbnQoIiAgU2VhcmNoaW5nIFMvTUlNRSBjZXJ0aWZpY2F0ZXMgZm9yIDx5ZWxsb3c+JExvZ2luPC95ZWxsb3c+Li4uIik7CgogICAgICAgIGlmICggJExpc3RPZkNlcnRpZmljYXRlcy0+eyAkQ3VzdG9tZXJVc2Vye1VzZXJTTUlNRUNlcnRpZmljYXRlfSB9ICkgewogICAgICAgICAgICAkU2VsZi0+UHJpbnQoIiBBbHJlYWR5IGFkZGVkXG4iKTsKICAgICAgICAgICAgbmV4dCBMT0dJTjsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CgogICAgICAgICAgICBteSBARmlsZXMgPSAkQ3J5cHRPYmplY3QtPkZldGNoRnJvbUN1c3RvbWVyKAogICAgICAgICAgICAgICAgU2VhcmNoID0+ICRDdXN0b21lclVzZXJ7VXNlckVtYWlsfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGZvciBteSAkRmlsZW5hbWUgKEBGaWxlcykgewogICAgICAgICAgICAgICAgbXkgJENlcnRpZmljYXRlID0gJENyeXB0T2JqZWN0LT5DZXJ0aWZpY2F0ZUdldCgKICAgICAgICAgICAgICAgICAgICBGaWxlbmFtZSA9PiAkRmlsZW5hbWUsCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgIG15ICVDZXJ0aWZpY2F0ZUF0dHJpYnV0ZXMgPSAkQ3J5cHRPYmplY3QtPkNlcnRpZmljYXRlQXR0cmlidXRlcygKICAgICAgICAgICAgICAgICAgICBDZXJ0aWZpY2F0ZSA9PiAkQ2VydGlmaWNhdGUsCiAgICAgICAgICAgICAgICAgICAgRmlsZW5hbWUgICAgPT4gJEZpbGVuYW1lLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICRTZWxmLT5QcmludCgKICAgICAgICAgICAgICAgICAgICAiXG4gICAgQWRkZWQgY2VydGlmaWNhdGUgJENlcnRpZmljYXRlQXR0cmlidXRlc3tGaW5nZXJwcmludH0gKDx5ZWxsb3c+JEZpbGVuYW1lPC95ZWxsb3c+KVxuIgogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAkU2VsZi0+UHJpbnQoIlxuPGdyZWVuPkRvbmUuPC9ncmVlbj5cbiIpOwogICAgcmV0dXJuICRTZWxmLT5FeGl0Q29kZU9rKCk7Cn0KCnN1YiBfR2V0Q3VycmVudERhdGEgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkQ3J5cHRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q3J5cHQ6OlNNSU1FJyk7CgogICAgIyBHZXQgYWxsIGV4aXN0aW5nIGNlcnRpZmljYXRlcy4KICAgIG15IEBDZXJ0TGlzdCA9ICRDcnlwdE9iamVjdC0+Q2VydGlmaWNhdGVMaXN0KCk7CgogICAgbXkgJUxpc3RPZkNlcnRpZmljYXRlczsKICAgIG15ICVFbWFpbHNGcm9tQ2VydGlmaWNhdGVzOwoKICAgICMgQ2hlY2sgYWxsIGV4aXN0aW5nIGNlcnRpZmljYXRlcyBmb3IgZW1haWxzLgogICAgQ0VSVElGSUNBVEU6CiAgICBmb3IgbXkgJENlcnRuYW1lIChAQ2VydExpc3QpIHsKCiAgICAgICAgbXkgJENlcnRpZmljYXRlU3RyaW5nID0gJENyeXB0T2JqZWN0LT5DZXJ0aWZpY2F0ZUdldCgKICAgICAgICAgICAgRmlsZW5hbWUgPT4gJENlcnRuYW1lLAogICAgICAgICk7CgogICAgICAgIG15ICVDZXJ0aWZpY2F0ZUF0dHJpYnV0ZXMgPSAkQ3J5cHRPYmplY3QtPkNlcnRpZmljYXRlQXR0cmlidXRlcygKICAgICAgICAgICAgQ2VydGlmaWNhdGUgPT4gJENlcnRpZmljYXRlU3RyaW5nLAogICAgICAgICAgICBGaWxlbmFtZSAgICA9PiAkQ2VydG5hbWUsCiAgICAgICAgKTsKCiAgICAgICAgIyBhbGwgU01JTUUgY2VydGlmaWNhdGVzIG11c3QgaGF2ZSBhbiBFbWFpbCBBdHRyaWJ1dGUKICAgICAgICBuZXh0IENFUlRJRklDQVRFIGlmICEkQ2VydGlmaWNhdGVBdHRyaWJ1dGVze0VtYWlsfTsKCiAgICAgICAgbXkgJFZhbGlkRW1haWwgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2hlY2tJdGVtJyktPkNoZWNrRW1haWwoCiAgICAgICAgICAgIEFkZHJlc3MgPT4gJENlcnRpZmljYXRlQXR0cmlidXRlc3tFbWFpbH0sCiAgICAgICAgKTsKCiAgICAgICAgbmV4dCBDRVJUSUZJQ0FURSBpZiAhJFZhbGlkRW1haWw7CgogICAgICAgICMgUmVtZW1iZXIgY2VydGlmaWNhdGUgKGRvbid0IG5lZWQgdG8gYmUgYWRkZWQgYWdhaW4pLgogICAgICAgICRMaXN0T2ZDZXJ0aWZpY2F0ZXN7JENlcnRpZmljYXRlU3RyaW5nfSA9ICRDZXJ0aWZpY2F0ZVN0cmluZzsKCiAgICAgICAgIyBTYXZlIGVtYWlsIGZvciBjaGVja2luZyBmb3IgbmV3IGNlcnRpZmljYXRlLgogICAgICAgICRFbWFpbHNGcm9tQ2VydGlmaWNhdGVzeyAkQ2VydGlmaWNhdGVBdHRyaWJ1dGVze0VtYWlsfSB9ID0gMTsKICAgIH0KCiAgICByZXR1cm4gKCBcJUxpc3RPZkNlcnRpZmljYXRlcywgXCVFbWFpbHNGcm9tQ2VydGlmaWNhdGVzICk7Cn0KCjE7Cg==</File>
        <File Location="Custom/Kernel/System/Console/Command/Maint/SMIME/CustomerCertificate/Renew.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxLTIwMjIgWm51bnkgR21iSCwgaHR0cHM6Ly96bnVueS5vcmcvCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6U3lzdGVtOjpDb25zb2xlOjpDb21tYW5kOjpNYWludDo6U01JTUU6OkN1c3RvbWVyQ2VydGlmaWNhdGU6OlJlbmV3OwoKdXNlIHN0cmljdDsKdXNlIHdhcm5pbmdzOwoKdXNlIHBhcmVudCBxdyhLZXJuZWw6OlN5c3RlbTo6Q29uc29sZTo6QmFzZUNvbW1hbmQpOwoKb3VyIEBPYmplY3REZXBlbmRlbmNpZXMgPSAoCiAgICAnS2VybmVsOjpDb25maWcnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpDaGVja0l0ZW0nLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpDcnlwdDo6U01JTUUnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpDdXN0b21lclVzZXInLAopOwoKc3ViIENvbmZpZ3VyZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICRTZWxmLT5EZXNjcmlwdGlvbignUmVuZXcgZXhpc3RpbmcgUy9NSU1FIGNlcnRpZmljYXRlcyBmcm9tIGN1c3RvbWVyIGJhY2tlbmRzLicpOwoKICAgIHJldHVybjsKfQoKc3ViIFJ1biB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICRTZWxmLT5QcmludCgiPHllbGxvdz5SZW5ld2luZyBleGlzdGluZyBjdXN0b21lciBTL01JTUUgY2VydGlmaWNhdGVzLi4uPC95ZWxsb3c+XG4iKTsKCiAgICBteSAkQ29uZmlnT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKTsKCiAgICBteSAkU3RvcEV4ZWN1dGlvbjsKICAgIGlmICggISRDb25maWdPYmplY3QtPkdldCgnU01JTUUnKSApIHsKICAgICAgICAkU2VsZi0+UHJpbnQoIidTL01JTUUnIGlzIG5vdCBhY3RpdmF0ZWQgaW4gU3lzQ29uZmlnLCBjYW4ndCBjb250aW51ZSFcbiIpOwogICAgICAgICRTdG9wRXhlY3V0aW9uID0gMTsKICAgIH0KICAgIGVsc2lmICggISRDb25maWdPYmplY3QtPkdldCgnU01JTUU6OkZldGNoRnJvbUN1c3RvbWVyJykgKSB7CiAgICAgICAgJFNlbGYtPlByaW50KCInU01JTUU6OkZldGNoRnJvbUN1c3RvbWVyJyBpcyBub3QgYWN0aXZhdGVkIGluIFN5c0NvbmZpZywgY2FuJ3QgY29udGludWUhXG4iKTsKICAgICAgICAkU3RvcEV4ZWN1dGlvbiA9IDE7CiAgICB9CgogICAgaWYgKCRTdG9wRXhlY3V0aW9uKSB7CiAgICAgICAgJFNlbGYtPlByaW50KCJcbjxncmVlbj5Eb25lLjwvZ3JlZW4+XG4iKTsKICAgICAgICByZXR1cm4gJFNlbGYtPkV4aXRDb2RlT2soKTsKICAgIH0KCiAgICBteSAkQ3J5cHRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q3J5cHQ6OlNNSU1FJyk7CiAgICBpZiAoICEkQ3J5cHRPYmplY3QgKSB7CiAgICAgICAgJFNlbGYtPlByaW50RXJyb3IoIlMvTUlNRSBlbnZpcm9ubWVudCBpcyBub3Qgd29ya2luZyFcbiIpOwogICAgICAgICRTZWxmLT5QcmludCgiPHJlZD5GYWlsLjwvcmVkPlxuIik7CiAgICAgICAgcmV0dXJuICRTZWxmLT5FeGl0Q29kZUVycm9yKCk7CiAgICB9CgogICAgbXkgKCAkTGlzdE9mQ2VydGlmaWNhdGVzLCAkRW1haWxzRnJvbUNlcnRpZmljYXRlcyApID0gJFNlbGYtPl9HZXRDdXJyZW50RGF0YSgpOwoKICAgIG15ICRDdXN0b21lclVzZXJPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q3VzdG9tZXJVc2VyJyk7CgogICAgRU1BSUw6CiAgICBmb3IgbXkgJEVtYWlsICggc29ydCBrZXlzICV7JEVtYWlsc0Zyb21DZXJ0aWZpY2F0ZXN9ICkgewoKICAgICAgICBteSAlVXNlckxpc3QgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclNlYXJjaCgKICAgICAgICAgICAgUG9zdE1hc3RlclNlYXJjaCA9PiAkRW1haWwsCiAgICAgICAgICAgIFVzZXJJRCAgICAgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICBMaW1pdCAgICAgICAgICAgID0+IDEsCiAgICAgICAgKTsKCiAgICAgICAgbmV4dCBFTUFJTCBpZiAhJVVzZXJMaXN0OwoKICAgICAgICBteSBAVXNlckxvZ2lucyA9IHNvcnQga2V5cyAlVXNlckxpc3Q7CgogICAgICAgIG15ICVDdXN0b21lclVzZXIgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJEYXRhR2V0KAogICAgICAgICAgICBVc2VyID0+ICRVc2VyTG9naW5zWzBdLAogICAgICAgICk7CgogICAgICAgIG5leHQgRU1BSUwgaWYgISVDdXN0b21lclVzZXI7CiAgICAgICAgbmV4dCBFTUFJTCBpZiAhJEN1c3RvbWVyVXNlcntVc2VyU01JTUVDZXJ0aWZpY2F0ZX07CiAgICAgICAgbmV4dCBFTUFJTCBpZiAkTGlzdE9mQ2VydGlmaWNhdGVzLT57ICRDdXN0b21lclVzZXJ7VXNlclNNSU1FQ2VydGlmaWNhdGV9IH07CgogICAgICAgIG15IEBGaWxlcyA9ICRDcnlwdE9iamVjdC0+RmV0Y2hGcm9tQ3VzdG9tZXIoCiAgICAgICAgICAgIFNlYXJjaCA9PiAkRW1haWwsCiAgICAgICAgKTsKCiAgICAgICAgZm9yIG15ICRGaWxlbmFtZSAoQEZpbGVzKSB7CiAgICAgICAgICAgIG15ICRDZXJ0aWZpY2F0ZSA9ICRDcnlwdE9iamVjdC0+Q2VydGlmaWNhdGVHZXQoCiAgICAgICAgICAgICAgICBGaWxlbmFtZSA9PiAkRmlsZW5hbWUsCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBteSAlQ2VydGlmaWNhdGVBdHRyaWJ1dGVzID0gJENyeXB0T2JqZWN0LT5DZXJ0aWZpY2F0ZUF0dHJpYnV0ZXMoCiAgICAgICAgICAgICAgICBDZXJ0aWZpY2F0ZSA9PiAkQ2VydGlmaWNhdGUsCiAgICAgICAgICAgICAgICBGaWxlbmFtZSAgICA9PiAkRmlsZW5hbWUsCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAkU2VsZi0+UHJpbnQoIiAgRm91bmQgbmV3IFMvTUlNRSBjZXJ0aWZpY2F0ZXMgZm9yIDx5ZWxsb3c+JFVzZXJMb2dpbnNbMF08L3llbGxvdz4gLi4uXG4iKTsKICAgICAgICAgICAgJFNlbGYtPlByaW50KCIgICAgQWRkZWQgY2VydGlmaWNhdGUgJENlcnRpZmljYXRlQXR0cmlidXRlc3tGaW5nZXJwcmludH0gKDx5ZWxsb3c+JEZpbGVuYW1lPC95ZWxsb3c+KVxuIik7CiAgICAgICAgfQogICAgfQoKICAgICRTZWxmLT5QcmludCgiXG48Z3JlZW4+RG9uZS48L2dyZWVuPlxuIik7CiAgICByZXR1cm4gJFNlbGYtPkV4aXRDb2RlT2soKTsKfQoKc3ViIF9HZXRDdXJyZW50RGF0YSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRDcnlwdE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDcnlwdDo6U01JTUUnKTsKCiAgICAjIEdldCBhbGwgZXhpc3RpbmcgY2VydGlmaWNhdGVzLgogICAgbXkgQENlcnRMaXN0ID0gJENyeXB0T2JqZWN0LT5DZXJ0aWZpY2F0ZUxpc3QoKTsKCiAgICBteSAlTGlzdE9mQ2VydGlmaWNhdGVzOwogICAgbXkgJUVtYWlsc0Zyb21DZXJ0aWZpY2F0ZXM7CgogICAgIyBDaGVjayBhbGwgZXhpc3RpbmcgY2VydGlmaWNhdGVzIGZvciBlbWFpbHMuCiAgICBDRVJUSUZJQ0FURToKICAgIGZvciBteSAkQ2VydG5hbWUgKEBDZXJ0TGlzdCkgewoKICAgICAgICBteSAkQ2VydGlmaWNhdGVTdHJpbmcgPSAkQ3J5cHRPYmplY3QtPkNlcnRpZmljYXRlR2V0KAogICAgICAgICAgICBGaWxlbmFtZSA9PiAkQ2VydG5hbWUsCiAgICAgICAgKTsKCiAgICAgICAgbXkgJUNlcnRpZmljYXRlQXR0cmlidXRlcyA9ICRDcnlwdE9iamVjdC0+Q2VydGlmaWNhdGVBdHRyaWJ1dGVzKAogICAgICAgICAgICBDZXJ0aWZpY2F0ZSA9PiAkQ2VydGlmaWNhdGVTdHJpbmcsCiAgICAgICAgICAgIEZpbGVuYW1lICAgID0+ICRDZXJ0bmFtZSwKICAgICAgICApOwoKICAgICAgICAjIGFsbCBTTUlNRSBjZXJ0aWZpY2F0ZXMgbXVzdCBoYXZlIGFuIEVtYWlsIEF0dHJpYnV0ZQogICAgICAgIG5leHQgQ0VSVElGSUNBVEUgaWYgISRDZXJ0aWZpY2F0ZUF0dHJpYnV0ZXN7RW1haWx9OwoKICAgICAgICBteSAkVmFsaWRFbWFpbCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDaGVja0l0ZW0nKS0+Q2hlY2tFbWFpbCgKICAgICAgICAgICAgQWRkcmVzcyA9PiAkQ2VydGlmaWNhdGVBdHRyaWJ1dGVze0VtYWlsfSwKICAgICAgICApOwoKICAgICAgICBuZXh0IENFUlRJRklDQVRFIGlmICEkVmFsaWRFbWFpbDsKCiAgICAgICAgIyBSZW1lbWJlciBjZXJ0aWZpY2F0ZSAoZG9uJ3QgbmVlZCB0byBiZSBhZGRlZCBhZ2FpbikuCiAgICAgICAgJExpc3RPZkNlcnRpZmljYXRlc3skQ2VydGlmaWNhdGVTdHJpbmd9ID0gJENlcnRpZmljYXRlU3RyaW5nOwoKICAgICAgICAjIFNhdmUgZW1haWwgZm9yIGNoZWNraW5nIGZvciBuZXcgY2VydGlmaWNhdGUuCiAgICAgICAgJEVtYWlsc0Zyb21DZXJ0aWZpY2F0ZXN7ICRDZXJ0aWZpY2F0ZUF0dHJpYnV0ZXN7RW1haWx9IH0gPSAxOwogICAgfQoKICAgIHJldHVybiAoIFwlTGlzdE9mQ2VydGlmaWNhdGVzLCBcJUVtYWlsc0Zyb21DZXJ0aWZpY2F0ZXMgKTsKfQoKMTsK</File>
        <File Location="Custom/Kernel/System/Console/Command/Maint/SMIME/FetchFromCustomer.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxLTIwMjIgWm51bnkgR21iSCwgaHR0cHM6Ly96bnVueS5vcmcvCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6U3lzdGVtOjpDb25zb2xlOjpDb21tYW5kOjpNYWludDo6U01JTUU6OkZldGNoRnJvbUN1c3RvbWVyOwoKdXNlIHN0cmljdDsKdXNlIHdhcm5pbmdzOwoKdXNlIHBhcmVudCBxdyhLZXJuZWw6OlN5c3RlbTo6Q29uc29sZTo6QmFzZUNvbW1hbmQpOwoKb3VyIEBPYmplY3REZXBlbmRlbmNpZXMgPSAoCiAgICAnS2VybmVsOjpDb25maWcnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpDaGVja0l0ZW0nLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpDcnlwdDo6U01JTUUnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpDdXN0b21lclVzZXInLAopOwoKc3ViIENvbmZpZ3VyZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICRTZWxmLT5EZXNjcmlwdGlvbignUmVmcmVzaCBleGlzdGluZyBrZXlzIGZvciBuZXcgb25lcyBmcm9tIHRoZSBMREFQLicpOwogICAgJFNlbGYtPkFkZE9wdGlvbigKICAgICAgICBOYW1lICAgICAgICA9PiAndmVyYm9zZScsCiAgICAgICAgRGVzY3JpcHRpb24gPT4gIlByaW50IGRldGFpbGVkIGNvbW1hbmQgb3V0cHV0LiIsCiAgICAgICAgUmVxdWlyZWQgICAgPT4gMCwKICAgICAgICBIYXNWYWx1ZSAgICA9PiAwLAogICAgKTsKICAgICRTZWxmLT5BZGRPcHRpb24oCiAgICAgICAgTmFtZSAgICAgICAgPT4gJ2ZvcmNlJywKICAgICAgICBEZXNjcmlwdGlvbiA9PiAiRXhlY3V0ZSBldmVuIGlmIFMvTUlNRSBpcyBub3QgZW5hYmxlZCBpbiBTeXNDb25maWcuIiwKICAgICAgICBSZXF1aXJlZCAgICA9PiAwLAogICAgICAgIEhhc1ZhbHVlICAgID0+IDAsCiAgICAgICAgVmFsdWVSZWdleCAgPT4gcXIvLiovc214LAogICAgKTsKICAgICRTZWxmLT5BZGRPcHRpb24oCiAgICAgICAgTmFtZSAgICAgICAgPT4gJ3JlbmV3JywKICAgICAgICBEZXNjcmlwdGlvbiA9PiAiT25seSByZW5ldyBleGlzdGluZyBjZXJ0aWZpY2F0ZXMgZnJvbSBjdXN0b21lci11c2Vycy4iLAogICAgICAgIFJlcXVpcmVkICAgID0+IDAsCiAgICAgICAgSGFzVmFsdWUgICAgPT4gMCwKICAgICAgICBWYWx1ZVJlZ2V4ICA9PiBxci8uKi9zbXgsCiAgICApOwogICAgJFNlbGYtPkFkZE9wdGlvbigKICAgICAgICBOYW1lID0+ICdhZGQtYWxsJywKICAgICAgICBEZXNjcmlwdGlvbiA9PgogICAgICAgICAgICAiQWRkIGFsbCBmb3VuZCBjZXJ0aWZpY2F0ZXMgZnJvbSB0aGUgTERBUCBpbnRvIHRoZSBzeXN0ZW0gd2l0aGluIHRoZSBwcmVkZWZpbmVkIHNlYXJjaCBsaW1pdCBpbiBjdXN0b21lciBiYWNrZWQgKHRoaXMgb3BlcmF0aW9uIG1pZ2h0IHRha2Ugc29tZSB0aW1lKS4iLAogICAgICAgIFJlcXVpcmVkICAgPT4gMCwKICAgICAgICBIYXNWYWx1ZSAgID0+IDAsCiAgICAgICAgVmFsdWVSZWdleCA9PiBxci8uKi9zbXgsCiAgICApOwogICAgJFNlbGYtPkFkZE9wdGlvbigKICAgICAgICBOYW1lICAgICAgICA9PiAnZW1haWwnLAogICAgICAgIERlc2NyaXB0aW9uID0+ICJPbmx5IGdldCBhIGNlcnRpZmljYXRlIGZvciB0aGUgc3BlY2lmaWVkIGVtYWlsIGFkZHJlc3MuIiwKICAgICAgICBSZXF1aXJlZCAgICA9PiAwLAogICAgICAgIEhhc1ZhbHVlICAgID0+IDEsCiAgICAgICAgVmFsdWVSZWdleCAgPT4gcXIvLiovc214LAogICAgKTsKCiAgICByZXR1cm47Cn0KCnN1YiBQcmVSdW4gewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGdldCBjb25maWcgb2JqZWN0CiAgICBteSAkQ29uZmlnT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKTsKICAgIGlmICggJFNlbGYtPkdldE9wdGlvbignZm9yY2UnKSApIHsKICAgICAgICAkQ29uZmlnT2JqZWN0LT5TZXQoCiAgICAgICAgICAgIEtleSAgID0+ICdTTUlNRScsCiAgICAgICAgICAgIFZhbHVlID0+IDEsCiAgICAgICAgKTsKICAgIH0KCiAgICBteSAkU01JTUVBY3RpdmF0ZWQgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ1NNSU1FJyk7CiAgICBpZiAoICEkU01JTUVBY3RpdmF0ZWQgKSB7CiAgICAgICAgZGllICJTL01JTUUgaXMgbm90IGFjdGl2YXRlZCBpbiBTeXNDb25maWchXG4iOwogICAgfQoKICAgIG15ICRNZXNzYWdlID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNyeXB0OjpTTUlNRScpLT5DaGVjaygpOwoKICAgIGRpZSAkTWVzc2FnZSBpZiAkTWVzc2FnZTsKCiAgICBteSAkU01JTUVTeW5jQWN0aXZhdGVkID0gJENvbmZpZ09iamVjdC0+R2V0KCdTTUlNRTo6RmV0Y2hGcm9tQ3VzdG9tZXInKTsKICAgIGlmICggISRTTUlNRVN5bmNBY3RpdmF0ZWQgKSB7CiAgICAgICAgZGllICInUy9NSU1FIGZyb20gTERBUCcgc3luY2hyb25pemF0aW9uIGlzIG5vdCBhY3RpdmF0ZWQgaW4gU3lzQ29uZmlnIVxuIjsKICAgIH0KCiAgICBteSAkQ3J5cHRPYmplY3Q7CiAgICBldmFsIHsKICAgICAgICAkQ3J5cHRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q3J5cHQ6OlNNSU1FJyk7CiAgICB9OwogICAgaWYgKCAhJENyeXB0T2JqZWN0ICkgewogICAgICAgIGRpZSAiTm8gUy9NSU1FIHN1cHBvcnQhLlxuIjsKICAgIH0KCiAgICByZXR1cm47Cn0KCnN1YiBSdW4gewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkQ291bnQgICAgID0gMTsKICAgIG15ICRDZXJ0Q291bnQgPSAwOwoKICAgIG15ICREZXRhaWxMZXZlbCA9ICRTZWxmLT5HZXRPcHRpb24oJ3ZlcmJvc2UnKSA/ICdEZXRhaWxzJyA6ICdTaG9ydERldGFpbHMnOwoKICAgIGlmICggJERldGFpbExldmVsIG5lICdEZXRhaWxzJyApIHsKICAgICAgICAkU2VsZi0+UHJpbnQoIjx5ZWxsb3c+JENvdW50KSBSZWZyZXNoaW5nIFMvTUlNRSBrZXlzLi4uPC95ZWxsb3c+XG4iKTsKICAgICAgICAkQ291bnQrKzsKICAgIH0KCiAgICBteSAkQ3J5cHRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q3J5cHQ6OlNNSU1FJyk7CgogICAgIyBHZXQgYWxsIGV4aXN0aW5nIGNlcnRpZmljYXRlcy4KICAgIG15IEBDZXJ0TGlzdCA9ICRDcnlwdE9iamVjdC0+Q2VydGlmaWNhdGVMaXN0KCk7CgogICAgIyBvbmx5IHdoZW4gRW1haWwgc3BlY2lmaWVkCiAgICBpZiAoICRTZWxmLT5HZXRPcHRpb24oJ2VtYWlsJykgKSB7CiAgICAgICAgbXkgJEVtYWlsYWRkcmVzcyA9ICRTZWxmLT5HZXRPcHRpb24oJ2VtYWlsJyk7CgogICAgICAgIG15ICRWYWxpZEVtYWlsID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNoZWNrSXRlbScpLT5DaGVja0VtYWlsKAogICAgICAgICAgICBBZGRyZXNzID0+ICRFbWFpbGFkZHJlc3MsCiAgICAgICAgKTsKICAgICAgICBpZiAoICEkVmFsaWRFbWFpbCApIHsKICAgICAgICAgICAgJFNlbGYtPlByaW50KCI8cmVkPiRDb3VudCkgJEVtYWlsYWRkcmVzcyBOT1QgdmFsaWQgKCRWYWxpZEVtYWlsKTwvcmVkPlxuIik7CiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIH0KCiAgICAgICAgaWYgKCAkRGV0YWlsTGV2ZWwgbmUgJ0RldGFpbHMnICkgewogICAgICAgICAgICAkU2VsZi0+UHJpbnQoIjx5ZWxsb3c+JENvdW50KSAnJEVtYWlsYWRkcmVzcycgaXMgYSB2YWxpZCBlbWFpbCAoJFZhbGlkRW1haWwpPC95ZWxsb3c+XG4iKTsKICAgICAgICAgICAgJENvdW50Kys7CiAgICAgICAgfQogICAgICAgIG15IEBGaWxlcyA9ICRDcnlwdE9iamVjdC0+RmV0Y2hGcm9tQ3VzdG9tZXIoCiAgICAgICAgICAgIFNlYXJjaCA9PiAkRW1haWxhZGRyZXNzCiAgICAgICAgKTsKCiAgICAgICAgJENlcnRDb3VudCArPSBARmlsZXM7CgogICAgICAgIGlmICggJENlcnRDb3VudCA+IDAgKSB7CiAgICAgICAgICAgIGlmICggJERldGFpbExldmVsIG5lICdEZXRhaWxzJyApIHsKICAgICAgICAgICAgICAgICRTZWxmLT5QcmludCgiJENlcnRDb3VudCBhZGRlZFxuIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgQENlcnRMaXN0ID0gQEZpbGVzOwogICAgfQoKICAgIG15ICVMaXN0T2ZFbWFpbENlcnRpZmljYXRlczsKICAgIG15IEBBY3RpdmVDdXN0b21lclVzZXJDZXJ0aWZpY2F0ZXM7CgogICAgIyBDaGVjayBhbGwgZXhpc3RpbmcgY2VydGlmaWNhdGVzIGZvciBlbWFpbHMuCiAgICBDRVJUSUZJQ0FURToKICAgIGZvciBteSAkQ2VydG5hbWUgKEBDZXJ0TGlzdCkgewoKICAgICAgICBpZiAoICREZXRhaWxMZXZlbCBuZSAnRGV0YWlscycgKSB7CiAgICAgICAgICAgICRTZWxmLT5QcmludCggJ0NOOiAnIC4gJENlcnRuYW1lIC4gIlxuIiApOwogICAgICAgIH0KCiAgICAgICAgbXkgJENlcnRpZmljYXRlU3RyaW5nID0gJENyeXB0T2JqZWN0LT5DZXJ0aWZpY2F0ZUdldCgKICAgICAgICAgICAgRmlsZW5hbWUgPT4gJENlcnRuYW1lLAogICAgICAgICk7CgogICAgICAgIG15ICVDZXJ0aWZpY2F0ZUF0dHJpYnV0ZXMgPSAkQ3J5cHRPYmplY3QtPkNlcnRpZmljYXRlQXR0cmlidXRlcygKICAgICAgICAgICAgQ2VydGlmaWNhdGUgPT4gJENlcnRpZmljYXRlU3RyaW5nLAogICAgICAgICAgICBGaWxlbmFtZSAgICA9PiAkQ2VydG5hbWUsCiAgICAgICAgKTsKCiAgICAgICAgIyBhbGwgU01JTUUgY2VydGlmaWNhdGVzIG11c3QgaGF2ZSBhbiBFbWFpbCBBdHRyaWJ1dGUKICAgICAgICBuZXh0IENFUlRJRklDQVRFIGlmICEkQ2VydGlmaWNhdGVBdHRyaWJ1dGVze0VtYWlsfTsKCiAgICAgICAgbXkgJFZhbGlkRW1haWwgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2hlY2tJdGVtJyktPkNoZWNrRW1haWwoCiAgICAgICAgICAgIEFkZHJlc3MgPT4gJENlcnRpZmljYXRlQXR0cmlidXRlc3tFbWFpbH0sCiAgICAgICAgKTsKCiAgICAgICAgbmV4dCBDRVJUSUZJQ0FURSBpZiAhJFZhbGlkRW1haWw7CgogICAgICAgICMgUmVtZW1iZXIgY2VydGlmaWNhdGUgKGRvbid0IG5lZWQgdG8gYmUgYWRkZWQgYWdhaW4pLgogICAgICAgICRMaXN0T2ZFbWFpbENlcnRpZmljYXRlc3skQ2VydGlmaWNhdGVTdHJpbmd9ID0gJENlcnRpZmljYXRlU3RyaW5nOwoKICAgICAgICAjIFNhdmUgZW1haWwgZm9yIGNoZWNraW5nIGZvciBuZXcgY2VydGlmaWNhdGUuCiAgICAgICAgcHVzaCBAQWN0aXZlQ3VzdG9tZXJVc2VyQ2VydGlmaWNhdGVzLCAkQ2VydGlmaWNhdGVBdHRyaWJ1dGVze0VtYWlsfTsKICAgIH0KICAgIGlmICggJERldGFpbExldmVsIG5lICdEZXRhaWxzJyApIHsKICAgICAgICAkU2VsZi0+UHJpbnQoCiAgICAgICAgICAgICI8eWVsbG93PiRDb3VudCkgRm91bmQgIiAuIEBBY3RpdmVDdXN0b21lclVzZXJDZXJ0aWZpY2F0ZXMgLiAiIEN1c3RvbWVyLUNlcnRpZmljYXRlLi4uPC95ZWxsb3c+XG4iCiAgICAgICAgKTsKICAgICAgICAkQ291bnQrKzsKICAgIH0KCiAgICBteSAkQ3VzdG9tZXJVc2VyT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyVXNlcicpOwoKICAgICMgQ2hlY2sgc2F2ZWQgQ3VzdG9tZXJVc2VyLWVtYWlscyBmb3IgdXNlclNNSU1FQ2VydGlmaWNhdGUKICAgIGlmICggJFNlbGYtPkdldE9wdGlvbigncmVuZXcnKSAmJiBAQWN0aXZlQ3VzdG9tZXJVc2VyQ2VydGlmaWNhdGVzICkgewogICAgICAgIGlmICggJERldGFpbExldmVsIG5lICdEZXRhaWxzJyApIHsKICAgICAgICAgICAgJFNlbGYtPlByaW50KCI8eWVsbG93PiRDb3VudCkgT25seSByZW5ldyBleGlzdGluZyBDdXN0b21lci1DZXJ0aWZpY2F0ZXMuLi48L3llbGxvdz5cbiIpOwogICAgICAgICAgICAkQ291bnQrKzsKICAgICAgICB9CiAgICAgICAgbXkgJUN1c3RvbWVyVXNlcnMgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclNlYXJjaCgKICAgICAgICAgICAgUG9zdE1hc3RlclNlYXJjaCA9PiBAQWN0aXZlQ3VzdG9tZXJVc2VyQ2VydGlmaWNhdGVzLAogICAgICAgICAgICBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICk7CgogICAgICAgICMgaWYgbm90IEFkZEFsbAogICAgICAgIENVU1RPTUVSVVNFUjoKICAgICAgICBmb3IgbXkgJExvZ2luICggc29ydCBrZXlzICVDdXN0b21lclVzZXJzICkgewogICAgICAgICAgICBpZiAoICREZXRhaWxMZXZlbCBuZSAnRGV0YWlscycgKSB7CiAgICAgICAgICAgICAgICAkU2VsZi0+UHJpbnQoICdDVTogJyAuICRMb2dpbiAuICJcbiIgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBteSAlQ3VzdG9tZXJVc2VyID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJVc2VyRGF0YUdldCgKICAgICAgICAgICAgICAgIFVzZXIgPT4gJExvZ2luLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgIyBBZGQgQ2VydGlmaWNhdGUgaWYgYXZhaWxhYmxlCiAgICAgICAgICAgIGlmICggJEN1c3RvbWVyVXNlcntTTUlNRUNlcnRpZmljYXRlfSApIHsKCiAgICAgICAgICAgICAgICAjIENlcnRpZmljYXRlIGFscmVhZHkgZXhpc3RpbmcKICAgICAgICAgICAgICAgIG5leHQgQ1VTVE9NRVJVU0VSIGlmICRMaXN0T2ZFbWFpbENlcnRpZmljYXRlc3sgJEN1c3RvbWVyVXNlcntTTUlNRUNlcnRpZmljYXRlfSB9OwoKICAgICAgICAgICAgICAgIG15ICRDb252ZXJ0ZWRDZXJ0aWZpY2F0ZSA9ICRDcnlwdE9iamVjdC0+Q29udmVydENlcnRGb3JtYXQoCiAgICAgICAgICAgICAgICAgICAgU3RyaW5nID0+ICRDdXN0b21lclVzZXJ7U01JTUVDZXJ0aWZpY2F0ZX0sCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgIG15ICVSZXN1bHQgPSAkQ3J5cHRPYmplY3QtPkNlcnRpZmljYXRlQWRkKAogICAgICAgICAgICAgICAgICAgIENlcnRpZmljYXRlID0+ICRDb252ZXJ0ZWRDZXJ0aWZpY2F0ZSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBpZiAoICRSZXN1bHR7U3VjY2Vzc2Z1bH0gJiYgJFJlc3VsdHtTdWNjZXNzZnVsfSA9PSAxICkgewogICAgICAgICAgICAgICAgICAgIGlmICggJERldGFpbExldmVsIG5lICdEZXRhaWxzJyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFNlbGYtPlByaW50KCIkUmVzdWx0e0ZpbGVuYW1lfSBhZGRlZFxuIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICRDZXJ0Q291bnQrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBpZiAoICRTZWxmLT5HZXRPcHRpb24oJ2FkZC1hbGwnKSApIHsKCiAgICAgICAgI2NoZWNrIExEQVAtVXNlcnMgZm9yIHVzZXJTTUlNRUNlcnRpZmljYXRlIChMaW1pdCA9IEN1c3RvbWVyVXNlclNlYXJjaExpc3RMaW1pdCBmcm9tIExEQVAtQ29uZmlnKQogICAgICAgIG15ICVDdXN0b21lclVzZXJzID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJTZWFyY2goCiAgICAgICAgICAgIFNlYXJjaCA9PiAnKicsCiAgICAgICAgICAgIFVzZXJJRCA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgKTsKICAgICAgICAlQ3VzdG9tZXJVc2VycyA9ICgKICAgICAgICAgICAgJUN1c3RvbWVyVXNlcnMsCiAgICAgICAgICAgICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyU2VhcmNoKAogICAgICAgICAgICAgICAgUG9zdE1hc3RlclNlYXJjaCA9PiAnKicsCiAgICAgICAgICAgICAgICBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICApCiAgICAgICAgKTsKICAgICAgICBpZiAoICREZXRhaWxMZXZlbCBuZSAnRGV0YWlscycgKSB7CiAgICAgICAgICAgICRTZWxmLT5QcmludCgiPHllbGxvdz4kQ291bnQpIEdldCBhbGwgdXNlcnMgdG8gY2hlY2sgdGhlbS4uLjwveWVsbG93PlxuIik7CiAgICAgICAgfQogICAgICAgIGZvciBteSAkTG9naW4gKCBzb3J0IGtleXMgJUN1c3RvbWVyVXNlcnMgKSB7CiAgICAgICAgICAgIG15ICVDdXN0b21lclVzZXIgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJEYXRhR2V0KAogICAgICAgICAgICAgICAgVXNlciA9PiAkTG9naW4sCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGlmICggJERldGFpbExldmVsIG5lICdEZXRhaWxzJyApIHsKICAgICAgICAgICAgICAgICRTZWxmLT5QcmludCgiQ1U6ICRMb2dpblxuIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgb25seSBhZGQsIGlmIEN1c3RvbWVyVXNlciBoYXMgQ2VydGlmaWNhdGUsIGFuZCBDZXJ0aWZpY2F0ZSBub3QgYWxyZWFkeSBpbiBMaXN0IGF2YWlsYWJsZQogICAgICAgICAgICBpZiAoICRDdXN0b21lclVzZXJ7U01JTUVDZXJ0aWZpY2F0ZX0gJiYgISRMaXN0T2ZFbWFpbENlcnRpZmljYXRlc3sgJEN1c3RvbWVyVXNlcntTTUlNRUNlcnRpZmljYXRlfSB9ICkgewogICAgICAgICAgICAgICAgaWYgKCAkRGV0YWlsTGV2ZWwgbmUgJ0RldGFpbHMnICkgewogICAgICAgICAgICAgICAgICAgICRTZWxmLT5QcmludCgiQWRkPyAtICIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG15ICRDb252ZXJ0ZWRDZXJ0aWZpY2F0ZSA9ICRDcnlwdE9iamVjdC0+Q29udmVydENlcnRGb3JtYXQoCiAgICAgICAgICAgICAgICAgICAgU3RyaW5nID0+ICRDdXN0b21lclVzZXJ7U01JTUVDZXJ0aWZpY2F0ZX0KICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgbXkgJVJlc3VsdCA9ICRDcnlwdE9iamVjdC0+Q2VydGlmaWNhdGVBZGQoCiAgICAgICAgICAgICAgICAgICAgQ2VydGlmaWNhdGUgPT4gJENvbnZlcnRlZENlcnRpZmljYXRlLAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICBpZiAoICRSZXN1bHR7U3VjY2Vzc2Z1bH0gJiYgJFJlc3VsdHtTdWNjZXNzZnVsfSA9PSAxICkgewogICAgICAgICAgICAgICAgICAgIGlmICggJERldGFpbExldmVsIG5lICdEZXRhaWxzJyApIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFNlbGYtPlByaW50KCIkUmVzdWx0e0ZpbGVuYW1lfSBhZGRlZCIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAkQ2VydENvdW50Kys7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoICREZXRhaWxMZXZlbCBuZSAnRGV0YWlscycgKSB7CiAgICAgICAgICAgICAgICAgICAgJFNlbGYtPlByaW50KCJcbiIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIG15ICRDaGVja0NlcnRQYXRoUmVzdWx0ID0gJENyeXB0T2JqZWN0LT5DaGVja0NlcnRQYXRoKCk7CgogICAgaWYgKCAkQ2hlY2tDZXJ0UGF0aFJlc3VsdC0+eyREZXRhaWxMZXZlbH0gKSB7CiAgICAgICAgJFNlbGYtPlByaW50KCAkQ2hlY2tDZXJ0UGF0aFJlc3VsdC0+eyREZXRhaWxMZXZlbH0gKTsKICAgIH0KCiAgICBpZiAoICEkQ2hlY2tDZXJ0UGF0aFJlc3VsdC0+e1N1Y2Nlc3N9ICkgewogICAgICAgIHJldHVybiAkU2VsZi0+RXhpdENvZGVFcnJvcigpOwogICAgfQoKICAgICRTZWxmLT5QcmludCgiPGdyZWVuPkRvbmUuICgkQ2VydENvdW50KTwvZ3JlZW4+XG4iKTsKICAgIHJldHVybiAkU2VsZi0+RXhpdENvZGVPaygpOwp9CgoxOwo=</File>
        <File Location="Custom/Kernel/System/Crypt/SMIME.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxLTIwMjIgWm51bnkgR21iSCwgaHR0cHM6Ly96bnVueS5vcmcvCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6U3lzdGVtOjpDcnlwdDo6U01JTUU7Cgp1c2Ugc3RyaWN0Owp1c2Ugd2FybmluZ3M7Cgp1c2UgS2VybmVsOjpTeXN0ZW06OlZhcmlhYmxlQ2hlY2sgcXcoOmFsbCk7CgpvdXIgQE9iamVjdERlcGVuZGVuY2llcyA9ICgKICAgICdLZXJuZWw6OkNvbmZpZycsCiAgICAnS2VybmVsOjpTeXN0ZW06OkNhY2hlJywKICAgICdLZXJuZWw6OlN5c3RlbTo6Q2hlY2tJdGVtJywKICAgICdLZXJuZWw6OlN5c3RlbTo6Q3VzdG9tZXJVc2VyJywKICAgICdLZXJuZWw6OlN5c3RlbTo6REInLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpEYXRlVGltZScsCiAgICAnS2VybmVsOjpTeXN0ZW06OkZpbGVUZW1wJywKICAgICdLZXJuZWw6OlN5c3RlbTo6TG9nJywKICAgICdLZXJuZWw6OlN5c3RlbTo6TWFpbicsCik7Cgo9aGVhZDEgTkFNRQoKS2VybmVsOjpTeXN0ZW06OkNyeXB0OjpTTUlNRSAtIHNtaW1lIGNyeXB0IGJhY2tlbmQgbGliCgo9aGVhZDEgREVTQ1JJUFRJT04KClRoaXMgaXMgYSBzdWIgbW9kdWxlIG9mIEtlcm5lbDo6U3lzdGVtOjpDcnlwdCBhbmQgY29udGFpbnMgYWxsIHNtaW1lIGZ1bmN0aW9ucy4KCj1oZWFkMSBQVUJMSUMgSU5URVJGQUNFCgo9Y3V0CgpzdWIgbmV3IHsKICAgIG15ICggJFR5cGUsICVQYXJhbSApID0gQF87CgogICAgIyBhbGxvY2F0ZSBuZXcgaGFzaCBmb3Igb2JqZWN0CiAgICBteSAkU2VsZiA9IHt9OwogICAgYmxlc3MoICRTZWxmLCAkVHlwZSApOwoKICAgICRTZWxmLT57RGVidWd9ID0gJFBhcmFte0RlYnVnfSB8fCAwOwoKICAgICMgY2hlY2sgaWYgbW9kdWxlIGlzIGVuYWJsZWQKICAgIHJldHVybiAwIGlmICEkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpLT5HZXQoJ1NNSU1FJyk7CgogICAgIyBjYWxsIGluaXQoKQogICAgJFNlbGYtPl9Jbml0KCk7CgogICAgIyBjaGVjayB3b3JraW5nIEVOVgogICAgcmV0dXJuIDAgaWYgJFNlbGYtPkNoZWNrKCk7CgogICAgcmV0dXJuICRTZWxmOwp9Cgo9aGVhZDIgQ2hlY2soKQoKY2hlY2sgaWYgZW52aXJvbm1lbnQgaXMgd29ya2luZwoKICAgIG15ICRNZXNzYWdlID0gJENyeXB0T2JqZWN0LT5DaGVjaygpOwoKPWN1dAoKc3ViIENoZWNrIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgaWYgKCAhLWUgJFNlbGYtPntCaW59ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiTm8gc3VjaCAkU2VsZi0+e0Jpbn0hIiwKICAgICAgICApOwogICAgICAgIHJldHVybiAiTm8gc3VjaCAkU2VsZi0+e0Jpbn0hIjsKICAgIH0KICAgIGVsc2lmICggIS14ICRTZWxmLT57QmlufSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gIiRTZWxmLT57QmlufSBub3QgZXhlY3V0YWJsZSEiLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuICIkU2VsZi0+e0Jpbn0gbm90IGV4ZWN1dGFibGUhIjsKICAgIH0KICAgIGVsc2lmICggIS1lICRTZWxmLT57Q2VydFBhdGh9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiTm8gc3VjaCAkU2VsZi0+e0NlcnRQYXRofSEiLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuICJObyBzdWNoICRTZWxmLT57Q2VydFBhdGh9ISI7CiAgICB9CiAgICBlbHNpZiAoICEtZCAkU2VsZi0+e0NlcnRQYXRofSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gIk5vIHN1Y2ggJFNlbGYtPntDZXJ0UGF0aH0gZGlyZWN0b3J5ISIsCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gIk5vIHN1Y2ggJFNlbGYtPntDZXJ0UGF0aH0gZGlyZWN0b3J5ISI7CiAgICB9CiAgICBlbHNpZiAoICEtdyAkU2VsZi0+e0NlcnRQYXRofSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gIiRTZWxmLT57Q2VydFBhdGh9IG5vdCB3cml0YWJsZSEiLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuICIkU2VsZi0+e0NlcnRQYXRofSBub3Qgd3JpdGFibGUhIjsKICAgIH0KICAgIGVsc2lmICggIS1lICRTZWxmLT57UHJpdmF0ZVBhdGh9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiTm8gc3VjaCAkU2VsZi0+e1ByaXZhdGVQYXRofSEiLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuICJObyBzdWNoICRTZWxmLT57UHJpdmF0ZVBhdGh9ISI7CiAgICB9CiAgICBlbHNpZiAoICEtZCAkU2VsZi0+e1ByaXZhdGVQYXRofSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gIk5vIHN1Y2ggJFNlbGYtPntQcml2YXRlUGF0aH0gZGlyZWN0b3J5ISIsCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gIk5vIHN1Y2ggJFNlbGYtPntQcml2YXRlUGF0aH0gZGlyZWN0b3J5ISI7CiAgICB9CiAgICBlbHNpZiAoICEtdyAkU2VsZi0+e1ByaXZhdGVQYXRofSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gIiRTZWxmLT57UHJpdmF0ZVBhdGh9IG5vdCB3cml0YWJsZSEiLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuICIkU2VsZi0+e1ByaXZhdGVQYXRofSBub3Qgd3JpdGFibGUhIjsKICAgIH0KCiAgICByZXR1cm47Cn0KCj1oZWFkMiBDcnlwdCgpCgpjcnlwdCBhIG1lc3NhZ2UKCiAgICBteSAkTWVzc2FnZSA9ICRDcnlwdE9iamVjdC0+Q3J5cHQoCiAgICAgICAgTWVzc2FnZSAgICAgID0+ICRNZXNzYWdlLAogICAgICAgIENlcnRpZmljYXRlcyA9PiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIEZpbGVuYW1lID0+ICRDZXJ0aWZpY2F0ZUZpbGVuYW1lLAogICAgICAgICAgICB9LAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBIYXNoICAgICAgICA9PiAkQ2VydGlmaWNhdGVIYXNoLAogICAgICAgICAgICAgICAgRmluZ2VycHJpbnQgPT4gJENlcnRpZmljYXRlRmluZ2VycHJpbnQsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICMgLi4uCiAgICAgICAgXQogICAgKTsKCiAgICBteSAkTWVzc2FnZSA9ICRDcnlwdE9iamVjdC0+Q3J5cHQoCiAgICAgICAgTWVzc2FnZSAgPT4gJE1lc3NhZ2UsCiAgICAgICAgRmlsZW5hbWUgPT4gJENlcnRpZmljYXRlRmlsZW5hbWUsCiAgICApOwoKICAgIG15ICRNZXNzYWdlID0gJENyeXB0T2JqZWN0LT5DcnlwdCgKICAgICAgICBNZXNzYWdlICAgICA9PiAkTWVzc2FnZSwKICAgICAgICBIYXNoICAgICAgICA9PiAkQ2VydGlmaWNhdGVIYXNoLAogICAgICAgIEZpbmdlcnByaW50ID0+ICRDZXJ0aWZpY2F0ZUZpbmdlcnByaW50LAogICAgKTsKCj1jdXQKCnN1YiBDcnlwdCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBmb3IgbXkgJE5lZWRlZCAocXcoTWVzc2FnZSkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICROZWVkZWQhIgogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgIGlmICggJFBhcmFte0NlcnRpZmljYXRlc30gJiYgcmVmICRQYXJhbXtDZXJ0aWZpY2F0ZXN9IG5lICdBUlJBWScgKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJDZXJ0aWZpY2F0ZXMgUGFyYW06IE11c3QgYmUgYW4gYXJyYXkgcmVmZXJlbmNlISIsCiAgICAgICAgKTsKICAgIH0KCiAgICBpZiAoICEkUGFyYW17Q2VydGlmaWNhdGVzfSAmJiAhJFBhcmFte0ZpbGVuYW1lfSAmJiAhKCAkUGFyYW17SGFzaH0gfHwgJFBhcmFte0ZpbmdlcnByaW50fSApICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCBQYXJhbTogRmlsZW5hbWUgb3IgSGFzaCBhbmQgRmluZ2VycHJpbnQhIiwKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5CiAgICBteSBAQ2VydGlmaWNhdGVTZWFyY2hQYXJhbXM7CiAgICBpZiAoICRQYXJhbXtDZXJ0aWZpY2F0ZXN9ICkgewogICAgICAgIEBDZXJ0aWZpY2F0ZVNlYXJjaFBhcmFtcyA9IEB7ICRQYXJhbXtDZXJ0aWZpY2F0ZXN9IH07CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBteSAlU2VhcmNoUGFyYW0gPSAlUGFyYW07CiAgICAgICAgZGVsZXRlICRTZWFyY2hQYXJhbXtNZXNzYWdlfTsKICAgICAgICBwdXNoIEBDZXJ0aWZpY2F0ZVNlYXJjaFBhcmFtcywgXCVTZWFyY2hQYXJhbTsKICAgIH0KCiAgICAjIGdldCB0ZW1wIGZpbGUgb2JqZWN0CiAgICBteSAkRmlsZVRlbXBPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6RmlsZVRlbXAnKTsKCiAgICBteSBAQ2VydEZpbGVzOwoKICAgIFNFQVJDSFBBUkFNOgogICAgZm9yIG15ICRTZWFyY2hQYXJhbSAoQENlcnRpZmljYXRlU2VhcmNoUGFyYW1zKSB7CgogICAgICAgIG5leHQgU0VBUkNIUEFSQU0gaWYgIUlzSGFzaFJlZldpdGhEYXRhKCRTZWFyY2hQYXJhbSk7CgogICAgICAgIG15ICRDZXJ0aWZpY2F0ZSA9ICRTZWxmLT5DZXJ0aWZpY2F0ZUdldCggJXskU2VhcmNoUGFyYW19ICk7CiAgICAgICAgbXkgKCAkRkhDZXJ0aWZpY2F0ZSwgJENlcnRGaWxlICkgPSAkRmlsZVRlbXBPYmplY3QtPlRlbXBGaWxlKCk7CiAgICAgICAgcHJpbnQgJEZIQ2VydGlmaWNhdGUgJENlcnRpZmljYXRlOwogICAgICAgIGNsb3NlICRGSENlcnRpZmljYXRlOwoKICAgICAgICBwdXNoIEBDZXJ0RmlsZXMsICRDZXJ0RmlsZTsKICAgIH0KCiAgICBpZiAoICFAQ2VydEZpbGVzICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiTm8gY2VydGlmaWNhdGVzIGZvdW5kISIsCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgbXkgJENlcnRGaWxlU3RyZyA9IGpvaW4gJyAnLCBAQ2VydEZpbGVzOwoKICAgIG15ICggJEZILCAkUGxhaW5GaWxlICkgPSAkRmlsZVRlbXBPYmplY3QtPlRlbXBGaWxlKCk7CiAgICBwcmludCAkRkggJFBhcmFte01lc3NhZ2V9OwogICAgY2xvc2UgJEZIOwoKICAgIG15ICggJEZIQ3J5cHRlZCwgJENyeXB0ZWRGaWxlICkgPSAkRmlsZVRlbXBPYmplY3QtPlRlbXBGaWxlKCk7CiAgICBjbG9zZSAkRkhDcnlwdGVkOwoKICAgIG15ICRPcHRpb25zICAgID0gInNtaW1lIC1lbmNyeXB0IC1iaW5hcnkgLWRlczMgLWluICRQbGFpbkZpbGUgLW91dCAkQ3J5cHRlZEZpbGUgJENlcnRGaWxlU3RyZyI7CiAgICBteSAkTG9nTWVzc2FnZSA9ICRTZWxmLT5fQ2xlYW5PdXRwdXQocXh7JFNlbGYtPntDbWR9ICRPcHRpb25zIDI+JjF9KTsKICAgIGlmICgkTG9nTWVzc2FnZSkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiQ2FuJ3QgZW5jcnlwdDogJExvZ01lc3NhZ2UhIgogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIG15ICRDcnlwdGVkUmVmID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06Ok1haW4nKS0+RmlsZVJlYWQoIExvY2F0aW9uID0+ICRDcnlwdGVkRmlsZSApOwoKICAgIHJldHVybiBpZiAhJENyeXB0ZWRSZWY7CiAgICByZXR1cm4gJCRDcnlwdGVkUmVmOwp9Cgo9aGVhZDIgRGVjcnlwdCgpCgpkZWNyeXB0IGEgbWVzc2FnZSBhbmQgcmV0dXJucyBhIGhhc2ggKFN1Y2Nlc3NmdWwsIE1lc3NhZ2UsIERhdGEpCgogICAgbXkgJU1lc3NhZ2UgPSAkQ3J5cHRPYmplY3QtPkRlY3J5cHQoCiAgICAgICAgTWVzc2FnZSAgPT4gJENyeXB0ZWRNZXNzYWdlLAogICAgICAgIEZpbGVuYW1lID0+ICRGaWxlbmFtZSwKICAgICk7CgogICAgbXkgJU1lc3NhZ2UgPSAkQ3J5cHRPYmplY3QtPkRlY3J5cHQoCiAgICAgICAgTWVzc2FnZSAgICAgPT4gJENyeXB0ZWRNZXNzYWdlLAogICAgICAgIEhhc2ggICAgICAgID0+ICRIYXNoLAogICAgICAgIEZpbmdlcnByaW50ID0+ICRGaW5nZXJwcmludCwKICAgICk7Cgo9Y3V0CgpzdWIgRGVjcnlwdCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBmb3IgbXkgJE5lZWRlZCAocXcoTWVzc2FnZSkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICROZWVkZWQhIgogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgIGlmICggISRQYXJhbXtGaWxlbmFtZX0gJiYgISggJFBhcmFte0hhc2h9IHx8ICRQYXJhbXtGaW5nZXJwcmludH0gKSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgTWVzc2FnZSAgPT4gIk5lZWQgUGFyYW06IEZpbGVuYW1lIG9yIEhhc2ggYW5kIEZpbmdlcnByaW50ISIsCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgbXkgJEZpbGVuYW1lICAgID0gJFBhcmFte0ZpbGVuYW1lfSB8fCAnJzsKICAgIG15ICRDZXJ0aWZpY2F0ZSA9ICRTZWxmLT5DZXJ0aWZpY2F0ZUdldCglUGFyYW0pOwogICAgbXkgJUF0dHJpYnV0ZXMgID0gJFNlbGYtPkNlcnRpZmljYXRlQXR0cmlidXRlcygKICAgICAgICBDZXJ0aWZpY2F0ZSA9PiAkQ2VydGlmaWNhdGUsCiAgICAgICAgRmlsZW5hbWUgICAgPT4gJEZpbGVuYW1lLAogICAgKTsKICAgIG15ICggJFByaXZhdGUsICRTZWNyZXQgKSA9ICRTZWxmLT5Qcml2YXRlR2V0KCVBdHRyaWJ1dGVzKTsKCiAgICAjIGdldCB0ZW1wIGZpbGUgb2JqZWN0CiAgICBteSAkRmlsZVRlbXBPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6RmlsZVRlbXAnKTsKCiAgICBteSAoICRGSFByaXZhdGUsICRQcml2YXRlS2V5RmlsZSApID0gJEZpbGVUZW1wT2JqZWN0LT5UZW1wRmlsZSgpOwogICAgcHJpbnQgJEZIUHJpdmF0ZSAkUHJpdmF0ZTsKICAgIGNsb3NlICRGSFByaXZhdGU7CiAgICBteSAoICRGSENlcnRpZmljYXRlLCAkQ2VydEZpbGUgKSA9ICRGaWxlVGVtcE9iamVjdC0+VGVtcEZpbGUoKTsKICAgIHByaW50ICRGSENlcnRpZmljYXRlICRDZXJ0aWZpY2F0ZTsKICAgIGNsb3NlICRGSENlcnRpZmljYXRlOwogICAgbXkgKCAkRkgsICRDcnlwdGVkRmlsZSApID0gJEZpbGVUZW1wT2JqZWN0LT5UZW1wRmlsZSgpOwogICAgcHJpbnQgJEZIICRQYXJhbXtNZXNzYWdlfTsKICAgIGNsb3NlICRGSDsKICAgIG15ICggJEZIRGVjcnlwdGVkLCAkUGxhaW5GaWxlICkgPSAkRmlsZVRlbXBPYmplY3QtPlRlbXBGaWxlKCk7CiAgICBjbG9zZSAkRkhEZWNyeXB0ZWQ7CiAgICBteSAoICRGSFNlY3JldCwgJFNlY3JldEZpbGUgKSA9ICRGaWxlVGVtcE9iamVjdC0+VGVtcEZpbGUoKTsKICAgIHByaW50ICRGSFNlY3JldCAkU2VjcmV0OwogICAgY2xvc2UgJEZIU2VjcmV0OwoKICAgIG15ICRPcHRpb25zID0gInNtaW1lIC1kZWNyeXB0IC1pbiAkQ3J5cHRlZEZpbGUgLW91dCAkUGxhaW5GaWxlIC1yZWNpcCAkQ2VydEZpbGUgLWlua2V5ICRQcml2YXRlS2V5RmlsZSIKICAgICAgICAuICIgLXBhc3NpbiBmaWxlOiRTZWNyZXRGaWxlIjsKICAgIG15ICRMb2dNZXNzYWdlID0gcXh7JFNlbGYtPntDbWR9ICRPcHRpb25zIDI+JjF9OwogICAgdW5saW5rICRTZWNyZXRGaWxlOwoKICAgIGlmICgKICAgICAgICAkUGFyYW17U2VhcmNoaW5nTmVlZGVkS2V5fQogICAgICAgICYmICRMb2dNZXNzYWdlID1+IG17UEtDUzdfZGF0YURlY29kZTpubyByZWNpcGllbnQgbWF0Y2hlcyBjZXJ0aWZpY2F0ZX0KICAgICAgICAmJiAkTG9nTWVzc2FnZSA9fiBte1BLQ1M3X2RlY3J5cHQ6ZGVjcnlwdCBlcnJvcn0KICAgICAgICApCiAgICB7CiAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgU3VjY2Vzc2Z1bCA9PiAwLAogICAgICAgICAgICBNZXNzYWdlICAgID0+ICdJbXBvc3NpYmxlIHRvIGRlY3J5cHQgd2l0aCBpbnN0YWxsZWQgcHJpdmF0ZSBrZXlzIScsCiAgICAgICAgKTsKICAgIH0KCiAgICBpZiAoJExvZ01lc3NhZ2UpIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gIkNhbid0IGRlY3J5cHQ6ICRMb2dNZXNzYWdlISIKICAgICAgICApOwogICAgICAgIHJldHVybiAoCiAgICAgICAgICAgIFN1Y2Nlc3NmdWwgPT4gMCwKICAgICAgICAgICAgTWVzc2FnZSAgICA9PiAkTG9nTWVzc2FnZSwKICAgICAgICApOwogICAgfQoKICAgIG15ICREZWNyeXB0ZWRSZWYgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TWFpbicpLT5GaWxlUmVhZCggTG9jYXRpb24gPT4gJFBsYWluRmlsZSApOwogICAgaWYgKCAhJERlY3J5cHRlZFJlZiApIHsKICAgICAgICByZXR1cm4gKAogICAgICAgICAgICBTdWNjZXNzZnVsID0+IDAsCiAgICAgICAgICAgIE1lc3NhZ2UgICAgPT4gIk9wZW5TU0w6IENhbid0IHJlYWQgJFBsYWluRmlsZSEiLAogICAgICAgICAgICBEYXRhICAgICAgID0+IHVuZGVmLAogICAgICAgICk7CgogICAgfQogICAgcmV0dXJuICgKICAgICAgICBTdWNjZXNzZnVsID0+IDEsCiAgICAgICAgTWVzc2FnZSAgICA9PiAiT3BlblNTTDogT0siLAogICAgICAgIERhdGEgICAgICAgPT4gJCREZWNyeXB0ZWRSZWYsCiAgICApOwp9Cgo9aGVhZDIgU2lnbigpCgpzaWduIGEgbWVzc2FnZQoKICAgIG15ICRTaWduID0gJENyeXB0T2JqZWN0LT5TaWduKAogICAgICAgIE1lc3NhZ2UgID0+ICRNZXNzYWdlLAogICAgICAgIEZpbGVuYW1lID0+ICRQcml2YXRlRmlsZW5hbWUsCiAgICApOwogICAgbXkgJFNpZ24gPSAkQ3J5cHRPYmplY3QtPlNpZ24oCiAgICAgICAgTWVzc2FnZSAgICAgPT4gJE1lc3NhZ2UsCiAgICAgICAgSGFzaCAgICAgICAgPT4gJEhhc2gsCiAgICAgICAgRmluZ2VycHJpbnQgPT4gJEZpbmdlcnByaW50LAogICAgKTsKCj1jdXQKCnN1YiBTaWduIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIGZvciBteSAkTmVlZGVkIChxdyhNZXNzYWdlKSkgewogICAgICAgIGlmICggISRQYXJhbXskTmVlZGVkfSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIk5lZWQgJE5lZWRlZCEiCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgaWYgKCAhJFBhcmFte0ZpbGVuYW1lfSAmJiAhKCAkUGFyYW17SGFzaH0gfHwgJFBhcmFte0ZpbmdlcnByaW50fSApICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCBQYXJhbTogRmlsZW5hbWUgb3IgSGFzaCBhbmQgRmluZ2VycHJpbnQhIiwKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBteSAkQ2VydGlmaWNhdGUgPSAkU2VsZi0+Q2VydGlmaWNhdGVHZXQoJVBhcmFtKTsKICAgIG15ICVBdHRyaWJ1dGVzICA9ICRTZWxmLT5DZXJ0aWZpY2F0ZUF0dHJpYnV0ZXMoCiAgICAgICAgQ2VydGlmaWNhdGUgPT4gJENlcnRpZmljYXRlLAogICAgICAgIEZpbGVuYW1lICAgID0+ICRQYXJhbXtGaWxlbmFtZX0KICAgICk7CiAgICBteSAoICRQcml2YXRlLCAkU2VjcmV0ICkgPSAkU2VsZi0+UHJpdmF0ZUdldCglQXR0cmlidXRlcyk7CgogICAgIyBnZXQgdGhlIHJlbGF0ZWQgY2VydGlmaWNhdGVzCiAgICBteSBAUmVsYXRlZENlcnRpZmljYXRlcyA9ICRTZWxmLT5TaWduZXJDZXJ0UmVsYXRpb25HZXQoIENlcnRGaW5nZXJwcmludCA9PiAkQXR0cmlidXRlc3tGaW5nZXJwcmludH0gKTsKCiAgICAjIGdldCB0ZW1wIGZpbGUgb2JqZWN0CiAgICBteSAkRmlsZVRlbXBPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6RmlsZVRlbXAnKTsKCiAgICBteSAkRkhDQUNlcnRGaWxlQWN0aXZlOwogICAgbXkgKCAkRkhDQUNlcnRGaWxlLCAkQ0FGaWxlTmFtZSApID0gJEZpbGVUZW1wT2JqZWN0LT5UZW1wRmlsZSgpOwoKICAgIG15ICRDZXJ0RmlsZUNvbW1hbmQgPSAnJzsKCiAgICAjIGdldCBldmVyeSByZWxhdGVkIGNlcnQKICAgIGZvciBteSAkQ2VydCAoQFJlbGF0ZWRDZXJ0aWZpY2F0ZXMpIHsKICAgICAgICBteSAkQ0FGaWxlbmFtZSA9ICRTZWxmLT5fQ2VydGlmaWNhdGVGaWxlbmFtZSgKICAgICAgICAgICAgSGFzaCAgICAgICAgPT4gJENlcnQtPntDQUhhc2h9LAogICAgICAgICAgICBGaW5nZXJwcmludCA9PiAkQ2VydC0+e0NBRmluZ2VycHJpbnR9LAogICAgICAgICk7CiAgICAgICAgcHJpbnQgJEZIQ0FDZXJ0RmlsZSAkU2VsZi0+Q2VydGlmaWNhdGVHZXQoIEZpbGVuYW1lID0+ICRDQUZpbGVuYW1lICkgLiAiXG4iOwogICAgICAgICRGSENBQ2VydEZpbGVBY3RpdmUgPSAxOwogICAgfQoKICAgIGlmICgkRkhDQUNlcnRGaWxlQWN0aXZlKSB7CiAgICAgICAgJENlcnRGaWxlQ29tbWFuZCA9ICIgLWNlcnRmaWxlICRDQUZpbGVOYW1lICI7CiAgICB9CiAgICBjbG9zZSAkRkhDQUNlcnRGaWxlOwoKICAgIG15ICggJEZILCAkUGxhaW5GaWxlICkgPSAkRmlsZVRlbXBPYmplY3QtPlRlbXBGaWxlKCk7CiAgICBwcmludCAkRkggJFBhcmFte01lc3NhZ2V9OwogICAgY2xvc2UgJEZIOwogICAgbXkgKCAkRkhQcml2YXRlLCAkUHJpdmF0ZUtleUZpbGUgKSA9ICRGaWxlVGVtcE9iamVjdC0+VGVtcEZpbGUoKTsKICAgIHByaW50ICRGSFByaXZhdGUgJFByaXZhdGU7CiAgICBjbG9zZSAkRkhQcml2YXRlOwogICAgbXkgKCAkRkhDZXJ0aWZpY2F0ZSwgJENlcnRGaWxlICkgPSAkRmlsZVRlbXBPYmplY3QtPlRlbXBGaWxlKCk7CiAgICBwcmludCAkRkhDZXJ0aWZpY2F0ZSAkQ2VydGlmaWNhdGU7CiAgICBjbG9zZSAkRkhDZXJ0aWZpY2F0ZTsKICAgIG15ICggJEZIU2lnbiwgJFNpZ25GaWxlICkgPSAkRmlsZVRlbXBPYmplY3QtPlRlbXBGaWxlKCk7CiAgICBjbG9zZSAkRkhTaWduOwogICAgbXkgKCAkRkhTZWNyZXQsICRTZWNyZXRGaWxlICkgPSAkRmlsZVRlbXBPYmplY3QtPlRlbXBGaWxlKCk7CiAgICBwcmludCAkRkhTZWNyZXQgJFNlY3JldDsKICAgIGNsb3NlICRGSFNlY3JldDsKCiAgICBteSAkT3B0aW9ucyA9ICJzbWltZSAtc2lnbiAtaW4gJFBsYWluRmlsZSAtb3V0ICRTaWduRmlsZSAtc2lnbmVyICRDZXJ0RmlsZSAtaW5rZXkgJFByaXZhdGVLZXlGaWxlIgogICAgICAgIC4gIiAtdGV4dCAtYmluYXJ5IC1wYXNzaW4gZmlsZTokU2VjcmV0RmlsZSI7CgogICAgIyBhZGQgdGhlIGNlcnRmaWxlIHBhcmFtZXRlcgogICAgJE9wdGlvbnMgLj0gJENlcnRGaWxlQ29tbWFuZDsKCiAgICBteSAkTG9nTWVzc2FnZSA9ICRTZWxmLT5fQ2xlYW5PdXRwdXQocXh7JFNlbGYtPntDbWR9ICRPcHRpb25zIDI+JjF9KTsKICAgIHVubGluayAkU2VjcmV0RmlsZTsKICAgIGlmICgkTG9nTWVzc2FnZSkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiQ2FuJ3Qgc2lnbjogJExvZ01lc3NhZ2UhIChDb21tYW5kOiAkT3B0aW9ucykiCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgbXkgJFNpZ25lZFJlZiA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpNYWluJyktPkZpbGVSZWFkKCBMb2NhdGlvbiA9PiAkU2lnbkZpbGUgKTsKCiAgICByZXR1cm4gaWYgISRTaWduZWRSZWY7CiAgICByZXR1cm4gJCRTaWduZWRSZWY7Cgp9Cgo9aGVhZDIgVmVyaWZ5KCkKCnZlcmlmeSBhIG1lc3NhZ2Ugd2l0aCBzaWduYXR1cmUgYW5kIHJldHVybnMgYSBoYXNoIChTdWNjZXNzZnVsLCBNZXNzYWdlLCBTaWduZXJzLCBTaWduZXJDZXJ0aWZpY2F0ZSkKCiAgICBteSAlRGF0YSA9ICRDcnlwdE9iamVjdC0+VmVyaWZ5KAogICAgICAgIE1lc3NhZ2UgPT4gJE1lc3NhZ2UsCiAgICAgICAgQ0FDZXJ0ICA9PiAkUGF0aHRvQ0FDZXJ0LCAgICAgICAgICAgICAgICAgICAjIHRoZSBjZXJ0aWZpY2F0ZXMgYXV0b3JpdHkgdGhhdCBlbmRvcnNlIGEgc2VsZgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBzaWduZWQgY2VydGlmaWNhdGUKICAgICk7CgpyZXR1cm5zOgoKICAgICVEYXRhID0gKAogICAgICAgIFNpZ25hdHVyZUZvdW5kICAgID0+IDEsICAgICAgICAgICAgICAgICAgICAgIyBvciAwIGlmIG5vIHNpZ25hdHVyZSB3YXMgZm91bmQKICAgICAgICBTdWNjZXNzZnVsICAgICAgICA9PiAxLCAgICAgICAgICAgICAgICAgICAgICMgb3IgMCBpZiB0aGUgdmVyaWZpY2F0aW9uIHByb2Nlc3MgZmFpbGVkCiAgICAgICAgTWVzc2FnZSAgICAgICAgICAgPT4gJE1lc3NhZ2UsICAgICAgICAgICAgICAjIHNob3J0IHZlcnNpb24gb2YgdGhlIHZlcmlmaWNhdGlvbiBvdXRwdXQKICAgICAgICBNZXNzYWdlTG9uZyAgICAgICA9PiAkTWVzc2FnZUxvbmcsICAgICAgICAgICMgZnVsbCB2ZXJpZmljYXRpb24gb3V0cHV0CiAgICAgICAgU2lnbmVycyAgICAgICAgICAgPT4gWyAgICAgICAgICAgICAgICAgICAgICAjIG9wdGlvbmFsLCBhcnJheSByZWZlcmVuY2UgdG8gYWxsIHNpZ25lcnMKICAgICAgICAgICAgJ3NvbWVvbmVAY29tcGFueS5jb20nLCAgICAgICAgICAgICAgICAgICMgICAgYWRkcmVzc2VzCiAgICAgICAgXSwKICAgICAgICBTaWduZXJDZXJ0aWZpY2F0ZSA9PiAkU2lnbmVyQ2VydGlmaWNhdGUsICAgICMgdGhlIGNlcnRpZmljYXRlIHRoYXQgc2lnbnMgdGhlIG1lc3NhZ2UKICAgICAgICBDb250ZW50ICAgICAgICAgICA9PiAkQ29udGVudCwgICAgICAgICAgICAgICMgdGhlIG1lc3NhZ2UgY29udGVudAogICAgKTsKCj1jdXQKCnN1YiBWZXJpZnkgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAlUmV0dXJuOwogICAgbXkgJE1lc3NhZ2UgICAgID0gJyc7CiAgICBteSAkTWVzc2FnZUxvbmcgPSAnJzsKICAgIG15ICRVc2VkS2V5ICAgICA9ICcnOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBpZiAoICEkUGFyYW17TWVzc2FnZX0gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkIE1lc3NhZ2UhIgogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgZ2V0IHRlbXAgZmlsZSBvYmplY3QKICAgIG15ICRGaWxlVGVtcE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpGaWxlVGVtcCcpOwoKICAgIG15ICggJEZILCAkU2lnbmVkRmlsZSApID0gJEZpbGVUZW1wT2JqZWN0LT5UZW1wRmlsZSgpOwogICAgcHJpbnQgJEZIICRQYXJhbXtNZXNzYWdlfTsKICAgIGNsb3NlICRGSDsKICAgIG15ICggJEZIT3V0cHV0LCAkVmVyaWZpZWRGaWxlICkgPSAkRmlsZVRlbXBPYmplY3QtPlRlbXBGaWxlKCk7CiAgICBjbG9zZSAkRkhPdXRwdXQ7CiAgICBteSAoICRGSFNpZ25lciwgJFNpZ25lckZpbGUgKSA9ICRGaWxlVGVtcE9iamVjdC0+VGVtcEZpbGUoKTsKICAgIGNsb3NlICRGSFNpZ25lcjsKCiAgICAjIHBhdGggdG8gdGhlIGNlcnQsIHdoZW4gc2VsZiBzaWduZWQgY2VydHMKICAgICMgc3BlY2lhbGx5IGZvciBvcGVuc3NsIDEuMAogICAgbXkgJENlcnRpZmljYXRlT3B0aW9uID0gJyc7CiAgICBpZiAoICRQYXJhbXtDQUNlcnR9ICkgewogICAgICAgICRDZXJ0aWZpY2F0ZU9wdGlvbiA9ICItQ0FmaWxlICRQYXJhbXtDQUNlcnR9IjsKICAgIH0KCiAgICBteSAkT3B0aW9ucyA9ICJzbWltZSAtdmVyaWZ5IC1pbiAkU2lnbmVkRmlsZSAtb3V0ICRWZXJpZmllZEZpbGUgLXNpZ25lciAkU2lnbmVyRmlsZSAiCiAgICAgICAgLiAiLUNBcGF0aCAkU2VsZi0+e0NlcnRQYXRofSAkQ2VydGlmaWNhdGVPcHRpb24gJFNpZ25lZEZpbGUiOwoKICAgIG15IEBMb2dMaW5lcyA9IHF4eyRTZWxmLT57Q21kfSAkT3B0aW9ucyAyPiYxfTsKCiAgICBmb3IgbXkgJExvZ0xpbmUgKEBMb2dMaW5lcykgewogICAgICAgICRNZXNzYWdlTG9uZyAuPSAkTG9nTGluZTsKICAgICAgICBpZiAoICRMb2dMaW5lID1+IC9eXGQuKjooLis/KTouKz86Lis/OiQvIHx8ICRMb2dMaW5lID1+IC9eXGQuKjooLis/KSQvICkgewogICAgICAgICAgICAkTWVzc2FnZSAuPSAiOyQxIjsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRNZXNzYWdlIC49ICRMb2dMaW5lOwogICAgICAgIH0KICAgIH0KCiAgICAjIGdldCBtYWluIG9iamVjdAogICAgbXkgJE1haW5PYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TWFpbicpOwoKICAgIG15ICRTaWduZXJDZXJ0UmVmICAgID0gJE1haW5PYmplY3QtPkZpbGVSZWFkKCBMb2NhdGlvbiA9PiAkU2lnbmVyRmlsZSApOwogICAgbXkgJFNpZ25lZENvbnRlbnRSZWYgPSAkTWFpbk9iamVjdC0+RmlsZVJlYWQoIExvY2F0aW9uID0+ICRWZXJpZmllZEZpbGUgKTsKCiAgICAjIHJldHVybiBtZXNzYWdlCiAgICBpZiAoICRNZXNzYWdlID1+IC9WZXJpZmljYXRpb24gc3VjY2Vzc2Z1bC9pICkgewoKICAgICAgICAjIERldGVybWluZSBlbWFpbCBhZGRyZXNzKGVzKSBmcm9tIGF0dHJpYnV0ZXMgb2Ygc2lnbmVyIGNlcnRpZmljYXRlLgogICAgICAgIG15ICVTaWduZXJDZXJ0QXR0cmlidXRlczsKICAgICAgICAkU2VsZi0+X0ZldGNoQXR0cmlidXRlc0Zyb21DZXJ0KCAkU2lnbmVyRmlsZSwgXCVTaWduZXJDZXJ0QXR0cmlidXRlcyApOwogICAgICAgIG15IEBTaWduZXJzQXJyYXkgPSBzcGxpdCggJywgJywgJFNpZ25lckNlcnRBdHRyaWJ1dGVze0VtYWlsfSApOwoKICAgICAgICAjIEluY2x1ZGUgYWRkaXRpb25hbCBjZXJ0aWZpY2F0ZSBhdHRyaWJ1dGVzIGluIHRoZSBtZXNzYWdlOgogICAgICAgICMgICAtIHNpZ25lcihzKSBlbWFpbCBhZGRyZXNzKGVzKQogICAgICAgICMgICAtIGNlcnRpZmljYXRlIGhhc2gKICAgICAgICAjICAgLSBjZXJ0aWZpY2F0ZSBmaW5nZXJwcmludAogICAgICAgICMgICBQbGVhc2Ugc2VlIGJ1ZyMxMjI4NCBmb3IgbW9yZSBpbmZvcm1hdGlvbi4KICAgICAgICBteSAkTWVzc2FnZVNpZ25lciA9IGpvaW4oICcsICcsIEBTaWduZXJzQXJyYXkgKSAuICcgOiAnCiAgICAgICAgICAgIC4gJFNpZ25lckNlcnRBdHRyaWJ1dGVze0hhc2h9IC4gJyA6ICcKICAgICAgICAgICAgLiAkU2lnbmVyQ2VydEF0dHJpYnV0ZXN7RmluZ2VycHJpbnR9OwoKICAgICAgICAlUmV0dXJuID0gKAogICAgICAgICAgICBTaWduYXR1cmVGb3VuZCAgICA9PiAxLAogICAgICAgICAgICBTdWNjZXNzZnVsICAgICAgICA9PiAxLAogICAgICAgICAgICBNZXNzYWdlICAgICAgICAgICA9PiAnT3BlblNTTDogJyAuICRNZXNzYWdlIC4gJyAoJyAuICRNZXNzYWdlU2lnbmVyIC4gJyknLAogICAgICAgICAgICBNZXNzYWdlTG9uZyAgICAgICA9PiAnT3BlblNTTDogJyAuICRNZXNzYWdlTG9uZyAuICcgKCcgLiAkTWVzc2FnZVNpZ25lciAuICcpJywKICAgICAgICAgICAgU2lnbmVycyAgICAgICAgICAgPT4gW0BTaWduZXJzQXJyYXldLAogICAgICAgICAgICBTaWduZXJDZXJ0aWZpY2F0ZSA9PiAkJFNpZ25lckNlcnRSZWYsCiAgICAgICAgICAgIENvbnRlbnQgICAgICAgICAgID0+ICQkU2lnbmVkQ29udGVudFJlZiwKICAgICAgICApOwogICAgfQogICAgZWxzaWYgKCAkTWVzc2FnZSA9fiAvc2VsZiBzaWduZWQgY2VydGlmaWNhdGUvaSApIHsKICAgICAgICAlUmV0dXJuID0gKAogICAgICAgICAgICBTaWduYXR1cmVGb3VuZCA9PiAxLAogICAgICAgICAgICBTdWNjZXNzZnVsICAgICA9PiAwLAogICAgICAgICAgICBNZXNzYWdlID0+CiAgICAgICAgICAgICAgICAnT3BlblNTTDogc2VsZiBzaWduZWQgY2VydGlmaWNhdGUsIHRvIHVzZSBpdCBzZW5kIHRoZSBcJ0NlcnRpZmljYXRlXCcgcGFyYW1ldGVyIDogJwogICAgICAgICAgICAgICAgLiAkTWVzc2FnZSwKICAgICAgICAgICAgTWVzc2FnZUxvbmcgPT4KICAgICAgICAgICAgICAgICdPcGVuU1NMOiBzZWxmIHNpZ25lZCBjZXJ0aWZpY2F0ZSwgdG8gdXNlIGl0IHNlbmQgdGhlIFwnQ2VydGlmaWNhdGVcJyBwYXJhbWV0ZXIgOiAnCiAgICAgICAgICAgICAgICAuICRNZXNzYWdlTG9uZywKICAgICAgICAgICAgU2lnbmVyQ2VydGlmaWNhdGUgPT4gJCRTaWduZXJDZXJ0UmVmLAogICAgICAgICAgICBDb250ZW50ICAgICAgICAgICA9PiAkJFNpZ25lZENvbnRlbnRSZWYsCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGRpZ2VzdCBmYWlsdXJlIG1lYW5zIHRoYXQgdGhlIGNvbnRlbnQgb2YgdGhlIGVtYWlsIGRvZXMgbm90IG1hdGNoIHdpdGh0IGhlIHNpZ25hdHVyZQogICAgZWxzaWYgKCAkTWVzc2FnZSA9fiBte2RpZ2VzdCBmYWlsdXJlfWkgKSB7CiAgICAgICAgJVJldHVybiA9ICgKICAgICAgICAgICAgU2lnbmF0dXJlRm91bmQgPT4gMSwKICAgICAgICAgICAgU3VjY2Vzc2Z1bCAgICAgPT4gMCwKICAgICAgICAgICAgTWVzc2FnZSA9PgogICAgICAgICAgICAgICAgJ09wZW5TU0w6IFRoZSBzaWduYXR1cmUgZG9lcyBub3QgbWF0Y2ggdGhlIG1lc3NhZ2UgY29udGVudCA6ICcgLiAkTWVzc2FnZSwKICAgICAgICAgICAgTWVzc2FnZUxvbmcgPT4KICAgICAgICAgICAgICAgICdPcGVuU1NMOiBUaGUgc2lnbmF0dXJlIGRvZXMgbm90IG1hdGNoIHRoZSBtZXNzYWdlIGNvbnRlbnQgOiAnIC4gJE1lc3NhZ2VMb25nLAogICAgICAgICAgICBTaWduZXJDZXJ0aWZpY2F0ZSA9PiAkJFNpZ25lckNlcnRSZWYsCiAgICAgICAgICAgIENvbnRlbnQgICAgICAgICAgID0+ICQkU2lnbmVkQ29udGVudFJlZiwKICAgICAgICApOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgJVJldHVybiA9ICgKICAgICAgICAgICAgU2lnbmF0dXJlRm91bmQgPT4gMCwKICAgICAgICAgICAgU3VjY2Vzc2Z1bCAgICAgPT4gMCwKICAgICAgICAgICAgTWVzc2FnZSAgICAgICAgPT4gJ09wZW5TU0w6ICcgLiAkTWVzc2FnZSwKICAgICAgICAgICAgTWVzc2FnZUxvbmcgICAgPT4gJ09wZW5TU0w6ICcgLiAkTWVzc2FnZUxvbmcsCiAgICAgICAgKTsKICAgIH0KICAgIHJldHVybiAlUmV0dXJuOwp9Cgo9aGVhZDIgS2V5c0xpc3QoKQoKICAgIFJldHVybiBsaXN0IG9mIGFsbCBTTUlNRSBwdWJsaWMgYW5kIHByaXZhdGUga2V5cyB3aXRoIHRoZWlyIGF0dHJpYnV0ZXMuCgogICAgbXkgQFJlc3VsdCA9ICRDcnlwdE9iamVjdC0+S2V5c0xpc3QoKQoKPWN1dAoKc3ViIEtleXNMaXN0IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJERCT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkRCJyk7CgogICAgcmV0dXJuIGlmICEkREJPYmplY3QtPlByZXBhcmUoCiAgICAgICAgU1FMID0+ICJTRUxFQ1QgKiBGUk9NIHNtaW1lX2tleXMiLAogICAgKTsKCiAgICBteSBAS2V5c0xpc3Q7CiAgICB3aGlsZSAoIG15IEBSb3cgPSAkREJPYmplY3QtPkZldGNocm93QXJyYXkoKSApIHsKICAgICAgICBteSAkQ2VydGlmaWNhdGUgPSB7CiAgICAgICAgICAgIENlcnRpZmljYXRlSUQgPT4gJFJvd1swXSwKICAgICAgICAgICAgSGFzaCAgICAgICAgICA9PiAkUm93WzFdLAogICAgICAgICAgICBUeXBlICAgICAgICAgID0+ICRSb3dbMl0gZXEgJ1AnID8gJ2tleScgOiAnY2VydCcsCiAgICAgICAgICAgIEZpbGVuYW1lICAgICAgPT4gJFJvd1szXSwKICAgICAgICAgICAgRW1haWwgICAgICAgICA9PiAkUm93WzRdLAogICAgICAgICAgICBFbmREYXRlICAgICAgID0+ICRSb3dbNV0sCiAgICAgICAgICAgIEZpbmdlcnByaW50ICAgPT4gJFJvd1s2XSwKICAgICAgICAgICAgU3ViamVjdCAgICAgICA9PiAkUm93WzddLAogICAgICAgICAgICBTdGFydERhdGUgICAgID0+ICRSb3dbOF0KICAgICAgICB9OwoKICAgICAgICBwdXNoIEBLZXlzTGlzdCwgJENlcnRpZmljYXRlOwogICAgfQoKICAgIHJldHVybiBAS2V5c0xpc3Q7Cn0KCj1oZWFkMiBTZWFyY2goKQoKU2VhcmNoIGZvciBwdWJsaWMgYW5kIHByaXZhdGUgY2VydGlmaWNhdGVzIHdpdGhpbiBmaWxlcy4KCiAgICBteSBAUmVzdWx0ID0gJENyeXB0T2JqZWN0LT5TZWFyY2goCiAgICAgICAgU2VhcmNoID0+ICdzb21lIHRleHQgdG8gc2VhcmNoJywKICAgICk7CgpvcgoKUmV0dXJucyBsaXN0IG9mIGFsbCBjZXJ0aWZpY2F0ZXMuCgogICAgbXkgQFJlc3VsdCA9ICRDcnlwdE9iamVjdC0+U2VhcmNoKAogICAgICAgIEluZGV4ZWRTZWFyY2ggPT4gMSAjIE9wdGlvbmFsLgogICAgKTsKCm9yCgpTZWFyY2ggZm9yIHB1YmxpYyBhbmQgcHJpdmF0ZSBjZXJ0aWZpY2F0ZXMgd2l0aGluIGZpbGVzIHVzaW5nIGluZGV4ZWQgdmFsdWVzLgoKICAgIG15IEBSZXN1bHQgPSAkQ3J5cHRPYmplY3QtPlNlYXJjaCgKICAgICAgICBTZWFyY2ggPT4gJ3NvbWUgdGV4dCB0byBzZWFyY2gnLAogICAgICAgIFNlYXJjaFR5cGUgPT4gJ2UtbWFpbC9oYXNoL2ZpbGVuYW1lL2lkJyAjIERlZmF1bHQgbG9va3VwIGJ5IGUtbWFpbAogICAgICAgIEluZGV4ZWRTZWFyY2ggPT4gMSAjIFJlcXVpcmVkIGlmIHdhbnQgdG8gc2VhcmNoIHZpYSBpbmRleGVkIGF0dHJpYnV0ZXMuCiAgICApOwoKPWN1dAoKc3ViIFNlYXJjaCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15IEBSZXN1bHQ7CiAgICBpZiAoICRQYXJhbXtJbmRleGVkU2VhcmNofSApIHsKICAgICAgICBAUmVzdWx0ID0gJFNlbGYtPl9DZXJ0aWZpY2F0ZUF0dHJpYnV0ZXNHZXQoCiAgICAgICAgICAgICVQYXJhbSwKICAgICAgICAgICAgUHJpdmF0ZSA9PiAwLAogICAgICAgICk7CiAgICAgICAgQFJlc3VsdCA9ICgKICAgICAgICAgICAgQFJlc3VsdCwKICAgICAgICAgICAgJFNlbGYtPl9DZXJ0aWZpY2F0ZUF0dHJpYnV0ZXNHZXQoCiAgICAgICAgICAgICAgICAlUGFyYW0sCiAgICAgICAgICAgICAgICBQcml2YXRlID0+IDEsCiAgICAgICAgICAgICkKICAgICAgICApOwoKICAgICAgICByZXR1cm4gQFJlc3VsdDsKICAgIH0KCiAgICBteSAlQ2VydGlmaWNhdGVzID0gJFNlbGYtPkNlcnRpZmljYXRlTGlzdCgKICAgICAgICBSZXN1bHRUeXBlID0+ICJIQVNIIiwKICAgICk7CgogICAgQFJlc3VsdCA9ICRTZWxmLT5DZXJ0aWZpY2F0ZUZpbGVTZWFyY2goCiAgICAgICAgJVBhcmFtLAogICAgICAgIENlcnRpZmljYXRlcyA9PiBcJUNlcnRpZmljYXRlcywKICAgICk7CgogICAgQFJlc3VsdCA9ICgKICAgICAgICBAUmVzdWx0LAogICAgICAgICRTZWxmLT5Qcml2YXRlRmlsZVNlYXJjaCgKICAgICAgICAgICAgJVBhcmFtLAogICAgICAgICAgICBDZXJ0aWZpY2F0ZXMgPT4gXCVDZXJ0aWZpY2F0ZXMsCiAgICAgICAgKQogICAgKTsKCiAgICByZXR1cm4gQFJlc3VsdDsKCn0KCj1oZWFkMiBDZXJ0aWZpY2F0ZVNlYXJjaCgpCgpSZXR1cm5zIGEgbGlzdCBvZiBjZXJ0aWZpY2F0ZXMgc2VhcmNoaW5nIHVzaW5nIGluZGV4YWJsZSBhdHRyaWJ1dGVzLgoKICAgIG15IEBSZXN1bHQgPSAkQ3J5cHRPYmplY3QtPkNlcnRpZmljYXRlU2VhcmNoKAogICAgICAgIFNlYXJjaCA9PiAkU2VhcmNoLAogICAgICAgIFNlYXJjaFR5cGUgPT4gJ2UtbWFpbC9oYXNoL2ZpbGVuYW1lL2lkL2ZpbmdlcnByaW50JyAjIERlZmF1bHQgbG9va3VwIGJ5IGUtbWFpbAogICAgICAgIFZhbGlkICA9PiAxCiAgICApOwoKICAgIG9yCgogICAgbXkgQFJlc3VsdCA9ICRDcnlwdE9iamVjdC0+Q2VydGlmaWNhdGVTZWFyY2goKTsgIyBGb3IgYWxsIGNlcnRpZmljYXRlcy4KCj1jdXQKCnN1YiBDZXJ0aWZpY2F0ZVNlYXJjaCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRDb25maWdPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpOwoKICAgIG15ICRTZWFyY2ggPSAkUGFyYW17U2VhcmNofSB8fCAnJzsKICAgICRQYXJhbXtWYWxpZH0gLy89IDA7CgogICAgbXkgQFJlc3VsdCA9ICRTZWxmLT5fQ2VydGlmaWNhdGVBdHRyaWJ1dGVzR2V0KAogICAgICAgIFNlYXJjaCAgICAgPT4gJFNlYXJjaCwKICAgICAgICBTZWFyY2hUeXBlID0+ICRQYXJhbXtTZWFyY2hUeXBlfSwKICAgICAgICBWYWxpZCAgICAgID0+ICRQYXJhbXtWYWxpZH0sCiAgICApOwoKICAgICMgMSAtIElmIHRoZXJlIGFyZSBubyByZXN1bHRzIGFscmVhZHkgaW4gdGhlIHN5c3RlbSwgdGhlbiBjaGVjayBmb3IgdGhlIGNlcnRpZmljYXRlIGluIGN1c3RvbWVyIGRhdGEKICAgIGlmICgKICAgICAgICAhQFJlc3VsdAogICAgICAgICYmICRDb25maWdPYmplY3QtPkdldCgnU01JTUU6OkZldGNoRnJvbUN1c3RvbWVyJykKICAgICAgICAmJiBJc1N0cmluZ1dpdGhEYXRhKCRTZWFyY2gpCiAgICAgICAgKQogICAgewoKICAgICAgICAjIFNlYXJjaCBhbmQgYWRkIGNlcnRpZmljYXRlcyBmcm9tIEN1c3RvbWVyIGRhdGEgaWYgUmVzdWx0IGZyb20gQ2VydExpc3QgaXMgZW1wdHkKICAgICAgICBteSBAQ2VydEZpbGVzID0gJFNlbGYtPkZldGNoRnJvbUN1c3RvbWVyKAogICAgICAgICAgICBTZWFyY2ggPT4gJFNlYXJjaCwKICAgICAgICApOwoKICAgICAgICBpZiAoQENlcnRGaWxlcykgewoKICAgICAgICAgICAgIyAyIC0gaWYgZm91bmQsIGdldCBpdHMgZGV0YWlscyBhbmQgYWRkIHRoZW0gdG8gdGhlIEBSZXN1bHRzCiAgICAgICAgICAgIEBSZXN1bHQgPSAkU2VsZi0+X0NlcnRpZmljYXRlQXR0cmlidXRlc0dldCgKICAgICAgICAgICAgICAgIFNlYXJjaCA9PiAkU2VhcmNoLAogICAgICAgICAgICAgICAgVmFsaWQgID0+ICRQYXJhbXtWYWxpZH0KICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIEBSZXN1bHQ7Cn0KCj1oZWFkMiBDZXJ0aWZpY2F0ZUZpbGVTZWFyY2goKQoKTG9va3MgZm9yIGEgZ2l2ZW4gIlNlYXJjaCIgaW4gcGh5c2ljYWwgY2VydGlmaWNhdGVzLCBub3QgcmVjb21tZW5kZWQgZm9yIGluZGV4ZWQgYXR0cmlidXRlcy4KCiAgICBteSBAUmVzdWx0ID0gJENyeXB0T2JqZWN0LT5DZXJ0aWZpY2F0ZUZpbGVTZWFyY2goCiAgICAgICAgU2VhcmNoICAgICAgID0+ICdzb21lIHRleHQgdG8gc2VhcmNoJywKICAgICAgICBWYWxpZCAgICAgICAgPT4gMSAjIE9wdGlvbmFsLCBkZWZhdWx0IGRvZXNuJ3QgY2hlY2sgaWYgdmFsaWQuCiAgICAgICAgQ2VydGlmaWNhdGVzID0+ICRDZXJ0aWZpY2F0ZXMgIyBPcHRpb25hbCwgbGlzdCBvZiBjZXJ0aWZpY2F0ZXMgdG8gY2hlY2suCiAgICApOwoKPWN1dAoKc3ViIENlcnRpZmljYXRlRmlsZVNlYXJjaCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRDb25maWdPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpOwoKICAgIG15ICRTZWFyY2ggPSAkUGFyYW17U2VhcmNofSB8fCAnJzsKICAgICRQYXJhbXtWYWxpZH0gLy89IDA7CgogICAgbXkgJUNlcnRpZmljYXRlczsKICAgIGlmICggSXNIYXNoUmVmV2l0aERhdGEoICRQYXJhbXtDZXJ0aWZpY2F0ZXN9ICkgKSB7CiAgICAgICAgJUNlcnRpZmljYXRlcyA9ICV7ICRQYXJhbXtDZXJ0aWZpY2F0ZXN9IH07CiAgICB9CiAgICBlbHNlIHsKICAgICAgICAlQ2VydGlmaWNhdGVzID0gJFNlbGYtPkNlcnRpZmljYXRlTGlzdCgKICAgICAgICAgICAgUmVzdWx0VHlwZSA9PiAiSEFTSCIsCiAgICAgICAgKTsKICAgIH0KCiAgICBteSBAUmVzdWx0OwogICAgaWYgKCVDZXJ0aWZpY2F0ZXMpIHsKCiAgICAgICAgIyAyIC0gRm9yIHRoZSBjZXJ0cyBpbiBsaXN0IGdldCBpdHMgYXR0cmlidXRlcyBhbmQgYWRkIHRoZW0gdG8gQFJlc3VsdHMKICAgICAgICBAUmVzdWx0ID0gJFNlbGYtPl9DaGVja0NlcnRpZmljYXRlTGlzdCgKICAgICAgICAgICAgQ2VydGlmaWNhdGVMaXN0ID0+IFwlQ2VydGlmaWNhdGVzLAogICAgICAgICAgICBTZWFyY2ggICAgICAgICAgPT4gJFNlYXJjaCwKICAgICAgICAgICAgVmFsaWQgICAgICAgICAgID0+ICRQYXJhbXtWYWxpZH0sCiAgICAgICAgKTsKICAgIH0KCiAgICAjIDMgLSBJZiB0aGVyZSBhcmUgbm8gcmVzdWx0cyBhbHJlYWR5IGluIHRoZSBzeXN0ZW0sIHRoZW4gY2hlY2sgZm9yIHRoZSBjZXJ0aWZpY2F0ZSBpbiBjdXN0b21lciBkYXRhCiAgICBpZiAoCiAgICAgICAgIUBSZXN1bHQKICAgICAgICAmJiAkQ29uZmlnT2JqZWN0LT5HZXQoJ1NNSU1FOjpGZXRjaEZyb21DdXN0b21lcicpCiAgICAgICAgJiYgSXNTdHJpbmdXaXRoRGF0YSgkU2VhcmNoKQogICAgICAgICkKICAgIHsKCiAgICAgICAgIyBTZWFyY2ggYW5kIGFkZCBjZXJ0aWZpY2F0ZXMgZnJvbSBDdXN0b21lciBkYXRhIGlmIFJlc3VsdCBmcm9tIENlcnRpZmljYXRlcyBpcyBlbXB0eQogICAgICAgIG15IEBDZXJ0RmlsZXMgPSAkU2VsZi0+RmV0Y2hGcm9tQ3VzdG9tZXIoCiAgICAgICAgICAgIFNlYXJjaCA9PiAkU2VhcmNoLAogICAgICAgICk7CgogICAgICAgIGlmIChAQ2VydEZpbGVzKSB7CgogICAgICAgICAgICAjIDQgLSBpZiBmb3VuZCwgZ2V0IGl0cyBkZXRhaWxzIGFuZCBhZGQgdGhlbSB0byB0aGUgQFJlc3VsdHMKICAgICAgICAgICAgJUNlcnRpZmljYXRlcyA9ICRTZWxmLT5DZXJ0aWZpY2F0ZUxpc3QoCiAgICAgICAgICAgICAgICBSZXN1bHRUeXBlID0+ICJIQVNIIgogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKCVDZXJ0aWZpY2F0ZXMpIHsKICAgICAgICAgICAgICAgIEBSZXN1bHQgPSAkU2VsZi0+X0NoZWNrQ2VydGlmaWNhdGVMaXN0KAogICAgICAgICAgICAgICAgICAgIENlcnRpZmljYXRlTGlzdCA9PiBcJUNlcnRpZmljYXRlcywKICAgICAgICAgICAgICAgICAgICBTZWFyY2ggICAgICAgICAgPT4gJFNlYXJjaCwKICAgICAgICAgICAgICAgICAgICBWYWxpZCAgICAgICAgICAgPT4gJFBhcmFte1ZhbGlkfSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIEBSZXN1bHQ7Cn0KCnN1YiBfQ2hlY2tDZXJ0aWZpY2F0ZUxpc3QgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkREJPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6REInKTsKCiAgICBteSAkQ2VydExpc3QgPSAkUGFyYW17Q2VydGlmaWNhdGVMaXN0fTsKICAgIG15ICRTZWFyY2ggICA9ICRQYXJhbXtTZWFyY2h9IHx8ICcnOwogICAgJFBhcmFte1ZhbGlkfSAvLz0gMDsKCiAgICBteSBAUmVzdWx0OwoKICAgIENFUlRJRklDQVRFSUQ6CiAgICBmb3IgbXkgJENlcnRpZmljYXRlSUQgKCBzb3J0IGtleXMgJXskQ2VydExpc3R9ICkgewogICAgICAgIG15ICVBdHRyaWJ1dGVzOwogICAgICAgIG15ICRIaXQgICAgICA9IDA7CiAgICAgICAgbXkgJEZpbGVuYW1lID0gJENlcnRMaXN0LT57JENlcnRpZmljYXRlSUR9OwoKICAgICAgICAkSGl0ID0gJFNlbGYtPl9Ob25JbmRleGVkQXR0cmlidXRlc0xvb2t1cCgKICAgICAgICAgICAgU2VhcmNoICAgICA9PiAkU2VhcmNoLAogICAgICAgICAgICBBdHRyaWJ1dGVzID0+IFwlQXR0cmlidXRlcywKICAgICAgICAgICAgRmlsZW5hbWUgICA9PiAkRmlsZW5hbWUsCiAgICAgICAgKTsKCiAgICAgICAgbmV4dCBDRVJUSUZJQ0FURUlEIGlmICEkSGl0OwoKICAgICAgICBteSAkRXhwaXJlZDsKICAgICAgICBpZiAoICRQYXJhbXtWYWxpZH0gKSB7CiAgICAgICAgICAgICRFeHBpcmVkID0gJFNlbGYtPktleUV4cGlyZWRDaGVjaygKICAgICAgICAgICAgICAgIEVuZERhdGUgPT4gJEF0dHJpYnV0ZXN7RW5kRGF0ZX0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICBuZXh0IENFUlRJRklDQVRFSUQgaWYgJEV4cGlyZWQ7CgogICAgICAgICRBdHRyaWJ1dGVze0ZpbGVuYW1lfSAgICAgID0gJEZpbGVuYW1lOwogICAgICAgICRBdHRyaWJ1dGVze0NlcnRpZmljYXRlSUR9ID0gJENlcnRpZmljYXRlSUQ7CgogICAgICAgIHB1c2ggQFJlc3VsdCwgXCVBdHRyaWJ1dGVzOwogICAgfQoKICAgIHJldHVybiBAUmVzdWx0Owp9Cgo9aGVhZDIgRmV0Y2hGcm9tQ3VzdG9tZXIoKQoKYWRkIGNlcnRpZmljYXRlcyBmcm9tIEN1c3RvbWVyVXNlckF0dHJpYnV0ZXMgdG8gbG9jYWwgY2VydGlmaWNhdGVzCnJldHVybnMgYW4gYXJyYXkgb2YgZmlsZW5hbWVzIG9mIGFkZGVkIGNlcnRpZmljYXRlcwoKICAgIG15IEBSZXN1bHQgPSAkQ3J5cHRPYmplY3QtPkZldGNoRnJvbUN1c3RvbWVyKAogICAgICAgIFNlYXJjaCA9PiAkU2VhcmNoRW1haWxBZGRyZXNzLAogICAgKTsKClJldHVybnM6CgogICAgQFJlc3VsdCA9ICggJzZlNjIwZGNjLjAnLCAnODA5NmQwYTkuMCcsICdjMDFjZGZhMi4wJyApOwoKPWN1dAoKc3ViIEZldGNoRnJvbUN1c3RvbWVyIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIGlmICggISRQYXJhbXtTZWFyY2h9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCBTZWFyY2ghIgogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgQ2hlY2sgY3VzdG9tZXIgdXNlcnMgZm9yIHVzZXJTTUlNRUNlcnRpZmljYXRlCiAgICBteSAkQ3VzdG9tZXJVc2VyT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyVXNlcicpOwogICAgbXkgJUN1c3RvbWVyVXNlcnM7CiAgICBpZiAoICRQYXJhbXtTZWFyY2h9ICkgewoKICAgICAgICBteSAkVmFsaWRFbWFpbCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDaGVja0l0ZW0nKS0+Q2hlY2tFbWFpbCgKICAgICAgICAgICAgQWRkcmVzcyA9PiAkUGFyYW17U2VhcmNofSwKICAgICAgICApOwoKICAgICAgICAjIElmIHZhbGlkIGVtYWlsIGFkZHJlc3MsIG9ubHkgZG8gYSBQb3N0TWFzdGVyU2VhcmNoCiAgICAgICAgaWYgKCRWYWxpZEVtYWlsKSB7CiAgICAgICAgICAgICVDdXN0b21lclVzZXJzID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJTZWFyY2goCiAgICAgICAgICAgICAgICBQb3N0TWFzdGVyU2VhcmNoID0+ICRQYXJhbXtTZWFyY2h9LAogICAgICAgICAgICAgICAgVXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CgogICAgbXkgQENlcnRGaWxlTGlzdDsKCiAgICAjIENoZWNrIGZvdW5kIEN1c3RvbWVyVXNlcnMKICAgIGZvciBteSAkTG9naW4gKCBzb3J0IGtleXMgJUN1c3RvbWVyVXNlcnMgKSB7CiAgICAgICAgbXkgJUN1c3RvbWVyVXNlciA9ICRDdXN0b21lclVzZXJPYmplY3QtPkN1c3RvbWVyVXNlckRhdGFHZXQoCiAgICAgICAgICAgIFVzZXIgPT4gJExvZ2luLAogICAgICAgICk7CgogICAgICAgICMgQWRkIENlcnRpZmljYXRlIGlmIGF2YWlsYWJsZQogICAgICAgIGlmICggJEN1c3RvbWVyVXNlcntVc2VyU01JTUVDZXJ0aWZpY2F0ZX0gKSB7CgogICAgICAgICAgICAjIGlmIGRvbid0IGFkZCwgbWF5YmUgaW4gVW5pdFRlc3RzCiAgICAgICAgICAgIHJldHVybiBAQ2VydEZpbGVMaXN0IGlmICRQYXJhbXtEb250QWRkfTsKCiAgICAgICAgICAgICMgQ29udmVydCBjZXJ0aWZpY2F0ZSB0byB0aGUgY29ycmVjdCBmb3JtYXQgKHBrNywgcGsxMiwgcGVtLCBkZXIpCiAgICAgICAgICAgIG15ICRDZXJ0ID0gJFNlbGYtPkNvbnZlcnRDZXJ0Rm9ybWF0KAogICAgICAgICAgICAgICAgU3RyaW5nID0+ICRDdXN0b21lclVzZXJ7VXNlclNNSU1FQ2VydGlmaWNhdGV9LAogICAgICAgICAgICApOwoKICAgICAgICAgICAgbXkgJVJlc3VsdCA9ICRTZWxmLT5DZXJ0aWZpY2F0ZUFkZCgKICAgICAgICAgICAgICAgIENlcnRpZmljYXRlID0+ICRDZXJ0LAogICAgICAgICAgICApOwogICAgICAgICAgICBpZiAoICRSZXN1bHR7U3VjY2Vzc2Z1bH0gJiYgJFJlc3VsdHtTdWNjZXNzZnVsfSA9PSAxICkgewogICAgICAgICAgICAgICAgcHVzaCBAQ2VydEZpbGVMaXN0LCAkUmVzdWx0e0ZpbGVuYW1lfTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gQENlcnRGaWxlTGlzdDsKfQoKPWhlYWQyIENvbnZlcnRDZXJ0Rm9ybWF0KCkKCkNvbnZlcnQgY2VydGlmaWNhdGUgc3RyaW5ncyBpbnRvIGltcG9ydGFibGUgQzxQRU0+IGZvcm1hdC4KCiAgICBteSAkUmVzdWx0ID0gJENyeXB0T2JqZWN0LT5Db252ZXJ0Q2VydEZvcm1hdCgKICAgICAgICBTdHJpbmcgICAgID0+ICRDZXJ0aWZpY2F0aW9uU3RyaW5nLAogICAgICAgIFBhc3NwaHJhc2UgPT4gUGFzc3dvcmQgZm9yIFBGWCAob3B0aW9uYWwpCiAgICApOwoKUmV0dXJuczoKCiAgICAkUmVzdWx0ID0KICAgICItLS0tLUJFR0lOIENFUlRJRklDQVRFLS0tLS0KICAgIE1JSUVYakNDQTBhZ0F3SUJBZ0lKQVBJQlF5QmUvSGJwTUEwR0NTcUdTSWIzRFFFQkJRVUFNSHd4Q3pBSkJnTlYKICAgIC4uLgogICAgbmoyd2JRTzRLak0xMllMVXV2YWhrNXNlCiAgICAtLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCiAgICAiOwoKPWN1dAoKc3ViIENvbnZlcnRDZXJ0Rm9ybWF0IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgaWYgKCAhJFBhcmFte1N0cmluZ30gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkIFN0cmluZyEiCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBteSAkU3RyaW5nICAgICA9ICRQYXJhbXtTdHJpbmd9OwogICAgbXkgJFBhc3NQaHJhc2UgPSAkUGFyYW17UGFzc3BocmFzZX0gLy8gJyc7CgogICAgbXkgJEZpbGVUZW1wT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkZpbGVUZW1wJyk7CgogICAgIyBDcmVhdGUgb3JpZ2luYWwgY2VydGlmaWNhdGUgZmlsZS4KICAgIG15ICggJEZpbGVIYW5kbGUsICRUbXBDZXJ0aWZpY2F0ZSApID0gJEZpbGVUZW1wT2JqZWN0LT5UZW1wRmlsZSgpOwogICAgcHJpbnQgJEZpbGVIYW5kbGUgJFN0cmluZzsKICAgIGNsb3NlICRGaWxlSGFuZGxlOwoKICAgICMgRm9yIFBFTSBmb3JtYXQgbm8gY29udmVyc2lvbiBuZWVkZWQuCiAgICBteSAkT3B0aW9ucyAgID0gIng1MDkgLWluICRUbXBDZXJ0aWZpY2F0ZSAtbm9vdXQiOwogICAgbXkgJFJlYWRFcnJvciA9ICRTZWxmLT5fQ2xlYW5PdXRwdXQocXh7JFNlbGYtPntDbWR9ICRPcHRpb25zIDI+JjF9KTsKCiAgICByZXR1cm4gJFN0cmluZyBpZiAhJFJlYWRFcnJvcjsKCiAgICAjIENyZWF0ZSBlbXB0eSBmaWxlICh0byBzYXZlIHRoZSBjb252ZXJ0ZWQgY2VydGlmaWNhdGUpLgogICAgbXkgKCAkRkgsICRDZXJ0RmlsZSApID0gJEZpbGVUZW1wT2JqZWN0LT5UZW1wRmlsZSgKICAgICAgICBTdWZmaXggPT4gJy5wZW0nLAogICAgKTsKICAgIGNsb3NlICRGSDsKCiAgICBteSAlT3B0aW9uc0xvb2t1cCA9ICgKICAgICAgICBERVIgPT4gewogICAgICAgICAgICBSZWFkICAgID0+ICJ4NTA5IC1pbmZvcm0gZGVyIC1pbiAkVG1wQ2VydGlmaWNhdGUgLW5vb3V0IiwKICAgICAgICAgICAgQ29udmVydCA9PiAieDUwOSAtaW5mb3JtIGRlciAtaW4gJFRtcENlcnRpZmljYXRlIC1vdXQgJENlcnRGaWxlIiwKICAgICAgICB9LAogICAgICAgIFA3QiA9PiB7CiAgICAgICAgICAgIFJlYWQgICAgPT4gInBrY3M3IC1pbiAkVG1wQ2VydGlmaWNhdGUgLW5vb3V0IiwKICAgICAgICAgICAgQ29udmVydCA9PiAicGtjczcgLWluICRUbXBDZXJ0aWZpY2F0ZSAtcHJpbnRfY2VydHMgLW91dCAkQ2VydEZpbGUiLAogICAgICAgIH0sCiAgICAgICAgUEZYID0+IHsKICAgICAgICAgICAgUmVhZCA9PiAicGtjczEyIC1pbiAkVG1wQ2VydGlmaWNhdGUgLW5vb3V0IC1ub21hY3ZlciAtcGFzc2luIHBhc3M6JyRQYXNzUGhyYXNlJyIsCiAgICAgICAgICAgIENvbnZlcnQgPT4KICAgICAgICAgICAgICAgICJwa2NzMTIgLWluICRUbXBDZXJ0aWZpY2F0ZSAtb3V0ICRDZXJ0RmlsZSAtbm9tYWN2ZXIgLWNsY2VydHMgLW5va2V5cyAtcGFzc2luIHBhc3M6JyRQYXNzUGhyYXNlJyIsCiAgICAgICAgfSwKICAgICk7CgogICAgIyBEZXRlcm1pbmUgdGhlIGZvcm1hdCBvZiB0aGUgZmlsZSB1c2luZyBPcGVuU1NMLgogICAgbXkgJERldGVjdGVkRm9ybWF0OwogICAgRk9STUFUOgogICAgZm9yIG15ICRGb3JtYXQgKCBzb3J0IGtleXMgJU9wdGlvbnNMb29rdXAgKSB7CgogICAgICAgICMgUmVhZCB0aGUgZmlsZSBvbiBlYWNoIGZvcm1hdCwgaWYgdGhlcmUgaXMgYW55IG91dHB1dCBpdCBtZWFucyBpdCBjb3VsZCBub3QgYmUgcmVhZC4KICAgICAgICBuZXh0IEZPUk1BVCBpZiAkU2VsZi0+X0NsZWFuT3V0cHV0KHF4eyRTZWxmLT57Q21kfSAkT3B0aW9uc0xvb2t1cHskRm9ybWF0fS0+e1JlYWR9IDI+JjF9KTsKCiAgICAgICAgJERldGVjdGVkRm9ybWF0ID0gJEZvcm1hdDsKICAgICAgICBsYXN0IEZPUk1BVDsKICAgIH0KCiAgICBpZiAoICEkRGV0ZWN0ZWRGb3JtYXQgKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJDZXJ0aWZpY2F0ZSBjb3VsZCBub3QgYmUgcmVhZCwgUGFzc1BocmFzZSBpcyBpbnZhbGlkIG9yIGZpbGUgaXMgY29ycnVwdGVkISIsCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgIyBDb252ZXJ0IGNlcnRpZmljYXRlIHRvIFBFTS4KICAgIG15ICRDb252ZXJ0RXJyb3IgPSAkU2VsZi0+X0NsZWFuT3V0cHV0KHF4eyRTZWxmLT57Q21kfSAkT3B0aW9uc0xvb2t1cHskRGV0ZWN0ZWRGb3JtYXR9LT57Q29udmVydH0gMj4mMX0pOwoKICAgIGlmICgkQ29udmVydEVycm9yKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJDYW4ndCBjb252ZXJ0IGNlcnRpZmljYXRlIGZyb20gJERldGVjdGVkRm9ybWF0IHRvIFBFTTogJENvbnZlcnRFcnJvciIsCiAgICAgICAgKTsKCiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgUmVhZCBjb252ZXJ0ZWQgY2VydGlmaWNhdGUuCiAgICBteSAkQ2VydEZpbGVSZWZQRU0gPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TWFpbicpLT5GaWxlUmVhZCgKICAgICAgICBMb2NhdGlvbiA9PiAkQ2VydEZpbGUsCiAgICApOwoKICAgIHJldHVybiAkeyRDZXJ0RmlsZVJlZlBFTX07Cn0KCj1oZWFkMiBDZXJ0aWZpY2F0ZUFkZCgpCgphZGQgYSBjZXJ0aWZpY2F0ZSB0byBsb2NhbCBjZXJ0aWZpY2F0ZXMKcmV0dXJucyByZXN1bHQgbWVzc2FnZSBhbmQgbmV3IGNlcnRpZmljYXRlIGZpbGVuYW1lCgogICAgbXkgJVJlc3VsdCA9ICRDcnlwdE9iamVjdC0+Q2VydGlmaWNhdGVBZGQoCiAgICAgICAgQ2VydGlmaWNhdGUgPT4gJENlcnRpZmljYXRlU3RyaW5nLAogICAgKTsKCj1jdXQKCnN1YiBDZXJ0aWZpY2F0ZUFkZCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICREQk9iamVjdCAgICAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEQicpOwogICAgbXkgJERhdGVUaW1lT2JqZWN0ID0gJEtlcm5lbDo6T00tPkNyZWF0ZSgnS2VybmVsOjpTeXN0ZW06OkRhdGVUaW1lJyk7CgogICAgbXkgJFVzZXJJRCA9ICRQYXJhbXtVc2VySUR9IC8vIDE7CgogICAgaWYgKCAhJFBhcmFte0NlcnRpZmljYXRlfSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ05lZWQgQ2VydGlmaWNhdGUhJwogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgbXkgJUF0dHJpYnV0ZXMgPSAkU2VsZi0+Q2VydGlmaWNhdGVBdHRyaWJ1dGVzKAogICAgICAgIENlcnRpZmljYXRlID0+ICRQYXJhbXtDZXJ0aWZpY2F0ZX0sCiAgICApOwogICAgbXkgJVJlc3VsdDsKCiAgICBpZiAoICEkQXR0cmlidXRlc3tIYXNofSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ0NhblwndCBhZGQgaW52YWxpZCBjZXJ0aWZpY2F0ZSEnCiAgICAgICAgKTsKICAgICAgICAlUmVzdWx0ID0gKAogICAgICAgICAgICBTdWNjZXNzZnVsID0+IDAsCiAgICAgICAgICAgIE1lc3NhZ2UgICAgPT4gJ0NhblwndCBhZGQgaW52YWxpZCBjZXJ0aWZpY2F0ZSEnLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuICVSZXN1bHQ7CiAgICB9CgogICAgIyBzZWFyY2ggZm9yIGNlcnRzIHdpdGggc2FtZSBoYXNoCiAgICBteSBAUmVzdWx0ID0gJFNlbGYtPl9DZXJ0aWZpY2F0ZUF0dHJpYnV0ZXNHZXQoCiAgICAgICAgU2VhcmNoICAgICA9PiAkQXR0cmlidXRlc3tIYXNofSwKICAgICAgICBTZWFyY2hUeXBlID0+ICdoYXNoJywKICAgICk7CgogICAgIyBkb2VzIHRoZSBjZXJ0IGFscmVhZHkgZXhpc3RzPwogICAgZm9yIG15ICRDZXJ0UmVzdWx0IChAUmVzdWx0KSB7CiAgICAgICAgaWYgKCAkQXR0cmlidXRlc3tGaW5nZXJwcmludH0gZXEgJENlcnRSZXN1bHQtPntGaW5nZXJwcmludH0gKSB7CiAgICAgICAgICAgICVSZXN1bHQgPSAoCiAgICAgICAgICAgICAgICBTdWNjZXNzZnVsID0+IDAsCiAgICAgICAgICAgICAgICBNZXNzYWdlICAgID0+ICdDZXJ0aWZpY2F0ZSBhbHJlYWR5IGluc3RhbGxlZCEnLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm4gJVJlc3VsdDsKICAgICAgICB9CiAgICB9CgogICAgIyBnZXQgY2FjaGUgb2JqZWN0CiAgICBteSAkQ2FjaGVPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2FjaGUnKTsKCiAgICAjIGxvb2sgZm9yIGFuIGF2YWlsYWJsZSBmaWxlbmFtZQogICAgRklMRU5BTUU6CiAgICBmb3IgbXkgJENvdW50ICggMCAuLiA5OSApIHsKICAgICAgICBpZiAoIC1lICIkU2VsZi0+e0NlcnRQYXRofS8kQXR0cmlidXRlc3tIYXNofS4kQ291bnQiICkgewogICAgICAgICAgICBuZXh0IEZJTEVOQU1FOwogICAgICAgIH0KCiAgICAgICAgbXkgJEZpbGUgPSAiJFNlbGYtPntDZXJ0UGF0aH0vJEF0dHJpYnV0ZXN7SGFzaH0uJENvdW50IjsKICAgICAgICAjIyBubyBjcml0aWMKICAgICAgICBpZiAoIG9wZW4oIG15ICRPVVQsICc+JywgJEZpbGUgKSApIHsKICAgICAgICAgICAgIyMgdXNlIGNyaXRpYwogICAgICAgICAgICBwcmludCAkT1VUICRQYXJhbXtDZXJ0aWZpY2F0ZX07CiAgICAgICAgICAgIGNsb3NlKCRPVVQpOwogICAgICAgICAgICAlUmVzdWx0ID0gKAogICAgICAgICAgICAgICAgU3VjY2Vzc2Z1bCA9PiAxLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgICA9PiAnQ2VydGlmaWNhdGUgdXBsb2FkZWQnLAogICAgICAgICAgICAgICAgRmlsZW5hbWUgICA9PiAiJEF0dHJpYnV0ZXN7SGFzaH0uJENvdW50IiwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIHJldHVybiBpZiAhJERCT2JqZWN0LT5EbygKICAgICAgICAgICAgICAgIFNRTCA9PiAiCiAgICAgICAgICAgICAgICAgICAgSU5TRVJUIElOVE8gc21pbWVfa2V5cyAoa2V5X2hhc2gsIGtleV90eXBlLCBmaWxlX25hbWUsIGVtYWlsX2FkZHJlc3MsIGV4cGlyYXRpb25fZGF0ZSwgZmluZ2VycHJpbnQsIHN1YmplY3QsIGNyZWF0ZV90aW1lLCBjcmVhdGVfYnkpCiAgICAgICAgICAgICAgICAgICAgVkFMVUVTCiAgICAgICAgICAgICAgICAgICAgKD8sID8sID8sID8sID8sID8sID8sID8sID8pIiwKICAgICAgICAgICAgICAgIEJpbmQgPT4gWwogICAgICAgICAgICAgICAgICAgIFwkQXR0cmlidXRlc3tIYXNofSwgICAgICAgICBcJEF0dHJpYnV0ZXN7VHlwZX0sCiAgICAgICAgICAgICAgICAgICAgXCRSZXN1bHR7RmlsZW5hbWV9LCAgICAgICAgIFwkQXR0cmlidXRlc3tFbWFpbH0sCiAgICAgICAgICAgICAgICAgICAgXCRBdHRyaWJ1dGVze1Nob3J0RW5kRGF0ZX0sIFwkQXR0cmlidXRlc3tGaW5nZXJwcmludH0sCiAgICAgICAgICAgICAgICAgICAgXCRBdHRyaWJ1dGVze1N1YmplY3R9LCAgICAgIFwkRGF0ZVRpbWVPYmplY3QtPlRvU3RyaW5nKCksCiAgICAgICAgICAgICAgICAgICAgXCRVc2VySUQsCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgJENhY2hlT2JqZWN0LT5DbGVhblVwKAogICAgICAgICAgICAgICAgVHlwZSA9PiAnU01JTUVfQ2VydCcsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgICRDYWNoZU9iamVjdC0+Q2xlYW5VcCgKICAgICAgICAgICAgICAgIFR5cGUgPT4gJ1NNSU1FX1ByaXZhdGUnLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgcmV0dXJuICVSZXN1bHQ7CiAgICAgICAgfQoKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gIkNhbid0IHdyaXRlICRGaWxlOiAkISEiCiAgICAgICAgKTsKICAgICAgICAlUmVzdWx0ID0gKAogICAgICAgICAgICBTdWNjZXNzZnVsID0+IDAsCiAgICAgICAgICAgIE1lc3NhZ2UgICAgPT4gIkNhbid0IHdyaXRlICRGaWxlOiAkISEiLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuICVSZXN1bHQ7CiAgICB9CgogICAgJVJlc3VsdCA9ICgKICAgICAgICBTdWNjZXNzZnVsID0+IDAsCiAgICAgICAgTWVzc2FnZSAgICA9PiAiTm8gbW9yZSBhdmFpbGFibGUgZmlsZW5hbWVzIGZvciBjZXJ0aWZpY2F0ZSBoYXNoOiRBdHRyaWJ1dGVze0hhc2h9ISIsCiAgICApOwogICAgcmV0dXJuICVSZXN1bHQ7Cn0KCj1oZWFkMiBDZXJ0aWZpY2F0ZUdldCgpCgpnZXQgYSBsb2NhbCBjZXJ0aWZpY2F0ZQoKICAgIG15ICRDZXJ0aWZpY2F0ZSA9ICRDcnlwdE9iamVjdC0+Q2VydGlmaWNhdGVHZXQoCiAgICAgICAgRmlsZW5hbWUgPT4gJENlcnRpZmljYXRlRmlsZW5hbWUsCiAgICApOwoKICAgIG15ICRDZXJ0aWZpY2F0ZSA9ICRDcnlwdE9iamVjdC0+Q2VydGlmaWNhdGVHZXQoCiAgICAgICAgRmluZ2VycHJpbnQgPT4gJEZpbmdlcnByaW50LAogICAgICAgIEhhc2ggICAgICAgID0+ICRIYXNoLAogICAgKTsKCj1jdXQKCnN1YiBDZXJ0aWZpY2F0ZUdldCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBpZiAoICEkUGFyYW17RmlsZW5hbWV9ICYmICEoICRQYXJhbXtGaW5nZXJwcmludH0gJiYgJFBhcmFte0hhc2h9ICkgKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdOZWVkIEZpbGVuYW1lIG9yIEZpbmdlcnByaW50IGFuZCBIYXNoIScKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAoICEkUGFyYW17RmlsZW5hbWV9ICYmICggJFBhcmFte0ZpbmdlcnByaW50fSAmJiAkUGFyYW17SGFzaH0gKSApIHsKICAgICAgICAkUGFyYW17RmlsZW5hbWV9ID0gJFNlbGYtPl9DZXJ0aWZpY2F0ZUZpbGVuYW1lKCVQYXJhbSk7CiAgICAgICAgcmV0dXJuIGlmICEkUGFyYW17RmlsZW5hbWV9OwogICAgfQoKICAgIG15ICRGaWxlICAgICAgICAgICA9ICIkU2VsZi0+e0NlcnRQYXRofS8kUGFyYW17RmlsZW5hbWV9IjsKICAgIG15ICRDZXJ0aWZpY2F0ZVJlZiA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpNYWluJyktPkZpbGVSZWFkKCBMb2NhdGlvbiA9PiAkRmlsZSApOwoKICAgIHJldHVybiBpZiAhJENlcnRpZmljYXRlUmVmOwogICAgcmV0dXJuICQkQ2VydGlmaWNhdGVSZWY7Cn0KCj1oZWFkMiBDZXJ0aWZpY2F0ZVJlbW92ZSgpCgpyZW1vdmUgYSBsb2NhbCBjZXJ0aWZpY2F0ZQoKICAgICRDcnlwdE9iamVjdC0+Q2VydGlmaWNhdGVSZW1vdmUoCiAgICAgICAgRmlsZW5hbWUgPT4gJENlcnRpZmljYXRlSGFzaCwKICAgICk7CgogICAgJENyeXB0T2JqZWN0LT5DZXJ0aWZpY2F0ZVJlbW92ZSgKICAgICAgICBIYXNoICAgICAgICA9PiAkQ2VydGlmaWNhdGVIYXNoLAogICAgICAgIEZpbmdlcnByaW50ID0+ICRDZXJ0aWZpY2F0ZUhhc2gsCiAgICApOwoKPWN1dAoKc3ViIENlcnRpZmljYXRlUmVtb3ZlIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJERCT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkRCJyk7CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIGlmICggISRQYXJhbXtGaWxlbmFtZX0gJiYgISggJFBhcmFte0hhc2h9ICYmICRQYXJhbXtGaW5nZXJwcmludH0gKSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ05lZWQgRmlsZW5hbWUgb3IgSGFzaCBhbmQgRmluZ2VycHJpbnQhJwogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIGlmICggISRQYXJhbXtGaWxlbmFtZX0gJiYgJFBhcmFte0hhc2h9ICYmICRQYXJhbXtGaW5nZXJwcmludH0gKSB7CiAgICAgICAgJFBhcmFte0ZpbGVuYW1lfSA9ICRTZWxmLT5fQ2VydGlmaWNhdGVGaWxlbmFtZSglUGFyYW0pOwogICAgICAgIHJldHVybiBpZiAhJFBhcmFte0ZpbGVuYW1lfTsKICAgIH0KCiAgICBteSAlUmVzdWx0OwoKICAgIG15ICVDZXJ0aWZpY2F0ZUF0dHJpYnV0ZXMgPSAkU2VsZi0+Q2VydGlmaWNhdGVBdHRyaWJ1dGVzKAogICAgICAgIENlcnRpZmljYXRlID0+ICRTZWxmLT5DZXJ0aWZpY2F0ZUdldCggRmlsZW5hbWUgPT4gJFBhcmFte0ZpbGVuYW1lfSApLAogICAgICAgIEZpbGVuYW1lICAgID0+ICRQYXJhbXtGaWxlbmFtZX0sCiAgICApOwoKICAgIGlmICglQ2VydGlmaWNhdGVBdHRyaWJ1dGVzKSB7CiAgICAgICAgJFNlbGYtPlNpZ25lckNlcnRSZWxhdGlvbkRlbGV0ZSgKICAgICAgICAgICAgQ0FGaW5nZXJwcmludCA9PiAkQ2VydGlmaWNhdGVBdHRyaWJ1dGVze0ZpbmdlcnByaW50fSwKICAgICAgICApOwogICAgfQoKICAgICMgcHJpdmF0ZSBjZXJ0aWZpY2F0ZSBzaG91bGRuJ3QgZXhpc3RzIGlmIGNlcnRpZmljYXRlIGlzIGRlbGV0ZWQKICAgICMgdGhlcmVmb3IgaWYgZXhpc3RzLCBmaXJzdCByZW1vdmUgcHJpdmF0ZSBjZXJ0aWZpY2F0ZQogICAgIyBpZiBwcml2YXRlIGRlbGV0ZSBmYWlscyBhYm9ydCBjZXJ0aWZpY2F0ZSByZW1vdmluZwoKICAgIG15ICgkUHJpdmF0ZUV4aXN0cykgPSAkU2VsZi0+UHJpdmF0ZUdldCgKICAgICAgICBGaWxlbmFtZSA9PiAkUGFyYW17RmlsZW5hbWV9LAogICAgKTsKCiAgICBpZiAoJFByaXZhdGVFeGlzdHMpIHsKICAgICAgICBteSAlUHJpdmF0ZVJlc3VsdHMgPSAkU2VsZi0+UHJpdmF0ZVJlbW92ZSgKICAgICAgICAgICAgRmlsZW5hbWUgPT4gJFBhcmFte0ZpbGVuYW1lfSwKICAgICAgICApOwogICAgICAgIGlmICggISRQcml2YXRlUmVzdWx0c3tTdWNjZXNzZnVsfSApIHsKICAgICAgICAgICAgJVJlc3VsdCA9ICgKICAgICAgICAgICAgICAgIFN1Y2Nlc3NmdWwgPT4gMCwKICAgICAgICAgICAgICAgIE1lc3NhZ2UgICAgPT4gIkRlbGV0ZSBjZXJ0aWZpY2F0ZSBhYm9ydGVkLCAkUHJpdmF0ZVJlc3VsdHN7TWVzc2FnZX06ICQhISIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybiAlUmVzdWx0OwogICAgICAgIH0KICAgIH0KCiAgICBteSAkTWVzc2FnZSA9ICJDZXJ0aWZpY2F0ZSBzdWNjZXNzZnVsbHkgcmVtb3ZlZCI7CiAgICBteSAkU3VjY2VzcyA9IDE7CgogICAgIyByZW1vdmUgY2VydGlmaWNhdGUKICAgIG15ICRDZXJ0ID0gdW5saW5rICIkU2VsZi0+e0NlcnRQYXRofS8kUGFyYW17RmlsZW5hbWV9IjsKICAgIGlmICggISRDZXJ0ICkgewogICAgICAgICRNZXNzYWdlID0gIkltcG9zc2libGUgdG8gcmVtb3ZlIGNlcnRpZmljYXRlOiAkU2VsZi0+e0NlcnRQYXRofS8kUGFyYW17RmlsZW5hbWV9OiAkISEiOwogICAgICAgICRTdWNjZXNzID0gMDsKICAgIH0KCiAgICBpZiAoJFByaXZhdGVFeGlzdHMpIHsKICAgICAgICAkTWVzc2FnZSAuPSAiLiBQcml2YXRlIGNlcnRpZmljYXRlIHN1Y2Nlc3NmdWxseSBkZWxldGVkIjsKICAgIH0KCiAgICBpZiAoJFN1Y2Nlc3MpIHsKICAgICAgICByZXR1cm4gaWYgISREQk9iamVjdC0+RG8oCiAgICAgICAgICAgIFNRTCAgPT4gIkRFTEVURSBGUk9NIHNtaW1lX2tleXMgV0hFUkUgZmlsZV9uYW1lID0gPyBBTkQga2V5X3R5cGUgPSA/IiwKICAgICAgICAgICAgQmluZCA9PiBbCiAgICAgICAgICAgICAgICBcJFBhcmFte0ZpbGVuYW1lfSwKICAgICAgICAgICAgICAgIFwnY2VydCcsCiAgICAgICAgICAgIF0sCiAgICAgICAgKTsKCiAgICAgICAgbXkgJENhY2hlT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNhY2hlJyk7CgogICAgICAgICRDYWNoZU9iamVjdC0+Q2xlYW5VcCgKICAgICAgICAgICAgVHlwZSA9PiAnU01JTUVfQ2VydCcsCiAgICAgICAgKTsKICAgICAgICAkQ2FjaGVPYmplY3QtPkNsZWFuVXAoCiAgICAgICAgICAgIFR5cGUgPT4gJ1NNSU1FX1ByaXZhdGUnLAogICAgICAgICk7CiAgICB9CgogICAgJVJlc3VsdCA9ICgKICAgICAgICBTdWNjZXNzZnVsID0+ICRTdWNjZXNzLAogICAgICAgIE1lc3NhZ2UgICAgPT4gJE1lc3NhZ2UsCiAgICApOwoKICAgIHJldHVybiAlUmVzdWx0Owp9Cgo9aGVhZDIgQ2VydGlmaWNhdGVMaXN0KCkKCkdldCBoYXNoIHJlZiBvZiBsb2NhbCBjZXJ0aWZpY2F0ZXMgZmlsZW5hbWVzKElEID0+IEZpbGVuYW1lKQoKb3IKCkFycmF5IG9mIGZpbGVuYW1lcwoKICAgIG15ICRDZXJ0TGlzdCA9ICRDcnlwdE9iamVjdC0+Q2VydGlmaWNhdGVMaXN0KAogICAgICAgIFJlc3VsdFR5cGUgPT4gJ0FSUkFZL0hBU0gnICMgJ0FSUkFZJyBieSBkZWZhdWx0CiAgICApOwoKPWN1dAoKc3ViIENlcnRpZmljYXRlTGlzdCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICREQk9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEQicpOwoKICAgIG15ICRSZXN1bHRUeXBlID0gJFBhcmFte1Jlc3VsdFR5cGV9IHx8ICdBUlJBWSc7CgogICAgcmV0dXJuIGlmICEkREJPYmplY3QtPlByZXBhcmUoCiAgICAgICAgU1FMICA9PiAiU0VMRUNUIGlkLCBmaWxlX25hbWUgRlJPTSBzbWltZV9rZXlzIFdIRVJFIGtleV90eXBlID0gPyIsCiAgICAgICAgQmluZCA9PiBbIFwnY2VydCcsIF0sCiAgICApOwoKICAgIG15ICVDZXJ0aWZpY2F0ZUxpc3Q7CiAgICBteSBAQ2VydGlmaWNhdGVMaXN0OwoKICAgIFJPVzoKICAgIHdoaWxlICggbXkgQFJvdyA9ICREQk9iamVjdC0+RmV0Y2hyb3dBcnJheSgpICkgewogICAgICAgIGlmICggJFJlc3VsdFR5cGUgZXEgJ0hBU0gnICkgewogICAgICAgICAgICAkQ2VydGlmaWNhdGVMaXN0eyAkUm93WzBdIH0gPSAkUm93WzFdOwogICAgICAgICAgICBuZXh0IFJPVzsKICAgICAgICB9CgogICAgICAgIHB1c2ggQENlcnRpZmljYXRlTGlzdCwgJFJvd1sxXTsKICAgIH0KCiAgICByZXR1cm4gJUNlcnRpZmljYXRlTGlzdCBpZiAkUmVzdWx0VHlwZSBlcSAnSEFTSCc7CiAgICByZXR1cm4gQENlcnRpZmljYXRlTGlzdDsKfQoKPWhlYWQyIENlcnRpZmljYXRlQXR0cmlidXRlcygpCgpnZXQgY2VydGlmaWNhdGUgYXR0cmlidXRlcwoKICAgIG15ICVDZXJ0aWZpY2F0ZUF0dHJpYnV0ZXMgPSAkQ3J5cHRPYmplY3QtPkNlcnRpZmljYXRlQXR0cmlidXRlcygKICAgICAgICBDZXJ0aWZpY2F0ZSA9PiAkQ2VydGlmaWNhdGVTdHJpbmcsCiAgICAgICAgRmlsZW5hbWUgICAgPT4gJzEyMzQ1LjEnLCAgICAgICAgICAgICAgIyBvcHRpb25hbCAodXNlZnVsIHRvIHVzZSBjYWNoZSkKICAgICk7Cgo9Y3V0CgpzdWIgQ2VydGlmaWNhdGVBdHRyaWJ1dGVzIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJUF0dHJpYnV0ZXM7CiAgICBpZiAoICEkUGFyYW17Q2VydGlmaWNhdGV9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnTmVlZCBDZXJ0aWZpY2F0ZSEnCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgIyBnZXQgY2FjaGUgb2JqZWN0CiAgICBteSAkQ2FjaGVPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2FjaGUnKTsKCiAgICBteSAkQ2FjaGVLZXk7CiAgICBpZiAoIGRlZmluZWQgJFBhcmFte0ZpbGVuYW1lfSAmJiAkUGFyYW17RmlsZW5hbWV9ICkgewoKICAgICAgICAkQ2FjaGVLZXkgPSAnQ2VydEF0dHJpYnV0ZXM6OkZpbGVuYW1lOjonIC4gJFBhcmFte0ZpbGVuYW1lfTsKCiAgICAgICAgIyBjaGVjayBjYWNoZQogICAgICAgIG15ICRDYWNoZSA9ICRDYWNoZU9iamVjdC0+R2V0KAogICAgICAgICAgICBUeXBlID0+ICdTTUlNRV9DZXJ0JywKICAgICAgICAgICAgS2V5ICA9PiAkQ2FjaGVLZXksCiAgICAgICAgKTsKCiAgICAgICAgIyByZXR1cm4gaWYgY2FjaGUgZm91bmQsCiAgICAgICAgcmV0dXJuICV7JENhY2hlfSBpZiByZWYgJENhY2hlIGVxICdIQVNIJzsKICAgIH0KCiAgICAjIGdldCB0ZW1wIGZpbGUgb2JqZWN0CiAgICBteSAkRmlsZVRlbXBPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6RmlsZVRlbXAnKTsKCiAgICBteSAoICRGSCwgJEZpbGVuYW1lICkgPSAkRmlsZVRlbXBPYmplY3QtPlRlbXBGaWxlKCk7CiAgICBwcmludCAkRkggJFBhcmFte0NlcnRpZmljYXRlfTsKICAgIGNsb3NlICRGSDsKCiAgICAkU2VsZi0+X0ZldGNoQXR0cmlidXRlc0Zyb21DZXJ0KCAkRmlsZW5hbWUsIFwlQXR0cmlidXRlcyApOwoKICAgIGlmICggJEF0dHJpYnV0ZXN7SGFzaH0gKSB7CiAgICAgICAgJEF0dHJpYnV0ZXN7RmlsZW5hbWV9ID0gJFBhcmFte0ZpbGVuYW1lfSBpZiAkUGFyYW17RmlsZW5hbWV9OwogICAgICAgIG15ICgkUHJpdmF0ZSkgPSAkU2VsZi0+UHJpdmF0ZUdldCglQXR0cmlidXRlcyk7CiAgICAgICAgaWYgKCRQcml2YXRlKSB7CiAgICAgICAgICAgICRBdHRyaWJ1dGVze1ByaXZhdGV9ID0gJ1llcyc7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkQXR0cmlidXRlc3tQcml2YXRlfSA9ICdObyc7CiAgICAgICAgfQogICAgICAgICRBdHRyaWJ1dGVze1R5cGV9ID0gJ2NlcnQnOwogICAgfQoKICAgIGlmICgkQ2FjaGVLZXkpIHsKCiAgICAgICAgIyBzZXQgY2FjaGUKICAgICAgICAkQ2FjaGVPYmplY3QtPlNldCgKICAgICAgICAgICAgVHlwZSAgPT4gJ1NNSU1FX0NlcnQnLAogICAgICAgICAgICBLZXkgICA9PiAkQ2FjaGVLZXksCiAgICAgICAgICAgIFZhbHVlID0+IFwlQXR0cmlidXRlcywKICAgICAgICAgICAgVFRMICAgPT4gJFNlbGYtPntDYWNoZVRUTH0sCiAgICAgICAgKTsKICAgIH0KCiAgICByZXR1cm4gJUF0dHJpYnV0ZXM7Cn0KCj1oZWFkMiBDZXJ0aWZpY2F0ZVJlYWQoKQoKc2hvdyBhIGxvY2FsIGNlcnRpZmljYXRlIGluIHBsYWluIHRleHQKCiAgICBteSAkQ2VydGlmaWNhdGVUZXh0ID0gJENyeXB0T2JqZWN0LT5DZXJ0aWZpY2F0ZVJlYWQoCiAgICAgICAgRmlsZW5hbWUgPT4gJENlcnRpZmljYXRlRmlsZW5hbWUsCiAgICApOwoKICAgIG15ICRDZXJ0aWZpY2F0ZVRleHQgPSAkQ3J5cHRPYmplY3QtPkNlcnRpZmljYXRlUmVhZCgKICAgICAgICBGaW5nZXJwcmludCA9PiAkRmluZ2VycHJpbnQsCiAgICAgICAgSGFzaCAgICAgICAgPT4gJEhhc2gsCiAgICApOwoKPWN1dAoKc3ViIENlcnRpZmljYXRlUmVhZCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBpZiAoICEkUGFyYW17RmlsZW5hbWV9ICYmICEoICRQYXJhbXtGaW5nZXJwcmludH0gJiYgJFBhcmFte0hhc2h9ICkgKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdOZWVkIEZpbGVuYW1lIG9yIEZpbmdlcnByaW50IGFuZCBIYXNoIScKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAoICEkUGFyYW17RmlsZW5hbWV9ICYmICggJFBhcmFte0ZpbmdlcnByaW50fSAmJiAkUGFyYW17SGFzaH0gKSApIHsKICAgICAgICAkUGFyYW17RmlsZW5hbWV9ID0gJFNlbGYtPl9DZXJ0aWZpY2F0ZUZpbGVuYW1lKCVQYXJhbSk7CiAgICAgICAgcmV0dXJuIGlmICEkUGFyYW17RmlsZW5hbWV9OwogICAgfQoKICAgIG15ICRGaWxlID0gIiRTZWxmLT57Q2VydFBhdGh9LyRQYXJhbXtGaWxlbmFtZX0iOwoKICAgICMgY2hlY2sgaWYgZmlsZSBleGlzdHMgYW5kIGNhbiBiZSByZWFkZWQKICAgIGlmICggIS1lICRGaWxlICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiQ2VydGlmaWNhdGUgJEZpbGUgZG9lcyBub3QgZXhpc3QhIgogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKCAhLXIgJEZpbGUgKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJDYW4gbm90IHJlYWQgY2VydGlmaWNhdGUgJEZpbGUhIgogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgc2V0IG9wdGlvbnMgdG8gcmV0cmlldmUgY2VydGljaWF0ZSBjb250ZW50cwogICAgbXkgJE9wdGlvbnMgPSAieDUwOSAtaW4gJEZpbGUgLW5vb3V0IC10ZXh0IjsKCiAgICAjIGdldCB0aGUgb3V0cHV0IHN0cmluZwogICAgbXkgJE91dHB1dCA9IHF4eyRTZWxmLT57Q21kfSAkT3B0aW9ucyAyPiYxfTsKCiAgICByZXR1cm4gJE91dHB1dDsKfQoKPWhlYWQyIFByaXZhdGVGaWxlU2VhcmNoKCkKCkxvb2tzIGZvciBhIGdpdmVuIHNlYXJjaCBwYXJhbWV0ZXIgaW4gcGh5c2ljYWwgY2VydGlmaWNhdGVzLCBub3QgcmVjb21tZW5kZWQgZm9yIGluZGV4ZWQgYXR0cmlidXRlcy4KCiAgICBteSBAUmVzdWx0ID0gJENyeXB0T2JqZWN0LT5Qcml2YXRlRmlsZVNlYXJjaCgKICAgICAgICBTZWFyY2ggPT4gJ3NvbWUgdGV4dCB0byBzZWFyY2gnLAogICAgICAgIFZhbGlkICA9PiAxICAjIG9wdGlvbmFsCiAgICApOwoKPWN1dAoKc3ViIFByaXZhdGVGaWxlU2VhcmNoIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJERCT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkRCJyk7CgogICAgbXkgJFNlYXJjaCA9ICRQYXJhbXtTZWFyY2h9IC8vICcnOwogICAgJFBhcmFte1ZhbGlkfSAvLz0gMDsKCiAgICBteSAlQ2VydGlmaWNhdGVzOwogICAgaWYgKCBJc0hhc2hSZWZXaXRoRGF0YSggJFBhcmFte0NlcnRpZmljYXRlc30gKSApIHsKICAgICAgICAlQ2VydGlmaWNhdGVzID0gJXsgJFBhcmFte0NlcnRpZmljYXRlc30gfTsKICAgIH0KICAgIGVsc2UgewogICAgICAgICVDZXJ0aWZpY2F0ZXMgPSAkU2VsZi0+Q2VydGlmaWNhdGVMaXN0KAogICAgICAgICAgICBSZXN1bHRUeXBlID0+ICJIQVNIIgogICAgICAgICk7CiAgICB9CgogICAgbXkgQFJlc3VsdDsKCiAgICBDRVJUSUZJQ0FURUlEOgogICAgZm9yIG15ICRDZXJ0aWZpY2F0ZUlEICggc29ydCBrZXlzICVDZXJ0aWZpY2F0ZXMgKSB7CiAgICAgICAgbXkgJUF0dHJpYnV0ZXM7CiAgICAgICAgbXkgJEZpbGVuYW1lID0gJENlcnRpZmljYXRlc3skQ2VydGlmaWNhdGVJRH07CgogICAgICAgIG15ICRIaXQgPSAkU2VsZi0+X05vbkluZGV4ZWRBdHRyaWJ1dGVzTG9va3VwKAogICAgICAgICAgICBTZWFyY2ggICAgID0+ICRTZWFyY2gsCiAgICAgICAgICAgIEF0dHJpYnV0ZXMgPT4gXCVBdHRyaWJ1dGVzLAogICAgICAgICAgICBGaWxlbmFtZSAgID0+ICRGaWxlbmFtZSwKICAgICAgICApOwoKICAgICAgICBuZXh0IENFUlRJRklDQVRFSUQgaWYgISRIaXQ7CiAgICAgICAgbmV4dCBDRVJUSUZJQ0FURUlEIGlmICFJc1N0cmluZ1dpdGhEYXRhKCAkQXR0cmlidXRlc3tQcml2YXRlfSApOwogICAgICAgIG5leHQgQ0VSVElGSUNBVEVJRCBpZiAkQXR0cmlidXRlc3tQcml2YXRlfSBuZSAnWWVzJzsKCiAgICAgICAgbXkgJEV4cGlyZWQ7CiAgICAgICAgaWYgKCAkUGFyYW17VmFsaWR9ICkgewogICAgICAgICAgICAkRXhwaXJlZCA9ICRTZWxmLT5LZXlFeHBpcmVkQ2hlY2soCiAgICAgICAgICAgICAgICBFbmREYXRlID0+ICRBdHRyaWJ1dGVze0VuZERhdGV9LAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgbmV4dCBDRVJUSUZJQ0FURUlEIGlmICRFeHBpcmVkOwoKICAgICAgICAkQXR0cmlidXRlc3tUeXBlfSAgICAgICAgICA9ICdrZXknOwogICAgICAgICRBdHRyaWJ1dGVze0ZpbGVuYW1lfSAgICAgID0gJEZpbGVuYW1lOwogICAgICAgICRBdHRyaWJ1dGVze0NlcnRpZmljYXRlSUR9ID0gJENlcnRpZmljYXRlSUQ7CgogICAgICAgIHB1c2ggQFJlc3VsdCwgXCVBdHRyaWJ1dGVzOwogICAgfQoKICAgIHJldHVybiBAUmVzdWx0Owp9Cgo9aGVhZDIgUHJpdmF0ZVNlYXJjaCgpCgpSZXR1cm5zIGEgbGlzdCBvZiBwcml2YXRlIGtleXMgc2VhcmNoaW5nIHVzaW5nIGluZGV4YWJsZSBhdHRyaWJ1dGVzLgoKICAgIG15IEBSZXN1bHQgPSAkQ3J5cHRPYmplY3QtPlByaXZhdGVTZWFyY2goCiAgICAgICAgU2VhcmNoID0+ICRTZWFyY2gsCiAgICAgICAgU2VhcmNoVHlwZSA9PiAnZS1tYWlsL2hhc2gvZmlsZW5hbWUvaWQvZmluZ2VycHJpbnQnLCAjIERlZmF1bHQgZS1tYWlsLgogICAgICAgIFZhbGlkICA9PiAxICAjIG9wdGlvbmFsCiAgICApOwoKICAgIG9yCgogICAgbXkgQFJlc3VsdCA9ICRDcnlwdE9iamVjdC0+UHJpdmF0ZVNlYXJjaCgpOyAjIEZvciBhbGwgcHJpdmF0ZSBrZXlzLgoKPWN1dAoKc3ViIFByaXZhdGVTZWFyY2ggewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkREJPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6REInKTsKCiAgICBteSAkU2VhcmNoID0gJFBhcmFte1NlYXJjaH07CiAgICByZXR1cm4gaWYgIUlzU3RyaW5nV2l0aERhdGEoJFNlYXJjaCk7CgogICAgJFBhcmFte1ZhbGlkfSAvLz0gMDsKCiAgICBteSBAUmVzdWx0ID0gJFNlbGYtPl9DZXJ0aWZpY2F0ZUF0dHJpYnV0ZXNHZXQoCiAgICAgICAgU2VhcmNoICAgICA9PiAkU2VhcmNoLAogICAgICAgIFNlYXJjaFR5cGUgPT4gJFBhcmFte1NlYXJjaFR5cGV9LAogICAgICAgIFZhbGlkICAgICAgPT4gJFBhcmFte1ZhbGlkfSwKICAgICAgICBQcml2YXRlICAgID0+IDEsCiAgICApOwoKICAgIHJldHVybiBAUmVzdWx0Owp9Cgo9aGVhZDIgS2V5RXhwaXJlZENoZWNrKCkKCnJldHVybnMgaWYgU01JTUUga2V5IGlzIGV4cGlyZWQKCiAgICBteSAkVmFsaWQgPSAkQ3J5cHRPYmplY3QtPktleUV4cGlyZWRDaGVjaygKICAgICAgICBFbmREYXRlID0+ICdNYXkgMTIgMjM6NTA6NDAgMjAxOCBHTVQnLAogICAgKTsKCj1jdXQKCnN1YiBLZXlFeHBpcmVkQ2hlY2sgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBpZiAoICEkUGFyYW17RW5kRGF0ZX0gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkIEVuZERhdGUhIgogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIG15ICVNb250aHMgPSAoCiAgICAgICAgSmFuID0+ICcwMScsCiAgICAgICAgRmViID0+ICcwMicsCiAgICAgICAgTWFyID0+ICcwMycsCiAgICAgICAgQXByID0+ICcwNCcsCiAgICAgICAgTWF5ID0+ICcwNScsCiAgICAgICAgSnVuID0+ICcwNicsCiAgICAgICAgSnVsID0+ICcwNycsCiAgICAgICAgQXVnID0+ICcwOCcsCiAgICAgICAgU2VwID0+ICcwOScsCiAgICAgICAgT2N0ID0+ICcxMCcsCiAgICAgICAgTm92ID0+ICcxMScsCiAgICAgICAgRGVjID0+ICcxMicsCiAgICApOwoKICAgICMgRW5kRGF0ZSBpcyBpbiB0aGlzIGZvcm1hdDogTWF5IDEyIDIzOjUwOjQwIDIwMTggR01UCiAgICAjIEl0IGlzIHRyYW5zZm9ybWVkIGluIHN1cHBvcnRlZCBmb3JtYXQgZm9yIERhdGVUaW1lT2JqZWN0OiAyMDE4LTA1LTEyVDIzOjUwOjQwR01UCiAgICBpZiAoICRQYXJhbXtFbmREYXRlfSA9fiAvKC4rPylccyguKz8pXHMoXGRcZDpcZFxkOlxkXGQpXHMoXGRcZFxkXGQpXHMoXHcrKS8gKSB7CiAgICAgICAgbXkgJERheSAgID0gaW50KCQyKTsKICAgICAgICBteSAkTW9udGggPSAkTW9udGhzeyQxfTsKICAgICAgICBteSAkWWVhciAgPSAkNDsKCiAgICAgICAgaWYgKCAkRGF5IDwgMTAgKSB7CiAgICAgICAgICAgICREYXkgPSAiMCREYXkiOwogICAgICAgIH0KCiAgICAgICAgbXkgJEVuZERhdGVUaW1lT2JqZWN0ID0gJEtlcm5lbDo6T00tPkNyZWF0ZSgKICAgICAgICAgICAgJ0tlcm5lbDo6U3lzdGVtOjpEYXRlVGltZScsCiAgICAgICAgICAgIE9iamVjdFBhcmFtcyA9PiB7CiAgICAgICAgICAgICAgICBTdHJpbmcgPT4gIiRZZWFyLSIgLiAkTW9udGggLiAiLSIgLiAkRGF5IC4gIlQkMyIgLiAkNSwKICAgICAgICAgICAgfSwKICAgICAgICApOwoKICAgICAgICBteSAkQ3VycmVudFRpbWVPYmplY3QgPSAkS2VybmVsOjpPTS0+Q3JlYXRlKAogICAgICAgICAgICAnS2VybmVsOjpTeXN0ZW06OkRhdGVUaW1lJywKICAgICAgICApOwoKICAgICAgICAjIENoZWNrIGlmIGtleSBpcyBleHBpcmVkLgogICAgICAgIGlmICggJEVuZERhdGVUaW1lT2JqZWN0LT5Db21wYXJlKCBEYXRlVGltZU9iamVjdCA9PiAkQ3VycmVudFRpbWVPYmplY3QgKSA9PSAtMSApIHsKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuOwp9Cgo9aGVhZDIgUHJpdmF0ZUFkZCgpCgphZGQgcHJpdmF0ZSBrZXkKCiAgICBteSAlUmVzdWx0ID0gJENyeXB0T2JqZWN0LT5Qcml2YXRlQWRkKAogICAgICAgIFByaXZhdGUgPT4gJFByaXZhdGVLZXlTdHJpbmcsCiAgICAgICAgU2VjcmV0ICA9PiAnUGFzc3dvcmQnLAogICAgKTsKCj1jdXQKCnN1YiBQcml2YXRlQWRkIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJERCT2JqZWN0ICAgICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkRCJyk7CiAgICBteSAkRGF0ZVRpbWVPYmplY3QgPSAkS2VybmVsOjpPTS0+Q3JlYXRlKCdLZXJuZWw6OlN5c3RlbTo6RGF0ZVRpbWUnKTsKCiAgICBteSAkVXNlcklEID0gJFBhcmFte1VzZXJJRH0gLy8gMTsKCiAgICBmb3IgbXkgJE5lZWRlZCAocXcoUHJpdmF0ZSBTZWNyZXQpKSB7CiAgICAgICAgaWYgKCAhJFBhcmFteyROZWVkZWR9ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCAkTmVlZGVkISIKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICBteSAlUmVzdWx0OwoKICAgICMgZ2V0IHByaXZhdGUgYXR0cmlidXRlcwogICAgbXkgJUF0dHJpYnV0ZXMgPSAkU2VsZi0+UHJpdmF0ZUF0dHJpYnV0ZXMoJVBhcmFtKTsKICAgIGlmICggISRBdHRyaWJ1dGVze01vZHVsdXN9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnTm8gUHJpdmF0ZSBLZXkhJwogICAgICAgICk7CiAgICAgICAgJVJlc3VsdCA9ICgKICAgICAgICAgICAgU3VjY2Vzc2Z1bCA9PiAwLAogICAgICAgICAgICBNZXNzYWdlICAgID0+ICdObyBwcml2YXRlIGtleScsCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgIyBnZXQgY2VydGlmaWNhdGUKICAgIG15IEBDZXJ0aWZpY2F0ZXMgPSAkU2VsZi0+Q2VydGlmaWNhdGVGaWxlU2VhcmNoKCBTZWFyY2ggPT4gJEF0dHJpYnV0ZXN7TW9kdWx1c30gKTsKICAgIGlmICggIUBDZXJ0aWZpY2F0ZXMgKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkIENlcnRpZmljYXRlIG9mIFByaXZhdGUgS2V5IGZpcnN0IC0kQXR0cmlidXRlc3tNb2R1bHVzfSkhIiwKICAgICAgICApOwogICAgICAgICVSZXN1bHQgPSAoCiAgICAgICAgICAgIFN1Y2Nlc3NmdWwgPT4gMCwKICAgICAgICAgICAgTWVzc2FnZSAgICA9PiAiTmVlZCBDZXJ0aWZpY2F0ZSBvZiBQcml2YXRlIEtleSBmaXJzdCAtJEF0dHJpYnV0ZXN7TW9kdWx1c30pISIsCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gJVJlc3VsdDsKICAgIH0KICAgIGVsc2lmICggJCNDZXJ0aWZpY2F0ZXMgPiAwICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnTXVsdGlwbGUgQ2VydGlmaWNhdGVzIHdpdGggdGhlIHNhbWUgTW9kdWx1cywgY2FuXCd0IGFkZCBQcml2YXRlIEtleSEnLAogICAgICAgICk7CiAgICAgICAgJVJlc3VsdCA9ICgKICAgICAgICAgICAgU3VjY2Vzc2Z1bCA9PiAwLAogICAgICAgICAgICBNZXNzYWdlICAgID0+ICdNdWx0aXBsZSBDZXJ0aWZpY2F0ZXMgd2l0aCB0aGUgc2FtZSBNb2R1bHVzLCBjYW5cJ3QgYWRkIFByaXZhdGUgS2V5IScsCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gJVJlc3VsdDsKICAgIH0KICAgIG15ICVDZXJ0aWZpY2F0ZUF0dHJpYnV0ZXMgPSAkU2VsZi0+Q2VydGlmaWNhdGVBdHRyaWJ1dGVzKAogICAgICAgIENlcnRpZmljYXRlID0+ICRTZWxmLT5DZXJ0aWZpY2F0ZUdldCggRmlsZW5hbWUgPT4gJENlcnRpZmljYXRlc1swXS0+e0ZpbGVuYW1lfSApLAogICAgICAgIEZpbGVuYW1lICAgID0+ICRDZXJ0aWZpY2F0ZXNbMF0tPntGaWxlbmFtZX0sCiAgICApOwogICAgaWYgKCAkQ2VydGlmaWNhdGVBdHRyaWJ1dGVze0hhc2h9ICkgewogICAgICAgIG15ICRGaWxlID0gIiRTZWxmLT57UHJpdmF0ZVBhdGh9LyRDZXJ0aWZpY2F0ZXNbMF0tPntGaWxlbmFtZX0iOwogICAgICAgICMjIG5vIGNyaXRpYwogICAgICAgIGlmICggb3BlbiggbXkgJFByaXZLZXlGSCwgJz4nLCAiJEZpbGUiICkgKSB7CiAgICAgICAgICAgICMjIHVzZSBjcml0aWMKICAgICAgICAgICAgcHJpbnQgJFByaXZLZXlGSCAkUGFyYW17UHJpdmF0ZX07CiAgICAgICAgICAgIGNsb3NlICRQcml2S2V5Rkg7CiAgICAgICAgICAgIG9wZW4oIG15ICRQYXNzRkgsICc+JywgIiRGaWxlLlAiICk7ICAgICMjIG5vIGNyaXRpYwogICAgICAgICAgICBwcmludCAkUGFzc0ZIICRQYXJhbXtTZWNyZXR9OwogICAgICAgICAgICBjbG9zZSAkUGFzc0ZIOwogICAgICAgICAgICAlUmVzdWx0ID0gKAogICAgICAgICAgICAgICAgU3VjY2Vzc2Z1bCA9PiAxLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgICA9PiAnUHJpdmF0ZSBLZXkgdXBsb2FkZWQhJywKICAgICAgICAgICAgICAgIEZpbGVuYW1lICAgPT4gJENlcnRpZmljYXRlc1swXS0+e0ZpbGVuYW1lfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIHJldHVybiBpZiAhJERCT2JqZWN0LT5EbygKICAgICAgICAgICAgICAgIFNRTCA9PiAiCiAgICAgICAgICAgICAgICAgICAgSU5TRVJUIElOVE8gc21pbWVfa2V5cyAoa2V5X2hhc2gsIGtleV90eXBlLCBmaWxlX25hbWUsIGVtYWlsX2FkZHJlc3MsIGV4cGlyYXRpb25fZGF0ZSwgZmluZ2VycHJpbnQsIHN1YmplY3QsIGNyZWF0ZV90aW1lLCBjcmVhdGVfYnkpCiAgICAgICAgICAgICAgICAgICAgVkFMVUVTCiAgICAgICAgICAgICAgICAgICAgKD8sID8sID8sID8sID8sID8sID8sID8sID8pIiwKICAgICAgICAgICAgICAgIEJpbmQgPT4gWwogICAgICAgICAgICAgICAgICAgIFwkQ2VydGlmaWNhdGVBdHRyaWJ1dGVze0hhc2h9LCBcJEF0dHJpYnV0ZXN7VHlwZX0sCiAgICAgICAgICAgICAgICAgICAgXCRDZXJ0aWZpY2F0ZXNbMF0tPntGaWxlbmFtZX0sIFwkQ2VydGlmaWNhdGVBdHRyaWJ1dGVze0VtYWlsfSwKICAgICAgICAgICAgICAgICAgICBcJENlcnRpZmljYXRlQXR0cmlidXRlc3tTaG9ydEVuZERhdGV9LCBcJENlcnRpZmljYXRlQXR0cmlidXRlc3tGaW5nZXJwcmludH0sCiAgICAgICAgICAgICAgICAgICAgXCRDZXJ0aWZpY2F0ZUF0dHJpYnV0ZXN7U3ViamVjdH0sICAgICAgXCREYXRlVGltZU9iamVjdC0+VG9TdHJpbmcoKSwKICAgICAgICAgICAgICAgICAgICBcJFVzZXJJRCwKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBteSAkQ2FjaGVPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2FjaGUnKTsKCiAgICAgICAgICAgICRDYWNoZU9iamVjdC0+Q2xlYW5VcCgKICAgICAgICAgICAgICAgIFR5cGUgPT4gJ1NNSU1FX0NlcnQnLAogICAgICAgICAgICApOwogICAgICAgICAgICAkQ2FjaGVPYmplY3QtPkNsZWFuVXAoCiAgICAgICAgICAgICAgICBUeXBlID0+ICdTTUlNRV9Qcml2YXRlJywKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIHJldHVybiAlUmVzdWx0OwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIkNhbid0IHdyaXRlICRGaWxlOiAkISEiCiAgICAgICAgICAgICk7CiAgICAgICAgICAgICVSZXN1bHQgPSAoCiAgICAgICAgICAgICAgICBTdWNjZXNzZnVsID0+IDAsCiAgICAgICAgICAgICAgICBNZXNzYWdlICAgID0+ICJDYW4ndCB3cml0ZSAkRmlsZTogJCEhIiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuICVSZXN1bHQ7CiAgICAgICAgfQogICAgfQoKICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgTWVzc2FnZSAgPT4gJ0NhblwndCBhZGQgaW52YWxpZCBwcml2YXRlIGtleSEnCiAgICApOwogICAgJVJlc3VsdCA9ICgKICAgICAgICBTdWNjZXNzZnVsID0+IDAsCiAgICAgICAgTWVzc2FnZSAgICA9PiAnQ2FuXCd0IGFkZCBpbnZhbGlkIHByaXZhdGUga2V5IScsCiAgICApOwoKICAgIHJldHVybiAlUmVzdWx0Owp9Cgo9aGVhZDIgUHJpdmF0ZUdldCgpCgpnZXQgcHJpdmF0ZSBrZXkKCiAgICBteSAoJFByaXZhdGVLZXksICRTZWNyZXQpID0gJENyeXB0T2JqZWN0LT5Qcml2YXRlR2V0KAogICAgICAgIEZpbGVuYW1lID0+ICRQcml2YXRlRmlsZW5hbWUsCiAgICApOwoKICAgIG15ICgkUHJpdmF0ZUtleSwgJFNlY3JldCkgPSAkQ3J5cHRPYmplY3QtPlByaXZhdGVHZXQoCiAgICAgICAgSGFzaCAgICA9PiAkSGFzaCwKICAgICAgICBNb2R1bHVzID0+ICRNb2R1bHVzLAogICAgKTsKCj1jdXQKCnN1YiBQcml2YXRlR2V0IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIGlmICggISRQYXJhbXtGaWxlbmFtZX0gJiYgISggJFBhcmFte0hhc2h9ICYmICRQYXJhbXtNb2R1bHVzfSApICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnTmVlZCBGaWxlbmFtZSBvciBIYXNoIGFuZCBNb2R1bHVzIScKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAoICEkUGFyYW17RmlsZW5hbWV9ICYmICggJFBhcmFte0hhc2h9ICYmICRQYXJhbXtNb2R1bHVzfSApICkgewogICAgICAgICRQYXJhbXtGaWxlbmFtZX0gPSAkU2VsZi0+X1ByaXZhdGVGaWxlbmFtZSgKICAgICAgICAgICAgSGFzaCAgICA9PiAkUGFyYW17SGFzaH0sCiAgICAgICAgICAgIE1vZHVsdXMgPT4gJFBhcmFte01vZHVsdXN9LAogICAgICAgICk7CiAgICAgICAgcmV0dXJuIGlmICEkUGFyYW17RmlsZW5hbWV9OwogICAgfQoKICAgIG15ICRGaWxlID0gIiRTZWxmLT57UHJpdmF0ZVBhdGh9LyRQYXJhbXtGaWxlbmFtZX0iOwoKICAgICMgZ2V0IG1haW4gb2JqZWN0CiAgICBteSAkTWFpbk9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpNYWluJyk7CgogICAgbXkgJFByaXZhdGU7CiAgICBpZiAoIC1lICRGaWxlICkgewogICAgICAgICRQcml2YXRlID0gJE1haW5PYmplY3QtPkZpbGVSZWFkKCBMb2NhdGlvbiA9PiAkRmlsZSApOwogICAgfQoKICAgIHJldHVybiBpZiAhJFByaXZhdGU7CgogICAgIyByZWFkIHNlY3JldAogICAgJEZpbGUgPSAiJFNlbGYtPntQcml2YXRlUGF0aH0vJFBhcmFte0ZpbGVuYW1lfS5QIjsKICAgIG15ICRTZWNyZXQgPSAkTWFpbk9iamVjdC0+RmlsZVJlYWQoIExvY2F0aW9uID0+ICRGaWxlICk7CgogICAgcmV0dXJuICggJCRQcml2YXRlLCAkJFNlY3JldCApIGlmICggJFByaXZhdGUgJiYgJFNlY3JldCApOwoKICAgIHJldHVybjsKfQoKPWhlYWQyIFByaXZhdGVSZW1vdmUoKQoKcmVtb3ZlIHByaXZhdGUga2V5CgogICAgJENyeXB0T2JqZWN0LT5Qcml2YXRlUmVtb3ZlKAogICAgICAgIEZpbGVuYW1lID0+ICRGaWxlbmFtZSwKICAgICk7CgogICAgJENyeXB0T2JqZWN0LT5Qcml2YXRlUmVtb3ZlKAogICAgICAgIEhhc2ggICAgPT4gJEhhc2gsCiAgICAgICAgTW9kdWx1cyA9PiAkTW9kdWx1cywKICAgICk7Cgo9Y3V0CgpzdWIgUHJpdmF0ZVJlbW92ZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICREQk9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEQicpOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBpZiAoICEkUGFyYW17RmlsZW5hbWV9ICYmICEoICRQYXJhbXtIYXNofSAmJiAkUGFyYW17TW9kdWx1c30gKSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ05lZWQgRmlsZW5hbWUgb3IgSGFzaCBhbmQgTW9kdWx1cyEnCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgbXkgJVJldHVybjsKICAgIGlmICggISRQYXJhbXtGaWxlbmFtZX0gJiYgKCAkUGFyYW17SGFzaH0gJiYgJFBhcmFte01vZHVsdXN9ICkgKSB7CiAgICAgICAgJFBhcmFte0ZpbGVuYW1lfSA9ICRTZWxmLT5fUHJpdmF0ZUZpbGVuYW1lKAogICAgICAgICAgICBIYXNoICAgID0+ICRQYXJhbXtIYXNofSwKICAgICAgICAgICAgTW9kdWx1cyA9PiAkUGFyYW17TW9kdWx1c30sCiAgICAgICAgKTsKICAgICAgICAlUmV0dXJuID0gKAogICAgICAgICAgICBTdWNjZXNzZnVsID0+IDAsCiAgICAgICAgICAgIE1lc3NhZ2UgICAgPT4gIkZpbGVuYW1lIG5vdCBmb3VuZCBmb3IgaGFzaDogJFBhcmFte0hhc2h9IGluOiAkU2VsZi0+e1ByaXZhdGVQYXRofSwgJCEhIiwKICAgICAgICApOwogICAgICAgIHJldHVybiAlUmV0dXJuIGlmICEkUGFyYW17RmlsZW5hbWV9OwogICAgfQoKICAgIG15ICRTZWNyZXREZWxldGUgPSB1bmxpbmsgIiRTZWxmLT57UHJpdmF0ZVBhdGh9LyRQYXJhbXtGaWxlbmFtZX0uUCI7CgogICAgIyBhYm9ydCBpZiBzZWNyZXQgaXMgbm90IGRlbGV0ZWQKICAgIGlmICggISRTZWNyZXREZWxldGUgKSB7CiAgICAgICAgJVJldHVybiA9ICgKICAgICAgICAgICAgU3VjY2Vzc2Z1bCA9PiAwLAogICAgICAgICAgICBNZXNzYWdlID0+CiAgICAgICAgICAgICAgICAiRGVsZXRlIHByaXZhdGUgYWJvcnRlZCwgbm90IHBvc3NpYmxlIHRvIGRlbGV0ZSBTZWNyZXQ6ICRTZWxmLT57UHJpdmF0ZVBhdGh9LyRQYXJhbXtGaWxlbmFtZX0uUCwgJCEhIiwKICAgICAgICApOwogICAgICAgIHJldHVybiAlUmV0dXJuOwogICAgfQoKICAgIG15ICRQcml2YXRlRGVsZXRlID0gdW5saW5rICIkU2VsZi0+e1ByaXZhdGVQYXRofS8kUGFyYW17RmlsZW5hbWV9IjsKICAgIGlmICgkUHJpdmF0ZURlbGV0ZSkgewoKICAgICAgICBteSAkQ2VydGlmaWNhdGUgPSAkU2VsZi0+Q2VydGlmaWNhdGVHZXQoCiAgICAgICAgICAgIEZpbGVuYW1lID0+ICRQYXJhbXtGaWxlbmFtZX0sCiAgICAgICAgKTsKCiAgICAgICAgIyBnZXQgY2VydCBhdHRyaWJ1dGVzCiAgICAgICAgbXkgJUNlcnRpZmljYXRlQXR0cmlidXRlcyA9ICRTZWxmLT5DZXJ0aWZpY2F0ZUF0dHJpYnV0ZXMoCiAgICAgICAgICAgIENlcnRpZmljYXRlID0+ICRDZXJ0aWZpY2F0ZSwKICAgICAgICAgICAgRmlsZW5hbWUgICAgPT4gJFBhcmFte0ZpbGVuYW1lfSwKICAgICAgICApOwoKICAgICAgICAkU2VsZi0+U2lnbmVyQ2VydFJlbGF0aW9uRGVsZXRlKAogICAgICAgICAgICBDZXJ0RmluZ2VycHJpbnQgPT4gJENlcnRpZmljYXRlQXR0cmlidXRlc3tGaW5nZXJwcmludH0sCiAgICAgICAgKTsKCiAgICAgICAgJVJldHVybiA9ICgKICAgICAgICAgICAgU3VjY2Vzc2Z1bCA9PiAxLAogICAgICAgICAgICBNZXNzYWdlICAgID0+ICdQcml2YXRlIGtleSBkZWxldGVkIScKICAgICAgICApOwoKICAgICAgICByZXR1cm4gaWYgISREQk9iamVjdC0+RG8oCiAgICAgICAgICAgIFNRTCAgPT4gIkRFTEVURSBGUk9NIHNtaW1lX2tleXMgV0hFUkUgZmlsZV9uYW1lID0gPyBBTkQga2V5X3R5cGUgPSA/IiwKICAgICAgICAgICAgQmluZCA9PiBbCiAgICAgICAgICAgICAgICBcJFBhcmFte0ZpbGVuYW1lfSwKICAgICAgICAgICAgICAgIFwnUCcsCiAgICAgICAgICAgIF0sCiAgICAgICAgKTsKCiAgICAgICAgbXkgJENhY2hlT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNhY2hlJyk7CgogICAgICAgICRDYWNoZU9iamVjdC0+Q2xlYW5VcCgKICAgICAgICAgICAgVHlwZSA9PiAnU01JTUVfQ2VydCcsCiAgICAgICAgKTsKICAgICAgICAkQ2FjaGVPYmplY3QtPkNsZWFuVXAoCiAgICAgICAgICAgIFR5cGUgPT4gJ1NNSU1FX1ByaXZhdGUnLAogICAgICAgICk7CgogICAgICAgIHJldHVybiAlUmV0dXJuOwogICAgfQoKICAgICVSZXR1cm4gPSAoCiAgICAgICAgU3VjY2Vzc2Z1bCA9PiAwLAogICAgICAgIE1lc3NhZ2UgICAgPT4gIkltcG9zc2libGUgdG8gZGVsZXRlIGtleSAkUGFyYW17RmlsZW5hbWV9ICQhISIKICAgICk7CgogICAgcmV0dXJuICVSZXR1cm47Cn0KCj1oZWFkMiBQcml2YXRlTGlzdCgpCgpSZXR1cm5zIGEgaGFzaCBvZiBwcml2YXRlIGtleSBoYXNoZXMoSUQgPT4gRmlsZW5hbWUpLgoKICAgIG15ICRQcml2YXRlTGlzdCA9ICRDcnlwdE9iamVjdC0+UHJpdmF0ZUxpc3QoKTsKCj1jdXQKCnN1YiBQcml2YXRlTGlzdCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICREQk9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEQicpOwoKICAgIG15ICVQcml2YXRlTGlzdDsKCiAgICByZXR1cm4gaWYgISREQk9iamVjdC0+UHJlcGFyZSgKICAgICAgICBTUUwgID0+ICJTZWxlY3QgaWQsIGZpbGVfbmFtZSBGUk9NIHNtaW1lX2tleXMgV0hFUkUga2V5X3R5cGUgPSA/IiwKICAgICAgICBCaW5kID0+IFsgXCdQJywgXSwKICAgICk7CgogICAgd2hpbGUgKCBteSBAUm93ID0gJERCT2JqZWN0LT5GZXRjaHJvd0FycmF5KCkgKSB7CiAgICAgICAgJFByaXZhdGVMaXN0eyAkUm93WzBdIH0gPSAkUHJpdmF0ZUxpc3R7ICRSb3dbMV0gfTsKICAgIH0KCiAgICByZXR1cm4gXCVQcml2YXRlTGlzdDsKCn0KCj1oZWFkMiBQcml2YXRlQXR0cmlidXRlcygpCgpyZXR1cm5zIGF0dHJpYnV0ZXMgb2YgcHJpdmF0ZSBrZXkKCiAgICBteSAlSGFzaCA9ICRDcnlwdE9iamVjdC0+UHJpdmF0ZUF0dHJpYnV0ZXMoCiAgICAgICAgUHJpdmF0ZSAgPT4gJFByaXZhdGVLZXlTdHJpbmcsCiAgICAgICAgU2VjcmV0ICAgPT4gJ1Bhc3N3b3JkJywKICAgICAgICBGaWxlbmFtZSA9PiAnMTIzNDUuMScsICAgICAgICAgICAgICAjIG9wdGlvbmFsICh1c2VmdWwgZm9yIGNhY2hlKQogICAgKTsKCj1jdXQKCnN1YiBQcml2YXRlQXR0cmlidXRlcyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIGZvciBteSAkTmVlZGVkIChxdyhQcml2YXRlIFNlY3JldCkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICROZWVkZWQhIgogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgICMgZ2V0IGNhY2hlIG9iamVjdAogICAgbXkgJENhY2hlT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNhY2hlJyk7CgogICAgbXkgJENhY2hlS2V5OwogICAgaWYgKCBkZWZpbmVkICRQYXJhbXtGaWxlbmFtZX0gJiYgJFBhcmFte0ZpbGVuYW1lfSApIHsKCiAgICAgICAgJENhY2hlS2V5ID0gJ1ByaXZhdGVBdHRyaWJ1dGVzOjpGaWxlbmFtZTo6JyAuICRQYXJhbXtGaWxlbmFtZX07CgogICAgICAgICMgY2hlY2sgY2FjaGUKICAgICAgICBteSAkQ2FjaGUgPSAkQ2FjaGVPYmplY3QtPkdldCgKICAgICAgICAgICAgVHlwZSA9PiAnU01JTUVfUHJpdmF0ZScsCiAgICAgICAgICAgIEtleSAgPT4gJENhY2hlS2V5LAogICAgICAgICk7CgogICAgICAgICMgcmV0dXJuIGlmIGNhY2hlIGZvdW5kLAogICAgICAgIHJldHVybiAleyRDYWNoZX0gaWYgcmVmICRDYWNoZSBlcSAnSEFTSCc7CiAgICB9CgogICAgIyBnZXQgdGVtcCBmaWxlIG9iamVjdAogICAgbXkgJEZpbGVUZW1wT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkZpbGVUZW1wJyk7CgogICAgbXkgJUF0dHJpYnV0ZXM7CiAgICBteSAlT3B0aW9uID0gKAogICAgICAgIE1vZHVsdXMgPT4gJy1tb2R1bHVzJywKICAgICk7CiAgICBteSAoICRGSCwgJEZpbGVuYW1lICkgPSAkRmlsZVRlbXBPYmplY3QtPlRlbXBGaWxlKCk7CiAgICBwcmludCAkRkggJFBhcmFte1ByaXZhdGV9OwogICAgY2xvc2UgJEZIOwogICAgbXkgKCAkRkhTZWNyZXQsICRTZWNyZXRGaWxlICkgPSAkRmlsZVRlbXBPYmplY3QtPlRlbXBGaWxlKCk7CiAgICBwcmludCAkRkhTZWNyZXQgJFBhcmFte1NlY3JldH07CiAgICBjbG9zZSAkRkhTZWNyZXQ7CiAgICBteSAkT3B0aW9ucyAgICA9ICJyc2EgLWluICRGaWxlbmFtZSAtbm9vdXQgLW1vZHVsdXMgLXBhc3NpbiBmaWxlOiRTZWNyZXRGaWxlIjsKICAgIG15ICRMb2dNZXNzYWdlID0gcXh7JFNlbGYtPntDbWR9ICRPcHRpb25zIDI+JjF9OwogICAgdW5saW5rICRTZWNyZXRGaWxlOwogICAgJExvZ01lc3NhZ2UgPX4gdHJ7XHJcbn17fWQ7CiAgICAkTG9nTWVzc2FnZSA9fiBzL01vZHVsdXM9Ly87CiAgICAkQXR0cmlidXRlc3tNb2R1bHVzfSA9ICRMb2dNZXNzYWdlOwogICAgJEF0dHJpYnV0ZXN7VHlwZX0gICAgPSAnUCc7CgogICAgaWYgKCRDYWNoZUtleSkgewoKICAgICAgICAjIHNldCBjYWNoZQogICAgICAgICRDYWNoZU9iamVjdC0+U2V0KAogICAgICAgICAgICBUeXBlICA9PiAnU01JTUVfUHJpdmF0ZScsCiAgICAgICAgICAgIEtleSAgID0+ICRDYWNoZUtleSwKICAgICAgICAgICAgVmFsdWUgPT4gXCVBdHRyaWJ1dGVzLAogICAgICAgICAgICBUVEwgICA9PiAkU2VsZi0+e0NhY2hlVFRMfSwKICAgICAgICApOwogICAgfQoKICAgIHJldHVybiAlQXR0cmlidXRlczsKfQoKPWhlYWQyIFNpZ25lckNlcnRSZWxhdGlvbkFkZCAoKQoKYWRkIGEgcmVsYXRpb24gYmV0d2VlbiBzaWduZXIgY2VydGlmaWNhdGUgYW5kIENBIGNlcnRpZmljYXRlIHRvIGF0dGFjaCB0byB0aGUgc2lnbmF0dXJlCgogICAgbXkgJFN1Y2Nlc3MgPSAkQ3J5cHRPYmplY3QtPlNpZ25lckNlcnRSZWxhdGlvbkFkZCgKICAgICAgICBDZXJ0RmluZ2VycHJpbnQgPT4gJENlcnRGaW5nZXJwcmludCwKICAgICAgICBDQUZpbmdlcnByaW50ID0+ICRDQUZpbmdlcnByaW50LAogICAgICAgIFVzZXJJRCA9PiAxLAogICAgKTsKCj1jdXQKCnN1YiBTaWduZXJDZXJ0UmVsYXRpb25BZGQgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIG5lZWRlZCBzdHVmZgogICAgZm9yIG15ICROZWVkZWQgKHF3KFVzZXJJRCBDQUlEIENlcnRpZmljYXRlSUQpKSB7CiAgICAgICAgaWYgKCAhJFBhcmFteyROZWVkZWR9ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCAkTmVlZGVkISIKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICBteSBAQ2VydFJlc3VsdCA9ICRTZWxmLT5Qcml2YXRlU2VhcmNoKAogICAgICAgIFNlYXJjaCAgICAgPT4gJFBhcmFte0NlcnRpZmljYXRlSUR9LAogICAgICAgIFNlYXJjaFR5cGUgPT4gJ2lkJywKICAgICk7CgogICAgIyByZXN1bHRzPwogICAgaWYgKCAhc2NhbGFyIEBDZXJ0UmVzdWx0ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBNZXNzYWdlICA9PiAiV3JvbmcgQ2VydEZpbmdlcnByaW50LCBjZXJ0aWZpY2F0ZSBub3QgZm91bmQhIiwKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICApOwogICAgICAgIHJldHVybiAwOwogICAgfQoKICAgICMgc2VhcmNoIGNlcnRpZmljYXRlcyBieSBJRAogICAgbXkgQENBUmVzdWx0ID0gJFNlbGYtPkNlcnRpZmljYXRlU2VhcmNoKAogICAgICAgIFNlYXJjaCAgICAgPT4gJFBhcmFte0NBSUR9LAogICAgICAgIFNlYXJjaFR5cGUgPT4gJ2lkJywKICAgICk7CgogICAgIyByZXN1bHRzPwogICAgaWYgKCAhc2NhbGFyIEBDQVJlc3VsdCApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgTWVzc2FnZSAgPT4gIldyb25nIENBRmluZ2VycHJpbnQsIGNlcnRpZmljYXRlIG5vdCBmb3VuZCEiLAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgaWYgKCAkQ2VydFJlc3VsdFswXS0+e0ZpbmdlcnByaW50fSBlcSAkQ0FSZXN1bHRbMF0tPntGaW5nZXJwcmludH0gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdDZXJ0RmluZ2VycHJpbnQgbXVzdCBiZSBkaWZmZXJlbnQgdG8gdGhlIENBRmluZ2VycHJpbnQgcGFyYW0uJywKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBteSAkU3VjY2VzcyA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEQicpLT5EbygKICAgICAgICBTUUwgPT4gJ0lOU0VSVCBJTlRPIHNtaW1lX3NpZ25lcl9jZXJ0X3JlbGF0aW9ucycKICAgICAgICAgICAgLiAnICggY2VydF9oYXNoLCBjZXJ0X2ZpbmdlcnByaW50LCBjYV9oYXNoLCBjYV9maW5nZXJwcmludCwgY3JlYXRlX3RpbWUsIGNyZWF0ZV9ieSwgY2hhbmdlX3RpbWUsIGNoYW5nZV9ieSknCiAgICAgICAgICAgIC4gJyBWQUxVRVMgKD8sID8sID8sID8sIGN1cnJlbnRfdGltZXN0YW1wLCA/LCBjdXJyZW50X3RpbWVzdGFtcCwgPyknLAogICAgICAgIEJpbmQgPT4gWwogICAgICAgICAgICBcJENlcnRSZXN1bHRbMF0tPntIYXNofSwgXCRDZXJ0UmVzdWx0WzBdLT57RmluZ2VycHJpbnR9LCBcJENBUmVzdWx0WzBdLT57SGFzaH0sCiAgICAgICAgICAgIFwkQ0FSZXN1bHRbMF0tPntGaW5nZXJwcmludH0sCiAgICAgICAgICAgIFwkUGFyYW17VXNlcklEfSwgXCRQYXJhbXtVc2VySUR9LAogICAgICAgIF0sCiAgICApOwoKICAgIHJldHVybiAkU3VjY2VzczsKfQoKPWhlYWQyIFNpZ25lckNlcnRSZWxhdGlvbkdldCAoKQoKZ2V0IHJlbGF0aW9uIGRhdGEgYnkgSUQgb3IgYnkgQ2VydGlmaWNhdGUgZmluZ2VyIHByaW50CnJldHVybnMgZGF0YSBIYXNoIGlmIElEIGdpdmVuIG9yIEFycmF5IG9mIGFsbCByZWxhdGlvbnMgaWYgQ2VydEZpbmdlcnByaW50IGdpdmVuCgogICAgbXkgJURhdGEgPSAkQ3J5cHRPYmplY3QtPlNpZ25lckNlcnRSZWxhdGlvbkdldCgKICAgICAgICBJRCA9PiAkUmVsYXRpb25JRCwKICAgICk7CgogICAgbXkgQERhdGEgPSAkQ3J5cHRPYmplY3QtPlNpZ25lckNlcnRSZWxhdGlvbkdldCgKICAgICAgICBDZXJ0RmluZ2VycHJpbnQgPT4gJENlcnRpZmljYXRlRmluZ2VycHJpbnQsCiAgICApOwoKPWN1dAoKc3ViIFNpZ25lckNlcnRSZWxhdGlvbkdldCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBpZiAoICEkUGFyYW17SUR9ICYmICEkUGFyYW17Q2VydEZpbmdlcnByaW50fSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ05lZWRlZCBJRCBvciBDZXJ0RmluZ2VycHJpbnQhJwogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgZ2V0IGRhdGFiYXNlIG9iamVjdAogICAgbXkgJERCT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkRCJyk7CgogICAgIyBJRAogICAgbXkgJURhdGE7CiAgICBteSBARGF0YTsKICAgIGlmICggJFBhcmFte0lEfSApIHsKICAgICAgICBteSAkU3VjY2VzcyA9ICREQk9iamVjdC0+UHJlcGFyZSgKICAgICAgICAgICAgU1FMID0+CiAgICAgICAgICAgICAgICAnU0VMRUNUIGlkLCBjZXJ0X2hhc2gsIGNlcnRfZmluZ2VycHJpbnQsIGNhX2hhc2gsIGNhX2ZpbmdlcnByaW50LCBjcmVhdGVfdGltZSwgY3JlYXRlX2J5LCBjaGFuZ2VfdGltZSwgY2hhbmdlX2J5JwogICAgICAgICAgICAgICAgLiAnIEZST00gc21pbWVfc2lnbmVyX2NlcnRfcmVsYXRpb25zJwogICAgICAgICAgICAgICAgLiAnIFdIRVJFIGlkID0gPyBPUkRFUiBCWSBjcmVhdGVfdGltZSBERVNDJywKICAgICAgICAgICAgQmluZCAgPT4gWyBcJFBhcmFte0lEfSBdLAogICAgICAgICAgICBMaW1pdCA9PiAxLAogICAgICAgICk7CgogICAgICAgIGlmICgkU3VjY2VzcykgewogICAgICAgICAgICB3aGlsZSAoIG15IEBSZXN1bHREYXRhID0gJERCT2JqZWN0LT5GZXRjaHJvd0FycmF5KCkgKSB7CgogICAgICAgICAgICAgICAgIyBmb3JtYXQgZGF0ZQogICAgICAgICAgICAgICAgJURhdGEgPSAoCiAgICAgICAgICAgICAgICAgICAgSUQgICAgICAgICAgICAgID0+ICRSZXN1bHREYXRhWzBdLAogICAgICAgICAgICAgICAgICAgIENlcnRIYXNoICAgICAgICA9PiAkUmVzdWx0RGF0YVsxXSwKICAgICAgICAgICAgICAgICAgICBDZXJ0RmluZ2VycHJpbnQgPT4gJFJlc3VsdERhdGFbMl0sCiAgICAgICAgICAgICAgICAgICAgQ0FIYXNoICAgICAgICAgID0+ICRSZXN1bHREYXRhWzNdLAogICAgICAgICAgICAgICAgICAgIENBRmluZ2VycHJpbnQgICA9PiAkUmVzdWx0RGF0YVs0XSwKICAgICAgICAgICAgICAgICAgICBDaGFuZ2VkICAgICAgICAgPT4gJFJlc3VsdERhdGFbNV0sCiAgICAgICAgICAgICAgICAgICAgQ2hhbmdlZEJ5ICAgICAgID0+ICRSZXN1bHREYXRhWzZdLAogICAgICAgICAgICAgICAgICAgIENyZWF0ZWQgICAgICAgICA9PiAkUmVzdWx0RGF0YVs3XSwKICAgICAgICAgICAgICAgICAgICBDcmVhdGVkQnkgICAgICAgPT4gJFJlc3VsdERhdGFbOF0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAlRGF0YSB8fCAnJzsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ0RCIGVycm9yOiBub3QgcG9zc2libGUgdG8gZ2V0IHJlbGF0aW9uIScsCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQogICAgZWxzZSB7CiAgICAgICAgbXkgJFN1Y2Nlc3MgPSAkREJPYmplY3QtPlByZXBhcmUoCiAgICAgICAgICAgIFNRTCA9PgogICAgICAgICAgICAgICAgJ1NFTEVDVCBpZCwgY2VydF9oYXNoLCBjZXJ0X2ZpbmdlcnByaW50LCBjYV9oYXNoLCBjYV9maW5nZXJwcmludCwgY3JlYXRlX3RpbWUsIGNyZWF0ZV9ieSwgY2hhbmdlX3RpbWUsIGNoYW5nZV9ieScKICAgICAgICAgICAgICAgIC4gJyBGUk9NIHNtaW1lX3NpZ25lcl9jZXJ0X3JlbGF0aW9ucycKICAgICAgICAgICAgICAgIC4gJyBXSEVSRSBjZXJ0X2ZpbmdlcnByaW50ID0gPyBPUkRFUiBCWSBpZCBERVNDJywKICAgICAgICAgICAgQmluZCA9PiBbIFwkUGFyYW17Q2VydEZpbmdlcnByaW50fSBdLAogICAgICAgICk7CgogICAgICAgIGlmICgkU3VjY2VzcykgewogICAgICAgICAgICB3aGlsZSAoIG15IEBSZXN1bHREYXRhID0gJERCT2JqZWN0LT5GZXRjaHJvd0FycmF5KCkgKSB7CiAgICAgICAgICAgICAgICBteSAlUmVzdWx0RGF0YSA9ICgKICAgICAgICAgICAgICAgICAgICBJRCAgICAgICAgICAgICAgPT4gJFJlc3VsdERhdGFbMF0sCiAgICAgICAgICAgICAgICAgICAgQ2VydEhhc2ggICAgICAgID0+ICRSZXN1bHREYXRhWzFdLAogICAgICAgICAgICAgICAgICAgIENlcnRGaW5nZXJwcmludCA9PiAkUmVzdWx0RGF0YVsyXSwKICAgICAgICAgICAgICAgICAgICBDQUhhc2ggICAgICAgICAgPT4gJFJlc3VsdERhdGFbM10sCiAgICAgICAgICAgICAgICAgICAgQ0FGaW5nZXJwcmludCAgID0+ICRSZXN1bHREYXRhWzRdLAogICAgICAgICAgICAgICAgICAgIENoYW5nZWQgICAgICAgICA9PiAkUmVzdWx0RGF0YVs1XSwKICAgICAgICAgICAgICAgICAgICBDaGFuZ2VkQnkgICAgICAgPT4gJFJlc3VsdERhdGFbNl0sCiAgICAgICAgICAgICAgICAgICAgQ3JlYXRlZCAgICAgICAgID0+ICRSZXN1bHREYXRhWzddLAogICAgICAgICAgICAgICAgICAgIENyZWF0ZWRCeSAgICAgICA9PiAkUmVzdWx0RGF0YVs4XSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBwdXNoIEBEYXRhLCBcJVJlc3VsdERhdGE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIEBEYXRhOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAnREIgZXJyb3I6IG5vdCBwb3NzaWJsZSB0byBnZXQgcmVsYXRpb25zIScsCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuOwp9Cgo9aGVhZDIgU2lnbmVyQ2VydFJlbGF0aW9uRXhpc3RzICgpCgpyZXR1cm5zIHRoZSBJRCBpZiB0aGUgcmVsYXRpb24gZXhpc3RzCgogICAgbXkgJFJlc3VsdCA9ICRDcnlwdE9iamVjdC0+U2lnbmVyQ2VydFJlbGF0aW9uRXhpc3RzKAogICAgICAgIENlcnRGaW5nZXJwcmludCA9PiAkQ2VydGlmaWNhdGVGaW5nZXJwcmludCwKICAgICAgICBDQUZpbmdlcnByaW50ID0+ICRDQUZpbmdlcnByaW50LAogICAgKTsKCiAgICBteSAkUmVzdWx0ID0gJENyeXB0T2JqZWN0LT5TaWduZXJDZXJ0UmVsYXRpb25FeGlzdHMoCiAgICAgICAgSUQgPT4gJFJlbGF0aW9uSUQsCiAgICApOwoKPWN1dAoKc3ViIFNpZ25lckNlcnRSZWxhdGlvbkV4aXN0cyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBpZiAoICEkUGFyYW17SUR9ICYmICEoICRQYXJhbXtDZXJ0RmluZ2VycHJpbnR9ICYmICRQYXJhbXtDQUZpbmdlcnByaW50fSApICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCBJRCBvciBDZXJ0RmluZ2VycHJpbnQgJiBDQUZpbmdlcnByaW50ISIKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIGdldCBkYXRhYmFzZSBvYmplY3QKICAgIG15ICREQk9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEQicpOwoKICAgIGlmICggJFBhcmFte0NlcnRGaW5nZXJwcmludH0gJiYgJFBhcmFte0NBRmluZ2VycHJpbnR9ICkgewogICAgICAgIG15ICREYXRhOwogICAgICAgIG15ICRTdWNjZXNzID0gJERCT2JqZWN0LT5QcmVwYXJlKAogICAgICAgICAgICBTUUwgPT4gJ1NFTEVDVCBpZCBGUk9NIHNtaW1lX3NpZ25lcl9jZXJ0X3JlbGF0aW9ucyAnCiAgICAgICAgICAgICAgICAuICdXSEVSRSBjZXJ0X2ZpbmdlcnByaW50ID0gPyBBTkQgY2FfZmluZ2VycHJpbnQgPSA/JywKICAgICAgICAgICAgQmluZCAgPT4gWyBcJFBhcmFte0NlcnRGaW5nZXJwcmludH0sIFwkUGFyYW17Q0FGaW5nZXJwcmludH0gXSwKICAgICAgICAgICAgTGltaXQgPT4gMSwKICAgICAgICApOwoKICAgICAgICBpZiAoJFN1Y2Nlc3MpIHsKICAgICAgICAgICAgd2hpbGUgKCBteSBAUmVzdWx0RGF0YSA9ICREQk9iamVjdC0+RmV0Y2hyb3dBcnJheSgpICkgewogICAgICAgICAgICAgICAgJERhdGEgPSAkUmVzdWx0RGF0YVswXTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJERhdGEgfHwgJyc7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdEQiBlcnJvcjogbm90IHBvc3NpYmxlIHRvIGNoZWNrIHJlbGF0aW9uIScsCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQogICAgZWxzaWYgKCAkUGFyYW17SUR9ICkgewogICAgICAgIG15ICREYXRhOwogICAgICAgIG15ICRTdWNjZXNzID0gJERCT2JqZWN0LT5QcmVwYXJlKAogICAgICAgICAgICBTUUwgPT4gJ1NFTEVDVCBpZCBGUk9NIHNtaW1lX3NpZ25lcl9jZXJ0X3JlbGF0aW9ucyAnCiAgICAgICAgICAgICAgICAuICdXSEVSRSBpZCA9ID8nLAogICAgICAgICAgICBCaW5kICA9PiBbIFwkUGFyYW17SUR9LCBdLAogICAgICAgICAgICBMaW1pdCA9PiAxLAogICAgICAgICk7CgogICAgICAgIGlmICgkU3VjY2VzcykgewogICAgICAgICAgICB3aGlsZSAoIG15IEBSZXN1bHREYXRhID0gJERCT2JqZWN0LT5GZXRjaHJvd0FycmF5KCkgKSB7CiAgICAgICAgICAgICAgICAkRGF0YSA9ICRSZXN1bHREYXRhWzBdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAkRGF0YSB8fCAnJzsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ0RCIGVycm9yOiBub3QgcG9zc2libGUgdG8gY2hlY2sgcmVsYXRpb24hJywKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuOwp9Cgo9aGVhZDIgU2lnbmVyQ2VydFJlbGF0aW9uRGVsZXRlICgpCgpyZXR1cm5zIDEgaWYgc3VjY2VzcwoKICAgICMgZGVsZXRlIGFsbCByZWxhdGlvbnMgZm9yIGEgY2VydAogICAgbXkgJFN1Y2Nlc3MgPSAkQ3J5cHRPYmplY3QtPlNpZ25lckNlcnRSZWxhdGlvbkRlbGV0ZSAoCiAgICAgICAgQ2VydEZpbmdlcnByaW50ID0+ICRDZXJ0RmluZ2VycHJpbnQsCiAgICAgICAgVXNlcklEID0+IDEsCiAgICApOwoKICAgICMgZGVsZXRlIG9uZSByZWxhdGlvbiBieSBJRAogICAgJFN1Y2Nlc3MgPSAkQ3J5cHRPYmplY3QtPlNpZ25lckNlcnRSZWxhdGlvbkRlbGV0ZSAoCiAgICAgICAgSUQgPT4gJzQ1JywKICAgICk7CgogICAgIyBkZWxldGUgb25lIHJlbGF0aW9uIGJ5IENlcnRGaW5nZXJwcmludCAmIENBRmluZ2VycHJpbnQKICAgICRTdWNjZXNzID0gJENyeXB0T2JqZWN0LT5TaWduZXJDZXJ0UmVsYXRpb25EZWxldGUgKAogICAgICAgIENlcnRGaW5nZXJwcmludCA9PiAkQ2VydEZpbmdlcnByaW50LAogICAgICAgIENBRmluZ2VycHJpbnQgICA9PiAkQ0FGaW5nZXJwcmludCwKICAgICk7CgogICAgIyBkZWxldGUgb25lIHJlbGF0aW9uIGJ5IENBRmluZ2VycHJpbnQKICAgICRTdWNjZXNzID0gJENyeXB0T2JqZWN0LT5TaWduZXJDZXJ0UmVsYXRpb25EZWxldGUgKAogICAgICAgIENBRmluZ2VycHJpbnQgICA9PiAkQ0FGaW5nZXJwcmludCwKICAgICk7Cgo9Y3V0CgpzdWIgU2lnbmVyQ2VydFJlbGF0aW9uRGVsZXRlIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIGlmICggISRQYXJhbXtDZXJ0RmluZ2VycHJpbnR9ICYmICEkUGFyYW17SUR9ICYmICEkUGFyYW17Q0FGaW5nZXJwcmludH0gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdOZWVkIElEIG9yIENlcnRGaW5nZXJwcmludCBvciBDQUZpbmdlcnByaW50IScKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIGdldCBkYXRhYmFzZSBvYmplY3QKICAgIG15ICREQk9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEQicpOwoKICAgIGlmICggJFBhcmFte0lEfSApIHsKCiAgICAgICAgIyBkZWxldGUgcm93CiAgICAgICAgbXkgJFN1Y2Nlc3MgPSAkREJPYmplY3QtPkRvKAogICAgICAgICAgICBTUUwgPT4gJ0RFTEVURSBGUk9NIHNtaW1lX3NpZ25lcl9jZXJ0X3JlbGF0aW9ucyAnCiAgICAgICAgICAgICAgICAuICdXSEVSRSBpZCA9ID8nLAogICAgICAgICAgICBCaW5kID0+IFsgXCRQYXJhbXtJRH0gXSwKICAgICAgICApOwoKICAgICAgICBpZiAoICEkU3VjY2VzcyApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiREIgRXJyb3IsIE5vdCBwb3NzaWJsZSB0byBkZWxldGUgcmVsYXRpb24gSUQ6JFBhcmFte0lEfSEiLAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICRTdWNjZXNzOwogICAgfQogICAgZWxzaWYgKCAkUGFyYW17Q2VydEZpbmdlcnByaW50fSAmJiAkUGFyYW17Q0FGaW5nZXJwcmludH0gKSB7CgogICAgICAgICMgZGVsZXRlIG9uZSByb3cKICAgICAgICBteSAkU3VjY2VzcyA9ICREQk9iamVjdC0+RG8oCiAgICAgICAgICAgIFNRTCA9PiAnREVMRVRFIEZST00gc21pbWVfc2lnbmVyX2NlcnRfcmVsYXRpb25zICcKICAgICAgICAgICAgICAgIC4gJ1dIRVJFIGNlcnRfZmluZ2VycHJpbnQgPSA/IEFORCBjYV9maW5nZXJwcmludCA9ID8nLAogICAgICAgICAgICBCaW5kID0+IFsgXCRQYXJhbXtDZXJ0RmluZ2VycHJpbnR9LCBcJFBhcmFte0NBRmluZ2VycHJpbnR9IF0sCiAgICAgICAgKTsKCiAgICAgICAgaWYgKCAhJFN1Y2Nlc3MgKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgTWVzc2FnZSA9PgogICAgICAgICAgICAgICAgICAgICJEQiBFcnJvciwgTm90IHBvc3NpYmxlIHRvIGRlbGV0ZSByZWxhdGlvbiBmb3IgIgogICAgICAgICAgICAgICAgICAgIC4gIkNlcnRGaW5nZXJwcmludDokUGFyYW17Q2VydEZpbmdlcnByaW50fSBhbmQgQ0FGaW5nZXJwcmludDokUGFyYW17Q0FGaW5nZXJwcmludH0hIiwKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkU3VjY2VzczsKICAgIH0KICAgIGVsc2lmICggJFBhcmFte0NBRmluZ2VycHJpbnR9ICkgewoKICAgICAgICAjIGRlbGV0ZSBvbmUgcm93CiAgICAgICAgbXkgJFN1Y2Nlc3MgPSAkREJPYmplY3QtPkRvKAogICAgICAgICAgICBTUUwgPT4gJ0RFTEVURSBGUk9NIHNtaW1lX3NpZ25lcl9jZXJ0X3JlbGF0aW9ucyAnCiAgICAgICAgICAgICAgICAuICdXSEVSRSBjYV9maW5nZXJwcmludCA9ID8nLAogICAgICAgICAgICBCaW5kID0+IFsgXCRQYXJhbXtDQUZpbmdlcnByaW50fSBdLAogICAgICAgICk7CgogICAgICAgIGlmICggISRTdWNjZXNzICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4KICAgICAgICAgICAgICAgICAgICAiREIgRXJyb3IsIE5vdCBwb3NzaWJsZSB0byBkZWxldGUgcmVsYXRpb24gZm9yICIKICAgICAgICAgICAgICAgICAgICAuICJDQUZpbmdlcnByaW50OiRQYXJhbXtDQUZpbmdlcnByaW50fSEiLAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICRTdWNjZXNzOwogICAgfQogICAgZWxzZSB7CgogICAgICAgICMgZGVsZXRlIGFsbCByb3dzCiAgICAgICAgbXkgJFN1Y2Nlc3MgPSAkREJPYmplY3QtPkRvKAogICAgICAgICAgICBTUUwgPT4gJ0RFTEVURSBGUk9NIHNtaW1lX3NpZ25lcl9jZXJ0X3JlbGF0aW9ucyAnCiAgICAgICAgICAgICAgICAuICdXSEVSRSBjZXJ0X2ZpbmdlcnByaW50ID0gPycsCiAgICAgICAgICAgIEJpbmQgPT4gWyBcJFBhcmFte0NlcnRGaW5nZXJwcmludH0gXSwKICAgICAgICApOwoKICAgICAgICBpZiAoICEkU3VjY2VzcyApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBNZXNzYWdlID0+CiAgICAgICAgICAgICAgICAgICAgIkRCIEVycm9yLCBOb3QgcG9zc2libGUgdG8gZGVsZXRlIHJlbGF0aW9ucyBmb3IgQ2VydEZpbmdlcnByaW50OiRQYXJhbXtDZXJ0RmluZ2VycHJpbnR9ISIsCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJFN1Y2Nlc3M7CiAgICB9CiAgICByZXR1cm47Cn0KCj1oZWFkMiBDaGVja0NlcnRQYXRoKCkKCkNoZWNrcyBhbmQgZml4ZXMgdGhlIHByaXZhdGUgc2VjcmV0IGZpbGVzIHRoYXQgZG8gbm90IGhhdmUgYW4gaW5kZXguIChOZWVkZWQgYmVjYXVzZSB0aGlzCmNoYW5nZWQgZHVyaW5nIHRoZSBtaWdyYXRpb24gZnJvbSBPVFJTIDMuMCB0byAzLjEuKQoKQ2hlY2tzIGFuZCBmaXhlZCBjZXJ0aWZpY2F0ZXMsIHByaXZhdGUga2V5cyBhbmQgc2VjcmV0cyBmaWxlcyB0byBoYXZlIGEgY29ycmVjdCBuYW1lCmRlcGVuZGluZyBvbiB0aGUgY3VycmVudCBPcGVuU1NMIGhhc2ggYWxnb3JpdGhtLgoKICAgIG15ICRSZXN1bHQgPSAkQ3J5cHRPYmplY3QtPkNoZWNrQ2VydFBhdGggKCk7CgogICAgYSByZXN1bHQgY291bGQgYmU6CgogICAgJFJlc3VsdCA9IHsKICAgICAgICBTdWNjZXNzID0+IDEgICAgICAgICAgICAgICAgIyBvciAwIGlmIGZhaWxzCiAgICAgICAgRGV0YWlscyA9PiAkRGV0YWlscyAgICAgICAgICMgYSByZWFkYWJsZSBzdHJpbmcgbG9nIG9mIGFsbCBhY3Rpdml0aWVzIGFuZCBlcnJvcnMgZm91bmQKICAgIH07Cgo9Y3V0CgpzdWIgQ2hlY2tDZXJ0UGF0aCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgbm9ybWFsaXplIHByaXZhdGUgc2VjcmV0IGZpbGUgbmFtZXMKICAgICMKICAgICMgaW4gb3RycyAzLjAgcHJpdmF0ZSBzZWNyZXQgZmlsZXMgYXJlIHN0b3JlZCBpbiBmb3JtYXQgbGlrZSAxMjM0NTY3OC5wLCBmcm9tIG90cnMgMy4xIHRoaXMKICAgICMgZmlsZXMgbXVzdCBiZSBpbiBhIGZvcm1hdCBsaWtlIDEyMzQ1Njc4LjAucCB3aGVyZSAuMCBjb3VsZCBiZSBmcm9tIDAgdG8gOSBkZXBlbmRpbmcgb24gdGhlCiAgICAjIHByaXZhdGUga2V5IGZpbGUgbmFtZS4KCiAgICBteSAkTm9ybWFsaXplUmVzdWx0ID0gJFNlbGYtPl9Ob3JtYWxpemVQcml2YXRlU2VjcmV0RmlsZXMoKTsKCiAgICBpZiAoICEkTm9ybWFsaXplUmVzdWx0LT57U3VjY2Vzc30gKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgU3VjY2VzcyA9PiAwLAogICAgICAgICAgICBEZXRhaWxzID0+ICROb3JtYWxpemVSZXN1bHQtPntEZXRhaWxzfQogICAgICAgICAgICAgICAgLiAiXG48cmVkPkVycm9yIGluIE5vcm1hbGl6ZSBQcml2YXRlIFNlY3JldCBGaWxlcy48L3JlZD5cblxuIiwKICAgICAgICAgICAgU2hvcnREZXRhaWxzID0+ICI8cmVkPkVycm9yIGluIE5vcm1hbGl6ZSBQcml2YXRlIFNlY3JldCBGaWxlcy48L3JlZD5cblxuIiwKICAgICAgICB9OwogICAgfQoKICAgICMgcmUtY2FsY3VsYXRlIGNlcnRpZmljYXRlcyBoYXNoZXMgdXNpbmcgY3VycmVudCBvcGVuc3NsCiAgICAjCiAgICAjIGZyb20gb3BlbnNzbCAxLjAuMCBhIG5ldyBoYXNoIGFsZ29yaXRobSBoYXMgYmVlbiBpbXBsZW1lbnRlZCwgdGhpcyBuZXcgaGFzaCBpcyBub3QgY29tcGF0aWJsZQogICAgIyB3aXRoIHRoZSBvbGQgaGFzaCBhbGwgc3RvcmVkIGNlcnRpZmljYXRlcyBuYW1lcyBtdXN0IG1hdGNoIGN1cnJlbnQgaGFzaAogICAgIyBhbGwgYWZmZWN0ZWQgY2VydGlmaWNhdGVzLCBwcml2YXRlIGtleXMgYW5kIHByaXZhdGUgc2VjcmV0cyBoYXMgdG8gYmUgcmVuYW1lZAogICAgIyBhbGwgYWZmZWN0ZWQgcmVsYXRpb25zIGhhcyB0byBiZSB1cGRhdGVkCiAgICBteSAkUmVIYXNoU3VjY2VzcyA9ICRTZWxmLT5fUmVIYXNoQ2VydGlmaWNhdGVzKCk7CgogICAgaWYgKCAhJFJlSGFzaFN1Y2Nlc3MtPntTdWNjZXNzfSApIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBTdWNjZXNzID0+IDAsCiAgICAgICAgICAgIERldGFpbHMgPT4gJE5vcm1hbGl6ZVJlc3VsdC0+e0RldGFpbHN9IC4gJFJlSGFzaFN1Y2Nlc3MtPntEZXRhaWxzfQogICAgICAgICAgICAgICAgLiAiXG48cmVkPkVycm9yIGluIFJlLUhhc2ggQ2VydGlmaWNhdGUgRmlsZXMuPC9yZWQ+XG5cbiIsCiAgICAgICAgICAgIFNob3J0RGV0YWlscyA9PiAiPHJlZD5FcnJvciBpbiBSZS1IYXNoIENlcnRpZmljYXRlIEZpbGVzLjwvcmVkPlxuXG4iLAogICAgICAgIH07CiAgICB9CgogICAgbXkgJFJlSW5kZXhDZXJ0aWZpY2F0ZVN1Y2Nlc3MgPSAkU2VsZi0+UmVJbmRleENlcnRpZmljYXRlKCBDYW5SZUhhc2ggPT4gMCApOwogICAgbXkgJFJlSW5kZXhQcml2YXRlU3VjY2VzcyAgICAgPSAkU2VsZi0+UmVJbmRleFByaXZhdGUoIENhbk5vcm1hbGl6ZSA9PiAwICk7CgogICAgcmV0dXJuIHsKICAgICAgICBTdWNjZXNzID0+IDEsCiAgICAgICAgRGV0YWlscyA9PiAkTm9ybWFsaXplUmVzdWx0LT57RGV0YWlsc30KICAgICAgICAgICAgLiAkUmVIYXNoU3VjY2Vzcy0+e0RldGFpbHN9CiAgICAgICAgICAgIC4gJFJlSW5kZXhDZXJ0aWZpY2F0ZVN1Y2Nlc3MtPntEZXRhaWxzfQogICAgICAgICAgICAuICRSZUluZGV4UHJpdmF0ZVN1Y2Nlc3MtPntEZXRhaWxzfSwKICAgIH07Cn0KCj1iZWdpbiBJbnRlcm5hbDoKCj1jdXQKCnN1YiBfSW5pdCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgZ2V0IGNvbmZpZyBvYmplY3QKICAgIG15ICRDb25maWdPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpOwoKICAgICRTZWxmLT57QmlufSAgICAgICAgID0gJENvbmZpZ09iamVjdC0+R2V0KCdTTUlNRTo6QmluJykgfHwgJy91c3IvYmluL29wZW5zc2wnOwogICAgJFNlbGYtPntDZXJ0UGF0aH0gICAgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ1NNSU1FOjpDZXJ0UGF0aCcpOwogICAgJFNlbGYtPntQcml2YXRlUGF0aH0gPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ1NNSU1FOjpQcml2YXRlUGF0aCcpOwoKICAgICMgZ2V0IHRoZSBjYWNoZSBUVEwgKGluIHNlY29uZHMpCiAgICAkU2VsZi0+e0NhY2hlVFRMfSA9IGludCggJENvbmZpZ09iamVjdC0+R2V0KCdTTUlNRTo6Q2FjaGVUVEwnKSB8fCA4NjQwMCApOwoKICAgIGlmICggJF5PID1+IG17bXN3aW59aSApIHsKCiAgICAgICAgIyB0YWtlIGNhcmUgdG8gZGVhbCBwcm9wZXJseSB3aXRoIHBhdGhzIGNvbnRhaW5pbmcgd2hpdGVzcGFjZQogICAgICAgICRTZWxmLT57Q21kfSA9IHFxeyIkU2VsZi0+e0Jpbn0ifTsKICAgIH0KICAgIGVsc2UgewoKICAgICAgICAjIG1ha2Ugc3VyZSB0aGF0IHdlIGFyZSBnZXR0aW5nIFBPU0lYIChpLmUuIGVuZ2xpc2gpIG1lc3NhZ2VzIGZyb20gb3BlbnNzbAogICAgICAgICRTZWxmLT57Q21kfSA9ICJMQ19NRVNTQUdFUz1QT1NJWCAkU2VsZi0+e0Jpbn0iOwogICAgfQoKICAgICMgZGV0ZXJtaW5lIFN5c3RlbSBVc2VybmFtZSB0byBtYWtlIHN1cmUgZWFjaCB1c2VyIGhhcyBhbiBvd24gLnJuZCBmaWxlCiAgICBteSAkU3lzdGVtVXNlcm5hbWUgPSAkPDsKCiAgICAjIGVuc3VyZSB0aGF0IHRoZXJlIGlzIGEgcmFuZG9tIHN0YXRlIGZpbGUgdGhhdCB3ZSBjYW4gd3JpdGUgdG8gKG90aGVyd2lzZSBvcGVuc3NsIHdpbGwgYmFpbCkKICAgICRFTlZ7UkFOREZJTEV9ID0gJENvbmZpZ09iamVjdC0+R2V0KCdUZW1wRGlyJykgLiAnLy5ybmRfJyAuICIkU3lzdGVtVXNlcm5hbWUiOyAgICAjIyBubyBjcml0aWMKCiAgICAjIHByZXBlbmQgUkFOREZJTEUgZGVjbGFyYXRpb24gdG8gb3BlbnNzbCBjbWQKICAgICRTZWxmLT57Q21kfSA9ICJIT01FPSIgLiAkQ29uZmlnT2JqZWN0LT5HZXQoJ0hvbWUnKSAuICIgUkFOREZJTEU9JEVOVntSQU5ERklMRX0gJFNlbGYtPntDbWR9IjsKCiAgICAjIGdldCB0aGUgb3BlbnNzbCB2ZXJzaW9uIHN0cmluZywgZS5nLiBPcGVuU1NMIDAuOS44ZSAyMyBGZWIgMjAwNwogICAgJFNlbGYtPntPcGVuU1NMVmVyc2lvblN0cmluZ30gPSBxeHskU2VsZi0+e0NtZH0gdmVyc2lvbn07CgogICAgIyBnZXQgdGhlIG9wZW5zc2wgbWFqb3IgdmVyc2lvbiwgZS5nLiAxIGZvciB2ZXJzaW9uIDEuMC4wCiAgICBpZiAoICRTZWxmLT57T3BlblNTTFZlcnNpb25TdHJpbmd9ID1+IG17IFxBICg/OiAoPzogT3BlbnxMaWJyZSlTU0wgKT8gXHMqICggXGQgKSAgfXhtc2kgKSB7CiAgICAgICAgJFNlbGYtPntPcGVuU1NMTWFqb3JWZXJzaW9ufSA9ICQxOwogICAgfQoKICAgIHJldHVybiAkU2VsZjsKfQoKPWhlYWQyIFJlSW5kZXhDZXJ0aWZpY2F0ZSgpCgogICAgUmVpbmRleGVzIGNlcnRpZmljYXRlcyBmcm9tIGxvY2FsIGZpbGUgc3lzdGVtIHRvIGRhdGFiYXNlLgoKICAgIG15ICRSZXN1bHQgPSAkQ3J5cHRPYmplY3QtPlJlSW5kZXhDZXJ0aWZpY2F0ZSgKICAgICAgICBDYW5SZUhhc2ggPT4gMSAjIFJlcXVpcmVkLCBBbGxvdyB0byByZWhhc2ggY2VydGlmaWNhdGVzLgogICAgKTsKCj1jdXQKCnN1YiBSZUluZGV4Q2VydGlmaWNhdGUgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkTG9nT2JqZWN0ICAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyk7CiAgICBteSAkTWFpbk9iamVjdCAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TWFpbicpOwogICAgbXkgJERCT2JqZWN0ICAgICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkRCJyk7CiAgICBteSAkRGF0ZVRpbWVPYmplY3QgPSAkS2VybmVsOjpPTS0+Q3JlYXRlKCdLZXJuZWw6OlN5c3RlbTo6RGF0ZVRpbWUnKTsKCiAgICBpZiAoICRQYXJhbXtDYW5SZUhhc2h9ICkgewogICAgICAgIG15ICRSZUhhc2hTdWNjZXNzID0gJFNlbGYtPl9SZUhhc2hDZXJ0aWZpY2F0ZXMoKTsKICAgICAgICBpZiAoICEkUmVIYXNoU3VjY2Vzcy0+e1N1Y2Nlc3N9ICkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgU3VjY2VzcyA9PiAwLAogICAgICAgICAgICAgICAgRGV0YWlscyA9PiAkUmVIYXNoU3VjY2Vzcy0+e0RldGFpbHN9CiAgICAgICAgICAgICAgICAgICAgLiAiXG5FcnJvciB3aGlsZSByZS1oYXNoaW5nIGNlcnRpZmljYXRlIGZpbGVzLlxuXG4iLAogICAgICAgICAgICB9OwogICAgICAgIH0KICAgIH0KCiAgICBteSBARmlsZUZpbHRlcnM7CiAgICBmb3IgbXkgJE51bWJlciAoIDAgLi4gOTkgKSB7CiAgICAgICAgcHVzaCBARmlsZUZpbHRlcnMsICIqLiROdW1iZXIiOwogICAgfQoKICAgIG15IEBDZXJ0RmlsZVBhdGhzID0gJE1haW5PYmplY3QtPkRpcmVjdG9yeVJlYWQoCiAgICAgICAgRGlyZWN0b3J5ID0+ICRTZWxmLT57Q2VydFBhdGh9LAogICAgICAgIEZpbHRlciAgICA9PiBcQEZpbGVGaWx0ZXJzLAogICAgKTsKCiAgICBteSBAQ2VydEZpbGVuYW1lczsKICAgIGZvciBteSAkRmlsZVBhdGggKEBDZXJ0RmlsZVBhdGhzKSB7CiAgICAgICAgJEZpbGVQYXRoID1+IHN7XEEuKi99e307CiAgICAgICAgcHVzaCBAQ2VydEZpbGVuYW1lcywgJEZpbGVQYXRoOwogICAgfQoKICAgIG15IEBSZUluZGV4ZWRGaWxlczsKCiAgICBGSUxFTkFNRToKICAgIGZvciBteSAkRmlsZW5hbWUgKEBDZXJ0RmlsZW5hbWVzKSB7CiAgICAgICAgbXkgJFJlc3VsdCA9ICREQk9iamVjdC0+U2VsZWN0QWxsKAogICAgICAgICAgICBTUUwgID0+ICJTRUxFQ1QgZmlsZV9uYW1lIEZST00gc21pbWVfa2V5cyBXSEVSRSBmaWxlX25hbWUgPSA/IEFORCBrZXlfdHlwZSA9ID8iLAogICAgICAgICAgICBCaW5kID0+IFsKICAgICAgICAgICAgICAgIFwkRmlsZW5hbWUsCiAgICAgICAgICAgICAgICBcJ2NlcnQnLAogICAgICAgICAgICBdLAogICAgICAgICAgICBMaW1pdCA9PiAxLAogICAgICAgICk7CgogICAgICAgIG5leHQgRklMRU5BTUUgaWYgSXNBcnJheVJlZldpdGhEYXRhKCRSZXN1bHQpOwoKICAgICAgICBteSAkQ2VydGlmaWNhdGVSZWYgPSAkTWFpbk9iamVjdC0+RmlsZVJlYWQoCiAgICAgICAgICAgIEZpbGVuYW1lICA9PiAkRmlsZW5hbWUsCiAgICAgICAgICAgIERpcmVjdG9yeSA9PiAkU2VsZi0+e0NlcnRQYXRofSwKICAgICAgICApOwogICAgICAgIG5leHQgRklMRU5BTUUgaWYgISRDZXJ0aWZpY2F0ZVJlZjsKCiAgICAgICAgbXkgJUF0dHJpYnV0ZXMgPSAkU2VsZi0+Q2VydGlmaWNhdGVBdHRyaWJ1dGVzKAogICAgICAgICAgICBDZXJ0aWZpY2F0ZSA9PiAkJENlcnRpZmljYXRlUmVmLAogICAgICAgICAgICBGaWxlbmFtZSAgICA9PiAkRmlsZW5hbWUKICAgICAgICApOwogICAgICAgIG5leHQgRklMRU5BTUUgaWYgISVBdHRyaWJ1dGVzOwoKICAgICAgICByZXR1cm4gaWYgISREQk9iamVjdC0+RG8oCiAgICAgICAgICAgIFNRTCA9PiAiCiAgICAgICAgICAgICAgICBJTlNFUlQgSU5UTyBzbWltZV9rZXlzIChrZXlfaGFzaCwga2V5X3R5cGUsIGZpbGVfbmFtZSwgZW1haWxfYWRkcmVzcywgZXhwaXJhdGlvbl9kYXRlLCBmaW5nZXJwcmludCwgc3ViamVjdCwgY3JlYXRlX3RpbWUsIGNyZWF0ZV9ieSkKICAgICAgICAgICAgICAgIFZBTFVFUwogICAgICAgICAgICAgICAgKD8sID8sID8sID8sID8sID8sID8sID8sID8pIiwKICAgICAgICAgICAgQmluZCA9PiBbCiAgICAgICAgICAgICAgICBcJEF0dHJpYnV0ZXN7SGFzaH0sIFwkQXR0cmlidXRlc3tUeXBlfSwKICAgICAgICAgICAgICAgIFwkRmlsZW5hbWUsIFwkQXR0cmlidXRlc3tFbWFpbH0sCiAgICAgICAgICAgICAgICBcJEF0dHJpYnV0ZXN7U2hvcnRFbmREYXRlfSwgXCRBdHRyaWJ1dGVze0ZpbmdlcnByaW50fSwKICAgICAgICAgICAgICAgIFwkQXR0cmlidXRlc3tTdWJqZWN0fSwgICAgICBcJERhdGVUaW1lT2JqZWN0LT5Ub1N0cmluZygpLAogICAgICAgICAgICAgICAgXDEsCiAgICAgICAgICAgIF0sCiAgICAgICAgKTsKCiAgICAgICAgcHVzaCBAUmVJbmRleGVkRmlsZXMsICRGaWxlbmFtZTsKICAgIH0KCiAgICBpZiAoQFJlSW5kZXhlZEZpbGVzKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgRGV0YWlscyA9PiAiU3VjY2Vzc2Z1bGx5IHJlLWluZGV4ZWQgcHVibGljIGZpbGVzOiAiIC4gam9pbiggJywgJywgQFJlSW5kZXhlZEZpbGVzICkgLiAiLlxuIiwKICAgICAgICAgICAgU3VjY2VzcyA9PiAxLAogICAgICAgIH07CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgICBEZXRhaWxzID0+ICJUaGVyZSBpcyBubyBuZWVkIHRvIHJlLWluZGV4IGFueSBwdWJsaWMgZmlsZS5cbiIsCiAgICAgICAgU3VjY2VzcyA9PiAxLAogICAgfTsKfQoKPWhlYWQyIFJlSW5kZXhQcml2YXRlKCkKCiAgICBSZWluZGV4ZXMgcHJpdmF0ZSBmaWxlcyBmcm9tIGxvY2FsIGZpbGUgc3lzdGVtIHRvIGRhdGFiYXNlLgoKICAgIG15ICRSZXN1bHQgPSAkQ3J5cHRPYmplY3QtPlJlSW5kZXhQcml2YXRlKAogICAgICAgIENhbk5vcm1hbGl6ZSA9PiAxICMgUmVxdWlyZWQsIEFsbG93IHRvIG5vcm1hbGl6ZSBwcml2YXRlIGtleXMgYW5kIHNlY3JldHMuCiAgICApOwoKPWN1dAoKc3ViIFJlSW5kZXhQcml2YXRlIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJExvZ09iamVjdCAgICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpOwogICAgbXkgJE1haW5PYmplY3QgICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06Ok1haW4nKTsKICAgIG15ICREQk9iamVjdCAgICAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEQicpOwogICAgbXkgJERhdGVUaW1lT2JqZWN0ID0gJEtlcm5lbDo6T00tPkNyZWF0ZSgnS2VybmVsOjpTeXN0ZW06OkRhdGVUaW1lJyk7CgogICAgaWYgKCAkUGFyYW17Q2FuTm9ybWFsaXplfSApIHsKICAgICAgICBteSAkTm9ybWFsaXplUmVzdWx0ID0gJFNlbGYtPl9Ob3JtYWxpemVQcml2YXRlU2VjcmV0RmlsZXMoKTsKCiAgICAgICAgaWYgKCAhJE5vcm1hbGl6ZVJlc3VsdC0+e1N1Y2Nlc3N9ICkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgU3VjY2VzcyA9PiAwLAogICAgICAgICAgICAgICAgRGV0YWlscyA9PiAkTm9ybWFsaXplUmVzdWx0LT57RGV0YWlsc30KICAgICAgICAgICAgICAgICAgICAuICJcbjxyZWQ+RXJyb3Igd2hpbGUgbm9ybWFsaXppbmcgcHJpdmF0ZSBzZWNyZXQgZmlsZXMuPC9yZWQ+XG5cbiIsCiAgICAgICAgICAgIH07CiAgICAgICAgfQogICAgfQoKICAgIG15IEBGaWxlRmlsdGVyczsKICAgIGZvciBteSAkTnVtYmVyICggMCAuLiA5OSApIHsKICAgICAgICBwdXNoIEBGaWxlRmlsdGVycywgIiouJE51bWJlciI7CiAgICB9CgogICAgIyBnZXQgYWxsIHByaXZhdGUga2V5cyBmcm9tIHRoZSBwcml2YXRlIGRpcmVjdG9yeQogICAgbXkgQFByaXZhdGVGaWxlUGF0aHMgPSAkTWFpbk9iamVjdC0+RGlyZWN0b3J5UmVhZCgKICAgICAgICBEaXJlY3RvcnkgPT4gIiRTZWxmLT57UHJpdmF0ZVBhdGh9IiwKICAgICAgICBGaWx0ZXIgICAgPT4gXEBGaWxlRmlsdGVycywKICAgICk7CgogICAgbXkgQFByaXZhdGVGaWxlbmFtZXM7CiAgICBmb3IgbXkgJEZpbGVQYXRoIChAUHJpdmF0ZUZpbGVQYXRocykgewogICAgICAgICRGaWxlUGF0aCA9fiBze1xBLiovfXt9OwogICAgICAgIHB1c2ggQFByaXZhdGVGaWxlbmFtZXMsICRGaWxlUGF0aDsKICAgIH0KCiAgICBteSBAUmVJbmRleGVkRmlsZXM7CgogICAgRklMRU5BTUU6CiAgICBmb3IgbXkgJEZpbGVuYW1lIChAUHJpdmF0ZUZpbGVuYW1lcykgewogICAgICAgIG15ICRQcml2YXRlS2V5UmVmID0gJE1haW5PYmplY3QtPkZpbGVSZWFkKAogICAgICAgICAgICBGaWxlbmFtZSAgPT4gJEZpbGVuYW1lLAogICAgICAgICAgICBEaXJlY3RvcnkgPT4gJFNlbGYtPntQcml2YXRlUGF0aH0sCiAgICAgICAgKTsKCiAgICAgICAgbXkgJFByaXZhdGVTZWNyZXRLZXlSZWYgPSAkTWFpbk9iamVjdC0+RmlsZVJlYWQoCiAgICAgICAgICAgIEZpbGVuYW1lICA9PiAkRmlsZW5hbWUgLiAnLlAnLAogICAgICAgICAgICBEaXJlY3RvcnkgPT4gJFNlbGYtPntQcml2YXRlUGF0aH0sCiAgICAgICAgKTsKCiAgICAgICAgbXkgJVByaXZhdGVBdHRyaWJ1dGVzID0gJFNlbGYtPlByaXZhdGVBdHRyaWJ1dGVzKAogICAgICAgICAgICBQcml2YXRlID0+ICQkUHJpdmF0ZUtleVJlZiwKICAgICAgICAgICAgU2VjcmV0ICA9PiAkJFByaXZhdGVTZWNyZXRLZXlSZWYsCiAgICAgICAgKTsKCiAgICAgICAgIyBnZXQgcHJpdmF0ZSBhdHRyaWJ1dGVzCiAgICAgICAgaWYgKCAhJFByaXZhdGVBdHRyaWJ1dGVze01vZHVsdXN9ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAnTm8gUHJpdmF0ZSBLZXkhJwogICAgICAgICAgICApOwogICAgICAgICAgICBuZXh0IEZJTEVOQU1FOwogICAgICAgIH0KCiAgICAgICAgbXkgQENlcnRpZmljYXRlcyA9ICRTZWxmLT5DZXJ0aWZpY2F0ZUZpbGVTZWFyY2goIFNlYXJjaCA9PiAkUHJpdmF0ZUF0dHJpYnV0ZXN7TW9kdWx1c30gKTsKICAgICAgICBpZiAoICFAQ2VydGlmaWNhdGVzICkgewogICAgICAgICAgICAkTG9nT2JqZWN0LT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIk5vIGNlcnRpZmljYXRlIG9mIHByaXZhdGUga2V5LSRQcml2YXRlQXR0cmlidXRlc3tNb2R1bHVzfSkhIiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgbmV4dCBGSUxFTkFNRTsKICAgICAgICB9CiAgICAgICAgZWxzaWYgKCBAQ2VydGlmaWNhdGVzID4gMSApIHsKICAgICAgICAgICAgJExvZ09iamVjdC0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJNdWx0aXBsZSBjZXJ0aWZpY2F0ZXMgd2l0aCB0aGUgc2FtZSBtb2R1bHVzLCBjYW4ndCBmZXRjaCBwcml2YXRlIGtleSEiLAogICAgICAgICAgICApOwogICAgICAgICAgICBuZXh0IEZJTEVOQU1FOwogICAgICAgIH0KCiAgICAgICAgbXkgJFJlc3VsdCA9ICREQk9iamVjdC0+U2VsZWN0QWxsKAogICAgICAgICAgICBTUUwgID0+ICJTRUxFQ1QgZmlsZV9uYW1lIEZST00gc21pbWVfa2V5cyBXSEVSRSBmaWxlX25hbWUgPSA/IEFORCBrZXlfdHlwZSA9ID8iLAogICAgICAgICAgICBCaW5kID0+IFsKICAgICAgICAgICAgICAgIFwkRmlsZW5hbWUsCiAgICAgICAgICAgICAgICBcJ1AnLAogICAgICAgICAgICBdLAogICAgICAgICAgICBMaW1pdCA9PiAxLAogICAgICAgICk7CgogICAgICAgIG5leHQgRklMRU5BTUUgaWYgSXNBcnJheVJlZldpdGhEYXRhKCRSZXN1bHQpOwoKICAgICAgICBteSAlQ2VydGlmaWNhdGVBdHRyaWJ1dGVzID0gJFNlbGYtPkNlcnRpZmljYXRlQXR0cmlidXRlcygKICAgICAgICAgICAgQ2VydGlmaWNhdGUgPT4gJFNlbGYtPkNlcnRpZmljYXRlR2V0KCBGaWxlbmFtZSA9PiAkQ2VydGlmaWNhdGVzWzBdLT57RmlsZW5hbWV9ICksCiAgICAgICAgICAgIEZpbGVuYW1lICAgID0+ICRDZXJ0aWZpY2F0ZXNbMF0tPntGaWxlbmFtZX0sCiAgICAgICAgKTsKICAgICAgICBuZXh0IEZJTEVOQU1FIGlmICElQ2VydGlmaWNhdGVBdHRyaWJ1dGVzOwoKICAgICAgICByZXR1cm4gaWYgISREQk9iamVjdC0+RG8oCiAgICAgICAgICAgIFNRTCA9PiAiCiAgICAgICAgICAgICAgICBJTlNFUlQgSU5UTyBzbWltZV9rZXlzIChrZXlfaGFzaCwga2V5X3R5cGUsIGZpbGVfbmFtZSwgZW1haWxfYWRkcmVzcywgZXhwaXJhdGlvbl9kYXRlLCBmaW5nZXJwcmludCwgc3ViamVjdCwgY3JlYXRlX3RpbWUsIGNyZWF0ZV9ieSkKICAgICAgICAgICAgICAgIFZBTFVFUwogICAgICAgICAgICAgICAgKD8sID8sID8sID8sID8sID8sID8sID8sID8pIiwKICAgICAgICAgICAgQmluZCA9PiBbCiAgICAgICAgICAgICAgICBcJENlcnRpZmljYXRlQXR0cmlidXRlc3tIYXNofSwgXCRQcml2YXRlQXR0cmlidXRlc3tUeXBlfSwKICAgICAgICAgICAgICAgIFwkRmlsZW5hbWUsIFwkQ2VydGlmaWNhdGVBdHRyaWJ1dGVze0VtYWlsfSwKICAgICAgICAgICAgICAgIFwkQ2VydGlmaWNhdGVBdHRyaWJ1dGVze1Nob3J0RW5kRGF0ZX0sIFwkQ2VydGlmaWNhdGVBdHRyaWJ1dGVze0ZpbmdlcnByaW50fSwKICAgICAgICAgICAgICAgIFwkQ2VydGlmaWNhdGVBdHRyaWJ1dGVze1N1YmplY3R9LCAgICAgIFwkRGF0ZVRpbWVPYmplY3QtPlRvU3RyaW5nKCksCiAgICAgICAgICAgICAgICBcMSwKICAgICAgICAgICAgXSwKICAgICAgICApOwoKICAgICAgICBwdXNoIEBSZUluZGV4ZWRGaWxlcywgJEZpbGVuYW1lOwogICAgfQoKICAgIGlmIChAUmVJbmRleGVkRmlsZXMpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBTdWNjZXNzID0+IDEsCiAgICAgICAgICAgIERldGFpbHMgPT4gIlN1Y2Nlc3NmdWxseSByZS1pbmRleGVkIHByaXZhdGUgZmlsZXM6ICIgLiBqb2luKCAnLCAnLCBAUmVJbmRleGVkRmlsZXMgKSAuICIuXG4iLAogICAgICAgIH07CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgICBTdWNjZXNzID0+IDEsCiAgICAgICAgRGV0YWlscyA9PiAiVGhlcmUgaXMgbm8gbmVlZCB0byByZS1pbmRleCBhbnkgcHJpdmF0ZSBmaWxlLlxuIiwKICAgIH07Cgp9CgpzdWIgX0ZldGNoQXR0cmlidXRlc0Zyb21DZXJ0IHsKICAgIG15ICggJFNlbGYsICRGaWxlbmFtZSwgJEF0dHJpYnV0ZXNSZWYgKSA9IEBfOwoKICAgICMgVGhlIGhhc2ggYWxnb3JpdGhtIHVzZWQgaW4gdGhlIC1zdWJqZWN0X2hhc2ggYW5kIC1pc3N1ZXJfaGFzaCBvcHRpb25zIGJlZm9yZSBPcGVuU1NMIDEuMC4wCiAgICAjIHdhcyBiYXNlZCBvbiB0aGUgZGVwcmVjYXRlZCBNRDUgYWxnb3JpdGhtIGFuZCB0aGUgZW5jb2Rpbmcgb2YgdGhlIGRpc3Rpbmd1aXNoZWQgbmFtZS4KICAgICMgSW4gT3BlblNTTCAxLjAuMCBhbmQgbGF0ZXIgaXQgaXMgYmFzZWQgb24gYSBjYW5vbmljYWwgdmVyc2lvbiBvZiB0aGUgRE4gdXNpbmcgU0hBMS4KICAgICMKICAgICMgVGhlIG9sZGVyIGFsZ29yaXRobSBjYW4gYmUgdXNlZCB3aXRoIC1zdWJqZWN0X2hhc2hfb2xkIGF0dHJpYnV0ZSwgYnV0IGRvaW5nIHRoaXMgd2lsbCBtaWdodAogICAgIyBjYXVzZSBmb3Igb3BlbnNzbCAxLjAuMCB0aGF0IHRoZSAtQ0FwYXRoIG9wdGlvbiAoZS5nLiBpbiB2ZXJpZnkgZnVuY3Rpb24pIHdpbGwgbm90IGZpbmQgdGhlCiAgICAjIENBIGZpbGVzIGluIHRoZSBwYXRoLCBkdWUgdGhhdCBvcGVuc3NsIHNlYXJjaCBmb3IgdGhlIGZpbGUgbmFtZXMgYmFzZWQgaW4gY3VycmVudCBhbGdvcml0aG0KICAgICMKICAgICMgLXN1YmplY3RfaGFzaF9vbGQgd2FzIHVzZWQgaW4gb3RycyBpbiB0aGUgcGFzdCAodG8ga2VlcCB0aGUgb2xkIGhhc2hlcyBzdHlsZSwgYW5kIHBlcmhhcHMgdG8KICAgICMgZWFzZSBhIG1pZ3JhdGlvbiBiZXR3ZWVuIG9wZW5zc2wgdmVyc2lvbnMgKSBidXQgbm93IGlzIG5vdCByZWNvbW1lbmRlZCBhbnltb3JlLgoKICAgICMgdGVzdGluZyBuZXcgc29sdXRpb24KICAgIG15ICRPcHRpb25TdHJpbmcgPSAnICcKICAgICAgICAuICctc3ViamVjdF9oYXNoICcKICAgICAgICAuICctaXNzdWVyICcKICAgICAgICAuICctZmluZ2VycHJpbnQgLXNoYTEgJwogICAgICAgIC4gJy1zZXJpYWwgJwogICAgICAgIC4gJy1zdWJqZWN0ICcKICAgICAgICAuICctc3RhcnRkYXRlICcKICAgICAgICAuICctZW5kZGF0ZSAnCiAgICAgICAgLiAnLWVtYWlsICcKICAgICAgICAuICctbW9kdWx1cyAnCiAgICAgICAgLiAnICc7CgogICAgIyBjYWxsIGFsbCBhdHRyaWJ1dGVzIGF0IHNhbWUgdGltZQogICAgbXkgJE9wdGlvbnMgPSAieDUwOSAtaW4gJEZpbGVuYW1lIC1ub291dCAkT3B0aW9uU3RyaW5nIjsKCiAgICAjIGdldCB0aGUgb3V0cHV0IHN0cmluZwogICAgbXkgJE91dHB1dCA9IHF4eyRTZWxmLT57Q21kfSAkT3B0aW9ucyAyPiYxfTsKCiAgICAjIGZpbHRlcnMKICAgIG15ICVGaWx0ZXJzID0gKAogICAgICAgIEhhc2ggICAgICAgID0+ICcoXHd7OH0pJywKICAgICAgICBJc3N1ZXIgICAgICA9PiAnaXNzdWVyPVxzKiguKiknLAogICAgICAgIEZpbmdlcnByaW50ID0+ICdTSEExXHNGaW5nZXJwcmludD0oLiopJywKICAgICAgICBTZXJpYWwgICAgICA9PiAnc2VyaWFsPSguKiknLAogICAgICAgIFN1YmplY3QgICAgID0+ICdzdWJqZWN0PVsgXSooPzpcLyk/KC4rPyknLAogICAgICAgIFN0YXJ0RGF0ZSAgID0+ICdub3RCZWZvcmU9KC4qKScsCiAgICAgICAgRW5kRGF0ZSAgICAgPT4gJ25vdEFmdGVyPSguKiknLAogICAgICAgIEVtYWlsICAgICAgID0+ICcoW0EtWmEtejAtOS5fJSstXStAW0EtWmEtejAtOS4tXStcLltBLVphLXpdezIsNH0pJywKICAgICAgICBNb2R1bHVzICAgICA9PiAnTW9kdWx1cz0oLiopJywKICAgICk7CgogICAgIyBwYXJzZSBvdXRwdXQgc3RyaW5nCiAgICBteSBAQXR0cmlidXRlcyA9IHNwbGl0KCAvXG4vLCAkT3V0cHV0ICk7CiAgICBmb3IgbXkgJExpbmUgKEBBdHRyaWJ1dGVzKSB7CgogICAgICAgICMgY2xlYW4gZW5kIHNwYWNlcwogICAgICAgICRMaW5lID1+IHRye1xyXG59e31kOwoKICAgICAgICAjIGxvb2sgZm9yIGV2ZXJ5IGF0dHJpYnV0ZSBieSBmaWx0ZXIKICAgICAgICBGSUxURVI6CiAgICAgICAgZm9yIG15ICRGaWx0ZXIgKCBzb3J0IGtleXMgJUZpbHRlcnMgKSB7CiAgICAgICAgICAgIG5leHQgRklMVEVSIGlmICRMaW5lICF+IG17IFxBICRGaWx0ZXJzeyRGaWx0ZXJ9IFx6IH14bXM7CiAgICAgICAgICAgIG15ICRNYXRjaCA9ICQxIHx8ICcnOwoKICAgICAgICAgICAgIyBlbWFpbCBmaWx0ZXIgaXMgYWxsb3dlZCB0byBtYXRjaCBtdWx0aXBsZSB0aW1lcyBmb3IgYWx0ZXJuYXRlIG5hbWVzIChTdWJqZWN0QWx0TmFtZSkKICAgICAgICAgICAgaWYgKCAkRmlsdGVyIGVxICdFbWFpbCcgKSB7CiAgICAgICAgICAgICAgICBwdXNoIEB7ICRBdHRyaWJ1dGVzUmVmLT57JEZpbHRlcn0gfSwgJE1hdGNoOwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGFsbCBvdGhlciBmaWx0ZXJzIGFyZSBvbmUtdGltZSBtYXRjaGVzLCBzbyB3ZSBleGNsdWRlIHRoZSBmaWx0ZXIgZnJvbSBhbGwgcmVtYWluaW5nIGxpbmVzIChwZXJmb3JtYW5jZSkKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkQXR0cmlidXRlc1JlZi0+eyRGaWx0ZXJ9ID0gJE1hdGNoOwogICAgICAgICAgICAgICAgZGVsZXRlICRGaWx0ZXJzeyRGaWx0ZXJ9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBsYXN0IEZJTFRFUjsKICAgICAgICB9CiAgICB9CgogICAgIyBwcmVwYXJlIGF0dHJpYnV0ZXMgZGF0YSBmb3IgdXNlCiAgICBpZiAoIHJlZiAkQXR0cmlidXRlc1JlZi0+e0VtYWlsfSBlcSAnQVJSQVknICkgewogICAgICAgICRBdHRyaWJ1dGVzUmVmLT57RW1haWx9ID0gam9pbiAnLCAnLCBzb3J0IEB7ICRBdHRyaWJ1dGVzUmVmLT57RW1haWx9IH07CiAgICB9CiAgICBpZiAoICRBdHRyaWJ1dGVzUmVmLT57SXNzdWVyfSApIHsKICAgICAgICAkQXR0cmlidXRlc1JlZi0+e0lzc3Vlcn0gPX4gc3s9fXs9IH14bXNnOwogICAgfQogICAgaWYgKCAkQXR0cmlidXRlc1JlZi0+e1N1YmplY3R9ICkgewogICAgICAgICRBdHRyaWJ1dGVzUmVmLT57U3ViamVjdH0gPX4gc3tcL317IH14bXNnOwogICAgICAgICRBdHRyaWJ1dGVzUmVmLT57U3ViamVjdH0gPX4gc3s9fXs9IH14bXNnOwogICAgfQoKICAgIG15ICVNb250aCA9ICgKICAgICAgICBKYW4gPT4gJzAxJywKICAgICAgICBGZWIgPT4gJzAyJywKICAgICAgICBNYXIgPT4gJzAzJywKICAgICAgICBBcHIgPT4gJzA0JywKICAgICAgICBNYXkgPT4gJzA1JywKICAgICAgICBKdW4gPT4gJzA2JywKICAgICAgICBKdWwgPT4gJzA3JywKICAgICAgICBBdWcgPT4gJzA4JywKICAgICAgICBTZXAgPT4gJzA5JywKICAgICAgICBPY3QgPT4gJzEwJywKICAgICAgICBOb3YgPT4gJzExJywKICAgICAgICBEZWMgPT4gJzEyJywKICAgICk7CgogICAgZm9yIG15ICREYXRlVHlwZSAoICdTdGFydERhdGUnLCAnRW5kRGF0ZScgKSB7CiAgICAgICAgaWYgKAogICAgICAgICAgICAkQXR0cmlidXRlc1JlZi0+eyREYXRlVHlwZX0KICAgICAgICAgICAgJiYKICAgICAgICAgICAgJEF0dHJpYnV0ZXNSZWYtPnskRGF0ZVR5cGV9ID1+IC8oLis/KVxzKC4rPylccyhcZFxkOlxkXGQ6XGRcZClccyhcZFxkXGRcZCkvCiAgICAgICAgICAgICkKICAgICAgICB7CiAgICAgICAgICAgIG15ICREYXkgICA9IGludCgkMik7CiAgICAgICAgICAgIG15ICRNb250aCA9ICcnOwogICAgICAgICAgICBteSAkWWVhciAgPSAkNDsKCiAgICAgICAgICAgIGlmICggJERheSA8IDEwICkgewogICAgICAgICAgICAgICAgJERheSA9ICIwJERheSI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIE1PTlRIX0tFWToKICAgICAgICAgICAgZm9yIG15ICRNb250aEtleSAoIHNvcnQga2V5cyAlTW9udGggKSB7CiAgICAgICAgICAgICAgICBpZiAoICRBdHRyaWJ1dGVzUmVmLT57JERhdGVUeXBlfSA9fiAvJE1vbnRoS2V5L2kgKSB7CiAgICAgICAgICAgICAgICAgICAgJE1vbnRoID0gJE1vbnRoeyRNb250aEtleX07CiAgICAgICAgICAgICAgICAgICAgbGFzdCBNT05USF9LRVk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJEF0dHJpYnV0ZXNSZWYtPnsiU2hvcnQkRGF0ZVR5cGUifSA9ICIkWWVhci0kTW9udGgtJERheSI7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIDE7Cn0KCnN1YiBfQ2xlYW5PdXRwdXQgewogICAgbXkgKCAkU2VsZiwgJE91dHB1dCApID0gQF87CgogICAgIyByZW1vdmUgc3B1cmlvdXMgd2FybmluZ3MgdGhhdCBhcHBlYXIgb24gV2luZG93cwogICAgaWYgKCAkXk8gPX4gbXttc3dpbn1pICkgewogICAgICAgICRPdXRwdXQgPX4gc3tMb2FkaW5nICdzY3JlZW4nIGludG8gcmFuZG9tIHN0YXRlIC0gZG9uZVxyP1xufXt9aWdtczsKICAgIH0KCiAgICByZXR1cm4gJE91dHB1dDsKfQoKc3ViIF9DZXJ0aWZpY2F0ZUZpbGVuYW1lIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIGZvciBteSAkTmVlZGVkIChxdyhGaW5nZXJwcmludCBIYXNoKSkgewogICAgICAgIGlmICggISRQYXJhbXskTmVlZGVkfSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIk5lZWQgJE5lZWRlZCEiCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgIyBnZXQgYWxsIGNlcnRpZmljYXRlcyB3aXRoIGhhc2ggbmFtZQogICAgbXkgQENlcnRMaXN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06Ok1haW4nKS0+RGlyZWN0b3J5UmVhZCgKICAgICAgICBEaXJlY3RvcnkgPT4gJFNlbGYtPntDZXJ0UGF0aH0sCiAgICAgICAgRmlsdGVyICAgID0+ICIkUGFyYW17SGFzaH0uKiIsCiAgICApOwoKICAgICMgb3BlbiBldmVyeSBmaWxlLCBnZXQgYXR0cmlidXRlcyBhbmQgY29tcGFyZSBmaW5nZXJwcmludAogICAgZm9yIG15ICRDZXJ0RmlsZSAoQENlcnRMaXN0KSB7CiAgICAgICAgbXkgJUF0dHJpYnV0ZXM7CiAgICAgICAgJFNlbGYtPl9GZXRjaEF0dHJpYnV0ZXNGcm9tQ2VydCggJENlcnRGaWxlLCBcJUF0dHJpYnV0ZXMgKTsKCiAgICAgICAgIyBleGl0IGFuZCByZXR1cm4gb24gZmlyc3QgZmluZ2VyIHByaW50IGZvdW5kCiAgICAgICAgaWYgKCAkQXR0cmlidXRlc3tGaW5nZXJwcmludH0gJiYgJEF0dHJpYnV0ZXN7RmluZ2VycHJpbnR9IGVxICRQYXJhbXtGaW5nZXJwcmludH0gKSB7CiAgICAgICAgICAgICRDZXJ0RmlsZSA9fiBze14uKi99e314bXM7CiAgICAgICAgICAgIHJldHVybiAkQ2VydEZpbGU7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybjsKfQoKc3ViIF9Qcml2YXRlRmlsZW5hbWUgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIG5lZWRlZCBzdHVmZgogICAgZm9yIG15ICROZWVkZWQgKHF3KEhhc2ggTW9kdWx1cykpIHsKICAgICAgICBpZiAoICEkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICROZWVkZWQhIgogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgIG15ICRNYWluT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06Ok1haW4nKTsKICAgIG15ICREQk9iamVjdCAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkRCJyk7CgogICAgbXkgQENlcnRMaXN0OwogICAgcmV0dXJuIGlmICEkREJPYmplY3QtPlByZXBhcmUoCiAgICAgICAgU1FMICA9PiAiU0VMRUNUIGZpbGVfbmFtZSBGUk9NIHNtaW1lX2tleXMgV0hFUkUga2V5X3R5cGUgPSA/IEFORCBrZXlfaGFzaCA9ID8iLAogICAgICAgIEJpbmQgPT4gWwogICAgICAgICAgICBcJ1AnLAogICAgICAgICAgICBcJFBhcmFte0hhc2h9LAogICAgICAgIF0sCiAgICApOwoKICAgIHdoaWxlICggbXkgQFJvdyA9ICREQk9iamVjdC0+RmV0Y2hyb3dBcnJheSgpICkgewogICAgICAgIHB1c2ggQENlcnRMaXN0LCAkUm93WzBdOwogICAgfQoKICAgICMgb3BlbiBldmVyeSBmaWxlLCBnZXQgYXR0cmlidXRlcyBhbmQgY29tcGFyZSBtb2R1bHVzCiAgICBDRVJURklMRToKICAgIGZvciBteSAkQ2VydEZpbGUgKEBDZXJ0TGlzdCkgewogICAgICAgIG15ICVBdHRyaWJ1dGVzOwoKICAgICAgICAjIHJlbW92ZSB0aGUgcGF0aCBhbmQgZ2V0IG9ubHkgdGhlIGZpbGVuYW1lIChmb3IgY2FjaGUpCiAgICAgICAgbXkgJENlcnRGaWxlbmFtZSA9ICRDZXJ0RmlsZTsKICAgICAgICAkQ2VydEZpbGVuYW1lID1+IHN7XEEuKi99e307CgogICAgICAgICMgb3BlbiBzZWNyZXQKICAgICAgICBteSAkUHJpdmF0ZSA9ICRNYWluT2JqZWN0LT5GaWxlUmVhZCgKICAgICAgICAgICAgRGlyZWN0b3J5ID0+ICRTZWxmLT57UHJpdmF0ZVBhdGh9LAogICAgICAgICAgICBGaWxlbmFtZSAgPT4gJENlcnRGaWxlLAogICAgICAgICk7CiAgICAgICAgbXkgJFNlY3JldCA9ICRNYWluT2JqZWN0LT5GaWxlUmVhZCgKICAgICAgICAgICAgRGlyZWN0b3J5ID0+ICRTZWxmLT57UHJpdmF0ZVBhdGh9LAogICAgICAgICAgICBGaWxlbmFtZSAgPT4gJENlcnRGaWxlIC4gJy5QJywKICAgICAgICApOwoKICAgICAgICAlQXR0cmlidXRlcyA9ICRTZWxmLT5Qcml2YXRlQXR0cmlidXRlcygKICAgICAgICAgICAgUHJpdmF0ZSAgPT4gJCRQcml2YXRlLAogICAgICAgICAgICBTZWNyZXQgICA9PiAkJFNlY3JldCwKICAgICAgICAgICAgRmlsZW5hbWUgPT4gJENlcnRGaWxlLAogICAgICAgICk7CgogICAgICAgICMgZXhpdCBhbmQgcmV0dXJuIG9uIGZpcnN0IG1vZHVsdXMgZm91bmQKICAgICAgICBpZiAoCiAgICAgICAgICAgICRBdHRyaWJ1dGVze01vZHVsdXN9CiAgICAgICAgICAgICYmICRBdHRyaWJ1dGVze01vZHVsdXN9IGVxICRQYXJhbXtNb2R1bHVzfQogICAgICAgICAgICApCiAgICAgICAgewogICAgICAgICAgICByZXR1cm4gJENlcnRGaWxlbmFtZTsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuOwp9CgpzdWIgX05vcm1hbGl6ZVByaXZhdGVTZWNyZXRGaWxlcyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgZ2V0IG1haW4gb2JqZWN0CiAgICBteSAkTWFpbk9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpNYWluJyk7CgogICAgIyBnZXQgYWxsIGZpbGVzIHRoYXQgZW5kcyB3aXRoIC5QIGZyb20gdGhlIHByaXZhdGUgZGlyZWN0b3J5CiAgICBteSBATGlzdCA9ICRNYWluT2JqZWN0LT5EaXJlY3RvcnlSZWFkKAogICAgICAgIERpcmVjdG9yeSA9PiAiJFNlbGYtPntQcml2YXRlUGF0aH0iLAogICAgICAgIEZpbHRlciAgICA9PiAnKi5QJywKICAgICk7CgogICAgbXkgJERldGFpbHMgPSAiPHllbGxvdz5Ob3JtYWxpemluZyBwcml2YXRlIHNlY3JldCBmaWxlcy4uLjwveWVsbG93PlxuIgogICAgICAgIC4gIiAgLSBQcml2YXRlIHBhdGg6ICRTZWxmLT57UHJpdmF0ZVBhdGh9XG5cbiI7CgogICAgIyBzdG9wIGlmIHRoZXJlIGFyZSBubyBwcml2YXRlIHNlY3JldHMgc3RvcmVkCiAgICBpZiAoIHNjYWxhciBATGlzdCA9PSAwICkgewogICAgICAgICREZXRhaWxzIC49ICIgIE5vIHByaXZhdGUgc2VjcmV0IGZpbGVzIGZvdW5kLCBub3RoaW5nIHRvIGRvIS4uLiA8Z3JlZW4+T0s8L2dyZWVuPlxuIjsKCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgU3VjY2VzcyA9PiAxLAogICAgICAgICAgICBEZXRhaWxzID0+ICREZXRhaWxzLAogICAgICAgIH07CiAgICB9CgogICAgbXkgQFdyb25nUHJpdmF0ZVNlY3JldExpc3Q7CgogICAgIyBleGNsdWRlIHRoZSBwcml2YXRlIHNlY3JldCBmaWxlcyB0aGF0IGhhcyBhIGNvcnJlY3QgbmFtZSBmb3JtYXQKICAgIEZJTEVOQU1FOgogICAgZm9yIG15ICRGaWxlIChATGlzdCkgewogICAgICAgICRGaWxlID1+IHN7Xi4qL317fXhtczsKICAgICAgICBuZXh0IEZJTEVOQU1FIGlmICggJEZpbGUgPX4gbXsuKyBcLiBcZCBcLiBQfXNteGkgKTsKICAgICAgICBwdXNoIEBXcm9uZ1ByaXZhdGVTZWNyZXRMaXN0LCAkRmlsZTsKICAgIH0KCiAgICAjIHN0b3AgaWYgdGhlIGFyZSBubyB3cm9uZyBmaWxlcyB0byBub3JtYWxpemUKICAgIGlmICggc2NhbGFyIEBXcm9uZ1ByaXZhdGVTZWNyZXRMaXN0ID09IDAgKSB7CiAgICAgICAgJERldGFpbHMgLj0gIiAgU3RvcmVkIHByaXZhdGUgc2VjcmV0cyBmb3VuZCwgYnV0IHRoZXkgYXJlIGFsbCBjb3JyZWN0LCBub3RoaW5nIHRvIGRvLi4uIDxncmVlbj5PSzwvZ3JlZW4+XG4iOwoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBTdWNjZXNzID0+IDEsCiAgICAgICAgICAgIERldGFpbHMgPT4gJERldGFpbHMsCiAgICAgICAgfTsKICAgIH0KCiAgICAjIGNoZWNrIGlmIHRoZSBmaWxlIHdpdGggdGhlIGNvcnJlY3QgbmFtZSBhbHJlYWR5IGV4aXN0IGluIHRoZSBzeXN0ZW0KICAgIEZJTEVOQU1FOgogICAgZm9yIG15ICRGaWxlIChAV3JvbmdQcml2YXRlU2VjcmV0TGlzdCkgewoKICAgICAgICAjIGJ1aWxkIHRoZSBjb3JyZWN0IGZpbGUgbmFtZQogICAgICAgICRGaWxlID1+IG17KC4rKSBcLiBQfXNteGk7CiAgICAgICAgbXkgJEhhc2ggPSAkMTsKCiAgICAgICAgbXkgJENvcnJlY3RGaWxlOwogICAgICAgIG15IEBVc2VkUHJpdmF0ZVNlY3JldEZpbGVzOwoKICAgICAgICBLRVlGSUxFTkFNRToKICAgICAgICBmb3IgbXkgJENvdW50ICggMCAuLiA5OSApIHsKICAgICAgICAgICAgbXkgJFByaXZhdGVLZXlGaWxlTG9jYXRpb24gPSAiJFNlbGYtPntQcml2YXRlUGF0aH0vJEhhc2guJENvdW50IjsKCiAgICAgICAgICAgICMgZ2V0IHByaXZhdGUga2V5cwogICAgICAgICAgICBpZiAoIC1lICRQcml2YXRlS2V5RmlsZUxvY2F0aW9uICkgewogICAgICAgICAgICAgICAgbXkgJFByaXZhdGVTZWNyZXRGaWxlTG9jYXRpb24gPSAkUHJpdmF0ZUtleUZpbGVMb2NhdGlvbiAuICcuUCc7CgogICAgICAgICAgICAgICAgIyBjaGVjayBpZiBwcml2YXRlIHNlY3JldCBhbHJlYWR5IGV4aXN0cwogICAgICAgICAgICAgICAgaWYgKCAhLWUgJFByaXZhdGVTZWNyZXRGaWxlTG9jYXRpb24gKSB7CgogICAgICAgICAgICAgICAgICAgICMgdXNlIGZpcnN0IGF2YWlsYWJsZQogICAgICAgICAgICAgICAgICAgICRDb3JyZWN0RmlsZSA9ICIkSGFzaC4kQ291bnQuUCI7CiAgICAgICAgICAgICAgICAgICAgbGFzdCBLRVlGSUxFTkFNRTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHB1c2ggQFVzZWRQcml2YXRlU2VjcmV0RmlsZXMsICIkSGFzaC4kQ291bnQuUCI7CiAgICAgICAgICAgICAgICAgICAgbmV4dCBLRVlGSUxFTkFNRTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBpZiB0aGVyZSBhcmUgbm8ga2V5cyBmb3IgdGhlIHByaXZhdGUgc2VjcmV0LCB0aGUgZmlsZSBjb3VsZCBub3QgYmUgcmVuYW1lZAogICAgICAgIGlmICggISRDb3JyZWN0RmlsZSAmJiBzY2FsYXIgQFVzZWRQcml2YXRlU2VjcmV0RmlsZXMgPT0gMCApIHsKICAgICAgICAgICAgJERldGFpbHMgLj0gIiAgQ2FuJ3QgcmVuYW1lIHByaXZhdGUgc2VjcmV0IGZpbGUgJEZpbGUsIGJlY2F1c2UgdGhlcmUgaXMgbm8iCiAgICAgICAgICAgICAgICAuICIgcHJpdmF0ZSBrZXkgZmlsZSBmb3IgdGhpcyBwcml2YXRlIHNlY3JldC4uLiA8cmVkPldhcm5pbmc8L3JlZD5cbiI7CiAgICAgICAgICAgIG5leHQgRklMRU5BTUU7CiAgICAgICAgfQoKICAgICAgICBteSAkV3JvbmdGaWxlTG9jYXRpb24gPSAiJFNlbGYtPntQcml2YXRlUGF0aH0vJEZpbGUiOwoKICAgICAgICAjIGlmIGFuIGF2YWlsYWJsZSBmaWxlIG5hbWUgd2FzIGZvdW5kCiAgICAgICAgaWYgKCRDb3JyZWN0RmlsZSkgewogICAgICAgICAgICBteSAkQ29ycmVjdEZpbGVMb2NhdGlvbiA9ICIkU2VsZi0+e1ByaXZhdGVQYXRofS8kQ29ycmVjdEZpbGUiOwogICAgICAgICAgICBpZiAoICFyZW5hbWUgJFdyb25nRmlsZUxvY2F0aW9uLCAkQ29ycmVjdEZpbGVMb2NhdGlvbiApIHsKICAgICAgICAgICAgICAgIG15ICRNZXNzYWdlID0gIkNvdWxkIG5vdCByZW5hbWUgcHJpdmF0ZSBzZWNyZXQgZmlsZSAkV3JvbmdGaWxlTG9jYXRpb24gdG8gJENvcnJlY3RGaWxlTG9jYXRpb24hIjsKICAgICAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gJE1lc3NhZ2UsCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICREZXRhaWxzIC49ICIgICRNZXNzYWdlXG4iOwoKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgU3VjY2VzcyA9PiAwLAogICAgICAgICAgICAgICAgICAgIERldGFpbHMgPT4gJERldGFpbHMsCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICAkRGV0YWlscyAuPSAiICBSZW5hbWVkIHByaXZhdGUgc2VjcmV0IGZpbGUgJEZpbGUgdG8gJENvcnJlY3RGaWxlIC4uLiA8Z3JlZW4+T0s8L2dyZWVuPlxuIjsKICAgICAgICAgICAgbmV4dCBGSUxFTkFNRTsKICAgICAgICB9CgogICAgICAgICMgb3RoZXJ3aXNlIHRyeSB0byBmaW5kIGlmIGFueSBvZiB0aGUgdXNlZCBmaWxlcyBoYXMgdGhlIHNhbWUgY29udGVudAogICAgICAgICREZXRhaWxzIC49ICIgIENhbid0IHJlbmFtZSBwcml2YXRlIHNlY3JldCBmaWxlOiAkRmlsZVxuQWxsIHByaXZhdGUga2V5IGZpbGVzIGZvciBoYXNoIgogICAgICAgICAgICAuICIgJEhhc2ggaGFzIGFscmVhZHkgYSBjb3JyZWN0IHByaXZhdGUgc2VjcmV0IGZpbGVuYW1lIGFzc29jaWF0ZWQhXG4iOwoKICAgICAgICAjIGdldCB0aGUgY29udGVudHMgb2YgdGhlIHdyb25nIHByaXZhdGUgc2VjcmV0IGZpbGUKICAgICAgICBteSAkV3JvbmdGaWxlQ29udGVudCA9ICRNYWluT2JqZWN0LT5GaWxlUmVhZCgKICAgICAgICAgICAgTG9jYXRpb24gPT4gJFdyb25nRmlsZUxvY2F0aW9uLAogICAgICAgICAgICBSZXN1bHQgICA9PiAnU0NBTEFSJywKICAgICAgICApOwoKICAgICAgICAjIGxvb3Agb3ZlciB0aGUgZm91bmQgcHJpdmF0ZSBzZWNyZXQgZmlsZXMgZm9yIHRoZSBzYW1lIHByaXZhdGUga2V5IGhhc2gKICAgICAgICBmb3IgbXkgJFByaXZhdGVTZWNyZXRGaWxlIChAVXNlZFByaXZhdGVTZWNyZXRGaWxlcykgewogICAgICAgICAgICBteSAkUHJpdmF0ZVNlY3JldEZpbGVMb2NhdGlvbiA9ICIkU2VsZi0+e1ByaXZhdGVQYXRofS8kUHJpdmF0ZVNlY3JldEZpbGUiOwoKICAgICAgICAgICAgIyBjaGVjayBpZiB0aGUgZmlsZSBjb250ZW50cyBhcmUgdGhlIHNhbWUKICAgICAgICAgICAgbXkgJFByaXZhdGVTZWNyZXRGaWxlQ29udGVudCA9ICRNYWluT2JqZWN0LT5GaWxlUmVhZCgKICAgICAgICAgICAgICAgIExvY2F0aW9uID0+ICRQcml2YXRlU2VjcmV0RmlsZUxvY2F0aW9uLAogICAgICAgICAgICAgICAgUmVzdWx0ICAgPT4gJ1NDQUxBUicsCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAjIHNhZmUgdG8gZGVsZXRlIHdyb25nIGZpbGUgaWYgY29udGVudHMgYXJlIGFyZSBpZGVudGljYWwKICAgICAgICAgICAgaWYgKCAkeyRXcm9uZ0ZpbGVDb250ZW50fSBlcSAkeyRQcml2YXRlU2VjcmV0RmlsZUNvbnRlbnR9ICkgewoKICAgICAgICAgICAgICAgICREZXRhaWxzCiAgICAgICAgICAgICAgICAgICAgLj0gIiAgVGhlIGNvbnRlbnQgb2YgZmlsZXMgJEZpbGUgYW5kICRQcml2YXRlU2VjcmV0RmlsZSBpcyB0aGUgc2FtZSwgaXQgaXMgc2FmZSB0byByZW1vdmUgJEZpbGVcbiI7CgogICAgICAgICAgICAgICAgJERldGFpbHMgLj0gIiAgICBSZW1vdmUgcHJpdmF0ZSBzZWNyZXQgZmlsZSAkV3JvbmdGaWxlTG9jYXRpb24gZnJvbSB0aGUgZmlsZSBzeXN0ZW0uLi4iOwoKICAgICAgICAgICAgICAgICMgcmVtb3ZlIGZpbGUKICAgICAgICAgICAgICAgIG15ICRTdWNjZXNzID0gJE1haW5PYmplY3QtPkZpbGVEZWxldGUoCiAgICAgICAgICAgICAgICAgICAgTG9jYXRpb24gPT4gJFdyb25nRmlsZUxvY2F0aW9uLAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAjIHJldHVybiBlcnJvciBpZiBmaWxlIHdhcyBub3QgZGVsZXRlZAogICAgICAgICAgICAgICAgaWYgKCAhJFN1Y2Nlc3MgKSB7CiAgICAgICAgICAgICAgICAgICAgbXkgJE1lc3NhZ2UgPSAiQ291bGQgbm90IHJlbW92ZSBwcml2YXRlIHNlY3JldCBmaWxlICRXcm9uZ0ZpbGVMb2NhdGlvbiBmcm9tIHRoZSBmaWxlIHN5c3RlbSEiOwogICAgICAgICAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAkTWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICAgICAkRGV0YWlscyAuPSAiIDxyZWQ+RmFpbGVkPC9yZWQ+XG4iOwoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgICAgICBTdWNjZXNzID0+IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIERldGFpbHMgPT4gJERldGFpbHMsCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAjIGNvbnRpbnVlIHRvIG5leHQgd3JvbmcgcHJpdmF0ZSBzZWNyZXQgZmlsZQogICAgICAgICAgICAgICAgJERldGFpbHMgLj0gIiA8Z3JlZW4+T0s8L2dyZWVuPlxuIjsKCiAgICAgICAgICAgICAgICBuZXh0IEZJTEVOQU1FOwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIG90aGVyd2lzZSBqdXN0IGxvZyB0aGF0IHRoZSBjb250ZW50cyBhcmUgZGlmZmVyZW50LCBkbyBub3QgZGVsZXRlIGZpbGUKICAgICAgICAgICAgJERldGFpbHMgLj0gIiAgVGhlIGNvbnRlbnQgb2YgZmlsZXMgJEZpbGUgYW5kICRQcml2YXRlU2VjcmV0RmlsZSBpcyBkaWZmZXJlbnRcbiI7CiAgICAgICAgfQoKICAgICAgICAjIGFsbCBwcml2YXRlIHNlY3JldCBmaWxlcyBoYXMgZGlmZmVyZW50IGNvbnRlbnQsIGp1c3QgbG9nIHRoaXMgYXMgYSB3YXJpbmcgYW5kIGNvbnRpbnVlIHRvCiAgICAgICAgIyB0aGUgbmV4dCB3cm9uZyBwcml2YXRlIHNlY3JldCBmaWxlCiAgICAgICAgJERldGFpbHMgLj0gIiAgVGhlIHByaXZhdGUgc2VjcmV0IGZpbGUgJEZpbGUgaGFzIGluZm9ybWF0aW9uIG5vdCBzdG9yZWQgaW4gYW55IG90aGVyIgogICAgICAgICAgICAuICIgcHJpdmF0ZSBzZWNyZXQgZmlsZSBmb3IgaGFzaCAkSGFzaFxuIgogICAgICAgICAgICAuICIgICAgVGhlIGZpbGUgd2lsbCBub3QgYmUgZGVsZXRlZC4uLiA8cmVkPldhcm5pbmc8L3JlZD5cbiI7CiAgICAgICAgbmV4dCBGSUxFTkFNRTsKICAgIH0KCiAgICByZXR1cm4gewogICAgICAgIFN1Y2Nlc3MgPT4gMSwKICAgICAgICBEZXRhaWxzID0+ICREZXRhaWxzLAogICAgfTsKfQoKc3ViIF9SZUhhc2hDZXJ0aWZpY2F0ZXMgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSBARmlsZUZpbHRlcnM7CiAgICBmb3IgbXkgJE51bWJlciAoIDAgLi4gOTkgKSB7CiAgICAgICAgcHVzaCBARmlsZUZpbHRlcnMsICIqLiROdW1iZXIiOwogICAgfQoKICAgIG15IEBDZXJ0RmlsZVBhdGhzID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06Ok1haW4nKS0+RGlyZWN0b3J5UmVhZCgKICAgICAgICBEaXJlY3RvcnkgPT4gIiRTZWxmLT57Q2VydFBhdGh9IiwKICAgICAgICBGaWx0ZXIgICAgPT4gXEBGaWxlRmlsdGVycywKICAgICk7CgogICAgbXkgJERldGFpbHMgPSAiXG5SZS1IYXNoaW5nIENlcnRpZmljYXRlcy4uLlxuIgogICAgICAgIC4gIiAgLSBDZXJ0aWZpY2F0ZSBwYXRoOiAkU2VsZi0+e0NlcnRQYXRofVxuIgogICAgICAgIC4gIiAgLSBQcml2YXRlIHBhdGg6ICAgICAkU2VsZi0+e1ByaXZhdGVQYXRofVxuXG4iOwoKICAgIGlmICggIUBDZXJ0RmlsZVBhdGhzICkgewogICAgICAgICREZXRhaWxzIC49ICIgIE5vIGNlcnRpZmljYXRlIGZpbGVzIGZvdW5kLCBub3RoaW5nIHRvIGRvLi4uIDxncmVlbj5PSzwvZ3JlZW4+XG5cbiI7CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIFN1Y2Nlc3MgPT4gMSwKICAgICAgICAgICAgRGV0YWlscyA9PiAkRGV0YWlscywKICAgICAgICB9OwogICAgfQoKICAgIG15IEBXcm9uZ0NlcnRpZmljYXRlc0xpc3Q7CgogICAgIyBleGNsdWRlIHRoZSBjZXJ0aWZpY2F0ZSBmaWxlcyB3aXRoIGNvcnJlY3QgZmlsZSBuYW1lCiAgICBGSUxFTkFNRToKICAgIGZvciBteSAkRmlsZW5hbWUgKEBDZXJ0RmlsZVBhdGhzKSB7CiAgICAgICAgJEZpbGVuYW1lID1+IHN7XEEuKi99e307CgogICAgICAgICMgZ2V0IGNlcnRpZmljYXRlIGF0dHJpYnV0ZXMgd2l0aCBjdXJyZW50IE9wZW5TU0wgdmVyc2lvbgogICAgICAgIG15ICRDZXJ0aWZpY2F0ZSA9ICRTZWxmLT5DZXJ0aWZpY2F0ZUdldCgKICAgICAgICAgICAgRmlsZW5hbWUgPT4gJEZpbGVuYW1lLAogICAgICAgICk7CiAgICAgICAgbXkgJUNlcnRpZmljYXRlQXR0cmlidXRlcyA9ICRTZWxmLT5DZXJ0aWZpY2F0ZUF0dHJpYnV0ZXMoCiAgICAgICAgICAgIENlcnRpZmljYXRlID0+ICRDZXJ0aWZpY2F0ZSwKICAgICAgICAgICAgRmlsZW5hbWUgICAgPT4gJEZpbGVuYW1lLAogICAgICAgICk7CiAgICAgICAgbmV4dCBGSUxFTkFNRSBpZiAhJUNlcnRpZmljYXRlQXR0cmlidXRlczsKCiAgICAgICAgIyBzcGxpdCBmaWxlbmFtZSBpbnRvIEhhc2guSW5kZXggKDEyMzQ1Njc4LjAgLT4gMTIzNDU2NzggLyAwKQogICAgICAgICRGaWxlbmFtZSA9fiBteyAoLispIFwuIChcZCspIH14OwogICAgICAgIG15ICRIYXNoICA9ICQxOwogICAgICAgIG15ICRJbmRleCA9ICQyOwoKICAgICAgICAjIGdldCBuZXcgaGFzaCBmcm9tIGNlcnRpZmljYXRlIGF0dHJpYnV0ZXMKICAgICAgICBteSAkTmV3SGFzaCAgICAgPSAkQ2VydGlmaWNhdGVBdHRyaWJ1dGVze0hhc2h9OwogICAgICAgIG15ICRGaW5nZXJwcmludCA9ICRDZXJ0aWZpY2F0ZUF0dHJpYnV0ZXN7RmluZ2VycHJpbnR9OwoKICAgICAgICBuZXh0IEZJTEVOQU1FIGlmICRIYXNoIGVxICROZXdIYXNoOwoKICAgICAgICBwdXNoIEBXcm9uZ0NlcnRpZmljYXRlc0xpc3QsIHsKICAgICAgICAgICAgSGFzaCAgICAgICAgPT4gJEhhc2gsCiAgICAgICAgICAgIE5ld0hhc2ggICAgID0+ICROZXdIYXNoLAogICAgICAgICAgICBJbmRleCAgICAgICA9PiAkSW5kZXgsCiAgICAgICAgICAgIEZpbmdlcnByaW50ID0+ICRGaW5nZXJwcmludCwKICAgICAgICB9OwogICAgfQoKICAgICMgc3RvcCBpZiB0aGUgYXJlIG5vIHdyb25nIGZpbGVzIHRvIHJlLWhhc2gKICAgIGlmICggIUBXcm9uZ0NlcnRpZmljYXRlc0xpc3QgKSB7CiAgICAgICAgJERldGFpbHMgLj0gIiAgU3RvcmVkIGNlcnRpZmljYXRlcyBmb3VuZCwgYnV0IHRoZXkgYXJlIGFsbCBjb3JyZWN0LCBub3RoaW5nIHRvIGRvLi4uIDxncmVlbj5PSzwvZ3JlZW4+XG4iOwoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBTdWNjZXNzID0+IDEsCiAgICAgICAgICAgIERldGFpbHMgPT4gJERldGFpbHMsCiAgICAgICAgfTsKICAgIH0KCiAgICAjIGdldCBkYXRhYmFzZSBvYmplY3QKICAgIG15ICREQk9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEQicpOwoKICAgICMgbG9vcCBvdmVyIHdyb25nIGNlcnRpZmljYXRlcwogICAgQ0VSVElGSUNBVEU6CiAgICBmb3IgbXkgJFdyb25nQ2VydGlmaWNhdGUgKEBXcm9uZ0NlcnRpZmljYXRlc0xpc3QpIHsKCiAgICAgICAgIyByZWNyZWF0ZSB0aGUgY2VydGlmaWNhdGUgZmlsZSBuYW1lCiAgICAgICAgbXkgJFdyb25nQ2VydGlmaWNhdGVGaWxlID0gIiRTZWxmLT57Q2VydFBhdGh9LyRXcm9uZ0NlcnRpZmljYXRlLT57SGFzaH0uJFdyb25nQ2VydGlmaWNhdGUtPntJbmRleH0iOwoKICAgICAgICAjIGNoZWNrIGlmIGNlcnRpZmljYXRlIGV4aXN0cwogICAgICAgIGlmICggIS1lICRXcm9uZ0NlcnRpZmljYXRlRmlsZSApIHsKICAgICAgICAgICAgbXkgJE1lc3NhZ2UgPSAiU01JTUUgY2VydGlmaWNhdGUgJFdyb25nQ2VydGlmaWNhdGVGaWxlIGZpbGUgZG9lcyBub3QgZXhpc3QhIjsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIiRNZXNzYWdlIiwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICREZXRhaWxzIC49ICIgICRNZXNzYWdlXG4iOwoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIFN1Y2Nlc3MgPT4gMCwKICAgICAgICAgICAgICAgIERldGFpbHMgPT4gJERldGFpbHMsCiAgICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICAjIGxvb2sgZm9yIGFuIGF2YWlsYWJsZSBuZXcgZmlsZW5hbWUKICAgICAgICBteSAkTmV3Q2VydGlmaWNhdGVGaWxlOwogICAgICAgIG15ICROZXdQcml2YXRlS2V5RmlsZTsKICAgICAgICBteSAkTmV3SW5kZXg7CiAgICAgICAgRklMRU5BTUU6CiAgICAgICAgZm9yIG15ICRDb3VudCAoIDAgLi4gOTkgKSB7CiAgICAgICAgICAgIG15ICRDZXJ0VGVzdEZpbGUgPSAiJFNlbGYtPntDZXJ0UGF0aH0vJFdyb25nQ2VydGlmaWNhdGUtPntOZXdIYXNofS4kQ291bnQiOwogICAgICAgICAgICBpZiAoIC1lICRDZXJ0VGVzdEZpbGUgKSB7CiAgICAgICAgICAgICAgICBuZXh0IEZJTEVOQU1FOwogICAgICAgICAgICB9CiAgICAgICAgICAgICROZXdDZXJ0aWZpY2F0ZUZpbGUgPSAkQ2VydFRlc3RGaWxlOwogICAgICAgICAgICAkTmV3UHJpdmF0ZUtleUZpbGUgID0gIiRTZWxmLT57UHJpdmF0ZVBhdGh9LyRXcm9uZ0NlcnRpZmljYXRlLT57TmV3SGFzaH0uJENvdW50IjsKICAgICAgICAgICAgJE5ld0luZGV4ICAgICAgICAgICA9ICRDb3VudDsKICAgICAgICAgICAgbGFzdCBGSUxFTkFNRTsKICAgICAgICB9CgogICAgICAgIGlmICggISROZXdDZXJ0aWZpY2F0ZUZpbGUgKSB7CiAgICAgICAgICAgIG15ICRNZXNzYWdlID0gIk5vIG1vcmUgYXZhaWxhYmxlIGZpbGVuYW1lcyBmb3IgY2VydGlmaWNhdGUgaGFzaDogJFdyb25nQ2VydGlmaWNhdGUtPntOZXdIYXNofSEiOwogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAkTWVzc2FnZSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICREZXRhaWxzIC49ICIgICRNZXNzYWdlXG4iOwoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIFN1Y2Nlc3MgPT4gMCwKICAgICAgICAgICAgICAgIERldGFpbHMgPT4gJERldGFpbHMsCiAgICAgICAgICAgIH07CgogICAgICAgIH0KCiAgICAgICAgIyBzZXQgd3JvbmcgcHJpdmF0ZSBrZXkKICAgICAgICBteSAkV3JvbmdQcml2YXRlS2V5RmlsZSA9ICIkU2VsZi0+e1ByaXZhdGVQYXRofS8kV3JvbmdDZXJ0aWZpY2F0ZS0+e0hhc2h9LiRXcm9uZ0NlcnRpZmljYXRlLT57SW5kZXh9IjsKCiAgICAgICAgIyBjaGVjayBpZiBjZXJ0aWZpY2F0ZSBoYXMgYSBwcml2YXRlIGtleSBhbmQgc2VjcmV0CiAgICAgICAgIyBpZiBoYXMgYSBwcml2YXRlIGtleSBpdCBtdXN0IGhhdmUgYSBwcml2YXRlIHNlY3JldAogICAgICAgIG15ICRIYXNQcml2YXRlS2V5OwogICAgICAgIG15ICRIYXNQcml2YXRlU2VjcmV0OwogICAgICAgIGlmICggLWUgJFdyb25nUHJpdmF0ZUtleUZpbGUgKSB7CiAgICAgICAgICAgICRIYXNQcml2YXRlS2V5ID0gMTsKCiAgICAgICAgICAgICMgY2hlY2sgbmV3IHByaXZhdGUga2V5IGFuZCBzZWNyZXQgZmlsZXMKICAgICAgICAgICAgaWYgKCAtZSAkTmV3UHJpdmF0ZUtleUZpbGUgKSB7CiAgICAgICAgICAgICAgICBteSAkTWVzc2FnZSA9ICJGaWxlbmFtZSBmb3IgcHJpdmF0ZSBrZXk6ICROZXdQcml2YXRlS2V5RmlsZSBpcyBhbHJlYWR5IGluIHVzZSEiOwogICAgICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAkTWVzc2FnZSwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgJERldGFpbHMgLj0gIiAgJE1lc3NhZ2VcbiI7CgogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICBTdWNjZXNzID0+IDAsCiAgICAgICAgICAgICAgICAgICAgRGV0YWlscyA9PiAkRGV0YWlscywKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgY2hlY2sgcHJpdmF0ZSBzZWNyZXQKICAgICAgICAgICAgaWYgKCAtZSAiJFdyb25nUHJpdmF0ZUtleUZpbGUuUCIgKSB7CiAgICAgICAgICAgICAgICAkSGFzUHJpdmF0ZVNlY3JldCA9IDE7CgogICAgICAgICAgICAgICAgaWYgKCAtZSAiJE5ld1ByaXZhdGVLZXlGaWxlLlAiICkgewogICAgICAgICAgICAgICAgICAgIG15ICRNZXNzYWdlID0gIkZpbGVuYW1lIGZvciBwcml2YXRlIHNlY3JldDogJE5ld1ByaXZhdGVLZXlGaWxlLlAgaXMgYWxyZWFkeSBpbiB1c2UhIjsKICAgICAgICAgICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gJE1lc3NhZ2UsCiAgICAgICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAgICAgJERldGFpbHMgLj0gIiAgJE1lc3NhZ2VcbiI7CgogICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgIFN1Y2Nlc3MgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgRGV0YWlscyA9PiAkRGV0YWlscywKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIHJlbmFtZSBjZXJ0aWZpY2F0ZQogICAgICAgICREZXRhaWxzIC49ICIgIFJlbmFtZSBjZXJ0aWZpY2F0ZSAkV3JvbmdDZXJ0aWZpY2F0ZS0+e0hhc2h9LiRXcm9uZ0NlcnRpZmljYXRlLT57SW5kZXh9IgogICAgICAgICAgICAuICIgdG8gJFdyb25nQ2VydGlmaWNhdGUtPntOZXdIYXNofS4kTmV3SW5kZXguLi4iOwoKICAgICAgICBpZiAoICFyZW5hbWUgJFdyb25nQ2VydGlmaWNhdGVGaWxlLCAkTmV3Q2VydGlmaWNhdGVGaWxlICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiQ291bGQgbm90IHJlbmFtZSBTTUlNRSBjZXJ0aWZpY2F0ZSBmaWxlICRXcm9uZ0NlcnRpZmljYXRlRmlsZSB0byAkTmV3Q2VydGlmaWNhdGVGaWxlISIsCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAkRGV0YWlscyAuPSAiIDxyZWQ+RmFpbGVkPC9yZWQ+XG4iOwoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIFN1Y2Nlc3MgPT4gMCwKICAgICAgICAgICAgICAgIERldGFpbHMgPT4gJERldGFpbHMsCiAgICAgICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICBteSAoJE5ld0NlcnRGaWxlTmFtZSkgPSAkTmV3Q2VydGlmaWNhdGVGaWxlICAgPX4gLyhbXlwvXSskKS9zOwogICAgICAgIG15ICgkT2xkQ2VydEZpbGVOYW1lKSA9ICRXcm9uZ0NlcnRpZmljYXRlRmlsZSA9fiAvKFteXC9dKyQpL3M7CiAgICAgICAgbXkgJERhdGVUaW1lT2JqZWN0ICAgID0gJEtlcm5lbDo6T00tPkNyZWF0ZSgnS2VybmVsOjpTeXN0ZW06OkRhdGVUaW1lJyk7CgogICAgICAgIHJldHVybiBpZiAhJERCT2JqZWN0LT5EbygKICAgICAgICAgICAgU1FMICA9PiAiVVBEQVRFIHNtaW1lX2tleXMgU0VUIGZpbGVfbmFtZSA9ID8sIGNoYW5nZV9ieSA9ID8sIGNoYW5nZV90aW1lID0gPyBXSEVSRSBmaWxlX25hbWUgPSA/IiwKICAgICAgICAgICAgQmluZCA9PiBbCiAgICAgICAgICAgICAgICBcJE5ld0NlcnRGaWxlTmFtZSwKICAgICAgICAgICAgICAgIFwxLAogICAgICAgICAgICAgICAgXCREYXRlVGltZU9iamVjdC0+VG9TdHJpbmcoKSwKICAgICAgICAgICAgICAgIFwkT2xkQ2VydEZpbGVOYW1lLAogICAgICAgICAgICBdLAogICAgICAgICk7CgogICAgICAgICREZXRhaWxzIC49ICIgPGdyZWVuPk9LPC9ncmVlbj5cbiI7CgogICAgICAgICMgdXBkYXRlIGNlcnRpZmljYXRlIHJlbGF0aW9ucwogICAgICAgICMgZ2V0IHJlbGF0aW9ucyB0aGF0IGhhdmUgdGhpcyBjZXJ0aWZpY2F0ZQogICAgICAgIG15ICREQlN1Y2Nlc3MgPSAkREJPYmplY3QtPlByZXBhcmUoCiAgICAgICAgICAgIFNRTCA9PgogICAgICAgICAgICAgICAgJ1NFTEVDVCBpZCwgY2VydF9oYXNoLCBjZXJ0X2ZpbmdlcnByaW50LCBjYV9oYXNoLCBjYV9maW5nZXJwcmludCcKICAgICAgICAgICAgICAgIC4gJyBGUk9NIHNtaW1lX3NpZ25lcl9jZXJ0X3JlbGF0aW9ucycKICAgICAgICAgICAgICAgIC4gJyBXSEVSRSBjZXJ0X2hhc2ggPSA/IEFORCBjZXJ0X2ZpbmdlcnByaW50ID0gPycsCiAgICAgICAgICAgIEJpbmQgPT4gWwogICAgICAgICAgICAgICAgXCRXcm9uZ0NlcnRpZmljYXRlLT57SGFzaH0sCiAgICAgICAgICAgICAgICBcJFdyb25nQ2VydGlmaWNhdGUtPntGaW5nZXJwcmludH0sCiAgICAgICAgICAgIF0sCiAgICAgICAgKTsKCiAgICAgICAgbXkgQFdyb25nQ2VydFJlbGF0aW9uczsKCiAgICAgICAgaWYgKCREQlN1Y2Nlc3MpIHsKICAgICAgICAgICAgd2hpbGUgKCBteSBAUmVzdWx0RGF0YSA9ICREQk9iamVjdC0+RmV0Y2hyb3dBcnJheSgpICkgewoKICAgICAgICAgICAgICAgICMgZm9ybWF0IGRhdGUKICAgICAgICAgICAgICAgIG15ICVEYXRhID0gKAogICAgICAgICAgICAgICAgICAgIElEICAgICAgICAgICAgICA9PiAkUmVzdWx0RGF0YVswXSwKICAgICAgICAgICAgICAgICAgICBDZXJ0SGFzaCAgICAgICAgPT4gJFJlc3VsdERhdGFbMV0sCiAgICAgICAgICAgICAgICAgICAgQ2VydEZpbmdlcnByaW50ID0+ICRSZXN1bHREYXRhWzJdLAogICAgICAgICAgICAgICAgICAgIENBSGFzaCAgICAgICAgICA9PiAkUmVzdWx0RGF0YVszXSwKICAgICAgICAgICAgICAgICAgICBDQUZpbmdlcnByaW50ICAgPT4gJFJlc3VsdERhdGFbNF0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgcHVzaCBAV3JvbmdDZXJ0UmVsYXRpb25zLCBcJURhdGE7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICREZXRhaWxzIC49ICIgICAgR2V0IGNlcnRpZmljYXRlIERCIHJlbGF0aW9ucyBmb3IgJFdyb25nQ2VydGlmaWNhdGUtPntIYXNofS4iCiAgICAgICAgICAgIC4gIiRXcm9uZ0NlcnRpZmljYXRlLT57SW5kZXh9IGFzIGNlcnRpZmljYXRlXG4iOwoKICAgICAgICAjIHVwZGF0ZSByZWxhdGlvbnMKICAgICAgICBpZiAoIHNjYWxhciBAV3JvbmdDZXJ0UmVsYXRpb25zID4gMCApIHsKICAgICAgICAgICAgZm9yIG15ICRXcm9uZ1JlbGF0aW9uIChAV3JvbmdDZXJ0UmVsYXRpb25zKSB7CgogICAgICAgICAgICAgICAgbXkgJFN1Y2Nlc3MgPSAkREJPYmplY3QtPkRvKAogICAgICAgICAgICAgICAgICAgIFNRTCA9PgogICAgICAgICAgICAgICAgICAgICAgICAnVVBEQVRFIHNtaW1lX3NpZ25lcl9jZXJ0X3JlbGF0aW9ucycKICAgICAgICAgICAgICAgICAgICAgICAgLiAnIFNFVCBjZXJ0X2hhc2ggPSA/JwogICAgICAgICAgICAgICAgICAgICAgICAuICcgV0hFUkUgaWQgPSA/IEFORCBjZXJ0X2ZpbmdlcnByaW50ID0gPycsCiAgICAgICAgICAgICAgICAgICAgQmluZCA9PiBbCiAgICAgICAgICAgICAgICAgICAgICAgIFwkV3JvbmdDZXJ0aWZpY2F0ZS0+e05ld0hhc2h9LAogICAgICAgICAgICAgICAgICAgICAgICBcJFdyb25nUmVsYXRpb24tPntJRH0sCiAgICAgICAgICAgICAgICAgICAgICAgIFwkV3JvbmdDZXJ0aWZpY2F0ZS0+e0ZpbmdlcnByaW50fSwKICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAkRGV0YWlscyAuPSAiICAgICAgVXBkYXRlZCByZWxhdGlvbiBJRDogJFdyb25nUmVsYXRpb24tPntJRH0gd2l0aCBDQSAkV3JvbmdSZWxhdGlvbi0+e0NBSGFzaH0uLi4iOwoKICAgICAgICAgICAgICAgIGlmICgkU3VjY2VzcykgewogICAgICAgICAgICAgICAgICAgICREZXRhaWxzIC49ICIgIDxncmVlbj5PSzwvZ3JlZW4+XG4iOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJERldGFpbHMgLj0gIiAgPHJlZD5GYWlsZWQ8L3JlZD5cbiI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICREZXRhaWxzIC49ICIgICAgICBObyB3cm9uZyByZWxhdGlvbnMgZm91bmQsIG5vdGhpbmcgdG8gZG8uLi4gPGdyZWVuPk9LPC9ncmVlbj5cbiI7CiAgICAgICAgfQoKICAgICAgICAjIGdldCByZWxhdGlvbnMgdGhhdCBoYXZlIHRoaXMgY2VydGlmaWNhdGUgYXMgYSBDQQogICAgICAgICREQlN1Y2Nlc3MgPSAkREJPYmplY3QtPlByZXBhcmUoCiAgICAgICAgICAgIFNRTCA9PgogICAgICAgICAgICAgICAgJ1NFTEVDVCBpZCwgY2VydF9oYXNoLCBjZXJ0X2ZpbmdlcnByaW50LCBjYV9oYXNoLCBjYV9maW5nZXJwcmludCcKICAgICAgICAgICAgICAgIC4gJyBGUk9NIHNtaW1lX3NpZ25lcl9jZXJ0X3JlbGF0aW9ucycKICAgICAgICAgICAgICAgIC4gJyBXSEVSRSBjYV9oYXNoID0gPyBBTkQgY2FfZmluZ2VycHJpbnQgPT8nLAogICAgICAgICAgICBCaW5kID0+IFsKICAgICAgICAgICAgICAgIFwkV3JvbmdDZXJ0aWZpY2F0ZS0+e0hhc2h9LAogICAgICAgICAgICAgICAgXCRXcm9uZ0NlcnRpZmljYXRlLT57RmluZ2VycHJpbnR9LAogICAgICAgICAgICBdLAogICAgICAgICk7CgogICAgICAgIG15IEBXcm9uZ0NBUmVsYXRpb25zOwoKICAgICAgICBpZiAoJERCU3VjY2VzcykgewogICAgICAgICAgICB3aGlsZSAoIG15IEBSZXN1bHREYXRhID0gJERCT2JqZWN0LT5GZXRjaHJvd0FycmF5KCkgKSB7CgogICAgICAgICAgICAgICAgIyBmb3JtYXQgZGF0ZQogICAgICAgICAgICAgICAgbXkgJURhdGEgPSAoCiAgICAgICAgICAgICAgICAgICAgSUQgICAgICAgICAgICAgID0+ICRSZXN1bHREYXRhWzBdLAogICAgICAgICAgICAgICAgICAgIENlcnRIYXNoICAgICAgICA9PiAkUmVzdWx0RGF0YVsxXSwKICAgICAgICAgICAgICAgICAgICBDZXJ0RmluZ2VycHJpbnQgPT4gJFJlc3VsdERhdGFbMl0sCiAgICAgICAgICAgICAgICAgICAgQ0FIYXNoICAgICAgICAgID0+ICRSZXN1bHREYXRhWzNdLAogICAgICAgICAgICAgICAgICAgIENBRmluZ2VycHJpbnQgICA9PiAkUmVzdWx0RGF0YVs0XSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBwdXNoIEBXcm9uZ0NBUmVsYXRpb25zLCBcJURhdGE7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICREZXRhaWxzIC49ICIgICAgR2V0IGNlcnRpZmljYXRlIERCIHJlbGF0aW9ucyBmb3IgJFdyb25nQ2VydGlmaWNhdGUtPntIYXNofS4kV3JvbmdDZXJ0aWZpY2F0ZS0+e0luZGV4fSBhcyBDQVxuIjsKCiAgICAgICAgIyB1cGRhdGUgcmVsYXRpb25zIChDQSkKICAgICAgICBpZiAoIHNjYWxhciBAV3JvbmdDZXJ0UmVsYXRpb25zID4gMCApIHsKICAgICAgICAgICAgZm9yIG15ICRXcm9uZ1JlbGF0aW9uIChAV3JvbmdDQVJlbGF0aW9ucykgewoKICAgICAgICAgICAgICAgIG15ICRTdWNjZXNzID0gJERCT2JqZWN0LT5EbygKICAgICAgICAgICAgICAgICAgICBTUUwgPT4KICAgICAgICAgICAgICAgICAgICAgICAgJ1VQREFURSBzbWltZV9zaWduZXJfY2VydF9yZWxhdGlvbnMnCiAgICAgICAgICAgICAgICAgICAgICAgIC4gJyBTRVQgY2FfaGFzaCA9ID8nCiAgICAgICAgICAgICAgICAgICAgICAgIC4gJyBXSEVSRSBpZCA9ID8gQU5EIGNhX2ZpbmdlcnByaW50ID0gPycsCiAgICAgICAgICAgICAgICAgICAgQmluZCA9PiBbCiAgICAgICAgICAgICAgICAgICAgICAgIFwkV3JvbmdDZXJ0aWZpY2F0ZS0+e05ld0hhc2h9LAogICAgICAgICAgICAgICAgICAgICAgICBcJFdyb25nUmVsYXRpb24tPntJRH0sCiAgICAgICAgICAgICAgICAgICAgICAgIFwkV3JvbmdDZXJ0aWZpY2F0ZS0+e0ZpbmdlcnByaW50fSwKICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAkRGV0YWlscwogICAgICAgICAgICAgICAgICAgIC49ICIgICAgICBVcGRhdGVkIHJlbGF0aW9uIElEOiAkV3JvbmdSZWxhdGlvbi0+e0lEfSB3aXRoIGNlcnRpZmljYXRlICRXcm9uZ1JlbGF0aW9uLT57Q2VydEhhc2h9Li4uIjsKCiAgICAgICAgICAgICAgICBpZiAoJFN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgICAkRGV0YWlscyAuPSAiIDxncmVlbj5PSzwvZ3JlZW4+XG4iOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJERldGFpbHMgLj0gIiA8cmVkPkZhaWxlZDwvcmVkPlxuIjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJERldGFpbHMgLj0gIiAgICAgIE5vIHdyb25nIHJlbGF0aW9ucyBmb3VuZCwgbm90aGluZyB0byBkby4uLiA8Z3JlZW4+T0s8L2dyZWVuPlxuIjsKICAgICAgICB9CgogICAgICAgIGlmICgkSGFzUHJpdmF0ZUtleSkgewoKICAgICAgICAgICAgIyByZW5hbWUgcHJpdmF0ZSBrZXkKICAgICAgICAgICAgJERldGFpbHMgLj0gIiAgUmVuYW1lIHByaXZhdGUga2V5ICRXcm9uZ0NlcnRpZmljYXRlLT57SGFzaH0uJFdyb25nQ2VydGlmaWNhdGUtPntJbmRleH0gdG8iCiAgICAgICAgICAgICAgICAuICIgJFdyb25nQ2VydGlmaWNhdGUtPntOZXdIYXNofS4kTmV3SW5kZXguLi4iOwoKICAgICAgICAgICAgaWYgKCAhcmVuYW1lICRXcm9uZ1ByaXZhdGVLZXlGaWxlLCAkTmV3UHJpdmF0ZUtleUZpbGUgKSB7CiAgICAgICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJDb3VsZCBub3QgcmVuYW1lIFNNSU1FIHByaXZhdGUga2V5IGZpbGUgJFdyb25nUHJpdmF0ZUtleUZpbGUgdG8gJE5ld1ByaXZhdGVLZXlGaWxlISIsCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICREZXRhaWxzIC49ICIgPHJlZD5GYWlsZWQ8L3JlZD5cbiI7CgogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgICBTdWNjZXNzID0+IDAsCiAgICAgICAgICAgICAgICAgICAgRGV0YWlscyA9PiAkRGV0YWlscywKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJERldGFpbHMgLj0gIiA8Z3JlZW4+T0s8L2dyZWVuPlxuIjsKCiAgICAgICAgICAgICMgcmVuYW1lIHByaXZhdGUgc2VjcmV0CiAgICAgICAgICAgIGlmICgkSGFzUHJpdmF0ZVNlY3JldCkgewoKICAgICAgICAgICAgICAgICREZXRhaWxzIC49ICIgIFJlbmFtZSBwcml2YXRlIHNlY3JldCAkV3JvbmdDZXJ0aWZpY2F0ZS0+e0hhc2h9LiRXcm9uZ0NlcnRpZmljYXRlLT57SW5kZXh9LlAgdG8iCiAgICAgICAgICAgICAgICAgICAgLiAiICRXcm9uZ0NlcnRpZmljYXRlLT57TmV3SGFzaH0uJE5ld0luZGV4LlAuLi4iOwoKICAgICAgICAgICAgICAgIGlmICggIXJlbmFtZSggJFdyb25nUHJpdmF0ZUtleUZpbGUgLiAnLlAnLCAkTmV3UHJpdmF0ZUtleUZpbGUgLiAnLlAnICkgKSB7CiAgICAgICAgICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJDb3VsZCBub3QgcmVuYW1lIFNNSU1FIHByaXZhdGUgc2VjcmV0IGZpbGUiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuICIgJFdyb25nUHJpdmF0ZUtleUZpbGUuUCB0byAkTmV3UHJpdmF0ZUtleUZpbGUuUCEiLAogICAgICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgICAgICREZXRhaWxzIC49ICIgPHJlZD5GYWlsZWQ8L3JlZD5cbiI7CgogICAgICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgICAgICAgIFN1Y2Nlc3MgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgRGV0YWlscyA9PiAkRGV0YWlscywKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJERldGFpbHMgLj0gIiA8Z3JlZW4+T0s8L2dyZWVuPlxuIjsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICREZXRhaWxzIC49ICIgIFByaXZhdGUga2V5ICRXcm9uZ0NlcnRpZmljYXRlLT57SGFzaH0uJFdyb25nQ2VydGlmaWNhdGUtPntJbmRleH0gZm91bmQsIgogICAgICAgICAgICAgICAgICAgIC4gIiBidXQgcHJpdmF0ZSBzZWNyZXQ6ICRXcm9uZ0NlcnRpZmljYXRlLT57SGFzaH0uJFdyb25nQ2VydGlmaWNhdGUtPntJbmRleH0uUCIKICAgICAgICAgICAgICAgICAgICAuICIgaXMgbWlzc2luZy4uLiA8cmVkPldhcm5pbmc8L3JlZD5cbiI7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICREZXRhaWxzIC49ICIgIE5vIFByaXZhdGUga2V5IGZvdW5kIGZvciBjZXJ0aWZpY2F0ZSAkV3JvbmdDZXJ0aWZpY2F0ZS0+e0hhc2h9LiIKICAgICAgICAgICAgICAgIC4gIiRXcm9uZ0NlcnRpZmljYXRlLT57SW5kZXh9Li4uIDxncmVlbj5PSzwvZ3JlZW4+XG4iOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB7CiAgICAgICAgU3VjY2VzcyA9PiAxLAogICAgICAgIERldGFpbHMgPT4gJERldGFpbHMsCiAgICB9Owp9CgpzdWIgX0NoZWNrSWZDZXJ0aWZpY2F0ZUhpdCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICREQk9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEQicpOwoKICAgIG15ICRTZWFyY2ggICA9ICRQYXJhbXtTZWFyY2h9OwogICAgbXkgJEZpbGVuYW1lID0gJFBhcmFte0ZpbGVuYW1lfTsKICAgIG15ICVBdHRyaWJ1dGVzOwoKICAgIG15ICRDZXJ0aWZpY2F0ZSA9ICRTZWxmLT5DZXJ0aWZpY2F0ZUdldCggRmlsZW5hbWUgPT4gJEZpbGVuYW1lICk7CiAgICAlQXR0cmlidXRlcyA9ICRTZWxmLT5DZXJ0aWZpY2F0ZUF0dHJpYnV0ZXMoCiAgICAgICAgQ2VydGlmaWNhdGUgPT4gJENlcnRpZmljYXRlLAogICAgICAgIEZpbGVuYW1lICAgID0+ICRGaWxlbmFtZSwKICAgICk7CgogICAgbXkgJEhpdDsKICAgIEFUVFJJQlVURToKICAgIGZvciBteSAkQXR0cmlidXRlICggc29ydCBrZXlzICVBdHRyaWJ1dGVzICkgewogICAgICAgIG15IEBJdGVtcyA9IHNwbGl0IC9bLDtcc10rLywgJEF0dHJpYnV0ZXN7JEF0dHJpYnV0ZX07CiAgICAgICAgJEhpdCA9IGdyZXAgeyBkZWZpbmVkICRfICYmICRfID1+IG17XlxRJFNlYXJjaFxFJH1pIH0gQEl0ZW1zOwogICAgICAgIGxhc3QgQVRUUklCVVRFIGlmICRIaXQ7CiAgICB9CgogICAgcmV0dXJuIHsKICAgICAgICBBdHRyaWJ1dGVzID0+IFwlQXR0cmlidXRlcywKICAgICAgICBIaXQgICAgICAgID0+ICRIaXQsCiAgICB9Owp9CgpzdWIgX0NlcnRpZmljYXRlQXR0cmlidXRlc0dldCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRNYWluT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06Ok1haW4nKTsKICAgIG15ICREQk9iamVjdCAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkRCJyk7CiAgICBteSAkTG9nT2JqZWN0ICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKTsKCiAgICBteSAkU2VhcmNoID0gJFBhcmFte1NlYXJjaH07CgogICAgbXkgJU1hcHBpbmcgPSAoCiAgICAgICAgJ2UtbWFpbCcgICAgICA9PiAnZW1haWxfYWRkcmVzcycsCiAgICAgICAgJ2hhc2gnICAgICAgICA9PiAna2V5X2hhc2gnLAogICAgICAgICdpZCcgICAgICAgICAgPT4gJ2lkJywKICAgICAgICAnZmlsZW5hbWUnICAgID0+ICdmaWxlX25hbWUnLAogICAgICAgICdmaW5nZXJwcmludCcgPT4gJ2ZpbmdlcnByaW50JwogICAgKTsKCiAgICBteSAkVmFsaWQgICAgICA9ICRQYXJhbXtWYWxpZH07CiAgICBteSAkUHJpdmF0ZSAgICA9ICRQYXJhbXtQcml2YXRlfSA/ICdQJyA6ICdjZXJ0JzsKICAgIG15ICRTZWFyY2hUeXBlID0gJFBhcmFte1NlYXJjaFR5cGV9IHx8ICdlLW1haWwnOwoKICAgICRTZWFyY2hUeXBlID0gJE1hcHBpbmd7JFNlYXJjaFR5cGV9OwoKICAgIG15IEBCaW5kOwogICAgbXkgJFNRTCA9ICJTRUxFQ1Qga2V5X2hhc2gsIGV4cGlyYXRpb25fZGF0ZSwgZmlsZV9uYW1lLCBpZCBmcm9tIHNtaW1lX2tleXMgV0hFUkUga2V5X3R5cGUgPSA/ICI7CiAgICBwdXNoIEBCaW5kLCBcJFByaXZhdGU7CgogICAgaWYgKCBJc1N0cmluZ1dpdGhEYXRhKCRTZWFyY2gpICkgewoKICAgICAgICAjIFByZXZlbnQgdXNlIG9mIHVuaGFuZGxlZCBhdHRyaWJ1dGUuCiAgICAgICAgaWYgKCAhZ3JlcCB7ICRfIGVxICRTZWFyY2hUeXBlIH0gdmFsdWVzICVNYXBwaW5nICkgewogICAgICAgICAgICAkTG9nT2JqZWN0LT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ0dpdmVuIFNlYXJjaFR5cGUgaXMgbm90IGFsbG93ZWQuJywKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBteSAkU2VhcmNoUXVlcnkgPSAkU2VhcmNoOwoKICAgICAgICAjIEhhbmRsZSBtdWx0aXBsZSBlLW1haWwgY2VydGlmaWNhdGVzLgogICAgICAgIGlmICggJFNlYXJjaFR5cGUgZXEgImVtYWlsX2FkZHJlc3MiICkgewoKICAgICAgICAgICAgJFNRTCAuPSAiQU5EICIgLiAkREJPYmplY3QtPlF1ZXJ5Q29uZGl0aW9uKAogICAgICAgICAgICAgICAgS2V5ICAgICAgICAgID0+ICRTZWFyY2hUeXBlLAogICAgICAgICAgICAgICAgVmFsdWUgICAgICAgID0+ICRTZWFyY2gsCiAgICAgICAgICAgICAgICBTZWFyY2hQcmVmaXggPT4gJyonLAogICAgICAgICAgICAgICAgU2VhcmNoU3VmZml4ID0+ICcqJwogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJFNRTCAuPSAiQU5EICRTZWFyY2hUeXBlID0gPyI7CiAgICAgICAgICAgIHB1c2ggQEJpbmQsIFwkU2VhcmNoUXVlcnk7CiAgICAgICAgfQogICAgfQoKICAgIG15ICRDZXJ0aWZpY2F0ZXMgPSAkREJPYmplY3QtPlNlbGVjdEFsbCgKICAgICAgICBTUUwgID0+ICRTUUwsCiAgICAgICAgQmluZCA9PiBcQEJpbmQsCiAgICApOwoKICAgIG15IEBDZXJ0aWZpY2F0ZXM7CiAgICBDRVJUSUZJQ0FURToKICAgIGZvciBteSAkQ2VydGlmaWNhdGUgKCBAeyRDZXJ0aWZpY2F0ZXN9ICkgewogICAgICAgIG15ICRDZXJ0aWZpY2F0ZVJlZiA9ICRNYWluT2JqZWN0LT5GaWxlUmVhZCgKICAgICAgICAgICAgRGlyZWN0b3J5ID0+ICRTZWxmLT57Q2VydFBhdGh9LAogICAgICAgICAgICBGaWxlbmFtZSAgPT4gJENlcnRpZmljYXRlLT5bMl0sCiAgICAgICAgKTsKICAgICAgICBuZXh0IENFUlRJRklDQVRFIGlmICEkQ2VydGlmaWNhdGVSZWY7CgogICAgICAgIG15ICVBdHRyaWJ1dGVzID0gJFNlbGYtPkNlcnRpZmljYXRlQXR0cmlidXRlcygKICAgICAgICAgICAgQ2VydGlmaWNhdGUgPT4gJCRDZXJ0aWZpY2F0ZVJlZiwKICAgICAgICAgICAgRmlsZW5hbWUgICAgPT4gJENlcnRpZmljYXRlLT5bMl0sCiAgICAgICAgKTsKICAgICAgICBuZXh0IENFUlRJRklDQVRFIGlmICElQXR0cmlidXRlczsKCiAgICAgICAgaWYgKAogICAgICAgICAgICBJc1N0cmluZ1dpdGhEYXRhKCRTZWFyY2gpCiAgICAgICAgICAgICYmICRTZWFyY2hUeXBlIGVxICdlbWFpbF9hZGRyZXNzJwogICAgICAgICAgICApCiAgICAgICAgewogICAgICAgICAgICBteSBARW1haWxzID0gc3BsaXQoICcsICcsICRBdHRyaWJ1dGVze0VtYWlsfSApOwoKICAgICAgICAgICAgIyBNdWx0aXBsZSBtYWlsIGFkZHJlc3MgY2FzZSBpbnNlbnNpdGl2ZTsKICAgICAgICAgICAgbmV4dCBDRVJUSUZJQ0FURSBpZiAhZ3JlcCB7ICRfID1+IC9cQVxRJFNlYXJjaFxFL2kgfSBARW1haWxzOwogICAgICAgIH0KCiAgICAgICAgJEF0dHJpYnV0ZXN7RmlsZW5hbWV9ICAgICAgPSAkQ2VydGlmaWNhdGUtPlsyXSBpZiAhJEF0dHJpYnV0ZXN7RmlsZW5hbWV9OwogICAgICAgICRBdHRyaWJ1dGVze0NlcnRpZmljYXRlSUR9ID0gJENlcnRpZmljYXRlLT5bM10gaWYgISRBdHRyaWJ1dGVze0NlcnRpZmljYXRlSUR9OwoKICAgICAgICBpZiAoCiAgICAgICAgICAgICRQYXJhbXtQcml2YXRlfQogICAgICAgICAgICAmJiAkQXR0cmlidXRlc3tQcml2YXRlfQogICAgICAgICAgICAmJiAkQXR0cmlidXRlc3tQcml2YXRlfSBlcSAnWWVzJwogICAgICAgICAgICApCiAgICAgICAgewogICAgICAgICAgICAkQXR0cmlidXRlc3tUeXBlfSA9ICdrZXknOwogICAgICAgIH0KCiAgICAgICAgbmV4dCBDRVJUSUZJQ0FURSBpZiAkVmFsaWQgJiYgJFNlbGYtPktleUV4cGlyZWRDaGVjayggRW5kRGF0ZSA9PiAkQXR0cmlidXRlc3tFbmREYXRlfSApOwoKICAgICAgICBwdXNoIEBDZXJ0aWZpY2F0ZXMsIFwlQXR0cmlidXRlczsKICAgIH0KCiAgICByZXR1cm4gQENlcnRpZmljYXRlczsKfQoKc3ViIF9Ob25JbmRleGVkQXR0cmlidXRlc0xvb2t1cCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRTZWFyY2ggICAgICAgID0gJFBhcmFte1NlYXJjaH07CiAgICBteSAkRmlsZW5hbWUgICAgICA9ICRQYXJhbXtGaWxlbmFtZX07CiAgICBteSAkQXR0cmlidXRlc1JlZiA9ICRQYXJhbXtBdHRyaWJ1dGVzfTsKCiAgICBteSAkSGl0ID0gMTsKICAgIG15ICVMb2NhbEF0dHJpYnV0ZXM7CiAgICBpZiAoJFNlYXJjaCkgewogICAgICAgIG15ICRSZXN1bHQgPSAkU2VsZi0+X0NoZWNrSWZDZXJ0aWZpY2F0ZUhpdCgKICAgICAgICAgICAgRmlsZW5hbWUgPT4gJEZpbGVuYW1lLAogICAgICAgICAgICBTZWFyY2ggICA9PiAkU2VhcmNoLAogICAgICAgICAgICBQcml2YXRlICA9PiAxLAogICAgICAgICkgLy8ge307CgogICAgICAgICRIaXQgICAgICAgICAgICAgPSAkUmVzdWx0LT57SGl0fTsKICAgICAgICAlTG9jYWxBdHRyaWJ1dGVzID0gJXsgJFJlc3VsdC0+e0F0dHJpYnV0ZXN9IC8vIHt9IH07CiAgICB9CgogICAgaWYgKCAhJExvY2FsQXR0cmlidXRlc3tIYXNofSApIHsKICAgICAgICBteSAkQ2VydGlmaWNhdGUgPSAkU2VsZi0+Q2VydGlmaWNhdGVHZXQoIEZpbGVuYW1lID0+ICRGaWxlbmFtZSApOwogICAgICAgICVMb2NhbEF0dHJpYnV0ZXMgPSAkU2VsZi0+Q2VydGlmaWNhdGVBdHRyaWJ1dGVzKAogICAgICAgICAgICBDZXJ0aWZpY2F0ZSA9PiAkQ2VydGlmaWNhdGUsCiAgICAgICAgICAgIEZpbGVuYW1lICAgID0+ICRGaWxlbmFtZSwKICAgICAgICApOwogICAgfQogICAgJSRBdHRyaWJ1dGVzUmVmID0gJUxvY2FsQXR0cmlidXRlczsKCiAgICByZXR1cm4gJEhpdDsKfQoKMTsKCj1lbmQgSW50ZXJuYWw6Cgo9Y3V0Cgo9aGVhZDEgVEVSTVMgQU5EIENPTkRJVElPTlMKClRoaXMgc29mdHdhcmUgaXMgcGFydCBvZiB0aGUgT1RSUyBwcm9qZWN0IChMPGh0dHBzOi8vb3Rycy5vcmcvPikuCgpUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQp0aGUgZW5jbG9zZWQgZmlsZSBDT1BZSU5HIGZvciBsaWNlbnNlIGluZm9ybWF0aW9uIChHUEwpLiBJZiB5b3UKZGlkIG5vdCByZWNlaXZlIHRoaXMgZmlsZSwgc2VlIEw8aHR0cHM6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9ncGwtMy4wLnR4dD4uCgo9Y3V0Cg==</File>
        <File Location="Custom/Kernel/System/CustomerCompany/DB.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxLTIwMjIgWm51bnkgR21iSCwgaHR0cHM6Ly96bnVueS5vcmcvCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6U3lzdGVtOjpDdXN0b21lckNvbXBhbnk6OkRCOwoKdXNlIHN0cmljdDsKdXNlIHdhcm5pbmdzOwoKdXNlIEtlcm5lbDo6U3lzdGVtOjpWYXJpYWJsZUNoZWNrIHF3KDphbGwpOwoKb3VyIEBPYmplY3REZXBlbmRlbmNpZXMgPSAoCiAgICAnS2VybmVsOjpTeXN0ZW06OkNhY2hlJywKICAgICdLZXJuZWw6OlN5c3RlbTo6REInLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpEeW5hbWljRmllbGQnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpEeW5hbWljRmllbGQ6OkJhY2tlbmQnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpMb2cnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpWYWxpZCcsCik7CgpzdWIgbmV3IHsKICAgIG15ICggJFR5cGUsICVQYXJhbSApID0gQF87CgogICAgIyBhbGxvY2F0ZSBuZXcgaGFzaCBmb3Igb2JqZWN0CiAgICBteSAkU2VsZiA9IHt9OwogICAgYmxlc3MoICRTZWxmLCAkVHlwZSApOwoKICAgICMgZ2V0IGN1c3RvbWVyIGNvbXBhbnkgbWFwCiAgICAkU2VsZi0+e0N1c3RvbWVyQ29tcGFueU1hcH0gPSAkUGFyYW17Q3VzdG9tZXJDb21wYW55TWFwfSB8fCBkaWUgIkdvdCBubyBDdXN0b21lckNvbXBhbnlNYXAhIjsKCiAgICAjIGNvbmZpZyBvcHRpb25zCiAgICAkU2VsZi0+e0N1c3RvbWVyQ29tcGFueVRhYmxlfSA9ICRTZWxmLT57Q3VzdG9tZXJDb21wYW55TWFwfS0+e1BhcmFtc30tPntUYWJsZX0KICAgICAgICB8fCBkaWUgIk5lZWQgQ3VzdG9tZXJDb21wYW55LT5QYXJhbXMtPlRhYmxlIGluIEtlcm5lbC9Db25maWcucG0hIjsKICAgICRTZWxmLT57Q3VzdG9tZXJDb21wYW55S2V5fSA9ICRTZWxmLT57Q3VzdG9tZXJDb21wYW55TWFwfS0+e0N1c3RvbWVyQ29tcGFueUtleX0KICAgICAgICB8fCBkaWUgIk5lZWQgQ3VzdG9tZXJDb21wYW55LT5DdXN0b21lckNvbXBhbnlLZXkgaW4gS2VybmVsL0NvbmZpZy5wbSEiOwogICAgJFNlbGYtPntDdXN0b21lckNvbXBhbnlWYWxpZH0gPSAkU2VsZi0+e0N1c3RvbWVyQ29tcGFueU1hcH0tPnsnQ3VzdG9tZXJDb21wYW55VmFsaWQnfTsKICAgICRTZWxmLT57U2VhcmNoTGlzdExpbWl0fSAgICAgID0gJFNlbGYtPntDdXN0b21lckNvbXBhbnlNYXB9LT57J0N1c3RvbWVyQ29tcGFueVNlYXJjaExpc3RMaW1pdCd9IHx8IDUwMDAwOwogICAgJFNlbGYtPntTZWFyY2hQcmVmaXh9ICAgICAgICAgPSAkU2VsZi0+e0N1c3RvbWVyQ29tcGFueU1hcH0tPnsnQ3VzdG9tZXJDb21wYW55U2VhcmNoUHJlZml4J307CgogICAgaWYgKCAhZGVmaW5lZCggJFNlbGYtPntTZWFyY2hQcmVmaXh9ICkgKSB7CiAgICAgICAgJFNlbGYtPntTZWFyY2hQcmVmaXh9ID0gJyc7CiAgICB9CiAgICAkU2VsZi0+e1NlYXJjaFN1ZmZpeH0gPSAkU2VsZi0+e0N1c3RvbWVyQ29tcGFueU1hcH0tPnsnQ3VzdG9tZXJDb21wYW55U2VhcmNoU3VmZml4J307CiAgICBpZiAoICFkZWZpbmVkKCAkU2VsZi0+e1NlYXJjaFN1ZmZpeH0gKSApIHsKICAgICAgICAkU2VsZi0+e1NlYXJjaFN1ZmZpeH0gPSAnKic7CiAgICB9CgogICAgIyBjcmVhdGUgY2FjaGUgb2JqZWN0LCBidXQgb25seSBpZiBDYWNoZVRUTCBpcyBzZXQgaW4gY3VzdG9tZXIgY29uZmlnCiAgICBpZiAoICRTZWxmLT57Q3VzdG9tZXJDb21wYW55TWFwfS0+e0NhY2hlVFRMfSApIHsKICAgICAgICAkU2VsZi0+e0NhY2hlT2JqZWN0fSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDYWNoZScpOwogICAgICAgICRTZWxmLT57Q2FjaGVUeXBlfSAgID0gJ0N1c3RvbWVyQ29tcGFueScgLiAkUGFyYW17Q291bnR9OwogICAgICAgICRTZWxmLT57Q2FjaGVUVEx9ICAgID0gJFNlbGYtPntDdXN0b21lckNvbXBhbnlNYXB9LT57Q2FjaGVUVEx9IHx8IDA7CiAgICB9CgogICAgIyBnZXQgZGF0YWJhc2Ugb2JqZWN0CiAgICAkU2VsZi0+e0RCT2JqZWN0fSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEQicpOwoKICAgICMgY3JlYXRlIG5ldyBkYiBjb25uZWN0IGlmIERTTiBpcyBnaXZlbgogICAgaWYgKCAkU2VsZi0+e0N1c3RvbWVyQ29tcGFueU1hcH0tPntQYXJhbXN9LT57RFNOfSApIHsKICAgICAgICAkU2VsZi0+e0RCT2JqZWN0fSA9IEtlcm5lbDo6U3lzdGVtOjpEQi0+bmV3KAogICAgICAgICAgICBEYXRhYmFzZURTTiAgPT4gJFNlbGYtPntDdXN0b21lckNvbXBhbnlNYXB9LT57UGFyYW1zfS0+e0RTTn0sCiAgICAgICAgICAgIERhdGFiYXNlVXNlciA9PiAkU2VsZi0+e0N1c3RvbWVyQ29tcGFueU1hcH0tPntQYXJhbXN9LT57VXNlcn0sCiAgICAgICAgICAgIERhdGFiYXNlUHcgICA9PiAkU2VsZi0+e0N1c3RvbWVyQ29tcGFueU1hcH0tPntQYXJhbXN9LT57UGFzc3dvcmR9LAogICAgICAgICAgICBUeXBlICAgICAgICAgPT4gJFNlbGYtPntDdXN0b21lckNvbXBhbnlNYXB9LT57UGFyYW1zfS0+e1R5cGV9IHx8ICcnLAogICAgICAgICkgfHwgZGllKCdDYW5cJ3QgY29ubmVjdCB0byBkYXRhYmFzZSEnKTsKCiAgICAgICAgIyByZW1lbWJlciB0aGF0IHdlIGhhdmUgdGhlIERCT2JqZWN0IG5vdCBmcm9tIHBhcmVudCBjYWxsCiAgICAgICAgJFNlbGYtPntOb3RQYXJlbnREQk9iamVjdH0gPSAxOwogICAgfQoKICAgICMgdGhpcyBzZXR0aW5nIHNwZWNpZmllcyBpZiB0aGUgdGFibGUgaGFzIHRoZSBjcmVhdGVfdGltZSwKICAgICMgY3JlYXRlX2J5LCBjaGFuZ2VfdGltZSBhbmQgY2hhbmdlX2J5IGZpZWxkcyBvZiBPVFJTCiAgICAkU2VsZi0+e0ZvcmVpZ25EQn0gPSAkU2VsZi0+e0N1c3RvbWVyQ29tcGFueU1hcH0tPntQYXJhbXN9LT57Rm9yZWlnbkRCfSA/IDEgOiAwOwoKICAgICMgZGVmaW5lcyBpZiB0aGUgZGF0YWJhc2Ugc2VhcmNoIHdpbGwgYmUgcGVyZm9ybWVuZCBjYXNlIHNlbnNpdGl2ZSAoMSkgb3Igbm90ICgwKQogICAgJFNlbGYtPntDYXNlU2Vuc2l0aXZlfSA9ICRTZWxmLT57Q3VzdG9tZXJDb21wYW55TWFwfS0+e1BhcmFtc30tPntTZWFyY2hDYXNlU2Vuc2l0aXZlfQogICAgICAgIC8vICRTZWxmLT57Q3VzdG9tZXJDb21wYW55TWFwfS0+e1BhcmFtc30tPntDYXNlU2Vuc2l0aXZlfSB8fCAwOwoKICAgICMgZmV0Y2ggbmFtZXMgb2YgY29uZmlndXJlZCBkeW5hbWljIGZpZWxkcwogICAgbXkgQER5bmFtaWNGaWVsZE1hcEVudHJpZXMgPSBncmVwIHsgJF8tPls1XSBlcSAnZHluYW1pY19maWVsZCcgfSBAeyAkU2VsZi0+e0N1c3RvbWVyQ29tcGFueU1hcH0tPntNYXB9IH07CiAgICAkU2VsZi0+e0NvbmZpZ3VyZWREeW5hbWljRmllbGROYW1lc30gPSB7IG1hcCB7ICRfLT5bMl0gPT4gMSB9IEBEeW5hbWljRmllbGRNYXBFbnRyaWVzIH07CgogICAgaWYgKCRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnTXVsdGlUZW5hbmN5JykpIHsKICAgICAgICAkU2VsZi0+e011bHRpVGVuYW5jeX0gPSAxOwogICAgfQogICAgcmV0dXJuICRTZWxmOwp9CgpzdWIgQ3VzdG9tZXJDb21wYW55TGlzdCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBpZiAoICRTZWxmLT57TXVsdGlUZW5hbmN5fSAmJiAhJFBhcmFte1VzZXJJRH0gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdOZWVkIFVzZXJJRCEnCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBteSAkVmFsaWQgPSAxOwogICAgaWYgKCAhJFBhcmFte1ZhbGlkfSAmJiBkZWZpbmVkKCAkUGFyYW17VmFsaWR9ICkgKSB7CiAgICAgICAgJFZhbGlkID0gMDsKICAgIH0KCiAgICBteSAkTGltaXQgPSAkUGFyYW17TGltaXR9IC8vICRTZWxmLT57U2VhcmNoTGlzdExpbWl0fTsKCiAgICBteSAkQ2FjaGVUeXBlOwogICAgbXkgJENhY2hlS2V5OwoKICAgICMgY2hlY2sgY2FjaGUKICAgIGlmICggJFNlbGYtPntDYWNoZU9iamVjdH0gKSB7CgogICAgICAgICRDYWNoZVR5cGUgPSAkU2VsZi0+e0NhY2hlVHlwZX0gLiAnX0N1c3RvbWVyQ29tcGFueUxpc3QnOwogICAgICAgICRDYWNoZUtleSAgPSAiQ3VzdG9tZXJDb21wYW55TGlzdDo6JHtWYWxpZH06OiR7TGltaXR9OjoiOwogICAgICAgIGlmICggJFNlbGYtPntNdWx0aVRlbmFuY3l9ICYmICEkUGFyYW17VXNlcklEfSApIHsKICAgICAgICAgICAgJENhY2hlS2V5IC49ICRQYXJhbXtVc2VySUR9IC4gIjo6IjsKICAgICAgICB9CiAgICAgICAgJENhY2hlS2V5IC49ICggJFBhcmFte1NlYXJjaH0gfHwgJycgKTsKCiAgICAgICAgbXkgJERhdGEgPSAkU2VsZi0+e0NhY2hlT2JqZWN0fS0+R2V0KAogICAgICAgICAgICBUeXBlID0+ICRDYWNoZVR5cGUsCiAgICAgICAgICAgIEtleSAgPT4gJENhY2hlS2V5LAogICAgICAgICk7CiAgICAgICAgcmV0dXJuICV7JERhdGF9IGlmIHJlZiAkRGF0YSBlcSAnSEFTSCc7CiAgICB9CgogICAgbXkgJEN1c3RvbWVyQ29tcGFueUxpc3RGaWVsZHMgPSAkU2VsZi0+e0N1c3RvbWVyQ29tcGFueU1hcH0tPntDdXN0b21lckNvbXBhbnlMaXN0RmllbGRzfTsKICAgIGlmICggIUlzQXJyYXlSZWZXaXRoRGF0YSgkQ3VzdG9tZXJDb21wYW55TGlzdEZpZWxkcykgKSB7CiAgICAgICAgJEN1c3RvbWVyQ29tcGFueUxpc3RGaWVsZHMgPSBbICdjdXN0b21lcl9pZCcsICduYW1lJywgXTsKICAgIH0KCiAgICAjIHJlbW92ZSBkeW5hbWljIGZpZWxkIG5hbWVzIHRoYXQgYXJlIGNvbmZpZ3VyZWQgaW4gQ3VzdG9tZXJDb21wYW55TGlzdEZpZWxkcwogICAgIyBhcyB0aGV5IGNhbm5vdCBiZSBoYW5kbGVkIGhlcmUKICAgIG15IEBDdXN0b21lckNvbXBhbnlMaXN0RmllbGRzV2l0aG91dER5bmFtaWNGaWVsZHMKICAgICAgICA9IGdyZXAgeyAhZXhpc3RzICRTZWxmLT57Q29uZmlndXJlZER5bmFtaWNGaWVsZE5hbWVzfS0+eyRffSB9IEB7JEN1c3RvbWVyQ29tcGFueUxpc3RGaWVsZHN9OwoKICAgICMgd2hhdCBpcyB0aGUgcmVzdWx0CiAgICBteSAkV2hhdCA9IGpvaW4oCiAgICAgICAgJywgJywKICAgICAgICBAQ3VzdG9tZXJDb21wYW55TGlzdEZpZWxkc1dpdGhvdXREeW5hbWljRmllbGRzCiAgICApOwoKICAgICMgYWRkIHZhbGlkIG9wdGlvbiBpZiByZXF1aXJlZAogICAgbXkgJFNRTDsKICAgIG15IEBCaW5kOwogICAgbXkgQENvbmRpdGlvbnM7CiAgICBteSAkVmFsaWRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VmFsaWQnKTsKICAgIG15ICRWYWxpZElEcyA9IGpvaW4oJywnLCAkVmFsaWRPYmplY3QtPlZhbGlkSURzR2V0KCkpOwogICAgbXkgJFNRTGZyb207CgogICAgaWYgKCAkVmFsaWQgJiYgJFNlbGYtPntDdXN0b21lckNvbXBhbnlWYWxpZH0gKSB7CiAgICAgICAgcHVzaCBAQ29uZGl0aW9ucywgImN1c3RvbWVyX2NvbXBhbnkuJFNlbGYtPntDdXN0b21lckNvbXBhbnlWYWxpZH0gSU4gKCRWYWxpZElEcykiOwogICAgfQoKICAgIGlmICggJFNlbGYtPntNdWx0aVRlbmFuY3l9ICYmICRQYXJhbXtVc2VySUR9ICE9IDEgKSB7CiAgICAgICAgIyBmaW5kIG9ubHkgY3VzdG9tZXJzIHZpc2libGUgdG8gVXNlciB2aWEgYSBjb21tb24gZ3JvdXAKICAgICAgICBwdXNoIEBDb25kaXRpb25zLCAicm9sZXMudmFsaWRfaWQgSU4gKCRWYWxpZElEcykiIGlmICgkVmFsaWQpOwogICAgICAgIHB1c2ggQENvbmRpdGlvbnMsICIoCiAgICAgICAgICAgICgKICAgICAgICAgICAgICAgIHJvbGVfdXNlci51c2VyX2lkID0gJFBhcmFte1VzZXJJRH0KICAgICAgICAgICAgICAgIEFORCBncm91cF9yb2xlLnBlcm1pc3Npb25fa2V5ID0gJ3J3JwogICAgICAgICAgICApIE9SICgKICAgICAgICAgICAgICAgIGdyb3VwX3VzZXIudXNlcl9pZCA9ICRQYXJhbXtVc2VySUR9CiAgICAgICAgICAgICAgICBBTkQgZ3JvdXBfdXNlci5wZXJtaXNzaW9uX2tleSA9ICdydycKICAgICAgICAgICAgKQogICAgICAgICkiOwogICAgICAgICRTUUxmcm9tID0gIgogICAgICAgICAgICBKT0lOIGdyb3VwX2N1c3RvbWVyCiAgICAgICAgICAgIE9OIGdyb3VwX2N1c3RvbWVyLmN1c3RvbWVyX2lkID0gY3VzdG9tZXJfY29tcGFueS5jdXN0b21lcl9pZAogICAgICAgICAgICBKT0lOIGdyb3VwX3JvbGUgQVMgZ3JvdXBfcm9sZQogICAgICAgICAgICBPTiBncm91cF9yb2xlLmdyb3VwX2lkID0gZ3JvdXBfY3VzdG9tZXIuZ3JvdXBfaWQKICAgICAgICAgICAgSk9JTiByb2xlcwogICAgICAgICAgICBPTiByb2xlcy5pZCA9IGdyb3VwX3JvbGUucm9sZV9pZAogICAgICAgICAgICBKT0lOIHJvbGVfdXNlciBPTiByb2xlX3VzZXIucm9sZV9pZCA9IHJvbGVzLmlkCiAgICAgICAgICAgIExFRlQgSk9JTiBncm91cF91c2VyCiAgICAgICAgICAgIE9OIGdyb3VwX3VzZXIuZ3JvdXBfaWQgPSBncm91cF9jdXN0b21lci5ncm91cF9pZAogICAgICAgICI7CiAgICB9CgogICAgbXkgJUNvbHVtbnNNYXAgPSAoCiAgICAgICAgJ2N1c3RvbWVyX2lkJyA9PiAnY3VzdG9tZXJfY29tcGFueS5jdXN0b21lcl9pZCcsCiAgICAgICAgJ25hbWUnID0+ICdjdXN0b21lcl9jb21wYW55Lm5hbWUnCiAgICApOwoKICAgICMgd2hlcmUKICAgIGlmICggJFBhcmFte1NlYXJjaH0gKSB7CgogICAgICAgICMgcmVtb3ZlIGR5bmFtaWMgZmllbGQgbmFtZXMgdGhhdCBhcmUgY29uZmlndXJlZCBpbiBDdXN0b21lckNvbXBhbnlTZWFyY2hGaWVsZHMKICAgICAgICAjIGFzIHRoZXkgY2Fubm90IGJlIHJldHJpZXZlZCBoZXJlCiAgICAgICAgbXkgQEN1c3RvbWVyQ29tcGFueVNlYXJjaEZpZWxkcyA9IGdyZXAgeyAhZXhpc3RzICRTZWxmLT57Q29uZmlndXJlZER5bmFtaWNGaWVsZE5hbWVzfS0+eyRffSB9CiAgICAgICAgICAgIEB7ICRTZWxmLT57Q3VzdG9tZXJDb21wYW55TWFwfS0+e0N1c3RvbWVyQ29tcGFueVNlYXJjaEZpZWxkc30gfTsKCiAgICAgICAgQEN1c3RvbWVyQ29tcGFueVNlYXJjaEZpZWxkcyA9IG1hcCB7ICRDb2x1bW5zTWFweyRffSB8fCAkXyB9IEBDdXN0b21lckNvbXBhbnlTZWFyY2hGaWVsZHM7CgogICAgICAgIG15ICVRdWVyeUNvbmRpdGlvbiA9ICRTZWxmLT57REJPYmplY3R9LT5RdWVyeUNvbmRpdGlvbigKICAgICAgICAgICAgS2V5ICAgICAgICAgICA9PiBcQEN1c3RvbWVyQ29tcGFueVNlYXJjaEZpZWxkcywKICAgICAgICAgICAgVmFsdWUgICAgICAgICA9PiAkUGFyYW17U2VhcmNofSwKICAgICAgICAgICAgU2VhcmNoUHJlZml4ICA9PiAkU2VsZi0+e1NlYXJjaFByZWZpeH0sCiAgICAgICAgICAgIFNlYXJjaFN1ZmZpeCAgPT4gJFNlbGYtPntTZWFyY2hTdWZmaXh9LAogICAgICAgICAgICBDYXNlU2Vuc2l0aXZlID0+ICRTZWxmLT57Q2FzZVNlbnNpdGl2ZX0sCiAgICAgICAgICAgIEJpbmRNb2RlICAgICAgPT4gMSwKICAgICAgICApOwoKICAgICAgICBpZiAoICRRdWVyeUNvbmRpdGlvbntTUUx9ICkgewogICAgICAgICAgICBwdXNoIEBDb25kaXRpb25zLCAiICRRdWVyeUNvbmRpdGlvbntTUUx9IjsKICAgICAgICAgICAgcHVzaCBAQmluZCwgICAgICAgQHsgJFF1ZXJ5Q29uZGl0aW9ue1ZhbHVlc30gfTsKICAgICAgICB9CiAgICB9CgogICAgIyBkeW5hbWljIGZpZWxkIGhhbmRsaW5nCiAgICBteSAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEeW5hbWljRmllbGQ6OkJhY2tlbmQnKTsKCiAgICBteSAkRHluYW1pY0ZpZWxkQ29uZmlncyA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEeW5hbWljRmllbGQnKS0+RHluYW1pY0ZpZWxkTGlzdEdldCgKICAgICAgICBPYmplY3RUeXBlID0+ICdDdXN0b21lckNvbXBhbnknLAogICAgICAgIFZhbGlkICAgICAgPT4gMSwKICAgICk7CiAgICBteSAlRHluYW1pY0ZpZWxkQ29uZmlnc0J5TmFtZSA9IG1hcCB7ICRfLT57TmFtZX0gPT4gJF8gfSBAeyREeW5hbWljRmllbGRDb25maWdzfTsKCiAgICBteSBAQ3VzdG9tZXJDb21wYW55TGlzdEZpZWxkc0R5bmFtaWNGaWVsZHMKICAgICAgICA9IGdyZXAgeyBleGlzdHMgJFNlbGYtPntDb25maWd1cmVkRHluYW1pY0ZpZWxkTmFtZXN9LT57JF99IH0gQHskQ3VzdG9tZXJDb21wYW55TGlzdEZpZWxkc307CgogICAgIyBzcWwKICAgIG15ICRDb21wbGV0ZVNRTDsKICAgIGlmICggJFNlbGYtPntNdWx0aVRlbmFuY3l9ICYmICRQYXJhbXtVc2VySUR9ICE9IDEgKSB7CiAgICAgICAgbXkgQFdoYXQgPSBtYXAgeyAkQ29sdW1uc01hcHskX30gfHwgJF8gfSAoCiAgICAgICAgICAgICRTZWxmLT57Q3VzdG9tZXJDb21wYW55S2V5fSwKICAgICAgICAgICAgQEN1c3RvbWVyQ29tcGFueUxpc3RGaWVsZHNXaXRob3V0RHluYW1pY0ZpZWxkcwogICAgICAgICk7CiAgICAgICAgJENvbXBsZXRlU1FMID0gIlNFTEVDVCBESVNUSU5DVCAiIC4gam9pbiggJywgJywgQFdoYXQpIC4KICAgICAgICAgICAgIiBGUk9NICRTZWxmLT57Q3VzdG9tZXJDb21wYW55VGFibGV9ICIgLiAkU1FMZnJvbTsKICAgIH0gZWxzZSB7CiAgICAgICAgJENvbXBsZXRlU1FMID0gIlNFTEVDVCAkU2VsZi0+e0N1c3RvbWVyQ29tcGFueUtleX0sICRXaGF0IEZST00gJFNlbGYtPntDdXN0b21lckNvbXBhbnlUYWJsZX0iOwogICAgfQoKICAgIGlmIChAQ29uZGl0aW9ucykgewogICAgICAgICRTUUwgPSBqb2luKCAnIEFORCAnLCBAQ29uZGl0aW9ucyApOwogICAgICAgICRDb21wbGV0ZVNRTCAuPSAiIFdIRVJFICRTUUwiOwogICAgfQoKICAgICMgZ2V0IGRhdGEgZnJvbSBjdXN0b21lciBjb21wYW55IHRhYmxlCiAgICAkU2VsZi0+e0RCT2JqZWN0fS0+UHJlcGFyZSgKICAgICAgICBTUUwgICA9PiAkQ29tcGxldGVTUUwsCiAgICAgICAgQmluZCAgPT4gXEBCaW5kLAogICAgICAgIExpbWl0ID0+ICRMaW1pdCwKICAgICk7CgogICAgbXkgQEN1c3RvbWVyQ29tcGFueURhdGE7CiAgICB3aGlsZSAoIG15IEBSb3cgPSAkU2VsZi0+e0RCT2JqZWN0fS0+RmV0Y2hyb3dBcnJheSgpICkgewogICAgICAgIHB1c2ggQEN1c3RvbWVyQ29tcGFueURhdGEsIFtAUm93XTsKICAgIH0KCiAgICBteSAlTGlzdDsKCiAgICBDVVNUT01FUkNPTVBBTllEQVRBOgogICAgZm9yIG15ICRDdXN0b21lckNvbXBhbnlEYXRhIChAQ3VzdG9tZXJDb21wYW55RGF0YSkgewogICAgICAgIG15ICRDdXN0b21lckNvbXBhbnlJRCA9IHNoaWZ0IEB7JEN1c3RvbWVyQ29tcGFueURhdGF9OwogICAgICAgIG5leHQgQ1VTVE9NRVJDT01QQU5ZREFUQSBpZiAkTGlzdHskQ3VzdG9tZXJDb21wYW55SUR9OwoKICAgICAgICBteSAlQ29tcGFueVN0cmluZ1BhcnRzOwoKICAgICAgICBteSAkRmllbGRDb3VudGVyID0gMDsKICAgICAgICBmb3IgbXkgJEZpZWxkICggQHskQ3VzdG9tZXJDb21wYW55RGF0YX0gKSB7CiAgICAgICAgICAgICRDb21wYW55U3RyaW5nUGFydHN7ICRDdXN0b21lckNvbXBhbnlMaXN0RmllbGRzV2l0aG91dER5bmFtaWNGaWVsZHNbJEZpZWxkQ291bnRlcl0gfSA9ICRGaWVsZDsKICAgICAgICAgICAgJEZpZWxkQ291bnRlcisrOwogICAgICAgIH0KCiAgICAgICAgIyBmZXRjaCBkeW5hbWljIGZpZWxkIHZhbHVlcywgaWYgY29uZmlndXJlZAogICAgICAgIGlmIChAQ3VzdG9tZXJDb21wYW55TGlzdEZpZWxkc0R5bmFtaWNGaWVsZHMpIHsKICAgICAgICAgICAgRFlOQU1JQ0ZJRUxETkFNRToKICAgICAgICAgICAgZm9yIG15ICREeW5hbWljRmllbGROYW1lIChAQ3VzdG9tZXJDb21wYW55TGlzdEZpZWxkc0R5bmFtaWNGaWVsZHMpIHsKICAgICAgICAgICAgICAgIG5leHQgRFlOQU1JQ0ZJRUxETkFNRSBpZiAhZXhpc3RzICREeW5hbWljRmllbGRDb25maWdzQnlOYW1leyREeW5hbWljRmllbGROYW1lfTsKCiAgICAgICAgICAgICAgICBteSAkVmFsdWUgPSAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdC0+VmFsdWVHZXQoCiAgICAgICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRDb25maWdzQnlOYW1leyREeW5hbWljRmllbGROYW1lfSwKICAgICAgICAgICAgICAgICAgICBPYmplY3ROYW1lICAgICAgICAgPT4gJEN1c3RvbWVyQ29tcGFueUlELAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICBuZXh0IERZTkFNSUNGSUVMRE5BTUUgaWYgIWRlZmluZWQgJFZhbHVlOwoKICAgICAgICAgICAgICAgIGlmICggIUlzQXJyYXlSZWZXaXRoRGF0YSgkVmFsdWUpICkgewogICAgICAgICAgICAgICAgICAgICRWYWx1ZSA9IFskVmFsdWVdOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIG15IEBWYWx1ZXM7CgogICAgICAgICAgICAgICAgVkFMVUU6CiAgICAgICAgICAgICAgICBmb3IgbXkgJEN1cnJlbnRWYWx1ZSAoIEB7JFZhbHVlfSApIHsKICAgICAgICAgICAgICAgICAgICBuZXh0IFZBTFVFIGlmICFkZWZpbmVkICRDdXJyZW50VmFsdWUgfHwgIWxlbmd0aCAkQ3VycmVudFZhbHVlOwoKICAgICAgICAgICAgICAgICAgICBteSAkUmVhZGFibGVWYWx1ZSA9ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0LT5SZWFkYWJsZVZhbHVlUmVuZGVyKAogICAgICAgICAgICAgICAgICAgICAgICBEeW5hbWljRmllbGRDb25maWcgPT4gJER5bmFtaWNGaWVsZENvbmZpZ3NCeU5hbWV7JER5bmFtaWNGaWVsZE5hbWV9LAogICAgICAgICAgICAgICAgICAgICAgICBWYWx1ZSAgICAgICAgICAgICAgPT4gJEN1cnJlbnRWYWx1ZSwKICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICAgICBuZXh0IFZBTFVFIGlmICFJc0hhc2hSZWZXaXRoRGF0YSgkUmVhZGFibGVWYWx1ZSkgfHwgIWRlZmluZWQgJFJlYWRhYmxlVmFsdWUtPntWYWx1ZX07CgogICAgICAgICAgICAgICAgICAgIG15ICRJc0FDTFJlZHVjaWJsZSA9ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0LT5IYXNCZWhhdmlvcigKICAgICAgICAgICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRDb25maWdzQnlOYW1leyREeW5hbWljRmllbGROYW1lfSwKICAgICAgICAgICAgICAgICAgICAgICAgQmVoYXZpb3IgICAgICAgICAgID0+ICdJc0FDTFJlZHVjaWJsZScsCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICBpZiAoJElzQUNMUmVkdWNpYmxlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG15ICRQb3NzaWJsZVZhbHVlcyA9ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0LT5Qb3NzaWJsZVZhbHVlc0dldCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZENvbmZpZyA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnc0J5TmFtZXskRHluYW1pY0ZpZWxkTmFtZX0sCiAgICAgICAgICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBJc0hhc2hSZWZXaXRoRGF0YSgkUG9zc2libGVWYWx1ZXMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAmJiBkZWZpbmVkICRQb3NzaWJsZVZhbHVlcy0+eyAkUmVhZGFibGVWYWx1ZS0+e1ZhbHVlfSB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICRSZWFkYWJsZVZhbHVlLT57VmFsdWV9ID0gJFBvc3NpYmxlVmFsdWVzLT57ICRSZWFkYWJsZVZhbHVlLT57VmFsdWV9IH07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHB1c2ggQFZhbHVlcywgJFJlYWRhYmxlVmFsdWUtPntWYWx1ZX07CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgJENvbXBhbnlTdHJpbmdQYXJ0c3skRHluYW1pY0ZpZWxkTmFtZX0gPSBqb2luICcgJywgQFZhbHVlczsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBhc3NlbWJsZSBjb21wYW55IHN0cmluZwogICAgICAgIG15IEBDb21wYW55U3RyaW5nUGFydHM7CiAgICAgICAgQ1VTVE9NRVJDT01QQU5ZTElTVEZJRUxEOgogICAgICAgIGZvciBteSAkQ3VzdG9tZXJDb21wYW55TGlzdEZpZWxkICggQHskQ3VzdG9tZXJDb21wYW55TGlzdEZpZWxkc30gKSB7CiAgICAgICAgICAgIG5leHQgQ1VTVE9NRVJDT01QQU5ZTElTVEZJRUxECiAgICAgICAgICAgICAgICBpZiAhZXhpc3RzICRDb21wYW55U3RyaW5nUGFydHN7JEN1c3RvbWVyQ29tcGFueUxpc3RGaWVsZH0KICAgICAgICAgICAgICAgIHx8ICFkZWZpbmVkICRDb21wYW55U3RyaW5nUGFydHN7JEN1c3RvbWVyQ29tcGFueUxpc3RGaWVsZH0KICAgICAgICAgICAgICAgIHx8ICFsZW5ndGggJENvbXBhbnlTdHJpbmdQYXJ0c3skQ3VzdG9tZXJDb21wYW55TGlzdEZpZWxkfTsKICAgICAgICAgICAgcHVzaCBAQ29tcGFueVN0cmluZ1BhcnRzLCAkQ29tcGFueVN0cmluZ1BhcnRzeyRDdXN0b21lckNvbXBhbnlMaXN0RmllbGR9OwogICAgICAgIH0KCiAgICAgICAgJExpc3R7JEN1c3RvbWVyQ29tcGFueUlEfSA9IGpvaW4gJyAnLCBAQ29tcGFueVN0cmluZ1BhcnRzOwogICAgfQoKICAgICMgY2FjaGUgcmVxdWVzdAogICAgaWYgKCAkU2VsZi0+e0NhY2hlT2JqZWN0fSApIHsKICAgICAgICAkU2VsZi0+e0NhY2hlT2JqZWN0fS0+U2V0KAogICAgICAgICAgICBUeXBlICA9PiAkQ2FjaGVUeXBlLAogICAgICAgICAgICBLZXkgICA9PiAkQ2FjaGVLZXksCiAgICAgICAgICAgIFZhbHVlID0+IFwlTGlzdCwKICAgICAgICAgICAgVFRMICAgPT4gJFNlbGYtPntDYWNoZVRUTH0sCiAgICAgICAgKTsKICAgIH0KCiAgICByZXR1cm4gJUxpc3Q7Cn0KCnN1YiBDdXN0b21lckNvbXBhbnlTZWFyY2hEZXRhaWwgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBpZiAoIHJlZiAkUGFyYW17U2VhcmNoRmllbGRzfSBuZSAnQVJSQVknICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiU2VhcmNoRmllbGRzIG11c3QgYmUgYW4gYXJyYXkgcmVmZXJlbmNlISIsCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgbXkgJFZhbGlkID0gZGVmaW5lZCAkUGFyYW17VmFsaWR9ID8gJFBhcmFte1ZhbGlkfSA6IDE7CgogICAgJFBhcmFte0xpbWl0fSAvLz0gJyc7CgogICAgIyBTcGxpdCB0aGUgc2VhcmNoIGZpZWxkcyBpbiBzY2FsYXIgYW5kIGFycmF5IGZpZWxkcy4KICAgIG15IEBTY2FsYXJTZWFyY2hGaWVsZHMgPSBncmVwIHsgJ0lucHV0JyBlcSAkXy0+e1R5cGV9IH0gQHsgJFBhcmFte1NlYXJjaEZpZWxkc30gfTsKICAgIG15IEBBcnJheVNlYXJjaEZpZWxkcyAgPSBncmVwIHsgJ1NlbGVjdGlvbicgZXEgJF8tPntUeXBlfSB9IEB7ICRQYXJhbXtTZWFyY2hGaWVsZHN9IH07CgogICAgIyBWZXJpZnkgdGhhdCBhbGwgcGFzc2VkIGFycmF5IHBhcmFtZXRlcnMgY29udGFpbiBhbiBhcnJheXJlZi4KICAgIEFSR1VNRU5UOgogICAgZm9yIG15ICRBcmd1bWVudCAoQEFycmF5U2VhcmNoRmllbGRzKSB7CiAgICAgICAgaWYgKCAhZGVmaW5lZCAkUGFyYW17ICRBcmd1bWVudC0+e05hbWV9IH0gKSB7CiAgICAgICAgICAgICRQYXJhbXsgJEFyZ3VtZW50LT57TmFtZX0gfSB8fD0gW107CgogICAgICAgICAgICBuZXh0IEFSR1VNRU5UOwogICAgICAgIH0KCiAgICAgICAgaWYgKCByZWYgJFBhcmFteyAkQXJndW1lbnQtPntOYW1lfSB9IG5lICdBUlJBWScgKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICIkQXJndW1lbnQtPntOYW1lfSBtdXN0IGJlIGFuIGFycmF5IHJlZmVyZW5jZSEiLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgICMgU2V0IHRoZSBkZWZhdWx0IGJlaGF2aW91ciBmb3IgdGhlIHJldHVybiB0eXBlLgogICAgbXkgJFJlc3VsdCA9ICRQYXJhbXtSZXN1bHR9IHx8ICdBUlJBWSc7CgogICAgIyBTcGVjaWFsIGhhbmRsaW5nIGlmIHRoZSByZXN1bHQgdHlwZSBpcyAnQ09VTlQnLgogICAgaWYgKCAkUmVzdWx0IGVxICdDT1VOVCcgKSB7CgogICAgICAgICMgSWdub3JlIHRoZSBwYXJhbWV0ZXIgJ0xpbWl0JyB3aGVuIHJlc3VsdCB0eXBlIGlzICdDT1VOVCcuCiAgICAgICAgJFBhcmFte0xpbWl0fSA9ICcnOwoKICAgICAgICAjIERlbGV0ZSB0aGUgT3JkZXJCeSBwYXJhbWV0ZXIgd2hlbiB0aGUgcmVzdWx0IHR5cGUgaXMgJ0NPVU5UJy4KICAgICAgICAkUGFyYW17T3JkZXJCeX0gPSBbXTsKICAgIH0KCiAgICAjIERlZmluZSBvcmRlciB0YWJsZSBmcm9tIHRoZSBzZWFyY2ggZmllbGRzLgogICAgbXkgJU9yZGVyQnlUYWJsZSA9IG1hcCB7ICRfLT57TmFtZX0gPT4gJF8tPntEYXRhYmFzZUZpZWxkfSB9IEB7ICRQYXJhbXtTZWFyY2hGaWVsZHN9IH07CgogICAgZm9yIG15ICRGaWVsZCAoQEFycmF5U2VhcmNoRmllbGRzKSB7CgogICAgICAgIG15ICRTZWxlY3Rpb25zRGF0YSA9ICRGaWVsZC0+e1NlbGVjdGlvbnNEYXRhfTsKCiAgICAgICAgZm9yIG15ICRTZWxlY3RlZFZhbHVlICggQHsgJFBhcmFteyAkRmllbGQtPntOYW1lfSB9IH0gKSB7CgogICAgICAgICAgICAjIENoZWNrIGlmIHRoZSBzZWxlY3RlZCB2YWx1ZSBmb3IgdGhlIGN1cnJlbnQgZmllbGQgaXMgdmFsaWQuCiAgICAgICAgICAgIGlmICggISRTZWxlY3Rpb25zRGF0YS0+eyRTZWxlY3RlZFZhbHVlfSApIHsKICAgICAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIlRoZSBzZWxlY3RlZCB2YWx1ZSAkRmllbGQtPntOYW1lfSBpcyBub3QgdmFsaWQhIiwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgbXkgJERCT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkRCJyk7CgogICAgIyBBc3NlbWJsZSB0aGUgY29uZGl0aW9ucyB1c2VkIGluIHRoZSBXSEVSRSBjbGF1c2UuCiAgICBteSBAU1FMV2hlcmU7CgogICAgZm9yIG15ICRGaWVsZCAoQFNjYWxhclNlYXJjaEZpZWxkcykgewoKICAgICAgICAjIFNlYXJjaCBmb3Igc2NhbGFyIGZpZWxkcyAod2lsZGNhcmRzIGFyZSBhbGxvd2VkKS4KICAgICAgICBpZiAoICRQYXJhbXsgJEZpZWxkLT57TmFtZX0gfSApIHsKCiAgICAgICAgICAgICMgR2V0IGxpa2UgZXNjYXBlIHN0cmluZyBuZWVkZWQgZm9yIHNvbWUgZGF0YWJhc2VzIChlLmcuIG9yYWNsZSkuCiAgICAgICAgICAgIG15ICRMaWtlRXNjYXBlU3RyaW5nID0gJERCT2JqZWN0LT5HZXREYXRhYmFzZUZ1bmN0aW9uKCdMaWtlRXNjYXBlU3RyaW5nJyk7CgogICAgICAgICAgICAkUGFyYW17ICRGaWVsZC0+e05hbWV9IH0gPSAkREJPYmplY3QtPlF1b3RlKCAkUGFyYW17ICRGaWVsZC0+e05hbWV9IH0sICdMaWtlJyApOwoKICAgICAgICAgICAgJFBhcmFteyAkRmllbGQtPntOYW1lfSB9ID1+IHN7IFwqKyB9eyV9eG1zZzsKCiAgICAgICAgICAgICMgSWYgdGhlIGZpZWxkIGNvbnRhaW5zIG1vcmUgdGhhbiBvbmx5ICclJy4KICAgICAgICAgICAgaWYgKCAkUGFyYW17ICRGaWVsZC0+e05hbWV9IH0gIX4gbXsgXEEgJSogXHogfXhtcyApIHsKICAgICAgICAgICAgICAgIHB1c2ggQFNRTFdoZXJlLAogICAgICAgICAgICAgICAgICAgICJMT1dFUigkRmllbGQtPntEYXRhYmFzZUZpZWxkfSkgTElLRSBMT1dFUignJFBhcmFteyAkRmllbGQtPntOYW1lfSB9JykgJExpa2VFc2NhcGVTdHJpbmciOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIG15ICREeW5hbWljRmllbGRPYmplY3QgICAgICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkR5bmFtaWNGaWVsZCcpOwogICAgbXkgJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6RHluYW1pY0ZpZWxkOjpCYWNrZW5kJyk7CgogICAgIyBDaGVjayBhbGwgY29uZmlndXJlZCBjaGFuZ2UgZHluYW1pYyBmaWVsZHMsIGJ1aWxkIGxvb2t1cCBoYXNoIGJ5IG5hbWUuCiAgICBteSAlQ3VzdG9tZXJDb21wYW55RHluYW1pY0ZpZWxkTmFtZTJDb25maWc7CiAgICBteSAkQ3VzdG9tZXJDb21wYW55RHluYW1pY0ZpZWxkcyA9ICREeW5hbWljRmllbGRPYmplY3QtPkR5bmFtaWNGaWVsZExpc3RHZXQoCiAgICAgICAgT2JqZWN0VHlwZSA9PiAnQ3VzdG9tZXJDb21wYW55JywKICAgICk7CiAgICBmb3IgbXkgJER5bmFtaWNGaWVsZCAoIEB7JEN1c3RvbWVyQ29tcGFueUR5bmFtaWNGaWVsZHN9ICkgewogICAgICAgICRDdXN0b21lckNvbXBhbnlEeW5hbWljRmllbGROYW1lMkNvbmZpZ3sgJER5bmFtaWNGaWVsZC0+e05hbWV9IH0gPSAkRHluYW1pY0ZpZWxkOwogICAgfQoKICAgIG15ICRTUUxEeW5hbWljRmllbGRGcm9tICAgICA9ICcnOwogICAgbXkgJFNRTER5bmFtaWNGaWVsZFdoZXJlICAgID0gJyc7CiAgICBteSAkRHluYW1pY0ZpZWxkSm9pbkNvdW50ZXIgPSAxOwoKICAgIERZTkFNSUNGSUVMRDoKICAgIGZvciBteSAkRHluYW1pY0ZpZWxkICggQHskQ3VzdG9tZXJDb21wYW55RHluYW1pY0ZpZWxkc30gKSB7CgogICAgICAgIG15ICRTZWFyY2hQYXJhbSA9ICRQYXJhbXsgIkR5bmFtaWNGaWVsZF8iIC4gJER5bmFtaWNGaWVsZC0+e05hbWV9IH07CgogICAgICAgIG5leHQgRFlOQU1JQ0ZJRUxEIGlmICggISRTZWFyY2hQYXJhbSApOwogICAgICAgIG5leHQgRFlOQU1JQ0ZJRUxEIGlmICggcmVmICRTZWFyY2hQYXJhbSBuZSAnSEFTSCcgKTsKCiAgICAgICAgbXkgJE5lZWRKb2luOwoKICAgICAgICBmb3IgbXkgJE9wZXJhdG9yICggc29ydCBrZXlzICV7JFNlYXJjaFBhcmFtfSApIHsKCiAgICAgICAgICAgIG15IEBTZWFyY2hQYXJhbXMgPSAoIHJlZiAkU2VhcmNoUGFyYW0tPnskT3BlcmF0b3J9IGVxICdBUlJBWScgKQogICAgICAgICAgICAgICAgPyBAeyAkU2VhcmNoUGFyYW0tPnskT3BlcmF0b3J9IH0KICAgICAgICAgICAgICAgIDogKCAkU2VhcmNoUGFyYW0tPnskT3BlcmF0b3J9ICk7CgogICAgICAgICAgICBteSAkU1FMRHluYW1pY0ZpZWxkV2hlcmVTdWIgPSAnJzsKICAgICAgICAgICAgaWYgKCRTUUxEeW5hbWljRmllbGRXaGVyZSkgewogICAgICAgICAgICAgICAgJFNRTER5bmFtaWNGaWVsZFdoZXJlU3ViID0gJyBBTkQgKCc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkU1FMRHluYW1pY0ZpZWxkV2hlcmVTdWIgPSAnICgnOwogICAgICAgICAgICB9CgogICAgICAgICAgICBteSAkQ291bnRlciA9IDA7CiAgICAgICAgICAgIFRFWFQ6CiAgICAgICAgICAgIGZvciBteSAkVGV4dCAoQFNlYXJjaFBhcmFtcykgewogICAgICAgICAgICAgICAgbmV4dCBURVhUIGlmICggIWRlZmluZWQgJFRleHQgfHwgJFRleHQgZXEgJycgKTsKCiAgICAgICAgICAgICAgICAkVGV4dCA9fiBzL1wqLyUvZ2k7CgogICAgICAgICAgICAgICAgIyBDaGVjayBzZWFyY2ggYXR0cmlidXRlLCB3ZSBkbyBub3QgbmVlZCB0byBzZWFyY2ggZm9yICcqJy4KICAgICAgICAgICAgICAgIG5leHQgVEVYVCBpZiAkVGV4dCA9fiAvXlwlezEsM30kLzsKCiAgICAgICAgICAgICAgICBteSAkVmFsaWRhdGVTdWNjZXNzID0gJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QtPlZhbHVlVmFsaWRhdGUoCiAgICAgICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGQsCiAgICAgICAgICAgICAgICAgICAgVmFsdWUgICAgICAgICAgICAgID0+ICRUZXh0LAogICAgICAgICAgICAgICAgICAgIFVzZXJJRCAgICAgICAgICAgICA9PiAkUGFyYW17VXNlcklEfSB8fCAxLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGlmICggISRWYWxpZGF0ZVN1Y2Nlc3MgKSB7CiAgICAgICAgICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJTZWFyY2ggbm90IGV4ZWN1dGVkIGR1ZSB0byBpbnZhbGlkIHZhbHVlICciCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuICRUZXh0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuICInIG9uIGZpZWxkICciCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuICREeW5hbWljRmllbGQtPntOYW1lfSAuICInISIsCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCRDb3VudGVyKSB7CiAgICAgICAgICAgICAgICAgICAgJFNRTER5bmFtaWNGaWVsZFdoZXJlU3ViIC49ICcgT1IgJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICRTUUxEeW5hbWljRmllbGRXaGVyZVN1YiAuPSAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdC0+U2VhcmNoU1FMR2V0KAogICAgICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZENvbmZpZyA9PiAkRHluYW1pY0ZpZWxkLAogICAgICAgICAgICAgICAgICAgIFRhYmxlQWxpYXMgICAgICAgICA9PiAiZGZ2JER5bmFtaWNGaWVsZEpvaW5Db3VudGVyIiwKICAgICAgICAgICAgICAgICAgICBPcGVyYXRvciAgICAgICAgICAgPT4gJE9wZXJhdG9yLAogICAgICAgICAgICAgICAgICAgIFNlYXJjaFRlcm0gICAgICAgICA9PiAkVGV4dCwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgJENvdW50ZXIrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICAkU1FMRHluYW1pY0ZpZWxkV2hlcmVTdWIgLj0gJykgJzsKCiAgICAgICAgICAgIGlmICgkQ291bnRlcikgewogICAgICAgICAgICAgICAgJFNRTER5bmFtaWNGaWVsZFdoZXJlIC49ICRTUUxEeW5hbWljRmllbGRXaGVyZVN1YjsKICAgICAgICAgICAgICAgICROZWVkSm9pbiA9IDE7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICgkTmVlZEpvaW4pIHsKICAgICAgICAgICAgJFNRTER5bmFtaWNGaWVsZEZyb20gLj0gIgogICAgICAgICAgICAgICAgSU5ORVIgSk9JTiBkeW5hbWljX2ZpZWxkX3ZhbHVlIGRmdiREeW5hbWljRmllbGRKb2luQ291bnRlcgogICAgICAgICAgICAgICAgICAgIE9OIChkZl9vYmpfaWRfbmFtZS5vYmplY3RfaWQgPSBkZnYkRHluYW1pY0ZpZWxkSm9pbkNvdW50ZXIub2JqZWN0X2lkCiAgICAgICAgICAgICAgICAgICAgICAgIEFORCBkZnYkRHluYW1pY0ZpZWxkSm9pbkNvdW50ZXIuZmllbGRfaWQgPSAiCiAgICAgICAgICAgICAgICAuICREQk9iamVjdC0+UXVvdGUoICREeW5hbWljRmllbGQtPntJRH0sICdJbnRlZ2VyJyApIC4gIikKICAgICAgICAgICAgIjsKCiAgICAgICAgICAgICREeW5hbWljRmllbGRKb2luQ291bnRlcisrOwogICAgICAgIH0KICAgIH0KCiAgICAjIEV4ZWN1dGUgYSBkeW5hbWljIGZpZWxkIHNlYXJjaCwgaWYgYSBkeW5hbWljIGZpZWxkIHdoZXJlIHN0YXRlbWVudCBleGlzdHMuCiAgICBpZiAoICRTUUxEeW5hbWljRmllbGRGcm9tICYmICRTUUxEeW5hbWljRmllbGRXaGVyZSApIHsKCiAgICAgICAgbXkgQER5bmFtaWNGaWVsZEN1c3RvbWVySURzOwoKICAgICAgICAjIFNxbCB1ZXJ5IGZvciB0aGUgZHluYW1pYyBmaWVsZHMuCiAgICAgICAgbXkgJFNRTER5bmFtaWNGaWVsZAogICAgICAgICAgICA9ICJTRUxFQ1QgRElTVElOQ1QoZGZfb2JqX2lkX25hbWUub2JqZWN0X25hbWUpIEZST00gZHluYW1pY19maWVsZF9vYmpfaWRfbmFtZSBkZl9vYmpfaWRfbmFtZSAiCiAgICAgICAgICAgIC4gJFNRTER5bmFtaWNGaWVsZEZyb20KICAgICAgICAgICAgLiAiIFdIRVJFICIKICAgICAgICAgICAgLiAkU1FMRHluYW1pY0ZpZWxkV2hlcmU7CgogICAgICAgIG15ICRVc2VkQ2FjaGU7CgogICAgICAgIGlmICggJFNlbGYtPntDYWNoZU9iamVjdH0gKSB7CgogICAgICAgICAgICBteSAkRHluYW1pY0ZpZWxkU2VhcmNoQ2FjaGVEYXRhID0gJFNlbGYtPntDYWNoZU9iamVjdH0tPkdldCgKICAgICAgICAgICAgICAgIFR5cGUgPT4gJFNlbGYtPntDYWNoZVR5cGV9IC4gJ19DdXN0b21lclNlYXJjaERldGFpbER5bmFtaWNGaWVsZHMnLAogICAgICAgICAgICAgICAgS2V5ICA9PiAkU1FMRHluYW1pY0ZpZWxkLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKCBkZWZpbmVkICREeW5hbWljRmllbGRTZWFyY2hDYWNoZURhdGEgKSB7CiAgICAgICAgICAgICAgICBpZiAoIHJlZiAkRHluYW1pY0ZpZWxkU2VhcmNoQ2FjaGVEYXRhIGVxICdBUlJBWScgKSB7CiAgICAgICAgICAgICAgICAgICAgQER5bmFtaWNGaWVsZEN1c3RvbWVySURzID0gQHskRHluYW1pY0ZpZWxkU2VhcmNoQ2FjaGVEYXRhfTsKCiAgICAgICAgICAgICAgICAgICAgIyBTZXQgdGhlIHVzZWQgY2FjaGUgZmxhZy4KICAgICAgICAgICAgICAgICAgICAkVXNlZENhY2hlID0gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAnSW52YWxpZCByZWYgJyAuIHJlZigkRHluYW1pY0ZpZWxkU2VhcmNoQ2FjaGVEYXRhKSAuICchJwogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIEdldCB0aGUgZGF0YSBvbmx5IGZyb20gZGF0YWJhc2UsIGlmIG5vIGNhY2hlIGVudHJ5IGV4aXN0cy4KICAgICAgICBpZiAoICEkVXNlZENhY2hlICkgewoKICAgICAgICAgICAgcmV0dXJuIGlmICEkREJPYmplY3QtPlByZXBhcmUoCiAgICAgICAgICAgICAgICBTUUwgPT4gJFNRTER5bmFtaWNGaWVsZCwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIHdoaWxlICggbXkgQFJvdyA9ICREQk9iamVjdC0+RmV0Y2hyb3dBcnJheSgpICkgewogICAgICAgICAgICAgICAgcHVzaCBARHluYW1pY0ZpZWxkQ3VzdG9tZXJJRHMsICRSb3dbMF07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICggJFNlbGYtPntDYWNoZU9iamVjdH0gKSB7CiAgICAgICAgICAgICAgICAkU2VsZi0+e0NhY2hlT2JqZWN0fS0+U2V0KAogICAgICAgICAgICAgICAgICAgIFR5cGUgID0+ICRTZWxmLT57Q2FjaGVUeXBlfSAuICdfQ3VzdG9tZXJTZWFyY2hEZXRhaWxEeW5hbWljRmllbGRzJywKICAgICAgICAgICAgICAgICAgICBLZXkgICA9PiAkU1FMRHluYW1pY0ZpZWxkLAogICAgICAgICAgICAgICAgICAgIFZhbHVlID0+IFxARHluYW1pY0ZpZWxkQ3VzdG9tZXJJRHMsCiAgICAgICAgICAgICAgICAgICAgVFRMICAgPT4gJFNlbGYtPntDdXN0b21lckNvbXBhbnlNYXB9LT57Q2FjaGVUVEx9LAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBBZGQgdGhlIHVzZXIgbG9naW5zIGZyb20gdGhlIGR5bmFtaWMgZmllbGRzLCBpZiBhIHNlYXJjaCByZXN1bHQgZXhpc3RzIGZyb20gdGhlIGR5bmFtaWMgZmllbGQgc2VhcmNoCiAgICAgICAgIyAgIG9yIHNraXAgdGhlIHNlYXJjaCBhbmQgcmV0dXJuIGEgZW1wdHJ5IGFycmF5IHJlZiAob3IgemVybyBmb3IgdGhlIHJlc3VsdCAnQ09VTlQnLCBpZiBubyB1c2VyIGxvZ2lucyBleGlzdHMKICAgICAgICAjICAgZnJvbSB0aGUgZHluYW1pYyBmaWVsZCBzZWFyY2guCiAgICAgICAgaWYgKEBEeW5hbWljRmllbGRDdXN0b21lcklEcykgewoKICAgICAgICAgICAgbXkgJFNRTFF1ZXJ5SW5Db25kaXRpb24gPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6REInKS0+UXVlcnlJbkNvbmRpdGlvbigKICAgICAgICAgICAgICAgIEtleSAgICAgID0+ICRTZWxmLT57Q3VzdG9tZXJDb21wYW55S2V5fSwKICAgICAgICAgICAgICAgIFZhbHVlcyAgID0+IFxARHluYW1pY0ZpZWxkQ3VzdG9tZXJJRHMsCiAgICAgICAgICAgICAgICBCaW5kTW9kZSA9PiAwLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgcHVzaCBAU1FMV2hlcmUsICRTUUxRdWVyeUluQ29uZGl0aW9uOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuICRSZXN1bHQgZXEgJ0NPVU5UJyA/IDAgOiBbXTsKICAgICAgICB9CiAgICB9CgogICAgRklFTEQ6CiAgICBmb3IgbXkgJEZpZWxkIChAQXJyYXlTZWFyY2hGaWVsZHMpIHsKCiAgICAgICAgbmV4dCBGSUVMRCBpZiAhQHsgJFBhcmFteyAkRmllbGQtPntOYW1lfSB9IH07CgogICAgICAgIG15ICRTUUxRdWVyeUluQ29uZGl0aW9uID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkRCJyktPlF1ZXJ5SW5Db25kaXRpb24oCiAgICAgICAgICAgIEtleSAgICAgID0+ICRGaWVsZC0+e0RhdGFiYXNlRmllbGR9LAogICAgICAgICAgICBWYWx1ZXMgICA9PiAkUGFyYW17ICRGaWVsZC0+e05hbWV9IH0sCiAgICAgICAgICAgIEJpbmRNb2RlID0+IDAsCiAgICAgICAgKTsKCiAgICAgICAgcHVzaCBAU1FMV2hlcmUsICRTUUxRdWVyeUluQ29uZGl0aW9uOwogICAgfQoKICAgICMgQWRkIHRoZSB2YWxpZCBvcHRpb24gaWYgbmVlZGVkLgogICAgaWYgKCAkU2VsZi0+e0N1c3RvbWVyQ29tcGFueU1hcH0tPntDdXN0b21lclZhbGlkfSAmJiAkVmFsaWQgKSB7CgogICAgICAgIG15ICRWYWxpZE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpWYWxpZCcpOwoKICAgICAgICBwdXNoIEBTUUxXaGVyZSwKICAgICAgICAgICAgIiRTZWxmLT57Q3VzdG9tZXJDb21wYW55TWFwfS0+e0N1c3RvbWVyVmFsaWR9IElOICgiIC4gam9pbiggJywgJywgJFZhbGlkT2JqZWN0LT5WYWxpZElEc0dldCgpICkgLiAiKSAiOwogICAgfQoKICAgICMgQ2hlY2sgaWYgT3JkZXJCeSBjb250YWlucyBvbmx5IHVuaXF1ZSB2YWxpZCB2YWx1ZXMuCiAgICBteSAlT3JkZXJCeVNlZW47CiAgICBmb3IgbXkgJE9yZGVyQnkgKCBAeyAkUGFyYW17T3JkZXJCeX0gfSApIHsKCiAgICAgICAgaWYgKCAhJE9yZGVyQnkgfHwgJE9yZGVyQnlTZWVueyRPcmRlckJ5fSApIHsKCiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJPcmRlckJ5IGNvbnRhaW5zIGludmFsaWQgdmFsdWUgJyRPcmRlckJ5JyAiCiAgICAgICAgICAgICAgICAgICAgLiAnb3IgdGhlIHZhbHVlIGlzIHVzZWQgbW9yZSB0aGFuIG9uY2UhJywKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgIyBSZW1lbWJlciB0aGUgdmFsdWUgdG8gY2hlY2sgaWYgaXQgYXBwZWFycyBtb3JlIHRoYW4gb25jZS4KICAgICAgICAkT3JkZXJCeVNlZW57JE9yZGVyQnl9ID0gMTsKICAgIH0KCiAgICAjIENoZWNrIGlmIE9yZGVyQnlEaXJlY3Rpb24gYXJyYXkgY29udGFpbnMgb25seSAnVXAnIG9yICdEb3duJy4KICAgIERJUkVDVElPTjoKICAgIGZvciBteSAkRGlyZWN0aW9uICggQHsgJFBhcmFte09yZGVyQnlEaXJlY3Rpb259IH0gKSB7CgogICAgICAgICMgT25seSAnVXAnIG9yICdEb3duJyBhbGxvd2VkLgogICAgICAgIG5leHQgRElSRUNUSU9OIGlmICREaXJlY3Rpb24gZXEgJ1VwJzsKICAgICAgICBuZXh0IERJUkVDVElPTiBpZiAkRGlyZWN0aW9uIGVxICdEb3duJzsKCiAgICAgICAgIyBmb3VuZCBhbiBlcnJvcgogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiT3JkZXJCeURpcmVjdGlvbiBjYW4gb25seSBjb250YWluICdVcCcgb3IgJ0Rvd24nISIsCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgIyBCdWlsZCB0aGUgc3FsIHN0YXRlbWVudCBmb3IgdGhlIHNlYXJjaC4KICAgIG15ICRTUUwgPSAiU0VMRUNUIERJU1RJTkNUKCRTZWxmLT57Q3VzdG9tZXJDb21wYW55S2V5fSkiOwoKICAgICMgTW9kaWZ5IFNRTCB3aGVuIHRoZSByZXN1bHQgdHlwZSBpcyAnQ09VTlQnLgogICAgaWYgKCAkUmVzdWx0IGVxICdDT1VOVCcgKSB7CiAgICAgICAgJFNRTCA9ICJTRUxFQ1QgQ09VTlQoRElTVElOQ1QoJFNlbGYtPntDdXN0b21lckNvbXBhbnlLZXl9KSkiOwogICAgfQoKICAgIG15IEBTUUxPcmRlckJ5OwoKICAgICMgVGhlIE9yZGVyIGJ5IGNsYXVzZSBpcyBub3QgbmVlZGVkIGZvciB0aGUgcmVzdWx0IHR5cGUgJ0NPVU5UJy4KICAgIGlmICggJFJlc3VsdCBuZSAnQ09VTlQnICkgewoKICAgICAgICBteSAkQ291bnQgPSAwOwoKICAgICAgICBPUkRFUkJZOgogICAgICAgIGZvciBteSAkT3JkZXJCeSAoIEB7ICRQYXJhbXtPcmRlckJ5fSB9ICkgewoKICAgICAgICAgICAgIyBTZXQgdGhlIGRlZmF1bHQgb3JkZXIgZGlyZWN0aW9uLgogICAgICAgICAgICBteSAkRGlyZWN0aW9uID0gJ0RFU0MnOwoKICAgICAgICAgICAgIyBBZGQgdGhlIGdpdmVuIG9yZGVyIGRpcmVjdGlvbi4KICAgICAgICAgICAgaWYgKCAkUGFyYW17T3JkZXJCeURpcmVjdGlvbn0tPlskQ291bnRdICkgewogICAgICAgICAgICAgICAgaWYgKCAkUGFyYW17T3JkZXJCeURpcmVjdGlvbn0tPlskQ291bnRdIGVxICdVcCcgKSB7CiAgICAgICAgICAgICAgICAgICAgJERpcmVjdGlvbiA9ICdBU0MnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzaWYgKCAkUGFyYW17T3JkZXJCeURpcmVjdGlvbn0tPlskQ291bnRdIGVxICdEb3duJyApIHsKICAgICAgICAgICAgICAgICAgICAkRGlyZWN0aW9uID0gJ0RFU0MnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAkQ291bnQrKzsKCiAgICAgICAgICAgIG5leHQgT1JERVJCWSBpZiAhJE9yZGVyQnlUYWJsZXskT3JkZXJCeX07CgogICAgICAgICAgICBwdXNoIEBTUUxPcmRlckJ5LCAiJE9yZGVyQnlUYWJsZXskT3JkZXJCeX0gJERpcmVjdGlvbiI7CgogICAgICAgICAgICBuZXh0IE9SREVSQlkgaWYgJE9yZGVyQnkgZXEgJ0N1c3RvbWVySUQnOwoKICAgICAgICAgICAgJFNRTCAuPSAiLCAkT3JkZXJCeVRhYmxleyRPcmRlckJ5fSI7CiAgICAgICAgfQoKICAgICAgICAjIElmIHRoZXJlIGlzIGEgcG9zc2liaWxpdHkgdGhhdCB0aGUgb3JkZXJpbmcgaXMgbm90IGRldGVybWluZWQKICAgICAgICAjICAgd2UgYWRkIGFuIGRlc2NlbmRpbmcgb3JkZXJpbmcgYnkgaWQuCiAgICAgICAgaWYgKCAhZ3JlcCB7ICRfIGVxICdDdXN0b21lcklEJyB9ICggQHsgJFBhcmFte09yZGVyQnl9IH0gKSApIHsKICAgICAgICAgICAgcHVzaCBAU1FMT3JkZXJCeSwgIiRTZWxmLT57Q3VzdG9tZXJDb21wYW55S2V5fSBERVNDIjsKICAgICAgICB9CiAgICB9CgogICAgIyBBZGQgZm9ybSB0byB0aGUgU1FMIGFmdGVyIHRoZSBvcmRlciBieSBjcmVhdGlvbi4KICAgICRTUUwgLj0gIiBGUk9NICRTZWxmLT57Q3VzdG9tZXJDb21wYW55VGFibGV9ICI7CgogICAgaWYgKEBTUUxXaGVyZSkgewogICAgICAgIG15ICRTUUxXaGVyZVN0cmluZyA9IGpvaW4gJyBBTkQgJywgbWFwIHsiKCAkXyApIn0gQFNRTFdoZXJlOwogICAgICAgICRTUUwgLj0gIldIRVJFICRTUUxXaGVyZVN0cmluZyAiOwogICAgfQoKICAgIGlmIChAU1FMT3JkZXJCeSkgewogICAgICAgIG15ICRPcmRlckJ5U3RyaW5nID0gam9pbiAnLCAnLCBAU1FMT3JkZXJCeTsKICAgICAgICAkU1FMIC49ICJPUkRFUiBCWSAkT3JkZXJCeVN0cmluZyI7CiAgICB9CgogICAgIyBDaGVjayBpZiBhIGNhY2hlIGV4aXN0cyBiZWZvcmUgd2UgYXNrIHRoZSBkYXRhYmFzZS4KICAgIGlmICggJFNlbGYtPntDYWNoZU9iamVjdH0gKSB7CgogICAgICAgIG15ICRDYWNoZURhdGEgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2FjaGUnKS0+R2V0KAogICAgICAgICAgICBUeXBlID0+ICRTZWxmLT57Q2FjaGVUeXBlfSAuICdfQ3VzdG9tZXJDb21wYW55U2VhcmNoRGV0YWlsJywKICAgICAgICAgICAgS2V5ICA9PiAkU1FMIC4gJFBhcmFte0xpbWl0fSwKICAgICAgICApOwoKICAgICAgICBpZiAoIGRlZmluZWQgJENhY2hlRGF0YSApIHsKICAgICAgICAgICAgaWYgKCByZWYgJENhY2hlRGF0YSBlcSAnQVJSQVknICkgewogICAgICAgICAgICAgICAgcmV0dXJuICRDYWNoZURhdGE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzaWYgKCByZWYgJENhY2hlRGF0YSBlcSAnJyApIHsKICAgICAgICAgICAgICAgIHJldHVybiAkQ2FjaGVEYXRhOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdJbnZhbGlkIHJlZiAnIC4gcmVmKCRDYWNoZURhdGEpIC4gJyEnCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIGlmICEkREJPYmplY3QtPlByZXBhcmUoCiAgICAgICAgU1FMICAgPT4gJFNRTCwKICAgICAgICBMaW1pdCA9PiAkUGFyYW17TGltaXR9LAogICAgKTsKCiAgICBteSBASURzOwogICAgd2hpbGUgKCBteSBAUm93ID0gJERCT2JqZWN0LT5GZXRjaHJvd0FycmF5KCkgKSB7CiAgICAgICAgcHVzaCBASURzLCAkUm93WzBdOwogICAgfQoKICAgICMgSGFuZGxlIHRoZSBkaWZmcmVudCByZXN1bHQgdHlwZXMuCiAgICBpZiAoICRSZXN1bHQgZXEgJ0NPVU5UJyApIHsKCiAgICAgICAgaWYgKCAkU2VsZi0+e0NhY2hlT2JqZWN0fSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNhY2hlJyktPlNldCgKICAgICAgICAgICAgICAgIFR5cGUgID0+ICRTZWxmLT57Q2FjaGVUeXBlfSAuICdfQ3VzdG9tZXJDb21wYW55U2VhcmNoRGV0YWlsJywKICAgICAgICAgICAgICAgIEtleSAgID0+ICRTUUwgLiAkUGFyYW17TGltaXR9LAogICAgICAgICAgICAgICAgVmFsdWUgPT4gJElEc1swXSwKICAgICAgICAgICAgICAgIFRUTCAgID0+ICRTZWxmLT57Q2FjaGVUVEx9LAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRJRHNbMF07CiAgICB9CgogICAgZWxzZSB7CgogICAgICAgIGlmICggJFNlbGYtPntDYWNoZU9iamVjdH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDYWNoZScpLT5TZXQoCiAgICAgICAgICAgICAgICBUeXBlICA9PiAkU2VsZi0+e0NhY2hlVHlwZX0gLiAnX0N1c3RvbWVyQ29tcGFueVNlYXJjaERldGFpbCcsCiAgICAgICAgICAgICAgICBLZXkgICA9PiAkU1FMIC4gJFBhcmFte0xpbWl0fSwKICAgICAgICAgICAgICAgIFZhbHVlID0+IFxASURzLAogICAgICAgICAgICAgICAgVFRMICAgPT4gJFNlbGYtPntDYWNoZVRUTH0sCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gXEBJRHM7CiAgICB9Cn0KCnN1YiBDdXN0b21lckNvbXBhbnlHZXQgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIG5lZWRlZCBzdHVmZgogICAgaWYgKCAhJFBhcmFte0N1c3RvbWVySUR9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnTmVlZCBDdXN0b21lcklEIScKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIGNoZWNrIGNhY2hlCiAgICBpZiAoICRTZWxmLT57Q2FjaGVPYmplY3R9ICkgewogICAgICAgIG15ICREYXRhID0gJFNlbGYtPntDYWNoZU9iamVjdH0tPkdldCgKICAgICAgICAgICAgVHlwZSA9PiAkU2VsZi0+e0NhY2hlVHlwZX0sCiAgICAgICAgICAgIEtleSAgPT4gIkN1c3RvbWVyQ29tcGFueUdldDo6JFBhcmFte0N1c3RvbWVySUR9IiwKICAgICAgICApOwogICAgICAgIHJldHVybiAleyREYXRhfSBpZiByZWYgJERhdGEgZXEgJ0hBU0gnOwogICAgfQoKICAgICMgYnVpbGQgc2VsZWN0CiAgICBteSBARmllbGRzOwogICAgbXkgJUZpZWxkc01hcDsKCiAgICBFTlRSWToKICAgIGZvciBteSAkRW50cnkgKCBAeyAkU2VsZi0+e0N1c3RvbWVyQ29tcGFueU1hcH0tPntNYXB9IH0gKSB7CiAgICAgICAgbmV4dCBFTlRSWSBpZiAkRW50cnktPls1XSBlcSAnZHluYW1pY19maWVsZCc7CiAgICAgICAgcHVzaCBARmllbGRzLCAkRW50cnktPlsyXTsKICAgICAgICAkRmllbGRzTWFweyAkRW50cnktPlsyXSB9ID0gJEVudHJ5LT5bMF07CiAgICB9CiAgICBteSAkU1FMID0gJ1NFTEVDVCAnIC4gam9pbiggJywgJywgQEZpZWxkcyApOwoKICAgIGlmICggISRTZWxmLT57Rm9yZWlnbkRCfSApIHsKICAgICAgICAkU1FMIC49ICIsIGNyZWF0ZV90aW1lLCBjcmVhdGVfYnksIGNoYW5nZV90aW1lLCBjaGFuZ2VfYnkiOwogICAgfQoKICAgICMgdGhpcyBzZWVtcyB0byBiZSBsZWdhY3ksIGlmIE5hbWUgaXMgcGFzc2VkIGl0IHNob3VsZCB0YWtlIHByZWNlZGVuY2Ugb3ZlciBDdXN0b21lcklECiAgICBteSAkQ3VzdG9tZXJJRCA9ICRQYXJhbXtOYW1lfSB8fCAkUGFyYW17Q3VzdG9tZXJJRH07CgogICAgJFNRTCAuPSAiIEZST00gJFNlbGYtPntDdXN0b21lckNvbXBhbnlUYWJsZX0gV0hFUkUgIjsKCiAgICBpZiAoICRTZWxmLT57Q2FzZVNlbnNpdGl2ZX0gKSB7CiAgICAgICAgJFNRTCAuPSAiJFNlbGYtPntDdXN0b21lckNvbXBhbnlLZXl9ID0gPyI7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkU1FMIC49ICJMT1dFUigkU2VsZi0+e0N1c3RvbWVyQ29tcGFueUtleX0pID0gTE9XRVIoID8gKSI7CiAgICB9CgogICAgIyBnZXQgaW5pdGlhbCBkYXRhCiAgICByZXR1cm4gaWYgISRTZWxmLT57REJPYmplY3R9LT5QcmVwYXJlKAogICAgICAgIFNRTCAgPT4gJFNRTCwKICAgICAgICBCaW5kID0+IFsgXCRDdXN0b21lcklEIF0KICAgICk7CgogICAgIyBmZXRjaCB0aGUgcmVzdWx0CiAgICBteSAlRGF0YTsKICAgIFJPVzoKICAgIHdoaWxlICggbXkgQFJvdyA9ICRTZWxmLT57REJPYmplY3R9LT5GZXRjaHJvd0FycmF5KCkgKSB7CgogICAgICAgIG15ICRNYXBDb3VudGVyID0gMDsKCiAgICAgICAgZm9yIG15ICRGaWVsZCAoQEZpZWxkcykgewogICAgICAgICAgICAkRGF0YXsgJEZpZWxkc01hcHskRmllbGR9IH0gPSAkUm93WyRNYXBDb3VudGVyXTsKICAgICAgICAgICAgJE1hcENvdW50ZXIrKzsKICAgICAgICB9CgogICAgICAgIG5leHQgUk9XIGlmICRTZWxmLT57Rm9yZWlnbkRCfTsKCiAgICAgICAgZm9yIG15ICRLZXkgKHF3KENyZWF0ZVRpbWUgQ3JlYXRlQnkgQ2hhbmdlVGltZSBDaGFuZ2VCeSkpIHsKICAgICAgICAgICAgJERhdGF7JEtleX0gPSAkUm93WyRNYXBDb3VudGVyXTsKICAgICAgICAgICAgJE1hcENvdW50ZXIrKzsKICAgICAgICB9CiAgICB9CgogICAgIyBjYWNoZSByZXF1ZXN0CiAgICBpZiAoICRTZWxmLT57Q2FjaGVPYmplY3R9ICkgewogICAgICAgICRTZWxmLT57Q2FjaGVPYmplY3R9LT5TZXQoCiAgICAgICAgICAgIFR5cGUgID0+ICRTZWxmLT57Q2FjaGVUeXBlfSwKICAgICAgICAgICAgS2V5ICAgPT4gIkN1c3RvbWVyQ29tcGFueUdldDo6JFBhcmFte0N1c3RvbWVySUR9IiwKICAgICAgICAgICAgVmFsdWUgPT4gXCVEYXRhLAogICAgICAgICAgICBUVEwgICA9PiAkU2VsZi0+e0NhY2hlVFRMfSwKICAgICAgICApOwogICAgfQoKICAgICMgcmV0dXJuIGRhdGEKICAgIHJldHVybiAoJURhdGEpOwp9CgpzdWIgQ3VzdG9tZXJDb21wYW55QWRkIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayByby9ydwogICAgaWYgKCAkU2VsZi0+e1JlYWRPbmx5fSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ0N1c3RvbWVyQ29tcGFueSBiYWNrZW5kIGlzIHJlYWQgb25seSEnCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgbXkgQEZpZWxkczsKICAgIG15IEBQbGFjZWhvbGRlcnM7CiAgICBteSBAVmFsdWVzOwoKICAgIEVOVFJZOgogICAgZm9yIG15ICRFbnRyeSAoIEB7ICRTZWxmLT57Q3VzdG9tZXJDb21wYW55TWFwfS0+e01hcH0gfSApIHsKCiAgICAgICAgIyBpZ25vcmUgZHluYW1pYyBmaWVsZHMgaGVyZQogICAgICAgIG5leHQgRU5UUlkgaWYgJEVudHJ5LT5bNV0gZXEgJ2R5bmFtaWNfZmllbGQnOwoKICAgICAgICBwdXNoIEBGaWVsZHMsICAgICAgICRFbnRyeS0+WzJdOwogICAgICAgIHB1c2ggQFBsYWNlaG9sZGVycywgJz8nOwogICAgICAgIHB1c2ggQFZhbHVlcywgICAgICAgXCRQYXJhbXsgJEVudHJ5LT5bMF0gfTsKICAgIH0KICAgIGlmICggISRTZWxmLT57Rm9yZWlnbkRCfSApIHsKICAgICAgICBwdXNoIEBGaWVsZHMsICAgICAgIHF3KGNyZWF0ZV90aW1lIGNyZWF0ZV9ieSBjaGFuZ2VfdGltZSBjaGFuZ2VfYnkpOwogICAgICAgIHB1c2ggQFBsYWNlaG9sZGVycywgcXcoY3VycmVudF90aW1lc3RhbXAgPyBjdXJyZW50X3RpbWVzdGFtcCA/KTsKICAgICAgICBwdXNoIEBWYWx1ZXMsICggXCRQYXJhbXtVc2VySUR9LCBcJFBhcmFte1VzZXJJRH0gKTsKICAgIH0KCiAgICAjIGJ1aWxkIGluc2VydAogICAgbXkgJFNRTCA9ICJJTlNFUlQgSU5UTyAkU2VsZi0+e0N1c3RvbWVyQ29tcGFueVRhYmxlfSAoIjsKICAgICRTUUwgLj0gam9pbiggJywgJywgQEZpZWxkcyApIC4gIiApIFZBTFVFUyAoICIgLiBqb2luKCAnLCAnLCBAUGxhY2Vob2xkZXJzICkgLiAiICkiOwoKICAgIHJldHVybiBpZiAhJFNlbGYtPntEQk9iamVjdH0tPkRvKAogICAgICAgIFNRTCAgPT4gJFNRTCwKICAgICAgICBCaW5kID0+IFxAVmFsdWVzLAogICAgKTsKCiAgICAjIGxvZyBub3RpY2UKICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgIFByaW9yaXR5ID0+ICdpbmZvJywKICAgICAgICBNZXNzYWdlID0+CiAgICAgICAgICAgICJDdXN0b21lckNvbXBhbnk6ICckUGFyYW17Q3VzdG9tZXJDb21wYW55TmFtZX0vJFBhcmFte0N1c3RvbWVySUR9JyBjcmVhdGVkIHN1Y2Nlc3NmdWxseSAoJFBhcmFte1VzZXJJRH0pISIsCiAgICApOwoKICAgICRTZWxmLT5fQ3VzdG9tZXJDb21wYW55Q2FjaGVDbGVhciggQ3VzdG9tZXJJRCA9PiAkUGFyYW17Q3VzdG9tZXJJRH0gKTsKCiAgICByZXR1cm4gJFBhcmFte0N1c3RvbWVySUR9Owp9CgpzdWIgQ3VzdG9tZXJDb21wYW55VXBkYXRlIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayByby9ydwogICAgaWYgKCAkU2VsZi0+e1JlYWRPbmx5fSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ0N1c3RvbWVyIGJhY2tlbmQgaXMgcmVhZCBvbmx5IScKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIGNoZWNrIG5lZWRlZCBzdHVmZgogICAgZm9yIG15ICRFbnRyeSAoIEB7ICRTZWxmLT57Q3VzdG9tZXJDb21wYW55TWFwfS0+e01hcH0gfSApIHsKICAgICAgICBpZiAoCiAgICAgICAgICAgICEkUGFyYW17ICRFbnRyeS0+WzBdIH0KICAgICAgICAgICAgJiYgJEVudHJ5LT5bNV0gbmUgJ2R5bmFtaWNfZmllbGQnICAgICMgaWdub3JlIGR5bmFtaWMgZmllbGRzIGhlcmUKICAgICAgICAgICAgJiYgJEVudHJ5LT5bNF0KICAgICAgICAgICAgJiYgJEVudHJ5LT5bMF0gbmUgJ1VzZXJQYXNzd29yZCcKICAgICAgICAgICAgKQogICAgICAgIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIk5lZWQgJEVudHJ5LT5bMF0hIgogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgIG15IEBGaWVsZHM7CiAgICBteSBAVmFsdWVzOwoKICAgIEZJRUxEOgogICAgZm9yIG15ICRFbnRyeSAoIEB7ICRTZWxmLT57Q3VzdG9tZXJDb21wYW55TWFwfS0+e01hcH0gfSApIHsKICAgICAgICBuZXh0IEZJRUxEIGlmICRFbnRyeS0+WzBdID1+IC9eVXNlclBhc3N3b3JkJC9pOwogICAgICAgIG5leHQgRklFTEQgaWYgJEVudHJ5LT5bNV0gZXEgJ2R5bmFtaWNfZmllbGQnOyAgICAgIyBza2lwIGR5bmFtaWMgZmllbGRzCiAgICAgICAgcHVzaCBARmllbGRzLCAkRW50cnktPlsyXSAuICcgPSA/JzsKICAgICAgICBwdXNoIEBWYWx1ZXMsIFwkUGFyYW17ICRFbnRyeS0+WzBdIH07CiAgICB9CiAgICBpZiAoICEkU2VsZi0+e0ZvcmVpZ25EQn0gKSB7CiAgICAgICAgcHVzaCBARmllbGRzLCAoICdjaGFuZ2VfdGltZSA9IGN1cnJlbnRfdGltZXN0YW1wJywgJ2NoYW5nZV9ieSA9ID8nICk7CiAgICAgICAgcHVzaCBAVmFsdWVzLCBcJFBhcmFte1VzZXJJRH07CiAgICB9CgogICAgIyBjcmVhdGUgU1FMIHN0YXRlbWVudAogICAgbXkgJFNRTCA9ICJVUERBVEUgJFNlbGYtPntDdXN0b21lckNvbXBhbnlUYWJsZX0gU0VUICI7CiAgICAkU1FMIC49IGpvaW4oICcsICcsIEBGaWVsZHMgKTsKCiAgICBpZiAoICRTZWxmLT57Q2FzZVNlbnNpdGl2ZX0gKSB7CiAgICAgICAgJFNRTCAuPSAiIFdIRVJFICRTZWxmLT57Q3VzdG9tZXJDb21wYW55S2V5fSA9ID8iOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgJFNRTCAuPSAiIFdIRVJFIExPV0VSKCRTZWxmLT57Q3VzdG9tZXJDb21wYW55S2V5fSkgPSBMT1dFUiggPyApIjsKICAgIH0KICAgIHB1c2ggQFZhbHVlcywgXCRQYXJhbXtDdXN0b21lckNvbXBhbnlJRH07CgogICAgcmV0dXJuIGlmICEkU2VsZi0+e0RCT2JqZWN0fS0+RG8oCiAgICAgICAgU1FMICA9PiAkU1FMLAogICAgICAgIEJpbmQgPT4gXEBWYWx1ZXMsCiAgICApOwoKICAgICMgbG9nIG5vdGljZQogICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgUHJpb3JpdHkgPT4gJ2luZm8nLAogICAgICAgIE1lc3NhZ2UgPT4KICAgICAgICAgICAgIkN1c3RvbWVyQ29tcGFueTogJyRQYXJhbXtDdXN0b21lckNvbXBhbnlOYW1lfS8kUGFyYW17Q3VzdG9tZXJJRH0nIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5ICgkUGFyYW17VXNlcklEfSkhIiwKICAgICk7CgogICAgJFNlbGYtPl9DdXN0b21lckNvbXBhbnlDYWNoZUNsZWFyKCBDdXN0b21lcklEID0+ICRQYXJhbXtDdXN0b21lcklEfSApOwogICAgaWYgKCAkUGFyYW17Q3VzdG9tZXJDb21wYW55SUR9IG5lICRQYXJhbXtDdXN0b21lcklEfSApIHsKICAgICAgICAkU2VsZi0+X0N1c3RvbWVyQ29tcGFueUNhY2hlQ2xlYXIoIEN1c3RvbWVySUQgPT4gJFBhcmFte0N1c3RvbWVyQ29tcGFueUlEfSApOwogICAgfQoKICAgIHJldHVybiAxOwp9CgpzdWIgX0N1c3RvbWVyQ29tcGFueUNhY2hlQ2xlYXIgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICByZXR1cm4gaWYgISRTZWxmLT57Q2FjaGVPYmplY3R9OwoKICAgIGlmICggISRQYXJhbXtDdXN0b21lcklEfSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ05lZWQgQ3VzdG9tZXJJRCEnCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgJFNlbGYtPntDYWNoZU9iamVjdH0tPkRlbGV0ZSgKICAgICAgICBUeXBlID0+ICRTZWxmLT57Q2FjaGVUeXBlfSwKICAgICAgICBLZXkgID0+ICJDdXN0b21lckNvbXBhbnlHZXQ6OiRQYXJhbXtDdXN0b21lcklEfSIsCiAgICApOwoKICAgICMgZGVsZXRlIGFsbCBzZWFyY2ggY2FjaGUgZW50cmllcwogICAgJFNlbGYtPntDYWNoZU9iamVjdH0tPkNsZWFuVXAoCiAgICAgICAgVHlwZSA9PiAkU2VsZi0+e0NhY2hlVHlwZX0gLiAnX0N1c3RvbWVyQ29tcGFueUxpc3QnLAogICAgKTsKCiAgICBmb3IgbXkgJEZ1bmN0aW9uIChxdyhDdXN0b21lckNvbXBhbnlMaXN0KSkgewogICAgICAgIGZvciBteSAkVmFsaWQgKCAwIC4uIDEgKSB7CiAgICAgICAgICAgICRTZWxmLT57Q2FjaGVPYmplY3R9LT5EZWxldGUoCiAgICAgICAgICAgICAgICBUeXBlID0+ICRTZWxmLT57Q2FjaGVUeXBlfSwKICAgICAgICAgICAgICAgIEtleSAgPT4gIiR7RnVuY3Rpb259Ojoke1ZhbGlkfSIsCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiAxOwp9CgpzdWIgREVTVFJPWSB7CiAgICBteSAkU2VsZiA9IHNoaWZ0OwoKICAgICMgZGlzY29ubmVjdCBpZiBpdCdzIG5vdCBhIHBhcmVudCBEQk9iamVjdAogICAgaWYgKCAkU2VsZi0+e05vdFBhcmVudERCT2JqZWN0fSApIHsKICAgICAgICBpZiAoICRTZWxmLT57REJPYmplY3R9ICkgewogICAgICAgICAgICAkU2VsZi0+e0RCT2JqZWN0fS0+RGlzY29ubmVjdCgpOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gMTsKfQoKMTsK</File>
        <File Location="Custom/Kernel/System/CustomerCompany/Event/CustomerUserUpdate.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxLTIwMjIgWm51bnkgR21iSCwgaHR0cHM6Ly96bnVueS5vcmcvCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6U3lzdGVtOjpDdXN0b21lckNvbXBhbnk6OkV2ZW50OjpDdXN0b21lclVzZXJVcGRhdGU7Cgp1c2Ugc3RyaWN0Owp1c2Ugd2FybmluZ3M7CgpvdXIgQE9iamVjdERlcGVuZGVuY2llcyA9ICgKICAgICdLZXJuZWw6OlN5c3RlbTo6Q3VzdG9tZXJVc2VyJywKICAgICdLZXJuZWw6OlN5c3RlbTo6TG9nJywKKTsKCnN1YiBuZXcgewogICAgbXkgKCAkVHlwZSwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGFsbG9jYXRlIG5ldyBoYXNoIGZvciBvYmplY3QKICAgIG15ICRTZWxmID0ge307CiAgICBibGVzcyggJFNlbGYsICRUeXBlICk7CgogICAgcmV0dXJuICRTZWxmOwp9CgpzdWIgUnVuIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIGZvciBteSAkTmVlZGVkIChxdyggRGF0YSBFdmVudCBDb25maWcgVXNlcklEICkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICROZWVkZWQhIgogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQogICAgZm9yIG15ICROZWVkZWQgKHF3KCBDdXN0b21lcklEIE9sZEN1c3RvbWVySUQgKSkgewogICAgICAgIGlmICggISRQYXJhbXtEYXRhfS0+eyROZWVkZWR9ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCAkTmVlZGVkIGluIERhdGEhIgogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiAxIGlmICRQYXJhbXtEYXRhfS0+e0N1c3RvbWVySUR9IGVxICRQYXJhbXtEYXRhfS0+e09sZEN1c3RvbWVySUR9OwoKICAgICMgZ2V0IGN1c3RvbWVyIHVzZXIgb2JqZWN0CiAgICBteSAkQ3VzdG9tZXJVc2VyT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyVXNlcicpOwoKICAgIG15ICVDdXN0b21lclVzZXJzID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJTZWFyY2goCiAgICAgICAgQ3VzdG9tZXJJRFJhdyA9PiAkUGFyYW17RGF0YX0tPntPbGRDdXN0b21lcklEfSwKICAgICAgICBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgIFZhbGlkICAgICAgICAgPT4gMCwKICAgICk7CgogICAgZm9yIG15ICRDdXN0b21lclVzZXJMb2dpbiAoIHNvcnQga2V5cyAlQ3VzdG9tZXJVc2VycyApIHsKICAgICAgICBteSAlQ3VzdG9tZXJEYXRhID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJVc2VyRGF0YUdldCgKICAgICAgICAgICAgVXNlciA9PiAkQ3VzdG9tZXJVc2VyTG9naW4sCiAgICAgICAgKTsKCiAgICAgICAgIyB3ZSBkbyBub3QgbmVlZCB0byAnY2hhbmdlJyB0aGUgcGFzc3dvcmQgKHRoaXMgd291bGQgcmUtaGFzaCBpdCEpCiAgICAgICAgZGVsZXRlICRDdXN0b21lckRhdGF7VXNlclBhc3N3b3JkfTsKICAgICAgICAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJVcGRhdGUoCiAgICAgICAgICAgICVDdXN0b21lckRhdGEsCiAgICAgICAgICAgIElEICAgICAgICAgICAgID0+ICRDdXN0b21lclVzZXJMb2dpbiwKICAgICAgICAgICAgVXNlckN1c3RvbWVySUQgPT4gJFBhcmFte0RhdGF9LT57Q3VzdG9tZXJJRH0sCiAgICAgICAgICAgIFVzZXJJRCAgICAgICAgID0+ICRQYXJhbXtVc2VySUR9LAogICAgICAgICk7CiAgICB9CgogICAgcmV0dXJuIDE7Cn0KCjE7Cg==</File>
        <File Location="Custom/Kernel/System/CustomerGroup.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxLTIwMjIgWm51bnkgR21iSCwgaHR0cHM6Ly96bnVueS5vcmcvCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6U3lzdGVtOjpDdXN0b21lckdyb3VwOwoKdXNlIHN0cmljdDsKdXNlIHdhcm5pbmdzOwoKdXNlIEtlcm5lbDo6U3lzdGVtOjpWYXJpYWJsZUNoZWNrIHF3KDphbGwpOwoKb3VyIEBPYmplY3REZXBlbmRlbmNpZXMgPSAoCiAgICAnS2VybmVsOjpDb25maWcnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpDYWNoZScsCiAgICAnS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyQ29tcGFueScsCiAgICAnS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyVXNlcicsCiAgICAnS2VybmVsOjpTeXN0ZW06OkRCJywKICAgICdLZXJuZWw6OlN5c3RlbTo6R3JvdXAnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpMb2cnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpWYWxpZCcsCik7Cgo9aGVhZDEgTkFNRQoKS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyR3JvdXAgLSBjdXN0b21lciBncm91cCBsaWIKCj1oZWFkMSBERVNDUklQVElPTgoKQWxsIGN1c3RvbWVyIGdyb3VwIGZ1bmN0aW9ucy4gRS4gZy4gdG8gYWRkIGdyb3VwcyBvciB0byBnZXQgYSBtZW1iZXIgbGlzdCBvZiBhIGdyb3VwLgoKPWhlYWQxIFBVQkxJQyBJTlRFUkZBQ0UKCj1oZWFkMiBuZXcoKQoKRG9uJ3QgdXNlIHRoZSBjb25zdHJ1Y3RvciBkaXJlY3RseSwgdXNlIHRoZSBPYmplY3RNYW5hZ2VyIGluc3RlYWQ6CgogICAgbXkgJEN1c3RvbWVyR3JvdXBPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q3VzdG9tZXJHcm91cCcpOwoKPWN1dAoKc3ViIG5ldyB7CiAgICBteSAoICRUeXBlLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgYWxsb2NhdGUgbmV3IGhhc2ggZm9yIG9iamVjdAogICAgbXkgJFNlbGYgPSB7fTsKICAgIGJsZXNzKCAkU2VsZiwgJFR5cGUgKTsKCiAgICAkU2VsZi0+e0NhY2hlVHlwZX0gPSAnQ3VzdG9tZXJHcm91cCc7CiAgICAkU2VsZi0+e0NhY2hlVFRMfSAgPSA2MCAqIDYwICogMjQgKiAyMDsKCiAgICByZXR1cm4gJFNlbGY7Cn0KCj1oZWFkMiBHcm91cE1lbWJlckFkZCgpCgp0byBhZGQgYSBtZW1iZXIgdG8gYSBncm91cAoKICAgIFBlcm1pc3Npb246IHJvLG1vdmVfaW50byxwcmlvcml0eSxjcmVhdGUscncKCiAgICBteSAkU3VjY2VzcyA9ICRDdXN0b21lckdyb3VwT2JqZWN0LT5Hcm91cE1lbWJlckFkZCgKICAgICAgICBHSUQgPT4gMTIsCiAgICAgICAgVUlEID0+IDYsCiAgICAgICAgUGVybWlzc2lvbiA9PiB7CiAgICAgICAgICAgIHJvICAgICAgICA9PiAxLAogICAgICAgICAgICBtb3ZlX2ludG8gPT4gMSwKICAgICAgICAgICAgY3JlYXRlICAgID0+IDEsCiAgICAgICAgICAgIG93bmVyICAgICA9PiAxLAogICAgICAgICAgICBwcmlvcml0eSAgPT4gMCwKICAgICAgICAgICAgcncgICAgICAgID0+IDAsCiAgICAgICAgfSwKICAgICAgICBVc2VySUQgPT4gMTIzLAogICAgKTsKCj1jdXQKCnN1YiBHcm91cE1lbWJlckFkZCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBmb3IgbXkgJE5lZWRlZCAocXcoVUlEIEdJRCBVc2VySUQgUGVybWlzc2lvbikpIHsKICAgICAgICBpZiAoICEkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICROZWVkZWQhIiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICAjIGNoZWNrIHJ3IHJ1bGUgKHNldCBvbmx5IHJ3IGFuZCByZW1vdmUgcmVzdCwgYmVjYXVzZSBpdCdzIGluY2x1ZGluZyBhbGwgaW4gcncpCiAgICBpZiAoICRQYXJhbXtQZXJtaXNzaW9ufS0+e3J3fSApIHsKICAgICAgICAkUGFyYW17UGVybWlzc2lvbn0gPSB7IHJ3ID0+IDEgfTsKICAgIH0KCiAgICAjIGdldCBkYXRhYmFzZSBvYmplY3QKICAgIG15ICREQk9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEQicpOwoKICAgICMgdXBkYXRlIHBlcm1pc3Npb24KICAgIFRZUEU6CiAgICBmb3IgbXkgJFR5cGUgKCBzb3J0IGtleXMgJXsgJFBhcmFte1Blcm1pc3Npb259IH0gKSB7CgogICAgICAgICMgZGVsZXRlIGV4aXN0aW5nIHBlcm1pc3Npb24KICAgICAgICAkREJPYmplY3QtPkRvKAogICAgICAgICAgICBTUUwgPT4gJ0RFTEVURSBGUk9NIGdyb3VwX2N1c3RvbWVyX3VzZXIgV0hFUkUgJwogICAgICAgICAgICAgICAgLiAnIGdyb3VwX2lkID0gPyBBTkQgdXNlcl9pZCA9ID8gQU5EIHBlcm1pc3Npb25fa2V5ID0gPycsCiAgICAgICAgICAgIEJpbmQgPT4gWyBcJFBhcmFte0dJRH0sIFwkUGFyYW17VUlEfSwgXCRUeXBlIF0sCiAgICAgICAgKTsKCiAgICAgICAgIyBkZWJ1ZwogICAgICAgIGlmICggJFNlbGYtPntEZWJ1Z30gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ25vdGljZScsCiAgICAgICAgICAgICAgICBNZXNzYWdlID0+CiAgICAgICAgICAgICAgICAgICAgIkFkZCBVSUQ6JFBhcmFte1VJRH0gdG8gR0lEOiRQYXJhbXtHSUR9LCAkVHlwZTokUGFyYW17UGVybWlzc2lvbn0tPnskVHlwZX0hIiwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgICMgaW5zZXJ0IG5ldyBwZXJtaXNzaW9uIChpZiBuZWVkZWQpCiAgICAgICAgbmV4dCBUWVBFIGlmICEkUGFyYW17UGVybWlzc2lvbn0tPnskVHlwZX07CgogICAgICAgICREQk9iamVjdC0+RG8oCiAgICAgICAgICAgIFNRTCA9PiAnSU5TRVJUIElOVE8gZ3JvdXBfY3VzdG9tZXJfdXNlciAnCiAgICAgICAgICAgICAgICAuICcodXNlcl9pZCwgZ3JvdXBfaWQsIHBlcm1pc3Npb25fa2V5LCBwZXJtaXNzaW9uX3ZhbHVlLCAnCiAgICAgICAgICAgICAgICAuICdjcmVhdGVfdGltZSwgY3JlYXRlX2J5LCBjaGFuZ2VfdGltZSwgY2hhbmdlX2J5KSAnCiAgICAgICAgICAgICAgICAuICdWQUxVRVMgKD8sID8sID8sID8sIGN1cnJlbnRfdGltZXN0YW1wLCA/LCBjdXJyZW50X3RpbWVzdGFtcCwgPyknLAogICAgICAgICAgICBCaW5kID0+IFsKICAgICAgICAgICAgICAgIFwkUGFyYW17VUlEfSwgXCRQYXJhbXtHSUR9LCBcJFR5cGUsIFwkUGFyYW17UGVybWlzc2lvbn0tPnskVHlwZX0sIFwkUGFyYW17VXNlcklEfSwKICAgICAgICAgICAgICAgIFwkUGFyYW17VXNlcklEfSwKICAgICAgICAgICAgXSwKICAgICAgICApOwogICAgfQoKICAgICMgZGVsZXRlIGNhY2hlCiAgICAjIHJlbW92ZSBjb21wbGV0ZSBDdXN0b21lckdyb3VwIGNhY2hlIGJlY2F1c2UKICAgICMgICBHcm91cE1lbWJlckxpc3QoKSBjYWNoZSBpcyBDdXN0b21lclVzZXJJRCBiYXNlZAogICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNhY2hlJyktPkNsZWFuVXAoCiAgICAgICAgVHlwZSA9PiAkU2VsZi0+e0NhY2hlVHlwZX0sCiAgICApOwoKICAgIHJldHVybiAxOwp9Cgo9aGVhZDIgR3JvdXBNZW1iZXJMaXN0KCkKCkdldCB1c2VycyBvZiB0aGUgZ2l2ZW4gZ3JvdXAuCgogICAgbXkgJVVzZXJzID0gJEN1c3RvbWVyR3JvdXBPYmplY3QtPkdyb3VwTWVtYmVyTGlzdCgKICAgICAgICBHcm91cElEICAgICAgICA9PiAnMTIzJywKICAgICAgICBUeXBlICAgICAgICAgICA9PiAnbW92ZV9pbnRvJywgIyByb3xtb3ZlX2ludG98cHJpb3JpdHl8Y3JlYXRlfHJ3CiAgICAgICAgUmVzdWx0ICAgICAgICAgPT4gJ0hBU0gnLCAgICAgICMgcmV0dXJuIGhhc2ggb2YgdXNlciBpZCA9PiB1c2VyIG5hbWUgZW50cmllcwogICAgICAgIFJhd1Blcm1pc3Npb25zID0+IDAsICAgICAgICAgICAjIDAgKHJldHVybiBpbmhlcml0ZWQgcGVybWlzc2lvbnMgZnJvbSBDdXN0b21lckNvbXBhbnkpLCBkZWZhdWx0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgMSAocmV0dXJuIG9ubHkgZGlyZWN0IHBlcm1pc3Npb25zKQogICAgKTsKCm9yCgogICAgbXkgQFVzZXJJRHMgPSAkQ3VzdG9tZXJHcm91cE9iamVjdC0+R3JvdXBNZW1iZXJMaXN0KAogICAgICAgIEdyb3VwSUQgICAgICAgID0+ICcxMjMnLAogICAgICAgIFR5cGUgICAgICAgICAgID0+ICdtb3ZlX2ludG8nLCAjIHJvfG1vdmVfaW50b3xwcmlvcml0eXxjcmVhdGV8cncKICAgICAgICBSZXN1bHQgICAgICAgICA9PiAnSUQnLCAgICAgICAgIyByZXR1cm4gYXJyYXkgb2YgdXNlciBpZHMKICAgICAgICBSYXdQZXJtaXNzaW9ucyA9PiAwLCAgICAgICAgICAgIyAwIChyZXR1cm4gaW5oZXJpdGVkIHBlcm1pc3Npb25zIGZyb20gQ3VzdG9tZXJDb21wYW55KSwgZGVmYXVsdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIDEgKHJldHVybiBvbmx5IGRpcmVjdCBwZXJtaXNzaW9ucykKICAgICk7CgpvcgoKICAgIG15IEBVc2VyTmFtZXMgPSAkQ3VzdG9tZXJHcm91cE9iamVjdC0+R3JvdXBNZW1iZXJMaXN0KAogICAgICAgIEdyb3VwSUQgICAgICAgID0+ICcxMjMnLAogICAgICAgIFR5cGUgICAgICAgICAgID0+ICdtb3ZlX2ludG8nLCAjIHJvfG1vdmVfaW50b3xwcmlvcml0eXxjcmVhdGV8cncKICAgICAgICBSZXN1bHQgICAgICAgICA9PiAnTmFtZScsICAgICAgICAjIHJldHVybiBhcnJheSBvZiB1c2VyIG5hbWVzCiAgICAgICAgUmF3UGVybWlzc2lvbnMgPT4gMCwgICAgICAgICAgICMgMCAocmV0dXJuIGluaGVyaXRlZCBwZXJtaXNzaW9ucyBmcm9tIEN1c3RvbWVyQ29tcGFueSksIGRlZmF1bHQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyAxIChyZXR1cm4gb25seSBkaXJlY3QgcGVybWlzc2lvbnMpCiAgICApOwoKR2V0IGdyb3VwcyBvZiBnaXZlbiB1c2VyLgoKICAgIG15ICVHcm91cHMgPSAkQ3VzdG9tZXJHcm91cE9iamVjdC0+R3JvdXBNZW1iZXJMaXN0KAogICAgICAgIFVzZXJJRCAgICAgICAgID0+ICcxMjMnLAogICAgICAgIFR5cGUgICAgICAgICAgID0+ICdtb3ZlX2ludG8nLCAjIHJvfG1vdmVfaW50b3xwcmlvcml0eXxjcmVhdGV8cncKICAgICAgICBSZXN1bHQgICAgICAgICA9PiAnSEFTSCcsICAgICAgIyByZXR1cm4gaGFzaCBvZiBncm91cCBpZCA9PiBncm91cCBuYW1lIGVudHJpZXMKICAgICAgICBSYXdQZXJtaXNzaW9ucyA9PiAwLCAgICAgICAgICAgIyAwIChyZXR1cm4gaW5oZXJpdGVkIHBlcm1pc3Npb25zIGZyb20gQ3VzdG9tZXJDb21wYW55KSwgZGVmYXVsdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIDEgKHJldHVybiBvbmx5IGRpcmVjdCBwZXJtaXNzaW9ucykKICAgICk7CgpvcgoKICAgIG15IEBHcm91cElEcyA9ICRDdXN0b21lckdyb3VwT2JqZWN0LT5Hcm91cE1lbWJlckxpc3QoCiAgICAgICAgVXNlcklEICAgICAgICAgPT4gJzEyMycsCiAgICAgICAgVHlwZSAgICAgICAgICAgPT4gJ21vdmVfaW50bycsICMgcm98bW92ZV9pbnRvfHByaW9yaXR5fGNyZWF0ZXxydwogICAgICAgIFJlc3VsdCAgICAgICAgID0+ICdJRCcsICAgICAgICAjIHJldHVybiBhcnJheSBvZiBncm91cCBpZHMKICAgICAgICBSYXdQZXJtaXNzaW9ucyA9PiAwLCAgICAgICAgICAgIyAwIChyZXR1cm4gaW5oZXJpdGVkIHBlcm1pc3Npb25zIGZyb20gQ3VzdG9tZXJDb21wYW55KSwgZGVmYXVsdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIDEgKHJldHVybiBvbmx5IGRpcmVjdCBwZXJtaXNzaW9ucykKICAgICk7CgpvcgoKICAgIG15IEBHcm91cE5hbWVzID0gJEN1c3RvbWVyR3JvdXBPYmplY3QtPkdyb3VwTWVtYmVyTGlzdCgKICAgICAgICBVc2VySUQgICAgICAgICA9PiAnMTIzJywKICAgICAgICBUeXBlICAgICAgICAgICA9PiAnbW92ZV9pbnRvJywgIyByb3xtb3ZlX2ludG98cHJpb3JpdHl8Y3JlYXRlfHJ3CiAgICAgICAgUmVzdWx0ICAgICAgICAgPT4gJ05hbWUnLCAgICAgICAgIyByZXR1cm4gYXJyYXkgb2YgZ3JvdXAgbmFtZXMKICAgICAgICBSYXdQZXJtaXNzaW9ucyA9PiAwLCAgICAgICAgICAgIyAwIChyZXR1cm4gaW5oZXJpdGVkIHBlcm1pc3Npb25zIGZyb20gQ3VzdG9tZXJDb21wYW55KSwgZGVmYXVsdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIDEgKHJldHVybiBvbmx5IGRpcmVjdCBwZXJtaXNzaW9ucykKICAgICk7Cgo9Y3V0CgpzdWIgR3JvdXBNZW1iZXJMaXN0IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIGZvciBteSAkTmVlZGVkIChxdyhSZXN1bHQgVHlwZSkpIHsKICAgICAgICBpZiAoICEkUGFyYW17JE5lZWRlZH0gKSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJOZWVkICROZWVkZWQhIiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KICAgIGlmICggISRQYXJhbXtVc2VySUR9ICYmICEkUGFyYW17R3JvdXBJRH0gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdOZWVkIFVzZXJJRCBvciBHcm91cElEIScKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIGNyZWF0ZSBjYWNoZSBrZXkKICAgIG15ICRDYWNoZUtleSA9ICdHcm91cE1lbWJlckxpc3Q6OicgLiAkUGFyYW17VHlwZX0gLiAnOjonOwogICAgaWYgKCAkUGFyYW17UmF3UGVybWlzc2lvbnN9ICkgewogICAgICAgICRDYWNoZUtleSAuPSAiUmF3OjoiOwogICAgfQogICAgaWYgKCAkUGFyYW17VXNlcklEfSApIHsKICAgICAgICAkQ2FjaGVLZXkgLj0gIlVzZXJJRDo6JFBhcmFte1VzZXJJRH0iOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgJENhY2hlS2V5IC49ICJHcm91cElEOjokUGFyYW17R3JvdXBJRH0iOwogICAgfQoKICAgICMgY2hlY2sgY2FjaGUKICAgIG15ICRDYWNoZSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDYWNoZScpLT5HZXQoCiAgICAgICAgVHlwZSA9PiAkU2VsZi0+e0NhY2hlVHlwZX0sCiAgICAgICAgS2V5ICA9PiAkQ2FjaGVLZXksCiAgICApOwoKICAgIGlmICgkQ2FjaGUpIHsKICAgICAgICBpZiAoICRQYXJhbXtSZXN1bHR9IGVxICdIQVNIJyApIHsKICAgICAgICAgICAgcmV0dXJuICV7JENhY2hlfTsKICAgICAgICB9CiAgICAgICAgZWxzaWYgKCAkUGFyYW17UmVzdWx0fSBlcSAnSUQnICkgewogICAgICAgICAgICByZXR1cm4gKCBzb3J0IGtleXMgJXskQ2FjaGV9ICk7CiAgICAgICAgfQogICAgICAgIGVsc2lmICggJFBhcmFte1Jlc3VsdH0gZXEgJ05hbWUnICkgewogICAgICAgICAgICByZXR1cm4gKCBzb3J0IHZhbHVlcyAleyRDYWNoZX0gKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIG15ICVEYXRhOwoKICAgICMgY2hlY2sgaWYgY3VzdG9tZXIgZ3JvdXAgZmVhdHVyZSBpcyBhY3RpdmUsIGlmIG5vdCwgcmV0dXJuIGFsbCBncm91cHMKICAgIGlmICggISRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnQ3VzdG9tZXJHcm91cFN1cHBvcnQnKSApIHsKCiAgICAgICAgIyBnZXQgcGVybWlzc2lvbnMKICAgICAgICAlRGF0YSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpHcm91cCcpLT5Hcm91cExpc3QoIFZhbGlkID0+IDEgKTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIG15ICREQk9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEQicpOwoKICAgICAgICAjIGlmIGl0J3MgYWN0aXZlLCByZXR1cm4ganVzdCB0aGUgcGVybWl0dGVkIGdyb3VwcwogICAgICAgIG15ICRTUUwgPQogICAgICAgICAgICAnU0VMRUNUIGcuaWQsIGcubmFtZSwgZ3UucGVybWlzc2lvbl9rZXksIGd1LnBlcm1pc3Npb25fdmFsdWUsIGd1LnVzZXJfaWQnCiAgICAgICAgICAgIC4gJyBGUk9NIHBlcm1pc3Npb25fZ3JvdXBzIGcsIGdyb3VwX2N1c3RvbWVyX3VzZXIgZ3UnCiAgICAgICAgICAgIC4gJyBXSEVSRSBnLnZhbGlkX2lkIElOICggJyAuIGpvaW4gJywgJywgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlZhbGlkJyktPlZhbGlkSURzR2V0KCkgLiAnKScKICAgICAgICAgICAgLiAnIEFORCBnLmlkID0gZ3UuZ3JvdXBfaWQgQU5EIGd1LnBlcm1pc3Npb25fdmFsdWUgPSAxJwogICAgICAgICAgICAuICIgQU5EIGd1LnBlcm1pc3Npb25fa2V5IElOICg/LCAncncnKSI7CiAgICAgICAgbXkgQEJpbmQgPSAoIFwkUGFyYW17VHlwZX0gKTsKCiAgICAgICAgaWYgKCAkUGFyYW17VXNlcklEfSApIHsKICAgICAgICAgICAgJFNRTCAuPSAnIEFORCBndS51c2VyX2lkID0gPyc7CiAgICAgICAgICAgIHB1c2ggQEJpbmQsIFwkUGFyYW17VXNlcklEfTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRTUUwgLj0gJyBBTkQgZ3UuZ3JvdXBfaWQgPSA/JzsKICAgICAgICAgICAgcHVzaCBAQmluZCwgXCRQYXJhbXtHcm91cElEfTsKICAgICAgICB9CgogICAgICAgICREQk9iamVjdC0+UHJlcGFyZSgKICAgICAgICAgICAgU1FMICA9PiAkU1FMLAogICAgICAgICAgICBCaW5kID0+IFxAQmluZCwKICAgICAgICApOwoKICAgICAgICB3aGlsZSAoIG15IEBSb3cgPSAkREJPYmplY3QtPkZldGNocm93QXJyYXkoKSApIHsKICAgICAgICAgICAgaWYgKCAkUGFyYW17VXNlcklEfSApIHsKICAgICAgICAgICAgICAgICREYXRheyAkUm93WzBdIH0gPSAkUm93WzFdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJERhdGF7ICRSb3dbNF0gfSA9ICRSb3dbMV07CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIG15ICRDdXN0b21lclVzZXJPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q3VzdG9tZXJVc2VyJyk7CgogICAgICAgIGZvciBteSAkS2V5ICggc29ydCBrZXlzICVEYXRhICkgewoKICAgICAgICAgICAgIyBCdWdmaXggIzEyMjg1IC0gQ2hlY2sgaWYgY3VzdG9tZXIgdXNlciBpcyB2YWxpZC4KICAgICAgICAgICAgaWYgKCAkUGFyYW17R3JvdXBJRH0gKSB7CgogICAgICAgICAgICAgICAgbXkgJVVzZXIgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJEYXRhR2V0KAogICAgICAgICAgICAgICAgICAgIFVzZXIgPT4gJEtleSwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgaWYgKCBkZWZpbmVkICRVc2Vye1ZhbGlkSUR9ICYmICRVc2Vye1ZhbGlkSUR9ICE9IDEgKSB7CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlICREYXRheyRLZXl9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIGFkZCBjdXN0b21lciBjb21wYW55IGdyb3VwcwogICAgICAgIGlmICggISRQYXJhbXtSYXdQZXJtaXNzaW9uc30gJiYgJFBhcmFte1VzZXJJRH0gKSB7CiAgICAgICAgICAgIG15IEBDdXN0b21lcklEcyA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDdXN0b21lclVzZXInKS0+Q3VzdG9tZXJJRHMoCiAgICAgICAgICAgICAgICBVc2VyID0+ICRQYXJhbXtVc2VySUR9LAogICAgICAgICAgICApOwoKICAgICAgICAgICAgZm9yIG15ICRDdXN0b21lcklEIChAQ3VzdG9tZXJJRHMpIHsKICAgICAgICAgICAgICAgIG15ICVDdXN0b21lckdyb3VwcyA9ICRTZWxmLT5Hcm91cEN1c3RvbWVyTGlzdCgKICAgICAgICAgICAgICAgICAgICBDdXN0b21lcklEID0+ICRDdXN0b21lcklELAogICAgICAgICAgICAgICAgICAgIFR5cGUgICAgICAgPT4gJFBhcmFte1R5cGV9LAogICAgICAgICAgICAgICAgICAgIFJlc3VsdCAgICAgPT4gJ0hBU0gnLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIEdST1VQSUQ6CiAgICAgICAgICAgICAgICBmb3IgbXkgJEdyb3VwSUQgKCBzb3J0IGtleXMgJUN1c3RvbWVyR3JvdXBzICkgewogICAgICAgICAgICAgICAgICAgIG5leHQgR1JPVVBJRCBpZiAkRGF0YXskR3JvdXBJRH07CiAgICAgICAgICAgICAgICAgICAgJERhdGF7JEdyb3VwSUR9ID0gJEN1c3RvbWVyR3JvdXBzeyRHcm91cElEfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNpZiAoICEkUGFyYW17UmF3UGVybWlzc2lvbnN9ICkgewogICAgICAgICAgICBteSAlQ3VzdG9tZXJHcm91cHMgPSAkU2VsZi0+R3JvdXBDdXN0b21lckxpc3QoCiAgICAgICAgICAgICAgICBHcm91cElEID0+ICRQYXJhbXtHcm91cElEfSwKICAgICAgICAgICAgICAgIFR5cGUgICAgPT4gJFBhcmFte1R5cGV9LAogICAgICAgICAgICAgICAgUmVzdWx0ICA9PiAnSEFTSCcsCiAgICAgICAgICAgICk7CgogICAgICAgICAgICBteSAkQ3VzdG9tZXJVc2VyT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyVXNlcicpOwogICAgICAgICAgICBmb3IgbXkgJEN1c3RvbWVySUQgKCBzb3J0IGtleXMgJUN1c3RvbWVyR3JvdXBzICkgewogICAgICAgICAgICAgICAgbXkgJUN1c3RvbWVyVXNlcnMgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclNlYXJjaCgKICAgICAgICAgICAgICAgICAgICBDdXN0b21lcklEUmF3ID0+ICRDdXN0b21lcklELAogICAgICAgICAgICAgICAgICAgIFVzZXJJRCAgICAgICAgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICAgICAgICAgIFZhbGlkICAgICAgICAgPT4gMSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBDVVNUT01FUlVTRVJJRDoKICAgICAgICAgICAgICAgIGZvciBteSAkQ3VzdG9tZXJVc2VySUQgKCBzb3J0IGtleXMgJUN1c3RvbWVyVXNlcnMgKSB7CiAgICAgICAgICAgICAgICAgICAgbmV4dCBDVVNUT01FUlVTRVJJRCBpZiAkRGF0YXskQ3VzdG9tZXJVc2VySUR9OwogICAgICAgICAgICAgICAgICAgICREYXRheyRDdXN0b21lclVzZXJJRH0gPSAkQ3VzdG9tZXJHcm91cHN7JEN1c3RvbWVySUR9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgICMgYWRkIGFsd2F5cyBncm91cHMgaWYgZ3JvdXBzIGFyZSByZXF1ZXN0ZWQKICAgIGlmICgKICAgICAgICAkUGFyYW17VXNlcklEfQogICAgICAgICYmICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnQ3VzdG9tZXJHcm91cEFsd2F5c0dyb3VwcycpCiAgICAgICAgKQogICAgewogICAgICAgIG15ICVHcm91cHMgICAgICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06Okdyb3VwJyktPkdyb3VwTGlzdCggVmFsaWQgPT4gMSApOwogICAgICAgIG15ICVHcm91cHNSZXZlcnNlID0gcmV2ZXJzZSAlR3JvdXBzOwogICAgICAgIEFMV0FZU0dST1VQOgogICAgICAgIGZvciBteSAkQWx3YXlzR3JvdXAgKCBAeyAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpLT5HZXQoJ0N1c3RvbWVyR3JvdXBBbHdheXNHcm91cHMnKSB9ICkgewogICAgICAgICAgICBuZXh0IEFMV0FZU0dST1VQIGlmICEkR3JvdXBzUmV2ZXJzZXskQWx3YXlzR3JvdXB9OwogICAgICAgICAgICBuZXh0IEFMV0FZU0dST1VQIGlmICREYXRheyAkR3JvdXBzUmV2ZXJzZXskQWx3YXlzR3JvdXB9IH07CiAgICAgICAgICAgICREYXRheyAkR3JvdXBzUmV2ZXJzZXskQWx3YXlzR3JvdXB9IH0gPSAkQWx3YXlzR3JvdXA7CiAgICAgICAgfQogICAgfQoKICAgICMgc2V0IGNhY2hlCiAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2FjaGUnKS0+U2V0KAogICAgICAgIFR5cGUgID0+ICRTZWxmLT57Q2FjaGVUeXBlfSwKICAgICAgICBUVEwgICA9PiAkU2VsZi0+e0NhY2hlVFRMfSwKICAgICAgICBLZXkgICA9PiAkQ2FjaGVLZXksCiAgICAgICAgVmFsdWUgPT4gXCVEYXRhLAogICAgKTsKCiAgICAjIHJldHVybiBkYXRhIGRlcGVuZGluZyBvbiByZXF1ZXN0ZWQgcmVzdWx0CiAgICBpZiAoICRQYXJhbXtSZXN1bHR9IGVxICdIQVNIJyApIHsKICAgICAgICByZXR1cm4gJURhdGE7CiAgICB9CiAgICBlbHNpZiAoICRQYXJhbXtSZXN1bHR9IGVxICdJRCcgKSB7CiAgICAgICAgcmV0dXJuICggc29ydCBrZXlzICVEYXRhICk7CiAgICB9CiAgICBlbHNpZiAoICRQYXJhbXtSZXN1bHR9IGVxICdOYW1lJyApIHsKICAgICAgICByZXR1cm4gKCBzb3J0IHZhbHVlcyAlRGF0YSApOwogICAgfQogICAgcmV0dXJuOwp9Cgo9aGVhZDIgR3JvdXBDdXN0b21lckFkZCgpCgp0byBhZGQgYSBjdXN0b21lciB0byBhIGdyb3VwCgogICAgUGVybWlzc2lvbiB0eXBlczogZS5nLiBybyxtb3ZlX2ludG8scHJpb3JpdHksY3JlYXRlLHJ3CiAgICBQZXJtaXNzaW9uIGNvbnRleHQ6IGUuZy4gVGlja2V0OjpDdXN0b21lcklEOjpTYW1lLCBUaWNrZXQ6OkN1c3RvbWVySUQ6Ok90aGVyCgogICAgbXkgJFN1Y2Nlc3MgPSAkQ3VzdG9tZXJHcm91cE9iamVjdC0+R3JvdXBDdXN0b21lckFkZCgKICAgICAgICBHSUQgICAgICAgID0+IDEyLAogICAgICAgIEN1c3RvbWVySUQgPT4gJ2N1c3RvbWVyLWNvbXBhbnknLAogICAgICAgIFBlcm1pc3Npb24gPT4gewogICAgICAgICAgICAnVGlja2V0OjpDdXN0b21lcklEOjpTYW1lJyA9PiB7CiAgICAgICAgICAgICAgICBybyAgICAgICAgICAgID0+IDEsCiAgICAgICAgICAgICAgICBtb3ZlX2ludG8gICAgID0+IDEsCiAgICAgICAgICAgICAgICBjcmVhdGUgICAgICAgID0+IDEsCiAgICAgICAgICAgICAgICBvd25lciAgICAgICAgID0+IDEsCiAgICAgICAgICAgICAgICBwcmlvcml0eSAgICAgID0+IDAsCiAgICAgICAgICAgICAgICBydyAgICAgICAgICAgID0+IDAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICdUaWNrZXQ6OkN1c3RvbWVySUQ6Ok90aGVyJyA9PiB7CiAgICAgICAgICAgICAgICBybyAgICAgICAgPT4gMSwKICAgICAgICAgICAgICAgIG1vdmVfaW50byA9PiAxLAogICAgICAgICAgICAgICAgY3JlYXRlICAgID0+IDEsCiAgICAgICAgICAgICAgICBvd25lciAgICAgPT4gMSwKICAgICAgICAgICAgICAgIHByaW9yaXR5ICA9PiAwLAogICAgICAgICAgICAgICAgcncgICAgICAgID0+IDAsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC4uLgogICAgICAgIH0sCiAgICAgICAgVXNlcklEID0+IDEyMywKICAgICk7Cgo9Y3V0CgpzdWIgR3JvdXBDdXN0b21lckFkZCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBmb3IgbXkgJE5lZWRlZCAocXcoQ3VzdG9tZXJJRCBHSUQgVXNlcklEIFBlcm1pc3Npb24pKSB7CiAgICAgICAgaWYgKCAhJFBhcmFteyROZWVkZWR9ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCAkTmVlZGVkISIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgIyBjaGVjayBydyBydWxlIChzZXQgb25seSBydyBhbmQgcmVtb3ZlIHJlc3QsIGJlY2F1c2UgaXQncyBpbmNsdWRpbmcgYWxsIGluIHJ3KQogICAgbXkgQENvbnRleHRzID0gJFNlbGYtPkdyb3VwQ29udGV4dE5hbWVMaXN0KCk7CiAgICBDT05URVhUOgogICAgZm9yIG15ICRDb250ZXh0IChAQ29udGV4dHMpIHsKICAgICAgICBuZXh0IENPTlRFWFQgaWYgISRQYXJhbXtQZXJtaXNzaW9ufS0+eyRDb250ZXh0fS0+e3J3fTsKICAgICAgICAkUGFyYW17UGVybWlzc2lvbn0tPnskQ29udGV4dH0gPSB7IHJ3ID0+IDEgfTsKICAgIH0KCiAgICAjIGdldCBkYXRhYmFzZSBvYmplY3QKICAgIG15ICREQk9iamVjdCAgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEQicpOwogICAgbXkgJFBlcm1pc3Npb25zID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKS0+R2V0KCdTeXN0ZW06OkN1c3RvbWVyOjpQZXJtaXNzaW9uJyk7CgogICAgIyB1cGRhdGUgcGVybWlzc2lvbgogICAgQ09OVEVYVDoKICAgIGZvciBteSAkQ29udGV4dCAoQENvbnRleHRzKSB7CiAgICAgICAgbmV4dCBDT05URVhUIGlmICFJc0hhc2hSZWZXaXRoRGF0YSggJFBhcmFte1Blcm1pc3Npb259LT57JENvbnRleHR9ICk7CgogICAgICAgICMgZGVsZXRlIGV4aXN0aW5nIHBlcm1pc3Npb24KICAgICAgICAkREJPYmplY3QtPkRvKAogICAgICAgICAgICBTUUwgPT4gJ0RFTEVURSBGUk9NIGdyb3VwX2N1c3RvbWVyIFdIRVJFICcKICAgICAgICAgICAgICAgIC4gJyBncm91cF9pZCA9ID8gQU5EIGN1c3RvbWVyX2lkID0gPyBBTkQgJwogICAgICAgICAgICAgICAgLiAnIHBlcm1pc3Npb25fY29udGV4dCA9ID8nLAogICAgICAgICAgICBCaW5kID0+IFsgXCRQYXJhbXtHSUR9LCBcJFBhcmFte0N1c3RvbWVySUR9LCBcJENvbnRleHQgXSwKICAgICAgICApOwoKICAgICAgICAjIGluc2VydCBuZXcgcGVybWlzc2lvbiAoaWYgbmVlZGVkKQogICAgICAgIFRZUEU6CiAgICAgICAgZm9yIG15ICRUeXBlICggQHskUGVybWlzc2lvbnN9ICkgewogICAgICAgICAgICBuZXh0IFRZUEUgaWYgISRQYXJhbXtQZXJtaXNzaW9ufS0+eyRDb250ZXh0fS0+eyRUeXBlfTsKCiAgICAgICAgICAgICMgZGVidWcKICAgICAgICAgICAgaWYgKCAkU2VsZi0+e0RlYnVnfSApIHsKICAgICAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdub3RpY2UnLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgPT4KICAgICAgICAgICAgICAgICAgICAgICAgIkFkZCBDdXN0b21lcklEOiRQYXJhbXtDdXN0b21lcklEfSB0byBHSUQ6JFBhcmFte0dJRH0sICRUeXBlOiRQYXJhbXtQZXJtaXNzaW9ufS0+eyRDb250ZXh0fS0+eyRUeXBlfSwgQ29udGV4dDokQ29udGV4dCEiLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJERCT2JqZWN0LT5EbygKICAgICAgICAgICAgICAgIFNRTCA9PiAnSU5TRVJUIElOVE8gZ3JvdXBfY3VzdG9tZXIgJwogICAgICAgICAgICAgICAgICAgIC4gJyhjdXN0b21lcl9pZCwgZ3JvdXBfaWQsIHBlcm1pc3Npb25fa2V5LCBwZXJtaXNzaW9uX3ZhbHVlLCAnCiAgICAgICAgICAgICAgICAgICAgLiAncGVybWlzc2lvbl9jb250ZXh0LCBjcmVhdGVfdGltZSwgY3JlYXRlX2J5LCBjaGFuZ2VfdGltZSwgY2hhbmdlX2J5KSAnCiAgICAgICAgICAgICAgICAgICAgLiAnVkFMVUVTICg/LCA/LCA/LCA/LCA/LCBjdXJyZW50X3RpbWVzdGFtcCwgPywgY3VycmVudF90aW1lc3RhbXAsID8pJywKICAgICAgICAgICAgICAgIEJpbmQgPT4gWwogICAgICAgICAgICAgICAgICAgIFwkUGFyYW17Q3VzdG9tZXJJRH0sIFwkUGFyYW17R0lEfSwgXCRUeXBlLCBcJFBhcmFte1Blcm1pc3Npb259LT57JENvbnRleHR9LT57JFR5cGV9LAogICAgICAgICAgICAgICAgICAgIFwkQ29udGV4dCwgXCRQYXJhbXtVc2VySUR9LCBcJFBhcmFte1VzZXJJRH0sCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICAjIGRlbGV0ZSBjYWNoZQogICAgIyByZW1vdmUgY29tcGxldGUgQ3VzdG9tZXJHcm91cCBjYWNoZSBiZWNhdXNlCiAgICAjICAgaXQgYWZmZWN0cyBHcm91cE1lbWJlckxpc3QoKSB3aGljaCBpcyBDdXN0b21lclVzZXJJRCBiYXNlZAogICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNhY2hlJyktPkNsZWFuVXAoCiAgICAgICAgVHlwZSA9PiAkU2VsZi0+e0NhY2hlVHlwZX0sCiAgICApOwoKICAgIHJldHVybiAxOwp9Cgo9aGVhZDIgR3JvdXBDdXN0b21lckxpc3QoKQoKR2V0IGN1c3RvbWVycyBvZiB0aGUgZ2l2ZW4gZ3JvdXAuCgogICAgbXkgJUN1c3RvbWVycyA9ICRDdXN0b21lckdyb3VwT2JqZWN0LT5Hcm91cEN1c3RvbWVyTGlzdCgKICAgICAgICBHcm91cElEID0+ICcxMjMnLAogICAgICAgIFR5cGUgICAgPT4gJ3JvJywgICAgIyByb3xtb3ZlX2ludG98cHJpb3JpdHl8Y3JlYXRlfG93bmVyfHJ3CiAgICAgICAgQ29udGV4dCA9PiAnVGlja2V0OjpDdXN0b21lcklEOjpTYW1lJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgcGVybWlzc2lvbnMgdG8gc2FtZSBjb21wYW55IHRpY2tldHMsIGRlZmF1bHQgY29udGV4dAogICAgICAgIFJlc3VsdCAgPT4gJ0hBU0gnLCAgIyByZXR1cm4gaGFzaCBvZiBjdXN0b21lciBpZCA9PiBncm91cCBuYW1lIGVudHJpZXMKICAgICk7CgpvcgoKICAgIG15IEBDdXN0b21lcklEcyA9ICRDdXN0b21lckdyb3VwT2JqZWN0LT5Hcm91cEN1c3RvbWVyTGlzdCgKICAgICAgICBHcm91cElEID0+ICcxMjMnLAogICAgICAgIFR5cGUgICAgPT4gJ3JvJywgICAgIyByb3xtb3ZlX2ludG98cHJpb3JpdHl8Y3JlYXRlfG93bmVyfHJ3CiAgICAgICAgQ29udGV4dCA9PiAnVGlja2V0OjpDdXN0b21lcklEOjpTYW1lJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgcGVybWlzc2lvbnMgdG8gc2FtZSBjb21wYW55IHRpY2tldHMsIGRlZmF1bHQgY29udGV4dAogICAgICAgIFJlc3VsdCAgPT4gJ0lEJywgICAgIyByZXR1cm4gYXJyYXkgb2YgY3VzdG9tZXIgaWRzCiAgICApOwoKb3IKCiAgICBteSBAQ3VzdG9tZXJOYW1lcyA9ICRDdXN0b21lckdyb3VwT2JqZWN0LT5Hcm91cEN1c3RvbWVyTGlzdCgKICAgICAgICBHcm91cElEID0+ICcxMjMnLAogICAgICAgIFR5cGUgICAgPT4gJ3JvJywgICAgIyByb3xtb3ZlX2ludG98cHJpb3JpdHl8Y3JlYXRlfG93bmVyfHJ3CiAgICAgICAgQ29udGV4dCA9PiAnVGlja2V0OjpDdXN0b21lcklEOjpTYW1lJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgcGVybWlzc2lvbnMgdG8gc2FtZSBjb21wYW55IHRpY2tldHMsIGRlZmF1bHQgY29udGV4dAogICAgICAgIFJlc3VsdCAgPT4gJ05hbWUnLCAgIyByZXR1cm4gYXJyYXkgb2YgY3VzdG9tZXIgaWRzCiAgICApOwoKR2V0IGdyb3VwcyBvZiBnaXZlbiBjdXN0b21lci4KCiAgICBteSAlR3JvdXBzID0gJEN1c3RvbWVyR3JvdXBPYmplY3QtPkdyb3VwQ3VzdG9tZXJMaXN0KAogICAgICAgIEN1c3RvbWVySUQgPT4gJzEyMycsCiAgICAgICAgVHlwZSAgICAgICA9PiAncm8nLCAgICAgIyByb3xtb3ZlX2ludG98cHJpb3JpdHl8Y3JlYXRlfG93bmVyfHJ3CiAgICAgICAgQ29udGV4dCA9PiAnVGlja2V0OjpDdXN0b21lcklEOjpTYW1lJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgcGVybWlzc2lvbnMgdG8gc2FtZSBjb21wYW55IHRpY2tldHMsIGRlZmF1bHQgY29udGV4dAogICAgICAgIFJlc3VsdCAgICAgPT4gJ0hBU0gnLCAgICMgcmV0dXJuIGhhc2ggb2YgZ3JvdXAgaWQgPT4gZ3JvdXAgbmFtZSBlbnRyaWVzCiAgICApOwoKb3IKCiAgICBteSBAR3JvdXBJRHMgPSAkQ3VzdG9tZXJHcm91cE9iamVjdC0+R3JvdXBDdXN0b21lckxpc3QoCiAgICAgICAgQ3VzdG9tZXJJRCA9PiAnMTIzJywKICAgICAgICBUeXBlICAgICAgID0+ICdybycsICAgICAjIHJvfG1vdmVfaW50b3xwcmlvcml0eXxjcmVhdGV8b3duZXJ8cncKICAgICAgICBDb250ZXh0ID0+ICdUaWNrZXQ6OkN1c3RvbWVySUQ6OlNhbWUnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBwZXJtaXNzaW9ucyB0byBzYW1lIGNvbXBhbnkgdGlja2V0cywgZGVmYXVsdCBjb250ZXh0CiAgICAgICAgUmVzdWx0ICAgICA9PiAnSUQnLCAgICAgIyByZXR1cm4gYXJyYXkgb2YgZ3JvdXAgaWRzCiAgICApOwoKb3IKCiAgICBteSBAR3JvdXBOYW1lcyA9ICRDdXN0b21lckdyb3VwT2JqZWN0LT5Hcm91cEN1c3RvbWVyTGlzdCgKICAgICAgICBDdXN0b21lcklEID0+ICcxMjMnLAogICAgICAgIFR5cGUgICAgICAgPT4gJ3JvJywgICAgICMgcm98bW92ZV9pbnRvfHByaW9yaXR5fGNyZWF0ZXxvd25lcnxydwogICAgICAgIENvbnRleHQgPT4gJ1RpY2tldDo6Q3VzdG9tZXJJRDo6U2FtZScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHBlcm1pc3Npb25zIHRvIHNhbWUgY29tcGFueSB0aWNrZXRzLCBkZWZhdWx0IGNvbnRleHQKICAgICAgICBSZXN1bHQgICAgID0+ICdOYW1lJywgICAjIHJldHVybiBhcnJheSBvZiBncm91cCBuYW1lcwogICAgKTsKCj1jdXQKCnN1YiBHcm91cEN1c3RvbWVyTGlzdCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBmb3IgbXkgJE5lZWRlZCAocXcoUmVzdWx0IFR5cGUpKSB7CiAgICAgICAgaWYgKCAhJFBhcmFteyROZWVkZWR9ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCAkTmVlZGVkISIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CiAgICBpZiAoICEkUGFyYW17Q3VzdG9tZXJJRH0gJiYgISRQYXJhbXtHcm91cElEfSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ05lZWQgQ3VzdG9tZXJJRCBvciBHcm91cElEIScsCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgIyBmYWxsYmFjayB0byB0aGUgZGVmYXVsdCBjb250ZXh0CiAgICBpZiAoICEkUGFyYW17Q29udGV4dH0gKSB7CiAgICAgICAgJFBhcmFte0NvbnRleHR9ID0gJFNlbGYtPkdyb3VwQ29udGV4dE5hbWVHZXQoCiAgICAgICAgICAgIFN5c0NvbmZpZ05hbWUgPT4gJzAwMS1DdXN0b21lcklELXNhbWUnLAogICAgICAgICk7CiAgICB9CgogICAgIyBjcmVhdGUgY2FjaGUga2V5CiAgICBteSAkQ2FjaGVLZXkgPSAnR3JvdXBDdXN0b21lckxpc3Q6OicgLiAkUGFyYW17VHlwZX0gLiAnOjonIC4gJFBhcmFte0NvbnRleHR9IC4gJzo6JzsKICAgIGlmICggJFBhcmFte0N1c3RvbWVySUR9ICkgewogICAgICAgICRDYWNoZUtleSAuPSAnQ3VzdG9tZXJJRDo6JyAuICRQYXJhbXtDdXN0b21lcklEfTsKICAgIH0KICAgIGVsc2UgewogICAgICAgICRDYWNoZUtleSAuPSAnR3JvdXBJRDo6JyAuICRQYXJhbXtHcm91cElEfTsKICAgIH0KCiAgICAjIGNoZWNrIGNhY2hlCiAgICBteSAkQ2FjaGUgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2FjaGUnKS0+R2V0KAogICAgICAgIFR5cGUgPT4gJFNlbGYtPntDYWNoZVR5cGV9LAogICAgICAgIEtleSAgPT4gJENhY2hlS2V5LAogICAgKTsKICAgIGlmICgkQ2FjaGUpIHsKICAgICAgICBpZiAoICRQYXJhbXtSZXN1bHR9IGVxICdIQVNIJyApIHsKICAgICAgICAgICAgcmV0dXJuICV7JENhY2hlfTsKICAgICAgICB9CiAgICAgICAgZWxzaWYgKCAkUGFyYW17UmVzdWx0fSBlcSAnSUQnICkgewogICAgICAgICAgICByZXR1cm4gKCBzb3J0IGtleXMgJXskQ2FjaGV9ICk7CiAgICAgICAgfQogICAgICAgIGVsc2lmICggJFBhcmFte1Jlc3VsdH0gZXEgJ05hbWUnICkgewogICAgICAgICAgICByZXR1cm4gKCBzb3J0IHZhbHVlcyAleyRDYWNoZX0gKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIG15ICVEYXRhOwoKICAgICMgY2hlY2sgaWYgY3VzdG9tZXIgZ3JvdXAgZmVhdHVyZSBpcyBhY3RpdmUsIGlmIG5vdCwgcmV0dXJuIGFsbCBncm91cHMKICAgIGlmICggISRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnQ3VzdG9tZXJHcm91cFN1cHBvcnQnKSApIHsKCiAgICAgICAgIyBnZXQgcGVybWlzc2lvbnMKICAgICAgICAlRGF0YSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpHcm91cCcpLT5Hcm91cExpc3QoIFZhbGlkID0+IDEgKTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIG15ICREQk9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEQicpOwoKICAgICAgICAjIGlmIGl0J3MgYWN0aXZlLCByZXR1cm4ganVzdCB0aGUgcGVybWl0dGVkIGdyb3VwcwogICAgICAgIG15ICRTUUwgPQogICAgICAgICAgICAnU0VMRUNUIGcuaWQsIGcubmFtZSwgZ2MucGVybWlzc2lvbl9rZXksIGdjLnBlcm1pc3Npb25fdmFsdWUsIGdjLmN1c3RvbWVyX2lkJwogICAgICAgICAgICAuICcgRlJPTSBwZXJtaXNzaW9uX2dyb3VwcyBnLCBncm91cF9jdXN0b21lciBnYycKICAgICAgICAgICAgLiAnIFdIRVJFIGcudmFsaWRfaWQgSU4gKCAnIC4gam9pbiAnLCAnLCAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VmFsaWQnKS0+VmFsaWRJRHNHZXQoKSAuICcpJwogICAgICAgICAgICAuICcgQU5EIGcuaWQgPSBnYy5ncm91cF9pZCBBTkQgZ2MucGVybWlzc2lvbl92YWx1ZSA9IDEnCiAgICAgICAgICAgIC4gIiBBTkQgZ2MucGVybWlzc2lvbl9rZXkgSU4gKD8sICdydycpIgogICAgICAgICAgICAuICcgQU5EIGdjLnBlcm1pc3Npb25fY29udGV4dCA9ID8nOwogICAgICAgIG15IEBCaW5kID0gKCBcJFBhcmFte1R5cGV9LCBcJFBhcmFte0NvbnRleHR9ICk7CgogICAgICAgIGlmICggJFBhcmFte0N1c3RvbWVySUR9ICkgewogICAgICAgICAgICAkU1FMIC49ICcgQU5EIGdjLmN1c3RvbWVyX2lkID0gPyc7CiAgICAgICAgICAgIHB1c2ggQEJpbmQsIFwkUGFyYW17Q3VzdG9tZXJJRH07CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkU1FMIC49ICcgQU5EIGdjLmdyb3VwX2lkID0gPyc7CiAgICAgICAgICAgIHB1c2ggQEJpbmQsIFwkUGFyYW17R3JvdXBJRH07CiAgICAgICAgfQogICAgICAgICREQk9iamVjdC0+UHJlcGFyZSgKICAgICAgICAgICAgU1FMICA9PiAkU1FMLAogICAgICAgICAgICBCaW5kID0+IFxAQmluZCwKICAgICAgICApOwogICAgICAgIHdoaWxlICggbXkgQFJvdyA9ICREQk9iamVjdC0+RmV0Y2hyb3dBcnJheSgpICkgewogICAgICAgICAgICBpZiAoICRQYXJhbXtDdXN0b21lcklEfSApIHsKICAgICAgICAgICAgICAgICREYXRheyAkUm93WzBdIH0gPSAkUm93WzFdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJERhdGF7ICRSb3dbNF0gfSA9ICRSb3dbMV07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgIyBhZGQgYWx3YXlzIGdyb3VwcyBpZiBncm91cHMgYXJlIHJlcXVlc3RlZAogICAgIyBkb24ndCBhZGQgdGhlbSBmb3Igbm9uLWRlZmF1bHQgY29udGV4dCAoc2FtZSBDdXN0b21lcklEIHBlcm1pc3Npb24pIHJlcXVlc3RzCiAgICBteSAkRGVmYXVsdENvbnRleHROYW1lID0gJFNlbGYtPkdyb3VwQ29udGV4dE5hbWVHZXQoCiAgICAgICAgU3lzQ29uZmlnTmFtZSA9PiAnMDAxLUN1c3RvbWVySUQtc2FtZScsCiAgICApOwogICAgaWYgKAogICAgICAgICRQYXJhbXtDdXN0b21lcklEfQogICAgICAgICYmICRQYXJhbXtDb250ZXh0fSBlcSAkRGVmYXVsdENvbnRleHROYW1lCiAgICAgICAgJiYgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKS0+R2V0KCdDdXN0b21lckdyb3VwQ29tcGFueUFsd2F5c0dyb3VwcycpCiAgICAgICAgKQogICAgewogICAgICAgIG15ICVHcm91cHMgICAgICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06Okdyb3VwJyktPkdyb3VwTGlzdCggVmFsaWQgPT4gMSApOwogICAgICAgIG15ICVHcm91cHNSZXZlcnNlID0gcmV2ZXJzZSAlR3JvdXBzOwogICAgICAgIEFMV0FZU0dST1VQOgogICAgICAgIGZvciBteSAkQWx3YXlzR3JvdXAgKCBAeyAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OkNvbmZpZycpLT5HZXQoJ0N1c3RvbWVyR3JvdXBDb21wYW55QWx3YXlzR3JvdXBzJykgfSApIHsKICAgICAgICAgICAgbmV4dCBBTFdBWVNHUk9VUCBpZiAhJEdyb3Vwc1JldmVyc2V7JEFsd2F5c0dyb3VwfTsKICAgICAgICAgICAgbmV4dCBBTFdBWVNHUk9VUCBpZiAkRGF0YXsgJEdyb3Vwc1JldmVyc2V7JEFsd2F5c0dyb3VwfSB9OwogICAgICAgICAgICAkRGF0YXsgJEdyb3Vwc1JldmVyc2V7JEFsd2F5c0dyb3VwfSB9ID0gJEFsd2F5c0dyb3VwOwogICAgICAgIH0KICAgIH0KCiAgICAjIHNldCBjYWNoZQogICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNhY2hlJyktPlNldCgKICAgICAgICBUeXBlICA9PiAkU2VsZi0+e0NhY2hlVHlwZX0sCiAgICAgICAgVFRMICAgPT4gJFNlbGYtPntDYWNoZVRUTH0sCiAgICAgICAgS2V5ICAgPT4gJENhY2hlS2V5LAogICAgICAgIFZhbHVlID0+IFwlRGF0YSwKICAgICk7CgogICAgIyByZXR1cm4gZGF0YSBkZXBlbmRpbmcgb24gcmVxdWVzdGVkIHJlc3VsdAogICAgaWYgKCAkUGFyYW17UmVzdWx0fSBlcSAnSEFTSCcgKSB7CiAgICAgICAgcmV0dXJuICVEYXRhOwogICAgfQogICAgZWxzaWYgKCAkUGFyYW17UmVzdWx0fSBlcSAnSUQnICkgewogICAgICAgIHJldHVybiAoIHNvcnQga2V5cyAlRGF0YSApOwogICAgfQogICAgZWxzaWYgKCAkUGFyYW17UmVzdWx0fSBlcSAnTmFtZScgKSB7CiAgICAgICAgcmV0dXJuICggc29ydCB2YWx1ZXMgJURhdGEgKTsKICAgIH0KICAgIHJldHVybjsKfQoKPWhlYWQyIEdyb3VwQ29udGV4dE5hbWVHZXQoKQoKSGVscGVyIGZ1bmN0aW9uIHRvIGdldCBjdXJyZW50bHkgY29uZmlndXJlZCBuYW1lIG9mIGEgc3BlY2lmaWMgZ3JvdXAgYWNjZXNzIGNvbnRleHQKCiAgICBteSAkQ29udGV4dE5hbWUgPSAkQ3VzdG9tZXJHcm91cE9iamVjdC0+R3JvdXBDb250ZXh0TmFtZUdldCgKICAgICAgICBTeXNDb25maWdOYW1lID0+ICcxMDAtQ3VzdG9tZXJJRC1vdGhlcicsICMgb3B0aW9uYWwsIGRlZmF1bHRzIHRvICcwMDEtQ3VzdG9tZXJJRC1zYW1lJwogICAgKTsKCj1jdXQKCnN1YiBHcm91cENvbnRleHROYW1lR2V0IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBnZXQgY29uZmlnIG5hbWUKICAgICMgZmFsbGJhY2sgdG8gJ25vcm1hbCcgZ3JvdXAgcGVybWlzc2lvbiBjb25maWcKICAgICRQYXJhbXtTeXNDb25maWdOYW1lfSB8fD0gJzAwMS1DdXN0b21lcklELXNhbWUnOwoKICAgIG15ICRDb250ZXh0Q29uZmlnID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKS0+R2V0KCdDdXN0b21lckdyb3VwUGVybWlzc2lvbkNvbnRleHQnKTsKICAgIHJldHVybiBpZiAhSXNIYXNoUmVmV2l0aERhdGEoJENvbnRleHRDb25maWcpOwogICAgcmV0dXJuIGlmICFJc0hhc2hSZWZXaXRoRGF0YSggJENvbnRleHRDb25maWctPnsgJFBhcmFte1N5c0NvbmZpZ05hbWV9IH0gKTsKCiAgICByZXR1cm4gJENvbnRleHRDb25maWctPnsgJFBhcmFte1N5c0NvbmZpZ05hbWV9IH0tPntWYWx1ZX07Cn0KCj1oZWFkMiBHcm91cENvbnRleHROYW1lTGlzdCgpCgpIZWxwZXIgZnVuY3Rpb24gdG8gZ2V0IHRoZSBuYW1lcyBvZiBhbGwgY29uZmlndXJlZCBncm91cCBhY2Nlc3MgY29udGV4dHMKCiAgICBteSBAQ29udGV4dE5hbWVzID0gJEN1c3RvbWVyR3JvdXBPYmplY3QtPkdyb3VwQ29udGV4dE5hbWVMaXN0KCk7Cgo9Y3V0CgpzdWIgR3JvdXBDb250ZXh0TmFtZUxpc3QgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkQ29udGV4dENvbmZpZyA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyktPkdldCgnQ3VzdG9tZXJHcm91cFBlcm1pc3Npb25Db250ZXh0Jyk7CiAgICByZXR1cm4gKCkgaWYgIUlzSGFzaFJlZldpdGhEYXRhKCRDb250ZXh0Q29uZmlnKTsKCiAgICAjIGZpbGwgbGlzdAogICAgbXkgQENvbnRleHROYW1lczsKICAgIENPTlRFWFQ6CiAgICBmb3IgbXkgJEl0ZW0gKCBzb3J0IGtleXMgJXskQ29udGV4dENvbmZpZ30gKSB7CiAgICAgICAgbmV4dCBDT05URVhUIGlmICFJc0hhc2hSZWZXaXRoRGF0YSggJENvbnRleHRDb25maWctPnskSXRlbX0gKTsKICAgICAgICBuZXh0IENPTlRFWFQgaWYgISRDb250ZXh0Q29uZmlnLT57JEl0ZW19LT57VmFsdWV9OwoKICAgICAgICBwdXNoIEBDb250ZXh0TmFtZXMsICRDb250ZXh0Q29uZmlnLT57JEl0ZW19LT57VmFsdWV9OwogICAgfQoKICAgIHJldHVybiBAQ29udGV4dE5hbWVzOwp9Cgo9aGVhZDIgR3JvdXBDb250ZXh0Q3VzdG9tZXJzKCkKCkdldCBhbGwgY3VzdG9tZXIgY29tcGFuaWVzIG9mIHRoZSBnaXZlbiBjdXN0b21lciB1c2VyLAppbmNsdWRpbmcgdGhvc2UgYXNzb2NpYXRlZCB2aWEgY29udGV4dCBiYXNlZCBwZXJtaXNzaW9ucy4KCiAgICBteSAlQ3VzdG9tZXJzID0gJEN1c3RvbWVyR3JvdXBPYmplY3QtPkdyb3VwQ29udGV4dEN1c3RvbWVycygKICAgICAgICBDdXN0b21lclVzZXJJRCA9PiAnMTIzJywKICAgICk7CgpSZXR1cm5zIGhhc2ggd2l0aCBDdXN0b21lciBJRHMgYXMga2V5IGFuZCBDdXN0b21lciBDb21wYW55IE5hbWUgYXMgdmFsdWU6CgogICAgJUN1c3RvbWVycyA9IHsKICAgICAgJzAwMScgPT4gJ0N1c3RvbWVyIENvbXBhbnkgMScsCiAgICAgICcwMDInID0+ICdDdXN0b21lciBDb21wYW55IDInLAogICAgfTsKCj1jdXQKCnN1YiBHcm91cENvbnRleHRDdXN0b21lcnMgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIG5lZWRlZCBzdHVmZgogICAgaWYgKCAhJFBhcmFte0N1c3RvbWVyVXNlcklEfSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ05lZWQgQ3VzdG9tZXJVc2VySUQhJywKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIG5vIGNhY2hlIGlzIHVzZWQgYmVjYXVzZSBvZiB0b28gbWFueSBmYWN0b3JzIG91dHNpZGUgb3VyIGNvbnRyb2wKCiAgICAjIGdldCBjdXN0b21lciBpZHMgZnJvbSBiYWNrZW5kCiAgICBteSBAQ3VzdG9tZXJJRHMgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q3VzdG9tZXJVc2VyJyktPkN1c3RvbWVySURzKAogICAgICAgIFVzZXIgPT4gJFBhcmFte0N1c3RvbWVyVXNlcklEfSwKICAgICk7CgogICAgIyBjaGVjayBmb3IgYWNjZXNzIHRvIG90aGVyIEN1c3RvbWVySURzIHZpYSBncm91cCBhc3NpZ25tZW50CiAgICAjIGFkZCBhbGwgY29tYmluYXRpb25zIGJhc2VkIG9uIGNvbnRleHQgYmFzZXMgZ3JvdXAgYWNjZXNzCiAgICBteSAkRXh0cmFQZXJtaXNzaW9uQ29udGV4dCA9ICRTZWxmLT5Hcm91cENvbnRleHROYW1lR2V0KAogICAgICAgIFN5c0NvbmZpZ05hbWUgPT4gJzEwMC1DdXN0b21lcklELW90aGVyJywKICAgICk7CiAgICBpZiAoCiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKS0+R2V0KCdDdXN0b21lckdyb3VwU3VwcG9ydCcpCiAgICAgICAgJiYgJEV4dHJhUGVybWlzc2lvbkNvbnRleHQKICAgICAgICApCiAgICB7CgogICAgICAgICMgZm9yIGFsbCBDdXN0b21lcklEcyBnZXQgZ3JvdXBzIHdpdGggZXh0cmEgYWNjZXNzCiAgICAgICAgbXkgJUV4dHJhUGVybWlzc2lvbkdyb3VwczsKICAgICAgICBDVVNUT01FUklEOgogICAgICAgIGZvciBteSAkQ3VzdG9tZXJJRCAoQEN1c3RvbWVySURzKSB7CiAgICAgICAgICAgIG15ICVHcm91cExpc3QgPSAkU2VsZi0+R3JvdXBDdXN0b21lckxpc3QoCiAgICAgICAgICAgICAgICBDdXN0b21lcklEID0+ICRDdXN0b21lcklELAogICAgICAgICAgICAgICAgVHlwZSAgICAgICA9PiAncm8nLAogICAgICAgICAgICAgICAgQ29udGV4dCAgICA9PiAkRXh0cmFQZXJtaXNzaW9uQ29udGV4dCwKICAgICAgICAgICAgICAgIFJlc3VsdCAgICAgPT4gJ0hBU0gnLAogICAgICAgICAgICApOwogICAgICAgICAgICBuZXh0IENVU1RPTUVSSUQgaWYgISVHcm91cExpc3Q7CgogICAgICAgICAgICAjIGFkZCB0byBncm91cHMKICAgICAgICAgICAgJUV4dHJhUGVybWlzc2lvbkdyb3VwcyA9ICgKICAgICAgICAgICAgICAgICVFeHRyYVBlcm1pc3Npb25Hcm91cHMsCiAgICAgICAgICAgICAgICAlR3JvdXBMaXN0LAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgIyBhZGQgYWxsIGFjY2Vzc2libGUgQ3VzdG9tZXJJRHMKICAgICAgICBHUk9VUElEOgogICAgICAgIGZvciBteSAkR3JvdXBJRCAoIHNvcnQga2V5cyAlRXh0cmFQZXJtaXNzaW9uR3JvdXBzICkgewogICAgICAgICAgICBteSBARXh0cmFDdXN0b21lcklEcyA9ICRTZWxmLT5Hcm91cEN1c3RvbWVyTGlzdCgKICAgICAgICAgICAgICAgIEdyb3VwSUQgPT4gJEdyb3VwSUQsCiAgICAgICAgICAgICAgICBUeXBlICAgID0+ICdybycsCiAgICAgICAgICAgICAgICBSZXN1bHQgID0+ICdJRCcsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIG5leHQgR1JPVVBJRCBpZiAhQEV4dHJhQ3VzdG9tZXJJRHM7CgogICAgICAgICAgICAjIGFkZCB0byBDdXN0b21lcklEcwogICAgICAgICAgICBwdXNoIEBDdXN0b21lcklEcywgQEV4dHJhQ3VzdG9tZXJJRHM7CiAgICAgICAgfQogICAgfQoKICAgICMgZ2V0IGFsbCBjdXN0b21lciBjb21wYW5pZXMgZm9yIHF1aWNrIG5hbWUgbG9va3VwCiAgICBteSAlQWxsQ3VzdG9tZXJzID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyQ29tcGFueScpLT5DdXN0b21lckNvbXBhbnlMaXN0KAogICAgICAgIFVzZXJJRCA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgVmFsaWQgPT4gMSwKICAgICAgICBMaW1pdCA9PiAwLAogICAgKTsKCiAgICAjIGZpbHRlciByZXN1bHRzIHVzaW5nIHZhbGlkIGN1c3RvbWVycywgYWRkIGN1c3RvbWVyIG5hbWUgdG8gcmVzdWx0cwogICAgbXkgJUN1c3RvbWVyczsKICAgIENVU1RPTUVSSUQ6CiAgICBmb3IgbXkgJEN1c3RvbWVySUQgKEBDdXN0b21lcklEcykgewogICAgICAgIG5leHQgQ1VTVE9NRVJJRCBpZiAhJEFsbEN1c3RvbWVyc3skQ3VzdG9tZXJJRH07CiAgICAgICAgbmV4dCBDVVNUT01FUklEIGlmICRDdXN0b21lcnN7JEN1c3RvbWVySUR9OwogICAgICAgICRDdXN0b21lcnN7JEN1c3RvbWVySUR9ID0gJEFsbEN1c3RvbWVyc3skQ3VzdG9tZXJJRH07CiAgICB9CgogICAgcmV0dXJuICVDdXN0b21lcnM7Cn0KCj1oZWFkMiBHcm91cExvb2t1cCgpCgpnZXQgaWQgb3IgbmFtZSBmb3IgZ3JvdXAKCiAgICBteSAkR3JvdXAgPSAkQ3VzdG9tZXJHcm91cE9iamVjdC0+R3JvdXBMb29rdXAoR3JvdXBJRCA9PiAkR3JvdXBJRCk7CgogICAgbXkgJEdyb3VwSUQgPSAkQ3VzdG9tZXJHcm91cE9iamVjdC0+R3JvdXBMb29rdXAoR3JvdXAgPT4gJEdyb3VwKTsKCj1jdXQKCnN1YiBHcm91cExvb2t1cCB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBpZiAoICEkUGFyYW17R3JvdXB9ICYmICEkUGFyYW17R3JvdXBJRH0gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdHb3Qgbm8gR3JvdXAgb3IgR3JvdXBJRCEnLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgY2hlY2sgaWYgcmVzdWx0IGlzIGNhY2hlZAogICAgbXkgJENhY2hlS2V5OwogICAgaWYgKCAkUGFyYW17R3JvdXBJRH0gKSB7CiAgICAgICAgJENhY2hlS2V5ID0gIkdyb3VwTG9va3VwOjpJRDo6JFBhcmFte0dyb3VwSUR9IjsKICAgIH0KICAgIGVsc2lmICggJFBhcmFte0dyb3VwfSApIHsKICAgICAgICAkQ2FjaGVLZXkgPSAiR3JvdXBMb29rdXA6Ok5hbWU6OiRQYXJhbXtHcm91cH0iOwogICAgfQoKICAgIG15ICRDYWNoZSA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDYWNoZScpLT5HZXQoCiAgICAgICAgVHlwZSA9PiAkU2VsZi0+e0NhY2hlVHlwZX0sCiAgICAgICAgS2V5ICA9PiAkQ2FjaGVLZXksCiAgICApOwogICAgcmV0dXJuICR7JENhY2hlfSBpZiAoIHJlZiAkQ2FjaGUgZXEgJ1NDQUxBUicgKTsKCiAgICBteSAkREJPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6REInKTsKCiAgICAjIGdldCBkYXRhCiAgICBteSAkU1FMOwogICAgbXkgQEJpbmQ7CiAgICBteSAkU3VmZml4OwogICAgaWYgKCAkUGFyYW17R3JvdXB9ICkgewogICAgICAgICRQYXJhbXtXaGF0fSA9ICRQYXJhbXtHcm91cH07CiAgICAgICAgJFN1ZmZpeCAgICAgID0gJ0dyb3VwSUQnOwogICAgICAgICRTUUwgICAgICAgICA9ICdTRUxFQ1QgaWQgRlJPTSBwZXJtaXNzaW9uX2dyb3VwcyBXSEVSRSBuYW1lID0gPyc7CiAgICAgICAgcHVzaCBAQmluZCwgXCRQYXJhbXtHcm91cH07CiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkUGFyYW17V2hhdH0gPSAkUGFyYW17R3JvdXBJRH07CiAgICAgICAgJFN1ZmZpeCAgICAgID0gJ0dyb3VwJzsKICAgICAgICAkU1FMICAgICAgICAgPSAnU0VMRUNUIG5hbWUgRlJPTSBwZXJtaXNzaW9uX2dyb3VwcyBXSEVSRSBpZCA9ID8nOwogICAgICAgIHB1c2ggQEJpbmQsIFwkUGFyYW17R3JvdXBJRH07CiAgICB9CiAgICByZXR1cm4gaWYgISREQk9iamVjdC0+UHJlcGFyZSgKICAgICAgICBTUUwgID0+ICRTUUwsCiAgICAgICAgQmluZCA9PiBcQEJpbmQsCiAgICApOwoKICAgIG15ICRSZXN1bHQ7CiAgICB3aGlsZSAoIG15IEBSb3cgPSAkREJPYmplY3QtPkZldGNocm93QXJyYXkoKSApIHsKCiAgICAgICAgIyBzdG9yZSByZXN1bHQKICAgICAgICAkUmVzdWx0ID0gJFJvd1swXTsKICAgIH0KCiAgICAjIGNoZWNrIGlmIGRhdGEgZXhpc3RzCiAgICBpZiAoICEkUmVzdWx0ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiRm91bmQgbm8gXCQkU3VmZml4IGZvciAkUGFyYW17V2hhdH0hIiwKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIHNldCBjYWNoZQogICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNhY2hlJyktPlNldCgKICAgICAgICBUeXBlICA9PiAkU2VsZi0+e0NhY2hlVHlwZX0sCiAgICAgICAgVFRMICAgPT4gJFNlbGYtPntDYWNoZVRUTH0sCiAgICAgICAgS2V5ICAgPT4gJENhY2hlS2V5LAogICAgICAgIFZhbHVlID0+IFwkUmVzdWx0LAogICAgKTsKCiAgICByZXR1cm4gJFJlc3VsdDsKfQoKPWhlYWQyIFBlcm1pc3Npb25DaGVjaygpCgpDaGVjayBpZiBhIGN1c3RvbWVyIHVzZXIgaGFzIGEgY2VydGFpbiBwZXJtaXNzaW9uIGZvciBhIGNlcnRhaW4gZ3JvdXAuCgogICAgbXkgJEhhc1Blcm1pc3Npb24gPSAkQ3VzdG9tZXJHcm91cE9iamVjdC0+UGVybWlzc2lvbkNoZWNrKAogICAgICAgIFVzZXJJRCAgICA9PiAkVXNlcklELAogICAgICAgIEdyb3VwTmFtZSA9PiAkR3JvdXBOYW1lLAogICAgICAgIFR5cGUgICAgICA9PiAnbW92ZV9pbnRvJywKICAgICk7Cgo9Y3V0CgpzdWIgUGVybWlzc2lvbkNoZWNrIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIGZvciBteSAkTmVlZGVkIChxdyhVc2VySUQgR3JvdXBOYW1lIFR5cGUpKSB7CiAgICAgICAgaWYgKCAhJFBhcmFteyROZWVkZWR9ICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCAkTmVlZGVkISIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgbXkgJUdyb3VwTWVtYmVyTGlzdCA9IHJldmVyc2UgJFNlbGYtPkdyb3VwTWVtYmVyTGlzdCgKICAgICAgICBVc2VySUQgPT4gJFBhcmFte1VzZXJJRH0sCiAgICAgICAgVHlwZSAgID0+ICRQYXJhbXtUeXBlfSwKICAgICAgICBSZXN1bHQgPT4gJ0hBU0gnLAogICAgKTsKCiAgICByZXR1cm4gJEdyb3VwTWVtYmVyTGlzdHsgJFBhcmFte0dyb3VwTmFtZX0gfSA/IDEgOiAwOwp9CgoxOwoKPWhlYWQxIFRFUk1TIEFORCBDT05ESVRJT05TCgpUaGlzIHNvZnR3YXJlIGlzIHBhcnQgb2YgdGhlIE9UUlMgcHJvamVjdCAoTDxodHRwczovL290cnMub3JnLz4pLgoKVGhpcyBzb2Z0d2FyZSBjb21lcyB3aXRoIEFCU09MVVRFTFkgTk8gV0FSUkFOVFkuIEZvciBkZXRhaWxzLCBzZWUKdGhlIGVuY2xvc2VkIGZpbGUgQ09QWUlORyBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbiAoR1BMKS4gSWYgeW91CmRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBMPGh0dHBzOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvZ3BsLTMuMC50eHQ+LgoKPWN1dAo=</File>
        <File Location="Custom/Kernel/System/CustomerUser/DB.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxLTIwMjIgWm51bnkgR21iSCwgaHR0cHM6Ly96bnVueS5vcmcvCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6U3lzdGVtOjpDdXN0b21lclVzZXI6OkRCOwoKdXNlIHN0cmljdDsKdXNlIHdhcm5pbmdzOwoKdXNlIEtlcm5lbDo6U3lzdGVtOjpWYXJpYWJsZUNoZWNrIHF3KDphbGwpOwoKdXNlIENyeXB0OjpQYXNzd2RNRDUgcXcodW5peF9tZDVfY3J5cHQgYXBhY2hlX21kNV9jcnlwdCk7CnVzZSBEaWdlc3Q6OlNIQTsKCm91ciBAT2JqZWN0RGVwZW5kZW5jaWVzID0gKAogICAgJ0tlcm5lbDo6Q29uZmlnJywKICAgICdLZXJuZWw6Okxhbmd1YWdlJywKICAgICdLZXJuZWw6OlN5c3RlbTo6Q2FjaGUnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpDaGVja0l0ZW0nLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpEQicsCiAgICAnS2VybmVsOjpTeXN0ZW06OkRhdGVUaW1lJywKICAgICdLZXJuZWw6OlN5c3RlbTo6RHluYW1pY0ZpZWxkJywKICAgICdLZXJuZWw6OlN5c3RlbTo6RHluYW1pY0ZpZWxkOjpCYWNrZW5kJywKICAgICdLZXJuZWw6OlN5c3RlbTo6RW5jb2RlJywKICAgICdLZXJuZWw6OlN5c3RlbTo6TG9nJywKICAgICdLZXJuZWw6OlN5c3RlbTo6TWFpbicsCiAgICAnS2VybmVsOjpTeXN0ZW06OlZhbGlkJywKKTsKCnN1YiBuZXcgewogICAgbXkgKCAkVHlwZSwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGFsbG9jYXRlIG5ldyBoYXNoIGZvciBvYmplY3QKICAgIG15ICRTZWxmID0ge307CiAgICBibGVzcyggJFNlbGYsICRUeXBlICk7CgogICAgIyBjaGVjayBuZWVkZWQgZGF0YQogICAgZm9yIG15ICROZWVkZWQgKHF3KCBQcmVmZXJlbmNlc09iamVjdCBDdXN0b21lclVzZXJNYXAgKSkgewogICAgICAgICRTZWxmLT57JE5lZWRlZH0gPSAkUGFyYW17JE5lZWRlZH0gfHwgZGllICJHb3Qgbm8gJE5lZWRlZCEiOwogICAgfQoKICAgICMgZ2V0IGRhdGFiYXNlIG9iamVjdAogICAgJFNlbGYtPntEQk9iamVjdH0gPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6REInKTsKCiAgICAjIG1heCBzaG93biB1c2VyIHBlciBzZWFyY2ggbGlzdAogICAgJFNlbGYtPntVc2VyU2VhcmNoTGlzdExpbWl0fSA9ICRTZWxmLT57Q3VzdG9tZXJVc2VyTWFwfS0+e0N1c3RvbWVyVXNlclNlYXJjaExpc3RMaW1pdH0gfHwgMjUwOwoKICAgICMgY29uZmlnIG9wdGlvbnMKICAgICRTZWxmLT57Q3VzdG9tZXJUYWJsZX0gPSAkU2VsZi0+e0N1c3RvbWVyVXNlck1hcH0tPntQYXJhbXN9LT57VGFibGV9CiAgICAgICAgfHwgZGllICJOZWVkIEN1c3RvbWVyVXNlci0+UGFyYW1zLT5UYWJsZSBpbiBLZXJuZWwvQ29uZmlnLnBtISI7CiAgICAkU2VsZi0+e0N1c3RvbWVyS2V5fSA9ICRTZWxmLT57Q3VzdG9tZXJVc2VyTWFwfS0+e0N1c3RvbWVyS2V5fQogICAgICAgIHx8ICRTZWxmLT57Q3VzdG9tZXJVc2VyTWFwfS0+e0tleX0KICAgICAgICB8fCBkaWUgIk5lZWQgQ3VzdG9tZXJVc2VyLT5DdXN0b21lcktleSBpbiBLZXJuZWwvQ29uZmlnLnBtISI7CiAgICAkU2VsZi0+e0N1c3RvbWVySUR9ID0gJFNlbGYtPntDdXN0b21lclVzZXJNYXB9LT57Q3VzdG9tZXJJRH0KICAgICAgICB8fCBkaWUgIk5lZWQgQ3VzdG9tZXJVc2VyLT5DdXN0b21lcklEIGluIEtlcm5lbC9Db25maWcucG0hIjsKICAgICRTZWxmLT57UmVhZE9ubHl9ICAgICAgICAgICAgICAgICA9ICRTZWxmLT57Q3VzdG9tZXJVc2VyTWFwfS0+e1JlYWRPbmx5fTsKICAgICRTZWxmLT57RXhjbHVkZVByaW1hcnlDdXN0b21lcklEfSA9ICRTZWxmLT57Q3VzdG9tZXJVc2VyTWFwfS0+e0N1c3RvbWVyVXNlckV4Y2x1ZGVQcmltYXJ5Q3VzdG9tZXJJRH0gfHwgMDsKICAgICRTZWxmLT57U2VhcmNoUHJlZml4fSAgICAgICAgICAgICA9ICRTZWxmLT57Q3VzdG9tZXJVc2VyTWFwfS0+e0N1c3RvbWVyVXNlclNlYXJjaFByZWZpeH07CgogICAgaWYgKCAhZGVmaW5lZCAkU2VsZi0+e1NlYXJjaFByZWZpeH0gKSB7CiAgICAgICAgJFNlbGYtPntTZWFyY2hQcmVmaXh9ID0gJyc7CiAgICB9CiAgICAkU2VsZi0+e1NlYXJjaFN1ZmZpeH0gPSAkU2VsZi0+e0N1c3RvbWVyVXNlck1hcH0tPntDdXN0b21lclVzZXJTZWFyY2hTdWZmaXh9OwogICAgaWYgKCAhZGVmaW5lZCAkU2VsZi0+e1NlYXJjaFN1ZmZpeH0gKSB7CiAgICAgICAgJFNlbGYtPntTZWFyY2hTdWZmaXh9ID0gJyonOwogICAgfQoKICAgICMgY2hlY2sgaWYgQ3VzdG9tZXJLZXkgaXMgdmFyIG9yIGludAogICAgRU5UUlk6CiAgICBmb3IgbXkgJEVudHJ5ICggQHsgJFNlbGYtPntDdXN0b21lclVzZXJNYXB9LT57TWFwfSB9ICkgewogICAgICAgIGlmICggJEVudHJ5LT5bMF0gZXEgJ1VzZXJMb2dpbicgJiYgJEVudHJ5LT5bNV0gPX4gL15pbnQkL2kgKSB7CiAgICAgICAgICAgICRTZWxmLT57Q3VzdG9tZXJLZXlJbnRlZ2VyfSA9IDE7CiAgICAgICAgICAgIGxhc3QgRU5UUlk7CiAgICAgICAgfQogICAgfQoKICAgICMgc2V0IGNhY2hlIHR5cGUKICAgICRTZWxmLT57Q2FjaGVUeXBlfSA9ICdDdXN0b21lclVzZXInIC4gJFBhcmFte0NvdW50fTsKCiAgICAjIGNyZWF0ZSBjYWNoZSBvYmplY3QsIGJ1dCBvbmx5IGlmIENhY2hlVFRMIGlzIHNldCBpbiBjdXN0b21lciBjb25maWcKICAgIGlmICggJFNlbGYtPntDdXN0b21lclVzZXJNYXB9LT57Q2FjaGVUVEx9ICkgewogICAgICAgICRTZWxmLT57Q2FjaGVPYmplY3R9ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNhY2hlJyk7CiAgICB9CgogICAgIyBjcmVhdGUgbmV3IGRiIGNvbm5lY3QgaWYgRFNOIGlzIGdpdmVuCiAgICBpZiAoICRTZWxmLT57Q3VzdG9tZXJVc2VyTWFwfS0+e1BhcmFtc30tPntEU059ICkgewogICAgICAgICRTZWxmLT57REJPYmplY3R9ID0gS2VybmVsOjpTeXN0ZW06OkRCLT5uZXcoCiAgICAgICAgICAgIERhdGFiYXNlRFNOICA9PiAkU2VsZi0+e0N1c3RvbWVyVXNlck1hcH0tPntQYXJhbXN9LT57RFNOfSwKICAgICAgICAgICAgRGF0YWJhc2VVc2VyID0+ICRTZWxmLT57Q3VzdG9tZXJVc2VyTWFwfS0+e1BhcmFtc30tPntVc2VyfSwKICAgICAgICAgICAgRGF0YWJhc2VQdyAgID0+ICRTZWxmLT57Q3VzdG9tZXJVc2VyTWFwfS0+e1BhcmFtc30tPntQYXNzd29yZH0sCiAgICAgICAgICAgICV7ICRTZWxmLT57Q3VzdG9tZXJVc2VyTWFwfS0+e1BhcmFtc30gfSwKICAgICAgICApIHx8IGRpZSgnQ2FuXCd0IGNvbm5lY3QgdG8gZGF0YWJhc2UhJyk7CgogICAgICAgICMgcmVtZW1iZXIgdGhhdCB3ZSBoYXZlIHRoZSBEQk9iamVjdCBub3QgZnJvbSBwYXJlbnQgY2FsbAogICAgICAgICRTZWxmLT57Tm90UGFyZW50REJPYmplY3R9ID0gMTsKICAgIH0KCiAgICAjIHRoaXMgc2V0dGluZyBzcGVjaWZpZXMgaWYgdGhlIHRhYmxlIGhhcyB0aGUgY3JlYXRlX3RpbWUsCiAgICAjIGNyZWF0ZV9ieSwgY2hhbmdlX3RpbWUgYW5kIGNoYW5nZV9ieSBmaWVsZHMgb2YgT1RSUwogICAgJFNlbGYtPntGb3JlaWduREJ9ID0gJFNlbGYtPntDdXN0b21lclVzZXJNYXB9LT57UGFyYW1zfS0+e0ZvcmVpZ25EQn0gPyAxIDogMDsKCiAgICAjIGRlZmluZXMgaWYgdGhlIGRhdGFiYXNlIHNlYXJjaCB3aWxsIGJlIHBlcmZvcm1lbmQgY2FzZSBzZW5zaXRpdmUgKDEpIG9yIG5vdCAoMCkKICAgICRTZWxmLT57Q2FzZVNlbnNpdGl2ZX0gPSAkU2VsZi0+e0N1c3RvbWVyVXNlck1hcH0tPntQYXJhbXN9LT57U2VhcmNoQ2FzZVNlbnNpdGl2ZX0KICAgICAgICAvLyAkU2VsZi0+e0N1c3RvbWVyVXNlck1hcH0tPntQYXJhbXN9LT57Q2FzZVNlbnNpdGl2ZX0gfHwgMDsKCiAgICAjIGZldGNoIG5hbWVzIG9mIGNvbmZpZ3VyZWQgZHluYW1pYyBmaWVsZHMKICAgIG15IEBEeW5hbWljRmllbGRNYXBFbnRyaWVzID0gZ3JlcCB7ICRfLT5bNV0gZXEgJ2R5bmFtaWNfZmllbGQnIH0gQHsgJFNlbGYtPntDdXN0b21lclVzZXJNYXB9LT57TWFwfSB9OwogICAgJFNlbGYtPntDb25maWd1cmVkRHluYW1pY0ZpZWxkTmFtZXN9ID0geyBtYXAgeyAkXy0+WzJdID0+IDEgfSBARHluYW1pY0ZpZWxkTWFwRW50cmllcyB9OwoKICAgIHJldHVybiAkU2VsZjsKfQoKc3ViIEN1c3RvbWVyTmFtZSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBpZiAoICEkUGFyYW17VXNlckxvZ2lufSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ05lZWQgVXNlckxvZ2luIScsCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgIyBjaGVjayBjYWNoZQogICAgaWYgKCAkU2VsZi0+e0NhY2hlT2JqZWN0fSApIHsKICAgICAgICBteSAkTmFtZSA9ICRTZWxmLT57Q2FjaGVPYmplY3R9LT5HZXQoCiAgICAgICAgICAgIFR5cGUgPT4gJFNlbGYtPntDYWNoZVR5cGV9LAogICAgICAgICAgICBLZXkgID0+ICJDdXN0b21lck5hbWU6OiRQYXJhbXtVc2VyTG9naW59IiwKICAgICAgICApOwogICAgICAgIHJldHVybiAkTmFtZSBpZiBkZWZpbmVkICROYW1lOwogICAgfQoKICAgIG15ICRDdXN0b21lclVzZXJOYW1lRmllbGRzID0gJFNlbGYtPntDdXN0b21lclVzZXJNYXB9LT57Q3VzdG9tZXJVc2VyTmFtZUZpZWxkc307CiAgICBpZiAoICFJc0FycmF5UmVmV2l0aERhdGEoJEN1c3RvbWVyVXNlck5hbWVGaWVsZHMpICkgewogICAgICAgICRDdXN0b21lclVzZXJOYW1lRmllbGRzID0gWyAnZmlyc3RfbmFtZScsICdsYXN0X25hbWUnLCBdOwogICAgfQoKICAgICMgcmVtb3ZlIGR5bmFtaWMgZmllbGQgbmFtZXMgdGhhdCBhcmUgY29uZmlndXJlZCBpbiBDdXN0b21lclVzZXJOYW1lRmllbGRzCiAgICAjIGFzIHRoZXkgY2Fubm90IGJlIGhhbmRsZWQgaGVyZQogICAgbXkgQEN1c3RvbWVyVXNlck5hbWVGaWVsZHNXaXRob3V0RHluYW1pY0ZpZWxkcwogICAgICAgID0gZ3JlcCB7ICFleGlzdHMgJFNlbGYtPntDb25maWd1cmVkRHluYW1pY0ZpZWxkTmFtZXN9LT57JF99IH0gQHskQ3VzdG9tZXJVc2VyTmFtZUZpZWxkc307CgogICAgIyBidWlsZCBTUUwgc3RyaW5nIDEvMgogICAgbXkgJFNRTCA9ICJTRUxFQ1QgIjsKCiAgICAkU1FMIC49IGpvaW4oICIsICIsIEBDdXN0b21lclVzZXJOYW1lRmllbGRzV2l0aG91dER5bmFtaWNGaWVsZHMgKTsKICAgICRTUUwgLj0gIiBGUk9NICRTZWxmLT57Q3VzdG9tZXJUYWJsZX0gV0hFUkUgIjsKCiAgICAjIGNoZWNrIEN1c3RvbWVyS2V5IHR5cGUKICAgIG15ICRVc2VyTG9naW4gPSAkUGFyYW17VXNlckxvZ2lufTsKICAgIGlmICggJFNlbGYtPntDYXNlU2Vuc2l0aXZlfSApIHsKICAgICAgICAkU1FMIC49ICIkU2VsZi0+e0N1c3RvbWVyS2V5fSA9ID8iOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgJFNRTCAuPSAiTE9XRVIoJFNlbGYtPntDdXN0b21lcktleX0pID0gTE9XRVIoPykiOwogICAgfQoKICAgIG15ICVOYW1lUGFydHM7CgogICAgIyBnZXQgZGF0YSBmcm9tIGN1c3RvbWVyIHVzZXIgdGFibGUKICAgIHJldHVybiBpZiAhJFNlbGYtPntEQk9iamVjdH0tPlByZXBhcmUoCiAgICAgICAgU1FMICAgPT4gJFNRTCwKICAgICAgICBCaW5kICA9PiBbIFwkUGFyYW17VXNlckxvZ2lufSBdLAogICAgICAgIExpbWl0ID0+IDEsCiAgICApOwoKICAgIG15ICRGaWVsZENvdW50ZXIgPSAwOwogICAgd2hpbGUgKCBteSBAUm93ID0gJFNlbGYtPntEQk9iamVjdH0tPkZldGNocm93QXJyYXkoKSApIHsKICAgICAgICBmb3IgbXkgJEZpZWxkIChAUm93KSB7CiAgICAgICAgICAgICROYW1lUGFydHN7ICRDdXN0b21lclVzZXJOYW1lRmllbGRzV2l0aG91dER5bmFtaWNGaWVsZHNbJEZpZWxkQ291bnRlcl0gfSA9ICRGaWVsZDsKICAgICAgICAgICAgJEZpZWxkQ291bnRlcisrOwogICAgICAgIH0KICAgIH0KCiAgICAjIGZldGNoIGR5bmFtaWMgZmllbGQgdmFsdWVzLCBpZiBjb25maWd1cmVkCiAgICBteSBARHluYW1pY0ZpZWxkQ3VzdG9tZXJVc2VyTmFtZUZpZWxkcwogICAgICAgID0gZ3JlcCB7IGV4aXN0cyAkU2VsZi0+e0NvbmZpZ3VyZWREeW5hbWljRmllbGROYW1lc30tPnskX30gfSBAeyRDdXN0b21lclVzZXJOYW1lRmllbGRzfTsKICAgIGlmIChARHluYW1pY0ZpZWxkQ3VzdG9tZXJVc2VyTmFtZUZpZWxkcykgewogICAgICAgIG15ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkR5bmFtaWNGaWVsZDo6QmFja2VuZCcpOwoKICAgICAgICBEWU5BTUlDRklFTEROQU1FOgogICAgICAgIGZvciBteSAkRHluYW1pY0ZpZWxkTmFtZSAoQER5bmFtaWNGaWVsZEN1c3RvbWVyVXNlck5hbWVGaWVsZHMpIHsKICAgICAgICAgICAgbXkgJER5bmFtaWNGaWVsZENvbmZpZyA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEeW5hbWljRmllbGQnKS0+RHluYW1pY0ZpZWxkR2V0KAogICAgICAgICAgICAgICAgTmFtZSA9PiAkRHluYW1pY0ZpZWxkTmFtZSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgbmV4dCBEWU5BTUlDRklFTEROQU1FIGlmICFJc0hhc2hSZWZXaXRoRGF0YSgkRHluYW1pY0ZpZWxkQ29uZmlnKTsKCiAgICAgICAgICAgIG15ICRWYWx1ZSA9ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0LT5WYWx1ZUdldCgKICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZENvbmZpZyA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnLAogICAgICAgICAgICAgICAgT2JqZWN0TmFtZSAgICAgICAgID0+ICRQYXJhbXtVc2VyTG9naW59LAogICAgICAgICAgICApOwoKICAgICAgICAgICAgbmV4dCBEWU5BTUlDRklFTEROQU1FIGlmICFkZWZpbmVkICRWYWx1ZTsKCiAgICAgICAgICAgIGlmICggIUlzQXJyYXlSZWZXaXRoRGF0YSgkVmFsdWUpICkgewogICAgICAgICAgICAgICAgJFZhbHVlID0gWyRWYWx1ZV07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG15IEBSZW5kZXJlZFZhbHVlczsKCiAgICAgICAgICAgIFZBTFVFOgogICAgICAgICAgICBmb3IgbXkgJEN1cnJlbnRWYWx1ZSAoIEB7JFZhbHVlfSApIHsKICAgICAgICAgICAgICAgIG5leHQgVkFMVUUgaWYgIWRlZmluZWQgJEN1cnJlbnRWYWx1ZSB8fCAhbGVuZ3RoICRDdXJyZW50VmFsdWU7CgogICAgICAgICAgICAgICAgbXkgJFJlbmRlcmVkVmFsdWUgPSAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdC0+UmVhZGFibGVWYWx1ZVJlbmRlcigKICAgICAgICAgICAgICAgICAgICBEeW5hbWljRmllbGRDb25maWcgPT4gJER5bmFtaWNGaWVsZENvbmZpZywKICAgICAgICAgICAgICAgICAgICBWYWx1ZSAgICAgICAgICAgICAgPT4gJEN1cnJlbnRWYWx1ZSwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgbmV4dCBWQUxVRSBpZiAhSXNIYXNoUmVmV2l0aERhdGEoJFJlbmRlcmVkVmFsdWUpIHx8ICFkZWZpbmVkICRSZW5kZXJlZFZhbHVlLT57VmFsdWV9OwoKICAgICAgICAgICAgICAgIHB1c2ggQFJlbmRlcmVkVmFsdWVzLCAkUmVuZGVyZWRWYWx1ZS0+e1ZhbHVlfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJE5hbWVQYXJ0c3skRHluYW1pY0ZpZWxkTmFtZX0gPSBqb2luICcgJywgQFJlbmRlcmVkVmFsdWVzOwogICAgICAgIH0KICAgIH0KCiAgICAjIGFzc2VtYmxlIG5hbWUKICAgIG15IEBOYW1lUGFydHM7CiAgICBDVVNUT01FUlVTRVJOQU1FRklFTEQ6CiAgICBmb3IgbXkgJEN1c3RvbWVyVXNlck5hbWVGaWVsZCAoIEB7JEN1c3RvbWVyVXNlck5hbWVGaWVsZHN9ICkgewogICAgICAgIG5leHQgQ1VTVE9NRVJVU0VSTkFNRUZJRUxECiAgICAgICAgICAgIGlmICFleGlzdHMgJE5hbWVQYXJ0c3skQ3VzdG9tZXJVc2VyTmFtZUZpZWxkfQogICAgICAgICAgICB8fCAhZGVmaW5lZCAkTmFtZVBhcnRzeyRDdXN0b21lclVzZXJOYW1lRmllbGR9CiAgICAgICAgICAgIHx8ICFsZW5ndGggJE5hbWVQYXJ0c3skQ3VzdG9tZXJVc2VyTmFtZUZpZWxkfTsKICAgICAgICBwdXNoIEBOYW1lUGFydHMsICROYW1lUGFydHN7JEN1c3RvbWVyVXNlck5hbWVGaWVsZH07CiAgICB9CgogICAgbXkgJEpvaW5DaGFyYWN0ZXIgPSAkU2VsZi0+e0N1c3RvbWVyVXNlck1hcH0tPntDdXN0b21lclVzZXJOYW1lRmllbGRzSm9pbn0gLy8gJyAnOwogICAgbXkgJE5hbWUgICAgICAgICAgPSBqb2luICRKb2luQ2hhcmFjdGVyLCBATmFtZVBhcnRzOwoKICAgICMgY2FjaGUgcmVxdWVzdAogICAgaWYgKCAkU2VsZi0+e0NhY2hlT2JqZWN0fSApIHsKICAgICAgICAkU2VsZi0+e0NhY2hlT2JqZWN0fS0+U2V0KAogICAgICAgICAgICBUeXBlICA9PiAkU2VsZi0+e0NhY2hlVHlwZX0sCiAgICAgICAgICAgIEtleSAgID0+ICJDdXN0b21lck5hbWU6OiRQYXJhbXtVc2VyTG9naW59IiwKICAgICAgICAgICAgVmFsdWUgPT4gJE5hbWUsCiAgICAgICAgICAgIFRUTCAgID0+ICRTZWxmLT57Q3VzdG9tZXJVc2VyTWFwfS0+e0NhY2hlVFRMfSwKICAgICAgICApOwogICAgfQogICAgcmV0dXJuICROYW1lOwp9CgpzdWIgQ3VzdG9tZXJTZWFyY2ggewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAlVXNlcnM7CiAgICBteSAkVmFsaWQgPSBkZWZpbmVkICRQYXJhbXtWYWxpZH0gPyAkUGFyYW17VmFsaWR9IDogMTsKCiAgICBteSAkTXVsdGlUZW5hbmN5ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpDb25maWcnKS0+R2V0KCdNdWx0aVRlbmFuY3knKTsKCiAgICAjIGNoZWNrIG5lZWRlZCBzdHVmZgogICAgaWYgKAogICAgICAgICEkUGFyYW17U2VhcmNofQogICAgICAgICYmICEkUGFyYW17VXNlckxvZ2lufQogICAgICAgICYmICEkUGFyYW17UG9zdE1hc3RlclNlYXJjaH0KICAgICAgICAmJiAhJFBhcmFte0N1c3RvbWVySUR9CiAgICAgICAgJiYgISRQYXJhbXtDdXN0b21lcklEUmF3fQogICAgICAgICkKICAgIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ05lZWQgU2VhcmNoLCBVc2VyTG9naW4sIFBvc3RNYXN0ZXJTZWFyY2gsIEN1c3RvbWVySURSYXcgb3IgQ3VzdG9tZXJJRCEnLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKCAkTXVsdGlUZW5hbmN5ICYmICEkUGFyYW17VXNlcklEfSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJyBOZWVkIFVzZXJJRCEnLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgY2hlY2sgY2FjaGUKICAgIG15ICRDYWNoZUtleSA9IGpvaW4gJzo6JywgbWFwIHsgJF8gLiAnPScgLiAkUGFyYW17JF99IH0gc29ydCBrZXlzICVQYXJhbTsKCiAgICBpZiAoICRTZWxmLT57Q2FjaGVPYmplY3R9ICkgewogICAgICAgIG15ICRVc2VycyA9ICRTZWxmLT57Q2FjaGVPYmplY3R9LT5HZXQoCiAgICAgICAgICAgIFR5cGUgPT4gJFNlbGYtPntDYWNoZVR5cGV9IC4gJ19DdXN0b21lclNlYXJjaCcsCiAgICAgICAgICAgIEtleSAgPT4gJENhY2hlS2V5LAogICAgICAgICk7CiAgICAgICAgcmV0dXJuICV7JFVzZXJzfSBpZiByZWYgJFVzZXJzIGVxICdIQVNIJzsKICAgIH0KCiAgICBteSAkQ3VzdG9tZXJVc2VyTGlzdEZpZWxkcyA9ICRTZWxmLT57Q3VzdG9tZXJVc2VyTWFwfS0+e0N1c3RvbWVyVXNlckxpc3RGaWVsZHN9OwogICAgaWYgKCAhSXNBcnJheVJlZldpdGhEYXRhKCRDdXN0b21lclVzZXJMaXN0RmllbGRzKSApIHsKICAgICAgICAkQ3VzdG9tZXJVc2VyTGlzdEZpZWxkcyA9IFsgJ2ZpcnN0X25hbWUnLCAnbGFzdF9uYW1lJywgJ2VtYWlsJywgXTsKICAgIH0KCiAgICAjIHJlbW92ZSBkeW5hbWljIGZpZWxkIG5hbWVzIHRoYXQgYXJlIGNvbmZpZ3VyZWQgaW4gQ3VzdG9tZXJVc2VyTGlzdEZpZWxkcwogICAgIyBhcyB0aGV5IGNhbm5vdCBiZSBoYW5kbGVkIGhlcmUKICAgIG15IEBDdXN0b21lclVzZXJMaXN0RmllbGRzV2l0aG91dER5bmFtaWNGaWVsZHMKICAgICAgICA9IGdyZXAgeyAhZXhpc3RzICRTZWxmLT57Q29uZmlndXJlZER5bmFtaWNGaWVsZE5hbWVzfS0+eyRffSB9IEB7JEN1c3RvbWVyVXNlckxpc3RGaWVsZHN9OwoKICAgICMgYnVpbGQgU1FMIHN0cmluZyAxLzIKICAgIG15ICRTUUwgPSAiU0VMRUNUIERJU1RJTkNUICRTZWxmLT57Q3VzdG9tZXJLZXl9ICI7CiAgICBteSBAQmluZDsKICAgICRTUUwgLj0gJywgJyAuICggam9pbiAnLCAnLCBAQ3VzdG9tZXJVc2VyTGlzdEZpZWxkc1dpdGhvdXREeW5hbWljRmllbGRzICk7CgogICAgIyBnZXQgbGlrZSBlc2NhcGUgc3RyaW5nIG5lZWRlZCBmb3Igc29tZSBkYXRhYmFzZXMgKGUuZy4gb3JhY2xlKQogICAgbXkgJExpa2VFc2NhcGVTdHJpbmcgPSAkU2VsZi0+e0RCT2JqZWN0fS0+R2V0RGF0YWJhc2VGdW5jdGlvbignTGlrZUVzY2FwZVN0cmluZycpOwoKICAgICMgYnVpbGQgU1FMIHN0cmluZyAyLzIKICAgIGlmICgkTXVsdGlUZW5hbmN5KSAgewogICAgICAgICMgZGlzYW1iaWd1YXRlIGRhdGFiYXNlIGNvbHVtbnMKICAgICAgICBpZiAoJFNlbGYtPntDdXN0b21lcklEfSBlcSAnY3VzdG9tZXJfaWQnKSB7CiAgICAgICAgICAgICRTZWxmLT57Q3VzdG9tZXJJRH0gPSAnY2MuY3VzdG9tZXJfaWQnOwogICAgICAgIH0KCiAgICAgICAgJFNRTCAuPSAiIEZST00gJFNlbGYtPntDdXN0b21lclRhYmxlfSBBUyBjdQogICAgICAgICAgICBMRUZUIEpPSU4gY3VzdG9tZXJfdXNlcl9jdXN0b21lciBBUyBjdWMgT04gY3VjLnVzZXJfaWQgPSBjdS5sb2dpbgogICAgICAgICAgICBKT0lOIGN1c3RvbWVyX2NvbXBhbnkgQVMgY2MgT04KICAgICAgICAgICAgICAgICAgICBjYy5jdXN0b21lcl9pZCA9IGN1LmN1c3RvbWVyX2lkCiAgICAgICAgICAgICAgICBPUgogICAgICAgICAgICAgICAgICAgIGNjLmN1c3RvbWVyX2lkID0gY3VjLmN1c3RvbWVyX2lkCiAgICAgICAgICAgIEpPSU4gZ3JvdXBfY3VzdG9tZXIgQVMgZ2MgT04gZ2MuY3VzdG9tZXJfaWQgPSBjYy5jdXN0b21lcl9pZAogICAgICAgICAgICBKT0lOIGdyb3VwX3JvbGUgQVMgZ3IgT04gZ3IuZ3JvdXBfaWQgPSBnYy5ncm91cF9pZAogICAgICAgICAgICBKT0lOIHJvbGVzIEFTIHIgT04gci5pZCA9IGdyLnJvbGVfaWQKICAgICAgICAgICAgSk9JTiByb2xlX3VzZXIgQVMgcnUgT04gcnUucm9sZV9pZCA9IHIuaWQKICAgICAgICAgICAgTEVGVCBKT0lOIGdyb3VwX3VzZXIgYXMgZ3UgT04gZ3UuZ3JvdXBfaWQgPSBnYy5ncm91cF9pZAogICAgICAgIFdIRVJFCiAgICAgICAgICAgICgKICAgICAgICAgICAgICAgICgKICAgICAgICAgICAgICAgICAgICBydS51c2VyX2lkID0gJFBhcmFte1VzZXJJRH0KICAgICAgICAgICAgICAgICAgICBBTkQgZ3IucGVybWlzc2lvbl9rZXkgPSAncncnCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBPUgogICAgICAgICAgICAgICAgKAogICAgICAgICAgICAgICAgICAgIGd1LnVzZXJfaWQgPSAkUGFyYW17VXNlcklEfQogICAgICAgICAgICAgICAgICAgIEFORCBndS5wZXJtaXNzaW9uX2tleSA9ICdydycKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgKQogICAgICAgICAgICBBTkQgY3UudmFsaWRfaWQgPSAxCiAgICAgICAgICAgIEFORCBjYy52YWxpZF9pZCA9IDEKICAgICAgICAgICAgQU5EIHIudmFsaWRfaWQgPSAxCiAgICAgICAgICAgIEFORAogICAgICAgICI7CiAgICB9IGVsc2UgewogICAgICAgICRTUUwgLj0gIiBGUk9NICRTZWxmLT57Q3VzdG9tZXJUYWJsZX0gV0hFUkUgIjsKICAgIH0KICAgIGlmICggJFBhcmFte1NlYXJjaH0gKSB7CiAgICAgICAgaWYgKCAhJFNlbGYtPntDdXN0b21lclVzZXJNYXB9LT57Q3VzdG9tZXJVc2VyU2VhcmNoRmllbGRzfSApIHsKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSA9PgogICAgICAgICAgICAgICAgICAgICJOZWVkIEN1c3RvbWVyVXNlclNlYXJjaEZpZWxkcyBpbiBDdXN0b21lclVzZXIgY29uZmlnLCB1bmFibGUgdG8gc2VhcmNoIGZvciAnJFBhcmFte1NlYXJjaH0nISIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIG15ICRTZWFyY2ggPSAkU2VsZi0+e0RCT2JqZWN0fS0+UXVlcnlTdHJpbmdFc2NhcGUoIFF1ZXJ5U3RyaW5nID0+ICRQYXJhbXtTZWFyY2h9ICk7CgogICAgICAgICMgcmVtb3ZlIGR5bmFtaWMgZmllbGQgbmFtZXMgdGhhdCBhcmUgY29uZmlndXJlZCBpbiBDdXN0b21lclVzZXJTZWFyY2hGaWVsZHMKICAgICAgICAjIGFzIHRoZXkgY2Fubm90IGJlIHJldHJpZXZlZCBoZXJlCiAgICAgICAgbXkgQEN1c3RvbWVyVXNlclNlYXJjaEZpZWxkcyA9IGdyZXAgeyAhZXhpc3RzICRTZWxmLT57Q29uZmlndXJlZER5bmFtaWNGaWVsZE5hbWVzfS0+eyRffSB9CiAgICAgICAgICAgIEB7ICRTZWxmLT57Q3VzdG9tZXJVc2VyTWFwfS0+e0N1c3RvbWVyVXNlclNlYXJjaEZpZWxkc30gfTsKCiAgICAgICAgaWYgKCAkUGFyYW17Q3VzdG9tZXJVc2VyT25seX0gKSB7CiAgICAgICAgICAgIEBDdXN0b21lclVzZXJTZWFyY2hGaWVsZHMgPSBncmVwIHsgJF8gbmUgJ2N1c3RvbWVyX2lkJyB9IEBDdXN0b21lclVzZXJTZWFyY2hGaWVsZHM7CiAgICAgICAgfQoKICAgICAgICBpZiAoJE11bHRpVGVuYW5jeSkgIHsKICAgICAgICAgICAgIyBkaXNhbWJpZ3VhdGUgZGFiYWJhc2UgY29sdW1ucwogICAgICAgICAgICBzL1xBbG9naW5cWi9jdS5sb2dpbi8gZm9yIEBDdXN0b21lclVzZXJTZWFyY2hGaWVsZHM7CiAgICAgICAgICAgIHMvXEFjdXN0b21lcl9pZFxaL2N1LmN1c3RvbWVyX2lkLyBmb3IgQEN1c3RvbWVyVXNlclNlYXJjaEZpZWxkczsKICAgICAgICB9CgogICAgICAgIG15ICVRdWVyeUNvbmRpdGlvbiA9ICRTZWxmLT57REJPYmplY3R9LT5RdWVyeUNvbmRpdGlvbigKICAgICAgICAgICAgS2V5ICAgICAgICAgICA9PiBcQEN1c3RvbWVyVXNlclNlYXJjaEZpZWxkcywgICAgIyRTZWxmLT57Q3VzdG9tZXJVc2VyTWFwfS0+e0N1c3RvbWVyVXNlclNlYXJjaEZpZWxkc30sCiAgICAgICAgICAgIFZhbHVlICAgICAgICAgPT4gJFNlYXJjaCwKICAgICAgICAgICAgU2VhcmNoUHJlZml4ICA9PiAkU2VsZi0+e1NlYXJjaFByZWZpeH0sCiAgICAgICAgICAgIFNlYXJjaFN1ZmZpeCAgPT4gJFNlbGYtPntTZWFyY2hTdWZmaXh9LAogICAgICAgICAgICBDYXNlU2Vuc2l0aXZlID0+ICRTZWxmLT57Q2FzZVNlbnNpdGl2ZX0sCiAgICAgICAgICAgIEJpbmRNb2RlICAgICAgPT4gMSwKICAgICAgICApOwoKICAgICAgICAkU1FMIC49ICRRdWVyeUNvbmRpdGlvbntTUUx9OwogICAgICAgIHB1c2ggQEJpbmQsIEB7ICRRdWVyeUNvbmRpdGlvbntWYWx1ZXN9IH07CgogICAgICAgICRTUUwgLj0gJyAnOwogICAgfQogICAgZWxzaWYgKCAkUGFyYW17UG9zdE1hc3RlclNlYXJjaH0gKSB7CiAgICAgICAgaWYgKCAkU2VsZi0+e0N1c3RvbWVyVXNlck1hcH0tPntDdXN0b21lclVzZXJQb3N0TWFzdGVyU2VhcmNoRmllbGRzfSApIHsKCiAgICAgICAgICAgICMgcmVtb3ZlIGR5bmFtaWMgZmllbGQgbmFtZXMgdGhhdCBhcmUgY29uZmlndXJlZCBpbiBDdXN0b21lclVzZXJQb3N0TWFzdGVyU2VhcmNoRmllbGRzCiAgICAgICAgICAgICMgYXMgdGhleSBjYW5ub3QgYmUgcmV0cmlldmVkIGhlcmUKICAgICAgICAgICAgbXkgQEN1c3RvbWVyVXNlclBvc3RNYXN0ZXJTZWFyY2hGaWVsZHMgPSBncmVwIHsgIWV4aXN0cyAkU2VsZi0+e0NvbmZpZ3VyZWREeW5hbWljRmllbGROYW1lc30tPnskX30gfQogICAgICAgICAgICAgICAgQHsgJFNlbGYtPntDdXN0b21lclVzZXJNYXB9LT57Q3VzdG9tZXJVc2VyUG9zdE1hc3RlclNlYXJjaEZpZWxkc30gfTsKCiAgICAgICAgICAgIG15ICRTUUxFeHQgPSAnJzsKCiAgICAgICAgICAgICMgZm9yIG15ICRGaWVsZCAoIEB7ICRTZWxmLT57Q3VzdG9tZXJVc2VyTWFwfS0+e0N1c3RvbWVyVXNlclBvc3RNYXN0ZXJTZWFyY2hGaWVsZHN9IH0gKSB7CiAgICAgICAgICAgIGZvciBteSAkRmllbGQgKEBDdXN0b21lclVzZXJQb3N0TWFzdGVyU2VhcmNoRmllbGRzKSB7CiAgICAgICAgICAgICAgICBpZiAoJFNRTEV4dCkgewogICAgICAgICAgICAgICAgICAgICRTUUxFeHQgLj0gJyBPUiAnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbXkgJFBvc3RNYXN0ZXJTZWFyY2ggPSAkU2VsZi0+e0RCT2JqZWN0fS0+UXVvdGUoICRQYXJhbXtQb3N0TWFzdGVyU2VhcmNofSApOwogICAgICAgICAgICAgICAgcHVzaCBAQmluZCwgXCRQb3N0TWFzdGVyU2VhcmNoOwoKICAgICAgICAgICAgICAgIGlmICggJFNlbGYtPntDYXNlU2Vuc2l0aXZlfSApIHsKICAgICAgICAgICAgICAgICAgICAkU1FMRXh0IC49ICIgJEZpZWxkID0gPyAiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJFNRTEV4dCAuPSAiIExPV0VSKCRGaWVsZCkgPSBMT1dFUig/KSAiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgICRTUUwgLj0gJFNRTEV4dDsKICAgICAgICB9CiAgICB9CiAgICBlbHNpZiAoICRQYXJhbXtVc2VyTG9naW59ICkgewoKICAgICAgICBteSAkVXNlckxvZ2luID0gJFBhcmFte1VzZXJMb2dpbn07CgogICAgICAgICMgY2hlY2sgQ3VzdG9tZXJLZXkgdHlwZQogICAgICAgIGlmICggJFNlbGYtPntDdXN0b21lcktleUludGVnZXJ9ICkgewoKICAgICAgICAgICAgIyByZXR1cm4gaWYgbG9naW4gaXMgbm8gaW50ZWdlcgogICAgICAgICAgICByZXR1cm4gaWYgJFBhcmFte1VzZXJMb2dpbn0gIX4gL14oXCt8XC18KVxkezEsMTZ9JC87CgogICAgICAgICAgICAkU1FMIC49ICIkU2VsZi0+e0N1c3RvbWVyS2V5fSA9ID8iOwogICAgICAgICAgICBwdXNoIEBCaW5kLCBcJFVzZXJMb2dpbjsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRVc2VyTG9naW4gPSAnJScgLiAkU2VsZi0+e0RCT2JqZWN0fS0+UXVvdGUoICRVc2VyTG9naW4sICdMaWtlJyApIC4gJyUnOwogICAgICAgICAgICAkVXNlckxvZ2luID1+IHMvXCovJS9nOwogICAgICAgICAgICBwdXNoIEBCaW5kLCBcJFVzZXJMb2dpbjsKICAgICAgICAgICAgaWYgKCAkU2VsZi0+e0Nhc2VTZW5zaXRpdmV9ICkgewogICAgICAgICAgICAgICAgJFNRTCAuPSAiJFNlbGYtPntDdXN0b21lcktleX0gTElLRSA/ICRMaWtlRXNjYXBlU3RyaW5nIjsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRTUUwgLj0gIkxPV0VSKCRTZWxmLT57Q3VzdG9tZXJLZXl9KSBMSUtFIExPV0VSKD8pICRMaWtlRXNjYXBlU3RyaW5nIjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIGVsc2lmICggJFBhcmFte0N1c3RvbWVySUR9ICkgewoKICAgICAgICBteSAkQ3VzdG9tZXJJRCA9ICRTZWxmLT57REJPYmplY3R9LT5RdW90ZSggJFBhcmFte0N1c3RvbWVySUR9LCAnTGlrZScgKTsKICAgICAgICAkQ3VzdG9tZXJJRCA9fiBzL1wqLyUvZzsKICAgICAgICBwdXNoIEBCaW5kLCBcJEN1c3RvbWVySUQ7CgogICAgICAgIGlmICggJFNlbGYtPntDYXNlU2Vuc2l0aXZlfSApIHsKICAgICAgICAgICAgJFNRTCAuPSAiJFNlbGYtPntDdXN0b21lcklEfSBMSUtFID8gJExpa2VFc2NhcGVTdHJpbmciOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgJFNRTCAuPSAiTE9XRVIoJFNlbGYtPntDdXN0b21lcklEfSkgTElLRSBMT1dFUig/KSAkTGlrZUVzY2FwZVN0cmluZyI7CiAgICAgICAgfQogICAgfQogICAgZWxzaWYgKCAkUGFyYW17Q3VzdG9tZXJJRFJhd30gKSB7CgogICAgICAgIHB1c2ggQEJpbmQsIFwkUGFyYW17Q3VzdG9tZXJJRFJhd307CgogICAgICAgIGlmICggJFNlbGYtPntDYXNlU2Vuc2l0aXZlfSApIHsKICAgICAgICAgICAgJFNRTCAuPSAiJFNlbGYtPntDdXN0b21lcklEfSA9ID8gIjsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRTUUwgLj0gIkxPV0VSKCRTZWxmLT57Q3VzdG9tZXJJRH0pID0gTE9XRVIoPykgIjsKICAgICAgICB9CiAgICB9CgogICAgIyBhZGQgdmFsaWQgb3B0aW9uCiAgICBpZiAoICRTZWxmLT57Q3VzdG9tZXJVc2VyTWFwfS0+e0N1c3RvbWVyVmFsaWR9ICYmICRWYWxpZCAmJiAhJE11bHRpVGVuYW5jeSkgewoKICAgICAgICAjIGdldCB2YWxpZCBvYmplY3QKICAgICAgICBteSAkVmFsaWRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VmFsaWQnKTsKCiAgICAgICAgJFNRTCAuPSAnIEFORCAnCiAgICAgICAgICAgIC4gJFNlbGYtPntDdXN0b21lclVzZXJNYXB9LT57Q3VzdG9tZXJWYWxpZH0KICAgICAgICAgICAgLiAnIElOICgnIC4gam9pbiggJywgJywgJFZhbGlkT2JqZWN0LT5WYWxpZElEc0dldCgpICkgLiAnKSAnOwogICAgfQoKICAgICMgZHluYW1pYyBmaWVsZCBoYW5kbGluZwogICAgbXkgJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6RHluYW1pY0ZpZWxkOjpCYWNrZW5kJyk7CgogICAgbXkgJER5bmFtaWNGaWVsZENvbmZpZ3MgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6RHluYW1pY0ZpZWxkJyktPkR5bmFtaWNGaWVsZExpc3RHZXQoCiAgICAgICAgT2JqZWN0VHlwZSA9PiAnQ3VzdG9tZXJVc2VyJywKICAgICAgICBWYWxpZCAgICAgID0+IDEsCiAgICApOwogICAgbXkgJUR5bmFtaWNGaWVsZENvbmZpZ3NCeU5hbWUgPSBtYXAgeyAkXy0+e05hbWV9ID0+ICRfIH0gQHskRHluYW1pY0ZpZWxkQ29uZmlnc307CgogICAgbXkgQEN1c3RvbWVyVXNlckxpc3RGaWVsZHNEeW5hbWljRmllbGRzCiAgICAgICAgPSBncmVwIHsgZXhpc3RzICRTZWxmLT57Q29uZmlndXJlZER5bmFtaWNGaWVsZE5hbWVzfS0+eyRffSB9IEB7JEN1c3RvbWVyVXNlckxpc3RGaWVsZHN9OwoKICAgICMgZ2V0IGRhdGEgZnJvbSBjdXN0b21lciB1c2VyIHRhYmxlCiAgICByZXR1cm4gaWYgISRTZWxmLT57REJPYmplY3R9LT5QcmVwYXJlKAogICAgICAgIFNRTCAgID0+ICRTUUwsCiAgICAgICAgQmluZCAgPT4gXEBCaW5kLAogICAgICAgIExpbWl0ID0+ICRQYXJhbXtMaW1pdH0gfHwgJFNlbGYtPntVc2VyU2VhcmNoTGlzdExpbWl0fSwKICAgICk7CgogICAgbXkgQEN1c3RvbWVyVXNlckRhdGE7CiAgICB3aGlsZSAoIG15IEBSb3cgPSAkU2VsZi0+e0RCT2JqZWN0fS0+RmV0Y2hyb3dBcnJheSgpICkgewogICAgICAgIHB1c2ggQEN1c3RvbWVyVXNlckRhdGEsIFtAUm93XTsKICAgIH0KCiAgICBDVVNUT01FUlVTRVJEQVRBOgogICAgZm9yIG15ICRDdXN0b21lclVzZXJEYXRhIChAQ3VzdG9tZXJVc2VyRGF0YSkgewogICAgICAgIG15ICRDdXN0b21lcktleSA9IHNoaWZ0IEB7JEN1c3RvbWVyVXNlckRhdGF9OwogICAgICAgIG5leHQgQ1VTVE9NRVJVU0VSREFUQSBpZiAkVXNlcnN7JEN1c3RvbWVyS2V5fTsKCiAgICAgICAgbXkgJVVzZXJTdHJpbmdQYXJ0czsKCiAgICAgICAgbXkgJEZpZWxkQ291bnRlciA9IDA7CiAgICAgICAgZm9yIG15ICRGaWVsZCAoIEB7JEN1c3RvbWVyVXNlckRhdGF9ICkgewogICAgICAgICAgICAkVXNlclN0cmluZ1BhcnRzeyAkQ3VzdG9tZXJVc2VyTGlzdEZpZWxkc1dpdGhvdXREeW5hbWljRmllbGRzWyRGaWVsZENvdW50ZXJdIH0gPSAkRmllbGQ7CiAgICAgICAgICAgICRGaWVsZENvdW50ZXIrKzsKICAgICAgICB9CgogICAgICAgICMgZmV0Y2ggZHluYW1pYyBmaWVsZCB2YWx1ZXMsIGlmIGNvbmZpZ3VyZWQKICAgICAgICBpZiAoQEN1c3RvbWVyVXNlckxpc3RGaWVsZHNEeW5hbWljRmllbGRzKSB7CiAgICAgICAgICAgIERZTkFNSUNGSUVMRE5BTUU6CiAgICAgICAgICAgIGZvciBteSAkRHluYW1pY0ZpZWxkTmFtZSAoQEN1c3RvbWVyVXNlckxpc3RGaWVsZHNEeW5hbWljRmllbGRzKSB7CiAgICAgICAgICAgICAgICBuZXh0IERZTkFNSUNGSUVMRE5BTUUgaWYgIWV4aXN0cyAkRHluYW1pY0ZpZWxkQ29uZmlnc0J5TmFtZXskRHluYW1pY0ZpZWxkTmFtZX07CgogICAgICAgICAgICAgICAgbXkgJFZhbHVlID0gJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QtPlZhbHVlR2V0KAogICAgICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZENvbmZpZyA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnc0J5TmFtZXskRHluYW1pY0ZpZWxkTmFtZX0sCiAgICAgICAgICAgICAgICAgICAgT2JqZWN0TmFtZSAgICAgICAgID0+ICRDdXN0b21lcktleSwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgbmV4dCBEWU5BTUlDRklFTEROQU1FIGlmICFkZWZpbmVkICRWYWx1ZTsKCiAgICAgICAgICAgICAgICBpZiAoICFJc0FycmF5UmVmV2l0aERhdGEoJFZhbHVlKSApIHsKICAgICAgICAgICAgICAgICAgICAkVmFsdWUgPSBbJFZhbHVlXTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBteSBAVmFsdWVzOwoKICAgICAgICAgICAgICAgIFZBTFVFOgogICAgICAgICAgICAgICAgZm9yIG15ICRDdXJyZW50VmFsdWUgKCBAeyRWYWx1ZX0gKSB7CiAgICAgICAgICAgICAgICAgICAgbmV4dCBWQUxVRSBpZiAhZGVmaW5lZCAkQ3VycmVudFZhbHVlIHx8ICFsZW5ndGggJEN1cnJlbnRWYWx1ZTsKCiAgICAgICAgICAgICAgICAgICAgbXkgJFJlYWRhYmxlVmFsdWUgPSAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdC0+UmVhZGFibGVWYWx1ZVJlbmRlcigKICAgICAgICAgICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRDb25maWdzQnlOYW1leyREeW5hbWljRmllbGROYW1lfSwKICAgICAgICAgICAgICAgICAgICAgICAgVmFsdWUgICAgICAgICAgICAgID0+ICRDdXJyZW50VmFsdWUsCiAgICAgICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAgICAgbmV4dCBWQUxVRSBpZiAhSXNIYXNoUmVmV2l0aERhdGEoJFJlYWRhYmxlVmFsdWUpIHx8ICFkZWZpbmVkICRSZWFkYWJsZVZhbHVlLT57VmFsdWV9OwoKICAgICAgICAgICAgICAgICAgICBteSAkSXNBQ0xSZWR1Y2libGUgPSAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdC0+SGFzQmVoYXZpb3IoCiAgICAgICAgICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZENvbmZpZyA9PiAkRHluYW1pY0ZpZWxkQ29uZmlnc0J5TmFtZXskRHluYW1pY0ZpZWxkTmFtZX0sCiAgICAgICAgICAgICAgICAgICAgICAgIEJlaGF2aW9yICAgICAgICAgICA9PiAnSXNBQ0xSZWR1Y2libGUnLAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCRJc0FDTFJlZHVjaWJsZSkgewogICAgICAgICAgICAgICAgICAgICAgICBteSAkUG9zc2libGVWYWx1ZXMgPSAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdC0+UG9zc2libGVWYWx1ZXNHZXQoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEeW5hbWljRmllbGRDb25maWcgPT4gJER5bmFtaWNGaWVsZENvbmZpZ3NCeU5hbWV7JER5bmFtaWNGaWVsZE5hbWV9LAogICAgICAgICAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgSXNIYXNoUmVmV2l0aERhdGEoJFBvc3NpYmxlVmFsdWVzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJiYgZGVmaW5lZCAkUG9zc2libGVWYWx1ZXMtPnsgJFJlYWRhYmxlVmFsdWUtPntWYWx1ZX0gfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkUmVhZGFibGVWYWx1ZS0+e1ZhbHVlfSA9ICRQb3NzaWJsZVZhbHVlcy0+eyAkUmVhZGFibGVWYWx1ZS0+e1ZhbHVlfSB9OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBwdXNoIEBWYWx1ZXMsICRSZWFkYWJsZVZhbHVlLT57VmFsdWV9OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRVc2VyU3RyaW5nUGFydHN7JER5bmFtaWNGaWVsZE5hbWV9ID0gam9pbiAnICcsIEBWYWx1ZXM7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgYXNzZW1ibGUgdXNlciBzdHJpbmcKICAgICAgICBteSBAVXNlclN0cmluZ1BhcnRzOwogICAgICAgIENVU1RPTUVSVVNFUkxJU1RGSUVMRDoKICAgICAgICBmb3IgbXkgJEN1c3RvbWVyVXNlckxpc3RGaWVsZCAoIEB7JEN1c3RvbWVyVXNlckxpc3RGaWVsZHN9ICkgewogICAgICAgICAgICBuZXh0IENVU1RPTUVSVVNFUkxJU1RGSUVMRAogICAgICAgICAgICAgICAgaWYgIWV4aXN0cyAkVXNlclN0cmluZ1BhcnRzeyRDdXN0b21lclVzZXJMaXN0RmllbGR9CiAgICAgICAgICAgICAgICB8fCAhZGVmaW5lZCAkVXNlclN0cmluZ1BhcnRzeyRDdXN0b21lclVzZXJMaXN0RmllbGR9CiAgICAgICAgICAgICAgICB8fCAhbGVuZ3RoICRVc2VyU3RyaW5nUGFydHN7JEN1c3RvbWVyVXNlckxpc3RGaWVsZH07CiAgICAgICAgICAgIHB1c2ggQFVzZXJTdHJpbmdQYXJ0cywgJFVzZXJTdHJpbmdQYXJ0c3skQ3VzdG9tZXJVc2VyTGlzdEZpZWxkfTsKICAgICAgICB9CgogICAgICAgICRVc2Vyc3skQ3VzdG9tZXJLZXl9ID0gam9pbiAnICcsIEBVc2VyU3RyaW5nUGFydHM7CiAgICAgICAgJFVzZXJzeyRDdXN0b21lcktleX0gPX4gcy9eKC4qKVxzKC4rP1xALis/XC4uKz8pKFxzfCkkLyIkMSIgPCQyPi87CiAgICB9CgogICAgIyBjYWNoZSByZXF1ZXN0CiAgICBpZiAoICRTZWxmLT57Q2FjaGVPYmplY3R9ICkgewogICAgICAgICRTZWxmLT57Q2FjaGVPYmplY3R9LT5TZXQoCiAgICAgICAgICAgIFR5cGUgID0+ICRTZWxmLT57Q2FjaGVUeXBlfSAuICdfQ3VzdG9tZXJTZWFyY2gnLAogICAgICAgICAgICBLZXkgICA9PiAkQ2FjaGVLZXksCiAgICAgICAgICAgIFZhbHVlID0+IFwlVXNlcnMsCiAgICAgICAgICAgIFRUTCAgID0+ICRTZWxmLT57Q3VzdG9tZXJVc2VyTWFwfS0+e0NhY2hlVFRMfSwKICAgICAgICApOwogICAgfQogICAgcmV0dXJuICVVc2VyczsKfQoKc3ViIEN1c3RvbWVyU2VhcmNoRGV0YWlsIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgaWYgKCByZWYgJFBhcmFte1NlYXJjaEZpZWxkc30gbmUgJ0FSUkFZJyApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gIlNlYXJjaEZpZWxkcyBtdXN0IGJlIGFuIGFycmF5IHJlZmVyZW5jZSEiLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIG15ICRWYWxpZCA9IGRlZmluZWQgJFBhcmFte1ZhbGlkfSA/ICRQYXJhbXtWYWxpZH0gOiAxOwoKICAgICRQYXJhbXtMaW1pdH0gLy89ICcnOwoKICAgICMgU3BsaXQgdGhlIHNlYXJjaCBmaWVsZHMgaW4gc2NhbGFyIGFuZCBhcnJheSBmaWVsZHMsIGJlZm9yZSB0aGUgZGlmZnJlbnQgaGFuZGxpbmcuCiAgICBteSBAU2NhbGFyU2VhcmNoRmllbGRzID0gZ3JlcCB7ICdJbnB1dCcgZXEgJF8tPntUeXBlfSB9IEB7ICRQYXJhbXtTZWFyY2hGaWVsZHN9IH07CiAgICBteSBAQXJyYXlTZWFyY2hGaWVsZHMgID0gZ3JlcCB7ICdTZWxlY3Rpb24nIGVxICRfLT57VHlwZX0gfSBAeyAkUGFyYW17U2VhcmNoRmllbGRzfSB9OwoKICAgICMgVmVyaWZ5IHRoYXQgYWxsIHBhc3NlZCBhcnJheSBwYXJhbWV0ZXJzIGNvbnRhaW4gYW4gYXJyYXlyZWYuCiAgICBBUkdVTUVOVDoKICAgIGZvciBteSAkQXJndW1lbnQgKEBBcnJheVNlYXJjaEZpZWxkcykgewogICAgICAgIGlmICggIWRlZmluZWQgJFBhcmFteyAkQXJndW1lbnQtPntOYW1lfSB9ICkgewogICAgICAgICAgICAkUGFyYW17ICRBcmd1bWVudC0+e05hbWV9IH0gfHw9IFtdOwoKICAgICAgICAgICAgbmV4dCBBUkdVTUVOVDsKICAgICAgICB9CgogICAgICAgIGlmICggcmVmICRQYXJhbXsgJEFyZ3VtZW50LT57TmFtZX0gfSBuZSAnQVJSQVknICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiJEFyZ3VtZW50LT57TmFtZX0gbXVzdCBiZSBhbiBhcnJheSByZWZlcmVuY2UhIiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICAjIFNldCB0aGUgZGVmYXVsdCBiZWhhdmlvdXIgZm9yIHRoZSByZXR1cm4gdHlwZS4KICAgIG15ICRSZXN1bHQgPSAkUGFyYW17UmVzdWx0fSB8fCAnQVJSQVknOwoKICAgICMgU3BlY2lhbCBoYW5kbGluZyBpZiB0aGUgcmVzdWx0IHR5cGUgaXMgJ0NPVU5UJy4KICAgIGlmICggJFJlc3VsdCBlcSAnQ09VTlQnICkgewoKICAgICAgICAjIElnbm9yZSB0aGUgcGFyYW1ldGVyICdMaW1pdCcgd2hlbiByZXN1bHQgdHlwZSBpcyAnQ09VTlQnLgogICAgICAgICRQYXJhbXtMaW1pdH0gPSAnJzsKCiAgICAgICAgIyBEZWxldGUgdGhlIE9yZGVyQnkgcGFyYW1ldGVyIHdoZW4gdGhlIHJlc3VsdCB0eXBlIGlzICdDT1VOVCcuCiAgICAgICAgJFBhcmFte09yZGVyQnl9ID0gW107CiAgICB9CgogICAgIyBEZWZpbmUgb3JkZXIgdGFibGUgZnJvbSB0aGUgc2VhcmNoIGZpZWxkcy4KICAgIG15ICVPcmRlckJ5VGFibGUgPSBtYXAgeyAkXy0+e05hbWV9ID0+ICRfLT57RGF0YWJhc2VGaWVsZH0gfSBAeyAkUGFyYW17U2VhcmNoRmllbGRzfSB9OwoKICAgIGZvciBteSAkRmllbGQgKEBBcnJheVNlYXJjaEZpZWxkcykgewoKICAgICAgICBteSAkU2VsZWN0aW9uc0RhdGEgPSAkRmllbGQtPntTZWxlY3Rpb25zRGF0YX07CgogICAgICAgIGZvciBteSAkU2VsZWN0ZWRWYWx1ZSAoIEB7ICRQYXJhbXsgJEZpZWxkLT57TmFtZX0gfSB9ICkgewoKICAgICAgICAgICAgIyBDaGVjayBpZiB0aGUgc2VsZWN0ZWQgdmFsdWUgZm9yIHRoZSBjdXJyZW50IGZpZWxkIGlzIHZhbGlkLgogICAgICAgICAgICBpZiAoICEkU2VsZWN0aW9uc0RhdGEtPnskU2VsZWN0ZWRWYWx1ZX0gKSB7CiAgICAgICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJUaGUgc2VsZWN0ZWQgdmFsdWUgJEZpZWxkLT57TmFtZX0gaXMgbm90IHZhbGlkISIsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIG15ICREQk9iamVjdCA9ICRTZWxmLT57REJPYmplY3R9OwoKICAgICMgQXNzZW1ibGUgdGhlIGNvbmRpdGlvbnMgdXNlZCBpbiB0aGUgV0hFUkUgY2xhdXNlLgogICAgbXkgQFNRTFdoZXJlOwoKICAgIGZvciBteSAkRmllbGQgKEBTY2FsYXJTZWFyY2hGaWVsZHMpIHsKCiAgICAgICAgIyBTZWFyY2ggZm9yIHNjYWxhciBmaWVsZHMgKHdpbGRjYXJkcyBhcmUgYWxsb3dlZCkuCiAgICAgICAgaWYgKCAkUGFyYW17ICRGaWVsZC0+e05hbWV9IH0gKSB7CgogICAgICAgICAgICAjIEdldCBsaWtlIGVzY2FwZSBzdHJpbmcgbmVlZGVkIGZvciBzb21lIGRhdGFiYXNlcyAoZS5nLiBvcmFjbGUpLgogICAgICAgICAgICBteSAkTGlrZUVzY2FwZVN0cmluZyA9ICREQk9iamVjdC0+R2V0RGF0YWJhc2VGdW5jdGlvbignTGlrZUVzY2FwZVN0cmluZycpOwoKICAgICAgICAgICAgJFBhcmFteyAkRmllbGQtPntOYW1lfSB9ID0gJERCT2JqZWN0LT5RdW90ZSggJFBhcmFteyAkRmllbGQtPntOYW1lfSB9LCAnTGlrZScgKTsKCiAgICAgICAgICAgICRQYXJhbXsgJEZpZWxkLT57TmFtZX0gfSA9fiBzeyBcKisgfXslfXhtc2c7CgogICAgICAgICAgICAjIElmIHRoZSBmaWVsZCBjb250YWlucyBtb3JlIHRoYW4gb25seSAlLgogICAgICAgICAgICBpZiAoICRQYXJhbXsgJEZpZWxkLT57TmFtZX0gfSAhfiBteyBcQSAlKiBceiB9eG1zICkgewogICAgICAgICAgICAgICAgcHVzaCBAU1FMV2hlcmUsCiAgICAgICAgICAgICAgICAgICAgIkxPV0VSKCRGaWVsZC0+e0RhdGFiYXNlRmllbGR9KSBMSUtFIExPV0VSKCckUGFyYW17ICRGaWVsZC0+e05hbWV9IH0nKSAkTGlrZUVzY2FwZVN0cmluZyI7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgbXkgJER5bmFtaWNGaWVsZE9iamVjdCAgICAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6RHluYW1pY0ZpZWxkJyk7CiAgICBteSAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpEeW5hbWljRmllbGQ6OkJhY2tlbmQnKTsKCiAgICAjIENoZWNrIGFsbCBjb25maWd1cmVkIGNoYW5nZSBkeW5hbWljIGZpZWxkcywgYnVpbGQgbG9va3VwIGhhc2ggYnkgbmFtZS4KICAgIG15ICVDdXN0b21lclVzZXJEeW5hbWljRmllbGROYW1lMkNvbmZpZzsKICAgIG15ICRDdXN0b21lclVzZXJEeW5hbWljRmllbGRzID0gJER5bmFtaWNGaWVsZE9iamVjdC0+RHluYW1pY0ZpZWxkTGlzdEdldCgKICAgICAgICBPYmplY3RUeXBlID0+ICdDdXN0b21lclVzZXInLAogICAgKTsKICAgIGZvciBteSAkRHluYW1pY0ZpZWxkICggQHskQ3VzdG9tZXJVc2VyRHluYW1pY0ZpZWxkc30gKSB7CiAgICAgICAgJEN1c3RvbWVyVXNlckR5bmFtaWNGaWVsZE5hbWUyQ29uZmlneyAkRHluYW1pY0ZpZWxkLT57TmFtZX0gfSA9ICREeW5hbWljRmllbGQ7CiAgICB9CgogICAgbXkgJFNRTER5bmFtaWNGaWVsZEZyb20gICAgID0gJyc7CiAgICBteSAkU1FMRHluYW1pY0ZpZWxkV2hlcmUgICAgPSAnJzsKICAgIG15ICREeW5hbWljRmllbGRKb2luQ291bnRlciA9IDE7CgogICAgRFlOQU1JQ0ZJRUxEOgogICAgZm9yIG15ICREeW5hbWljRmllbGQgKCBAeyRDdXN0b21lclVzZXJEeW5hbWljRmllbGRzfSApIHsKCiAgICAgICAgbXkgJFNlYXJjaFBhcmFtID0gJFBhcmFteyAiRHluYW1pY0ZpZWxkXyIgLiAkRHluYW1pY0ZpZWxkLT57TmFtZX0gfTsKCiAgICAgICAgbmV4dCBEWU5BTUlDRklFTEQgaWYgKCAhJFNlYXJjaFBhcmFtICk7CiAgICAgICAgbmV4dCBEWU5BTUlDRklFTEQgaWYgKCByZWYgJFNlYXJjaFBhcmFtIG5lICdIQVNIJyApOwoKICAgICAgICBteSAkTmVlZEpvaW47CgogICAgICAgIGZvciBteSAkT3BlcmF0b3IgKCBzb3J0IGtleXMgJXskU2VhcmNoUGFyYW19ICkgewoKICAgICAgICAgICAgbXkgQFNlYXJjaFBhcmFtcyA9ICggcmVmICRTZWFyY2hQYXJhbS0+eyRPcGVyYXRvcn0gZXEgJ0FSUkFZJyApCiAgICAgICAgICAgICAgICA/IEB7ICRTZWFyY2hQYXJhbS0+eyRPcGVyYXRvcn0gfQogICAgICAgICAgICAgICAgOiAoICRTZWFyY2hQYXJhbS0+eyRPcGVyYXRvcn0gKTsKCiAgICAgICAgICAgIG15ICRTUUxEeW5hbWljRmllbGRXaGVyZVN1YiA9ICcnOwogICAgICAgICAgICBpZiAoJFNRTER5bmFtaWNGaWVsZFdoZXJlKSB7CiAgICAgICAgICAgICAgICAkU1FMRHluYW1pY0ZpZWxkV2hlcmVTdWIgPSAnIEFORCAoJzsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRTUUxEeW5hbWljRmllbGRXaGVyZVN1YiA9ICcgKCc7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG15ICRDb3VudGVyID0gMDsKICAgICAgICAgICAgVEVYVDoKICAgICAgICAgICAgZm9yIG15ICRUZXh0IChAU2VhcmNoUGFyYW1zKSB7CiAgICAgICAgICAgICAgICBuZXh0IFRFWFQgaWYgKCAhZGVmaW5lZCAkVGV4dCB8fCAkVGV4dCBlcSAnJyApOwoKICAgICAgICAgICAgICAgICRUZXh0ID1+IHMvXCovJS9naTsKCiAgICAgICAgICAgICAgICAjIENoZWNrIHNlYXJjaCBhdHRyaWJ1dGUsIHdlIGRvIG5vdCBuZWVkIHRvIHNlYXJjaCBmb3IgJyonLgogICAgICAgICAgICAgICAgbmV4dCBURVhUIGlmICRUZXh0ID1+IC9eXCV7MSwzfSQvOwoKICAgICAgICAgICAgICAgIG15ICRWYWxpZGF0ZVN1Y2Nlc3MgPSAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdC0+VmFsdWVWYWxpZGF0ZSgKICAgICAgICAgICAgICAgICAgICBEeW5hbWljRmllbGRDb25maWcgPT4gJER5bmFtaWNGaWVsZCwKICAgICAgICAgICAgICAgICAgICBWYWx1ZSAgICAgICAgICAgICAgPT4gJFRleHQsCiAgICAgICAgICAgICAgICAgICAgVXNlcklEICAgICAgICAgICAgID0+ICRQYXJhbXtVc2VySUR9IHx8IDEsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgaWYgKCAhJFZhbGlkYXRlU3VjY2VzcyApIHsKICAgICAgICAgICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIlNlYXJjaCBub3QgZXhlY3V0ZWQgZHVlIHRvIGludmFsaWQgdmFsdWUgJyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4gJFRleHQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4gIicgb24gZmllbGQgJyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4gJER5bmFtaWNGaWVsZC0+e05hbWV9IC4gIichIiwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoJENvdW50ZXIpIHsKICAgICAgICAgICAgICAgICAgICAkU1FMRHluYW1pY0ZpZWxkV2hlcmVTdWIgLj0gJyBPUiAnOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgJFNRTER5bmFtaWNGaWVsZFdoZXJlU3ViIC49ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0LT5TZWFyY2hTUUxHZXQoCiAgICAgICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGQsCiAgICAgICAgICAgICAgICAgICAgVGFibGVBbGlhcyAgICAgICAgID0+ICJkZnYkRHluYW1pY0ZpZWxkSm9pbkNvdW50ZXIiLAogICAgICAgICAgICAgICAgICAgIE9wZXJhdG9yICAgICAgICAgICA9PiAkT3BlcmF0b3IsCiAgICAgICAgICAgICAgICAgICAgU2VhcmNoVGVybSAgICAgICAgID0+ICRUZXh0LAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAkQ291bnRlcisrOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRTUUxEeW5hbWljRmllbGRXaGVyZVN1YiAuPSAnKSAnOwoKICAgICAgICAgICAgaWYgKCRDb3VudGVyKSB7CiAgICAgICAgICAgICAgICAkU1FMRHluYW1pY0ZpZWxkV2hlcmUgLj0gJFNRTER5bmFtaWNGaWVsZFdoZXJlU3ViOwogICAgICAgICAgICAgICAgJE5lZWRKb2luID0gMTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCROZWVkSm9pbikgewogICAgICAgICAgICAkU1FMRHluYW1pY0ZpZWxkRnJvbSAuPSAiCiAgICAgICAgICAgICAgICBJTk5FUiBKT0lOIGR5bmFtaWNfZmllbGRfdmFsdWUgZGZ2JER5bmFtaWNGaWVsZEpvaW5Db3VudGVyCiAgICAgICAgICAgICAgICAgICAgT04gKGRmX29ial9pZF9uYW1lLm9iamVjdF9pZCA9IGRmdiREeW5hbWljRmllbGRKb2luQ291bnRlci5vYmplY3RfaWQKICAgICAgICAgICAgICAgICAgICAgICAgQU5EIGRmdiREeW5hbWljRmllbGRKb2luQ291bnRlci5maWVsZF9pZCA9ICIKICAgICAgICAgICAgICAgIC4gJERCT2JqZWN0LT5RdW90ZSggJER5bmFtaWNGaWVsZC0+e0lEfSwgJ0ludGVnZXInICkgLiAiKQogICAgICAgICAgICAiOwoKICAgICAgICAgICAgJER5bmFtaWNGaWVsZEpvaW5Db3VudGVyKys7CiAgICAgICAgfQogICAgfQoKICAgICMgRXhlY3V0ZSBhIGR5bmFtaWMgZmllbGQgc2VhcmNoLCBpZiBhIGR5bmFtaWMgZmllbGQgd2hlcmUgc3RhdGVtZW50IGV4aXN0cy4KICAgIGlmICgkU1FMRHluYW1pY0ZpZWxkV2hlcmUpIHsKCiAgICAgICAgbXkgQER5bmFtaWNGaWVsZFVzZXJMb2dpbnM7CgogICAgICAgIG15ICRTUUxEeW5hbWljRmllbGQKICAgICAgICAgICAgPSAiU0VMRUNUIERJU1RJTkNUKGRmX29ial9pZF9uYW1lLm9iamVjdF9uYW1lKSBGUk9NIGR5bmFtaWNfZmllbGRfb2JqX2lkX25hbWUgZGZfb2JqX2lkX25hbWUgIgogICAgICAgICAgICAuICRTUUxEeW5hbWljRmllbGRGcm9tCiAgICAgICAgICAgIC4gIiBXSEVSRSAiCiAgICAgICAgICAgIC4gJFNRTER5bmFtaWNGaWVsZFdoZXJlOwoKICAgICAgICBteSAkVXNlZENhY2hlOwoKICAgICAgICBpZiAoICRTZWxmLT57Q2FjaGVPYmplY3R9ICkgewoKICAgICAgICAgICAgbXkgJER5bmFtaWNGaWVsZFNlYXJjaENhY2hlRGF0YSA9ICRTZWxmLT57Q2FjaGVPYmplY3R9LT5HZXQoCiAgICAgICAgICAgICAgICBUeXBlID0+ICRTZWxmLT57Q2FjaGVUeXBlfSAuICdfQ3VzdG9tZXJTZWFyY2hEZXRhaWxEeW5hbWljRmllbGRzJywKICAgICAgICAgICAgICAgIEtleSAgPT4gJFNRTER5bmFtaWNGaWVsZCwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIGlmICggZGVmaW5lZCAkRHluYW1pY0ZpZWxkU2VhcmNoQ2FjaGVEYXRhICkgewogICAgICAgICAgICAgICAgaWYgKCByZWYgJER5bmFtaWNGaWVsZFNlYXJjaENhY2hlRGF0YSBlcSAnQVJSQVknICkgewogICAgICAgICAgICAgICAgICAgIEBEeW5hbWljRmllbGRVc2VyTG9naW5zID0gQHskRHluYW1pY0ZpZWxkU2VhcmNoQ2FjaGVEYXRhfTsKCiAgICAgICAgICAgICAgICAgICAgJFVzZWRDYWNoZSA9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ0ludmFsaWQgcmVmICcgLiByZWYoJER5bmFtaWNGaWVsZFNlYXJjaENhY2hlRGF0YSkgLiAnIScKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgIyBHZXQgdGhlIGRhdGEgb25seSBmcm9tIGRhdGFiYXNlLCBpZiBubyBjYWNoZSBlbnRyeSBleGlzdHMuCiAgICAgICAgaWYgKCAhJFVzZWRDYWNoZSApIHsKCiAgICAgICAgICAgIHJldHVybiBpZiAhJERCT2JqZWN0LT5QcmVwYXJlKAogICAgICAgICAgICAgICAgU1FMID0+ICRTUUxEeW5hbWljRmllbGQsCiAgICAgICAgICAgICk7CgogICAgICAgICAgICB3aGlsZSAoIG15IEBSb3cgPSAkREJPYmplY3QtPkZldGNocm93QXJyYXkoKSApIHsKICAgICAgICAgICAgICAgIHB1c2ggQER5bmFtaWNGaWVsZFVzZXJMb2dpbnMsICRSb3dbMF07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICggJFNlbGYtPntDYWNoZU9iamVjdH0gKSB7CiAgICAgICAgICAgICAgICAkU2VsZi0+e0NhY2hlT2JqZWN0fS0+U2V0KAogICAgICAgICAgICAgICAgICAgIFR5cGUgID0+ICRTZWxmLT57Q2FjaGVUeXBlfSAuICdfQ3VzdG9tZXJTZWFyY2hEZXRhaWxEeW5hbWljRmllbGRzJywKICAgICAgICAgICAgICAgICAgICBLZXkgICA9PiAkU1FMRHluYW1pY0ZpZWxkLAogICAgICAgICAgICAgICAgICAgIFZhbHVlID0+IFxARHluYW1pY0ZpZWxkVXNlckxvZ2lucywKICAgICAgICAgICAgICAgICAgICBUVEwgICA9PiAkU2VsZi0+e0N1c3RvbWVyVXNlck1hcH0tPntDYWNoZVRUTH0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAjIEFkZCB0aGUgdXNlciBsb2dpbnMgZnJvbSB0aGUgZHluYW1pYyBmaWVsZHMsIGlmIGEgc2VhcmNoIHJlc3VsdCBleGlzdHMgZnJvbSB0aGUgZHluYW1pYyBmaWVsZCBzZWFyY2gKICAgICAgICAjICAgb3Igc2tpcCB0aGUgc2VhcmNoIGFuZCByZXR1cm4gYSBlbXB0cnkgYXJyYXkgcmVmLCBpZiBubyB1c2VyIGxvZ2lucyBleGlzdHMgZnJvbSB0aGUgZHluYW1pYyBmaWVsZCBzZWFyY2guCiAgICAgICAgaWYgKEBEeW5hbWljRmllbGRVc2VyTG9naW5zKSB7CgogICAgICAgICAgICBteSAkU1FMUXVlcnlJbkNvbmRpdGlvbiA9ICREQk9iamVjdC0+UXVlcnlJbkNvbmRpdGlvbigKICAgICAgICAgICAgICAgIEtleSAgICAgID0+ICRTZWxmLT57Q3VzdG9tZXJLZXl9LAogICAgICAgICAgICAgICAgVmFsdWVzICAgPT4gXEBEeW5hbWljRmllbGRVc2VyTG9naW5zLAogICAgICAgICAgICAgICAgQmluZE1vZGUgPT4gMCwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgIHB1c2ggQFNRTFdoZXJlLCAkU1FMUXVlcnlJbkNvbmRpdGlvbjsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHJldHVybiAkUmVzdWx0IGVxICdDT1VOVCcgPyAwIDogW107CiAgICAgICAgfQogICAgfQoKICAgIEZJRUxEOgogICAgZm9yIG15ICRGaWVsZCAoQEFycmF5U2VhcmNoRmllbGRzKSB7CgogICAgICAgIG5leHQgRklFTEQgaWYgIUB7ICRQYXJhbXsgJEZpZWxkLT57TmFtZX0gfSB9OwoKICAgICAgICBteSAkU1FMUXVlcnlJbkNvbmRpdGlvbiA9ICREQk9iamVjdC0+UXVlcnlJbkNvbmRpdGlvbigKICAgICAgICAgICAgS2V5ICAgICAgPT4gJEZpZWxkLT57RGF0YWJhc2VGaWVsZH0sCiAgICAgICAgICAgIFZhbHVlcyAgID0+ICRQYXJhbXsgJEZpZWxkLT57TmFtZX0gfSwKICAgICAgICAgICAgQmluZE1vZGUgPT4gMCwKICAgICAgICApOwoKICAgICAgICBwdXNoIEBTUUxXaGVyZSwgJFNRTFF1ZXJ5SW5Db25kaXRpb247CiAgICB9CgogICAgIyBTcGVjaWFsIHBhcmFtZXRlciBmb3IgQ3VzdG9tZXJJRHMgZnJvbSBhIGN1c3RvbWVyIGNvbXBhbnkgc2VhcmNoIHJlc3VsdC4KICAgIGlmICggSXNBcnJheVJlZldpdGhEYXRhKCAkUGFyYW17Q3VzdG9tZXJDb21wYW55U2VhcmNoQ3VzdG9tZXJJRHN9ICkgKSB7CgogICAgICAgIG15ICRTUUxRdWVyeUluQ29uZGl0aW9uID0gJERCT2JqZWN0LT5RdWVyeUluQ29uZGl0aW9uKAogICAgICAgICAgICBLZXkgICAgICA9PiAkU2VsZi0+e0N1c3RvbWVySUR9LAogICAgICAgICAgICBWYWx1ZXMgICA9PiAkUGFyYW17Q3VzdG9tZXJDb21wYW55U2VhcmNoQ3VzdG9tZXJJRHN9LAogICAgICAgICAgICBCaW5kTW9kZSA9PiAwLAogICAgICAgICk7CgogICAgICAgIHB1c2ggQFNRTFdoZXJlLCAkU1FMUXVlcnlJbkNvbmRpdGlvbjsKICAgIH0KCiAgICAjIFNwZWNpYWwgcGFyYW1ldGVyIHRvIGV4Y2x1ZGUgc29tZSB1c2VyIGxvZ2lucyBmcm9tIHRoZSBzZWFyY2ggcmVzdWx0LgogICAgaWYgKCBJc0FycmF5UmVmV2l0aERhdGEoICRQYXJhbXtFeGNsdWRlVXNlckxvZ2luc30gKSApIHsKCiAgICAgICAgbXkgJFNRTFF1ZXJ5SW5Db25kaXRpb24gPSAkREJPYmplY3QtPlF1ZXJ5SW5Db25kaXRpb24oCiAgICAgICAgICAgIEtleSAgICAgID0+ICRTZWxmLT57Q3VzdG9tZXJLZXl9LAogICAgICAgICAgICBWYWx1ZXMgICA9PiAkUGFyYW17RXhjbHVkZVVzZXJMb2dpbnN9LAogICAgICAgICAgICBCaW5kTW9kZSA9PiAwLAogICAgICAgICAgICBOZWdhdGUgICA9PiAxLAogICAgICAgICk7CgogICAgICAgIHB1c2ggQFNRTFdoZXJlLCAkU1FMUXVlcnlJbkNvbmRpdGlvbjsKICAgIH0KCiAgICAjIEFkZCB0aGUgdmFsaWQgb3B0aW9uIGlmIG5lZWRlZC4KICAgIGlmICggJFNlbGYtPntDdXN0b21lclVzZXJNYXB9LT57Q3VzdG9tZXJWYWxpZH0gJiYgJFZhbGlkICkgewoKICAgICAgICBteSAkVmFsaWRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VmFsaWQnKTsKCiAgICAgICAgcHVzaCBAU1FMV2hlcmUsCiAgICAgICAgICAgICIkU2VsZi0+e0N1c3RvbWVyVXNlck1hcH0tPntDdXN0b21lclZhbGlkfSBJTiAoIiAuIGpvaW4oICcsICcsICRWYWxpZE9iamVjdC0+VmFsaWRJRHNHZXQoKSApIC4gIikgIjsKICAgIH0KCiAgICAjIENoZWNrIGlmIE9yZGVyQnkgY29udGFpbnMgb25seSB1bmlxdWUgdmFsaWQgdmFsdWVzLgogICAgbXkgJU9yZGVyQnlTZWVuOwogICAgZm9yIG15ICRPcmRlckJ5ICggQHsgJFBhcmFte09yZGVyQnl9IH0gKSB7CgogICAgICAgIGlmICggISRPcmRlckJ5IHx8ICRPcmRlckJ5U2VlbnskT3JkZXJCeX0gKSB7CgogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiT3JkZXJCeSBjb250YWlucyBpbnZhbGlkIHZhbHVlICckT3JkZXJCeScgb3IgdGhlIHZhbHVlIGlzIHVzZWQgbW9yZSB0aGFuIG9uY2UhIiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgIyBSZW1lbWJlciB0aGUgdmFsdWUgdG8gY2hlY2sgaWYgaXQgYXBwZWFycyBtb3JlIHRoYW4gb25jZS4KICAgICAgICAkT3JkZXJCeVNlZW57JE9yZGVyQnl9ID0gMTsKICAgIH0KCiAgICAjIENoZWNrIGlmIE9yZGVyQnlEaXJlY3Rpb24gYXJyYXkgY29udGFpbnMgb25seSAnVXAnIG9yICdEb3duJy4KICAgIERJUkVDVElPTjoKICAgIGZvciBteSAkRGlyZWN0aW9uICggQHsgJFBhcmFte09yZGVyQnlEaXJlY3Rpb259IH0gKSB7CgogICAgICAgICMgT25seSAnVXAnIG9yICdEb3duJyBhbGxvd2VkLgogICAgICAgIG5leHQgRElSRUNUSU9OIGlmICREaXJlY3Rpb24gZXEgJ1VwJzsKICAgICAgICBuZXh0IERJUkVDVElPTiBpZiAkRGlyZWN0aW9uIGVxICdEb3duJzsKCiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJPcmRlckJ5RGlyZWN0aW9uIGNhbiBvbmx5IGNvbnRhaW4gJ1VwJyBvciAnRG93bichIiwKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIEJ1aWxkIHRoZSBzcWwgc3RhdGVtZW50IGZvciB0aGUgc2VhcmNoLgogICAgbXkgJFNRTCA9ICJTRUxFQ1QgRElTVElOQ1QoJFNlbGYtPntDdXN0b21lcktleX0pIjsKCiAgICAjIE1vZGlmeSBTUUwgd2hlbiB0aGUgcmVzdWx0IHR5cGUgaXMgJ0NPVU5UJy4KICAgIGlmICggJFJlc3VsdCBlcSAnQ09VTlQnICkgewogICAgICAgICRTUUwgPSAiU0VMRUNUIENPVU5UKERJU1RJTkNUKCRTZWxmLT57Q3VzdG9tZXJLZXl9KSkiOwogICAgfQoKICAgICMgQXNzZW1ibGUgdGhlIE9SREVSIEJZIGNsYXVzZS4KICAgIG15IEBTUUxPcmRlckJ5OwoKICAgICMgVGhlIE9yZGVyIGJ5IGNsYXVzZSBpcyBub3QgbmVlZGVkIGZvciB0aGUgcmVzdWx0IHR5cGUgJ0NPVU5UJy4KICAgIGlmICggJFJlc3VsdCBuZSAnQ09VTlQnICkgewoKICAgICAgICBteSAkQ291bnQgPSAwOwoKICAgICAgICBPUkRFUkJZOgogICAgICAgIGZvciBteSAkT3JkZXJCeSAoIEB7ICRQYXJhbXtPcmRlckJ5fSB9ICkgewoKICAgICAgICAgICAgbXkgJERpcmVjdGlvbiA9ICdERVNDJzsKCiAgICAgICAgICAgIGlmICggJFBhcmFte09yZGVyQnlEaXJlY3Rpb259LT5bJENvdW50XSApIHsKICAgICAgICAgICAgICAgIGlmICggJFBhcmFte09yZGVyQnlEaXJlY3Rpb259LT5bJENvdW50XSBlcSAnVXAnICkgewogICAgICAgICAgICAgICAgICAgICREaXJlY3Rpb24gPSAnQVNDJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2lmICggJFBhcmFte09yZGVyQnlEaXJlY3Rpb259LT5bJENvdW50XSBlcSAnRG93bicgKSB7CiAgICAgICAgICAgICAgICAgICAgJERpcmVjdGlvbiA9ICdERVNDJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgJENvdW50Kys7CgogICAgICAgICAgICBuZXh0IE9SREVSQlkgaWYgISRPcmRlckJ5VGFibGV7JE9yZGVyQnl9OwoKICAgICAgICAgICAgcHVzaCBAU1FMT3JkZXJCeSwgIiRPcmRlckJ5VGFibGV7JE9yZGVyQnl9ICREaXJlY3Rpb24iOwoKICAgICAgICAgICAgbmV4dCBPUkRFUkJZIGlmICRPcmRlckJ5IGVxICdVc2VyTG9naW4nOwoKICAgICAgICAgICAgJFNRTCAuPSAiLCAkT3JkZXJCeVRhYmxleyRPcmRlckJ5fSI7CiAgICAgICAgfQoKICAgICAgICAjIElmIHRoZXJlIGlzIGEgcG9zc2liaWxpdHkgdGhhdCB0aGUgb3JkZXJpbmcgaXMgbm90IGRldGVybWluZWQKICAgICAgICAjICAgd2UgYWRkIGFuIGRlc2NlbmRpbmcgb3JkZXJpbmcgYnkgaWQuCiAgICAgICAgaWYgKCAhZ3JlcCB7ICRfIGVxICdVc2VyTG9naW4nIH0gKCBAeyAkUGFyYW17T3JkZXJCeX0gfSApICkgewogICAgICAgICAgICBwdXNoIEBTUUxPcmRlckJ5LCAiJFNlbGYtPntDdXN0b21lcktleX0gREVTQyI7CiAgICAgICAgfQogICAgfQoKICAgICRTUUwgLj0gIiBGUk9NICRTZWxmLT57Q3VzdG9tZXJUYWJsZX0gIjsKCiAgICBpZiAoQFNRTFdoZXJlKSB7CiAgICAgICAgbXkgJFNRTFdoZXJlU3RyaW5nID0gam9pbiAnIEFORCAnLCBtYXAgeyIoICRfICkifSBAU1FMV2hlcmU7CiAgICAgICAgJFNRTCAuPSAiV0hFUkUgJFNRTFdoZXJlU3RyaW5nICI7CiAgICB9CiAgICBpZiAoQFNRTE9yZGVyQnkpIHsKICAgICAgICBteSAkT3JkZXJCeVN0cmluZyA9IGpvaW4gJywgJywgQFNRTE9yZGVyQnk7CiAgICAgICAgJFNRTCAuPSAiT1JERVIgQlkgJE9yZGVyQnlTdHJpbmciOwogICAgfQoKICAgICMgQ2hlY2sgaWYgYSBjYWNoZSBleGlzdHMgYmVmb3JlIHdlIGFzayB0aGUgZGF0YWJhc2UuCiAgICBpZiAoICRTZWxmLT57Q2FjaGVPYmplY3R9ICkgewoKICAgICAgICBteSAkQ2FjaGVEYXRhID0gJFNlbGYtPntDYWNoZU9iamVjdH0tPkdldCgKICAgICAgICAgICAgVHlwZSA9PiAkU2VsZi0+e0NhY2hlVHlwZX0gLiAnX0N1c3RvbWVyU2VhcmNoRGV0YWlsJywKICAgICAgICAgICAgS2V5ICA9PiAkU1FMIC4gJFBhcmFte0xpbWl0fSwKICAgICAgICApOwoKICAgICAgICBpZiAoIGRlZmluZWQgJENhY2hlRGF0YSApIHsKICAgICAgICAgICAgaWYgKCByZWYgJENhY2hlRGF0YSBlcSAnQVJSQVknICkgewogICAgICAgICAgICAgICAgcmV0dXJuICRDYWNoZURhdGE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzaWYgKCByZWYgJENhY2hlRGF0YSBlcSAnJyApIHsKICAgICAgICAgICAgICAgIHJldHVybiAkQ2FjaGVEYXRhOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdJbnZhbGlkIHJlZiAnIC4gcmVmKCRDYWNoZURhdGEpIC4gJyEnCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIGlmICEkREJPYmplY3QtPlByZXBhcmUoCiAgICAgICAgU1FMICAgPT4gJFNRTCwKICAgICAgICBMaW1pdCA9PiAkUGFyYW17TGltaXR9LAogICAgKTsKCiAgICBteSBASURzOwogICAgd2hpbGUgKCBteSBAUm93ID0gJERCT2JqZWN0LT5GZXRjaHJvd0FycmF5KCkgKSB7CiAgICAgICAgcHVzaCBASURzLCAkUm93WzBdOwogICAgfQoKICAgICMgSGFuZGxlIHRoZSBkaWZmcmVudCByZXN1bHQgdHlwZXMuCiAgICBpZiAoICRSZXN1bHQgZXEgJ0NPVU5UJyApIHsKCiAgICAgICAgaWYgKCAkU2VsZi0+e0NhY2hlT2JqZWN0fSApIHsKICAgICAgICAgICAgJFNlbGYtPntDYWNoZU9iamVjdH0tPlNldCgKICAgICAgICAgICAgICAgIFR5cGUgID0+ICRTZWxmLT57Q2FjaGVUeXBlfSAuICdfQ3VzdG9tZXJTZWFyY2hEZXRhaWwnLAogICAgICAgICAgICAgICAgS2V5ICAgPT4gJFNRTCAuICRQYXJhbXtMaW1pdH0sCiAgICAgICAgICAgICAgICBWYWx1ZSA9PiAkSURzWzBdLAogICAgICAgICAgICAgICAgVFRMICAgPT4gJFNlbGYtPntDdXN0b21lclVzZXJNYXB9LT57Q2FjaGVUVEx9LAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuICRJRHNbMF07CiAgICB9CiAgICBlbHNlIHsKCiAgICAgICAgaWYgKCAkU2VsZi0+e0NhY2hlT2JqZWN0fSApIHsKICAgICAgICAgICAgJFNlbGYtPntDYWNoZU9iamVjdH0tPlNldCgKICAgICAgICAgICAgICAgIFR5cGUgID0+ICRTZWxmLT57Q2FjaGVUeXBlfSAuICdfQ3VzdG9tZXJTZWFyY2hEZXRhaWwnLAogICAgICAgICAgICAgICAgS2V5ICAgPT4gJFNRTCAuICRQYXJhbXtMaW1pdH0sCiAgICAgICAgICAgICAgICBWYWx1ZSA9PiBcQElEcywKICAgICAgICAgICAgICAgIFRUTCAgID0+ICRTZWxmLT57Q3VzdG9tZXJVc2VyTWFwfS0+e0NhY2hlVFRMfSwKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBcQElEczsKICAgIH0KfQoKc3ViIEN1c3RvbWVySURMaXN0IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJFZhbGlkICAgICAgPSBkZWZpbmVkICRQYXJhbXtWYWxpZH0gPyAkUGFyYW17VmFsaWR9IDogMTsKICAgIG15ICRTZWFyY2hUZXJtID0gJFBhcmFte1NlYXJjaFRlcm19IHx8ICcnOwoKICAgIG15ICRDYWNoZVR5cGUgPSAkU2VsZi0+e0NhY2hlVHlwZX0gLiAnX0N1c3RvbWVySURMaXN0JzsKICAgIG15ICRDYWNoZUtleSAgPSAiQ3VzdG9tZXJJRExpc3Q6OiR7VmFsaWR9OjokU2VhcmNoVGVybSI7CgogICAgIyBjaGVjayBjYWNoZQogICAgaWYgKCAkU2VsZi0+e0NhY2hlT2JqZWN0fSApIHsKICAgICAgICBteSAkUmVzdWx0ID0gJFNlbGYtPntDYWNoZU9iamVjdH0tPkdldCgKICAgICAgICAgICAgVHlwZSA9PiAkQ2FjaGVUeXBlLAogICAgICAgICAgICBLZXkgID0+ICRDYWNoZUtleSwKICAgICAgICApOwogICAgICAgIHJldHVybiBAeyRSZXN1bHR9IGlmIHJlZiAkUmVzdWx0IGVxICdBUlJBWSc7CiAgICB9CgogICAgbXkgJFNRTCA9ICIKICAgICAgICBTRUxFQ1QgRElTVElOQ1QoJFNlbGYtPntDdXN0b21lcklEfSkKICAgICAgICBGUk9NICRTZWxmLT57Q3VzdG9tZXJUYWJsZX0KICAgICAgICBXSEVSRSAxID0gMSAiOwogICAgbXkgQEJpbmQ7CgogICAgIyBhZGQgdmFsaWQgb3B0aW9uCiAgICBpZiAoICRTZWxmLT57Q3VzdG9tZXJVc2VyTWFwfS0+e0N1c3RvbWVyVmFsaWR9ICYmICRWYWxpZCApIHsKCiAgICAgICAgIyBnZXQgdmFsaWQgb2JqZWN0CiAgICAgICAgbXkgJFZhbGlkT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlZhbGlkJyk7CgogICAgICAgIG15ICRWYWxpZElEcyA9IGpvaW4oICcsICcsICRWYWxpZE9iamVjdC0+VmFsaWRJRHNHZXQoKSApOwogICAgICAgICRTUUwgLj0gIgogICAgICAgICAgICBBTkQgJFNlbGYtPntDdXN0b21lclVzZXJNYXB9LT57Q3VzdG9tZXJWYWxpZH0gSU4gKCRWYWxpZElEcykgIjsKICAgIH0KCiAgICAjIGFkZCBzZWFyY2ggdGVybQogICAgaWYgKCRTZWFyY2hUZXJtKSB7CiAgICAgICAgbXkgJFNlYXJjaFRlcm1Fc2NhcGVkID0gJFNlbGYtPntEQk9iamVjdH0tPlF1ZXJ5U3RyaW5nRXNjYXBlKCBRdWVyeVN0cmluZyA9PiAkU2VhcmNoVGVybSApOwoKICAgICAgICAkU1FMIC49ICcgQU5EICc7CiAgICAgICAgbXkgJVF1ZXJ5Q29uZGl0aW9uID0gJFNlbGYtPntEQk9iamVjdH0tPlF1ZXJ5Q29uZGl0aW9uKAogICAgICAgICAgICBLZXkgICAgICAgICAgID0+ICRTZWxmLT57Q3VzdG9tZXJJRH0sCiAgICAgICAgICAgIFZhbHVlICAgICAgICAgPT4gJFNlYXJjaFRlcm1Fc2NhcGVkLAogICAgICAgICAgICBTZWFyY2hQcmVmaXggID0+ICRTZWxmLT57U2VhcmNoUHJlZml4fSwKICAgICAgICAgICAgU2VhcmNoU3VmZml4ICA9PiAkU2VsZi0+e1NlYXJjaFN1ZmZpeH0sCiAgICAgICAgICAgIENhc2VTZW5zaXRpdmUgPT4gJFNlbGYtPntDYXNlU2Vuc2l0aXZlfSwKICAgICAgICAgICAgQmluZE1vZGUgICAgICA9PiAxLAogICAgICAgICk7CiAgICAgICAgJFNRTCAuPSAkUXVlcnlDb25kaXRpb257U1FMfTsKICAgICAgICBwdXNoIEBCaW5kLCBAeyAkUXVlcnlDb25kaXRpb257VmFsdWVzfSB9OwoKICAgICAgICAkU1FMIC49ICcgJzsKICAgIH0KCiAgICByZXR1cm4gaWYgISRTZWxmLT57REJPYmplY3R9LT5QcmVwYXJlKAogICAgICAgIFNRTCAgPT4gJFNRTCwKICAgICAgICBCaW5kID0+IFxAQmluZCwKICAgICk7CgogICAgbXkgQFJlc3VsdDsKCiAgICB3aGlsZSAoIG15IEBSb3cgPSAkU2VsZi0+e0RCT2JqZWN0fS0+RmV0Y2hyb3dBcnJheSgpICkgewogICAgICAgIHB1c2ggQFJlc3VsdCwgJFJvd1swXTsKICAgIH0KCiAgICAjIGNhY2hlIHJlcXVlc3QKICAgIGlmICggJFNlbGYtPntDYWNoZU9iamVjdH0gKSB7CiAgICAgICAgJFNlbGYtPntDYWNoZU9iamVjdH0tPlNldCgKICAgICAgICAgICAgVHlwZSAgPT4gJENhY2hlVHlwZSwKICAgICAgICAgICAgS2V5ICAgPT4gJENhY2hlS2V5LAogICAgICAgICAgICBWYWx1ZSA9PiBcQFJlc3VsdCwKICAgICAgICAgICAgVFRMICAgPT4gJFNlbGYtPntDdXN0b21lclVzZXJNYXB9LT57Q2FjaGVUVEx9LAogICAgICAgICk7CiAgICB9CiAgICByZXR1cm4gQFJlc3VsdDsKfQoKc3ViIEN1c3RvbWVySURzIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIGlmICggISRQYXJhbXtVc2VyfSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ05lZWQgVXNlciEnCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgIyBjaGVjayBjYWNoZQogICAgaWYgKCAkU2VsZi0+e0NhY2hlT2JqZWN0fSApIHsKICAgICAgICBteSAkQ3VzdG9tZXJJRHMgPSAkU2VsZi0+e0NhY2hlT2JqZWN0fS0+R2V0KAogICAgICAgICAgICBUeXBlID0+ICRTZWxmLT57Q2FjaGVUeXBlfSwKICAgICAgICAgICAgS2V5ICA9PiAiQ3VzdG9tZXJJRHM6OiRQYXJhbXtVc2VyfSIsCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gQHskQ3VzdG9tZXJJRHN9IGlmIHJlZiAkQ3VzdG9tZXJJRHMgZXEgJ0FSUkFZJzsKICAgIH0KCiAgICAjIGdldCBjdXN0b21lciBkYXRhCiAgICBteSAlRGF0YSA9ICRTZWxmLT5DdXN0b21lclVzZXJEYXRhR2V0KAogICAgICAgIFVzZXIgPT4gJFBhcmFte1VzZXJ9LAogICAgKTsKCiAgICAjIHRoZXJlIGFyZSBtdWx0aSBjdXN0b21lciBpZHMKICAgIG15IEBDdXN0b21lcklEczsKICAgIGlmICggJERhdGF7VXNlckN1c3RvbWVySURzfSApIHsKCiAgICAgICAgIyB1c2VkIHNlcGFyYXRvcnMKICAgICAgICBTRVBBUkFUT1I6CiAgICAgICAgZm9yIG15ICRTZXBhcmF0b3IgKCAnOycsICcsJywgJ3wnICkgewoKICAgICAgICAgICAgbmV4dCBTRVBBUkFUT1IgaWYgJERhdGF7VXNlckN1c3RvbWVySURzfSAhfiAvXFEkU2VwYXJhdG9yXEUvOwoKICAgICAgICAgICAgIyBzcGxpdCBpdAogICAgICAgICAgICBteSBASURzID0gc3BsaXQgL1xRJFNlcGFyYXRvclxFLywgJERhdGF7VXNlckN1c3RvbWVySURzfTsKCiAgICAgICAgICAgIGZvciBteSAkSUQgKEBJRHMpIHsKICAgICAgICAgICAgICAgICRJRCA9fiBzL15ccysvL2c7CiAgICAgICAgICAgICAgICAkSUQgPX4gcy9ccyskLy9nOwogICAgICAgICAgICAgICAgcHVzaCBAQ3VzdG9tZXJJRHMsICRJRDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGFzdCBTRVBBUkFUT1I7CiAgICAgICAgfQoKICAgICAgICAjIGZhbGxiYWNrIGlmIG5vIHNlcGFyYXRvciBnb3QgZm91bmQKICAgICAgICBpZiAoICFAQ3VzdG9tZXJJRHMgKSB7CiAgICAgICAgICAgICREYXRhe1VzZXJDdXN0b21lcklEc30gPX4gcy9eXHMrLy9nOwogICAgICAgICAgICAkRGF0YXtVc2VyQ3VzdG9tZXJJRHN9ID1+IHMvXHMrJC8vZzsKICAgICAgICAgICAgcHVzaCBAQ3VzdG9tZXJJRHMsICREYXRhe1VzZXJDdXN0b21lcklEc307CiAgICAgICAgfQogICAgfQoKICAgICMgdXNlIGFsc28gdGhlIHByaW1hcnkgY3VzdG9tZXIgaWQKICAgIGlmICggJERhdGF7VXNlckN1c3RvbWVySUR9ICYmICEkU2VsZi0+e0V4Y2x1ZGVQcmltYXJ5Q3VzdG9tZXJJRH0gKSB7CiAgICAgICAgcHVzaCBAQ3VzdG9tZXJJRHMsICREYXRhe1VzZXJDdXN0b21lcklEfTsKICAgIH0KCiAgICAjIGNhY2hlIHJlcXVlc3QKICAgIGlmICggJFNlbGYtPntDYWNoZU9iamVjdH0gKSB7CiAgICAgICAgJFNlbGYtPntDYWNoZU9iamVjdH0tPlNldCgKICAgICAgICAgICAgVHlwZSAgPT4gJFNlbGYtPntDYWNoZVR5cGV9LAogICAgICAgICAgICBLZXkgICA9PiAnQ3VzdG9tZXJJRHM6OicgLiAkUGFyYW17VXNlcn0sCiAgICAgICAgICAgIFZhbHVlID0+IFxAQ3VzdG9tZXJJRHMsCiAgICAgICAgICAgIFRUTCAgID0+ICRTZWxmLT57Q3VzdG9tZXJVc2VyTWFwfS0+e0NhY2hlVFRMfSwKICAgICAgICApOwogICAgfQoKICAgIHJldHVybiBAQ3VzdG9tZXJJRHM7Cn0KCnN1YiBDdXN0b21lclVzZXJEYXRhR2V0IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIGlmICggISRQYXJhbXtVc2VyfSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ05lZWQgVXNlciEnLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgYnVpbGQgc2VsZWN0CiAgICBteSAkU1FMID0gJ1NFTEVDVCAnOwogICAgRU5UUlk6CiAgICBmb3IgbXkgJEVudHJ5ICggQHsgJFNlbGYtPntDdXN0b21lclVzZXJNYXB9LT57TWFwfSB9ICkgewoKICAgICAgICBuZXh0IEVOVFJZIGlmICRFbnRyeS0+WzVdIGVxICdkeW5hbWljX2ZpZWxkJzsKCiAgICAgICAgJFNRTCAuPSAiICRFbnRyeS0+WzJdLCAiOwogICAgfQoKICAgIGlmICggISRTZWxmLT57Rm9yZWlnbkRCfSApIHsKICAgICAgICAkU1FMIC49ICJjcmVhdGVfdGltZSwgY3JlYXRlX2J5LCBjaGFuZ2VfdGltZSwgY2hhbmdlX2J5LCAiOwogICAgfQoKICAgICRTUUwgLj0gJFNlbGYtPntDdXN0b21lcktleX0gLiAiIEZST00gJFNlbGYtPntDdXN0b21lclRhYmxlfSBXSEVSRSAiOwoKICAgICMgY2hlY2sgY2FjaGUKICAgIGlmICggJFNlbGYtPntDYWNoZU9iamVjdH0gKSB7CiAgICAgICAgbXkgJERhdGEgPSAkU2VsZi0+e0NhY2hlT2JqZWN0fS0+R2V0KAogICAgICAgICAgICBUeXBlID0+ICRTZWxmLT57Q2FjaGVUeXBlfSwKICAgICAgICAgICAgS2V5ICA9PiAiQ3VzdG9tZXJVc2VyRGF0YUdldDo6JFBhcmFte1VzZXJ9IiwKICAgICAgICApOwogICAgICAgIHJldHVybiAleyREYXRhfSBpZiByZWYgJERhdGEgZXEgJ0hBU0gnOwogICAgfQoKICAgICMgY2hlY2sgY3VzdG9tZXIga2V5IHR5cGUKICAgIG15ICRVc2VyID0gJFBhcmFte1VzZXJ9OwoKICAgIGlmICggJFNlbGYtPntDYXNlU2Vuc2l0aXZlfSApIHsKICAgICAgICAkU1FMIC49ICIkU2VsZi0+e0N1c3RvbWVyS2V5fSA9ID8iOwogICAgfQogICAgZWxzZSB7CiAgICAgICAgJFNRTCAuPSAiTE9XRVIoJFNlbGYtPntDdXN0b21lcktleX0pID0gTE9XRVIoPykiOwogICAgfQoKICAgICMgYXNrIHRoZSBkYXRhYmFzZQogICAgcmV0dXJuIGlmICEkU2VsZi0+e0RCT2JqZWN0fS0+UHJlcGFyZSgKICAgICAgICBTUUwgICA9PiAkU1FMLAogICAgICAgIEJpbmQgID0+IFsgXCRVc2VyIF0sCiAgICAgICAgTGltaXQgPT4gMSwKICAgICk7CgogICAgIyBmZXRjaCB0aGUgcmVzdWx0CiAgICBteSAlRGF0YTsKICAgIFJPVzoKICAgIHdoaWxlICggbXkgQFJvdyA9ICRTZWxmLT57REJPYmplY3R9LT5GZXRjaHJvd0FycmF5KCkgKSB7CgogICAgICAgIG15ICRNYXBDb3VudGVyID0gMDsKCiAgICAgICAgRU5UUlk6CiAgICAgICAgZm9yIG15ICRFbnRyeSAoIEB7ICRTZWxmLT57Q3VzdG9tZXJVc2VyTWFwfS0+e01hcH0gfSApIHsKCiAgICAgICAgICAgIG5leHQgRU5UUlkgaWYgJEVudHJ5LT5bNV0gZXEgJ2R5bmFtaWNfZmllbGQnOwoKICAgICAgICAgICAgJERhdGF7ICRFbnRyeS0+WzBdIH0gPSAkUm93WyRNYXBDb3VudGVyXTsKICAgICAgICAgICAgJE1hcENvdW50ZXIrKzsKICAgICAgICB9CgogICAgICAgIG5leHQgUk9XIGlmICRTZWxmLT57Rm9yZWlnbkRCfTsKCiAgICAgICAgZm9yIG15ICRLZXkgKHF3KENyZWF0ZVRpbWUgQ3JlYXRlQnkgQ2hhbmdlVGltZSBDaGFuZ2VCeSkpIHsKICAgICAgICAgICAgJERhdGF7JEtleX0gPSAkUm93WyRNYXBDb3VudGVyXTsKICAgICAgICAgICAgJE1hcENvdW50ZXIrKzsKICAgICAgICB9CiAgICB9CgogICAgIyBjaGVjayBkYXRhCiAgICBpZiAoICEkRGF0YXtVc2VyTG9naW59ICkgewoKICAgICAgICAjIGNhY2hlIHJlcXVlc3QKICAgICAgICBpZiAoICRTZWxmLT57Q2FjaGVPYmplY3R9ICkgewogICAgICAgICAgICAkU2VsZi0+e0NhY2hlT2JqZWN0fS0+U2V0KAogICAgICAgICAgICAgICAgVHlwZSAgPT4gJFNlbGYtPntDYWNoZVR5cGV9LAogICAgICAgICAgICAgICAgS2V5ICAgPT4gIkN1c3RvbWVyVXNlckRhdGFHZXQ6OiRQYXJhbXtVc2VyfSIsCiAgICAgICAgICAgICAgICBWYWx1ZSA9PiB7fSwKICAgICAgICAgICAgICAgIFRUTCAgID0+ICRTZWxmLT57Q3VzdG9tZXJVc2VyTWFwfS0+e0NhY2hlVFRMfSwKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIG15ICRDdXN0b21lclVzZXJMaXN0RmllbGRzTWFwID0gJFNlbGYtPntDdXN0b21lclVzZXJNYXB9LT57Q3VzdG9tZXJVc2VyTGlzdEZpZWxkc307CiAgICBpZiAoICFJc0FycmF5UmVmV2l0aERhdGEoJEN1c3RvbWVyVXNlckxpc3RGaWVsZHNNYXApICkgewogICAgICAgICRDdXN0b21lclVzZXJMaXN0RmllbGRzTWFwID0gWyAnZmlyc3RfbmFtZScsICdsYXN0X25hbWUnLCAnZW1haWwnLCBdOwogICAgfQoKICAgICMgT3JkZXIgZmllbGRzIGJ5IEN1c3RvbWVyVXNlckxpc3RGaWVsZHMgKHNlZSBidWcjMTM4MjEpLgogICAgbXkgQEN1c3RvbWVyVXNlckxpc3RGaWVsZHM7CiAgICBmb3IgbXkgJEZpZWxkICggQHskQ3VzdG9tZXJVc2VyTGlzdEZpZWxkc01hcH0gKSB7CiAgICAgICAgbXkgQEZpZWxkTmFtZXMgPSBtYXAgeyAkXy0+WzBdIH0gZ3JlcCB7ICRfLT5bMl0gZXEgJEZpZWxkIH0gQHsgJFNlbGYtPntDdXN0b21lclVzZXJNYXB9LT57TWFwfSB9OwogICAgICAgIHB1c2ggQEN1c3RvbWVyVXNlckxpc3RGaWVsZHMsICRGaWVsZE5hbWVzWzBdOwogICAgfQoKICAgIG15ICRVc2VyTWFpbFN0cmluZyA9ICcnOwogICAgbXkgQFVzZXJNYWlsU3RyaW5nUGFydHM7CgogICAgRklFTEQ6CiAgICBmb3IgbXkgJEZpZWxkIChAQ3VzdG9tZXJVc2VyTGlzdEZpZWxkcykgewogICAgICAgIG5leHQgRklFTEQgaWYgISREYXRheyRGaWVsZH07CgogICAgICAgIHB1c2ggQFVzZXJNYWlsU3RyaW5nUGFydHMsICREYXRheyRGaWVsZH07CiAgICB9CiAgICAkVXNlck1haWxTdHJpbmcgPSBqb2luICcgJywgQFVzZXJNYWlsU3RyaW5nUGFydHM7CiAgICAkVXNlck1haWxTdHJpbmcgPX4gcy9eKC4qKVxzKC4rP1xALis/XC4uKz8pKFxzfCkkLyIkMSIgPCQyPi87CgogICAgIyBhZGQgdGhlIFVzZXJNYWlsU3RyaW5nIHRvIHRoZSBkYXRhIGhhc2gKICAgICREYXRhe1VzZXJNYWlsU3RyaW5nfSA9ICRVc2VyTWFpbFN0cmluZzsKCiAgICAjIGNvbXBhdCEKICAgICREYXRhe1VzZXJJRH0gPSAkRGF0YXtVc2VyTG9naW59OwoKICAgICMgZ2V0IHByZWZlcmVuY2VzCiAgICBteSAlUHJlZmVyZW5jZXMgPSAkU2VsZi0+R2V0UHJlZmVyZW5jZXMoIFVzZXJJRCA9PiAkRGF0YXtVc2VySUR9ICk7CgogICAgIyBhZGQgbGFzdCBsb2dpbiB0aW1lc3RhbXAKICAgIGlmICggJFByZWZlcmVuY2Vze1VzZXJMYXN0TG9naW59ICkgewoKICAgICAgICBteSAkRGF0ZVRpbWVPYmplY3QgPSAkS2VybmVsOjpPTS0+Q3JlYXRlKAogICAgICAgICAgICAnS2VybmVsOjpTeXN0ZW06OkRhdGVUaW1lJywKICAgICAgICAgICAgT2JqZWN0UGFyYW1zID0+IHsKICAgICAgICAgICAgICAgIEVwb2NoID0+ICRQcmVmZXJlbmNlc3tVc2VyTGFzdExvZ2lufSwKICAgICAgICAgICAgfSwKICAgICAgICApOwoKICAgICAgICAkUHJlZmVyZW5jZXN7VXNlckxhc3RMb2dpblRpbWVzdGFtcH0gPSAkRGF0ZVRpbWVPYmplY3QtPlRvU3RyaW5nKCk7CgogICAgfQoKICAgICMgY2FjaGUgcmVxdWVzdAogICAgaWYgKCAkU2VsZi0+e0NhY2hlT2JqZWN0fSApIHsKICAgICAgICAkU2VsZi0+e0NhY2hlT2JqZWN0fS0+U2V0KAogICAgICAgICAgICBUeXBlICA9PiAkU2VsZi0+e0NhY2hlVHlwZX0sCiAgICAgICAgICAgIEtleSAgID0+ICJDdXN0b21lclVzZXJEYXRhR2V0OjokUGFyYW17VXNlcn0iLAogICAgICAgICAgICBWYWx1ZSA9PiB7ICVEYXRhLCAlUHJlZmVyZW5jZXMgfSwKICAgICAgICAgICAgVFRMICAgPT4gJFNlbGYtPntDdXN0b21lclVzZXJNYXB9LT57Q2FjaGVUVEx9LAogICAgICAgICk7CiAgICB9CgogICAgcmV0dXJuICggJURhdGEsICVQcmVmZXJlbmNlcyApOwp9CgpzdWIgQ3VzdG9tZXJVc2VyQWRkIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBjaGVjayByby9ydwogICAgaWYgKCAkU2VsZi0+e1JlYWRPbmx5fSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ0N1c3RvbWVyIGJhY2tlbmQgaXMgcmVhZCBvbmx5IScsCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgIyBjaGVjayBuZWVkZWQgc3R1ZmYKICAgIEVOVFJZOgogICAgZm9yIG15ICRFbnRyeSAoIEB7ICRTZWxmLT57Q3VzdG9tZXJVc2VyTWFwfS0+e01hcH0gfSApIHsKICAgICAgICBpZiAoICEkUGFyYW17ICRFbnRyeS0+WzBdIH0gJiYgJEVudHJ5LT5bNF0gKSB7CgogICAgICAgICAgICAjIHNraXAgVXNlckxvZ2luLCB3aWxsIGJlIGNoZWNrZWQgbGF0ZXIKICAgICAgICAgICAgbmV4dCBFTlRSWSBpZiAoICRFbnRyeS0+WzBdIGVxICdVc2VyTG9naW4nICk7CgogICAgICAgICAgICAjIGlnbm9yZSBkeW5hbWljIGZpZWxkcyBoZXJlCiAgICAgICAgICAgIG5leHQgRU5UUlkgaWYgJEVudHJ5LT5bNV0gZXEgJ2R5bmFtaWNfZmllbGQnOwoKICAgICAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICAgICAgTWVzc2FnZSAgPT4gIk5lZWQgJEVudHJ5LT5bMF0hIiwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KICAgIGlmICggISRQYXJhbXtVc2VySUR9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnTmVlZCBVc2VySUQhJywKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIGlmIG5vIFVzZXJMb2dpbiBpcyBnaXZlbgogICAgaWYgKCAhJFBhcmFte1VzZXJMb2dpbn0gJiYgJFNlbGYtPntDdXN0b21lclVzZXJNYXB9LT57QXV0b0xvZ2luQ3JlYXRpb259ICkgewoKICAgICAgICAjIGdldCB0aW1lIG9iamVjdAogICAgICAgIG15ICREYXRlVGltZU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5DcmVhdGUoJ0tlcm5lbDo6U3lzdGVtOjpEYXRlVGltZScpOwogICAgICAgIG15ICREYXRlVGltZVN0cmluZyA9ICREYXRlVGltZU9iamVjdC0+Rm9ybWF0KCBGb3JtYXQgPT4gJyVZJW0lZCVIJU0nICk7CgogICAgICAgIG15ICRQcmVmaXggPSAkU2VsZi0+e0N1c3RvbWVyVXNlck1hcH0tPntBdXRvTG9naW5DcmVhdGlvblByZWZpeH0gfHwgJ2F1dG8nOwogICAgICAgICRQYXJhbXtVc2VyTG9naW59ID0gIiRQcmVmaXgtJERhdGVUaW1lU3RyaW5nIiAuIGludCggcmFuZCg5OSkgKTsKICAgIH0KCiAgICAjIGNoZWNrIGlmIHVzZXIgbG9naW4gZXhpc3RzCiAgICBpZiAoICEkUGFyYW17VXNlckxvZ2lufSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ05lZWQgVXNlckxvZ2luIScsCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgIyBjaGVjayBlbWFpbCBhZGRyZXNzIGlmIGFscmVhZHkgZXhpc3RzCiAgICBpZiAoICRQYXJhbXtVc2VyRW1haWx9ICYmICRTZWxmLT57Q3VzdG9tZXJVc2VyTWFwfS0+e0N1c3RvbWVyVXNlckVtYWlsVW5pcUNoZWNrfSApIHsKICAgICAgICBteSAlUmVzdWx0ID0gJFNlbGYtPkN1c3RvbWVyU2VhcmNoKAogICAgICAgICAgICBWYWxpZCAgICAgICAgICAgID0+IDAsCiAgICAgICAgICAgIFBvc3RNYXN0ZXJTZWFyY2ggPT4gJFBhcmFte1VzZXJFbWFpbH0sCiAgICAgICAgICAgIFVzZXJJRCA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgKTsKICAgICAgICBpZiAoJVJlc3VsdCkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6Okxhbmd1YWdlJykKICAgICAgICAgICAgICAgICAgICAtPlRyYW5zbGF0ZSgnVGhpcyBlbWFpbCBhZGRyZXNzIGlzIGFscmVhZHkgaW4gdXNlIGZvciBhbm90aGVyIGN1c3RvbWVyIHVzZXIuJyksCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgIyBnZXQgY2hlY2sgaXRlbSBvYmplY3QKICAgIG15ICRDaGVja0l0ZW1PYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Q2hlY2tJdGVtJyk7CgogICAgIyBjaGVjayBlbWFpbCBhZGRyZXNzIG14CiAgICBpZiAoCiAgICAgICAgJFBhcmFte1VzZXJFbWFpbH0KICAgICAgICAmJiAhJENoZWNrSXRlbU9iamVjdC0+Q2hlY2tFbWFpbCggQWRkcmVzcyA9PiAkUGFyYW17VXNlckVtYWlsfSApCiAgICAgICAgJiYgZ3JlcCB7ICRfIGVxICRQYXJhbXtWYWxpZElEfSB9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpWYWxpZCcpLT5WYWxpZElEc0dldCgpCiAgICAgICAgKQogICAgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiRW1haWwgYWRkcmVzcyAoJFBhcmFte1VzZXJFbWFpbH0pIG5vdCB2YWxpZCAoIgogICAgICAgICAgICAgICAgLiAkQ2hlY2tJdGVtT2JqZWN0LT5DaGVja0Vycm9yKCkgLiAiKSEiLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgcXVvdGUgdmFsdWVzCiAgICBteSAlVmFsdWU7CiAgICBmb3IgbXkgJEVudHJ5ICggQHsgJFNlbGYtPntDdXN0b21lclVzZXJNYXB9LT57TWFwfSB9ICkgewogICAgICAgIGlmICggJEVudHJ5LT5bNV0gPX4gL15pbnQkL2kgKSB7CiAgICAgICAgICAgIGlmICggJFBhcmFteyAkRW50cnktPlswXSB9ICkgewogICAgICAgICAgICAgICAgJFZhbHVleyAkRW50cnktPlswXSB9ID0gJFBhcmFteyAkRW50cnktPlswXSB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJFZhbHVleyAkRW50cnktPlswXSB9ID0gMDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYgKCAkUGFyYW17ICRFbnRyeS0+WzBdIH0gKSB7CiAgICAgICAgICAgICAgICAkVmFsdWV7ICRFbnRyeS0+WzBdIH0gPSAkUGFyYW17ICRFbnRyeS0+WzBdIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkVmFsdWV7ICRFbnRyeS0+WzBdIH0gPSAnJzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAjIGJ1aWxkIGluc2VydAogICAgbXkgJFNRTCA9ICJJTlNFUlQgSU5UTyAkU2VsZi0+e0N1c3RvbWVyVGFibGV9ICgiOwogICAgbXkgQEJpbmQ7CiAgICBteSAlU2VlbktleTsgICAgIyBJZiB0aGUgbWFwIGNvbnRhaW5zIGR1cGxpY2F0ZWQgZmllbGQgbmFtZXMsIGluc2VydCBvbmx5IG9uY2UuCiAgICBteSBAQ29sdW1uTmFtZXM7CgogICAgTUFQRU5UUlk6CiAgICBmb3IgbXkgJEVudHJ5ICggQHsgJFNlbGYtPntDdXN0b21lclVzZXJNYXB9LT57TWFwfSB9ICkgewogICAgICAgIG5leHQgTUFQRU5UUlkgaWYgJEVudHJ5LT5bNV0gZXEgJ2R5bmFtaWNfZmllbGQnOyAgICAgICAgICAgICMgc2tpcCBkeW5hbWljIGZpZWxkcwogICAgICAgIG5leHQgTUFQRU5UUlkgaWYgKCBsYyggJEVudHJ5LT5bMF0gKSBlcSAidXNlcnBhc3N3b3JkIiApOwogICAgICAgIG5leHQgTUFQRU5UUlkgaWYgJFNlZW5LZXl7ICRFbnRyeS0+WzJdIH0rKzsKICAgICAgICBwdXNoIEBDb2x1bW5OYW1lcywgJEVudHJ5LT5bMl07CiAgICB9CgogICAgJFNRTCAuPSBqb2luICcsICcsIEBDb2x1bW5OYW1lczsKCiAgICBpZiAoICEkU2VsZi0+e0ZvcmVpZ25EQn0gKSB7CiAgICAgICAgJFNRTCAuPSAnLCBjcmVhdGVfdGltZSwgY3JlYXRlX2J5LCBjaGFuZ2VfdGltZSwgY2hhbmdlX2J5JzsKICAgIH0KCiAgICAkU1FMIC49ICcpIFZBTFVFUyAoJzsKCiAgICBteSAlU2VlblZhbHVlOwogICAgbXkgJEJpbmRDb2x1bW5zID0gMDsKCiAgICBFTlRSWToKICAgIGZvciBteSAkRW50cnkgKCBAeyAkU2VsZi0+e0N1c3RvbWVyVXNlck1hcH0tPntNYXB9IH0gKSB7CiAgICAgICAgbmV4dCBFTlRSWSBpZiAkRW50cnktPls1XSBlcSAnZHluYW1pY19maWVsZCc7ICAgICAgICAgICAgIyBza2lwIGR5bmFtaWMgZmllbGRzCiAgICAgICAgbmV4dCBFTlRSWSBpZiAoIGxjKCAkRW50cnktPlswXSApIGVxICJ1c2VycGFzc3dvcmQiICk7CiAgICAgICAgbmV4dCBFTlRSWSBpZiAkU2VlblZhbHVleyAkRW50cnktPlsyXSB9Kys7CiAgICAgICAgJEJpbmRDb2x1bW5zKys7CiAgICAgICAgcHVzaCBAQmluZCwgXCRWYWx1ZXsgJEVudHJ5LT5bMF0gfTsKICAgIH0KCiAgICAkU1FMIC49IGpvaW4gJywgJywgKCc/JykgeCAkQmluZENvbHVtbnM7CgogICAgaWYgKCAhJFNlbGYtPntGb3JlaWduREJ9ICkgewogICAgICAgICRTUUwgLj0gJywgY3VycmVudF90aW1lc3RhbXAsID8sIGN1cnJlbnRfdGltZXN0YW1wLCA/JzsKICAgICAgICBwdXNoIEBCaW5kLCBcJFBhcmFte1VzZXJJRH07CiAgICAgICAgcHVzaCBAQmluZCwgXCRQYXJhbXtVc2VySUR9OwogICAgfQoKICAgICRTUUwgLj0gJyknOwoKICAgIHJldHVybiBpZiAhJFNlbGYtPntEQk9iamVjdH0tPkRvKAogICAgICAgIFNRTCAgPT4gJFNRTCwKICAgICAgICBCaW5kID0+IFxAQmluZAogICAgKTsKCiAgICAjIGxvZyBub3RpY2UKICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgIFByaW9yaXR5ID0+ICdpbmZvJywKICAgICAgICBNZXNzYWdlICA9PiAiQ3VzdG9tZXJVc2VyOiAnJFBhcmFte1VzZXJMb2dpbn0nIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5ICgkUGFyYW17VXNlcklEfSkhIiwKICAgICk7CgogICAgIyBzZXQgcGFzc3dvcmQKICAgIGlmICggJFBhcmFte1VzZXJQYXNzd29yZH0gKSB7CiAgICAgICAgJFNlbGYtPlNldFBhc3N3b3JkKAogICAgICAgICAgICBVc2VyTG9naW4gPT4gJFBhcmFte1VzZXJMb2dpbn0sCiAgICAgICAgICAgIFBXICAgICAgICA9PiAkUGFyYW17VXNlclBhc3N3b3JkfQogICAgICAgICk7CiAgICB9CgogICAgJFNlbGYtPl9DdXN0b21lclVzZXJDYWNoZUNsZWFyKCBVc2VyTG9naW4gPT4gJFBhcmFte1VzZXJMb2dpbn0gKTsKCiAgICByZXR1cm4gJFBhcmFte1VzZXJMb2dpbn07Cn0KCnN1YiBDdXN0b21lclVzZXJVcGRhdGUgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIHJvL3J3CiAgICBpZiAoICRTZWxmLT57UmVhZE9ubHl9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnQ3VzdG9tZXIgYmFja2VuZCBpcyByZWFkIG9ubHkhJywKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIGNoZWNrIG5lZWRlZCBzdHVmZgogICAgZm9yIG15ICRFbnRyeSAoIEB7ICRTZWxmLT57Q3VzdG9tZXJVc2VyTWFwfS0+e01hcH0gfSApIHsKICAgICAgICBpZiAoCiAgICAgICAgICAgICEkUGFyYW17ICRFbnRyeS0+WzBdIH0KICAgICAgICAgICAgJiYgJEVudHJ5LT5bNV0gbmUgJ2R5bmFtaWNfZmllbGQnICAgICMgaWdub3JlIGR5bmFtaWMgZmllbGRzIGhlcmUKICAgICAgICAgICAgJiYgJEVudHJ5LT5bNF0gICAgICAgICAgICAgICAgICAgICAgICMgb25seSBjaGVjayByZXF1aXJlZCBmaWVsZHMKICAgICAgICAgICAgJiYgJEVudHJ5LT5bMF0gbmUgJ1VzZXJQYXNzd29yZCcgICAgICMgaWdub3JlIFVzZXJQYXNzd29yZCBmaWVsZAogICAgICAgICAgICApCiAgICAgICAgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZCAkRW50cnktPlswXSEiLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgICMgZ2V0IGNoZWNrIGl0ZW0gb2JqZWN0CiAgICBteSAkQ2hlY2tJdGVtT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkNoZWNrSXRlbScpOwoKICAgICMgY2hlY2sgZW1haWwgYWRkcmVzcwogICAgaWYgKAogICAgICAgICRQYXJhbXtVc2VyRW1haWx9CiAgICAgICAgJiYgISRDaGVja0l0ZW1PYmplY3QtPkNoZWNrRW1haWwoIEFkZHJlc3MgPT4gJFBhcmFte1VzZXJFbWFpbH0gKQogICAgICAgICYmIGdyZXAgeyAkXyBlcSAkUGFyYW17VmFsaWRJRH0gfSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VmFsaWQnKS0+VmFsaWRJRHNHZXQoKQogICAgICAgICkKICAgIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gIkVtYWlsIGFkZHJlc3MgKCRQYXJhbXtVc2VyRW1haWx9KSBub3QgdmFsaWQgKCIKICAgICAgICAgICAgICAgIC4gJENoZWNrSXRlbU9iamVjdC0+Q2hlY2tFcnJvcigpIC4gIikhIiwKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIGdldCBvbGQgdXNlciBkYXRhIChwdykKICAgIG15ICVVc2VyRGF0YSA9ICRTZWxmLT5DdXN0b21lclVzZXJEYXRhR2V0KCBVc2VyID0+ICRQYXJhbXtJRH0gKTsKCiAgICAjIGlmIHdlIHVwZGF0ZSB0aGUgZW1haWwgYWRkcmVzcywgY2hlY2sgaWYgaXQgYWxyZWFkeSBleGlzdHMKICAgIGlmICgKICAgICAgICAkUGFyYW17VXNlckVtYWlsfQogICAgICAgICYmICRTZWxmLT57Q3VzdG9tZXJVc2VyTWFwfS0+e0N1c3RvbWVyVXNlckVtYWlsVW5pcUNoZWNrfQogICAgICAgICYmIGxjICRQYXJhbXtVc2VyRW1haWx9IG5lIGxjICRVc2VyRGF0YXtVc2VyRW1haWx9CiAgICAgICAgKQogICAgewogICAgICAgIG15ICVSZXN1bHQgPSAkU2VsZi0+Q3VzdG9tZXJTZWFyY2goCiAgICAgICAgICAgIFZhbGlkICAgICAgICAgICAgPT4gMCwKICAgICAgICAgICAgUG9zdE1hc3RlclNlYXJjaCA9PiAkUGFyYW17VXNlckVtYWlsfSwKICAgICAgICAgICAgVXNlcklEID0+ICRTZWxmLT57VXNlcklEfSwKICAgICAgICApOwogICAgICAgIGlmICglUmVzdWx0KSB7CiAgICAgICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgICAgIE1lc3NhZ2UgID0+ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6TGFuZ3VhZ2UnKQogICAgICAgICAgICAgICAgICAgIC0+VHJhbnNsYXRlKCdUaGlzIGVtYWlsIGFkZHJlc3MgaXMgYWxyZWFkeSBpbiB1c2UgZm9yIGFub3RoZXIgY3VzdG9tZXIgdXNlci4nKSwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgIH0KCiAgICAjIHF1b3RlIHZhbHVlcwogICAgbXkgJVZhbHVlOwogICAgZm9yIG15ICRFbnRyeSAoIEB7ICRTZWxmLT57Q3VzdG9tZXJVc2VyTWFwfS0+e01hcH0gfSApIHsKICAgICAgICBpZiAoICRFbnRyeS0+WzVdID1+IC9eaW50JC9pICkgewogICAgICAgICAgICBpZiAoICRQYXJhbXsgJEVudHJ5LT5bMF0gfSApIHsKICAgICAgICAgICAgICAgICRWYWx1ZXsgJEVudHJ5LT5bMF0gfSA9ICRQYXJhbXsgJEVudHJ5LT5bMF0gfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRWYWx1ZXsgJEVudHJ5LT5bMF0gfSA9IDA7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmICggJFBhcmFteyAkRW50cnktPlswXSB9ICkgewogICAgICAgICAgICAgICAgJFZhbHVleyAkRW50cnktPlswXSB9ID0gJFBhcmFteyAkRW50cnktPlswXSB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJFZhbHVleyAkRW50cnktPlswXSB9ID0gIiI7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgIyB1cGRhdGUgZGIKICAgIG15ICRTUUwgPSAiVVBEQVRFICRTZWxmLT57Q3VzdG9tZXJUYWJsZX0gU0VUICI7CiAgICBteSBAQmluZDsKCiAgICBteSAlU2VlbktleTsgICAgIyBJZiB0aGUgbWFwIGNvbnRhaW5zIGR1cGxpY2F0ZWQgZmllbGQgbmFtZXMsIGluc2VydCBvbmx5IG9uY2UuCiAgICBFTlRSWToKICAgIGZvciBteSAkRW50cnkgKCBAeyAkU2VsZi0+e0N1c3RvbWVyVXNlck1hcH0tPntNYXB9IH0gKSB7CiAgICAgICAgbmV4dCBFTlRSWSBpZiAkRW50cnktPls1XSBlcSAnZHluYW1pY19maWVsZCc7ICAgICAgICAgICAgIyBza2lwIGR5bmFtaWMgZmllbGRzCiAgICAgICAgbmV4dCBFTlRSWSBpZiAkRW50cnktPls3XTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBza2lwIHJlYWRvbmx5IGZpZWxkcwogICAgICAgIG5leHQgRU5UUlkgaWYgKCBsYyggJEVudHJ5LT5bMF0gKSBlcSAidXNlcnBhc3N3b3JkIiApOwogICAgICAgIG5leHQgRU5UUlkgaWYgJFNlZW5LZXl7ICRFbnRyeS0+WzJdIH0rKzsKICAgICAgICAkU1FMIC49ICIgJEVudHJ5LT5bMl0gPSA/LCAiOwogICAgICAgIHB1c2ggQEJpbmQsIFwkVmFsdWV7ICRFbnRyeS0+WzBdIH07CiAgICB9CgogICAgaWYgKCAhJFNlbGYtPntGb3JlaWduREJ9ICkgewogICAgICAgICRTUUwgLj0gJ2NoYW5nZV90aW1lID0gY3VycmVudF90aW1lc3RhbXAsIGNoYW5nZV9ieSA9ID8nOwogICAgICAgIHB1c2ggQEJpbmQsIFwkUGFyYW17VXNlcklEfTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIGNob3AgJFNRTDsKICAgICAgICBjaG9wICRTUUw7CiAgICB9CgogICAgJFNRTCAuPSAnIFdIRVJFICc7CgogICAgaWYgKCAkU2VsZi0+e0Nhc2VTZW5zaXRpdmV9ICkgewogICAgICAgICRTUUwgLj0gIiRTZWxmLT57Q3VzdG9tZXJLZXl9ID0gPyI7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICAkU1FMIC49ICJMT1dFUigkU2VsZi0+e0N1c3RvbWVyS2V5fSkgPSBMT1dFUig/KSI7CiAgICB9CiAgICBwdXNoIEBCaW5kLCBcJFBhcmFte0lEfTsKCiAgICByZXR1cm4gaWYgISRTZWxmLT57REJPYmplY3R9LT5EbygKICAgICAgICBTUUwgID0+ICRTUUwsCiAgICAgICAgQmluZCA9PiBcQEJpbmQKICAgICk7CgogICAgIyBjaGVjayBpZiB3ZSBuZWVkIHRvIHVwZGF0ZSBDdXN0b21lciBQcmVmZXJlbmNlcwogICAgaWYgKCAkUGFyYW17VXNlckxvZ2lufSBuZSAkVXNlckRhdGF7VXNlckxvZ2lufSApIHsKCiAgICAgICAgIyB1cGRhdGUgdGhlIHByZWZlcmVuY2VzCiAgICAgICAgJFNlbGYtPntQcmVmZXJlbmNlc09iamVjdH0tPlJlbmFtZVByZWZlcmVuY2VzKAogICAgICAgICAgICBOZXdVc2VySUQgPT4gJFBhcmFte1VzZXJMb2dpbn0sCiAgICAgICAgICAgIE9sZFVzZXJJRCA9PiAkVXNlckRhdGF7VXNlckxvZ2lufSwKICAgICAgICApOwogICAgfQoKICAgICMgY2hlY2sgcHcKICAgIGlmICggJFBhcmFte1VzZXJQYXNzd29yZH0gKSB7CiAgICAgICAgJFNlbGYtPlNldFBhc3N3b3JkKAogICAgICAgICAgICBVc2VyTG9naW4gPT4gJFBhcmFte1VzZXJMb2dpbn0sCiAgICAgICAgICAgIFBXICAgICAgICA9PiAkUGFyYW17VXNlclBhc3N3b3JkfQogICAgICAgICk7CiAgICB9CgogICAgJFNlbGYtPl9DdXN0b21lclVzZXJDYWNoZUNsZWFyKCBVc2VyTG9naW4gPT4gJFBhcmFte1VzZXJMb2dpbn0gKTsKICAgIGlmICggJFBhcmFte1VzZXJMb2dpbn0gbmUgJFVzZXJEYXRhe1VzZXJMb2dpbn0gKSB7CiAgICAgICAgJFNlbGYtPl9DdXN0b21lclVzZXJDYWNoZUNsZWFyKCBVc2VyTG9naW4gPT4gJFVzZXJEYXRhe1VzZXJMb2dpbn0gKTsKICAgIH0KCiAgICByZXR1cm4gMTsKfQoKc3ViIFNldFBhc3N3b3JkIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJExvZ2luID0gJFBhcmFte1VzZXJMb2dpbn07CiAgICBteSAkUHcgICAgPSAkUGFyYW17UFd9IHx8ICcnOwoKICAgICMgY2hlY2sgcm8vcncKICAgIGlmICggJFNlbGYtPntSZWFkT25seX0gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdDdXN0b21lciBiYWNrZW5kIGlzIHJlYWQgb25seSEnLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBpZiAoICEkUGFyYW17VXNlckxvZ2lufSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ05lZWQgVXNlckxvZ2luIScsCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBteSAkQ3J5cHRlZFB3ID0gJyc7CgogICAgbXkgJENvbmZpZ09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CgogICAgbXkgJENyeXB0VHlwZSA9ICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXI6OkF1dGhNb2R1bGU6OkRCOjpDcnlwdFR5cGUnKSB8fCAnc2hhMic7CgogICAgIyBnZXQgZW5jb2RlIG9iamVjdAogICAgbXkgJEVuY29kZU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpFbmNvZGUnKTsKCiAgICAjIGNyeXB0IHBsYWluIChubyBjcnlwdCBhdCBhbGwpCiAgICBpZiAoICRDcnlwdFR5cGUgZXEgJ3BsYWluJyApIHsKICAgICAgICAkQ3J5cHRlZFB3ID0gJFB3OwogICAgfQoKICAgICMgY3J5cHQgd2l0aCB1bml4IGNyeXB0CiAgICBlbHNpZiAoICRDcnlwdFR5cGUgZXEgJ2NyeXB0JyApIHsKCiAgICAgICAgIyBlbmNvZGUgb3V0cHV0LCBuZWVkZWQgYnkgY3J5cHQoKSBvbmx5IG5vbiB1dGY4IHNpZ25zCiAgICAgICAgJEVuY29kZU9iamVjdC0+RW5jb2RlT3V0cHV0KCBcJFB3ICk7CiAgICAgICAgJEVuY29kZU9iamVjdC0+RW5jb2RlT3V0cHV0KCBcJExvZ2luICk7CgogICAgICAgICRDcnlwdGVkUHcgPSBjcnlwdCggJFB3LCAkTG9naW4gKTsKICAgICAgICAkRW5jb2RlT2JqZWN0LT5FbmNvZGVJbnB1dCggXCRDcnlwdGVkUHcgKTsKICAgIH0KCiAgICAjIGNyeXB0IHdpdGggbWQ1IGNyeXB0CiAgICBlbHNpZiAoICRDcnlwdFR5cGUgZXEgJ21kNScgfHwgISRDcnlwdFR5cGUgKSB7CgogICAgICAgICMgZW5jb2RlIG91dHB1dCwgbmVlZGVkIGJ5IHVuaXhfbWQ1X2NyeXB0KCkgb25seSBub24gdXRmOCBzaWducwogICAgICAgICRFbmNvZGVPYmplY3QtPkVuY29kZU91dHB1dCggXCRQdyApOwogICAgICAgICRFbmNvZGVPYmplY3QtPkVuY29kZU91dHB1dCggXCRMb2dpbiApOwoKICAgICAgICAkQ3J5cHRlZFB3ID0gdW5peF9tZDVfY3J5cHQoICRQdywgJExvZ2luICk7CiAgICAgICAgJEVuY29kZU9iamVjdC0+RW5jb2RlSW5wdXQoIFwkQ3J5cHRlZFB3ICk7CiAgICB9CgogICAgIyBjcnlwdCB3aXRoIG1kNSBjcnlwdCAoY29tcGF0aWJsZSB3aXRoIEFwYWNoZSdzIC5odHBhc3N3ZCBmaWxlcykKICAgIGVsc2lmICggJENyeXB0VHlwZSBlcSAnYXByMScgKSB7CgogICAgICAgICMgZW5jb2RlIG91dHB1dCwgbmVlZGVkIGJ5IGFwYWNoZV9tZDVfY3J5cHQoKSBvbmx5IG5vbiB1dGY4IHNpZ25zCiAgICAgICAgJEVuY29kZU9iamVjdC0+RW5jb2RlT3V0cHV0KCBcJFB3ICk7CiAgICAgICAgJEVuY29kZU9iamVjdC0+RW5jb2RlT3V0cHV0KCBcJExvZ2luICk7CgogICAgICAgICRDcnlwdGVkUHcgPSBhcGFjaGVfbWQ1X2NyeXB0KCAkUHcsICRMb2dpbiApOwogICAgICAgICRFbmNvZGVPYmplY3QtPkVuY29kZUlucHV0KCBcJENyeXB0ZWRQdyApOwogICAgfQoKICAgICMgY3J5cHQgd2l0aCBzaGExCiAgICBlbHNpZiAoICRDcnlwdFR5cGUgZXEgJ3NoYTEnICkgewoKICAgICAgICBteSAkU0hBT2JqZWN0ID0gRGlnZXN0OjpTSEEtPm5ldygnc2hhMScpOwogICAgICAgICRFbmNvZGVPYmplY3QtPkVuY29kZU91dHB1dCggXCRQdyApOwogICAgICAgICRTSEFPYmplY3QtPmFkZCgkUHcpOwogICAgICAgICRDcnlwdGVkUHcgPSAkU0hBT2JqZWN0LT5oZXhkaWdlc3QoKTsKICAgIH0KCiAgICBlbHNpZiAoICRDcnlwdFR5cGUgZXEgJ3NoYTUxMicgKSB7CgogICAgICAgIG15ICRTSEFPYmplY3QgPSBEaWdlc3Q6OlNIQS0+bmV3KCdzaGE1MTInKTsKICAgICAgICAkRW5jb2RlT2JqZWN0LT5FbmNvZGVPdXRwdXQoIFwkUHcgKTsKICAgICAgICAkU0hBT2JqZWN0LT5hZGQoJFB3KTsKICAgICAgICAkQ3J5cHRlZFB3ID0gJFNIQU9iamVjdC0+aGV4ZGlnZXN0KCk7CiAgICB9CgogICAgIyBiY3J5cHQKICAgIGVsc2lmICggJENyeXB0VHlwZSBlcSAnYmNyeXB0JyApIHsKCiAgICAgICAgIyBnZXQgbWFpbiBvYmplY3QKICAgICAgICBteSAkTWFpbk9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpNYWluJyk7CgogICAgICAgIGlmICggISRNYWluT2JqZWN0LT5SZXF1aXJlKCdDcnlwdDo6RWtzYmxvd2Zpc2g6OkJjcnlwdCcpICkgewogICAgICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgICAgICBNZXNzYWdlID0+CiAgICAgICAgICAgICAgICAgICAgIkN1c3RvbWVyVXNlcjogJyRMb2dpbicgdHJpZWQgdG8gc3RvcmUgcGFzc3dvcmQgd2l0aCBiY3J5cHQgYnV0ICdDcnlwdDo6RWtzYmxvd2Zpc2g6OkJjcnlwdCcgaXMgbm90IGluc3RhbGxlZCEiLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBteSAkQ29zdCA9ICRDb25maWdPYmplY3QtPkdldCgnQ3VzdG9tZXI6OkF1dGhNb2R1bGU6OkRCOjpiY3J5cHRDb3N0JykgLy8gMTI7CgogICAgICAgICMgRG9uJ3QgYWxsb3cgdmFsdWVzIHNtYWxsZXIgdGhhbiA5IGZvciBzZWN1cml0eS4KICAgICAgICAkQ29zdCA9IDkgaWYgJENvc3QgPCA5OwoKICAgICAgICAjIEN1cnJlbnQgQ3J5cHQ6OkVrc2Jsb3dmaXNoOjpCY3J5cHQgbGltaXQgaXMgMzEuCiAgICAgICAgJENvc3QgPSAzMSBpZiAkQ29zdCA+IDMxOwoKICAgICAgICBteSAkU2FsdCA9ICRNYWluT2JqZWN0LT5HZW5lcmF0ZVJhbmRvbVN0cmluZyggTGVuZ3RoID0+IDE2ICk7CgogICAgICAgICMgcmVtb3ZlIFVURjggZmxhZywgcmVxdWlyZWQgYnkgQ3J5cHQ6OkVrc2Jsb3dmaXNoOjpCY3J5cHQKICAgICAgICAkRW5jb2RlT2JqZWN0LT5FbmNvZGVPdXRwdXQoIFwkUHcgKTsKCiAgICAgICAgIyBjYWxjdWxhdGUgcGFzc3dvcmQgaGFzaAogICAgICAgIG15ICRPY3RldHMgPSBDcnlwdDo6RWtzYmxvd2Zpc2g6OkJjcnlwdDo6YmNyeXB0X2hhc2goCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGtleV9udWwgPT4gMSwKICAgICAgICAgICAgICAgIGNvc3QgICAgPT4gJENvc3QsCiAgICAgICAgICAgICAgICBzYWx0ICAgID0+ICRTYWx0LAogICAgICAgICAgICB9LAogICAgICAgICAgICAkUHcKICAgICAgICApOwoKICAgICAgICAjIFdlIHdpbGwgc3RvcmUgY29zdCBhbmQgc2FsdCBpbiB0aGUgcGFzc3dvcmQgc3RyaW5nIHNvIHRoYXQgaXQgY2FuIGJlIGRlY29kZWQKICAgICAgICAjICAgaW4gZnV0dXJlIGV2ZW4gaWYgd2UgdXNlIGEgaGlnaGVyIGNvc3QgYnkgZGVmYXVsdC4KICAgICAgICAkQ3J5cHRlZFB3ID0gIkJDUllQVDokQ29zdDokU2FsdDoiIC4gQ3J5cHQ6OkVrc2Jsb3dmaXNoOjpCY3J5cHQ6OmVuX2Jhc2U2NCgkT2N0ZXRzKTsKICAgIH0KCiAgICAjIGNyeXB0IHdpdGggc2hhMiBhcyBmYWxsYmFjawogICAgZWxzZSB7CgogICAgICAgIG15ICRTSEFPYmplY3QgPSBEaWdlc3Q6OlNIQS0+bmV3KCdzaGEyNTYnKTsKCiAgICAgICAgIyBlbmNvZGUgb3V0cHV0LCBuZWVkZWQgYnkgc2hhMjU2X2hleCgpIG9ubHkgbm9uIHV0Zjggc2lnbnMKICAgICAgICAkRW5jb2RlT2JqZWN0LT5FbmNvZGVPdXRwdXQoIFwkUHcgKTsKCiAgICAgICAgJFNIQU9iamVjdC0+YWRkKCRQdyk7CiAgICAgICAgJENyeXB0ZWRQdyA9ICRTSEFPYmplY3QtPmhleGRpZ2VzdCgpOwogICAgfQoKICAgICMgdXBkYXRlIGRiCiAgICBmb3IgbXkgJEVudHJ5ICggQHsgJFNlbGYtPntDdXN0b21lclVzZXJNYXB9LT57TWFwfSB9ICkgewogICAgICAgIGlmICggJEVudHJ5LT5bMF0gPX4gL15Vc2VyUGFzc3dvcmQkL2kgKSB7CiAgICAgICAgICAgICRQYXJhbXtQYXNzd29yZENvbH0gPSAkRW50cnktPlsyXTsKICAgICAgICB9CiAgICAgICAgaWYgKCAkRW50cnktPlswXSA9fiAvXlVzZXJMb2dpbiQvaSApIHsKICAgICAgICAgICAgJFBhcmFte0xvZ2luQ29sfSA9ICRFbnRyeS0+WzJdOwogICAgICAgIH0KICAgIH0KCiAgICAjIGNoZWNrIGlmIG5lZWRlZCBwdyBjb2wuIGV4aXN0cyAoZWxzZSB0aGVyZSBpcyBubyBwdyBjb2wuKQogICAgaWYgKCAkUGFyYW17UGFzc3dvcmRDb2x9ICYmICRQYXJhbXtMb2dpbkNvbH0gKSB7CiAgICAgICAgbXkgJFNRTCA9ICJVUERBVEUgJFNlbGYtPntDdXN0b21lclRhYmxlfSBTRVQgIgogICAgICAgICAgICAuICIgJFBhcmFte1Bhc3N3b3JkQ29sfSA9ID8gIgogICAgICAgICAgICAuICIgV0hFUkUgIjsKCiAgICAgICAgaWYgKCAkU2VsZi0+e0Nhc2VTZW5zaXRpdmV9ICkgewogICAgICAgICAgICAkU1FMIC49ICIkUGFyYW17TG9naW5Db2x9ID0gPyI7CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkU1FMIC49ICJMT1dFUigkUGFyYW17TG9naW5Db2x9KSA9IExPV0VSKD8pIjsKICAgICAgICB9CgogICAgICAgIHJldHVybiBpZiAhJFNlbGYtPntEQk9iamVjdH0tPkRvKAogICAgICAgICAgICBTUUwgID0+ICRTUUwsCiAgICAgICAgICAgIEJpbmQgPT4gWyBcJENyeXB0ZWRQdywgXCRQYXJhbXtVc2VyTG9naW59IF0sCiAgICAgICAgKTsKCiAgICAgICAgIyBsb2cgbm90aWNlCiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdub3RpY2UnLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiQ3VzdG9tZXJVc2VyOiAnJFBhcmFte1VzZXJMb2dpbn0nIGNoYW5nZWQgcGFzc3dvcmQgc3VjY2Vzc2Z1bGx5ISIsCiAgICAgICAgKTsKCiAgICAgICAgJFNlbGYtPl9DdXN0b21lclVzZXJDYWNoZUNsZWFyKCBVc2VyTG9naW4gPT4gJFBhcmFte1VzZXJMb2dpbn0gKTsKCiAgICAgICAgcmV0dXJuIDE7CiAgICB9CgogICAgIyBuZWVkIG5vIHB3IHRvIHNldAogICAgcmV0dXJuIDE7Cn0KCnN1YiBHZW5lcmF0ZVJhbmRvbVBhc3N3b3JkIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgIyBnZW5lcmF0ZWQgcGFzc3dvcmRzIGFyZSBlaWdodCBjaGFyYWN0ZXJzIGxvbmcgYnkgZGVmYXVsdAogICAgbXkgJFNpemUgPSAkUGFyYW17U2l6ZX0gfHwgODsKCiAgICBteSAkUGFzc3dvcmQgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TWFpbicpLT5HZW5lcmF0ZVJhbmRvbVN0cmluZygKICAgICAgICBMZW5ndGggPT4gJFNpemUsCiAgICApOwoKICAgIHJldHVybiAkUGFzc3dvcmQ7Cn0KCnN1YiBTZXRQcmVmZXJlbmNlcyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHBhcmFtcwogICAgaWYgKCAhJFBhcmFte1VzZXJJRH0gKSB7CiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpLT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICdOZWVkIFVzZXJJRCEnLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICRTZWxmLT5fQ3VzdG9tZXJVc2VyQ2FjaGVDbGVhciggVXNlckxvZ2luID0+ICRQYXJhbXtVc2VySUR9ICk7CgogICAgcmV0dXJuICRTZWxmLT57UHJlZmVyZW5jZXNPYmplY3R9LT5TZXRQcmVmZXJlbmNlcyglUGFyYW0pOwp9CgpzdWIgR2V0UHJlZmVyZW5jZXMgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICAjIGNoZWNrIG5lZWRlZCBwYXJhbXMKICAgIGlmICggISRQYXJhbXtVc2VySUR9ICkgewogICAgICAgICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKS0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnTmVlZCBVc2VySUQhJywKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICByZXR1cm4gJFNlbGYtPntQcmVmZXJlbmNlc09iamVjdH0tPkdldFByZWZlcmVuY2VzKCVQYXJhbSk7Cn0KCnN1YiBTZWFyY2hQcmVmZXJlbmNlcyB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIHJldHVybiAkU2VsZi0+e1ByZWZlcmVuY2VzT2JqZWN0fS0+U2VhcmNoUHJlZmVyZW5jZXMoJVBhcmFtKTsKfQoKc3ViIF9DdXN0b21lclVzZXJDYWNoZUNsZWFyIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgcmV0dXJuIGlmICEkU2VsZi0+e0NhY2hlT2JqZWN0fTsKCiAgICBpZiAoICEkUGFyYW17VXNlckxvZ2lufSApIHsKICAgICAgICAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyktPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gJ05lZWQgVXNlckxvZ2luIScsCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgJFNlbGYtPntDYWNoZU9iamVjdH0tPkRlbGV0ZSgKICAgICAgICBUeXBlID0+ICRTZWxmLT57Q2FjaGVUeXBlfSwKICAgICAgICBLZXkgID0+ICJDdXN0b21lclVzZXJEYXRhR2V0OjokUGFyYW17VXNlckxvZ2lufSIsCiAgICApOwogICAgJFNlbGYtPntDYWNoZU9iamVjdH0tPkRlbGV0ZSgKICAgICAgICBUeXBlID0+ICRTZWxmLT57Q2FjaGVUeXBlfSwKICAgICAgICBLZXkgID0+ICJDdXN0b21lck5hbWU6OiRQYXJhbXtVc2VyTG9naW59IiwKICAgICk7CiAgICAkU2VsZi0+e0NhY2hlT2JqZWN0fS0+RGVsZXRlKAogICAgICAgIFR5cGUgPT4gJFNlbGYtPntDYWNoZVR5cGV9LAogICAgICAgIEtleSAgPT4gIkN1c3RvbWVySURzOjokUGFyYW17VXNlckxvZ2lufSIsCiAgICApOwoKICAgICMgZGVsZXRlIGFsbCBzZWFyY2ggY2FjaGUgZW50cmllcwogICAgJFNlbGYtPntDYWNoZU9iamVjdH0tPkNsZWFuVXAoCiAgICAgICAgVHlwZSA9PiAkU2VsZi0+e0NhY2hlVHlwZX0gLiAnX0N1c3RvbWVySURMaXN0JywKICAgICk7CiAgICAkU2VsZi0+e0NhY2hlT2JqZWN0fS0+Q2xlYW5VcCgKICAgICAgICBUeXBlID0+ICRTZWxmLT57Q2FjaGVUeXBlfSAuICdfQ3VzdG9tZXJTZWFyY2gnLAogICAgKTsKICAgICRTZWxmLT57Q2FjaGVPYmplY3R9LT5DbGVhblVwKAogICAgICAgIFR5cGUgPT4gJFNlbGYtPntDYWNoZVR5cGV9IC4gJ19DdXN0b21lclNlYXJjaERldGFpbCcsCiAgICApOwogICAgJFNlbGYtPntDYWNoZU9iamVjdH0tPkNsZWFuVXAoCiAgICAgICAgVHlwZSA9PiAkU2VsZi0+e0NhY2hlVHlwZX0gLiAnX0N1c3RvbWVyU2VhcmNoRGV0YWlsRHluYW1pY0ZpZWxkcycsCiAgICApOwoKICAgICRTZWxmLT57Q2FjaGVPYmplY3R9LT5DbGVhblVwKAogICAgICAgIFR5cGUgPT4gJ0N1c3RvbWVyR3JvdXAnLAogICAgKTsKCiAgICBmb3IgbXkgJEZ1bmN0aW9uIChxdyhDdXN0b21lclVzZXJMaXN0KSkgewogICAgICAgIGZvciBteSAkVmFsaWQgKCAwIC4uIDEgKSB7CiAgICAgICAgICAgICRTZWxmLT57Q2FjaGVPYmplY3R9LT5EZWxldGUoCiAgICAgICAgICAgICAgICBUeXBlID0+ICRTZWxmLT57Q2FjaGVUeXBlfSwKICAgICAgICAgICAgICAgIEtleSAgPT4gIiR7RnVuY3Rpb259Ojoke1ZhbGlkfSIsCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiAxOwp9CgpzdWIgREVTVFJPWSB7CiAgICBteSAkU2VsZiA9IHNoaWZ0OwoKICAgICMgZGlzY29ubmVjdCBpZiBpdCdzIG5vdCBhIHBhcmVudCBEQk9iamVjdAogICAgaWYgKCAkU2VsZi0+e05vdFBhcmVudERCT2JqZWN0fSApIHsKICAgICAgICBpZiAoICRTZWxmLT57REJPYmplY3R9ICkgewogICAgICAgICAgICAkU2VsZi0+e0RCT2JqZWN0fS0+RGlzY29ubmVjdCgpOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gMTsKfQoKMTsK</File>
        <File Location="Custom/Kernel/System/PostMaster/NewTicket.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAwMS0yMDIxIE9UUlMgQUcsIGh0dHBzOi8vb3Rycy5jb20vCiMgQ29weXJpZ2h0IChDKSAyMDIxLTIwMjIgWm51bnkgR21iSCwgaHR0cHM6Ly96bnVueS5vcmcvCiMgLS0KIyBUaGlzIHNvZnR3YXJlIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWS4gRm9yIGRldGFpbHMsIHNlZQojIHRoZSBlbmNsb3NlZCBmaWxlIENPUFlJTkcgZm9yIGxpY2Vuc2UgaW5mb3JtYXRpb24gKEdQTCkuIElmIHlvdQojIGRpZCBub3QgcmVjZWl2ZSB0aGlzIGZpbGUsIHNlZSBodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0LgojIC0tCgpwYWNrYWdlIEtlcm5lbDo6U3lzdGVtOjpQb3N0TWFzdGVyOjpOZXdUaWNrZXQ7Cgp1c2Ugc3RyaWN0Owp1c2Ugd2FybmluZ3M7CgpvdXIgQE9iamVjdERlcGVuZGVuY2llcyA9ICgKICAgICdLZXJuZWw6OkNvbmZpZycsCiAgICAnS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyVXNlcicsCiAgICAnS2VybmVsOjpTeXN0ZW06OkRhdGVUaW1lJywKICAgICdLZXJuZWw6OlN5c3RlbTo6RHluYW1pY0ZpZWxkJywKICAgICdLZXJuZWw6OlN5c3RlbTo6RHluYW1pY0ZpZWxkOjpCYWNrZW5kJywKICAgICdLZXJuZWw6OlN5c3RlbTo6TGlua09iamVjdCcsCiAgICAnS2VybmVsOjpTeXN0ZW06OlByaW9yaXR5JywKICAgICdLZXJuZWw6OlN5c3RlbTo6UXVldWUnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpTZXJ2aWNlJywKICAgICdLZXJuZWw6OlN5c3RlbTo6U3RhdGUnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpUaWNrZXQnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpUaWNrZXQ6OkFydGljbGUnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpUeXBlJywKICAgICdLZXJuZWw6OlN5c3RlbTo6VXNlcicsCik7CgpzdWIgbmV3IHsKICAgIG15ICggJFR5cGUsICVQYXJhbSApID0gQF87CgogICAgIyBhbGxvY2F0ZSBuZXcgaGFzaCBmb3Igb2JqZWN0CiAgICBteSAkU2VsZiA9IHt9OwogICAgYmxlc3MoICRTZWxmLCAkVHlwZSApOwoKICAgICMgZ2V0IHBhcnNlciBvYmplY3QKICAgICRTZWxmLT57UGFyc2VyT2JqZWN0fSA9ICRQYXJhbXtQYXJzZXJPYmplY3R9IHx8IGRpZSAiR290IG5vIFBhcnNlck9iamVjdCEiOwoKICAgICMgR2V0IGNvbW11bmljYXRpb24gbG9nIG9iamVjdC4KICAgICRTZWxmLT57Q29tbXVuaWNhdGlvbkxvZ09iamVjdH0gPSAkUGFyYW17Q29tbXVuaWNhdGlvbkxvZ09iamVjdH0gfHwgZGllICJHb3Qgbm8gQ29tbXVuaWNhdGlvbkxvZ09iamVjdCEiOwoKICAgIHJldHVybiAkU2VsZjsKfQoKc3ViIFJ1biB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgICMgY2hlY2sgbmVlZGVkIHN0dWZmCiAgICBmb3IgbXkgJE5lZWRlZCAocXcoSW5tYWlsVXNlcklEIEdldFBhcmFtKSkgewogICAgICAgIGlmICggISRQYXJhbXskTmVlZGVkfSApIHsKICAgICAgICAgICAgJFNlbGYtPntDb21tdW5pY2F0aW9uTG9nT2JqZWN0fS0+T2JqZWN0TG9nKAogICAgICAgICAgICAgICAgT2JqZWN0TG9nVHlwZSA9PiAnTWVzc2FnZScsCiAgICAgICAgICAgICAgICBQcmlvcml0eSAgICAgID0+ICdFcnJvcicsCiAgICAgICAgICAgICAgICBLZXkgICAgICAgICAgID0+ICdLZXJuZWw6OlN5c3RlbTo6UG9zdE1hc3Rlcjo6TmV3VGlja2V0JywKICAgICAgICAgICAgICAgIFZhbHVlICAgICAgICAgPT4gIk5lZWQgJE5lZWRlZCEiLAogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgfQogICAgbXkgJUdldFBhcmFtICAgICAgICAgPSAleyAkUGFyYW17R2V0UGFyYW19IH07CiAgICBteSAkQ29tbWVudCAgICAgICAgICA9ICRQYXJhbXtDb21tZW50fSB8fCAnJzsKICAgIG15ICRBdXRvUmVzcG9uc2VUeXBlID0gJFBhcmFte0F1dG9SZXNwb25zZVR5cGV9IHx8ICcnOwoKICAgICMgZ2V0IHF1ZXVlIGlkIGFuZCBuYW1lCiAgICBteSAkUXVldWVJRCA9ICRQYXJhbXtRdWV1ZUlEfSB8fCBkaWUgIm5lZWQgUXVldWVJRCEiOwogICAgbXkgJFF1ZXVlICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6UXVldWUnKS0+UXVldWVMb29rdXAoCiAgICAgICAgUXVldWVJRCA9PiAkUXVldWVJRCwKICAgICk7CgogICAgIyBnZXQgY29uZmlnIG9iamVjdAogICAgbXkgJENvbmZpZ09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6Q29uZmlnJyk7CgogICAgIyBnZXQgc3RhdGUKICAgIG15ICRTdGF0ZSA9ICRDb25maWdPYmplY3QtPkdldCgnUG9zdG1hc3RlckRlZmF1bHRTdGF0ZScpIHx8ICduZXcnOwogICAgaWYgKCAkR2V0UGFyYW17J1gtT1RSUy1TdGF0ZSd9ICkgewoKICAgICAgICBteSAkU3RhdGVJRCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpTdGF0ZScpLT5TdGF0ZUxvb2t1cCgKICAgICAgICAgICAgU3RhdGUgPT4gJEdldFBhcmFteydYLU9UUlMtU3RhdGUnfSwKICAgICAgICApOwoKICAgICAgICBpZiAoJFN0YXRlSUQpIHsKICAgICAgICAgICAgJFN0YXRlID0gJEdldFBhcmFteydYLU9UUlMtU3RhdGUnfTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRTZWxmLT57Q29tbXVuaWNhdGlvbkxvZ09iamVjdH0tPk9iamVjdExvZygKICAgICAgICAgICAgICAgIE9iamVjdExvZ1R5cGUgPT4gJ01lc3NhZ2UnLAogICAgICAgICAgICAgICAgUHJpb3JpdHkgICAgICA9PiAnRXJyb3InLAogICAgICAgICAgICAgICAgS2V5ICAgICAgICAgICA9PiAnS2VybmVsOjpTeXN0ZW06OlBvc3RNYXN0ZXI6Ok5ld1RpY2tldCcsCiAgICAgICAgICAgICAgICBWYWx1ZSAgICAgICAgID0+ICJTdGF0ZSAkR2V0UGFyYW17J1gtT1RSUy1TdGF0ZSd9IGRvZXMgbm90IGV4aXN0LCBmYWxsaW5nIGJhY2sgdG8gJFN0YXRlISIsCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgICMgZ2V0IHByaW9yaXR5CiAgICBteSAkUHJpb3JpdHkgPSAkQ29uZmlnT2JqZWN0LT5HZXQoJ1Bvc3RtYXN0ZXJEZWZhdWx0UHJpb3JpdHknKSB8fCAnMyBub3JtYWwnOwoKICAgIGlmICggJEdldFBhcmFteydYLU9UUlMtUHJpb3JpdHknfSApIHsKCiAgICAgICAgbXkgJFByaW9yaXR5SUQgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6UHJpb3JpdHknKS0+UHJpb3JpdHlMb29rdXAoCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICRHZXRQYXJhbXsnWC1PVFJTLVByaW9yaXR5J30sCiAgICAgICAgKTsKCiAgICAgICAgaWYgKCRQcmlvcml0eUlEKSB7CiAgICAgICAgICAgICRQcmlvcml0eSA9ICRHZXRQYXJhbXsnWC1PVFJTLVByaW9yaXR5J307CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkU2VsZi0+e0NvbW11bmljYXRpb25Mb2dPYmplY3R9LT5PYmplY3RMb2coCiAgICAgICAgICAgICAgICBPYmplY3RMb2dUeXBlID0+ICdNZXNzYWdlJywKICAgICAgICAgICAgICAgIFByaW9yaXR5ICAgICAgPT4gJ0Vycm9yJywKICAgICAgICAgICAgICAgIEtleSAgICAgICAgICAgPT4gJ0tlcm5lbDo6U3lzdGVtOjpQb3N0TWFzdGVyOjpOZXdUaWNrZXQnLAogICAgICAgICAgICAgICAgVmFsdWUgICAgICAgICA9PiAiUHJpb3JpdHkgJEdldFBhcmFteydYLU9UUlMtUHJpb3JpdHknfSBkb2VzIG5vdCBleGlzdCwgZmFsbGluZyBiYWNrIHRvICRQcmlvcml0eSEiLAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICBteSAkVHlwZUlEOwoKICAgIGlmICggJEdldFBhcmFteydYLU9UUlMtVHlwZSd9ICkgewoKICAgICAgICAjIENoZWNrIGlmIHR5cGUgZXhpc3RzCiAgICAgICAgJFR5cGVJRCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpUeXBlJyktPlR5cGVMb29rdXAoIFR5cGUgPT4gJEdldFBhcmFteydYLU9UUlMtVHlwZSd9ICk7CgogICAgICAgIGlmICggISRUeXBlSUQgKSB7CiAgICAgICAgICAgICRTZWxmLT57Q29tbXVuaWNhdGlvbkxvZ09iamVjdH0tPk9iamVjdExvZygKICAgICAgICAgICAgICAgIE9iamVjdExvZ1R5cGUgPT4gJ01lc3NhZ2UnLAogICAgICAgICAgICAgICAgUHJpb3JpdHkgICAgICA9PiAnRXJyb3InLAogICAgICAgICAgICAgICAgS2V5ICAgICAgICAgICA9PiAnS2VybmVsOjpTeXN0ZW06OlBvc3RNYXN0ZXI6Ok5ld1RpY2tldCcsCiAgICAgICAgICAgICAgICBWYWx1ZSAgICAgICAgID0+ICJUeXBlICRHZXRQYXJhbXsnWC1PVFJTLVR5cGUnfSBkb2VzIG5vdCBleGlzdCwgZmFsbGluZyBiYWNrIHRvIGRlZmF1bHQgdHlwZS4iLAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICAjIGdldCBzZW5kZXIgZW1haWwKICAgIG15IEBFbWFpbEFkZHJlc3NlcyA9ICRTZWxmLT57UGFyc2VyT2JqZWN0fS0+U3BsaXRBZGRyZXNzTGluZSgKICAgICAgICBMaW5lID0+ICRHZXRQYXJhbXtGcm9tfSwKICAgICk7CiAgICBmb3IgbXkgJEFkZHJlc3MgKEBFbWFpbEFkZHJlc3NlcykgewogICAgICAgICRHZXRQYXJhbXtTZW5kZXJFbWFpbEFkZHJlc3N9ID0gJFNlbGYtPntQYXJzZXJPYmplY3R9LT5HZXRFbWFpbEFkZHJlc3MoCiAgICAgICAgICAgIEVtYWlsID0+ICRBZGRyZXNzLAogICAgICAgICk7CiAgICB9CgogICAgJEdldFBhcmFte1NlbmRlckVtYWlsQWRkcmVzc30gLy89ICcnOwoKICAgICMgZ2V0IGN1c3RvbWVyIGlkIChzZW5kZXIgZW1haWwpIGlmIHRoZXJlIGlzIG5vIGN1c3RvbWVyIGlkIGdpdmVuCiAgICBpZiAoICEkR2V0UGFyYW17J1gtT1RSUy1DdXN0b21lck5vJ30gJiYgJEdldFBhcmFteydYLU9UUlMtQ3VzdG9tZXJVc2VyJ30gKSB7CgogICAgICAgICMgZ2V0IGN1c3RvbWVyIHVzZXIgb2JqZWN0CiAgICAgICAgbXkgJEN1c3RvbWVyVXNlck9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpDdXN0b21lclVzZXInKTsKCiAgICAgICAgIyBnZXQgY3VzdG9tZXIgdXNlciBkYXRhIGZvcm0gWC1PVFJTLUN1c3RvbWVyVXNlcgogICAgICAgIG15ICVDdXN0b21lckRhdGEgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclVzZXJEYXRhR2V0KAogICAgICAgICAgICBVc2VyID0+ICRHZXRQYXJhbXsnWC1PVFJTLUN1c3RvbWVyVXNlcid9LAogICAgICAgICk7CgogICAgICAgIGlmICglQ3VzdG9tZXJEYXRhKSB7CiAgICAgICAgICAgICRHZXRQYXJhbXsnWC1PVFJTLUN1c3RvbWVyTm8nfSA9ICRDdXN0b21lckRhdGF7VXNlckN1c3RvbWVySUR9OwogICAgICAgIH0KICAgIH0KCiAgICAjIGdldCBjdXN0b21lciB1c2VyIGRhdGEgZm9ybSBGcm9tOiAoc2VuZGVyIGFkZHJlc3MpCiAgICBpZiAoICEkR2V0UGFyYW17J1gtT1RSUy1DdXN0b21lclVzZXInfSApIHsKCiAgICAgICAgbXkgJUN1c3RvbWVyRGF0YTsKICAgICAgICBpZiAoICRHZXRQYXJhbXtGcm9tfSApIHsKCiAgICAgICAgICAgIG15IEBFbWFpbEFkZHJlc3NlcyA9ICRTZWxmLT57UGFyc2VyT2JqZWN0fS0+U3BsaXRBZGRyZXNzTGluZSgKICAgICAgICAgICAgICAgIExpbmUgPT4gJEdldFBhcmFte0Zyb219LAogICAgICAgICAgICApOwoKICAgICAgICAgICAgZm9yIG15ICRBZGRyZXNzIChARW1haWxBZGRyZXNzZXMpIHsKICAgICAgICAgICAgICAgICRHZXRQYXJhbXtFbWFpbEZyb219ID0gJFNlbGYtPntQYXJzZXJPYmplY3R9LT5HZXRFbWFpbEFkZHJlc3MoCiAgICAgICAgICAgICAgICAgICAgRW1haWwgPT4gJEFkZHJlc3MsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoICRHZXRQYXJhbXtFbWFpbEZyb219ICkgewoKICAgICAgICAgICAgICAgICMgZ2V0IGN1c3RvbWVyIHVzZXIgb2JqZWN0CiAgICAgICAgICAgICAgICBteSAkQ3VzdG9tZXJVc2VyT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyVXNlcicpOwoKICAgICAgICAgICAgICAgIG15ICVMaXN0ID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJTZWFyY2goCiAgICAgICAgICAgICAgICAgICAgUG9zdE1hc3RlclNlYXJjaCA9PiBsYyggJEdldFBhcmFte0VtYWlsRnJvbX0gKSwKICAgICAgICAgICAgICAgICAgICBVc2VySUQgPT4gJFNlbGYtPntVc2VySUR9LAogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICBmb3IgbXkgJFVzZXJMb2dpbiAoIHNvcnQga2V5cyAlTGlzdCApIHsKICAgICAgICAgICAgICAgICAgICAlQ3VzdG9tZXJEYXRhID0gJEN1c3RvbWVyVXNlck9iamVjdC0+Q3VzdG9tZXJVc2VyRGF0YUdldCgKICAgICAgICAgICAgICAgICAgICAgICAgVXNlciA9PiAkVXNlckxvZ2luLAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICMgdGFrZSBDdXN0b21lcklEIGZyb20gY3VzdG9tZXIgYmFja2VuZCBsb29rdXAgb3IgZnJvbSBmcm9tIGZpZWxkCiAgICAgICAgaWYgKCAkQ3VzdG9tZXJEYXRhe1VzZXJMb2dpbn0gJiYgISRHZXRQYXJhbXsnWC1PVFJTLUN1c3RvbWVyVXNlcid9ICkgewogICAgICAgICAgICAkR2V0UGFyYW17J1gtT1RSUy1DdXN0b21lclVzZXInfSA9ICRDdXN0b21lckRhdGF7VXNlckxvZ2lufTsKCiAgICAgICAgICAgICMgbm90aWNlIHRoYXQgVXNlckxvZ2luIGlzIGZyb20gY3VzdG9tZXIgc291cmNlIGJhY2tlbmQKICAgICAgICAgICAgJFNlbGYtPntDb21tdW5pY2F0aW9uTG9nT2JqZWN0fS0+T2JqZWN0TG9nKAogICAgICAgICAgICAgICAgT2JqZWN0TG9nVHlwZSA9PiAnTWVzc2FnZScsCiAgICAgICAgICAgICAgICBQcmlvcml0eSAgICAgID0+ICdOb3RpY2UnLAogICAgICAgICAgICAgICAgS2V5ICAgICAgICAgICA9PiAnS2VybmVsOjpTeXN0ZW06OlBvc3RNYXN0ZXI6Ok5ld1RpY2tldCcsCiAgICAgICAgICAgICAgICBWYWx1ZSAgICAgICAgID0+ICJUYWtlIFVzZXJMb2dpbiAoJEN1c3RvbWVyRGF0YXtVc2VyTG9naW59KSBmcm9tICIKICAgICAgICAgICAgICAgICAgICAuICJjdXN0b21lciBzb3VyY2UgYmFja2VuZCBiYXNlZCBvbiAoJEdldFBhcmFteydFbWFpbEZyb20nfSkuIiwKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgaWYgKCAkQ3VzdG9tZXJEYXRhe1VzZXJDdXN0b21lcklEfSAmJiAhJEdldFBhcmFteydYLU9UUlMtQ3VzdG9tZXJObyd9ICkgewogICAgICAgICAgICAkR2V0UGFyYW17J1gtT1RSUy1DdXN0b21lck5vJ30gPSAkQ3VzdG9tZXJEYXRhe1VzZXJDdXN0b21lcklEfTsKCiAgICAgICAgICAgICMgbm90aWNlIHRoYXQgVXNlckN1c3RvbWVySUQgaXMgZnJvbSBjdXN0b21lciBzb3VyY2UgYmFja2VuZAogICAgICAgICAgICAkU2VsZi0+e0NvbW11bmljYXRpb25Mb2dPYmplY3R9LT5PYmplY3RMb2coCiAgICAgICAgICAgICAgICBPYmplY3RMb2dUeXBlID0+ICdNZXNzYWdlJywKICAgICAgICAgICAgICAgIFByaW9yaXR5ICAgICAgPT4gJ05vdGljZScsCiAgICAgICAgICAgICAgICBLZXkgICAgICAgICAgID0+ICdLZXJuZWw6OlN5c3RlbTo6UG9zdE1hc3Rlcjo6TmV3VGlja2V0JywKICAgICAgICAgICAgICAgIFZhbHVlICAgICAgICAgPT4gIlRha2UgVXNlckN1c3RvbWVySUQgKCRDdXN0b21lckRhdGF7VXNlckN1c3RvbWVySUR9KSIKICAgICAgICAgICAgICAgICAgICAuICIgZnJvbSBjdXN0b21lciBzb3VyY2UgYmFja2VuZCBiYXNlZCBvbiAoJEdldFBhcmFteydFbWFpbEZyb20nfSkuIiwKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICB9CgogICAgIyBpZiB0aGVyZSBpcyBubyBjdXN0b21lciBpZCBmb3VuZCEKICAgIGlmICgKICAgICAgICAhJEdldFBhcmFteydYLU9UUlMtQ3VzdG9tZXJObyd9CiAgICAgICAgJiYgJENvbmZpZ09iamVjdC0+R2V0KCdQb3N0TWFzdGVyOjpOZXdUaWNrZXQ6OkF1dG9Bc3NpZ25DdXN0b21lcklERm9yVW5rbm93bkN1c3RvbWVycycpCiAgICAgICAgKQogICAgewogICAgICAgICRHZXRQYXJhbXsnWC1PVFJTLUN1c3RvbWVyTm8nfSA9ICRHZXRQYXJhbXtTZW5kZXJFbWFpbEFkZHJlc3N9OwogICAgfQoKICAgICMgaWYgdGhlcmUgaXMgbm8gY3VzdG9tZXIgdXNlciBmb3VuZCEKICAgIGlmICggISRHZXRQYXJhbXsnWC1PVFJTLUN1c3RvbWVyVXNlcid9ICkgewogICAgICAgICRHZXRQYXJhbXsnWC1PVFJTLUN1c3RvbWVyVXNlcid9ID0gJEdldFBhcmFte1NlbmRlckVtYWlsQWRkcmVzc307CiAgICB9CgogICAgIyBnZXQgdGlja2V0IG93bmVyCiAgICBteSAkT3duZXJJRCA9ICRHZXRQYXJhbXsnWC1PVFJTLU93bmVySUQnfSB8fCAkUGFyYW17SW5tYWlsVXNlcklEfTsKICAgIGlmICggJEdldFBhcmFteydYLU9UUlMtT3duZXInfSApIHsKCiAgICAgICAgbXkgJFRtcE93bmVySUQgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VXNlcicpLT5Vc2VyTG9va3VwKAogICAgICAgICAgICBVc2VyTG9naW4gPT4gJEdldFBhcmFteydYLU9UUlMtT3duZXInfSwKICAgICAgICApOwoKICAgICAgICAkT3duZXJJRCA9ICRUbXBPd25lcklEIHx8ICRPd25lcklEOwogICAgfQoKICAgIG15ICVPcHRzOwogICAgaWYgKCAkR2V0UGFyYW17J1gtT1RSUy1SZXNwb25zaWJsZUlEJ30gKSB7CiAgICAgICAgJE9wdHN7UmVzcG9uc2libGVJRH0gPSAkR2V0UGFyYW17J1gtT1RSUy1SZXNwb25zaWJsZUlEJ307CiAgICB9CgogICAgaWYgKCAkR2V0UGFyYW17J1gtT1RSUy1SZXNwb25zaWJsZSd9ICkgewoKICAgICAgICBteSAkVG1wUmVzcG9uc2libGVJRCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpVc2VyJyktPlVzZXJMb29rdXAoCiAgICAgICAgICAgIFVzZXJMb2dpbiA9PiAkR2V0UGFyYW17J1gtT1RSUy1SZXNwb25zaWJsZSd9LAogICAgICAgICk7CgogICAgICAgICRPcHRze1Jlc3BvbnNpYmxlSUR9ID0gJFRtcFJlc3BvbnNpYmxlSUQgfHwgJE9wdHN7UmVzcG9uc2libGVJRH07CiAgICB9CgogICAgIyBnZXQgdGlja2V0IG9iamVjdAogICAgbXkgJFRpY2tldE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpUaWNrZXQnKTsKCiAgICAkU2VsZi0+e0NvbW11bmljYXRpb25Mb2dPYmplY3R9LT5PYmplY3RMb2coCiAgICAgICAgT2JqZWN0TG9nVHlwZSA9PiAnTWVzc2FnZScsCiAgICAgICAgUHJpb3JpdHkgICAgICA9PiAnRGVidWcnLAogICAgICAgIEtleSAgICAgICAgICAgPT4gJ0tlcm5lbDo6U3lzdGVtOjpQb3N0TWFzdGVyOjpOZXdUaWNrZXQnLAogICAgICAgIFZhbHVlICAgICAgICAgPT4gIkdvaW5nIHRvIGNyZWF0ZSBuZXcgdGlja2V0LiIsCiAgICApOwoKICAgICMgVGlja2V0IHNlcnZpY2UgaGFuZGxpbmcuCgogICAgaWYgKCAkR2V0UGFyYW17J1gtT1RSUy1TZXJ2aWNlJ30gKSB7CgogICAgICAgICMgR2V0IGFsbCB2YWxpZCBzZXJ2aWNlcy4KICAgICAgICBteSAlVmFsaWRTZXJ2aWNlcyA9IHJldmVyc2UgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlNlcnZpY2UnKS0+U2VydmljZUxpc3QoCiAgICAgICAgICAgIFZhbGlkICAgICAgICA9PiAxLAogICAgICAgICAgICBLZWVwQ2hpbGRyZW4gPT4gJENvbmZpZ09iamVjdC0+R2V0KCdUaWNrZXQ6OlNlcnZpY2U6OktlZXBDaGlsZHJlbicpIC8vIDAsCiAgICAgICAgICAgIFVzZXJJRCAgICAgICA9PiAkUGFyYW17SW5tYWlsVXNlcklEfSwKICAgICAgICApOwoKICAgICAgICBpZiAoICEkVmFsaWRTZXJ2aWNlc3sgJEdldFBhcmFteydYLU9UUlMtU2VydmljZSd9IH0gKSB7CgogICAgICAgICAgICAjIElmIHNlcnZpY2Ugd2l0aCBnaXZlbiBuYW1lIGRvZXMgbm90IGV4aXN0IG9yIGlzIGludmFsaWQgZG9uJ3Qgc2V0IGl0IGlmIG5vdCBhY3RpdmUuCgogICAgICAgICAgICAkU2VsZi0+e0NvbW11bmljYXRpb25Mb2dPYmplY3R9LT5PYmplY3RMb2coCiAgICAgICAgICAgICAgICBPYmplY3RMb2dUeXBlID0+ICdNZXNzYWdlJywKICAgICAgICAgICAgICAgIFByaW9yaXR5ICAgICAgPT4gJ0RlYnVnJywKICAgICAgICAgICAgICAgIEtleSAgICAgICAgICAgPT4gJ0tlcm5lbDo6U3lzdGVtOjpQb3N0TWFzdGVyOjpOZXdUaWNrZXQnLAogICAgICAgICAgICAgICAgVmFsdWUgPT4KICAgICAgICAgICAgICAgICAgICAiVGlja2V0IHNlcnZpY2Ugd29uJ3QgYmUgc2V0IHRvICckR2V0UGFyYW17J1gtT1RSUy1TZXJ2aWNlJ30nIChkb2VzIG5vdCBleGlzdCBvciBpcyBpbnZhbGlkIG9yIGlzIGEgY2hpbGQgb2YgaW52YWxpZCBzZXJ2aWNlKS4iLAogICAgICAgICAgICApOwoKICAgICAgICAgICAgJEdldFBhcmFteydYLU9UUlMtU2VydmljZSd9ID0gJyc7CiAgICAgICAgfQogICAgfQoKICAgICMgY3JlYXRlIG5ldyB0aWNrZXQKICAgIG15ICROZXdUbiAgICA9ICRUaWNrZXRPYmplY3QtPlRpY2tldENyZWF0ZU51bWJlcigpOwogICAgbXkgJFRpY2tldElEID0gJFRpY2tldE9iamVjdC0+VGlja2V0Q3JlYXRlKAogICAgICAgIFROICAgICAgICAgICA9PiAkTmV3VG4sCiAgICAgICAgVGl0bGUgICAgICAgID0+ICRHZXRQYXJhbXsnWC1PVFJTLVRpdGxlJ30gfHwgJEdldFBhcmFte1N1YmplY3R9LAogICAgICAgIFF1ZXVlSUQgICAgICA9PiAkUXVldWVJRCwKICAgICAgICBMb2NrICAgICAgICAgPT4gJEdldFBhcmFteydYLU9UUlMtTG9jayd9IHx8ICd1bmxvY2snLAogICAgICAgIFByaW9yaXR5ICAgICA9PiAkUHJpb3JpdHksCiAgICAgICAgU3RhdGUgICAgICAgID0+ICRTdGF0ZSwKICAgICAgICBUeXBlSUQgICAgICAgPT4gJFR5cGVJRCwKICAgICAgICBTZXJ2aWNlICAgICAgPT4gJEdldFBhcmFteydYLU9UUlMtU2VydmljZSd9IHx8ICcnLAogICAgICAgIFNMQSAgICAgICAgICA9PiAkR2V0UGFyYW17J1gtT1RSUy1TTEEnfSB8fCAnJywKICAgICAgICBDdXN0b21lcklEICAgPT4gJEdldFBhcmFteydYLU9UUlMtQ3VzdG9tZXJObyd9LAogICAgICAgIEN1c3RvbWVyVXNlciA9PiAkR2V0UGFyYW17J1gtT1RSUy1DdXN0b21lclVzZXInfSwKICAgICAgICBPd25lcklEICAgICAgPT4gJE93bmVySUQsCiAgICAgICAgVXNlcklEICAgICAgID0+ICRQYXJhbXtJbm1haWxVc2VySUR9LAogICAgICAgICVPcHRzLAogICAgKTsKCiAgICBpZiAoICEkVGlja2V0SUQgKSB7CiAgICAgICAgJFNlbGYtPntDb21tdW5pY2F0aW9uTG9nT2JqZWN0fS0+T2JqZWN0TG9nKAogICAgICAgICAgICBPYmplY3RMb2dUeXBlID0+ICdNZXNzYWdlJywKICAgICAgICAgICAgUHJpb3JpdHkgICAgICA9PiAnRXJyb3InLAogICAgICAgICAgICBLZXkgICAgICAgICAgID0+ICdLZXJuZWw6OlN5c3RlbTo6UG9zdE1hc3Rlcjo6TmV3VGlja2V0JywKICAgICAgICAgICAgVmFsdWUgICAgICAgICA9PiAiVGlja2V0IGNvdWxkIG5vdCBiZSBjcmVhdGVkISIsCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgbXkgJFRpY2tldENyZWF0ZU1lc3NhZ2UgPSA8PCJNZXNzYWdlIjsKTmV3IFRpY2tldCBjcmVhdGVkOgoKVGlja2V0TnVtYmVyOiAkTmV3VG4KVGlja2V0SUQ6ICRUaWNrZXRJRApQcmlvcml0eTogJFByaW9yaXR5ClN0YXRlOiAkU3RhdGUKQ3VzdG9tZXJJRDogJEdldFBhcmFteydYLU9UUlMtQ3VzdG9tZXJObyd9CkN1c3RvbWVyVXNlcjogJEdldFBhcmFteydYLU9UUlMtQ3VzdG9tZXJVc2VyJ30KCk1lc3NhZ2UKCiAgICBmb3IgbXkgJFZhbHVlIChxdyhUeXBlIFNlcnZpY2UgU0xBIExvY2spKSB7CgogICAgICAgIGlmICggJEdldFBhcmFteyAnWC1PVFJTLScgLiAkVmFsdWUgfSApIHsKICAgICAgICAgICAgJFRpY2tldENyZWF0ZU1lc3NhZ2UgLj0gIiRWYWx1ZTogIiAuICRHZXRQYXJhbXsgJ1gtT1RSUy0nIC4gJFZhbHVlIH0gLiAiXG4iOwogICAgICAgIH0KICAgIH0KCiAgICAkU2VsZi0+e0NvbW11bmljYXRpb25Mb2dPYmplY3R9LT5PYmplY3RMb2coCiAgICAgICAgT2JqZWN0TG9nVHlwZSA9PiAnTWVzc2FnZScsCiAgICAgICAgUHJpb3JpdHkgICAgICA9PiAnRGVidWcnLAogICAgICAgIEtleSAgICAgICAgICAgPT4gJ0tlcm5lbDo6U3lzdGVtOjpQb3N0TWFzdGVyOjpOZXdUaWNrZXQnLAogICAgICAgIFZhbHVlICAgICAgICAgPT4gJFRpY2tldENyZWF0ZU1lc3NhZ2UsCiAgICApOwoKICAgICMgc2V0IHBlbmRpbmcgdGltZQogICAgaWYgKCAkR2V0UGFyYW17J1gtT1RSUy1TdGF0ZS1QZW5kaW5nVGltZSd9ICkgewoKICAjIFlvdSBjYW4gc3BlY2lmeSBhYnNvbHV0ZSBkYXRlcyBsaWtlICIyMDEwLTExLTIwIDAwOjAwOjAwIiBvciByZWxhdGl2ZSBkYXRlcywgYmFzZWQgb24gdGhlIGFycml2YWwgdGltZSBvZiB0aGUgZW1haWwuCiAgIyBVc2UgdGhlIGZvcm0gIisgJE51bWJlciAkVW5pdCIsIHdoZXJlICRVbml0IGNhbiBiZSAncycgKHNlY29uZHMpLCAnbScgKG1pbnV0ZXMpLCAnaCcgKGhvdXJzKSBvciAnZCcgKGRheXMpLgogICMgT25seSBvbmUgdW5pdCBjYW4gYmUgc3BlY2lmaWVkLiBFeGFtcGxlcyBvZiB2YWxpZCBzZXR0aW5nczogIis1MHMiIChwZW5kaW5nIGluIDUwIHNlY29uZHMpLCAiKzMwbSIgKDMwIG1pbnV0ZXMpLAogICMgIisxMmQiICgxMiBkYXlzKS4gTm90ZSB0aGF0IHNldHRpbmdzIGxpa2UgIisxZCAxMmgiIGFyZSBub3QgcG9zc2libGUuIFlvdSBjYW4gc3BlY2lmeSAiKzM2aCIgaW5zdGVhZC4KCiAgICAgICAgbXkgJFRhcmdldFRpbWVTdGFtcCA9ICRHZXRQYXJhbXsnWC1PVFJTLVN0YXRlLVBlbmRpbmdUaW1lJ307CgogICAgICAgIG15ICggJFNpZ24sICROdW1iZXIsICRVbml0ICkgPSAkVGFyZ2V0VGltZVN0YW1wID1+IG17XlxzKihbKy1dPylccyooXGQrKVxzKihbc21oZF0/KVxzKiR9c214OwoKICAgICAgICBpZiAoJE51bWJlcikgewogICAgICAgICAgICAkU2lnbiB8fD0gJysnOwogICAgICAgICAgICAkVW5pdCB8fD0gJ3MnOwoKICAgICAgICAgICAgbXkgJFNlY29uZHMgPSAkU2lnbiBlcSAnLScgPyAoICROdW1iZXIgKiAtMSApIDogJE51bWJlcjsKCiAgICAgICAgICAgIG15ICVVbml0TXVsdGlwbGllciA9ICgKICAgICAgICAgICAgICAgIHMgPT4gMSwKICAgICAgICAgICAgICAgIG0gPT4gNjAsCiAgICAgICAgICAgICAgICBoID0+IDYwICogNjAsCiAgICAgICAgICAgICAgICBkID0+IDYwICogNjAgKiAyNCwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICRTZWNvbmRzID0gJFNlY29uZHMgKiAkVW5pdE11bHRpcGxpZXJ7JFVuaXR9OwoKICAgICAgICAgICAgIyBnZXQgZGF0ZXRpbWUgb2JqZWN0CiAgICAgICAgICAgIG15ICREYXRlVGltZU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5DcmVhdGUoJ0tlcm5lbDo6U3lzdGVtOjpEYXRlVGltZScpOwogICAgICAgICAgICAkRGF0ZVRpbWVPYmplY3QtPkFkZCggU2Vjb25kcyA9PiAkU2Vjb25kcyApOwogICAgICAgICAgICAkVGFyZ2V0VGltZVN0YW1wID0gJERhdGVUaW1lT2JqZWN0LT5Ub1N0cmluZygpOwogICAgICAgIH0KCiAgICAgICAgbXkgJFNldCA9ICRUaWNrZXRPYmplY3QtPlRpY2tldFBlbmRpbmdUaW1lU2V0KAogICAgICAgICAgICBTdHJpbmcgICA9PiAkVGFyZ2V0VGltZVN0YW1wLAogICAgICAgICAgICBUaWNrZXRJRCA9PiAkVGlja2V0SUQsCiAgICAgICAgICAgIFVzZXJJRCAgID0+ICRQYXJhbXtJbm1haWxVc2VySUR9LAogICAgICAgICk7CgogICAgICAgICRTZWxmLT57Q29tbXVuaWNhdGlvbkxvZ09iamVjdH0tPk9iamVjdExvZygKICAgICAgICAgICAgT2JqZWN0TG9nVHlwZSA9PiAnTWVzc2FnZScsCiAgICAgICAgICAgIFByaW9yaXR5ICAgICAgPT4gJ0RlYnVnJywKICAgICAgICAgICAgS2V5ICAgICAgICAgICA9PiAnS2VybmVsOjpTeXN0ZW06OlBvc3RNYXN0ZXI6Ok5ld1RpY2tldCcsCiAgICAgICAgICAgIFZhbHVlID0+CiAgICAgICAgICAgICAgICAiUGVuZGluZyB0aW1lIHVwZGF0ZSB2aWEgJ1gtT1RSUy1TdGF0ZS1QZW5kaW5nVGltZSchIFN0YXRlLVBlbmRpbmdUaW1lOiAkR2V0UGFyYW17J1gtT1RSUy1TdGF0ZS1QZW5kaW5nVGltZSd9LiIsCiAgICAgICAgKTsKICAgIH0KCiAgICAjIGdldCBkeW5hbWljIGZpZWxkIG9iamVjdHMKICAgIG15ICREeW5hbWljRmllbGRPYmplY3QgICAgICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkR5bmFtaWNGaWVsZCcpOwogICAgbXkgJER5bmFtaWNGaWVsZEJhY2tlbmRPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6RHluYW1pY0ZpZWxkOjpCYWNrZW5kJyk7CgogICAgIyBkeW5hbWljIGZpZWxkcwogICAgbXkgJER5bmFtaWNGaWVsZExpc3QgPQogICAgICAgICREeW5hbWljRmllbGRPYmplY3QtPkR5bmFtaWNGaWVsZExpc3QoCiAgICAgICAgVmFsaWQgICAgICA9PiAxLAogICAgICAgIFJlc3VsdFR5cGUgPT4gJ0hBU0gnLAogICAgICAgIE9iamVjdFR5cGUgPT4gJ1RpY2tldCcsCiAgICAgICAgKTsKCiAgICAjIHNldCBkeW5hbWljIGZpZWxkcyBmb3IgVGlja2V0IG9iamVjdCB0eXBlCiAgICBEWU5BTUlDRklFTERJRDoKICAgIGZvciBteSAkRHluYW1pY0ZpZWxkSUQgKCBzb3J0IGtleXMgJXskRHluYW1pY0ZpZWxkTGlzdH0gKSB7CiAgICAgICAgbmV4dCBEWU5BTUlDRklFTERJRCBpZiAhJER5bmFtaWNGaWVsZElEOwogICAgICAgIG5leHQgRFlOQU1JQ0ZJRUxESUQgaWYgISREeW5hbWljRmllbGRMaXN0LT57JER5bmFtaWNGaWVsZElEfTsKICAgICAgICBteSAkS2V5ID0gJ1gtT1RSUy1EeW5hbWljRmllbGQtJyAuICREeW5hbWljRmllbGRMaXN0LT57JER5bmFtaWNGaWVsZElEfTsKCiAgICAgICAgaWYgKCBkZWZpbmVkICRHZXRQYXJhbXskS2V5fSAmJiBsZW5ndGggJEdldFBhcmFteyRLZXl9ICkgewoKICAgICAgICAgICAgIyBnZXQgZHluYW1pYyBmaWVsZCBjb25maWcKICAgICAgICAgICAgbXkgJER5bmFtaWNGaWVsZEdldCA9ICREeW5hbWljRmllbGRPYmplY3QtPkR5bmFtaWNGaWVsZEdldCgKICAgICAgICAgICAgICAgIElEID0+ICREeW5hbWljRmllbGRJRCwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0LT5WYWx1ZVNldCgKICAgICAgICAgICAgICAgIER5bmFtaWNGaWVsZENvbmZpZyA9PiAkRHluYW1pY0ZpZWxkR2V0LAogICAgICAgICAgICAgICAgT2JqZWN0SUQgICAgICAgICAgID0+ICRUaWNrZXRJRCwKICAgICAgICAgICAgICAgIFZhbHVlICAgICAgICAgICAgICA9PiAkR2V0UGFyYW17JEtleX0sCiAgICAgICAgICAgICAgICBVc2VySUQgICAgICAgICAgICAgPT4gJFBhcmFte0lubWFpbFVzZXJJRH0sCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAkU2VsZi0+e0NvbW11bmljYXRpb25Mb2dPYmplY3R9LT5PYmplY3RMb2coCiAgICAgICAgICAgICAgICBPYmplY3RMb2dUeXBlID0+ICdNZXNzYWdlJywKICAgICAgICAgICAgICAgIFByaW9yaXR5ICAgICAgPT4gJ0RlYnVnJywKICAgICAgICAgICAgICAgIEtleSAgICAgICAgICAgPT4gJ0tlcm5lbDo6U3lzdGVtOjpQb3N0TWFzdGVyOjpOZXdUaWNrZXQnLAogICAgICAgICAgICAgICAgVmFsdWUgICAgICAgICA9PiAiRHluYW1pY0ZpZWxkIHVwZGF0ZSB2aWEgJyRLZXknISBWYWx1ZTogJEdldFBhcmFteyRLZXl9LiIsCiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgfQoKICAgICMgcmV2ZXJzZSBkeW5hbWljIGZpZWxkIGxpc3QKICAgIG15ICVEeW5hbWljRmllbGRMaXN0UmV2ZXJzZWQgPSByZXZlcnNlICV7JER5bmFtaWNGaWVsZExpc3R9OwoKICAgICMgc2V0IHRpY2tldCBmcmVlIHRleHQKICAgICMgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgKHNob3VsZCBiZSByZW1vdmVkIGluIGEgZnV0dXJlIHZlcnNpb24pCiAgICBteSAlVmFsdWVzID0KICAgICAgICAoCiAgICAgICAgJ1gtT1RSUy1UaWNrZXRLZXknICAgPT4gJ1RpY2tldEZyZWVLZXknLAogICAgICAgICdYLU9UUlMtVGlja2V0VmFsdWUnID0+ICdUaWNrZXRGcmVlVGV4dCcsCiAgICAgICAgKTsKICAgIGZvciBteSAkSXRlbSAoIHNvcnQga2V5cyAlVmFsdWVzICkgewogICAgICAgIGZvciBteSAkQ291bnQgKCAxIC4uIDE2ICkgewogICAgICAgICAgICBteSAkS2V5ID0gJEl0ZW0gLiAkQ291bnQ7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIGRlZmluZWQgJEdldFBhcmFteyRLZXl9CiAgICAgICAgICAgICAgICAmJiBsZW5ndGggJEdldFBhcmFteyRLZXl9CiAgICAgICAgICAgICAgICAmJiAkRHluYW1pY0ZpZWxkTGlzdFJldmVyc2VkeyAkVmFsdWVzeyRJdGVtfSAuICRDb3VudCB9CiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICMgZ2V0IGR5bmFtaWMgZmllbGQgY29uZmlnCiAgICAgICAgICAgICAgICBteSAkRHluYW1pY0ZpZWxkR2V0ID0gJER5bmFtaWNGaWVsZE9iamVjdC0+RHluYW1pY0ZpZWxkR2V0KAogICAgICAgICAgICAgICAgICAgIElEID0+ICREeW5hbWljRmllbGRMaXN0UmV2ZXJzZWR7ICRWYWx1ZXN7JEl0ZW19IC4gJENvdW50IH0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgaWYgKCREeW5hbWljRmllbGRHZXQpIHsKICAgICAgICAgICAgICAgICAgICBteSAkU3VjY2VzcyA9ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0LT5WYWx1ZVNldCgKICAgICAgICAgICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRHZXQsCiAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdElEICAgICAgICAgICA9PiAkVGlja2V0SUQsCiAgICAgICAgICAgICAgICAgICAgICAgIFZhbHVlICAgICAgICAgICAgICA9PiAkR2V0UGFyYW17JEtleX0sCiAgICAgICAgICAgICAgICAgICAgICAgIFVzZXJJRCAgICAgICAgICAgICA9PiAkUGFyYW17SW5tYWlsVXNlcklEfSwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRTZWxmLT57Q29tbXVuaWNhdGlvbkxvZ09iamVjdH0tPk9iamVjdExvZygKICAgICAgICAgICAgICAgICAgICBPYmplY3RMb2dUeXBlID0+ICdNZXNzYWdlJywKICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSAgICAgID0+ICdEZWJ1ZycsCiAgICAgICAgICAgICAgICAgICAgS2V5ICAgICAgICAgICA9PiAnS2VybmVsOjpTeXN0ZW06OlBvc3RNYXN0ZXI6Ok5ld1RpY2tldCcsCiAgICAgICAgICAgICAgICAgICAgVmFsdWUgICAgICAgICA9PiAiRHluYW1pY0ZpZWxkIChUaWNrZXRLZXkkQ291bnQpIHVwZGF0ZSB2aWEgJyRLZXknISBWYWx1ZTogJEdldFBhcmFteyRLZXl9LiIsCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgICMgc2V0IHRpY2tldCBmcmVlIHRpbWUKICAgICMgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgKHNob3VsZCBiZSByZW1vdmVkIGluIGEgZnV0dXJlIHZlcnNpb24pCiAgICBmb3IgbXkgJENvdW50ICggMSAuLiA2ICkgewoKICAgICAgICBteSAkS2V5ID0gJ1gtT1RSUy1UaWNrZXRUaW1lJyAuICRDb3VudDsKCiAgICAgICAgaWYgKCBkZWZpbmVkICRHZXRQYXJhbXskS2V5fSAmJiBsZW5ndGggJEdldFBhcmFteyRLZXl9ICkgewoKICAgICAgICAgICAgIyBnZXQgZGF0ZXRpbWUgb2JqZWN0CiAgICAgICAgICAgIG15ICREYXRlVGltZU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5DcmVhdGUoCiAgICAgICAgICAgICAgICAnS2VybmVsOjpTeXN0ZW06OkRhdGVUaW1lJywKICAgICAgICAgICAgICAgIE9iamVjdFBhcmFtcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgU3RyaW5nID0+ICRHZXRQYXJhbXskS2V5fQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKCAkRGF0ZVRpbWVPYmplY3QgJiYgJER5bmFtaWNGaWVsZExpc3RSZXZlcnNlZHsgJ1RpY2tldEZyZWVUaW1lJyAuICRDb3VudCB9ICkgewoKICAgICAgICAgICAgICAgICMgZ2V0IGR5bmFtaWMgZmllbGQgY29uZmlnCiAgICAgICAgICAgICAgICBteSAkRHluYW1pY0ZpZWxkR2V0ID0gJER5bmFtaWNGaWVsZE9iamVjdC0+RHluYW1pY0ZpZWxkR2V0KAogICAgICAgICAgICAgICAgICAgIElEID0+ICREeW5hbWljRmllbGRMaXN0UmV2ZXJzZWR7ICdUaWNrZXRGcmVlVGltZScgLiAkQ291bnQgfSwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgaWYgKCREeW5hbWljRmllbGRHZXQpIHsKICAgICAgICAgICAgICAgICAgICBteSAkU3VjY2VzcyA9ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0LT5WYWx1ZVNldCgKICAgICAgICAgICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRHZXQsCiAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdElEICAgICAgICAgICA9PiAkVGlja2V0SUQsCiAgICAgICAgICAgICAgICAgICAgICAgIFZhbHVlICAgICAgICAgICAgICA9PiAkR2V0UGFyYW17JEtleX0sCiAgICAgICAgICAgICAgICAgICAgICAgIFVzZXJJRCAgICAgICAgICAgICA9PiAkUGFyYW17SW5tYWlsVXNlcklEfSwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRTZWxmLT57Q29tbXVuaWNhdGlvbkxvZ09iamVjdH0tPk9iamVjdExvZygKICAgICAgICAgICAgICAgICAgICBPYmplY3RMb2dUeXBlID0+ICdNZXNzYWdlJywKICAgICAgICAgICAgICAgICAgICBQcmlvcml0eSAgICAgID0+ICdEZWJ1ZycsCiAgICAgICAgICAgICAgICAgICAgS2V5ICAgICAgICAgICA9PiAnS2VybmVsOjpTeXN0ZW06OlBvc3RNYXN0ZXI6Ok5ld1RpY2tldCcsCiAgICAgICAgICAgICAgICAgICAgVmFsdWUgICAgICAgICA9PiAiRHluYW1pY0ZpZWxkIChUaWNrZXRUaW1lJENvdW50KSB1cGRhdGUgdmlhICckS2V5JyEgVmFsdWU6ICRHZXRQYXJhbXskS2V5fS4iLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBteSAkQXJ0aWNsZU9iamVjdCAgICAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VGlja2V0OjpBcnRpY2xlJyk7CiAgICBteSAkQXJ0aWNsZUJhY2tlbmRPYmplY3QgPSAkQXJ0aWNsZU9iamVjdC0+QmFja2VuZEZvckNoYW5uZWwoCiAgICAgICAgQ2hhbm5lbE5hbWUgPT4gJ0VtYWlsJywKICAgICk7CgogICAgbXkgJElzVmlzaWJsZUZvckN1c3RvbWVyID0gMTsKICAgIGlmICggbGVuZ3RoICRHZXRQYXJhbXsnWC1PVFJTLUlzVmlzaWJsZUZvckN1c3RvbWVyJ30gKSB7CiAgICAgICAgJElzVmlzaWJsZUZvckN1c3RvbWVyID0gJEdldFBhcmFteydYLU9UUlMtSXNWaXNpYmxlRm9yQ3VzdG9tZXInfTsKICAgIH0KCiAgICAkU2VsZi0+e0NvbW11bmljYXRpb25Mb2dPYmplY3R9LT5PYmplY3RMb2coCiAgICAgICAgT2JqZWN0TG9nVHlwZSA9PiAnTWVzc2FnZScsCiAgICAgICAgUHJpb3JpdHkgICAgICA9PiAnRGVidWcnLAogICAgICAgIEtleSAgICAgICAgICAgPT4gJ0tlcm5lbDo6U3lzdGVtOjpQb3N0TWFzdGVyOjpOZXdUaWNrZXQnLAogICAgICAgIFZhbHVlICAgICAgICAgPT4gIkdvaW5nIHRvIGNyZWF0ZSBuZXcgYXJ0aWNsZSBmb3IgVGlja2V0SUQgJyRUaWNrZXRJRCcuIiwKICAgICk7CgogICAgIyBDaGVjayBpZiBYLU9UUlMtU2VuZGVyVHlwZSBleGlzdHMsIGlmIG5vdCBzZXQgZGVmYXVsdCAnY3VzdG9tZXInLgogICAgaWYgKCAhJEFydGljbGVPYmplY3QtPkFydGljbGVTZW5kZXJUeXBlTG9va3VwKCBTZW5kZXJUeXBlID0+ICRHZXRQYXJhbXsnWC1PVFJTLVNlbmRlclR5cGUnfSApICkKICAgIHsKICAgICAgICAkU2VsZi0+e0NvbW11bmljYXRpb25Mb2dPYmplY3R9LT5PYmplY3RMb2coCiAgICAgICAgICAgIE9iamVjdExvZ1R5cGUgPT4gJ01lc3NhZ2UnLAogICAgICAgICAgICBQcmlvcml0eSAgICAgID0+ICdFcnJvcicsCiAgICAgICAgICAgIEtleSAgICAgICAgICAgPT4gJ0tlcm5lbDo6U3lzdGVtOjpQb3N0TWFzdGVyOjpOZXdUaWNrZXQnLAogICAgICAgICAgICBWYWx1ZSAgICAgICAgID0+ICJDYW4ndCBmaW5kIHZhbGlkIFNlbmRlclR5cGUgJyRHZXRQYXJhbXsnWC1PVFJTLVNlbmRlclR5cGUnfScgaW4gREIsIHRha2UgJ2N1c3RvbWVyJyIsCiAgICAgICAgKTsKICAgICAgICAkR2V0UGFyYW17J1gtT1RSUy1TZW5kZXJUeXBlJ30gPSAnY3VzdG9tZXInOwogICAgfQoKICAgICMgQ3JlYXRlIGVtYWlsIGFydGljbGUuCiAgICBteSAkQXJ0aWNsZUlEID0gJEFydGljbGVCYWNrZW5kT2JqZWN0LT5BcnRpY2xlQ3JlYXRlKAogICAgICAgIFRpY2tldElEICAgICAgICAgICAgID0+ICRUaWNrZXRJRCwKICAgICAgICBTZW5kZXJUeXBlICAgICAgICAgICA9PiAkR2V0UGFyYW17J1gtT1RSUy1TZW5kZXJUeXBlJ30sCiAgICAgICAgSXNWaXNpYmxlRm9yQ3VzdG9tZXIgPT4gJElzVmlzaWJsZUZvckN1c3RvbWVyLAogICAgICAgIEZyb20gICAgICAgICAgICAgICAgID0+ICRHZXRQYXJhbXtGcm9tfSwKICAgICAgICBSZXBseVRvICAgICAgICAgICAgICA9PiAkR2V0UGFyYW17UmVwbHlUb30sCiAgICAgICAgVG8gICAgICAgICAgICAgICAgICAgPT4gJEdldFBhcmFte1RvfSwKICAgICAgICBDYyAgICAgICAgICAgICAgICAgICA9PiAkR2V0UGFyYW17Q2N9LAogICAgICAgIFN1YmplY3QgICAgICAgICAgICAgID0+ICRHZXRQYXJhbXtTdWJqZWN0fSwKICAgICAgICBNZXNzYWdlSUQgICAgICAgICAgICA9PiAkR2V0UGFyYW17J01lc3NhZ2UtSUQnfSwKICAgICAgICBJblJlcGx5VG8gICAgICAgICAgICA9PiAkR2V0UGFyYW17J0luLVJlcGx5LVRvJ30sCiAgICAgICAgUmVmZXJlbmNlcyAgICAgICAgICAgPT4gJEdldFBhcmFteydSZWZlcmVuY2VzJ30sCiAgICAgICAgQ29udGVudFR5cGUgICAgICAgICAgPT4gJEdldFBhcmFteydDb250ZW50LVR5cGUnfSwKICAgICAgICBDb250ZW50RGlzcG9zaXRpb24gICA9PiAkR2V0UGFyYW17J0NvbnRlbnQtRGlzcG9zaXRpb24nfSwKICAgICAgICBCb2R5ICAgICAgICAgICAgICAgICA9PiAkR2V0UGFyYW17Qm9keX0sCiAgICAgICAgVXNlcklEICAgICAgICAgICAgICAgPT4gJFBhcmFte0lubWFpbFVzZXJJRH0sCiAgICAgICAgSGlzdG9yeVR5cGUgICAgICAgICAgPT4gJ0VtYWlsQ3VzdG9tZXInLAogICAgICAgIEhpc3RvcnlDb21tZW50ICAgICAgID0+ICJcJVwlJENvbW1lbnQiLAogICAgICAgIE9yaWdIZWFkZXIgICAgICAgICAgID0+IFwlR2V0UGFyYW0sCiAgICAgICAgQXV0b1Jlc3BvbnNlVHlwZSAgICAgPT4gJEF1dG9SZXNwb25zZVR5cGUsCiAgICAgICAgUXVldWUgICAgICAgICAgICAgICAgPT4gJFF1ZXVlLAogICAgKTsKCiAgICAjIGNsb3NlIHRpY2tldCBpZiBhcnRpY2xlIGNyZWF0ZSBmYWlsZWQhCiAgICBpZiAoICEkQXJ0aWNsZUlEICkgewoKICAgICAgICAkU2VsZi0+e0NvbW11bmljYXRpb25Mb2dPYmplY3R9LT5PYmplY3RMb2coCiAgICAgICAgICAgIE9iamVjdExvZ1R5cGUgPT4gJ01lc3NhZ2UnLAogICAgICAgICAgICBQcmlvcml0eSAgICAgID0+ICdFcnJvcicsCiAgICAgICAgICAgIEtleSAgICAgICAgICAgPT4gJ0tlcm5lbDo6U3lzdGVtOjpQb3N0TWFzdGVyOjpOZXdUaWNrZXQnLAogICAgICAgICAgICBWYWx1ZSAgICAgICAgID0+ICJDYW4ndCBwcm9jZXNzIGVtYWlsIHdpdGggTWVzc2FnZUlEIDwkR2V0UGFyYW17J01lc3NhZ2UtSUQnfT4hICIKICAgICAgICAgICAgICAgIC4gIlBsZWFzZSBjcmVhdGUgYSBidWcgcmVwb3J0IHdpdGggdGhpcyBlbWFpbCAoRnJvbTogJEdldFBhcmFte0Zyb219LCBMb2NhdGVkICIKICAgICAgICAgICAgICAgIC4gInVuZGVyIHZhci9zcG9vbC9wcm9ibGVtLWVtYWlsKikgb24gaHR0cDovL2J1Z3Mub3Rycy5vcmcvISIsCiAgICAgICAgKTsKCiAgICAgICAgJFNlbGYtPntDb21tdW5pY2F0aW9uTG9nT2JqZWN0fS0+T2JqZWN0TG9nKAogICAgICAgICAgICBPYmplY3RMb2dUeXBlID0+ICdNZXNzYWdlJywKICAgICAgICAgICAgUHJpb3JpdHkgICAgICA9PiAnRGVidWcnLAogICAgICAgICAgICBLZXkgICAgICAgICAgID0+ICdLZXJuZWw6OlN5c3RlbTo6UG9zdE1hc3Rlcjo6TmV3VGlja2V0JywKICAgICAgICAgICAgVmFsdWUgICAgICAgICA9PiAiVGlja2V0SUQgJyRUaWNrZXRJRCcgd2lsbCBiZSBkZWxldGVkIGFnYWluISIsCiAgICAgICAgKTsKCiAgICAgICAgJFRpY2tldE9iamVjdC0+VGlja2V0RGVsZXRlKAogICAgICAgICAgICBUaWNrZXRJRCA9PiAkVGlja2V0SUQsCiAgICAgICAgICAgIFVzZXJJRCAgID0+ICRQYXJhbXtJbm1haWxVc2VySUR9LAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgICRTZWxmLT57Q29tbXVuaWNhdGlvbkxvZ09iamVjdH0tPk9iamVjdExvb2t1cFNldCgKICAgICAgICBPYmplY3RMb2dUeXBlICAgID0+ICdNZXNzYWdlJywKICAgICAgICBUYXJnZXRPYmplY3RUeXBlID0+ICdBcnRpY2xlJywKICAgICAgICBUYXJnZXRPYmplY3RJRCAgID0+ICRBcnRpY2xlSUQsCiAgICApOwoKICAgIGlmICggJFBhcmFte0xpbmtUb1RpY2tldElEfSApIHsKCiAgICAgICAgbXkgJFNvdXJjZUtleSA9ICRQYXJhbXtMaW5rVG9UaWNrZXRJRH07CiAgICAgICAgbXkgJFRhcmdldEtleSA9ICRUaWNrZXRJRDsKCiAgICAgICAgJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxpbmtPYmplY3QnKS0+TGlua0FkZCgKICAgICAgICAgICAgU291cmNlT2JqZWN0ID0+ICdUaWNrZXQnLAogICAgICAgICAgICBTb3VyY2VLZXkgICAgPT4gJFNvdXJjZUtleSwKICAgICAgICAgICAgVGFyZ2V0T2JqZWN0ID0+ICdUaWNrZXQnLAogICAgICAgICAgICBUYXJnZXRLZXkgICAgPT4gJFRhcmdldEtleSwKICAgICAgICAgICAgVHlwZSAgICAgICAgID0+ICdOb3JtYWwnLAogICAgICAgICAgICBTdGF0ZSAgICAgICAgPT4gJ1ZhbGlkJywKICAgICAgICAgICAgVXNlcklEICAgICAgID0+ICRQYXJhbXtJbm1haWxVc2VySUR9LAogICAgICAgICk7CiAgICB9CgogICAgbXkgJUNvbW11bmljYXRpb25Mb2dTa2lwQXR0cmlidXRlcyA9ICgKICAgICAgICBCb2R5ICAgICAgID0+IDEsCiAgICAgICAgQXR0YWNobWVudCA9PiAxLAogICAgKTsKCiAgICBBVFRSSUJVVEU6CiAgICBmb3IgbXkgJEF0dHJpYnV0ZSAoIHNvcnQga2V5cyAlR2V0UGFyYW0gKSB7CiAgICAgICAgbmV4dCBBVFRSSUJVVEUgaWYgJENvbW11bmljYXRpb25Mb2dTa2lwQXR0cmlidXRlc3skQXR0cmlidXRlfTsKCiAgICAgICAgbXkgJFZhbHVlID0gJEdldFBhcmFteyRBdHRyaWJ1dGV9OwogICAgICAgIG5leHQgQVRUUklCVVRFIGlmICEoIGRlZmluZWQgJFZhbHVlICkgfHwgISggbGVuZ3RoICRWYWx1ZSApOwoKICAgICAgICAkU2VsZi0+e0NvbW11bmljYXRpb25Mb2dPYmplY3R9LT5PYmplY3RMb2coCiAgICAgICAgICAgIE9iamVjdExvZ1R5cGUgPT4gJ01lc3NhZ2UnLAogICAgICAgICAgICBQcmlvcml0eSAgICAgID0+ICdEZWJ1ZycsCiAgICAgICAgICAgIEtleSAgICAgICAgICAgPT4gJ0tlcm5lbDo6U3lzdGVtOjpQb3N0TWFzdGVyOjpOZXdUaWNrZXQnLAogICAgICAgICAgICBWYWx1ZSAgICAgICAgID0+ICIkQXR0cmlidXRlOiAkVmFsdWUiLAogICAgICAgICk7CiAgICB9CgogICAgIyBkeW5hbWljIGZpZWxkcwogICAgJER5bmFtaWNGaWVsZExpc3QgPQogICAgICAgICREeW5hbWljRmllbGRPYmplY3QtPkR5bmFtaWNGaWVsZExpc3QoCiAgICAgICAgVmFsaWQgICAgICA9PiAxLAogICAgICAgIFJlc3VsdFR5cGUgPT4gJ0hBU0gnLAogICAgICAgIE9iamVjdFR5cGUgPT4gJ0FydGljbGUnLAogICAgICAgICk7CgogICAgIyBzZXQgZHluYW1pYyBmaWVsZHMgZm9yIEFydGljbGUgb2JqZWN0IHR5cGUKICAgIERZTkFNSUNGSUVMRElEOgogICAgZm9yIG15ICREeW5hbWljRmllbGRJRCAoIHNvcnQga2V5cyAleyREeW5hbWljRmllbGRMaXN0fSApIHsKICAgICAgICBuZXh0IERZTkFNSUNGSUVMRElEIGlmICEkRHluYW1pY0ZpZWxkSUQ7CiAgICAgICAgbmV4dCBEWU5BTUlDRklFTERJRCBpZiAhJER5bmFtaWNGaWVsZExpc3QtPnskRHluYW1pY0ZpZWxkSUR9OwogICAgICAgIG15ICRLZXkgPSAnWC1PVFJTLUR5bmFtaWNGaWVsZC0nIC4gJER5bmFtaWNGaWVsZExpc3QtPnskRHluYW1pY0ZpZWxkSUR9OwogICAgICAgIGlmICggZGVmaW5lZCAkR2V0UGFyYW17JEtleX0gJiYgbGVuZ3RoICRHZXRQYXJhbXskS2V5fSApIHsKCiAgICAgICAgICAgICMgZ2V0IGR5bmFtaWMgZmllbGQgY29uZmlnCiAgICAgICAgICAgIG15ICREeW5hbWljRmllbGRHZXQgPSAkRHluYW1pY0ZpZWxkT2JqZWN0LT5EeW5hbWljRmllbGRHZXQoCiAgICAgICAgICAgICAgICBJRCA9PiAkRHluYW1pY0ZpZWxkSUQsCiAgICAgICAgICAgICk7CgogICAgICAgICAgICAkRHluYW1pY0ZpZWxkQmFja2VuZE9iamVjdC0+VmFsdWVTZXQoCiAgICAgICAgICAgICAgICBEeW5hbWljRmllbGRDb25maWcgPT4gJER5bmFtaWNGaWVsZEdldCwKICAgICAgICAgICAgICAgIE9iamVjdElEICAgICAgICAgICA9PiAkQXJ0aWNsZUlELAogICAgICAgICAgICAgICAgVmFsdWUgICAgICAgICAgICAgID0+ICRHZXRQYXJhbXskS2V5fSwKICAgICAgICAgICAgICAgIFVzZXJJRCAgICAgICAgICAgICA9PiAkUGFyYW17SW5tYWlsVXNlcklEfSwKICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICRTZWxmLT57Q29tbXVuaWNhdGlvbkxvZ09iamVjdH0tPk9iamVjdExvZygKICAgICAgICAgICAgICAgIE9iamVjdExvZ1R5cGUgPT4gJ01lc3NhZ2UnLAogICAgICAgICAgICAgICAgUHJpb3JpdHkgICAgICA9PiAnRGVidWcnLAogICAgICAgICAgICAgICAgS2V5ICAgICAgICAgICA9PiAnS2VybmVsOjpTeXN0ZW06OlBvc3RNYXN0ZXI6Ok5ld1RpY2tldCcsCiAgICAgICAgICAgICAgICBWYWx1ZSAgICAgICAgID0+ICJBcnRpY2xlIER5bmFtaWNGaWVsZCB1cGRhdGUgdmlhICckS2V5JyEgVmFsdWU6ICRHZXRQYXJhbXskS2V5fS4iLAogICAgICAgICAgICApOwogICAgICAgIH0KICAgIH0KCiAgICAjIHJldmVyc2UgZHluYW1pYyBmaWVsZCBsaXN0CiAgICAlRHluYW1pY0ZpZWxkTGlzdFJldmVyc2VkID0gcmV2ZXJzZSAleyREeW5hbWljRmllbGRMaXN0fTsKCiAgICAjIHNldCBmcmVlIGFydGljbGUgdGV4dAogICAgIyBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eSAoc2hvdWxkIGJlIHJlbW92ZWQgaW4gYSBmdXR1cmUgdmVyc2lvbikKICAgICVWYWx1ZXMgPQogICAgICAgICgKICAgICAgICAnWC1PVFJTLUFydGljbGVLZXknICAgPT4gJ0FydGljbGVGcmVlS2V5JywKICAgICAgICAnWC1PVFJTLUFydGljbGVWYWx1ZScgPT4gJ0FydGljbGVGcmVlVGV4dCcsCiAgICAgICAgKTsKICAgIGZvciBteSAkSXRlbSAoIHNvcnQga2V5cyAlVmFsdWVzICkgewogICAgICAgIGZvciBteSAkQ291bnQgKCAxIC4uIDE2ICkgewogICAgICAgICAgICBteSAkS2V5ID0gJEl0ZW0gLiAkQ291bnQ7CiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIGRlZmluZWQgJEdldFBhcmFteyRLZXl9CiAgICAgICAgICAgICAgICAmJiBsZW5ndGggJEdldFBhcmFteyRLZXl9CiAgICAgICAgICAgICAgICAmJiAkRHluYW1pY0ZpZWxkTGlzdFJldmVyc2VkeyAkVmFsdWVzeyRJdGVtfSAuICRDb3VudCB9CiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICMgZ2V0IGR5bmFtaWMgZmllbGQgY29uZmlnCiAgICAgICAgICAgICAgICBteSAkRHluYW1pY0ZpZWxkR2V0ID0gJER5bmFtaWNGaWVsZE9iamVjdC0+RHluYW1pY0ZpZWxkR2V0KAogICAgICAgICAgICAgICAgICAgIElEID0+ICREeW5hbWljRmllbGRMaXN0UmV2ZXJzZWR7ICRWYWx1ZXN7JEl0ZW19IC4gJENvdW50IH0sCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgaWYgKCREeW5hbWljRmllbGRHZXQpIHsKICAgICAgICAgICAgICAgICAgICBteSAkU3VjY2VzcyA9ICREeW5hbWljRmllbGRCYWNrZW5kT2JqZWN0LT5WYWx1ZVNldCgKICAgICAgICAgICAgICAgICAgICAgICAgRHluYW1pY0ZpZWxkQ29uZmlnID0+ICREeW5hbWljRmllbGRHZXQsCiAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdElEICAgICAgICAgICA9PiAkQXJ0aWNsZUlELAogICAgICAgICAgICAgICAgICAgICAgICBWYWx1ZSAgICAgICAgICAgICAgPT4gJEdldFBhcmFteyRLZXl9LAogICAgICAgICAgICAgICAgICAgICAgICBVc2VySUQgICAgICAgICAgICAgPT4gJFBhcmFte0lubWFpbFVzZXJJRH0sCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkU2VsZi0+e0NvbW11bmljYXRpb25Mb2dPYmplY3R9LT5PYmplY3RMb2coCiAgICAgICAgICAgICAgICAgICAgT2JqZWN0TG9nVHlwZSA9PiAnTWVzc2FnZScsCiAgICAgICAgICAgICAgICAgICAgUHJpb3JpdHkgICAgICA9PiAnRGVidWcnLAogICAgICAgICAgICAgICAgICAgIEtleSAgICAgICAgICAgPT4gJ0tlcm5lbDo6U3lzdGVtOjpQb3N0TWFzdGVyOjpOZXdUaWNrZXQnLAogICAgICAgICAgICAgICAgICAgIFZhbHVlICAgICAgICAgPT4gIkFydGljbGUgRHluYW1pY0ZpZWxkIChBcnRpY2xlS2V5KSB1cGRhdGUgdmlhICckS2V5JyEgVmFsdWU6ICRHZXRQYXJhbXskS2V5fS4iLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAjIHdyaXRlIHBsYWluIGVtYWlsIHRvIHRoZSBzdG9yYWdlCiAgICAkQXJ0aWNsZUJhY2tlbmRPYmplY3QtPkFydGljbGVXcml0ZVBsYWluKAogICAgICAgIEFydGljbGVJRCA9PiAkQXJ0aWNsZUlELAogICAgICAgIEVtYWlsICAgICA9PiAkU2VsZi0+e1BhcnNlck9iamVjdH0tPkdldFBsYWluRW1haWwoKSwKICAgICAgICBVc2VySUQgICAgPT4gJFBhcmFte0lubWFpbFVzZXJJRH0sCiAgICApOwoKICAgICMgd3JpdGUgYXR0YWNobWVudHMgdG8gdGhlIHN0b3JhZ2UKICAgIGZvciBteSAkQXR0YWNobWVudCAoICRTZWxmLT57UGFyc2VyT2JqZWN0fS0+R2V0QXR0YWNobWVudHMoKSApIHsKICAgICAgICAkQXJ0aWNsZUJhY2tlbmRPYmplY3QtPkFydGljbGVXcml0ZUF0dGFjaG1lbnQoCiAgICAgICAgICAgIEZpbGVuYW1lICAgICAgICAgICA9PiAkQXR0YWNobWVudC0+e0ZpbGVuYW1lfSwKICAgICAgICAgICAgQ29udGVudCAgICAgICAgICAgID0+ICRBdHRhY2htZW50LT57Q29udGVudH0sCiAgICAgICAgICAgIENvbnRlbnRUeXBlICAgICAgICA9PiAkQXR0YWNobWVudC0+e0NvbnRlbnRUeXBlfSwKICAgICAgICAgICAgQ29udGVudElEICAgICAgICAgID0+ICRBdHRhY2htZW50LT57Q29udGVudElEfSwKICAgICAgICAgICAgQ29udGVudEFsdGVybmF0aXZlID0+ICRBdHRhY2htZW50LT57Q29udGVudEFsdGVybmF0aXZlfSwKICAgICAgICAgICAgRGlzcG9zaXRpb24gICAgICAgID0+ICRBdHRhY2htZW50LT57RGlzcG9zaXRpb259LAogICAgICAgICAgICBBcnRpY2xlSUQgICAgICAgICAgPT4gJEFydGljbGVJRCwKICAgICAgICAgICAgVXNlcklEICAgICAgICAgICAgID0+ICRQYXJhbXtJbm1haWxVc2VySUR9LAogICAgICAgICk7CiAgICB9CgogICAgcmV0dXJuICRUaWNrZXRJRDsKfQoKMTsK</File>
        <File Location="Custom/Kernel/System/ProcessManagement/TransitionAction/ConfigItemUpdate.pm" Permission="660" Encode="Base64">IyAtLQojIENvcHlyaWdodCAoQykgMjAyMS0yMDIyIFpudW55IEdtYkgsIGh0dHBzOi8vem51bnkub3JnLwojIC0tCiMgVGhpcyBzb2Z0d2FyZSBjb21lcyB3aXRoIEFCU09MVVRFTFkgTk8gV0FSUkFOVFkuIEZvciBkZXRhaWxzLCBzZWUKIyB0aGUgZW5jbG9zZWQgZmlsZSBDT1BZSU5HIGZvciBsaWNlbnNlIGluZm9ybWF0aW9uIChBR1BMKS4gSWYgeW91CiMgZGlkIG5vdCByZWNlaXZlIHRoaXMgZmlsZSwgc2VlIGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9hZ3BsLnR4dC4KIyAtLQoKcGFja2FnZSBLZXJuZWw6OlN5c3RlbTo6UHJvY2Vzc01hbmFnZW1lbnQ6OlRyYW5zaXRpb25BY3Rpb246OkNvbmZpZ0l0ZW1VcGRhdGU7Cgp1c2Ugc3RyaWN0Owp1c2Ugd2FybmluZ3M7CnVzZSB1dGY4OwoKdXNlIEtlcm5lbDo6U3lzdGVtOjpWYXJpYWJsZUNoZWNrIHF3KDphbGwpOwoKdXNlIHBhcmVudCBxdyhLZXJuZWw6OlN5c3RlbTo6UHJvY2Vzc01hbmFnZW1lbnQ6OlRyYW5zaXRpb25BY3Rpb246OkJhc2UpOwoKb3VyIEBPYmplY3REZXBlbmRlbmNpZXMgPSAoCiAgICAnS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyVXNlcicsCiAgICAnS2VybmVsOjpTeXN0ZW06OklUU01Db25maWdJdGVtJywKICAgICdLZXJuZWw6OlN5c3RlbTo6TG9nJywKICAgICdLZXJuZWw6OlN5c3RlbTo6VGlja2V0JywKICAgICdLZXJuZWw6OlN5c3RlbTo6VXNlcicsCiAgICAnS2VybmVsOjpTeXN0ZW06OlV0aWwnLAogICAgJ0tlcm5lbDo6U3lzdGVtOjpabnVueUhlbHBlcicsCik7Cgo9aGVhZDEgTkFNRQoKS2VybmVsOjpTeXN0ZW06OlByb2Nlc3NNYW5hZ2VtZW50OjpUcmFuc2l0aW9uQWN0aW9uOjpDb25maWdJdGVtVXBkYXRlIC0gQSBtb2R1bGUgdG8gZGVwbG95IENJIHN0YXRlCgo9aGVhZDEgU1lOT1BTSVMKCkFsbCBDb25maWdJdGVtVXBkYXRlIGZ1bmN0aW9ucy4KCj1oZWFkMSBQVUJMSUMgSU5URVJGQUNFCgo9aGVhZDIgbmV3KCkKCmNyZWF0ZSBhbiBvYmplY3QuIERvIG5vdCB1c2UgaXQgZGlyZWN0bHksIGluc3RlYWQgdXNlOgoKICAgIG15ICRDb25maWdJdGVtVXBkYXRlT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OlByb2Nlc3NNYW5hZ2VtZW50OjpUcmFuc2l0aW9uQWN0aW9uOjpDb25maWdJdGVtVXBkYXRlJyk7Cgo9Y3V0CgpzdWIgbmV3IHsKICAgIG15ICggJFR5cGUsICVQYXJhbSApID0gQF87CgogICAgbXkgJFNlbGYgPSB7fTsKICAgIGJsZXNzKCAkU2VsZiwgJFR5cGUgKTsKCiAgICByZXR1cm4gJFNlbGY7Cn0KCj1oZWFkMiBSdW4oKQoKUnVucyBUcmFuc2l0aW9uQWN0aW9uIENvbmZpZ0l0ZW1VcGRhdGUuClRoaXMgZnVuY3Rpb24gc2V0cywgdXBkYXRlcyBvciBkZWxldGVzIHZhbHVlcyAob2YgYXR0cmlidXRlKSBvZiBnaXZlbiBDb25maWdJdGVtSUQgKENvbmZpZ0l0ZW1OdW1iZXIpLgoKICAgIG15ICRTdWNjZXNzID0gJENvbmZpZ0l0ZW1VcGRhdGVPYmplY3QtPlJ1bigKICAgICAgICBVc2VySUQgICAgICAgICAgICAgICAgICAgPT4gMTIzLAoKICAgICAgICAjIFRpY2tldCBjb250YWlucyB0aGUgcmVzdWx0IG9mIFRpY2tldEdldCBpbmNsdWRpbmcgZHluYW1pYyBmaWVsZHMKICAgICAgICBUaWNrZXQgICAgICAgICAgICAgICAgICAgPT4gXCVUaWNrZXQsICAgIyByZXF1aXJlZAoKICAgICAgICBQcm9jZXNzRW50aXR5SUQgICAgICAgICAgPT4gJ1AxMjMnLAogICAgICAgIEFjdGl2aXR5RW50aXR5SUQgICAgICAgICA9PiAnQTEyMycsCiAgICAgICAgVHJhbnNpdGlvbkVudGl0eUlEICAgICAgID0+ICdUMTIzJywKICAgICAgICBUcmFuc2l0aW9uQWN0aW9uRW50aXR5SUQgPT4gJ1RBMTIzJywKCiAgICAgICAgIyBDb25maWcgaXMgdGhlIGhhc2ggc3RvcmVkIGluIGEgUHJvY2Vzczo6VHJhbnNpdGlvbkFjdGlvbidzIGNvbmZpZyBrZXkKICAgICAgICBDb25maWcgICAgICAgICAgICAgICAgICAgPT4gewogICAgICAgICAgICBDb25maWdJdGVtSUQgICAgPT4gMTIzLCAgICAgICAgICAgICAjIHlvdSBjYW4gYWxzbyB1c2UgbXVsdGlwbGUgQ29uZmlnSXRlbUlEcyBzZXBhcmF0ZWQgYnkgY29tbWFzICgxMjMsIDIzNCwgMzQ1KQogICAgICAgICAgICBvcgogICAgICAgICAgICBDb25maWdJdGVtTnVtYmVyID0+IDEyMywgICAgICAgICAgICAjIHlvdSBjYW4gYWxzbyB1c2UgbXVsdGlwbGUgQ29uZmlnSXRlbU51bWJlcnMgc2VwYXJhdGVkIGJ5IGNvbW1hcyAoMTIzLCAyMzQsIDM0NSkKICAgICAgICAgICAgVXNlcklEICAgICAgICAgICA9PiAxMjMsICAgICAgICAgICAgIyBvcHRpb25hbCwgdG8gb3ZlcnJpZGUgdGhlIFVzZXJJRCBmcm9tIHRoZSBsb2dnZWQgdXNlcgoKICAgICAgICAgICAgJEtleSAgICAgICAgICAgICA9PiAkVmFsdWUsICAgICAgICAgIyByZXF1aXJlZAogICAgICAgIH0KICAgICk7CgpSZXR1cm5zOgoKCiAgICBteSAkU3VjY2VzcyA9IDE7ICAgICAjIDAKCj1jdXQKCnN1YiBSdW4gewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkTG9nT2JqZWN0ICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpOwogICAgbXkgJFRpY2tldE9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpUaWNrZXQnKTsKICAgIG15ICRVc2VyT2JqZWN0ICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6VXNlcicpOwogICAgbXkgJFV0aWxPYmplY3QgICA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpVdGlsJyk7CgogICAgbXkgJElzSVRTTUluc3RhbGxlZCA9ICRVdGlsT2JqZWN0LT5Jc0lUU01JbnN0YWxsZWQoKTsKICAgIGlmICggISRJc0lUU01JbnN0YWxsZWQgKSB7CiAgICAgICAgJExvZ09iamVjdC0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAnVHJhbnNpdGlvbiBhY3Rpb24gQ29uZmlnSXRlbVVwZGF0ZSByZXF1aXJlcyBJVFNNIHRvIGJlIGluc3RhbGxlZC4nLAogICAgICAgICk7CgogICAgICAgICMgRG9uJ3QgcmVwb3J0IGFzIGVycm9yIHRvIHByb2Nlc3MgbWFuYWdlbWVudC4KICAgICAgICByZXR1cm4gMTsKICAgIH0KCiAgICBteSAkQ29uZmlnSXRlbU9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpJVFNNQ29uZmlnSXRlbScpOwoKICAgICMgZGVmaW5lIGEgY29tbW9uIG1lc3NhZ2UgdG8gb3V0cHV0IGluIGNhc2Ugb2YgYW55IGVycm9yCiAgICBteSAkQ29tbW9uTWVzc2FnZSA9ICJQcm9jZXNzOiAkUGFyYW17UHJvY2Vzc0VudGl0eUlEfSBBY3Rpdml0eTogJFBhcmFte0FjdGl2aXR5RW50aXR5SUR9IgogICAgICAgIC4gIiBUcmFuc2l0aW9uOiAkUGFyYW17VHJhbnNpdGlvbkVudGl0eUlEfSIKICAgICAgICAuICIgVHJhbnNpdGlvbkFjdGlvbjogJFBhcmFte1RyYW5zaXRpb25BY3Rpb25FbnRpdHlJRH0gLSAiOwoKICAgICMgY2hlY2sgZm9yIG1pc3Npbmcgb3Igd3JvbmcgcGFyYW1zCiAgICBteSAkU3VjY2VzcyA9ICRTZWxmLT5fQ2hlY2tQYXJhbXMoCiAgICAgICAgJVBhcmFtLAogICAgICAgIENvbW1vbk1lc3NhZ2UgPT4gJENvbW1vbk1lc3NhZ2UsCiAgICApOwogICAgcmV0dXJuIGlmICEkU3VjY2VzczsKCiAgICAjIG92ZXJyaWRlIFVzZXJJRCBpZiBzcGVjaWZpZWQgYXMgYSBwYXJhbWV0ZXIgaW4gdGhlIFRBIGNvbmZpZwogICAgJFBhcmFte1VzZXJJRH0gPSAkU2VsZi0+X092ZXJyaWRlVXNlcklEKCVQYXJhbSk7CgogICAgIyBzcGVjaWFsIGNhc2UgZm9yIER5YW5taWNGaWVsZCBVc2VySUQsIGNvbnZlcnQgZm9ybSBEeW5hbWljRmllbGRfVXNlcklEIHRvIFVzZXJJRAogICAgaWYgKCBkZWZpbmVkICRQYXJhbXtDb25maWd9LT57RHluYW1pY0ZpZWxkX1VzZXJJRH0gKSB7CiAgICAgICAgJFBhcmFte0NvbmZpZ30tPntVc2VySUR9ID0gJFBhcmFte0NvbmZpZ30tPntEeW5hbWljRmllbGRfVXNlcklEfTsKICAgICAgICBkZWxldGUgJFBhcmFte0NvbmZpZ30tPntEeW5hbWljRmllbGRfVXNlcklEfTsKICAgIH0KCiAgICAjIHVzZSB0aWNrZXQgYXR0cmlidXRlcyBpZiBuZWVkZWQKICAgICRTZWxmLT5fUmVwbGFjZVRpY2tldEF0dHJpYnV0ZXMoJVBhcmFtKTsKICAgICRTZWxmLT5fUmVwbGFjZUFkZGl0aW9uYWxBdHRyaWJ1dGVzKCVQYXJhbSk7CgogICAgbXkgQENvbmZpZ0l0ZW1JRHMgICAgID0gc3BsaXQgL1xzKixccyovLCAkUGFyYW17Q29uZmlnfS0+e0NvbmZpZ0l0ZW1JRH0gICAgIHx8ICcnOwogICAgbXkgQENvbmZpZ0l0ZW1OdW1iZXJzID0gc3BsaXQgL1xzKixccyovLCAkUGFyYW17Q29uZmlnfS0+e0NvbmZpZ0l0ZW1OdW1iZXJ9IHx8ICcnOwoKICAgIGlmICggQENvbmZpZ0l0ZW1JRHMgfHwgQENvbmZpZ0l0ZW1OdW1iZXJzICkgewogICAgICAgIGZvciBteSAkQ29uZmlnSXRlbU51bWJlciAoQENvbmZpZ0l0ZW1OdW1iZXJzKSB7CiAgICAgICAgICAgIG15ICRDb25maWdJdGVtSUQgPSAkQ29uZmlnSXRlbU9iamVjdC0+Q29uZmlnSXRlbUxvb2t1cCgKICAgICAgICAgICAgICAgIENvbmZpZ0l0ZW1OdW1iZXIgPT4gJENvbmZpZ0l0ZW1OdW1iZXIsCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHB1c2ggQENvbmZpZ0l0ZW1JRHMsICRDb25maWdJdGVtSUQ7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gMSBpZiAhQENvbmZpZ0l0ZW1JRHM7CgogICAgICAgICMgdW5pcXVlIENvbmZpZ0l0ZW1JRHMKICAgICAgICBteSAlQ29uZmlnSXRlbUlEcyA9IG1hcCB7ICRfID0+ICRfIH0gQENvbmZpZ0l0ZW1JRHM7CiAgICAgICAgQENvbmZpZ0l0ZW1JRHMgPSBrZXlzICVDb25maWdJdGVtSURzOwoKICAgICAgICBmb3IgbXkgJENvbmZpZ0l0ZW1JRCAoQENvbmZpZ0l0ZW1JRHMpIHsKICAgICAgICAgICAgJFNlbGYtPkNvbmZpZ0l0ZW1BdHRyaWJ1dGVzU2V0KAogICAgICAgICAgICAgICAgJXsgJFBhcmFte0NvbmZpZ30gfSwKICAgICAgICAgICAgICAgIENvbmZpZ0l0ZW1JRCA9PiAkQ29uZmlnSXRlbUlELAogICAgICAgICAgICAgICAgVXNlcklEICAgICAgID0+ICRQYXJhbXtVc2VySUR9LAogICAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIDE7CiAgICB9CgogICAgIyBsb29rIHVwIG51bWJlciB0byBJRAogICAgaWYgKCAhJFBhcmFte0NvbmZpZ30tPntDb25maWdJdGVtSUR9ICYmICRQYXJhbXtDb25maWd9LT57Q29uZmlnSXRlbU51bWJlcn0gKSB7CiAgICAgICAgJFBhcmFte0NvbmZpZ30tPntDb25maWdJdGVtSUR9ID0gJENvbmZpZ0l0ZW1PYmplY3QtPkNvbmZpZ0l0ZW1Mb29rdXAoCiAgICAgICAgICAgIENvbmZpZ0l0ZW1OdW1iZXIgPT4gJFBhcmFte0NvbmZpZ30tPntDb25maWdJdGVtTnVtYmVyfSwKICAgICAgICApOwogICAgfQoKICAgICRTZWxmLT5Db25maWdJdGVtQXR0cmlidXRlc1NldCgKICAgICAgICAleyAkUGFyYW17Q29uZmlnfSB9LAogICAgICAgIENvbmZpZ0l0ZW1JRCA9PiAkUGFyYW17Q29uZmlnfS0+e0NvbmZpZ0l0ZW1JRH0sCiAgICAgICAgVXNlcklEICAgICAgID0+ICRQYXJhbXtVc2VySUR9LAogICAgKTsKCiAgICByZXR1cm4gMTsKfQoKPWhlYWQyIENvbmZpZ0l0ZW1BdHRyaWJ1dGVzU2V0KCkKCkRlcGxveXMgbmV3IENJIGF0dHJpYnV0ZXMgLSBjcmVhdGVzIGEgbmV3IENJIFZlcnNpb24uCgogICAgbXkgJFN1Y2Nlc3MgPSAkQ29uZmlnSXRlbVVwZGF0ZU9iamVjdC0+Q29uZmlnSXRlbUF0dHJpYnV0ZXNTZXQoCiAgICAgICAgQ29uZmlnSXRlbUlEICAgICAgICAgICAgICAgPT4gMSwKICAgICAgICBvcgogICAgICAgIENvbmZpZ0l0ZW1OdW1iZXIgICAgICAgICAgID0+IDEsCgogICAgICAgICMgZGVmYXVsdCBDb25maWdJdGVtIGRhdGEKICAgICAgICBEZXBsU3RhdGVOYW1lICAgICAgICAgICAgICA9PiAnUHJvZHVjdGlvbicsCiAgICAgICAgSW5jaVN0YXRlTmFtZSAgICAgICAgICAgICAgPT4gJ09wZXJhdGlvbmFsJywKCiAgICAgICAgIyBTdHJpbmdpZmllZFhNTERhdGEKICAgICAgICAnQ1BVOjonICAgICAgICAgICAgICAgICAgICA9PiAnTkVXLUNQVSwgTkVXLUNQVTInLAogICAgICAgICdIYXJkRGlzazo6MScgICAgICAgICAgICAgID0+ICdORVctSGFyZERpc2sxJywKICAgICAgICAnSGFyZERpc2s6OjE6OkNhcGFjaXR5OjoxJyA9PiAnMTInLAogICAgICAgICdIYXJkRGlzazo6MicgICAgICAgICAgICAgID0+ICdORVctSGFyZERpc2syJywKICAgICAgICAnSGFyZERpc2s6OjI6OkNhcGFjaXR5OjoxJyA9PiAnNDQnLAogICAgICAgICdSYW06OjEnICAgICAgICAgICAgICAgICAgID0+ICdORVctUmFtJywKICAgICAgICAnUmFtOjoyJyAgICAgICAgICAgICAgICAgICA9PiAnTkVXLVJhbTInLAogICAgICAgICdWZW5kb3I6OjEnICAgICAgICAgICAgICAgID0+ICdORVctVmVuZG9yJywKCiAgICAgICAgVXNlcklEICAgICAgICAgICAgICAgICAgICAgPT4gMTIzLAogICAgKTsKClJldHVybnM6CgogICAgbXkgJFN1Y2Nlc3MgPSAxOwoKPWN1dAoKc3ViIENvbmZpZ0l0ZW1BdHRyaWJ1dGVzU2V0IHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJExvZ09iamVjdCAgICAgICAgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkxvZycpOwogICAgbXkgJENvbmZpZ0l0ZW1PYmplY3QgID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OklUU01Db25maWdJdGVtJyk7CiAgICBteSAkWm51bnlIZWxwZXJPYmplY3QgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6Wm51bnlIZWxwZXInKTsKCiAgICBORUVERUQ6CiAgICBmb3IgbXkgJE5lZWRlZCAocXcoQ29uZmlnSXRlbUlEIFVzZXJJRCkpIHsKICAgICAgICBuZXh0IE5FRURFRCBpZiBkZWZpbmVkICRQYXJhbXskTmVlZGVkfTsKCiAgICAgICAgJExvZ09iamVjdC0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiUGFyYW1ldGVyICckTmVlZGVkJyBpcyBuZWVkZWQhIiwKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAjIGdldCBhbGwgcG9zc2libGUgQ29uZmlnSXRlbSBwYXJhbXMsIGRlcGVuZHMgb24gdGhlIGN1cnJlbnQgU3RyaW5naWZpZWRYTUxEYXRhCiAgICBteSAlQ29uZmlnSXRlbVBhcmFtcyA9ICRTZWxmLT5Db25maWdJdGVtQXR0cmlidXRlc0dldCgKICAgICAgICAlUGFyYW0sCiAgICApOwogICAgcmV0dXJuIGlmICElQ29uZmlnSXRlbVBhcmFtczsKCiAgICBteSAkVmVyc2lvbklEID0gJFpudW55SGVscGVyT2JqZWN0LT5fSVRTTUNvbmZpZ0l0ZW1WZXJzaW9uQWRkKAogICAgICAgIENvbmZpZ0l0ZW1JRCA9PiAkUGFyYW17Q29uZmlnSXRlbUlEfSwKICAgICAgICAlQ29uZmlnSXRlbVBhcmFtcywKICAgICk7CgogICAgcmV0dXJuICRWZXJzaW9uSUQ7Cn0KCj1oZWFkMiBDb25maWdJdGVtQXR0cmlidXRlc0dldCgpCgpSZXR1cm5zIGEgdmFsaWQgZGF0YSBzdHJ1Y3R1cmUgZm9yIGEgbmV3IENvbmZpZ0l0ZW0gdmVyc2lvbi4KCiAgICBteSAlQ29uZmlnSXRlbVBhcmFtcyA9ICRDb25maWdJdGVtVXBkYXRlT2JqZWN0LT5Db25maWdJdGVtQXR0cmlidXRlc0dldCgKICAgICAgICBDb25maWdJdGVtSUQgPT4gMSwKICAgICAgICBvcgogICAgICAgIENvbmZpZ0l0ZW1OdW1iZXIgPT4gMSwKCiAgICAgICAgIyBkZWZhdWx0IENvbmZpZ0l0ZW0gZGF0YQogICAgICAgIERlcGxTdGF0ZU5hbWUgICAgICAgICAgICAgID0+ICdQcm9kdWN0aW9uJywKICAgICAgICBJbmNpU3RhdGVOYW1lICAgICAgICAgICAgICA9PiAnT3BlcmF0aW9uYWwnLAoKICAgICAgICAjIFN0cmluZ2lmaWVkWE1MRGF0YQogICAgICAgICdDUFU6OicgICAgICAgICAgICAgICAgICAgID0+ICdORVctQ1BVLCBORVctQ1BVMicsCiAgICAgICAgJ0hhcmREaXNrOjoxJyAgICAgICAgICAgICAgPT4gJ05FVy1IYXJkRGlzazEnLAogICAgICAgICdIYXJkRGlzazo6MTo6Q2FwYWNpdHk6OjEnID0+ICcxMicsCiAgICAgICAgJ0hhcmREaXNrOjoyJyAgICAgICAgICAgICAgPT4gJ05FVy1IYXJkRGlzazInLAogICAgICAgICdIYXJkRGlzazo6Mjo6Q2FwYWNpdHk6OjEnID0+ICc0NCcsCiAgICAgICAgJ1JhbTo6MScgICAgICAgICAgICAgICAgICAgPT4gJ05FVy1SYW0nLAogICAgICAgICdSYW06OjInICAgICAgICAgICAgICAgICAgID0+ICdORVctUmFtMicsCiAgICAgICAgJ1ZlbmRvcicgICAgICAgICAgICAgICAgICAgPT4gJ05FVy1WZW5kb3InLAogICAgICAgICdEZXNjcmlwdGlvbjo6MScgICAgICAgICAgID0+ICc8T1RSU19USUNLRVRfVGl0bGU+JywKICAgICAgICAnU2VyaWFsTnVtYmVyOjoxJyAgICAgICAgICA9PiAnPE9UUlNfVGlja2V0X0R5bmFtaWNGaWVsZF9TZXJpYWxOdW1iZXI+JywKCiAgICAgICAgVXNlcklEICAgICAgICAgICAgICAgICAgICAgPT4gMTIzLAogICAgKTsKClJldHVybnM6CgogICAgbXkgJUNvbmZpZ0l0ZW1QYXJhbXMgPSAoCiAgICAgICAgQ29uZmlnSXRlbUlEICA9PiAxLAogICAgICAgIERlcGxTdGF0ZU5hbWUgPT4gJ1Byb2R1Y3Rpb24nCiAgICAgICAgSW5jaVN0YXRlTmFtZSA9PiAnT3BlcmF0aW9uYWwnCiAgICAgICAgWE1MRGF0YSA9PiB7CiAgICAgICAgICAgICdDUFUnID0+IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAnQ29udGVudCcgPT4gJ05FVy1DUFUnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICdDb250ZW50JyA9PiAnTkVXLUNQVTInCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICdIYXJkRGlzaycgPT4gWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICdDYXBhY2l0eScgPT4gWwogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudCcgPT4gJzEyJwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICAgICAnQ29udGVudCcgPT4gJ05FVy1IYXJkRGlzazEnCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICdDYXBhY2l0eScgPT4gWwogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudCcgPT4gJzQ0JwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICAgICAnQ29udGVudCcgPT4gJ05FVy1IYXJkRGlzazInCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsuLi5dLAogICAgICAgIH0KICAgICk7Cgo9Y3V0CgpzdWIgQ29uZmlnSXRlbUF0dHJpYnV0ZXNHZXQgewogICAgbXkgKCAkU2VsZiwgJVBhcmFtICkgPSBAXzsKCiAgICBteSAkTG9nT2JqZWN0ICAgICAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyk7CiAgICBteSAkQ29uZmlnSXRlbU9iamVjdCAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6SVRTTUNvbmZpZ0l0ZW0nKTsKICAgIG15ICRabnVueUhlbHBlck9iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpabnVueUhlbHBlcicpOwoKICAgIE5FRURFRDoKICAgIGZvciBteSAkTmVlZGVkIChxdyhDb25maWdJdGVtSUQgVXNlcklEKSkgewogICAgICAgIG5leHQgTkVFREVEIGlmIGRlZmluZWQgJFBhcmFteyROZWVkZWR9OwoKICAgICAgICAkTG9nT2JqZWN0LT5Mb2coCiAgICAgICAgICAgIFByaW9yaXR5ID0+ICdlcnJvcicsCiAgICAgICAgICAgIE1lc3NhZ2UgID0+ICJQYXJhbWV0ZXIgJyROZWVkZWQnIGlzIG5lZWRlZCEiLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIG15ICRTZXBhcmF0b3IgPSAkUGFyYW17U2VwYXJhdG9yfSB8fCAnLCc7CgogICAgIyBnZXQgb2xkIHZhbHVlcyB3aGljaCBhcmUgbmVlZGVkIGZvciB2ZXJzaW9uIGFkZAogICAgbXkgJVZlcnNpb24gPSAkWm51bnlIZWxwZXJPYmplY3QtPl9JVFNNQ29uZmlnSXRlbVZlcnNpb25HZXQoCiAgICAgICAgQ29uZmlnSXRlbUlEICAgID0+ICRQYXJhbXtDb25maWdJdGVtSUR9LAogICAgICAgIFhNTERhdGFNdWx0aXBsZSA9PiAxLAogICAgKTsKCiAgICByZXR1cm4gaWYgISVWZXJzaW9uOwoKICAgIG15ICVDb25maWdJdGVtUGFyYW1zID0gJVBhcmFtOwogICAgbXkgJVN0cmluZ2lmaWVkWE1MRGF0YTsKCiAgICAjIHJlbW92ZSBub3QgbmVlZGVkIGF0dHJpYnV0ZXMKICAgIG15IEBSZW1vdmVBdHRyaWJ1dGVzID0gKCAnQ29uZmlnSXRlbU51bWJlcicsICdVc2VySUQnICk7CiAgICBBVFRSSUJVVEU6CiAgICBmb3IgbXkgJEF0dHJpYnV0ZSAoQFJlbW92ZUF0dHJpYnV0ZXMpIHsKICAgICAgICBuZXh0IEFUVFJJQlVURSBpZiAhJENvbmZpZ0l0ZW1QYXJhbXN7JEF0dHJpYnV0ZX07CiAgICAgICAgZGVsZXRlICRDb25maWdJdGVtUGFyYW1zeyRBdHRyaWJ1dGV9OwogICAgfQoKICAgICMgYWRkIG5lZWRlZCAvIGRlZmF1bHQgYXR0cmlidXRlcwogICAgbXkgQENvbmZpZ0l0ZW1BdHRyaWJ1dGVzID0gKAogICAgICAgICdDb25maWdJdGVtSUQnLCAnTmFtZScsICAgICAgICAnQ2xhc3NOYW1lJywgICAgICdDbGFzc0lEJywKICAgICAgICAnRGVwbFN0YXRlSUQnLCAgJ0luY2lTdGF0ZUlEJywgJ0RlcGxTdGF0ZU5hbWUnLCAnSW5jaVN0YXRlTmFtZScKICAgICk7CgogICAgQVRUUklCVVRFOgogICAgZm9yIG15ICRBdHRyaWJ1dGUgKCBzb3J0IGtleXMgJUNvbmZpZ0l0ZW1QYXJhbXMgKSB7CiAgICAgICAgaWYgKCAkQXR0cmlidXRlICF+IG17XDpcOn1tcyApIHsKCiAgICAgICAgICAgIG5leHQgQVRUUklCVVRFIGlmIGdyZXAgeyAkQXR0cmlidXRlIGVxICRfIH0gQENvbmZpZ0l0ZW1BdHRyaWJ1dGVzOwogICAgICAgICAgICAkU3RyaW5naWZpZWRYTUxEYXRheyAkQXR0cmlidXRlIC4gJzo6JyB9ID0gJENvbmZpZ0l0ZW1QYXJhbXN7JEF0dHJpYnV0ZX07CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkU3RyaW5naWZpZWRYTUxEYXRheyRBdHRyaWJ1dGV9ID0gJENvbmZpZ0l0ZW1QYXJhbXN7JEF0dHJpYnV0ZX07CiAgICAgICAgfQogICAgICAgIGRlbGV0ZSAkQ29uZmlnSXRlbVBhcmFtc3skQXR0cmlidXRlfTsKICAgIH0KCiAgICBBVFRSSUJVVEU6CiAgICBmb3IgbXkgJEF0dHJpYnV0ZSAoQENvbmZpZ0l0ZW1BdHRyaWJ1dGVzKSB7CiAgICAgICAgbmV4dCBBVFRSSUJVVEUgaWYgJENvbmZpZ0l0ZW1QYXJhbXN7JEF0dHJpYnV0ZX07CiAgICAgICAgbmV4dCBBVFRSSUJVVEUgaWYgISRWZXJzaW9ueyRBdHRyaWJ1dGV9OwogICAgICAgICRDb25maWdJdGVtUGFyYW1zeyRBdHRyaWJ1dGV9ID0gJFZlcnNpb257JEF0dHJpYnV0ZX07CiAgICB9CgogICAgQVRUUklCVVRFOgogICAgZm9yIG15ICRBdHRyaWJ1dGUgKCBzb3J0IGtleXMgJVN0cmluZ2lmaWVkWE1MRGF0YSApIHsKICAgICAgICBuZXh0IEFUVFJJQlVURSBpZiAkQXR0cmlidXRlICF+IG17XDpcOiR9bXM7CgogICAgICAgIG15IEBBdHRyaWJ1dGVzID0gc3BsaXQgL1xzKiRTZXBhcmF0b3JccyovLCAkU3RyaW5naWZpZWRYTUxEYXRheyRBdHRyaWJ1dGV9OwoKICAgICAgICBteSAkQ291bnRlciA9IDA7CiAgICAgICAgZm9yIG15ICRWYWx1ZSAoQEF0dHJpYnV0ZXMpIHsKICAgICAgICAgICAgJENvdW50ZXIrKzsKICAgICAgICAgICAgJFN0cmluZ2lmaWVkWE1MRGF0YXsgJEF0dHJpYnV0ZSAuICRDb3VudGVyIH0gPSAkVmFsdWU7CiAgICAgICAgfQogICAgICAgIGRlbGV0ZSAkU3RyaW5naWZpZWRYTUxEYXRheyRBdHRyaWJ1dGV9OwogICAgfQoKICAgIG15ICREZWZpbml0aW9uID0gJENvbmZpZ0l0ZW1PYmplY3QtPkRlZmluaXRpb25HZXQoCiAgICAgICAgQ2xhc3NJRCA9PiAkVmVyc2lvbntDbGFzc0lEfSwKICAgICk7CgogICAgbXkgJE9yaWdpbmFsU3RyaW5naWZpZWRYTUxEYXRhOwogICAgaWYgKCAkVmVyc2lvbntYTUxEYXRhfSAmJiBJc0hhc2hSZWZXaXRoRGF0YSggJFZlcnNpb257WE1MRGF0YX0gKSApIHsKICAgICAgICAkT3JpZ2luYWxTdHJpbmdpZmllZFhNTERhdGEgPSAkU2VsZi0+WE1MRGF0YTJTdHJpbmdpZmllZFhNTERhdGEoCiAgICAgICAgICAgIFhNTERhdGEgPT4gJFZlcnNpb257WE1MRGF0YX0sCiAgICAgICAgKTsKICAgIH0KCiAgICBteSAkWE1MRGF0YSA9ICRTZWxmLT5TdHJpbmdpZmllZFhNTERhdGEyWE1MRGF0YSgKICAgICAgICBPcmlnaW5hbFN0cmluZ2lmaWVkWE1MRGF0YSA9PiAkT3JpZ2luYWxTdHJpbmdpZmllZFhNTERhdGEgfHwge30sCiAgICAgICAgWE1MRGVmaW5pdGlvbiAgICAgICAgICAgICAgPT4gJERlZmluaXRpb24tPntEZWZpbml0aW9uUmVmfSwKICAgICAgICBTdHJpbmdpZmllZFhNTERhdGEgICAgICAgICA9PiBcJVN0cmluZ2lmaWVkWE1MRGF0YSwKICAgICAgICBDb25maWdJdGVtSUQgICAgICAgICAgICAgICA9PiAkUGFyYW17Q29uZmlnSXRlbUlEfSwKICAgICk7CgogICAgJENvbmZpZ0l0ZW1QYXJhbXN7WE1MRGF0YX0gPSAkWE1MRGF0YTsKICAgIHJldHVybiAlQ29uZmlnSXRlbVBhcmFtczsKfQoKPWhlYWQyIFhNTERhdGEyU3RyaW5naWZpZWRYTUxEYXRhKCkKCkNvbnZlcnRzIFhNTGRhdGEgc3RydWN0dXJlICh1c2VkIGJ5ICRabnVueUhlbHBlck9iamVjdCA9PiBfSVRTTUNvbmZpZ0l0ZW1WZXJzaW9uQWRkKCkpIHRvIHN0cmluZ2lmaWVkIFhNTERhdGEgJ0NQVTo6MScuClRoaXMgZnVuY3Rpb24gc2hvdWxkIGJlIGludGVncmF0ZWQgaW50byBabnVueTo6SVRTTS4KCiAgICBteSAkU3RyaW5naWZpZWRYTUxEYXRhID0gJENvbmZpZ0l0ZW1VcGRhdGVPYmplY3QtPlhNTERhdGEyU3RyaW5naWZpZWRYTUxEYXRhKAogICAgICAgIFByZWZpeCAgPT4gJFByZWZpeCwKICAgICAgICBYTUxEYXRhID0+IHsKICAgICAgICAgICAgJ05JQycgPT4gWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICdDb250ZW50JyAgICA9PiAnTmljTmFtZTEnLAogICAgICAgICAgICAgICAgICAgICdJUG92ZXJESENQJyA9PiBbCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdDb250ZW50JyA9PiAnWWVzJywKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAgICAgJ0lQQWRkcmVzcycgPT4gWwogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudCcgPT4gJzEyMycsCiAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQnICAgPT4gJ05pY05hbWUyJywKICAgICAgICAgICAgICAgICAgICAnSVBvdmVyREhDUCcgPT4gWwogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudCcgPT4gJ05vJywKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAgICAgJ0lQQWRkcmVzcycgPT4gWwogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudCcgPT4gJzQ1NicsCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdLAogICAgICAgIH0KICAgICk7CgpSZXR1cm5zOgoKICAgIG15ICRTdHJpbmdpZmllZFhNTERhdGEgPSB7CiAgICAgICAgTklDOjoxICAgICAgICAgICAgICAgID0+ICdOaWNOYW1lMScsCiAgICAgICAgTklDOjoxOjpJUEFkZHJlc3M6OjEgID0+ICcxMjMnLAogICAgICAgIE5JQzo6MTo6SVBvdmVyREhDUDo6MSA9PiAnWWVzJywKICAgICAgICBOSUM6OjIgICAgICAgICAgICAgICAgPT4gJ05pY05hbWUyJywKICAgICAgICBOSUM6OjI6OklQQWRkcmVzczo6MSAgPT4gJzQ1NicsCiAgICAgICAgTklDOjoyOjpJUG92ZXJESENQOjoxID0+ICdObycsCiAgICB9OwoKPWN1dAoKc3ViIFhNTERhdGEyU3RyaW5naWZpZWRYTUxEYXRhIHsKICAgIG15ICggJFNlbGYsICVQYXJhbSApID0gQF87CgogICAgbXkgJExvZ09iamVjdCA9ICRLZXJuZWw6Ok9NLT5HZXQoJ0tlcm5lbDo6U3lzdGVtOjpMb2cnKTsKCiAgICBpZiAoICEkUGFyYW17WE1MRGF0YX0gKSB7CiAgICAgICAgJExvZ09iamVjdC0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZGVkIHBhcmFtZXRlciAnWE1MRGF0YScuIiwKICAgICAgICApOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICBteSAlWE1MRGF0YSA9ICV7IFN0b3JhYmxlOjpkY2xvbmUoICRQYXJhbXtYTUxEYXRhfSApIH07CiAgICBteSAkRGF0YTsKCiAgICBJVEVNOgogICAgZm9yIG15ICRJdGVtICggc29ydCBrZXlzICVYTUxEYXRhICkgewogICAgICAgIG5leHQgSVRFTSBpZiAhSXNBcnJheVJlZldpdGhEYXRhKCAkWE1MRGF0YXskSXRlbX0gKTsKCiAgICAgICAgbXkgJENvdW50ZXJJbnNlcnQgPSAxOwogICAgICAgIGZvciBteSAkU3ViSXRlbSAoIEB7ICRYTUxEYXRheyRJdGVtfSB9ICkgewogICAgICAgICAgICBteSAkS2V5ID0gJEl0ZW0gLiAnOjonIC4gJENvdW50ZXJJbnNlcnQ7CiAgICAgICAgICAgIGlmICggJFBhcmFte1ByZWZpeH0gKSB7CiAgICAgICAgICAgICAgICAkS2V5ID0gJFBhcmFte1ByZWZpeH0gLiAnOjonIC4gJEtleTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCAkU3ViSXRlbS0+e0NvbnRlbnR9ICkgewogICAgICAgICAgICAgICAgJERhdGEtPnskS2V5fSA9ICRTdWJJdGVtLT57Q29udGVudH07CiAgICAgICAgICAgICAgICBkZWxldGUgJFN1Ykl0ZW0tPntDb250ZW50fTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbXkgJFN1YlhNTERhdGEgPSAkU2VsZi0+WE1MRGF0YTJTdHJpbmdpZmllZFhNTERhdGEoCiAgICAgICAgICAgICAgICBYTUxEYXRhID0+ICRTdWJJdGVtLAogICAgICAgICAgICAgICAgUHJlZml4ICA9PiAkS2V5LAogICAgICAgICAgICApOwoKICAgICAgICAgICAgaWYgKCRTdWJYTUxEYXRhKSB7CiAgICAgICAgICAgICAgICAleyREYXRhfSA9ICgKICAgICAgICAgICAgICAgICAgICAleyREYXRhfSwKICAgICAgICAgICAgICAgICAgICAleyRTdWJYTUxEYXRhfSwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJENvdW50ZXJJbnNlcnQrKzsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuICREYXRhOwp9Cgo9aGVhZDIgU3RyaW5naWZpZWRYTUxEYXRhMlhNTERhdGEoKQoKQ29udmVydHMgc3RyaW5naWZpZWQgWE1MRGF0YSAnQ1BVOjoxJyBmb3IgY29uZmlnLWl0ZW0gaW50byBYTUxkYXRhIHN0cnVjdHVyZSAodXNlZCBieSAkWm51bnlIZWxwZXJPYmplY3QgPT4gX0lUU01Db25maWdJdGVtVmVyc2lvbkFkZCgpKS4KVGhpcyBmdW5jdGlvbiBzaG91bGQgYmUgaW50ZWdyYXRlZCBpbnRvIFpudW55OjpJVFNNLgoKICAgIG15ICRYTUxEYXRhID0gJENvbmZpZ0l0ZW1VcGRhdGVPYmplY3QtPlN0cmluZ2lmaWVkWE1MRGF0YTJYTUxEYXRhKAoKICAgICAgICAjIG5ldyBzdHJpbmdpZmllZCBYTUxEYXRhIGZvciB0aGlzIENvbmZpZ0l0ZW0KICAgICAgICBTdHJpbmdpZmllZFhNTERhdGEgPT4gewogICAgICAgICAgICAnQ1BVOjoxJyAgICAgICAgICAgICAgICAgICA9PiAnTkVXLUNQVScsCiAgICAgICAgICAgICdDUFU6OjInICAgICAgICAgICAgICAgICAgID0+ICdORVctQ1BVMicsCiAgICAgICAgICAgICdIYXJkRGlzazo6MScgICAgICAgICAgICAgID0+ICdORVctSGFyZERpc2sxJywKICAgICAgICAgICAgJ0hhcmREaXNrOjoxOjpDYXBhY2l0eTo6MScgPT4gJzEyJywKICAgICAgICAgICAgJ0hhcmREaXNrOjoyJyAgICAgICAgICAgICAgPT4gJ05FVy1IYXJkRGlzazInLAogICAgICAgICAgICAnSGFyZERpc2s6OjI6OkNhcGFjaXR5OjoxJyA9PiAnNDQnLAogICAgICAgICAgICAnUmFtOjoxJyAgICAgICAgICAgICAgICAgICA9PiAnTkVXLVJhbScsCiAgICAgICAgICAgICdSYW06OjInICAgICAgICAgICAgICAgICAgID0+ICdORVctUmFtMicsCiAgICAgICAgICAgICdWZW5kb3I6OjEnICAgICAgICAgICAgICAgID0+ICdORVctVmVuZG9yJywKICAgICAgICB9CgogICAgICAgICMgdGhpcyBpcyB0aGUgZGVmaW5pdGlvbiAgb2YgdGhpcyBDbGFzcyAkRGVmaW5pdGlvbi0+e0RlZmluaXRpb25SZWZ9LAogICAgICAgIFhNTERlZmluaXRpb24gPT4gWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAnS2V5JyA9PiAnTklDJywKICAgICAgICAgICAgICAgICdJbnB1dCcgPT4gewogICAgICAgICAgICAgICAgICAgICAgICdNYXhMZW5ndGgnID0+IDEwMCwKICAgICAgICAgICAgICAgICAgICAgICAnU2l6ZScgICAgICA9PiA1MCwKICAgICAgICAgICAgICAgICAgICAgICAnVHlwZScgICAgICA9PiAnVGV4dCcsCiAgICAgICAgICAgICAgICAgICAgICAgJ1JlcXVpcmVkJyAgPT4gMQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICdDb3VudERlZmF1bHQnID0+IDEsCiAgICAgICAgICAgICAgICAnQ291bnRNaW4nICAgICA9PiAwLAogICAgICAgICAgICAgICAgJ0NvdW50TWF4JyAgICAgPT4gMTAsCiAgICAgICAgICAgICAgICAnU3ViJyAgICAgICAgICA9PiBbCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAnQ291bnRNaW4nID0+IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICdDb3VudERlZmF1bHQnID0+IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICdOYW1lJyA9PiAnSVAgb3ZlciBESENQJywKICAgICAgICAgICAgICAgICAgICAgICAgJ0NvdW50TWF4JyA9PiAxLAogICAgICAgICAgICAgICAgICAgICAgICAnSW5wdXQnID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdUeXBlJyAgICAgICAgPT4gJ0dlbmVyYWxDYXRhbG9nJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdDbGFzcycgICAgICAgPT4gJ0lUU006OkNvbmZpZ0l0ZW06Olllc05vJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdSZXF1aXJlZCcgICAgPT4gMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdUcmFuc2xhdGlvbicgPT4gMQogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAnS2V5JyA9PiAnSVBvdmVyREhDUCcKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgJ1NlYXJjaGFibGUnICAgPT4gMSwKICAgICAgICAgICAgICAgICAgICAgICAgJ0NvdW50TWluJyAgICAgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgJ0NvdW50RGVmYXVsdCcgPT4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgJ0NvdW50TWF4JyAgICAgPT4gMjAsCiAgICAgICAgICAgICAgICAgICAgICAgICdOYW1lJyAgICAgICAgID0+ICdJUCBBZGRyZXNzJywKICAgICAgICAgICAgICAgICAgICAgICAgJ0tleScgICAgICAgICAgPT4gJ0lQQWRkcmVzcycsCiAgICAgICAgICAgICAgICAgICAgICAgICdJbnB1dCcgICAgICAgID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdUeXBlJyAgICAgICAgID0+ICdUZXh0JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdSZXF1aXJlZCcgICAgID0+IDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnU2l6ZScgICAgICAgICA9PiA0MCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdNYXhMZW5ndGgnICAgID0+IDQwLAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICdOYW1lJyA9PiAnTmV0d29yayBBZGFwdGVyJwogICAgICAgICAgICB9LAogICAgICAgIF0sCgogICAgICAgICMgb3JpZ2luYWwgc3RyaW5naWZpZWQgWE1MRGF0YSBmcm9tIHRoZSBsYXRlc3QgdmVyc2lvbiBvZiB0aGlzIENvbmZpZ0l0ZW0KICAgICAgICBPcmlnaW5hbFN0cmluZ2lmaWVkWE1MRGF0YSA9PiB7CiAgICAgICAgICAgICdDUFU6OjEnICAgICAgICAgICAgICAgICAgID0+ICdDUFUnLAogICAgICAgICAgICAnQ1BVOjoyJyAgICAgICAgICAgICAgICAgICA9PiAnQ1BVMicsCiAgICAgICAgICAgICdIYXJkRGlzazo6MScgICAgICAgICAgICAgID0+ICdIYXJkRGlzazEnLAogICAgICAgICAgICAnSGFyZERpc2s6OjE6OkNhcGFjaXR5OjoxJyA9PiAnMTInLAogICAgICAgICAgICAnSGFyZERpc2s6OjInICAgICAgICAgICAgICA9PiAnSGFyZERpc2syJywKICAgICAgICAgICAgJ0hhcmREaXNrOjoyOjpDYXBhY2l0eTo6MScgPT4gJzQ0JywKICAgICAgICAgICAgJ1JhbTo6MScgICAgICAgICAgICAgICAgICAgPT4gJ1JhbScsCiAgICAgICAgICAgICdSYW06OjInICAgICAgICAgICAgICAgICAgID0+ICdSYW0yJywKICAgICAgICAgICAgJ1ZlbmRvcjo6MScgICAgICAgICAgICAgICAgPT4gJ1ZlbmRvcicsCiAgICAgICAgfSwKICAgICAgICBQcmVmaXggICAgICAgPT4gJFByZWZpeCwKICAgICk7CgpSZXR1cm5zOgoKICAgICRYTUxEYXRhID0gewogICAgICAgICdDUFUnID0+IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJ0NvbnRlbnQnID0+ICdDUFUnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICdDb250ZW50JyA9PiAnQ1BVMicKICAgICAgICAgICAgfQogICAgICAgIF0sCiAgICAgICAgJ1JhbScgPT4gWwogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAnQ29udGVudCcgPT4gJ1JhbScKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJ0NvbnRlbnQnID0+ICdSYW0yJwogICAgICAgICAgICB9CiAgICAgICAgXSwKICAgICAgICBbLi4uXQogICAgfTsKCj1jdXQKCnN1YiBTdHJpbmdpZmllZFhNTERhdGEyWE1MRGF0YSB7CiAgICBteSAoICRTZWxmLCAlUGFyYW0gKSA9IEBfOwoKICAgIG15ICRMb2dPYmplY3QgICAgICAgICAgPSAkS2VybmVsOjpPTS0+R2V0KCdLZXJuZWw6OlN5c3RlbTo6TG9nJyk7CiAgICBteSAkQ3VzdG9tZXJVc2VyT2JqZWN0ID0gJEtlcm5lbDo6T00tPkdldCgnS2VybmVsOjpTeXN0ZW06OkN1c3RvbWVyVXNlcicpOwoKICAgIGlmICggIUlzQXJyYXlSZWZXaXRoRGF0YSggJFBhcmFte1hNTERlZmluaXRpb259ICkgKSB7CiAgICAgICAgJExvZ09iamVjdC0+TG9nKAogICAgICAgICAgICBQcmlvcml0eSA9PiAnZXJyb3InLAogICAgICAgICAgICBNZXNzYWdlICA9PiAiTmVlZGVkIHBhcmFtZXRlciAnWE1MRGVmaW5pdGlvbicgaGFzIHRvIGJlIGFuIEFycmF5UmVmLiIsCiAgICAgICAgKTsKICAgICAgICByZXR1cm47CiAgICB9CgogICAgaWYgKCByZWYgJFBhcmFte1N0cmluZ2lmaWVkWE1MRGF0YX0gbmUgJ0hBU0gnICkgewogICAgICAgICRMb2dPYmplY3QtPkxvZygKICAgICAgICAgICAgUHJpb3JpdHkgPT4gJ2Vycm9yJywKICAgICAgICAgICAgTWVzc2FnZSAgPT4gIk5lZWRlZCBwYXJhbWV0ZXIgJ1N0cmluZ2lmaWVkWE1MRGF0YScgaGFzIHRvIGJlIGEgSGFzaFJlZi4iLAogICAgICAgICk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIG15ICRSZXR1cm5EYXRhID0ge307CiAgICBJVEVNOgogICAgZm9yIG15ICRJdGVtICggQHsgJFBhcmFte1hNTERlZmluaXRpb259IH0gKSB7CiAgICAgICAgbXkgJENvdW50ZXJJbnNlcnQgPSAwOwoKICAgICAgICBDT1VOVEVSOgogICAgICAgIGZvciBteSAkQ291bnRlciAoIDEgLi4gJEl0ZW0tPntDb3VudE1heH0gKSB7CgogICAgICAgICAgICAjIGNyZWF0ZSBpbnB1dGtleSBhbmQgYWRka2V5CiAgICAgICAgICAgIG15ICRLZXkgPSAkSXRlbS0+e0tleX0gLiAnOjonIC4gJENvdW50ZXI7CiAgICAgICAgICAgIGlmICggJFBhcmFte1ByZWZpeH0gKSB7CiAgICAgICAgICAgICAgICAkS2V5ID0gJFBhcmFte1ByZWZpeH0gLiAnOjonIC4gJEtleTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbXkgJEl0ZW1Db3VudE1pbiA9ICRJdGVtLT57Q291bnRNaW59IHx8IDA7CgogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAoICEkUGFyYW17U3RyaW5naWZpZWRYTUxEYXRhfS0+eyRLZXl9ICYmICEkUGFyYW17T3JpZ2luYWxTdHJpbmdpZmllZFhNTERhdGF9LT57JEtleX0gKQogICAgICAgICAgICAgICAgJiYgJENvdW50ZXIgZ3QgJEl0ZW1Db3VudE1pbgogICAgICAgICAgICAgICAgKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBuZXh0IENPVU5URVI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG5leHQgQ09VTlRFUiBpZiAhJFBhcmFte1N0cmluZ2lmaWVkWE1MRGF0YX0tPnskS2V5fSAmJiAhJFBhcmFte09yaWdpbmFsU3RyaW5naWZpZWRYTUxEYXRhfS0+eyRLZXl9OwoKICAgICAgICAgICAgIyBmYWxsYmFjayAtIHVzZSBPcmlnaW5hbFN0cmluZ2lmaWVkWE1MRGF0YSBpZiBleGlzdHMKICAgICAgICAgICAgbXkgJEF0dHJpYnV0ZVZhbHVlID0gJFBhcmFte1N0cmluZ2lmaWVkWE1MRGF0YX0tPnskS2V5fQogICAgICAgICAgICAgICAgfHwgJFBhcmFte09yaWdpbmFsU3RyaW5naWZpZWRYTUxEYXRhfS0+eyRLZXl9CiAgICAgICAgICAgICAgICB8fCAkSXRlbS0+e0lucHV0fS0+e1ZhbHVlRGVmYXVsdH07CgogICAgICAgICAgICBpZiAoIGRlZmluZWQgJFBhcmFte1N0cmluZ2lmaWVkWE1MRGF0YX0tPnskS2V5fSAmJiAkUGFyYW17U3RyaW5naWZpZWRYTUxEYXRhfS0+eyRLZXl9IGVxICcnICkgewogICAgICAgICAgICAgICAgJEF0dHJpYnV0ZVZhbHVlID0gJFBhcmFte1N0cmluZ2lmaWVkWE1MRGF0YX0tPnskS2V5fTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCBJc0FycmF5UmVmV2l0aERhdGEoJEF0dHJpYnV0ZVZhbHVlKSApIHsKICAgICAgICAgICAgICAgIG15ICRWYWx1ZUNvdW50ZXIgPSAkQ291bnRlciAtIDE7CgogICAgICAgICAgICAgICAgbmV4dCBDT1VOVEVSIGlmICEkQXR0cmlidXRlVmFsdWUtPlskVmFsdWVDb3VudGVyXTsKICAgICAgICAgICAgICAgICRBdHRyaWJ1dGVWYWx1ZSA9ICRBdHRyaWJ1dGVWYWx1ZS0+WyRWYWx1ZUNvdW50ZXJdOwogICAgICAgICAgICB9CgogICAgICAgICAgICAjIHRoaXMgaXMgY3VycmVudGx5IHRoZSBvbmx5IGFkZGl0aW9uYWwgYXR0cmlidXRlIG1hcHBpbmcKICAgICAgICAgICAgZWxzaWYgKAogICAgICAgICAgICAgICAgSXNTdHJpbmdXaXRoRGF0YSgkQXR0cmlidXRlVmFsdWUpCiAgICAgICAgICAgICAgICAmJiBJc0hhc2hSZWZXaXRoRGF0YSggJEl0ZW0tPntJbnB1dH0gKQogICAgICAgICAgICAgICAgJiYgSXNTdHJpbmdXaXRoRGF0YSggJEl0ZW0tPntJbnB1dH0tPntUeXBlfSApCiAgICAgICAgICAgICAgICAmJiAkSXRlbS0+e0lucHV0fS0+e1R5cGV9IGVxICdDdXN0b21lcicKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbXkgJUN1c3RvbWVyVXNlckxpc3QgPSAkQ3VzdG9tZXJVc2VyT2JqZWN0LT5DdXN0b21lclNlYXJjaCgKICAgICAgICAgICAgICAgICAgICBTZWFyY2ggPT4gJEF0dHJpYnV0ZVZhbHVlLAogICAgICAgICAgICAgICAgICAgIFVzZXJJRCA9PiAkU2VsZi0+e1VzZXJJRH0sCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgIG15IEBDdXN0b21lclVzZXJJRHMgPSBrZXlzICVDdXN0b21lclVzZXJMaXN0OwoKICAgICAgICAgICAgICAgICMgaWYgQ3VzdG9tZXJVc2VyIGV4aXN0cyB1c2UgdGhlbSBhcyBuZXcgQXR0cmlidXRlVmFsdWUKICAgICAgICAgICAgICAgICMgaWYgbm90IHVzZSBmcm9tIE9yaWdpbmFsU3RyaW5naWZpZWRYTUxEYXRhCiAgICAgICAgICAgICAgICBpZiAoIEBDdXN0b21lclVzZXJJRHMgJiYgc2NhbGFyIEBDdXN0b21lclVzZXJJRHMgZXEgJzEnICkgewogICAgICAgICAgICAgICAgICAgICRBdHRyaWJ1dGVWYWx1ZSA9IHNoaWZ0IEBDdXN0b21lclVzZXJJRHM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkQXR0cmlidXRlVmFsdWUgPSAkUGFyYW17T3JpZ2luYWxTdHJpbmdpZmllZFhNTERhdGF9LT57JEtleX0gfHwgJEl0ZW0tPntJbnB1dH0tPntWYWx1ZURlZmF1bHR9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIHN0YXJ0IHJlY3Vyc2lvbiwgaWYgIlN1YiIgd2FzIGZvdW5kCiAgICAgICAgICAgIGlmICggJEF0dHJpYnV0ZVZhbHVlICYmICRJdGVtLT57U3VifSApIHsKICAgICAgICAgICAgICAgIG15ICRTdWJYTUxEYXRhID0gJFNlbGYtPlN0cmluZ2lmaWVkWE1MRGF0YTJYTUxEYXRhKAogICAgICAgICAgICAgICAgICAgIFhNTERlZmluaXRpb24gICAgICAgICAgICAgID0+ICRJdGVtLT57U3VifSwKICAgICAgICAgICAgICAgICAgICBTdHJpbmdpZmllZFhNTERhdGEgICAgICAgICA9PiAkUGFyYW17U3RyaW5naWZpZWRYTUxEYXRhfSwKICAgICAgICAgICAgICAgICAgICBQcmVmaXggICAgICAgICAgICAgICAgICAgICA9PiAkS2V5LAogICAgICAgICAgICAgICAgICAgIE9yaWdpbmFsU3RyaW5naWZpZWRYTUxEYXRhID0+ICRQYXJhbXtPcmlnaW5hbFN0cmluZ2lmaWVkWE1MRGF0YX0sCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICRSZXR1cm5EYXRhLT57ICRJdGVtLT57S2V5fSB9LT5bJENvdW50ZXJJbnNlcnRdID0gJFN1YlhNTERhdGE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICRSZXR1cm5EYXRhLT57ICRJdGVtLT57S2V5fSB9LT5bJENvdW50ZXJJbnNlcnRdLT57Q29udGVudH0gPSAkQXR0cmlidXRlVmFsdWU7CiAgICAgICAgICAgICRDb3VudGVySW5zZXJ0Kys7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiAkUmV0dXJuRGF0YTsKfQoKMTsK</File>
        <File Location="Kernel/Config/Files/XML/MultiTenancy.xml" Permission="660" Encode="Base64">PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPG90cnNfY29uZmlnIHZlcnNpb249IjIuMCIgaW5pdD0iQXBwbGljYXRpb24iPgogICAgPFNldHRpbmcgTmFtZT0iTXVsdGlUZW5hbmN5IiBSZXF1aXJlZD0iMSIgVmFsaWQ9IjEiPgogICAgICAgIDxEZXNjcmlwdGlvbiBMYW5nPSJlbiI+SWYgZW5hYmxlZCwgYWdlbnRzIGNhbiBvbmx5IHNlZSBjdXN0b21lciB1c2VycywgcXVldWVzLCBhbmQgb3RoZXIgcmVzb3VyY2VzIHdpdGggd2hpY2ggdGhleSBzaGFyZSBhIGNvbW1vbiBncm91cCBtZW1iZXJzaGlwLjwvRGVzY3JpcHRpb24+CiAgICAgICAgPE5hdmlnYXRpb24+Q29yZTwvTmF2aWdhdGlvbj4KICAgICAgICA8TmF2aWdhdGlvbj5Db3JlPC9OYXZpZ2F0aW9uPgogICAgICAgIDxWYWx1ZT4KICAgICAgICAgICAgPEl0ZW0gVmFsdWVUeXBlPSJDaGVja2JveCI+MTwvSXRlbT4KICAgICAgICA8L1ZhbHVlPgogICAgPC9TZXR0aW5nPgogICAgPFNldHRpbmcgTmFtZT0iQ3VzdG9tZXJHcm91cFN1cHBvcnQiIFJlcXVpcmVkPSIxIiBWYWxpZD0iMSI+CiAgICAgICAgPERlc2NyaXB0aW9uIFRyYW5zbGF0YWJsZT0iMSI+QWN0aXZhdGVzIHN1cHBvcnQgZm9yIGN1c3RvbWVyIGFuZCBjdXN0b21lciB1c2VyIGdyb3Vwcy48L0Rlc2NyaXB0aW9uPgogICAgICAgIDxOYXZpZ2F0aW9uPkZyb250ZW5kOjpDdXN0b21lcjwvTmF2aWdhdGlvbj4KICAgICAgICA8VmFsdWU+CiAgICAgICAgICAgIDxJdGVtIFZhbHVlVHlwZT0iQ2hlY2tib3giPjE8L0l0ZW0+CiAgICAgICAgPC9WYWx1ZT4KICAgIDwvU2V0dGluZz4KPC9vdHJzX2NvbmZpZz4K</File>
    </Filelist>
</otrs_package>
